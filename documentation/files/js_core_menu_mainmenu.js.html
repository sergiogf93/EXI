<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>js/core/menu/mainmenu.js - EXI</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/css/logo.png" title="EXI" width="117" height="52"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 1.0.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                            </ul>
                
                
                            <ul id="api-modules" class="apis modules">
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: js/core/menu/mainmenu.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
function MainMenu(args) {
	this.id = BUI.id();
	this.loginButtonId = &#x27;loginButton&#x27; + this.id;
	this.cssClass = &#x27;mainMenu&#x27;;
	this.isHidden = true;
	if (args != null){
		if (args.cssClass != null){
			this.cssClass = args.cssClass;
		}
		if (args.isHidden != null){
			this.isHidden = args.isHidden;
		}
	}
}

MainMenu.prototype.getMenuItems = function() { return [];};


/**
 * If there is a credential then home tab will redirect to the welcome page (either manager or user)
 */
MainMenu.prototype.getHomeItem = function() { 
	return {
		text : this._convertToHTMLWhiteSpan(&quot;Home&quot;),
		cls : &#x27;ExiSAXSMenuToolBar&#x27;,
		icon : &#x27;../images/icon/rsz_ic_home_black_24dp.png&#x27;,
		handler : function(){
				if (EXI.credentialManager.getCredentials() != null){
					if (EXI.credentialManager.getCredentials().length &gt; 0){
						var username = EXI.credentialManager.getCredentials()[0].username;
						var credential = EXI.credentialManager.getCredentialByUserName(EXI.credentialManager.getCredentials()[0].username);
						if (credential.isManager()){
							location.hash = &quot;/welcome/manager/&quot; + username + &quot;/main&quot;;
						}
						else{
							location.hash = &quot;/welcome/user/&quot; + username + &quot;/main&quot;;
						}
					}
					else{
						BUI.showError(&quot;You should sign up&quot;);
					}
				}
				else{
					BUI.showError(&quot;You should sign up&quot;);
				}
		}
	};
};

MainMenu.prototype.getShipmentItem = function() { 
	var _this = this;
	function onItemCheck(item, checked) {
		if (item.text == &quot;Shipments&quot;) {
			location.hash = &quot;/proposal/shipping/nav&quot;;
		}
		if (item.text == &quot;Manage shipping addresses&quot;) {
			location.hash = &quot;/proposal/addresses/nav&quot;;
		}
		if (item.text == &quot;Shipment List&quot;) {
			location.hash = &quot;/proposal/shipping/nav&quot;;
		}
	}

	function getBiosaxsMenu() {
		var _this = this;
		function onItemCheck(item, checked) {
			if (item.text == &quot;Stock Solutions&quot;) {
				location.hash = &quot;/saxs/stocksolution/nav&quot;;
			}
			
		}

		return Ext.create(&#x27;Ext.menu.Menu&#x27;, {
			items : [ 
						{
							text : &#x27;Stock Solutions&#x27;,
							icon : &#x27;../images/icon/testtube.png&#x27;,
							handler : onItemCheck 
						} 
			] });
	}
	
	
	
	return {
		text : this._convertToHTMLWhiteSpan(&quot;Shipment&quot;),
		cls : &#x27;ExiSAXSMenuToolBar&#x27;,
//		hidden : this.isHidden,
		menu : Ext.create(&#x27;Ext.menu.Menu&#x27;, {
			items : [ 
						{
							text : &#x27;BioSAXS&#x27;,
							icon : &#x27;../images/icon/macromolecule.png&#x27;,
							menu: getBiosaxsMenu()
						}, 
						{
							text : &#x27;Manage shipping addresses&#x27;,
							icon : &#x27;../images/icon/contacts.png&#x27;,
							handler : onItemCheck 
						}, 
						{
							text : &#x27;Shipments&#x27;,
							icon : &#x27;../images/icon/shipping.png&#x27;,
							handler : onItemCheck 
						} 
					] })
	};

};


MainMenu.prototype.getHelpMenu = function() {
	var _this = this;
	function onItemCheck(item, checked) {
		if (item.text == &quot;ISPyB Web services API Map&quot;) {
			window.open(&#x27;/exi/documentation/ispyb-api-ws/print.html&#x27;);
		}
		if (item.text == &quot;Job list&quot;) {
			location.hash = &quot;/tool/list&quot;;
		}
	}

	return Ext.create(&#x27;Ext.menu.Menu&#x27;, {
		items : [

		{
			text : &#x27;Developer&#x27;,
			checked : false,
			group : &#x27;theme&#x27;,
			menu : {       
                    items: [
                        {
                            text: &#x27;ISPyB Web services API Map&#x27;,
                            handler: onItemCheck
                        }, {
                            text: &#x27;How to retrieve data from ISPyB?&#x27;,
                            handler: onItemCheck
                        }, {
                            text: &#x27;EXI Router&#x27;,
                            handler: onItemCheck
                        }, {
                            text: &#x27;EXI List Views Objects&#x27;,
                            handler: onItemCheck
                        }, {
                            text: &#x27;EXI Main View Objects&#x27;,
                            handler: onItemCheck
                        }
                    ]
                }
		},
		&quot;-&quot;,
		{
				text : &#x27;About&#x27;,
				checked : false,
				group : &#x27;theme&#x27;,
				handler : onItemCheck }
		] });
};

MainMenu.prototype.getAddCredentialMenu = function() {
	if (EXI.credentialManager.getCredentials() != null){
		if (EXI.credentialManager.getCredentials().length &gt; 0){
			return {
				icon : &#x27;../images/icon/rsz_1ic_input_black_24dp.png&#x27;,
				height : 30,
				text : &#x27;Add&#x27;,
				handler : function() {
						window.location.href = &#x27;#/login&#x27;;
				} 
			};
		}
	}
};

MainMenu.prototype.populateCredentialsMenu = function() {
	this.credentialsMenu.removeAll();
	var credentialDisplay = &quot;&quot;;
	if (EXI.credentialManager.getCredentials() != null) {
		for (var i = 0; i &lt; EXI.credentialManager.getCredentials().length; i++) {
			credentialDisplay = EXI.credentialManager.getCredentials()[i].username;
			if (EXI.credentialManager.getCredentials()[i].activeProposals.length &gt; 0) {
				for (var j = 0; j &lt; EXI.credentialManager.getCredentials()[i].activeProposals.length; j++) {
					credentialDisplay = EXI.credentialManager.getCredentials()[i].activeProposals[j] + &quot;@&quot; + EXI.credentialManager.getCredentials()[i].username;
					this.credentialsMenu.add({
						text : credentialDisplay,
						icon : &quot;../images/icon/rsz_esrflogo80.gif&quot;,
						disabled : true });
				}
			} else {
				this.credentialsMenu.add({
					text : credentialDisplay,
					icon : &quot;../images/icon/rsz_esrflogo80.gif&quot;,
					disabled : true });
				
			}
			
			
		}
	} 
	if (EXI.credentialManager.getCredentials().length &gt; 0){
		Ext.getCmp(this.loginButtonId).setText(&quot;&lt;span style=&#x27;color:white&#x27;&gt;Log out &lt;span style=&#x27;font-weight:bold;&#x27;&gt;&quot; + credentialDisplay + &quot; &lt;/span&gt; &lt;/span&gt;&quot;);
		Ext.getCmp(this.loginButtonId).setIcon(&quot;../images/rsz_logout.png&quot;);
	}
	else{
		Ext.getCmp(this.loginButtonId).setText(&quot;&lt;span style=&#x27;color:white&#x27;&gt;Sign In&lt;/span&gt;&quot;);
		Ext.getCmp(this.loginButtonId).setIcon(&quot;../images/rsz_login.png&quot;);
	}
	
	
};

MainMenu.prototype._convertToHTMLWhiteSpan = function(text) {
	return &#x27;&lt;span style=&quot;color:white&quot;&gt;&#x27; + text +&#x27;&lt;/span&gt;&#x27;;
};

MainMenu.prototype.isLoggedIn = function() {
	return (EXI.credentialManager.getCredentials().length &gt; 0);
};


MainMenu.prototype.getLoginButton = function() {
	var icon =  &quot;../images/rsz_login.png&quot;;
	var text =  this._convertToHTMLWhiteSpan(&quot;Sign In&quot;);
	
	if (EXI.credentialManager.getCredentials().length &gt; 0){
		icon =  &quot;../images/rsz_logout.png&quot;;
		text =  this._convertToHTMLWhiteSpan(&quot;log out&quot;);
	}
	
	return {
		xtype 	: &#x27;splitbutton&#x27;,
		id		: this.loginButtonId,
		text 	: text,
		cls 	: &#x27;button_log_out&#x27;,
		icon 	: icon,
		menu 	: this.credentialsMenu,
		handler : function() {
			if (EXI.credentialManager.getCredentials().length == 0){
				location.hash = &quot;/login&quot;;
			}
			else{
				location.hash = &quot;/logout&quot;;
			}
		} 
	};
};

MainMenu.prototype.getPanel = function() {
	var _this = this;
	
	this.credentialsMenu = new Ext.menu.Menu({
		id : _this.id + &quot;menu&quot;,
		items : [
		         _this.getAddCredentialMenu()
         ] 
	});
	
	var items  = this.getMenuItems();
	items.push(&#x27;-&gt;&#x27;);
	items.push(this.getLoginButton());
	
	this.tb = Ext.create(&#x27;Ext.toolbar.Toolbar&#x27;, {
		cls : this.cssClass,
		listeners : {
			afterrender : function(component, eOpts) {
			} 
		},
		items : items
		}
	);
	return this.tb;
};

    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
