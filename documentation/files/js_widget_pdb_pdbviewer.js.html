<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>js/widget/pdb/pdbviewer.js - EXI</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/css/logo.png" title="EXI" width="117" height="52"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 1.0.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/AutoProcIntegrationGrid.html">AutoProcIntegrationGrid</a></li>
                                <li><a href="../classes/ManagerWelcomeMainView.html">ManagerWelcomeMainView</a></li>
                                <li><a href="../classes/ParcelGrid.html">ParcelGrid</a></li>
                                <li><a href="../classes/ParcelPanel.html">ParcelPanel</a></li>
                                <li><a href="../classes/PhasingNetworkWidget.html">PhasingNetworkWidget</a></li>
                                <li><a href="../classes/ShippingMainView.html">ShippingMainView</a></li>
                            </ul>
                
                
                            <ul id="api-modules" class="apis modules">
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: js/widget/pdb/pdbviewer.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
function PDBViewer(args) {
	this.id = BUI.id();
	this.glMol = null;

	this.width = 600;
	this.height = 600;
	this.title = &quot;&quot;;

	this.margin = &quot;10 0 0 5&quot;;
	if (args != null) {
		if (args.width != null) {
			this.width = args.width;
		}
		if (args.height != null) {
			this.height = args.height;
		}
		if (args.title != null) {
			this.title = args.title;
		}
		if (args.margin != null) {
			this.margin = args.margin;
		}
	}
}

PDBViewer.prototype.getTitle = function() {
	return &quot;&lt;div style=&#x27;width:&quot; + this.width + &quot;px; height:20px; font-weight:bold;background-color: #E6E6E6;color:black&#x27;&gt;&quot; + this.title + &quot;&lt;/div&gt;&quot;;
};

PDBViewer.prototype.getTextAreaId = function() {
	return this.id + &quot;_src&quot;;
};

PDBViewer.prototype.getCanvas = function() {
	/** For text Area **/
	var textAreaStyle = &quot;width:&quot; + this.width + &quot;px; height: &quot; + this.height + &quot;px;display: none;&quot;;
	var textArea = &quot;&lt;textarea id=&#x27;&quot; + this.getTextAreaId() + &quot;&#x27;; style=&#x27;&quot; + textAreaStyle + &quot;&#x27; &gt;&lt;/textarea&gt;&quot;;
	var style = &quot;width: &quot; + this.width + &quot;px; height: &quot; + this.height + &quot;px; background-color: black;&quot;;
	return textArea + &quot;&lt;div id=&#x27;&quot; + this.id + &quot;&#x27;; style=&#x27;&quot; + style + &quot;&#x27; &gt;&lt;/div&gt;&quot;;

};

PDBViewer.prototype.getDownload = function(type, abInitioModelId) {
	/** For title **/
	var url = BUI.getPdbURL() + &#x27;&amp;type=&#x27; + type + &#x27;&amp;abInitioModelId=&#x27; + abInitioModelId;
	html = &#x27;&lt;a href=&#x27; + url + &#x27; style=&quot;color:blue;font-weight:bold;&quot;  height=&quot;80&quot; width=&quot;80&quot; &gt;Download&lt;/a&gt;&lt;br /&gt;&lt;br /&gt;&#x27;;
	return &quot;&lt;div style=&#x27;width:&quot; + this.width + &quot;px; height:20px; font-weight:bold;background-color: #336699;color:white&#x27;&gt;&quot; + html + &quot;&lt;/div&gt;&quot;;
};

PDBViewer.prototype.getBar = function() {
	/** For title **/
	return &quot;&lt;div style=&#x27;width:&quot; + this.width + &quot;px; height:20px; font-weight:bold;background-color: #336699;color:white&#x27;&gt;&lt;/div&gt;&quot;;
};

PDBViewer.prototype.refresh = function(models) {
	var _this = this;
	if (BUI.isWebGLEnabled()) {
		this.models = models;
//		var adapter = new BiosaxsDataAdapter();
		_this.panel.setLoading(&quot;Rendering&quot;);
//		adapter.onSuccess.attach(function(sender, data) {
//			if (data.models != null){
//				if (data.models[0] != null){
//					document.getElementById(_this.getTextAreaId()).innerHTML = data.models[0].XYZ;
//					if (_this.glMol == null) {
//						_this.glMol = new GLmol(_this.id);
//					} else {
//						_this.glMol.loadMolecule();
//					}
//				}
//			}
//			_this.panel.setLoading(false);
//		});
//		adapter.onError.attach(function(sender, data) {
//			_this.panel.setLoading(&quot;Not available&quot;);
//		});
//		adapter.getDataPDB(models, []);
//		
		var onSuccess = function(sender, data){
			if (data.models != null){
				if (data.models[0] != null){
					document.getElementById(_this.getTextAreaId()).innerHTML = data.models[0].XYZ;
					if (_this.glMol == null) {
						_this.glMol = new GLmol(_this.id);
					} else {
						_this.glMol.loadMolecule();
					}
				}
			}
			_this.panel.setLoading(false);
		};
		
//		adapter.onError.attach(function(sender, data) {
//			_this.panel.setLoading(&quot;Not available&quot;);
//		});
//		adapter.getDataPDB(models, []);
		EXI.getDataAdapter({onSuccess : onSuccess}).saxs.model.getPDB(models, []);
		
		
		
	} else {
		this.webGLNotAvailable();
	}
};

PDBViewer.prototype.getOpacity = function(text) {
	if (text == &#x27;Invisible&#x27;) {
		return &#x27;0&#x27;;
	}
	if (text == &#x27;Minimum&#x27;) {
		return &#x27;0.2&#x27;;
	}
	if (text == &#x27;Medium&#x27;) {
		return &#x27;0.5&#x27;;
	}
	if (text == &#x27;High&#x27;) {
		return &#x27;0.7&#x27;;
	}
	return &#x27;1&#x27;;
};

PDBViewer.prototype.getMenu = function(model) {
	var _this = this;
	function onItemCheck(comp, checked, eOpts) {
		if (checked) {
			var i = null;
			if (comp.group == &#x27;Opacity&#x27;) {
				for (i = 0; i &lt; _this.models.length; i++) {
					var opacity = _this.getOpacity(comp.text);
					model.opacity = opacity;
				}
			}

			if (comp.group == &#x27;Radius&#x27;) {
				for (i = 0; i &lt; _this.models.length; i++) {
					var radius = _this.getOpacity(comp.text);
					model.radius = radius;
				}
			}

			_this.refresh(_this.models);
		}
	}

	return Ext.create(&#x27;Ext.menu.Menu&#x27;, {
		items : [ {
			text : &#x27;Opacity&#x27;,
			menu : {
				items : [ {
					text : &#x27;Invisible&#x27;,
					checked : false,
					group : &#x27;Opacity&#x27;,
					checkHandler : onItemCheck
				}, {
					text : &#x27;Minimum&#x27;,
					checked : false,
					group : &#x27;Opacity&#x27;,
					checkHandler : onItemCheck
				}, {
					text : &#x27;Medium&#x27;,
					checked : false,
					group : &#x27;Opacity&#x27;,
					checkHandler : onItemCheck
				}, {
					text : &#x27;High&#x27;,
					checked : false,
					group : &#x27;Opacity&#x27;,
					checkHandler : onItemCheck
				}, {
					text : &#x27;Opaque&#x27;,
					checked : false,
					group : &#x27;Opacity&#x27;,
					checkHandler : onItemCheck
				} ]
			}
		}

		]
	});
};

PDBViewer.prototype.getTbar = function() {
	var _this = this;

	var tb = Ext.create(&#x27;Ext.toolbar.Toolbar&#x27;);

	var colorItems = [];
	for (var i = 0; i &lt; this.models.length; i++) {
		tb.add({
			text : this.models[i].title,
			menu : this.getMenu(this.models[i])
		});
		var color = &quot;#&quot; + this.models[i].color.replace(&quot;0x&quot;, &quot;&quot;);
		colorItems.push({
			html : &quot;&lt;table&gt;&lt;tr&gt;&lt;td width=&#x27;15px&#x27;&gt;&quot; + BUI.getRectangleColorDIV(color, 10, 10) + &quot;&lt;/td&gt;&lt;td&gt;&quot; + this.models[i].title + &quot;&lt;/td&gt;&lt;/table&gt;&quot;
		});
	}

	tb.add({
		xtype : &#x27;numberfield&#x27;,
		labelWidth : 50,
		width : 120,
		fieldLabel : &#x27;Radius&#x27;,
		value : 3,
		maxValue : 10,
		step : 0.2,
		minValue : 0.1,
		listeners : {
			change : function(cmp) {
				var radius = cmp.getValue();
				for (var i = 0; i &lt; _this.models.length; i++) {
					_this.models[i].radius = radius;
				}
				_this.refresh(_this.models);
			}
		}
	});
	tb.add(&quot;-&gt;&quot;);
	tb.add(colorItems);
	return tb;
};

PDBViewer.prototype.getPanel = function() {
	var _this = this;
	this.panel = Ext.create(&#x27;Ext.panel.Panel&#x27;, {
		margin : this.margin,
		border : 0,
		layout : {
			type : &#x27;vbox&#x27;
		},
		width : this.width - 4,
		height : this.height + 30,
		items : [ {
			html : this.getCanvas()
		} ],
		listeners : {
			afterRender : function() {
			}
		}
	});

	this.panel.setLoading(&quot;Rendering&quot;);
	return this.panel;
};

PDBViewer.prototype.webGLNotAvailable = function() {
	document.getElementById(_this.id).innerHTML = BUI.getWarningHTML(&quot;Your browser doesn&#x27;t support WebGL&quot;);
	document.getElementById(_this.id).innerHTML = document.getElementById(_this.id).innerHTML + &quot;&lt;br /&gt;&quot;;
	document.getElementById(_this.id).innerHTML = document.getElementById(_this.id).innerHTML
			+ BUI.getTipHTML(&quot;&lt;a href=&#x27;http://www.browserleaks.com/webgl#howto-enable-disable-webgl&#x27;&gt;How to enable WebGL&lt;/a&gt;&quot;);
	document.getElementById(_this.id).innerHTML = document.getElementById(_this.id).innerHTML + &quot;&lt;br /&gt;&quot;;
	document.getElementById(_this.id).innerHTML = document.getElementById(_this.id).innerHTML + BUI.getTipHTML(&quot;&lt;a href=&#x27;http://caniuse.com/webgl&#x27;&gt;Can I use WebGL?&lt;/a&gt;&quot;);
};

/** Deprecated **/
PDBViewer.prototype.draw = function(models) {
	this.models = models;
	var _this = this;
	this.panel = Ext.create(&#x27;Ext.panel.Panel&#x27;, {
		margin : 2,
		layout : {
			type : &#x27;vbox&#x27;
		},
		tbar : this.getTbar(),
		width : this.width - 4,
		height : this.height + 30,
		items : [ {
			html : this.getCanvas()
		}

		],
		listeners : {
			afterRender : function() {
				_this.refresh(models);
			}
		}
	});

	this.panel.setLoading(&quot;Rendering&quot;);
	return this.panel;
};

SuperpositionPDBViewer.prototype.draw = PDBViewer.prototype.draw;
SuperpositionPDBViewer.prototype.getBar = PDBViewer.prototype.getBar;
SuperpositionPDBViewer.prototype.getCanvas = PDBViewer.prototype.getCanvas;
SuperpositionPDBViewer.prototype.getDownload = PDBViewer.prototype.getDownload;
SuperpositionPDBViewer.prototype.getMenu = PDBViewer.prototype.getMenu;
SuperpositionPDBViewer.prototype.getOpacity = PDBViewer.prototype.getOpacity;
SuperpositionPDBViewer.prototype.getPanel = PDBViewer.prototype.getPanel;
SuperpositionPDBViewer.prototype.getTbar = PDBViewer.prototype.getTbar;
SuperpositionPDBViewer.prototype.getTextAreaId = PDBViewer.prototype.getTextAreaId;
SuperpositionPDBViewer.prototype.getTitle = PDBViewer.prototype.getTitle;
SuperpositionPDBViewer.prototype.refresh = PDBViewer.prototype.refresh;
SuperpositionPDBViewer.prototype.webGLNotAvailable = PDBViewer.prototype.webGLNotAvailable;

function SuperpositionPDBViewer(args) {
	this.width = 550;
	this.height = 500;
	if (args != null) {
		if (args.actions != null) {
			this.actions = args.actions;
		}
	}

	var _this = this;
	this.form = new BufferForm();
	this.onSuccess = new Event();
	PDBViewer.prototype.constructor.call(this, args);
};

SuperpositionPDBViewer.prototype.refresh = function(superpositions) {
	var _this = this;
	if (BUI.isWebGLEnabled()) {
		this.models = superpositions;
		var adapter = new BiosaxsDataAdapter();
		_this.panel.setLoading(&quot;Rendering&quot;);
		adapter.onSuccess.attach(function(sender, data) {
			document.getElementById(_this.getTextAreaId()).innerHTML = data.XYZ;
			if (_this.glMol == null) {
				_this.glMol = new GLmol(_this.id);
			} else {
				_this.glMol.loadMolecule();
			}
			_this.panel.setLoading(false);
		});
		adapter.onError.attach(function(sender, data) {
			_this.panel.setLoading(&quot;Not available&quot;);
		});
		adapter.getAbinitioPDBContentBySuperpositionList(superpositions);
	} else {
		this.webGLNotAvailable();
	}
};




AlignedSuperpositionPDBViewer.prototype.draw = PDBViewer.prototype.draw;
AlignedSuperpositionPDBViewer.prototype.getBar = PDBViewer.prototype.getBar;
AlignedSuperpositionPDBViewer.prototype.getCanvas = PDBViewer.prototype.getCanvas;
AlignedSuperpositionPDBViewer.prototype.getDownload = PDBViewer.prototype.getDownload;
AlignedSuperpositionPDBViewer.prototype.getMenu = PDBViewer.prototype.getMenu;
AlignedSuperpositionPDBViewer.prototype.getOpacity = PDBViewer.prototype.getOpacity;
AlignedSuperpositionPDBViewer.prototype.getPanel = PDBViewer.prototype.getPanel;
AlignedSuperpositionPDBViewer.prototype.getTbar = PDBViewer.prototype.getTbar;
AlignedSuperpositionPDBViewer.prototype.getTextAreaId = PDBViewer.prototype.getTextAreaId;
AlignedSuperpositionPDBViewer.prototype.getTitle = PDBViewer.prototype.getTitle;
AlignedSuperpositionPDBViewer.prototype.refresh = PDBViewer.prototype.refresh;
AlignedSuperpositionPDBViewer.prototype.webGLNotAvailable = PDBViewer.prototype.webGLNotAvailable;

function AlignedSuperpositionPDBViewer(args) {
	this.width = 550;
	this.height = 500;
	if (args != null) {
		if (args.actions != null) {
			this.actions = args.actions;
		}
	}

	var _this = this;
	this.form = new BufferForm();
	this.onSuccess = new Event();
	PDBViewer.prototype.constructor.call(this, args);
};

AlignedSuperpositionPDBViewer.prototype.refresh = function(superpositions) {
	var _this = this;
	if (BUI.isWebGLEnabled()) {
		this.models = superpositions;
		
		_this.panel.setLoading(&quot;Rendering PDB&quot;);
		

		var adapter = new BiosaxsDataAdapter();
		adapter.onError.attach(function(sender, pdbContent){
			console.log(sender);
		});
		adapter.onSuccess.attach(function(sender, data){
			var superposition = data.superpositions[0][superpositions[0]];
			document.getElementById(_this.id).innerHTML = &quot;&quot;;
			_this.glMol = new GLmol(_this.id, false, false, superposition.apriori.data);
			_this.glMol.addSuperpositionXYZ(superposition.aligned.XYZ, &quot;0xFFFFFF&quot;, 0.3, 1);
			
			var view = _this.glMol.getView();
			_this.glMol.setView(view);
   
			
			_this.panel.setLoading(false);
		});
		if (superpositions != null){
			if (superpositions.length != 0){
				adapter.getDataPDB([], superpositions);
			}
		}
		
		
		
	} else {
		this.webGLNotAvailable();
	}
};







StructurePDBViewer.prototype.draw = PDBViewer.prototype.draw;
StructurePDBViewer.prototype.getBar = PDBViewer.prototype.getBar;
StructurePDBViewer.prototype.getCanvas = PDBViewer.prototype.getCanvas;
StructurePDBViewer.prototype.getDownload = PDBViewer.prototype.getDownload;
StructurePDBViewer.prototype.getMenu = PDBViewer.prototype.getMenu;
StructurePDBViewer.prototype.getOpacity = PDBViewer.prototype.getOpacity;
StructurePDBViewer.prototype.getPanel = PDBViewer.prototype.getPanel;
StructurePDBViewer.prototype.getTbar = PDBViewer.prototype.getTbar;
StructurePDBViewer.prototype.getTextAreaId = PDBViewer.prototype.getTextAreaId;
StructurePDBViewer.prototype.getTitle = PDBViewer.prototype.getTitle;
StructurePDBViewer.prototype.refresh = PDBViewer.prototype.refresh;
StructurePDBViewer.prototype.webGLNotAvailable = PDBViewer.prototype.webGLNotAvailable;

function StructurePDBViewer(args) {
	this.width = 550;
	this.height = 500;
	if (args != null) {
		if (args.actions != null) {
			this.actions = args.actions;
		}
	}

	var _this = this;
	this.form = new BufferForm();
	this.onSuccess = new Event();
	PDBViewer.prototype.constructor.call(this, args);
};

StructurePDBViewer.prototype.refresh = function(structures) {
	var _this = this;
	if (BUI.isWebGLEnabled()) {
		this.models = structures;
		_this.panel.setLoading(&quot;Rendering&quot;);
		
		var adapter = new BiosaxsDataAdapter();
		adapter.onSuccess.attach(function(sender, pdbContent){
			document.getElementById(_this.getTextAreaId()).innerHTML = pdbContent;
			var glmol02 = new GLmol(_this.id);
			
			_this.panel.setLoading(false);
		});
		adapter.onError.attach(function(sender, data) {
			_this.panel.setLoading(&quot;Not available&quot;);
		});
		adapter.getDataPDB(models, []);
	} else {
		this.webGLNotAvailable();
	}
};
    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
