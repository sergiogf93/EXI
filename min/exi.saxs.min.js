function Exi(a){var b=this;if(this.headerCssClass="titlePanel",this.mainMenu=new MainMenu,this.anonymousMenu=null,this.userMenu=null,this.keepTabs=!1,this.controllers=[new ExiController,new ProposalExiController,new ShippingExiController],null!=a&&(null!=a.menu&&(this.mainMenu=a.menu,this.userMenu=a.menu),null!=a.anonymousMenu&&(this.anonymousMenu=a.anonymousMenu),null!=a.headerCssClass&&(this.headerCssClass=a.headerCssClass),null!=a.controllers))for(var c=0;c<a.controllers.length;c++)this.controllers.push(a.controllers[c]);this.mainStatusBar=new MainStatusBar,this.proposalManager=new ProposalManager,this.credentialManager=new CredentialManager,this.credentialManager.onLogout.attach(function(a){b.mainMenu.populateCredentialsMenu(),b.clearMainPanel(),b.clearNavigationPanel(),b.setAnonymousMenu(),Ext.getCmp("navigation").collapse(),location.hash="/welcome"}),this.credentialManager.onLogin.attach(function(a){b.mainMenu.populateCredentialsMenu(),b.setUserMenu()}),this.credentialManager.onActiveProposalChanged.attach(function(a){b.mainMenu.populateCredentialsMenu()}),this.authenticationForm=new AuthenticationForm,this.authenticationForm.onAuthenticate.attach(function(a,c){var d=new AuthenticationManager;d.onSuccess.attach(function(a,d){b.credentialManager.addCredential(d.user,d.roles,d.token,c.site,c.exiUrl,c.properties),b.authenticationForm.window.close();var e=EXI.credentialManager.getCredentialByUserName(d.user);e.isManager()||e.isLocalContact()?location.hash="/welcome/manager/"+d.user+"/main":location.hash="/welcome/user/"+d.user+"/main",b.getDataAdapter().exi.offline.authenticate()}),d.onError.attach(function(a,b){alert("error")}),d.login(c.user,c.password,c.site)}),this.onAfterRender=new Event(this)}function MainStatusBar(){}function ProposalManager(){this.onActiveProposalChanged=new Event(this)}function ExiGenericController(){this.init()}function AuthenticationManager(){this.onSuccess=new Event(this),this.onError=new Event(this)}function ExiController(){this.init()}function ExiGenericController(){this.init()}function LabContactExiController(){this.init()}function OfflineExiController(){this.init()}function ProposalExiController(){this.init()}function SessionController(){this.init()}function ShippingExiController(){this.init()}function MainMenu(a){this.id=BUI.id(),this.loginButtonId="loginButton"+this.id,this.cssClass="mainMenu",this.isHidden=!0,null!=a&&(null!=a.cssClass&&(this.cssClass=a.cssClass),null!=a.isHidden&&(this.isHidden=a.isHidden))}function ListView(){this.width=250,this.height=Ext.getBody().getHeight()-215,this.onSelect=new Event}function RunListView(){this.sorters=[],ListView.call(this)}function SessionListView(){this.sorters=[{property:"sessionId",direction:"DESC"}],ListView.call(this)}function ShippingListView(){this.sorters=[{property:"sessionId",direction:"DESC"}],ListView.call(this)}function WorkSpaceListView(){this.width=250,this.height=800,this.selectionMenu=new SelectionMenu,this.onSelect=new Event,this.projectId=null}function Credential(a,b,c,d,e,f,g,h){this.username=a.toLowerCase(),this.roles=b,this.url=d,this.exiUrl=e,this.token=c,this.activeProposals=f,this.tokenExpires=g,this.properties=h}function CredentialManager(){this.onLogin=new Event(this),this.onLogout=new Event(this),this.onActiveProposalChanged=new Event(this)}function MainView(a){this.id=BUI.id(),this.title="New Tab",this.closable=!0,this.onSelectionChange=new Event(this),this.onSelect=new Event(this),this.onDeselect=new Event(this),null!=a&&null!=a.title&&(this.title=a.title)}function AddressMainView(){this.icon="../images/icon/contacts.png",this.queueGridList=[],MainView.call(this),this.addressForm=new AddressForm,this.onSelect=new Event(this),this.onDeselect=new Event(this)}function ManagerWelcomeMainView(){this.icon="../images/icon/rsz_ic_home_black_24dp.png",MainView.call(this),this.title="Home",this.closable=!1,this.sessionGrid=new SessionGrid({width:null,height:600,isHiddenTitle:!0,isHiddenPI:!1,isHiddenNumberOfShifts:!1,isHiddenLocalContact:!1,margin:"10 10 10 10"}),this.proposalGrid=new ProposalGrid({width:900,height:600,margin:"10 10 10 10"})}function RunMainView(){this.id=BUI.id(),MainView.call(this)}function DimpleRunMainView(){this.title="Experiment",this.icon="images/icon/ic_satellite_black_18dp.png",this.queueGridList=[],this.id=BUI.id(),RunMainView.call(this)}function SessionMainView(a){this.icon="images/icon/ic_satellite_black_18dp.png",MainView.call(this,a);this.sessionGrid=new SessionGrid({width:700,height:598,margin:"0 0 0 20",title:"Click on calendar to see the sessions"})}function CaseForm(a){this.id=BUI.id(),this.width=600,this.showTitle=!0,null!=a&&null!=a.showTitle&&(this.showTitle=a.showTitle),this.onSaved=new Event(this)}function ContainerSpreadSheet(a){this.id=BUI.id(),this.height=380,this.width=500,null!=a&&(null!=a.height&&(this.height=a.height),null!=a.width&&(this.width=a.width)),this.onModified=new Event(this)}function ParcelGrid(a){this.height=100,this.btnEditVisible=!0,this.btnRemoveVisible=!0,null!=a&&(null!=a.height&&(this.height=a.height),null!=a.btnEditVisible&&(this.btnEditVisible=a.btnEditVisible),null!=a.btnRemoveVisible&&(this.btnRemoveVisible=a.btnRemoveVisible)),this.onSuccess=new Event(this),this.onAdd=new Event(this),this.onRemove=new Event(this)}function PuckForm(a){this.id=BUI.id(),this.height=500,this.width=500,null!=a&&(null!=a.height&&(this.height=a.height),null!=a.width&&(this.width=a.width));this.containerSpreadSheet=new ContainerSpreadSheet({width:1300}),this.onSaved=new Event(this)}function ShipmentForm(a){this.id=BUI.id(),null!=a&&null!=a.creationMode&&(this.creationMode=a.creationMode),this.onSaved=new Event(this)}function ShippingMainView(){MainView.call(this);this.shipmentForm=new ShipmentForm,this.shipmentForm.onSaved.attach(function(a,b){location.hash="#/proposal/shipping/nav?nomain"}),this.parcelGrid=new ParcelGrid({height:300})}function WelcomeMainView(){this.icon="../images/icon/rsz_ic_home_black_24dp.png",MainView.call(this),this.title="Welcome",this.closable=!0}function AuthenticationForm(){this.onAuthenticate=new Event(this)}function CurvePlotter(a){this.id=BUI.id(),this.backgroundColor="#FFFFFF",this.margin="0 0 0 5",this.ruleColor="black",this.targetId="plotCanvas"+BUI.id(),this.legend="onmouseover",null!=a&&(null!=a.margin&&(this.margin=a.margin),null!=a.legend&&(this.legend=a.legend),null!=a.targetId&&(this.targetId=a.targetId)),this.onRendered=new Event(this),this.onPointClickCallback=new Event}function AutoProcIntegrationCurvePlotter(a){CurvePlotter.call(this,a),this.margin="10 0 0 0",this.height=null,this.title="",null!=a&&(null!=a.height&&(this.height=a.height),null!=a.title&&(this.title=a.title)),this.data={labels:[],data:[]},this.xLabels=[]}function ParcelPanel(a){this.id=BUI.id(),this.height=500,this.width=500,this.isSaveButtonHidden=!1,this.isHidden=!1,null!=a&&(null!=a.height&&(this.height=a.height),null!=a.width&&(this.width=a.width)),this.onSavedClick=new Event(this)}function ProposalGrid(a){this.height=500,this.tbar=!1,this.id=BUI.id(),this.margin="0 0 0 0",null!=a&&(null!=a.height&&(this.height=a.height),null!=a.searchBar&&(this.searchBar=a.searchBar),null!=a.tbar&&(this.tbar=a.tbar),null!=a.collapsed&&(this.collapsed=a.collapsed),null!=a.width&&(this.width=a.width),null!=a.margin&&(this.margin=a.margin)),this.onSelected=new Event(this)}function SessionGrid(a){this.height=500,this.tbar=!1,this.id=BUI.id(),this.width=null,this.title=null,this.margin=10,this.hiddenGoColumn=!0,this.isHiddenTitle=!0,this.isHiddenNumberOfShifts=!0,this.isHiddenPI=!0,this.isHiddenLocalContact=!0,this.layout="fit",this.beamlineFilter=[],null!=a&&(null!=a.isHiddenLocalContact&&(this.isHiddenLocalContact=a.isHiddenLocalContact),null!=a.isHiddenNumberOfShifts&&(this.isHiddenNumberOfShifts=a.isHiddenNumberOfShifts),null!=a.width&&(this.width=a.width),null!=a.isHiddenTitle&&(this.isHiddenTitle=a.isHiddenTitle),null!=a.isHiddenPI&&(this.isHiddenPI=a.isHiddenPI),null!=a.title&&(this.title=a.title),null!=a.margin&&(this.margin=a.margin),null!=a.height&&(this.height=a.height),null!=a.tbar&&(this.tbar=a.tbar),null!=a.width&&(this.width=a.width,this.layout=null),null!=a.hiddenGoColumn&&(this.hiddenGoColumn=a.hiddenGoColumn)),this.onSelected=new Event(this)}function SAXSExiController(){this.init()}function ExiSAXS(){Exi.call(this,{menu:new SAXSMainMenu,anonymousMenu:new MainMenu,controllers:[new SAXSExiController,new OfflineExiController,new ProposalExiController,new SessionController,new LabContactExiController]})}function SAXSMainMenu(){this.id=BUI.id(),MainMenu.call(this,{isHidden:!1,cssClass:"mainMenu"})}function AddressListView(){this.title="Addresses",this.sorters=[{property:"cardName",direction:"ASC"}],ListView.call(this)}function BufferListView(){ListView.call(this)}function DataCollectionListView(){ListView.call(this)}function MacromoleculeListView(){this.sorters=[{property:"experimentId",direction:"DESC"}],ListView.call(this)}function SessionSaxsListView(){this.sorters=[{property:"experimentId",direction:"DESC"}],ListView.call(this)}function StockSolutionListView(){this.sorters=[{property:"experimentId",direction:"DESC"}],ListView.call(this)}function TemplateListView(){this.sorters=[{property:"experimentId",direction:"DESC"}],ListView.call(this)}function BufferMainView(){this.icon="images/icon/ic_satellite_black_18dp.png",this.queueGridList=[],MainView.call(this),this.bufferForm=new BufferForm({height:800,collapsed:!1,tbar:!0});this.onSelect=new Event(this),this.onDeselect=new Event(this)}function BufferWelcomeMainView(){this.icon="../images/icon/rsz_ic_home_black_24dp.png",MainView.call(this),this.title="Macromolecules",this.closable=!1}function DataCollectionMainView(){this.title="Experiment",this.icon="images/icon/ic_satellite_black_18dp.png",MainView.call(this),this.grid=new QueueGrid({positionColumnsHidden:!0,maxHeight:Ext.getCmp("main_panel").getHeight()-50,sorters:[{property:"macromoleculeAcronym",direction:"ASC"}]}),this.onSelect=new Event(this),this.onDeselect=new Event(this)}function DesignerMainView(){this.icon="images/icon/ic_satellite_black_18dp.png",this.queueGridList=[],MainView.call(this);this.wizardWidget=new WizardWidget({windowMode:!0,width:1200}),this.wizardWidget.onFinished.attach(function(a,b){EXI.setLoading();var c=function(a,b){location.hash="/experiment/templateId/"+b.experimentId+"/main"};EXI.getDataAdapter({onSuccess:c}).saxs.template.saveTemplate(b.name,b.comments,b.data)}),this.onSelect=new Event(this),this.onDeselect=new Event(this)}function ExperimentDesignerMainView(){this.icon="images/icon/ic_satellite_black_18dp.png",this.queueGridList=[],MainView.call(this),this.templateGrid=new TemplateGrid({minHeight:300,height:440,gridType:"Ext.grid.Panel",title:"Experiments",grouping:!1,tbar:!0}),this.onSelect=new Event(this),this.onDeselect=new Event(this)}function ExperimentMainView(){this.icon="images/icon/ic_satellite_black_18dp.png",MainView.call(this),this.experimentHeaderForm=new ExperimentHeaderForm;var a=this,b=Ext.create("Ext.data.Store",{fields:["name"],data:[{name:"low"},{name:"medium"},{name:"high"}]}),c=Ext.create("Ext.form.ComboBox",{fieldLabel:"",store:b,queryMode:"local",displayField:"name",valueField:"name"});this.specimenWidget=new SpecimenWidget({height:this.height,width:1200}),this.measurementGrid=new MeasurementGrid({height:600,minHeight:600,maxHeight:600,estimateTime:!1,positionColumnsHidden:!1,isPriorityColumnHidden:!0,isStatusColumnHidden:!1,addBtnEnable:!1,isTimeColumnHidden:!1,updateRowEnabled:!1,collapsed:!1,removeBtnEnabled:!1,showTitle:!1,collapseBtnEnable:!1,addBtnMultipleEdit:!1,sortingBtnEnable:!1,editor:{exposureTemperature:{xtype:"textfield",allowBlank:!0},comments:{xtype:"textfield",allowBlank:!0},volumeToLoad:{xtype:"numberfield",allowBlank:!0},transmission:{xtype:"numberfield",allowBlank:!0},viscosity:c,waitTime:{xtype:"numberfield",allowBlank:!0},flow:{xtype:"checkbox",allowBlank:!0}}}),this.measurementGrid.onMeasurementChanged.attach(function(b,c){a.experiment.setMeasurement(c),a.measurementGrid.loadExperiment(a.experiment),a.volumePlanificator.load(a.experiment)}),this.measurementGrid.onExperimentChanged.attach(function(b,c){a.experiment=new Experiment(c),a.measurementGrid.loadExperiment(a.experiment),a.specimenWidget.refresh(a.experiment),a.volumePlanificator.load(a.experiment)}),this.measurementGrid.onRemoved.attach(function(b,c){a.experiment=new Experiment(c[0]),a.specimenWidget.refresh(a.experiment),a.volumePlanificator.load(a.experiment)}),this.queueGrid=new QueueGrid({positionColumnsHidden:!0,sorters:[{property:"macromoleculeAcronym",direction:"ASC"}]})}function ExperimentWelcomeMainView(){this.icon="../images/icon/rsz_ic_home_black_24dp.png",MainView.call(this),this.title="Welcome",this.closable=!1}function HPLCMainView(){this.title="Experiment",this.icon="images/icon/ic_satellite_black_18dp.png",this.queueGridList=[],MainView.call(this),this.grid=new QueueGrid({collapsed:!0,positionColumnsHidden:!0,maxHeight:Ext.getCmp("main_panel").getHeight()-50,sorters:[{property:"macromoleculeAcronym",direction:"ASC"}]}),this.grid.onSelectionChange.attach(function(b,c){a.onSelectionChange.notify(c)}),this.grid.onSelect.attach(function(b,c){a.onSelect.notify(c)}),this.grid.onDeselect.attach(function(b,c){a.onDeselect.notify(c)});var a=this;a.annotations=[],a.selectedFrameNumber=[],this.hplcGraph=new HPLCGraph({title:"I0",width:800,height:350,bbar:!0,plots:{I0:!0,Rg:!0},xlabel:"HPLC Frames",scaled:!0,interactionModel:{dblclick:function(b,c,d){a.selectedFrameNumber.push(c.lastx_),a.plotter.loadHPLCFrame(a.experimentId,a.selectedFrameNumber),a.annotations.push({series:c.selPoints_[0].name,x:c.lastx_,width:30,height:23,tickHeight:2,shortText:c.lastx_,text:c.lastx_,attachAtBottom:!0}),c.setAnnotations(a.annotations)}}}),this.hplcGraph.onClearSelection.attach(function(b){a.annotations=[],a.selectedFrameNumber=[],a.hplcGraph.dygraphObject.dygraph.setAnnotations([])}),this.plotter=new CurvePlotter({margin:"10 0 0 0"}),this.onSelect=new Event(this),this.onDeselect=new Event(this)}function MacromoleculeMainView(){this.icon="../images/icon/macromolecule.png",this.queueGridList=[],MainView.call(this),this.macromoleculeForm=new MacromoleculeForm({height:800,collapsed:!1,tbar:!0}),this.rigidBodyModelingForm=new RigidBodyModelingForm({}),this.rigidBodyModelingForm.onSave.attach(function(a,b){});this.onSelect=new Event(this),this.onDeselect=new Event(this)}function MacromoleculeWelcomeMainView(){this.icon="../images/icon/rsz_ic_home_black_24dp.png",MainView.call(this),this.title="Macromolecules",this.closable=!1}function MergeMainView(){this.title="Primary Data View",this.icon="images/icon/ic_blur_on_black_18dp.png",this.queueGridList=[];var a=this;this.plotter=new CurvePlotter({}),this.formPopulated=!1,this.plotter.onRendered.attach(function(b){if(!a.formPopulated){for(var c={},d=1;d<b.getLabels().length;d++)c[b.getLabels()[d]]=b.getColors()[d-1];a.populateForm(b.getPointCount(),c),a.formPopulated=!0}plotter=b})}function PrimaryDataMainView(){this.title="Primary Data View",this.icon="images/icon/ic_blur_on_black_18dp.png",MainView.call(this),this.onMeasurementSelectionChange=new Event(this);var a=this;this.frameSelectorGrid=new FrameSelectorGrid,this.frameSelectorGrid.onSelectionChange.attach(function(b,c){a.plotter.load(c)}),this.plotter=new CurvePlotter({}),this.grid=new QueueGrid({maxHeight:300}),this.abinitioForm=new AbinitioForm({height:700})}function ShippingMainView(){MainView.call(this);var a=this;this.shipmentForm=new ShipmentForm,this.shipmentForm.onSaved.attach(function(a,b){location.hash="#/proposal/shipping/nav?nomain"}),this.caseGrid=new CaseGrid({height:300}),this.caseGrid.onRemove.attach(function(b,c){var d=function(b){a.load(a.shippingId),a.panel.setLoading(!1)};EXI.getDataAdapter({onSuccess:d}).proposal.dewar.removeDewar(a.shippingId,c.dewarId)})}function ShippingWelcomeMainView(){this.icon="../images/icon/rsz_ic_home_black_24dp.png",MainView.call(this),this.title="Welcome",this.closable=!1}function StockSolutionMainView(){this.icon="images/icon/ic_satellite_black_18dp.png",this.queueGridList=[],MainView.call(this),this.stockSolutionForm=new StockSolutionForm({minHeight:800,height:800,tbar:!0,showTitle:!0,isPackedVisible:!1,btnAddExisting:!1,btnRemoveVisible:!1,btnUnpackVisible:!1});var a=this;this.stockSolutionForm.onSaved.attach(function(b,c){var d=function(b,c){a.stockSolutionForm.load(EXI.proposalManager.getStockSolutionById(a.stockSolutionId)),a.panel.setLoading(!1)};a.panel.setLoading("Updading proposal information"),EXI.getDataAdapter({onSuccess:d}).proposal.proposal.update()}),this.onSelect=new Event(this),this.onDeselect=new Event(this)}function StockSolutionWelcomeMainView(){this.icon="../images/icon/rsz_ic_home_black_24dp.png",MainView.call(this),this.title="Macromolecules",this.closable=!1}function TemplateMainView(){this.icon="images/icon/ic_satellite_black_18dp.png",this.queueGridList=[],MainView.call(this),this.experimentHeaderForm=new ExperimentHeaderForm;var a=this,b=Ext.create("Ext.data.Store",{fields:["name"],data:[{name:"low"},{name:"medium"},{name:"high"}]}),c=Ext.create("Ext.form.ComboBox",{fieldLabel:"",store:b,queryMode:"local",displayField:"name",valueField:"name"});this.specimenWidget=new SpecimenWidget({height:this.height,width:1200}),this.measurementGrid=new MeasurementGrid({height:600,minHeight:600,maxHeight:600,estimateTime:!1,positionColumnsHidden:!0,isPriorityColumnHidden:!0,isStatusColumnHidden:!0,addBtnEnable:!0,isTimeColumnHidden:!0,updateRowEnabled:!0,collapsed:!0,removeBtnEnabled:!0,showTitle:!1,collapseBtnEnable:!1,addBtnMultipleEdit:!0,sortingBtnEnable:!0,editor:{exposureTemperature:{xtype:"textfield",allowBlank:!0},comments:{xtype:"textfield",allowBlank:!0},volumeToLoad:{xtype:"numberfield",allowBlank:!0},transmission:{xtype:"numberfield",allowBlank:!0},viscosity:c,waitTime:{xtype:"numberfield",allowBlank:!0},flow:{xtype:"checkbox",allowBlank:!0}}}),this.measurementGrid.onMeasurementChanged.attach(function(b,c){a.experiment.setMeasurement(c),a.measurementGrid.loadExperiment(a.experiment),a.volumePlanificator.load(a.experiment)}),this.measurementGrid.onExperimentChanged.attach(function(b,c){a.experiment=new Experiment(c),a.measurementGrid.loadExperiment(a.experiment),a.specimenWidget.refresh(a.experiment),a.volumePlanificator.load(a.experiment)}),this.measurementGrid.onRemoved.attach(function(b,c){a.experiment=new Experiment(c[0]),a.specimenWidget.refresh(a.experiment),a.volumePlanificator.load(a.experiment)}),this.volumePlanificator=new VolumeGrid}function AbinitioForm(a){this.id=BUI.id(),this.width=null,this.height=null,null!=a&&(null!=a.width&&(this.width=a.width),null!=a.height&&(this.height=a.height));var b=this;this.abinitioGrid=new AbinitioGrid({width:700,height:600}),this.abinitioGrid.onSelected.attach(function(a,c){var d=[];for(var e in c)d.push(c[e].modelId);b.curvePlotter.loadUrl(EXI.getDataAdapter().saxs.frame.getFramesURL([],[],[],[],[],d)),b._renderPDB(d)}),this.curvePlotter=new CurvePlotter({}),this.viewer=new PDBViewer({width:500,height:300})}function AbinitioGrid(a){this.height=null,this.width=null,this.id=BUI.id(),null!=a&&null!=a.height&&(this.height=a.height,null!=a.width&&(this.width=a.width)),this.onSelected=new Event(this)}function AddressForm(a){this.id=BUI.id(),this.height=500,this.width=500,this.isSaveButtonHidden=!1,this.isHidden=!1,null!=a&&(null!=a.height&&(this.height=a.height),null!=a.width&&(this.width=a.width),null!=a.isSaveButtonHidden&&(this.isSaveButtonHidden=a.isSaveButtonHidden),null!=a.isHidden&&(this.isHidden=a.isHidden))}function AprioriRigidBodyGrid(a){this.height=250,this.btnEditVisible=!0,this.btnRemoveVisible=!0,null!=a&&(null!=a.height&&(this.height=a.height),null!=a.btnEditVisible&&(this.btnEditVisible=a.btnEditVisible),null!=a.btnRemoveVisible&&(this.btnRemoveVisible=a.btnRemoveVisible)),this.onUploadFile=new Event(this),this.onRemove=new Event(this)}function AssemblyForm(a){this.id=BUI.id(),this.width=700,this.height=500,null!=a&&(null!=a.width&&(this.width=a.width),null!=a.height&&(this.height=a.height)),this.molarityGrid=new MolarityGrid({height:this.height-50})}function BufferForm(a){this.id=BUI.id(),this.height=500,this.width=500,null!=a&&(null!=a.height&&(this.height=a.height),null!=a.width&&(this.width=a.width)),this.onRemoveAdditive=new Event(this)}function BufferGrid(a){this.height=500,this.searchBar=!1,this.tbar=!1,this.collapsed=!1,this.id=BUI.id(),this.collapsible=!1,null!=a&&(null!=a.height&&(this.height=a.height),null!=a.searchBar&&(this.searchBar=a.searchBar),null!=a.tbar&&(this.tbar=a.tbar),null!=a.collapsed&&(this.collapsed=a.collapsed),null!=a.width&&(this.width=a.width)),this.onUpdated=new Event(this)}function CaseGrid(a){this.height=100,this.btnEditVisible=!0,this.btnRemoveVisible=!0,null!=a&&(null!=a.height&&(this.height=a.height),null!=a.btnEditVisible&&(this.btnEditVisible=a.btnEditVisible),null!=a.btnRemoveVisible&&(this.btnRemoveVisible=a.btnRemoveVisible)),this.onSuccess=new Event(this),this.onAdd=new Event(this),this.onRemove=new Event(this)}function DataReductionForm(a){this.id=BUI.id(),this.width=null,this.height=null,null!=a&&(null!=a.width&&(this.width=a.width),null!=a.height&&(this.height=a.height));this.plotWidget=new PlotWidget({width:650,height:490}),this.selectedItems={frames:[],averages:[],subtractions:[]}}function ExperimentGrid(a){this.width="100%",this.height=700,this.minHeight=500,this.id=BUI.id(),this.gridType="Ext.grid.Panel",this.tbar=!1,this.hideHeaders=!1,this.grouping=!0,this.title=null,this.filtered=null,this.limit=100,this.sessionIdFilter=null,this.date=null,this.sorters=[{property:"date",direction:"DESC"},{property:"time",direction:"DESC"}],this.dates={},null!=a&&(null!=a.height&&(this.height=a.height),null!=a.limit&&(this.limit=a.limit),null!=a.sorters&&(this.sorters=a.sorters),null!=a.sessionId&&(this.sessionIdFilter=a.sessionId),null!=a.filtered&&(this.filtered=a.filtered),null!=a.minHeight&&(this.minHeight=a.minHeight),null!=a.gridType&&(this.gridType=a.gridType),null!=a.tbar&&(this.tbar=a.tbar),null!=a.grouping&&(this.grouping=a.grouping),null!=a.width&&(this.width=a.width),null!=a.title&&(this.title=a.title)),this.onEditButtonClicked=new Event(this)}function ExperimentHeaderForm(a){this.id=BUI.id(),this.backgroundColor="#FFFFFF"}function FrameSelectorGrid(a){this.onSelectionChange=new Event(this)}function GenericStepWizardForm(a,b,c,d,e){this.id=BUI.id(),this.title=a,this.description=b,this.data=c,this.onNext=d,this.onBack=e}function HPLCGraph(a){this.width=600,this.height=600,this.title="",this.bbar=!1,this.plotInnerPanelPadding=10,this.plotPanelPadding=10,this.id=BUI.id(),this.hidePlots=null,this.xlabel="",this.scaled=!1,this.xParam=null,this.showRangeSelector=!0,this.interactionModel=null,this.ranges={},null!=a&&(null!=a.interactionModel&&(this.interactionModel=a.interactionModel),null!=a.width&&(this.width=a.width),null!=a.height&&(this.height=a.height),null!=a.bbar&&(this.bbar=a.bbar),null!=a.title&&(this.title=a.title),null!=a.plots&&(this.plots=a.plots),null!=a.scaled&&(this.scaled=a.scaled),null!=a.xlabel&&(this.xlabel=a.xlabel),null!=a.xParam&&(this.xParam=a.xParam),null!=a.showRangeSelector&&(this.showRangeSelector=a.showRangeSelector)),this.onZoomX=new Event(this),this.onResetZoom=new Event(this),this.dblclick=new Event(this),this.onClearSelection=new Event(this)}function MergesHPLCGraph(a){HPLCGraph.prototype.constructor.call(this,a),this.peakColors=["#DEBD00","#6D9100","#872900","#0092CC"]}function MacromoleculeForm(a){this.id=BUI.id(),this.width=700,this.height=700,null!=a&&(null!=a.width&&(this.width=a.width),null!=a.height&&(this.height=a.height)),this.onSave=new Event(this),this.onClose=new Event(this)}function MacromoleculeGrid(a){this.height=500,this.width=500,this.id=BUI.id(),this.maxHeight=this.height,this.searchBar=!1,this.tbar=!1,this.collapsible=!0,this.collapsed=!0,this.btnEditVisible=!0,this.btnRemoveVisible=!1,this.multiselect=!1,this.cssFontStyle=null,null!=a&&(null!=a.height&&(this.height=a.height,this.maxHeight=this.height),null!=a.maxHeight&&(this.maxHeight=a.maxHeight),null!=a.width&&(this.width=a.width),null!=a.cssFontStyle&&(this.cssFontStyle=a.cssFontStyle),null!=a.searchBar&&(this.searchBar=a.searchBar),null!=a.tbar&&(this.tbar=a.tbar),null!=a.collapsible&&(this.collapsible=a.collapsible),null!=a.collapsed&&(this.collapsed=a.collapsed),null!=a.btnEditVisible&&(this.btnEditVisible=a.btnEditVisible),null!=a.btnRemoveVisible&&(this.btnRemoveVisible=a.btnRemoveVisible),null!=a.multiselect&&(this.multiselect=a.multiselect)),this.onSelected=new Event,this.onMacromoleculesChanged=new Event}function MeasurementCreatorStepWizardForm(a,b,c){var d=this;this.height=700,this.noNext=!1,this.macromolecules=a,this.buffers=b,GenericStepWizardForm.call(this,"Define Measurements",{margin:"0 0 0 0",width:800,border:0,html:"Define only the macromolecule's measurement you want to make. This wizard will add <span style='font-weight:bold;'> buffers' measurement needed for substraction automatically. </span>"},{measurementsSelected:null},function(){var a={name:Ext.getCmp(d.id+"name").getValue(),comments:Ext.getCmp(d.id+"comments").getValue(),data:JSON.stringify(d.parseMeasurements(d.data.measurementsSelected))};d.onWizardFinished.notify(a)},function(){}),null!=c&&null!=c.noNext&&(this.noNext=c.noNext),this.noNext&&(this.onWizardFinished=new Event(this)),this.onWizardFinished=new Event(this)}function SampleAutomaticPositionFactory(a){this.samples=a}function MeasurementGrid(a){this.id=BUI.id(),this.height=500,this.width=900,this.maxWidth=1200,this.minHeight=500,this.unitsFontSize=9,this.title="Measurements",this.estimateTime=!1,this.collapsed=!0,this.tbar=!0,this.showTitle=!0,this.resizable=!0,this.updateRowEnabled=!0,this.isStatusColumnHidden=!0,this.isTimeColumnHidden=!0,this.removeBtnEnabled=!0,this.margin="10 10 0 10",this.height=250,this.maxHeight=250,this.collapsible=!1,this.addBtnEnable=!1,this.editor={comments:{xtype:"textfield",allowBlank:!0}},this.sorter=[{property:"priority",direction:"ASC"}],null!=a&&(null!=a.selModel&&(this.selModel=a.selModel),null!=a.removeBtnEnabled&&(this.removeBtnEnabled=a.removeBtnEnabled),null!=a.addBtnMultipleEdit&&(this.addBtnMultipleEdit=a.addBtnMultipleEdit),null!=a.collapsed&&(this.collapsed=a.collapsed),null!=a.resizable&&(this.resizable=a.resizable),null!=a.editor&&(this.editor=a.editor),null!=a.collapseBtnEnable&&(this.collapseBtnEnable=a.collapseBtnEnable),null!=a.addBtnEnable&&(this.addBtnEnable=a.addBtnEnable),null!=a.sortingBtnEnable&&(this.sortingBtnEnable=a.sortingBtnEnable),null!=a.isPriorityColumnHidden&&(this.isPriorityColumnHidden=a.isPriorityColumnHidden),null!=a.width&&(this.width=a.width),null!=a.updateRowEnabled&&(this.updateRowEnabled=a.updateRowEnabled),null!=a.showTitle&&(this.showTitle=a.showTitle,0==this.showTitle&&(this.title=null)),null!=a.height&&(this.height=a.height),null!=a.maxHeight&&(this.maxHeight=a.maxHeight),null!=a.minHeight&&(this.minHeight=a.minHeight),null!=a.maxWidth&&(this.maxWidth=a.maxWidth),null!=a.isStatusColumnHidden&&(this.isStatusColumnHidden=a.isStatusColumnHidden),null!=a.isTimeColumnHidden&&(this.isTimeColumnHidden=a.isTimeColumnHidden),null!=a.title&&(this.title=a.title),null!=a.estimateTime&&(this.estimateTime=a.estimateTime),null!=a.margin&&(this.margin=a.margin),null!=a.tbar&&(this.tbar=a.tbar),null!=a.sorter&&(this.sorter=a.sorter)),this.onRemoved=new Event(this),this.onMeasurementChanged=new Event(this),this.onExperimentChanged=new Event(this)}function MolarityForm(a){this.id=BUI.id(),this.width=700,this.height=500,null!=a&&(null!=a.width&&(this.width=a.width),null!=a.height&&(this.height=a.height)),this.onSave=new Event(this),this.onClose=new Event(this)}function MolarityGrid(a){this.height=100,this.width=100,null!=a&&(null!=a.height&&(this.height=a.height),null!=a.width&&(this.width=a.width));var b=this;this.molarityForm=new MolarityForm({height:180,width:455}),this.molarityForm.onSave.attach(function(a){b.molarityWindow.destroy(),b.updateProposal()}),this.molarityForm.onClose.attach(function(a){b.molarityWindow.destroy()}),this.onEditButtonClicked=new Event(this)}function DataSet(){this.json=null}function GraphCanvas(a,b,c){this.args={},this.targetID=b.id,this.id=a,this.args.idGraph=this.id+"main",this.args.idBackgroundNode=this.id+"background",this.args.idEdgesGraph=this.id+"edges",this.args.idNodesGraph=this.id+"vertices",this.args.idLabelGraph=this.id+"label",this.args.idBackground=this.id+"background",this.dataset=null,this.formatter=null,this.layout=null,this.circleDefaultRadius=2,this.squareDefaultSide=1.5*this.circleDefaultRadius,this.arrowDefaultSize=this.circleDefaultRadius,this.GraphGroup=null,this.GraphNodeGroup=null,this.GraphLabelGroup=null,this.GraphBackground=null,this.args.draggingCanvasEnabled=!1,this.args.multipleSelectionEnabled=!1,this.args.interactive=!1,this.args.labeled=!1,this.args.linkEnabled=!1,this.args.maxNumberEdgesMoving=3,this.args.maxNumberEdgesFiringEvents=50,this.args.linking=!1,this.linkStartX=0,this.linkStartY=0,this.linkSVGNode=null,this.linkNodeSource=null,this.linkNodeTarget=null,this.draggingElement=null,this.dragging=!1,this.nMouseOffsetX=0,this.nMouseOffsetY=0,this.dragStartX=0,this.dragStartY=0,this.desplazamientoX=0,this.desplazamientoY=0,this.selecting=!1,this.selectorX=null,this.selectorY=null,this.selectorSVGNode=null,this.args.isVertexSelected={},this.args.selectedVertices=[],this.args.isEdgeSelected={},null!=c&&(null!=c.multipleSelectionEnabled&&(this.args.multipleSelectionEnabled=c.multipleSelectionEnabled,this.args.draggingCanvasEnabled=!this.args.multipleSelectionEnabled),null!=c.draggingCanvasEnabled&&(this.args.draggingCanvasEnabled=c.draggingCanvasEnabled,this.args.multipleSelectionEnabled=!this.args.draggingCanvasEnabled),null!=c.interactive&&(this.args.interactive=c.interactive),null!=c.labeled&&(this.args.labeled=c.labeled)),this.svgLabels={},this.onVertexOut=new Event(this),this.onVertexOver=new Event(this),this.onVertexSelect=new Event(this),this.onEdgeSelect=new Event(this),this.onCanvasClicked=new Event(this),this.onVertexUp=new Event(this)}function GraphDataset(){DataSet.prototype.constructor.call(this),this.edges=new Object,this.vertices=new Object,this.verticesIndex=new Object,this.newVertex=new Event(this),this.vertexNameChanged=new Event(this),this.vertexDeleted=new Event(this),this.newEdge=new Event(this),this.edgeNameChanged=new Event(this),this.edgeDeleted=new Event(this),this.json=new Object,this.json.vertices=new Array,this.json.edges=new Array,this.json.relations=new Array}function labels(){var a=new Array,b=interactomeViewer.graphEditorWidget.dataset,c=interactomeViewer.graphEditorWidget.layout;for(var d in interactomeViewer.graphEditorWidget.dataset.getVertices())a.push(interactomeViewer.graphEditorWidget.dataset.getVertexById(d).getName());var e=a.sort();console.log(e);for(var f=.01,g=.6,h=0;h<a.length;h++){var i=b.getVertexByName(a[h]).getId();c.getNodeById(i).setCoordenates(f,g),f=parseFloat(f)+parseFloat(.03),g=parseFloat(g)+parseFloat(.02),.9800000000000003==parseFloat(g)&&(g=.6,f-=.51)}}function GraphItem(a,b,c){this.id=a,this.name=b,this.type="NONE",this.args=new Object,null!=c&&(this.args=c,null!=c.type&&(this.type=c.type)),this.nameChanged=new Event(this),this.deleted=new Event(this)}function ItemGraphFormatter(a,b,c,d,e){this.id=a,this.args=new Object,this.defaultFormat=new ItemFormat(b),null!=c?this.selected=new ItemFormat(c):this.selected=new ItemFormat(b),null!=d?this.over=new ItemFormat(d):this.over=new ItemFormat(b),null!=e?this.dragging=new ItemFormat(e):this.dragging=new ItemFormat(b),this.stateChanged=new Event(this);this._setEvents()}function ItemFormat(a){this.defaultFormat=new Object,this.args=new Object,this.args.title=new Object,this.args.visible=!0,this.args.hidden=!1,this.args.stroke="#000000",this.args.strokeOpacity=.8,this.args["stroke-width"]=1,this.args.fill="#000000",this.args["fill-opacity"]=1,this.args.size=1,this.args.opacity=1,
this.args.fontSize="8",this.args.fontColor="#000000",this.args.display="block",this.args.style="display:block",null!=a&&(null!=a.visible&&(this.args.visible=a.visible),null!=a.opacity&&(this.args.opacity=a.opacity),null!=a.size&&(this.args.size=a.size),null!=a.hidden&&(this.args.hidden=a.hidden),null!=a.stroke&&(this.args.stroke=this._fixColor(a.stroke)),null!=a.strokeOpacity&&(this.args.strokeOpacity=a.strokeOpacity),null!=a["stroke-width"]&&(this.args["stroke-width"]=a["stroke-width"]),null!=a["fill-opacity"]&&(this.args["fill-opacity"]=a["fill-opacity"]),null!=a.shape&&(this.args.shape=a.shape),null!=a.fill&&(this.args.fill=this._fixColor(a.fill)),null!=a.title&&(null!=a.title.fontSize&&(this.args.title.fontSize=a.title.fontSize),null!=a.title.fill&&(this.args.title.fill=this._fixColor(a.title.fill)))),this.changed=new Event}function LayoutDataset(){this.dataset=null,this.vertices=new Object,this.changed=new Event(this),this.args=new Object,this.args.type="CIRCLE"}function NodeLayout(a,b,c,d){this.id=a,this.x=b,this.y=c,this.changed=new Event(this)}function NetworkDataSetFormatter(a,b,c){DataSet.prototype.constructor.call(this),this.args=new Object,this.vertices=new Object,this.edges=new Object,this.dataset=null,this.maxClass=0,this.minClass=0,this.args.width=1100,this.args.height=500,this.args.backgroundColor="#FFFFFF",this.args.backgroundImage=null,this.args.backgroundImageHeight=null,this.args.backgroundImageWidth=null,this.args.backgroundImageX=null,this.args.backgroundImageY=null,this.args.balanceNodes=!1,this.args.nodesMaxSize=3,this.args.nodesMinSize=.5,this.args.zoomScale=1,this.args.zoomScaleStepFactor=.4,null!=c&&(null!=c.backgroundImage&&(this.args.backgroundImage=c.backgroundImage),null!=c.width&&(this.args.width=c.width),null!=c.height&&(this.args.height=c.height,this.args.svgHeight=c.height),null!=c.svgHeight&&(this.args.svgHeight=c.svgHeight),null!=c.backgroundColor&&(this.args.backgroundColor=c.backgroundColor),null!=c.balanceNodes&&(this.args.balanceNodes=c.balanceNodes),null!=c.nodesMaxSize&&(this.args.nodesMaxSize=c.nodesMaxSize),null!=c.nodesMinSize&&(this.args.nodesMinSize=c.nodesMinSize)),this.args.defaultEdgeProperties={fill:"#000000",radius:"1",stroke:"#000000",size:1,title:{fontSize:10,fontColor:"#000000"}},this.args.vertexFormatProperties={fill:"#000000",stroke:"#000000","stroke-opacity":"#000000"},null!=a&&(this.args.vertexFormatProperties=a),null!=b&&(this.args.defaultEdgeProperties=b),this.changed=new Event(this),this.edgeChanged=new Event(this),this.resized=new Event(this),this.backgroundImageChanged=new Event(this),this.backgroundColorChanged=new Event(this)}function NetworkWidget(a){this.id="NetworkViewer_"+Math.random().toString().replace(".","_"),this.label=!0,null!=a&&(null!=a.targetId&&(this.targetId=a.targetId),null!=a.label&&(this.label=a.label)),this.onVertexOver=new Event(this),this.onVertexOut=new Event(this)}function Vertex(a,b,c){GraphItem.prototype.constructor.call(this,a,b,c),this.edgesIn=new Array,this.edgesOut=new Array}function VertexGraphFormatter(a,b,c,d){ItemGraphFormatter.prototype.constructor.call(this,a,b,c,d)}function CircleVertexGraphFormatter(a,b,c,d,e){VertexGraphFormatter.prototype.constructor.call(this,a,b,c,d,e),this.args.type="CircleVertexGraphFormatter",null!=b&&null!=b.radius&&(this.defaultFormat.args.radius=b.radius),null!=c&&null!=c.radius&&(this.selected.args.radius=c.radius),null!=d&&null!=d.radius&&(this.over.args.radius=d.radius),null!=e&&null!=e.radius&&(this.dragging.args.draggingFormat=e.radius)}function SquareVertexGraphFormatter(a,b,c,d,e){VertexGraphFormatter.prototype.constructor.call(this,a,b,c,d,e),this.args.type="SquareVertexGraphFormatter",null!=b&&null!=b.radius&&(this.defaultFormat.args.radius=b.radius),null!=c&&null!=c.radius&&(this.selected.args.radius=c.radius),null!=d&&null!=d.radius&&(this.over.args.radius=d.radius),null!=e&&null!=e.radius&&(this.dragging.args.draggingFormat=e.radius)}function EllipseVertexGraphFormatter(a,b,c,d,e){VertexGraphFormatter.prototype.constructor.call(this,a,b,c,d,e),this.args.type="EllipseVertexGraphFormatter",null!=b&&null!=b.radius&&(this.defaultFormat.args.radius=b.radius),null!=c&&null!=c.radius&&(this.selected.args.radius=c.radius),null!=d&&null!=d.radius&&(this.over.args.radius=d.radius),null!=e&&null!=e.radius&&(this.dragging.args.draggingFormat=e.radius)}function RectangleVertexGraphFormatter(a,b,c,d,e){VertexGraphFormatter.prototype.constructor.call(this,a,b,c,d,e),this.args.type="RectangleVertexGraphFormatter",null!=b&&null!=b.radius&&(this.defaultFormat.args.radius=b.radius),null!=c&&null!=c.radius&&(this.selected.args.radius=c.radius),null!=d&&null!=d.radius&&(this.over.args.radius=d.radius),null!=e&&null!=e.radius&&(this.dragging.args.draggingFormat=e.radius)}function RoundedVertexGraphFormatter(a,b,c,d,e){VertexGraphFormatter.prototype.constructor.call(this,a,b,c,d,e),this.args.type="RoundedVertexGraphFormatter",null!=b&&null!=b.radius&&(this.defaultFormat.args.radius=b.radius),null!=c&&null!=c.radius&&(this.selected.args.radius=c.radius),null!=d&&null!=d.radius&&(this.over.args.radius=d.radius),null!=e&&null!=e.radius&&(this.dragging.args.draggingFormat=e.radius)}function OctagonVertexGraphFormatter(a,b,c,d,e){VertexGraphFormatter.prototype.constructor.call(this,a,b,c,d,e),this.args.type="OctagonVertexGraphFormatter",null!=b&&null!=b.radius&&(this.defaultFormat.args.radius=b.radius),null!=c&&null!=c.radius&&(this.selected.args.radius=c.radius),null!=d&&null!=d.radius&&(this.over.args.radius=d.radius),null!=e&&null!=e.radius&&(this.dragging.args.draggingFormat=e.radius)}function PDBViewer(a){this.id=BUI.id(),this.glMol=null,this.width=600,this.height=600,this.title="",this.margin="10 0 0 5",null!=a&&(null!=a.width&&(this.width=a.width),null!=a.height&&(this.height=a.height),null!=a.title&&(this.title=a.title),null!=a.margin&&(this.margin=a.margin))}function SuperpositionPDBViewer(a){this.width=550,this.height=500,null!=a&&null!=a.actions&&(this.actions=a.actions);this.form=new BufferForm,this.onSuccess=new Event,PDBViewer.prototype.constructor.call(this,a)}function AlignedSuperpositionPDBViewer(a){this.width=550,this.height=500,null!=a&&null!=a.actions&&(this.actions=a.actions);this.form=new BufferForm,this.onSuccess=new Event,PDBViewer.prototype.constructor.call(this,a)}function StructurePDBViewer(a){this.width=550,this.height=500,null!=a&&null!=a.actions&&(this.actions=a.actions);this.form=new BufferForm,this.onSuccess=new Event,PDBViewer.prototype.constructor.call(this,a)}function QueueGrid(a){this.decimals=3,this.onSelect=new Event,this.maxHeight=600,this.id=BUI.id(),this.title="Data Collections",this.key={},this.selectionMode="MULTI",this.collapsible=!0,this.collapsed=!1;var b=this;this.filters=[function(a){return null==a.data.dataCollectionId?!1:(null==b.key[a.data.dataCollectionId]&&(b.key[a.data.dataCollectionId]=[]),b.key[a.data.dataCollectionId].push(a.data),null!=a.data.macromoleculeId)}],null!=a&&(null!=a.maxHeight&&(this.maxHeight=a.maxHeight),null!=a.collapsible&&(this.collapsible=a.collapsible),null!=a.collapsed&&(this.collapsed=a.collapsed),null!=a.selectionMode&&(this.selectionMode=a.selectionMode),null!=a.title&&0==a.title&&(this.title=null)),this.selected=[],this.onSelectionChange=new Event,this.onDeselect=new Event(this),this.onSelect=new Event(this)}function RigidModelGrid(a){this.height=null,this.width=null,this.id=BUI.id(),null!=a&&null!=a.height&&(this.height=a.height,null!=a.width&&(this.width=a.width)),this.onSelected=new Event(this)}function RigidBodyModelingForm(a){this.id=BUI.id(),this.width=700,this.height=500,null!=a&&(null!=a.width&&(this.width=a.width),null!=a.height&&(this.height=a.height));var b=this;this.rigidBodyGrid=new AprioriRigidBodyGrid,this.rigidBodyGrid.onUploadFile.attach(function(a,c,d){b.openUploadManager(EXI.getDataAdapter().saxs.macromolecule.getAddPDBURL(b.macromolecule.macromoleculeId))}),this.rigidBodyGrid.onRemove.attach(function(a,c,d){b._update()}),this.onSave=new Event(this)}function SamplePlateGroupWidget(a){this.id=BUI.id(),this.width=900,this.height=300,this.titleTypePlate=20,this.margin=0,this.samplePlateWidgets=[],this.bbar=!1,this.border=1,this.showTitle=!0,this.title=null,this.nodeSize=8,null!=a&&(null!=a.margin&&(this.margin=a.margin),null!=a.bbar&&(this.bbar=a.bbar),null!=a.showTitle&&(this.showTitle=a.showTitle,this.showTitle&&(this.title="Plates Groups")),null!=a.border&&(this.border=a.border),null!=a.height&&(this.height=a.height)),this.heightPlates=this.height-this.titleTypePlate-60,this.onClick=new Event(this),this.onExperimentChanged=new Event(this)}function SamplePlateWidget(a){this.actions=[],this.width="1",this.height="1",this.legendFontSize=7,this.backgroundColor="#E6E6E6",this.wellColor="#FFFFFF ",this.id=BUI.id(),this.notSupportedMessage="IE doesn't support HTML5 features",this.nodeSize=14,this.fontSize=10,this.strokeWidth=2,this.showTooltip=!0,this.showBorderLabels=!0,this.showFullName=!1,this.showLabels=!1,null!=a&&(null!=a.showBorderLabels&&(this.showBorderLabels=a.showBorderLabels),null!=a.showLabels&&(this.showLabels=a.showLabels),null!=a.width&&(this.width=a.width),null!=a.height&&(this.height=a.height),null!=a.nodeSize&&(this.nodeSize=a.nodeSize),null!=a.notSupportedMessage&&(this.notSupportedMessage=a.notSupportedMessage),null!=a.fontSize&&(this.fontSize=a.fontSize),null!=a.showFullName&&(this.showFullName=a.showFullName),null!=a.showTooltip&&(this.showTooltip=a.showTooltip),null!=a.backgroundColor&&(this.backgroundColor=a.backgroundColor),null!=a.strokeWidth&&(this.strokeWidth=a.strokeWidth)),this.ids={},this.onVertexUp=new Event(this),this.selectedSVGNodes=[],this.markedSpecimenId={}}function SamplesGrid(a){this.height=500,this.id=BUI.id(),this.tbar=!1,this.width=100,this.title="Samples list",this.margin="5 5 5 5",null!=a&&(null!=a.title&&(this.title=a.title),null!=a.margin&&(this.margin=a.margin),null!=a.height&&(this.height=a.height),null!=a.tbar&&(this.tbar=a.tbar),null!=a.width&&(this.width=a.width)),this.onSelected=new Event(this),Ext.define("BLSampleModel",{extend:"Ext.data.Model",fields:[{name:"proteinAcronym",mapping:"proteinAcronym"},{name:"name",mapping:"name"},{name:"spaceGroup",mapping:"spaceGroup"},{name:"beamlineLocation",mapping:"beamlineLocation"},{name:"code",mapping:"code"},{name:"shipment",mapping:"shipping"},{name:"cellA",mapping:"cellA"},{name:"cellB",mapping:"cellB"},{name:"cellC",mapping:"cellC"},{name:"cellAlpha",mapping:"cellAlpha"},{name:"cellBeta",mapping:"cellBeta"},{name:"cellGamma",mapping:"cellGamma"}],idProperty:"blSampleId"})}function SpecimenGrid(a){this.id=BUI.id(),this.height=500,this.unitsFontSize=9,this.editEnabled=!1,this.isPositionColumnHidden=!1,this.removeBtnEnabled=!1,this.updateRowEnabled=!1,this.grouped=!0,this.width=900,this.title="Specimens",this.margin="0 0 0 0",null!=a&&(null!=a.height&&(this.height=a.height),0==a.showTitle&&(this.title=null),0==a.margin&&(this.margin=a.margin),0==a.grouped&&(this.grouped=null),null!=a.width&&(this.width=a.width),null!=a.editEnabled&&(this.editEnabled=a.editEnabled),null!=a.removeBtnEnabled&&(this.removeBtnEnabled=a.removeBtnEnabled),null!=a.isPositionColumnHidden&&(this.isPositionColumnHidden=a.isPositionColumnHidden),null!=a.updateRowEnabled&&(this.updateRowEnabled=a.updateRowEnabled)),this.onClick=new Event(this),this.onSelected=new Event(this),this.onRemoved=new Event(this),this.onSpecimenChanged=new Event}function SpecimenWidget(a){this.width=1e3,this.height=600,null!=a&&(null!=a.width&&(this.width=a.width),null!=a.height&&(this.height=a.height));var b=this;this.specimenGrid=new SpecimenGrid({minHeight:425,selectionMode:"SINGLE",editEnabled:!1,updateRowEnabled:!0,width:900,showTitle:!1}),this.specimenGrid.onSpecimenChanged.attach(function(a,c){b.experiment.setSpecimenById(c),b.refresh(b.experiment)}),this.specimenGrid.onSelected.attach(function(a,c){c.length>0?b.specimenSelected=c[0]:b.specimenSelected=null,b.samplePlateGroupWidget.selectSpecimens(c)}),this.samplePlateGroupWidget=new SamplePlateGroupWidget({showTitle:!1,height:250,margin:5,bbar:!1}),this.samplePlateGroupWidget.onExperimentChanged.attach(function(a,c){b.refresh(new Experiment(c))}),this.samplePlateGroupWidget.onClick.attach(function(a,c){var d=c.row,e=c.column,f=c.samplePlate.samplePlateId;if(null!=b.specimenSelected)if(0==b.experiment.getSampleByPosition(c.samplePlate.samplePlateId,c.row,c.column).length){var g=b.experiment.getSampleById(b.specimenSelected.specimenId);null==g.sampleplateposition3VO&&(g.sampleplateposition3VO={}),g.sampleplateposition3VO={columnNumber:e,rowNumber:d,samplePlateId:f},b.samplePlateGroupWidget.panel.setLoading("ISPyB: Saving specimen");var h=function(a,c){b.samplePlateGroupWidget.panel.setLoading(!1)};EXI.getDataAdapter({onSuccess:h}).saxs.specimen.saveSpecimen(g),b.samplePlateGroupWidget.refresh(b.experiment),b.specimenGrid.refresh(b.experiment),b.specimenSelected=null,b.specimenGrid.deselectAll()}else{var i=b.experiment.getSampleByPosition(c.samplePlate.samplePlateId,c.row,c.column)[0],g=b.experiment.getSampleById(b.specimenSelected.specimenId);if(g.bufferId==i.bufferId&&g.concentration==i.concentration){if(null!=g.macromolecule3VO&&null!=i.macromolecule3VO&&g.macromolecule3VO.macromoleculeId==i.macromolecule3VO.macromoleculeId||null==g.macromolecule3VO&&null==i.macromolecule3VO){var h=function(a,c){b.refresh(new Experiment(c)),b.samplePlateGroupWidget.panel.setLoading(!1),b.onExperimentChanged.notify(experiment)};b.samplePlateGroupWidget.panel.setLoading("ISPyB: Merging specimens"),EXI.getDataAdapter({onSuccess:h}).saxs.specimen.mergeSpecimens(g.specimenId,i.specimenId),b.specimenSelected=null,b.specimenGrid.deselectAll()}}else alert("Well is not empty. Select another well!")}else{var g=b.experiment.getSampleByPosition(c.samplePlate.samplePlateId,c.row,c.column)[0];null!=g&&b.specimenGrid.selectById(g.specimenId)}}),this.onExperimentChanged=new Event(this)}function StockSolutionForm(a){this.id=BUI.id(),this.actions=[],this.height=500,null!=a&&(null!=a.actions&&(this.actions=a.actions),null!=a.height&&(this.height=a.height)),this.onSaved=new Event(this)}function StockSolutionGrid(a){this.id=BUI.id(),this.tbar=!0,this.title="Stock Solutions",this.btnEditVisible=!0,this.btnRemoveVisible=!0,this.btnAddVisible=!0,this.btnAddExisting=!1,this.isPackedVisible=!0,this.btnUnpackVisible=!1,this.multiselect=!1,this.selectedStockSolutions=[],null!=a&&(null!=a.btnUnpackVisible&&(this.btnUnpackVisible=a.btnUnpackVisible),null!=a.multiselect&&(this.multiselect=a.multiselect),null!=a.height&&(this.height=a.height),null!=a.btnEditVisible&&(this.btnEditVisible=a.btnEditVisible),null!=a.btnAddVisible&&(this.btnAddVisible=a.btnAddVisible),null!=a.btnAddExisting&&(this.btnAddExisting=a.btnAddExisting),null!=a.width&&(this.width=a.width),null!=a.minHeight&&(this.minHeight=a.minHeight),null!=a.tbar&&(this.tbar=a.tbar),null!=a.btnRemoveVisible&&(this.btnRemoveVisible=a.btnRemoveVisible),null!=a.isPackedVisible&&(this.isPackedVisible=a.isPackedVisible),null!=a.showTitle&&(this.showTitle=a.showTitle,0==this.showTitle&&(this.title=null))),this.onSaved=new Event(this),this.onUnpack=new Event(this),this.onPack=new Event(this)}function TemplateGrid(a){this.height=500}function VolumeGrid(){this.id=BUI.id()}function WizardWidget(a){this.targetId=null,this.width=910,this.height=400,this.windowMode=!0,null!=a&&(null!=a.windowMode&&(this.windowMode=a.windowMode),null!=a.width&&(this.width=a.width)),this.step=0,this.forms=[],this.onFinished=new Event(this)}dust.helpers.decimal=function(a,b,c,d){if(d.key){var e=b.current()[d.key];if(e)if(null!=d.decimals)try{a.write(Number(e).toFixed(d.decimals))}catch(f){a.write(b.current()[d.key])}else a.write(b.current()[d.key])}else a.write("WARN: NO KEY SET");return a},dust.helpers.sizeOf=function(a,b,c,d){var e=this.size(a,b,c,d);return c&&c.block?a.render(c.block,b.push({isSelect:!0,isResolved:!1,selectKey:e})):e},Exi.prototype.appendDataAdapterParameters=function(a){if(a||(a={}),EXI.credentialManager.getCredentials()[0]&&!EXI.credentialManager.getCredentials()[0].isValid())return void(location.hash="/welcome");var b=EXI.credentialManager.getConnections();return b.length>0&&(a.url=b[0].url,a.token=b[0].token,a.proposal=b[0].proposal),a},Exi.prototype.getDataAdapter=function(a){var b=new DataAdapterFactory(this.appendDataAdapterParameters(a));return b},Exi.prototype.setAnonymousMenu=function(){this.mainMenu=this.anonymousMenu,Ext.getCmp("mainMenu").removeAll(),Ext.getCmp("mainMenu").add(EXI.mainMenu.getPanel())},Exi.prototype.setUserMenu=function(){this.mainMenu=this.userMenu,Ext.getCmp("mainMenu").removeAll(),Ext.getCmp("mainMenu").add(EXI.mainMenu.getPanel())},Exi.prototype.loadSelected=function(a){},Exi.prototype.addMainPanel=function(a){this.keepTabs||Ext.getCmp("main_panel").removeAll(),Ext.getCmp("main_panel").add(a.getPanel()),Ext.getCmp("main_panel").setActiveTab(Ext.getCmp("main_panel").items.length-1)},Exi.prototype.getSelectedDataCollections=function(){for(var a=[],b=0;b<this.experimentListView.length;b++)a=a.concat(this.experimentListView[b].getSelected());return a},Exi.prototype.addNavigationPanel=function(a){Ext.getCmp("navigation").add(a.getPanel()),null!=Ext.getCmp("navigation")&&(Ext.getCmp("navigation").expand(),this.showNavigationPanel())},Exi.prototype.hideNavigationPanel=function(a){null!=Ext.getCmp("navigation")&&Ext.getCmp("navigation").hide()},Exi.prototype.showNavigationPanel=function(a){null!=Ext.getCmp("navigation")&&Ext.getCmp("navigation").show()},Exi.prototype.clearNavigationPanel=function(){Ext.getCmp("navigation").removeAll()},Exi.prototype.clearMainPanel=function(){Ext.getCmp("main_panel").removeAll()},Exi.prototype.setLoadingNavigationPanel=function(a){Ext.getCmp("navigation").setLoading(a)},Exi.prototype.setLoadingMainPanel=function(a){Ext.getCmp("main_panel").setLoading(a)},Exi.prototype.setError=function(a){this.mainStatusBar.showError(a)},Exi.prototype.setLoading=function(a){null==a||1==a?this.mainStatusBar.showBusy():this.mainStatusBar.showReady()},Exi.prototype.getHeader=function(a){return'<img class="titleImage" src="images/logo_EMBL.png"><span class="title">Extended ISPyB</span>'},Exi.prototype.show=function(){var a=this;Ext.application({name:"ExiSAXS",launch:function(){Ext.create("Ext.container.Viewport",{layout:"border",items:[{region:"north",xtype:"component",padding:10,height:75,html:a.getHeader(),cls:a.headerCssClass},{region:"north",cls:"toolbarPanel",id:"mainMenu",xtype:"panel",width:400,items:a.mainMenu.getPanel()},{xtype:"panel",id:"navigation",region:"west",width:250,split:!1,title:"Browse by",cls:"navigation",collapsible:!0,collapsed:!0},{region:"center",id:"main_panel",xtype:"tabpanel",cls:"navigation",plain:!0,items:[]},{region:"south",xtype:"panel",cls:"statusBar",bbar:a.mainStatusBar.getBar()}],listeners:{afterrender:function(b,c){a.mainMenu.populateCredentialsMenu(),a.onAfterRender.notify(),0==a.credentialManager.getCredentials()?a.setAnonymousMenu():(a.setUserMenu(),a.mainMenu.populateCredentialsMenu())}}})}})},MainStatusBar.prototype.getBar=function(){return this.statusBar=Ext.create("Ext.ux.StatusBar",{id:"main-status-bar",text:"Ready",iconCls:"accept",busyIconCls:"busy",busyText:this.busyText,cls:"statusBar",statusAlign:"right"}),this.statusBar},MainStatusBar.prototype.showBusy=function(a){null==a&&(a="Connecting to servers..."),this.statusBar.busyText=a,this.statusBar.showBusy()},MainStatusBar.prototype.showError=function(a){this.statusBar.clearStatus(),this.statusBar.setStatus({text:a,iconCls:"error"})},MainStatusBar.prototype.showReady=function(){this.statusBar.clearStatus(),this.statusBar.setStatus({text:"Ready",iconCls:"accept"})},ProposalManager.prototype.get=function(a){var b=this;if(null==localStorage.getItem("proposals")||a){var c=function(a,c){localStorage.setItem("proposals",JSON.stringify(c)),b.onActiveProposalChanged.notify()};EXI.getDataAdapter({async:!0,onSuccess:c}).proposal.proposal.getProposalsInfo()}return JSON.parse(localStorage.getItem("proposals"))},ProposalManager.prototype.clear=function(){localStorage.removeItem("proposals")},ProposalManager.prototype.getSessions=function(){if(null==localStorage.getItem("sessions")){var a=function(a,b){localStorage.setItem("sessions",JSON.stringify(b))};EXI.getDataAdapter({async:!1,onSuccess:a}).proposal.session.getSessions()}return JSON.parse(localStorage.getItem("sessions"))},ProposalManager.prototype.getFutureSessions=function(){for(var a=this.getSessions(),b=moment(),c=[],d=0;d<a.length;d++)b.diff(a[d].BLSession_startDate)<0&&c.push(a[d]);return c},ProposalManager.prototype.getBufferColors=function(){return["#ffffcc","#c7e9b4","#7fcdbb","#41b6c4","#2c7fb8","#253494"]},ProposalManager.prototype.getLabcontacts=function(){return this.get()[0].labcontacts},ProposalManager.prototype.getLabcontactById=function(a){return _.find(this.getLabcontacts(),function(b){return b.labContactId==a})},ProposalManager.prototype.getPlateTypeById=function(a){return _.find(this.getPlateTypes(),function(b){return b.plateTypeId==a})},ProposalManager.prototype.getPlateTypes=function(){return this.get()[0].plateTypes},ProposalManager.prototype.getPlateByFlavour=function(a){return[this.getPlateTypes()[0],this.getPlateTypes()[2],this.getPlateTypes()[3]]},ProposalManager.prototype.getBufferById=function(a){for(var b=this.get(),c=function(b){return b.bufferId==a},d=0;d<b.length;d++){var e=_.find(b[d].buffers,c);if(null!=e)return e}},ProposalManager.prototype.getMacromoleculeById=function(a){for(var b=this.get(),c=function(b){return b.macromoleculeId==a},d=0;d<b.length;d++){var e=_.find(b[d].macromolecules,c);if(null!=e)return e}return null},ProposalManager.prototype.getMacromoleculeByAcronym=function(a){for(var b=this.get(),c=function(b){return b.acronym==a},d=0;d<b.length;d++){var e=_.find(b[d].macromolecules,c);if(null!=e)return e}return null},ProposalManager.prototype.getStockSolutionById=function(a){for(var b=this.get(),c=function(b){return b.stockSolutionId==a},d=0;d<b.length;d++){var e=_.find(b[d].stockSolutions,c);if(null!=e)return e}},ProposalManager.prototype.getBuffers=function(){for(var a=this.get(),b=[],c=0;c<a.length;c++)b=b.concat(a[c].buffers);return b},ProposalManager.prototype.getMacromolecules=function(){for(var a=this.get(),b=[],c=0;c<a.length;c++)b=b.concat(a[c].macromolecules);return b},ProposalManager.prototype.getProposals=function(){for(var a=this.get(),b=[],c=0;c<a.length;c++)a[c].proposal[0].proposal=a[c].proposal[0].code+a[c].proposal[0].number,b=b.concat(a[c].proposal);return b},ProposalManager.prototype.getProposalById=function(a){for(var b=this.get(),c=[],d=0;d<b.length;d++)if(b[d].proposal[0].proposalId==a)return b[d].proposal[0];return c},ProposalManager.prototype.getStockSolutions=function(){return this.get()[0].stockSolutions},ProposalManager.prototype.getProteins=function(){return this.get()[0].proteins},ProposalManager.prototype.getCrystals=function(){return this.get()[0].crystals},ProposalManager.prototype.getProteinByAcronym=function(a){return _.filter(this.getProteins(),function(b){return b.acronym==a})},ProposalManager.prototype.getCrystalsByAcronym=function(a){return _.filter(this.getCrystals(),function(b){return null==b.proteinVO?!1:b.proteinVO.acronym==a})},ProposalManager.prototype.getStockSolutionsBySpecimen=function(a,b){var c=_.filter(this.getStockSolutions(),function(b){return b.macromoleculeId==a});return _.filter(c,function(a){return a.bufferId==b})},ProposalManager.prototype.getUnpackedStockSolutions=function(){for(var a=this.getStockSolutions(),b=[],c=0;c<a.length;c++)null==a[c].boxId&&b.push(a[c]);return b},ProposalManager.prototype.getStockSolutionsByDewarId=function(a){return _.filter(this.getStockSolutions(),function(b){return b.boxId==a})},ExiGenericController.prototype.setPageBackground=function(){},ExiGenericController.prototype.notFound=function(){},AuthenticationManager.prototype.login=function(a,b,c){var d=this,e=function(b,e){d.onSuccess.notify({user:a,roles:e.roles,token:e.token,url:c})},f=function(a,b){EXI.setError("Permission denied"),BUI.showError("Your credentials are invalid")};EXI.getDataAdapter({onSuccess:e,onError:f,url:c,username:a}).proposal.authentication.authenticate(a,b,c)},ExiController.prototype.loadNavigationPanel=function(a){EXI.clearNavigationPanel(),EXI.setLoadingNavigationPanel(!0);var b=function(b,c){EXI.addNavigationPanel(a),a.load(c),EXI.setLoadingNavigationPanel(!1)},c=function(a,b){EXI.setLoadingNavigationPanel(!1)};return EXI.getDataAdapter({onSuccess:b,onError:c})},ExiController.prototype.init=function(){function a(){}function b(){}Path.map("#/").to(function(){location.hash="/welcome"}).enter(a),Path.map("#/login").to(function(){EXI.credentialManager.logout(),EXI.authenticationForm.show()}).enter(a),Path.map("#/welcome").to(function(){EXI.credentialManager.logout(),EXI.authenticationForm.show()}).enter(a),Path.map("#/welcome/user/:user/main").to(function(){var a=this.params.user,b=new ManagerWelcomeMainView;EXI.addMainPanel(b),EXI.hideNavigationPanel(),b.load(a)}).enter(a),Path.map("#/welcome/manager/:user/main").to(function(){var a=this.params.user,b=new ManagerWelcomeMainView;EXI.addMainPanel(b),EXI.hideNavigationPanel(),b.load(a)}).enter(a),Path.map("#/welcome/manager/:user/date/:start/:end/main").to(function(){var a=this.params.user,b=new ManagerWelcomeMainView;EXI.addMainPanel(b),EXI.hideNavigationPanel(),b.loadSessionsByDate(a,this.params.start,this.params.end)}).enter(a),Path.map("#/logout").to(function(){EXI.credentialManager.logout(),EXI.hideNavigationPanel(),EXI.proposalManager.clear()}).enter(a),Path.root("#/"),Path.rescue(b)},ExiGenericController.prototype.setPageBackground=function(){},ExiGenericController.prototype.notFound=function(){},LabContactExiController.prototype.loadNavigationPanel=ExiController.prototype.loadNavigationPanel,LabContactExiController.prototype.setPageBackground=function(){},LabContactExiController.prototype.notFound=function(){},LabContactExiController.prototype.init=function(){function a(a){return b.loadNavigationPanel(a)}var b=this,c=null,d=null;Path.map("#/proposal/addresses/nav").to(function(){EXI.clearNavigationPanel(),EXI.setLoadingNavigationPanel(!0),c=new AddressListView,c.onSelect.attach(function(a,b){location.hash="/proposal/address/"+b[0].labContactId+"/main"}),EXI.addNavigationPanel(c),d=a(c),d.proposal.labcontacts.getLabContacts(),EXI.addMainPanel(new AddressWelcomeMainView)}).enter(this.setPageBackground),Path.map("#/proposal/address/:lacontactId/main").to(function(){var a=new AddressMainView;EXI.addMainPanel(a),a.load(this.params.lacontactId)}).enter(this.setPageBackground)},OfflineExiController.prototype.setPageBackground=function(){},OfflineExiController.prototype.notFound=function(){},OfflineExiController.prototype.init=function(){function a(){b.notFound()}var b=this;Path.map("#/tool/dimple/main").to(function(){var a=new DimpleMainView;EXI.addMainPanel(a),a.load()}).enter(this.setPageBackground),Path.map("#/tool/dimple/datacollection/:dataCollectionId/main").to(function(){var a=new DimpleDCMainView;EXI.addMainPanel(a),a.load(this.params.dataCollectionId)}).enter(this.setPageBackground),Path.map("#/tool/reprocess/datacollection/:dataCollectionId/:startImage/:endImage/main").to(function(){var a=new ReprocessMainView;EXI.addMainPanel(a),a.load(this.params.dataCollectionId,this.params.startImage,this.params.endImage)}).enter(this.setPageBackground),Path.map("#/tool/crysol/main").to(function(){var a=new CrysolMainView;EXI.addMainPanel(a),a.load()}).enter(this.setPageBackground),Path.map("#/tool/subtraction/main").to(function(){var a=new SubtractionMainView;EXI.addMainPanel(a),a.load()}).enter(this.setPageBackground),Path.map("#/tool/list").to(function(){var a=null,b=new RunListView;b.onSelect.attach(function(b,c){var d=c[0].internalId,e=a.internalId;"Dimple"==c[0].tool?location.hash="/project/"+e+"/dimple/"+d+"/main":location.hash="/project/"+e+"/run/"+d+"/main"}),EXI.clearNavigationPanel(),EXI.setLoadingNavigationPanel(!0);var c=function(c,d){a=d[0],EXI.addNavigationPanel(b),b.load(d[0].runs.reverse()),EXI.setLoadingNavigationPanel(!1)},d=function(a,b){EXI.setLoadingNavigationPanel(!1)};EXI.getDataAdapter({onSuccess:c,onError:d}).exi.offline.getProject()}).enter(this.setPageBackground),Path.map("#/project/:projectId/run/:runId/main").to(function(){var a=this.params.projectId,b=this.params.runId,c=function(a,c){for(var d=0;d<c.length;d++)if(c[d].internalId==b){var e=new RunMainView;EXI.addMainPanel(e),e.load(c[d])}},d=function(a){BUI.showError("There was an error")};EXI.getDataAdapter({onSuccess:c,onError:d}).exi.offline.getRuns(a)}).enter(this.setPageBackground),Path.map("#/project/:projectId/dimple/:runId/main").to(function(){var a=this.params.projectId,b=this.params.runId,c=function(a,c){for(var d=0;d<c.length;d++)if(c[d].internalId==b){var e=new DimpleRunMainView;EXI.addMainPanel(e),e.load(c[d])}},d=function(a){BUI.showError("There was an error")};EXI.getDataAdapter({onSuccess:c,onError:d}).exi.offline.getRuns(a)}).enter(this.setPageBackground),Path.rescue(a)},ProposalExiController.prototype.loadNavigationPanel=ExiController.prototype.loadNavigationPanel,ProposalExiController.prototype.setPageBackground=function(){},ProposalExiController.prototype.notFound=function(){},ProposalExiController.prototype.init=function(){function a(a){return b.loadNavigationPanel(a)}var b=this,c=null,d=null;Path.map("#/proposal/session/nav").to(function(){c=new SessionListView,c.onSelect.attach(function(a,b){"SAXS"==EXI.credentialManager.getTechniqueByBeamline(b[0].beamlineName)?location.hash="/session/nav/"+b[0].sessionId+"/session":location.hash="/mx/datacollection/session/"+b[0].sessionId+"/main"}),d=a(c),d.proposal.session.getSessions()}).enter(this.setPageBackground),Path.map("#/proposal/address/:lacontactId/main").to(function(){var a=new AddressMainView;EXI.addMainPanel(a),a.load(this.params.lacontactId)}).enter(this.setPageBackground),Path.map("#/puck/:containerId/main").to(function(){var a=new PuckMainView;EXI.addMainPanel(a),a.load(this.params.containerId)}).enter(this.setPageBackground)},SessionController.prototype.setPageBackground=ExiGenericController.prototype.setPageBackground,SessionController.prototype.notFound=ExiGenericController.prototype.notFound,SessionController.prototype.init=function(){Path.map("#/session/nav").to(function(){EXI.clearNavigationPanel(),EXI.hideNavigationPanel();var a=new SessionMainView({title:"Sessions"});EXI.addMainPanel(a);var b=function(b,c){a.load(EXI.proposalManager.getSessions()),EXI.setLoadingMainPanel(!1)};EXI.setLoadingMainPanel(),EXI.getDataAdapter({onSuccess:b}).proposal.session.getSessions()}).enter(this.setPageBackground),Path.rescue(this.notFound)},ShippingExiController.prototype.loadNavigationPanel=ExiController.prototype.loadNavigationPanel,ShippingExiController.prototype.setPageBackground=function(){},ShippingExiController.prototype.notFound=function(){},ShippingExiController.prototype.loadShipmentsNavigationPanel=function(a){EXI.clearNavigationPanel(),EXI.setLoadingMainPanel(!0);var b=function(b,c){c=BUI.groupBy(c,function(a){return a.Shipping_shippingId});for(var d=[],e=0;e<c.length;e++)d.push(c[e][0]);d.sort(function(a,b){return b.Shipping_shippingId-a.Shipping_shippingId}),EXI.addNavigationPanel(a),a.load(d),EXI.setLoadingMainPanel(!1)},c=function(a,b){EXI.setLoadingNavigationPanel(!1)};return EXI.getDataAdapter({onSuccess:b,onError:c})},ShippingExiController.prototype.init=function(){function a(){var a=new ShippingListView;a.onSelect.attach(function(a,b){location.hash="/shipping/"+b[0].Shipping_shippingId+"/main"}),c=b.loadShipmentsNavigationPanel(a),c.proposal.shipping.getShippings()}var b=this,c=null;Path.map("#/proposal/shipping/nav?nomain").to(function(){a()}),Path.map("#/proposal/shipping/nav").to(function(){a(),EXI.addMainPanel(new ShippingWelcomeMainView)}),Path.map("#/shipping/:shippingId/main").to(function(){var a=new ShippingMainView;EXI.addMainPanel(a),a.load(this.params.shippingId)}).enter(this.setPageBackground),
Path.map("#/shipping/main").to(function(){var a=new ShippingMainView;EXI.addMainPanel(a),a.load()}).enter(this.setPageBackground)},MainMenu.prototype.getMenuItems=function(){return[]},MainMenu.prototype.getHomeItem=function(){return{text:this._convertToHTMLWhiteSpan("Home"),cls:"ExiSAXSMenuToolBar",icon:"../images/icon/rsz_ic_home_black_24dp.png",handler:function(){if(null!=EXI.credentialManager.getCredentials())if(EXI.credentialManager.getCredentials().length>0){var a=EXI.credentialManager.getCredentials()[0].username,b=EXI.credentialManager.getCredentialByUserName(EXI.credentialManager.getCredentials()[0].username);b.isManager()?location.hash="/welcome/manager/"+a+"/main":location.hash="/welcome/user/"+a+"/main"}else BUI.showError("You should sign up");else BUI.showError("You should sign up")}}},MainMenu.prototype.getShipmentItem=function(){function a(a,b){"Shipments"==a.text&&(location.hash="/proposal/shipping/nav"),"Manage shipping addresses"==a.text&&(location.hash="/proposal/addresses/nav"),"Shipment List"==a.text&&(location.hash="/proposal/shipping/nav")}function b(){function a(a,b){"Stock Solutions"==a.text&&(location.hash="/saxs/stocksolution/nav")}return Ext.create("Ext.menu.Menu",{items:[{text:"Stock Solutions",icon:"../images/icon/testtube.png",handler:a}]})}return{text:this._convertToHTMLWhiteSpan("Shipment"),cls:"ExiSAXSMenuToolBar",disabled:!1,menu:Ext.create("Ext.menu.Menu",{items:[{text:"BioSAXS",icon:"../images/icon/macromolecule.png",menu:b()},{text:"Manage shipping addresses",icon:"../images/icon/contacts.png",handler:a},{text:"Shipments",icon:"../images/icon/shipping.png",handler:a}]})}},MainMenu.prototype.getHelpMenu=function(){function a(a,b){"ISPyB Web services API Map"==a.text&&window.open("/exi/documentation/ispyb-api-ws/print.html"),"Job list"==a.text&&(location.hash="/tool/list")}return Ext.create("Ext.menu.Menu",{items:[{text:"Developer",checked:!1,group:"theme",menu:{items:[{text:"ISPyB Web services API Map",handler:a},{text:"How to retrieve data from ISPyB?",handler:a},{text:"EXI Router",handler:a},{text:"EXI List Views Objects",handler:a},{text:"EXI Main View Objects",handler:a}]}},"-",{text:"About",checked:!1,group:"theme",handler:a}]})},MainMenu.prototype.getAddCredentialMenu=function(){return null!=EXI.credentialManager.getCredentials()&&EXI.credentialManager.getCredentials().length>0?{icon:"../images/icon/rsz_1ic_input_black_24dp.png",height:30,text:"Add",handler:function(){window.location.href="#/login"}}:void 0},MainMenu.prototype.populateCredentialsMenu=function(){this.credentialsMenu.removeAll();var a="";if(null!=EXI.credentialManager.getCredentials())for(var b=0;b<EXI.credentialManager.getCredentials().length;b++)if(a=EXI.credentialManager.getCredentials()[b].username,EXI.credentialManager.getCredentials()[b].activeProposals.length>0)for(var c=0;c<EXI.credentialManager.getCredentials()[b].activeProposals.length;c++)a=EXI.credentialManager.getCredentials()[b].activeProposals[c]+"@"+EXI.credentialManager.getCredentials()[b].username,this.credentialsMenu.add({text:a,icon:"../images/icon/rsz_esrflogo80.gif",disabled:!0});else this.credentialsMenu.add({text:a,icon:"../images/icon/rsz_esrflogo80.gif",disabled:!0});EXI.credentialManager.getCredentials().length>0?(Ext.getCmp(this.loginButtonId).setText("<span style='color:white'>Log out <span style='font-weight:bold;'>"+a+" </span> </span>"),Ext.getCmp(this.loginButtonId).setIcon("../images/rsz_logout.png")):(Ext.getCmp(this.loginButtonId).setText("<span style='color:white'>Sign In</span>"),Ext.getCmp(this.loginButtonId).setIcon("../images/rsz_login.png"))},MainMenu.prototype._convertToHTMLWhiteSpan=function(a){return'<span style="color:white">'+a+"</span>"},MainMenu.prototype.isLoggedIn=function(){return EXI.credentialManager.getCredentials().length>0},MainMenu.prototype.getLoginButton=function(){var a="../images/rsz_login.png",b=this._convertToHTMLWhiteSpan("Sign In");return EXI.credentialManager.getCredentials().length>0&&(a="../images/rsz_logout.png",b=this._convertToHTMLWhiteSpan("log out")),{xtype:"splitbutton",id:this.loginButtonId,text:b,cls:"button_log_out",icon:a,menu:this.credentialsMenu,handler:function(){0==EXI.credentialManager.getCredentials().length?location.hash="/login":location.hash="/logout"}}},MainMenu.prototype.getPanel=function(){var a=this;this.credentialsMenu=new Ext.menu.Menu({id:a.id+"menu",items:[a.getAddCredentialMenu()]});var b=this.getMenuItems();return b.push("->"),b.push(this.getLoginButton()),this.tb=Ext.create("Ext.toolbar.Toolbar",{cls:this.cssClass,items:b}),this.tb},ListView.prototype.getSorters=function(){return{}},ListView.prototype.getFilter=function(a){return null},ListView.prototype.load=function(a){this.data=a,null!=this.formatData?this.store.loadData(this.formatData(a)):this.store.loadData(a)},ListView.prototype.getColumns=function(){var a=this;return[{text:this.title,flex:1,dataIndex:"shippingId",renderer:function(b,c,d){return a.getRow(d)}}]},ListView.prototype.getFields=function(){return[]},ListView.prototype.getPanel=function(){var a=this;return this.store=Ext.create("Ext.data.Store",{fields:this.getFields(),data:[],sorters:this.sorters,proxy:{type:"memory",reader:{type:"json"}}}),this.panel=Ext.create("Ext.grid.Panel",{store:this.store,layout:"fit",columns:this.getColumns(),width:this.width,height:this.height,multiSelect:!0,dockedItems:[{xtype:"toolbar",dock:"bottom",cls:"x-toolbar",height:42,items:[{xtype:"textfield",name:"searchField",hideLabel:!0,width:200,hidden:null==a.getFilter(),emptyText:"Search...",listeners:{change:function(b,c){var d=b.getValue();""!=d?a.store.filter(a.getFilter(d)):(a.store.clearFilter(!0),a.load(a.data))}}}]}],viewConfig:{emptyText:"No items to display",enableTextSelection:!0,preserveScrollOnRefresh:!0,stripeRows:!0}}),this.panel.on("selectionchange",function(b,c){var d=[];for(var e in c)d.push(c[e].data);a.onSelect.notify(d)}),this.panel},RunListView.prototype.getPanel=ListView.prototype.getPanel,RunListView.prototype.load=ListView.prototype.load,RunListView.prototype.getFilter=function(a){return[{property:"name",value:a,anyMatch:!0}]},RunListView.prototype.formatStatus=function(a){return"FINISHED"==a?"<span style='color:green;font-weight:bold;'>"+a+"</span>":"<span style='color:orange;font-weight:bold;'>"+a+"</span>"},RunListView.prototype.formatJobs=function(a){for(var b="<table>",c=0;c<a.length;c++)b=b+"<tr><td>"+a[c].name+"</td></tr>";return b+"</table>"},RunListView.prototype.getRow=function(a){var b="<table class='listView'>";return b=b+"<tr><td>Name:</td><td>"+a.data.name+"</td></tr>",b=b+"<tr><td>Status:</td><td>"+this.formatStatus(a.data.status)+"</td></tr>",b=b+"<tr><td>Jobs:</td><td>"+this.formatJobs(a.data.jobs)+"</td></tr>",b=b+"<tr><td>Date:</td><td>"+a.data.creationDate+"</td></tr>",b+"</table>"},RunListView.prototype.getColumns=function(){var a=this;return[{text:"Jobs",flex:1,dataIndex:"sessionId",renderer:function(b,c,d){return a.getRow(d)}}]},RunListView.prototype.getFields=function(){return["name","status","creationDate","jobs"]},SessionListView.prototype.getPanel=ListView.prototype.getPanel,SessionListView.prototype.load=ListView.prototype.load,SessionListView.prototype.getFilter=function(a){return[{property:"beamlineName",value:a,anyMatch:!0}]},SessionListView.prototype.formatData=function(a){for(var b=0;b<a.length;b++)a[b].day=moment(a[b].BLSession_startDate).format("Do"),a[b].year=moment(a[b].BLSession_startDate).format("YYYY"),a[b].month=moment(a[b].BLSession_startDate).format("MMM");return a},SessionListView.prototype.getRow=function(a){var b="";return dust.render("session.listview",a.data,function(a,c){b+=c}),b},SessionListView.prototype.getColumns=function(){var a=this;return[{text:"Session",flex:1,dataIndex:"sessionId",renderer:function(b,c,d){return a.getRow(d)}}]},SessionListView.prototype.getFields=function(){return["date"]},ShippingListView.prototype.getPanel=ListView.prototype.getPanel,ShippingListView.prototype.load=ListView.prototype.load,ShippingListView.prototype.getFilter=ListView.prototype.getFilter,ShippingListView.prototype.getFields=ListView.prototype.getFields,ShippingListView.prototype.getColumns=ListView.prototype.getColumns,ShippingListView.prototype.getRow=function(a){var b="";return dust.render("shipping.listview",a.data,function(a,c){b=c}),b},WorkSpaceListView.prototype.loadProjects=function(a){null!=a&&this.projectStore.loadData(a),this.loadRuns()},WorkSpaceListView.prototype.loadRuns=function(){var a=this,b=new ExiDataAdapter;b.onSuccess.attach(function(b,c){a.runStore.loadData(c.reverse()),a.runGrid.setLoading(!1)}),this.runGrid.setLoading(),this.projectId=exiSAXS.localExtorage.userManager.getActiveProject().internalId,b.getRuns(exiSAXS.localExtorage.userManager.getActiveProject().internalId)},WorkSpaceListView.prototype.setSelectedItems=function(a){for(var b=0;b<a.length;b++)delete a[b].id;this.selection.loadData(a),this.projectGrid.collapse()},WorkSpaceListView.prototype.getSelectionPanel=function(){function a(a,b){if(null!=a&&null!=b){if(.3>a/b)return"<span style='color:red;'>"+a+"/"+b+"</span>";if(.7>a/b)return"<span style='color:orange;'>"+a+"/"+b+"</span>"}return a+"/"+b}function b(a){"yes"==a&&exiSAXS.localExtorage.selectedSubtractionsManager.remove(record.data)}return this.selection=Ext.create("Ext.data.Store",{fields:["subtractionId","scattering","macromoleculeAcronym","concentration","framesMerge","framesCount","exposureTemperature"]}),this.selectionGrid=Ext.create("Ext.grid.Panel",{store:this.selection,title:"Selection",emptyText:"No selection",tbar:this.selectionMenu.getPanel(),columns:[{text:"",dataIndex:"scattering",renderer:function(a,b,c){return"<img src="+(new DataAdapter).getImage(c.data.subtractionId,"scattering")+'   height="70" width="70" >'}},{text:"",dataIndex:"macromoleculeAcronym",flex:.8,renderer:function(b,c,d){return d.data.macromoleculeAcronym+"<br />"+BUI.formatValuesUnits(d.data.concentration,"mg/ml",7,2)+"<br />"+d.data.exposureTemperature+"<span class='key_subgrid'> C</span><br />"+a(d.data.framesMerge,d.data.framesCount)}},{text:"",id:"remove",dataIndex:"scattering",width:50,renderer:function(a){return'<br /><img style="cursor: pointer; height:30px;width:30px;" src="images/icon/ic_highlight_remove_black_24dp.png" />'}}],width:200,listeners:{cellclick:function(a,c,d,e,f,g,h,i){2==d&&Ext.Msg.show({title:"Discard subtraction?",msg:"Your are discarding a selected subtraction. You may re-add it afterwards. Would you like to discard it?",buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,fn:b,height:150})}}}),this.selectionGrid},WorkSpaceListView.prototype.getProjectPanel=function(){return this.projectStore=Ext.create("Ext.data.Store",{fields:["name"]}),this.projectGrid=Ext.create("Ext.grid.Panel",{store:this.projectStore,title:"Projects",emptyText:"No projects",columns:[{text:"Name",dataIndex:"name",flex:1,renderer:function(a,b,c){var d="<span class='projectName'>"+c.data.name+"</span><br/><span class='projectDescription'>"+c.data.description+"</span>";return null!=c.data.subtractions&&(d=d+"<br />"+c.data.subtractions.length+" datasets selected"),d}}],height:200}),this.projectGrid},WorkSpaceListView.prototype.getRunPanel=function(){var a=this;return this.runStore=Ext.create("Ext.data.Store",{fields:["name"]}),this.runGrid=Ext.create("Ext.grid.Panel",{store:this.runStore,title:"Run",emptyText:"No Runs",minHeight:600,dockedItems:[{xtype:"toolbar",dock:"bottom",ui:"footer",items:[{xtype:"component",flex:1},{xtype:"button",text:"Refresh",handler:function(b,c,d){a.loadRuns()}}]}],columns:[{text:"Name",dataIndex:"name",flex:1,renderer:function(a,b,c){var d=c.data.jobs,e="<table>";if(e=e+"<tr ><td  class='nameRun'>"+c.data.name+"</td></tr>",e=e+"<tr ><td  class='statusRun'>"+c.data.status+"</td></tr>",e=e+"<tr ><td  class='dateRun'>"+c.data.creationDate+"</td></tr>",null!=d)for(var f=0;f<d.length;f++)e=e+"<tr ><td class='jobRow'>"+d[f].name+"</td><td>"+d[f].status+"</td></tr>";return e+"</table>"}}],height:200}),this.runGrid.on("select",function(b,c,d,e){location.hash="/project/"+a.projectId+"/run/"+c.data.internalId+"/main"}),this.runGrid},WorkSpaceListView.prototype.getPanel=function(){var a=this;return this.panel=Ext.create("Ext.panel.Panel",{layout:"fit",autoScroll:!0,defaults:{bodyStyle:"padding:15px"},items:[a.getSelectionPanel(),a.getProjectPanel(),a.getRunPanel()]}),this.panel},Credential.prototype.isManager=function(){return this._checkRole("manager")},Credential.prototype.isLocalContact=function(){return this._checkRole("localcontact")},Credential.prototype._checkRole=function(a){return-1!=JSON.stringify(this.roles).toLowerCase().indexOf(a)},Credential.prototype.isValid=function(){return this.timeToExpire()>0},Credential.prototype.timeToExpire=function(){return moment.duration(moment(this.tokenExpires).diff(moment())).asHours()},CredentialManager.prototype.addCredential=function(a,b,c,d,e,f){var g=moment().add(3,"hour"),h=new Credential(a,b,c,d,e,[],g,f);null==localStorage.getItem("credentials")&&localStorage.setItem("credentials","[]");var i=this.getCredentials();i.push(h),localStorage.setItem("credentials",JSON.stringify(i)),this.onLogin.notify(h)},CredentialManager.prototype.credentialToObject=function(a){return new Credential(a.username,a.roles,a.token,a.url,a.exiUrl,a.activeProposals,a.tokenExpires,a.properties)},CredentialManager.prototype.getCredentials=function(){var a=[];null!=JSON.parse(localStorage.getItem("credentials"))&&(a=JSON.parse(localStorage.getItem("credentials")));for(var b=0;b<a.length;b++)a[b]=this.credentialToObject(a[b]);return a},CredentialManager.prototype.getTechniqueByBeamline=function(a){for(var b=this.getConnections(),c=0;c<b.length;c++){if(-1!=JSON.stringify(b[c].beamlines.MX).toUpperCase().indexOf(a.toUpperCase()))return"MX";if(-1!=JSON.stringify(b[c].beamlines.SAXS).toUpperCase().indexOf(a.toUpperCase()))return"SAXS"}return"UNKNOW"},CredentialManager.prototype.getBeamlines=function(){for(var a=this.getConnections(),b=[],c=0;c<a.length;c++)$.merge(b,a[c].beamlines.MX),$.merge(b,a[c].beamlines.SAXS);return b},CredentialManager.prototype.getConnections=function(){for(var a=this.getCredentials(),b=[],c=0;c<a.length;c++)if(a[c].activeProposals.length>0)for(var d=0;d<a[c].activeProposals.length;d++)b.push({username:a[c].username,url:a[c].url,exiUrl:a[c].exiUrl,token:a[c].token,beamlines:a[c].properties.beamlines,proposal:a[c].activeProposals[d]});else b.push({username:a[c].username,url:a[c].url,exiUrl:a[c].exiUrl,token:a[c].token,beamlines:a[c].properties.beamlines,proposal:null});return b},CredentialManager.prototype.getCredentialByUserName=function(a){var b=_.filter(this.getCredentials(),{username:a});return b.length>0?b[0]:void 0},CredentialManager.prototype.logout=function(a,b,c,d){localStorage.removeItem("credentials"),this.onLogout.notify()},CredentialManager.prototype.setActiveProposal=function(a,b){for(var c=this.getCredentials(),d=0;d<c.length;d++)c[d].username.toLowerCase()==a.toLowerCase()&&(c[d].activeProposals=[b],localStorage.setItem("credentials",JSON.stringify(c)),localStorage.removeItem("sessions"),this.onActiveProposalChanged.notify())},MainView.prototype.getContainer=function(){return this.container},MainView.prototype.getPanel=function(){return this.container=Ext.create("Ext.container.Container",{xtype:"container",items:[]}),this.panel=Ext.create("Ext.panel.Panel",{autoScroll:!0,title:this.title,closable:this.closable,icon:this.icon,bodyStyle:this.bodyStyle,items:[this.getContainer()]}),this.panel},AddressMainView.prototype.getPanel=MainView.prototype.getPanel,AddressMainView.prototype.getContainer=function(){return Ext.create("Ext.container.Container",{layout:{type:"hbox"},margin:15,border:1,defaults:{labelWidth:80,flex:1},items:[this.addressForm.getPanel([])]})},AddressMainView.prototype.load=function(a){this.panel.setTitle("Address");var b=this,c=function(a,c){b.addressForm.load(c)};EXI.getDataAdapter({onSuccess:c}).proposal.labcontacts.getLabContactById(a)},ManagerWelcomeMainView.prototype.getPanel=MainView.prototype.getPanel,ManagerWelcomeMainView.prototype.activeProposal=function(a){EXI.mainStatusBar.showBusy("Loading proposal "+a),EXI.credentialManager.setActiveProposal(this.username,a),EXI.proposalManager.clear(),EXI.proposalManager.onActiveProposalChanged=new Event,EXI.proposalManager.onActiveProposalChanged.attach(function(){EXI.mainStatusBar.showReady(),console.log(EXI.proposalManager.get())}),EXI.proposalManager.get()},ManagerWelcomeMainView.prototype.getContainer=function(){return this.container=Ext.create("Ext.panel.Panel",{autoScroll:!0,margin:20,cls:"border-grid",tbar:this.getToolbar(),items:[this.sessionGrid.getPanel()]}),this.container},ManagerWelcomeMainView.prototype.displayProposals=function(a){var b=this;this.container.removeAll(),this.proposalGrid.onSelected.attach(function(a,c){function d(a,c){b.displaySessions(c,c.length+" sessions for proposal "+e),b.panel.setLoading(!1)}b.panel.setLoading(!0);var e=c.Proposal_proposalCode+c.Proposal_proposalNumber;EXI.getDataAdapter({onSuccess:d}).proposal.session.getSessionsByProposal(e),b.activeProposal(c.Proposal_proposalCode+c.Proposal_proposalNumber)}),this.container.insert(this.proposalGrid.getPanel()),this.proposalGrid.load(a)},ManagerWelcomeMainView.prototype.loadByDate=function(a,b,c){function d(a,c){e.displaySessions(c,c.length+" sessions scheduled on "+moment(b,"YYYYMMDD").format("MMMM Do YYYY")),e.panel.setLoading(!1)}var e=this;this.panel.setLoading(!0),c=moment(c,"YYYYMMDD").add(1,"days").format("YYYYMMDD"),this.isUser(a)?EXI.getDataAdapter({onSuccess:d}).proposal.session.getSessionsByProposalAndDate(b,c,a):EXI.getDataAdapter({onSuccess:d}).proposal.session.getSessionsByDate(b,c)},ManagerWelcomeMainView.prototype.filterSessions=function(a){a.length;return data=_.slice(a,0,500),_(a).forEach(function(a){a.ms=moment(a.BLSession_startDate,"MMM DD, YYYY h:mm:ss a").format("x")}),a=_.orderBy(a,["ms"],["desc"]),a.slice(0,300)},ManagerWelcomeMainView.prototype.displaySessions=function(a,b){var c=this;this.container.removeAll(),this.container.insert(this.sessionGrid.getPanel()),this.sessionGrid.onSelected.attach(function(a,b){EXI.proposalManager.clear(),c.activeProposal(b.proposalCode+b.proposalNumber)}),this.sessionGrid.load(this.filterSessions(a)),this.sessionGrid.panel.setTitle(b)},ManagerWelcomeMainView.prototype.getToolbar=function(){var a=this,b=Ext.create("Ext.menu.DatePicker",{handler:function(b,c){location.href="#/welcome/manager/"+a.username+"/date/"+Ext.Date.format(c,"Ymd")+"/"+Ext.Date.format(c,"Ymd")+"/main"}});return Ext.create("Ext.toolbar.Toolbar",{width:500,cls:"exi-top-bar",items:[{text:"Choose a Date",icon:"../images/icon/sessions.png",menu:b},{xtype:"textfield",name:"field1",width:300,emptyText:"enter search term (proposal or title)",listeners:{specialkey:function(b,c){if(c.getKey()==c.ENTER){var d=a.searchProposalByTerm(b.getValue());a.displayProposals(d)}}}}]})},ManagerWelcomeMainView.prototype.searchProposalByTerm=function(a){var b=[];if(null!=this.proposals)for(var c=0;c<this.proposals.length;c++){var d=this.proposals[c].Proposal_proposalCode+this.proposals[c].Proposal_proposalNumber,e=this.proposals[c].Proposal_title;null==e&&(e=""),(d.toUpperCase().match(a.toUpperCase())||e.toUpperCase().match(a.toUpperCase()))&&b.push(this.proposals[c])}return b},ManagerWelcomeMainView.prototype.loadProposals=function(a){var b=this,c=function(c,d){b.proposals=d,a&&a()};EXI.getDataAdapter({onSuccess:c}).proposal.proposal.getProposals()},ManagerWelcomeMainView.prototype.isUser=function(a){return!EXI.credentialManager.getCredentialByUserName(a).isManager()&&!EXI.credentialManager.getCredentialByUserName(a).isLocalContact()},ManagerWelcomeMainView.prototype.load=function(a){if(this.username=a,this.isUser(a))this.loadSessionsByProposal(a),this.activeProposal(a);else{var b=moment().format("YYYYMMDD");this.loadSessionsByDate(a,b,b)}EXI.setLoadingMainPanel(!1)},ManagerWelcomeMainView.prototype.loadSessionsByProposal=function(a){function b(b,d){c.displaySessions(d,"Sessions for proposal "+a),c.panel.setLoading(!1)}this.username=a;var c=this;this.panel.setLoading(!0),EXI.getDataAdapter({onSuccess:b}).proposal.session.getSessionsByProposal(a)},ManagerWelcomeMainView.prototype.loadSessionsByDate=function(a,b,c){this.username=a,this.loadByDate(a,b,c),this.loadProposals()},ManagerWelcomeMainView.prototype.loadSessionsByTerm=function(a,b){this.username=a;var c=this,d=function(a,d){c.proposals=d,c.searchProposalByTerm(b)};EXI.getDataAdapter({onSuccess:d}).proposal.proposal.getProposals()},RunMainView.prototype.getPanel=MainView.prototype.getPanel,RunMainView.prototype.getOutputPanel=function(){return this.outputStore=Ext.create("Ext.data.Store",{fields:["name","value","type","targetId","tool","i"],groupField:"tool",sorters:[{property:"i",direction:"DESC"}]}),Ext.create("Ext.grid.Panel",{store:this.outputStore,cls:"border-grid",features:[{ftype:"grouping"}],columns:[{text:"Tool",dataIndex:"tool",flex:1,hidden:!0},{text:"id",dataIndex:"i",flex:1,hidden:!0},{text:"Name",dataIndex:"name",flex:1},{text:"value",dataIndex:"value",flex:1},{text:"type",dataIndex:"type",flex:1},{text:"target",dataIndex:"targetId",flex:1,hidden:!0},{text:"",dataIndex:"targetId",flex:1,renderer:function(a,b,c){var d=EXI.credentialManager.getConnections()[0].exiUrl+"/file/"+c.data.targetId+"/download";return"<div><a style='color:blue;' href='"+d+"'>Download</a></div>"}}]})},RunMainView.prototype.getGeneralContainerList=function(a){var b="<ul class='generalContainerRunList'>";return b=b+"<li>Name: "+a.name+"</li>",b=b+"<li>Status: "+a.status+"</li>",b=b+"<li>"+a.creationDate+"</li>"},RunMainView.prototype.getGeneralContainer=function(a){return{xtype:"panel",title:"General",margin:10,border:1,style:{borderColor:"gray",borderStyle:"solid",borderWidth:"1px"},items:[{html:this.getGeneralContainerList(a),margin:"10 0 0 50"}]}},RunMainView.prototype.getMainPanel=function(){},RunMainView.prototype.getTabs=function(){return Ext.createWidget("tabpanel",{plain:!0,margin:"20 0 0 0",items:[this.getMainPanel(),{tabConfig:{title:"Output Files"},items:[{xtype:"container",layout:"fit",height:700,padding:20,cls:"border-grid",items:[this.getOutputPanel()]}]}]})},RunMainView.prototype.getContainer=function(){return Ext.create("Ext.container.Container",{layout:{type:"anchor"},defaults:{anchor:"100%",hideEmptyLabel:!1},margin:5,bodyStyle:{"background-color":"#E6E6E6"},items:[this.getTabs()]})},RunMainView.prototype.loadMain=function(a){},RunMainView.prototype.load=function(a){if(null!=a){this.panel.setTitle(a.name);for(var b=[],c=0;c<a.jobs.length;c++)for(var d=0;d<a.jobs[c].output.length;d++)a.jobs[c].output[d].tool=a.jobs[c].name+" "+a.jobs[c].version,a.jobs[c].output[d].i=c,b.push(a.jobs[c].output[d]);this.outputStore.loadData(b)}this.loadMain(a)},DimpleRunMainView.prototype.getPanel=RunMainView.prototype.getPanel,DimpleRunMainView.prototype.getOutputPanel=RunMainView.prototype.getOutputPanel,DimpleRunMainView.prototype.getTabs=RunMainView.prototype.getTabs,DimpleRunMainView.prototype.getContainer=RunMainView.prototype.getContainer,DimpleRunMainView.prototype.load=RunMainView.prototype.load,DimpleRunMainView.prototype.getFilesGrid=function(){var a=this;this.filesStore=Ext.create("Ext.data.Store",{fields:["name","targetId"]});var b=Ext.create("Ext.selection.RowModel",{allowDeselect:!0,listeners:{selectionchange:function(b,c){console.log(c[0].data);var d=function(b,c){document.getElementById(a.id+"display").innerHTML="<textarea rows='100' cols='100'> "+c+"</textarea>"};-1==c[0].data.name.indexOf(".mtz")?EXI.getDataAdapter({onSuccess:d}).exi.offline.getFileContent(c[0].data.targetId):d(this,"No text available")}}});return Ext.create("Ext.grid.Panel",{title:"Files",store:this.filesStore,selModel:b,cls:"border-grid",height:400,columns:[{text:"Name",dataIndex:"name",flex:1}]})},DimpleRunMainView.prototype.getMainPanel=function(){var a=Ext.create("Ext.data.Store",{fields:["key","value"]});return this.generalGrid=Ext.create("Ext.grid.Panel",{title:"General",store:a,layout:"fit",columns:[{text:"Name",dataIndex:"name"},{text:"Seniority",dataIndex:"seniority"}],flex:1}),{tabConfig:{title:"Dimple"},items:[{xtype:"container",height:700,cls:"border-grid",items:[{xtype:"container",layout:"hbox",items:[{xtype:"container",layout:"fit",flex:.4,margin:5,items:[this.getFilesGrid(),{html:"<br />"},{html:'<div id="'+this.id+'blobs";><div>'}]},{xtype:"container",layout:"fit",flex:.6,margin:5,height:400,cls:"border-grid",items:[{html:'<div id="'+this.id+'display";><div>'}]}]},{xtype:"container",margin:5,height:210,layout:"fit",flex:1,items:[{html:'<div style="height:200px"  id="'+this.id+'snapshots";><div>'}]}]}]}},DimpleRunMainView.prototype.loadBlobs=function(a){var b=[],c=0;for(c=0;c<a.output.length;c++)"blob"==a.output[c].type&&b.push(a.output[c]);var d=(document.createElement("div"),document.createElement("table")),e=document.createElement("tr");for(c=0;c<b.length;c++){var f=document.createElement("td"),g=document.createElement("img");g.setAttribute("src",EXI.getDataAdapter().exi.offline.getFileImage(b[c].targetId)),g.setAttribute("height","180px"),g.setAttribute("width","180px"),g.setAttribute("hspace","10"),g.setAttribute("onclick","window.open(this.src)"),f.appendChild(g),e.appendChild(f)}d.appendChild(e),document.getElementById(this.id+"snapshots").innerHTML=d.innerHTML},DimpleRunMainView.prototype.loadFiles=function(a){for(var b=[],c=0;c<a.output.length;c++)"blob"!=a.output[c].type&&b.push(a.output[c]);this.filesStore.loadData(b)},DimpleRunMainView.prototype.loadMain=function(a){if(console.log(a),null!=a&&null!=a.jobs&&a.jobs.length>0)for(var b=0;b<a.jobs.length;b++)this.loadBlobs(a.jobs[b]),this.loadFiles(a.jobs[b])},SessionMainView.prototype.getPanel=MainView.prototype.getPanel,SessionMainView.prototype.getContainer=function(){return _this=this,this.subpanel=Ext.create("Ext.container.Container",{layout:"fit",border:0,items:[]}),this.panel=Ext.create("Ext.container.Container",{layout:"hbox",margin:10,items:[{html:'<div style="height:600px" id="'+this.id+'"></div>',height:600,border:0,width:600},this.subpanel],listeners:{afterrender:function(){_this.showCalendar([])}}}),this.panel},SessionMainView.prototype.showCalendar=function(a){function b(a){c.loadByDate(moment(new Date(a.startDate)).format("YYYYMMDD"))}var c=this;$("#"+c.id).empty(),$("#"+this.id).calendar({enableContextMenu:!0,enableRangeSelection:!0,selectRange:function(a){b({startDate:a.startDate,endDate:a.endDate})},mouseOnDay:function(a){if(a.events.length>0){var b="";for(var c in a.events)b+="<div class='event-tooltip-content'><div class='event-name' style='color:"+a.events[c].color+"'>"+a.events[c].name+"</div><div class='event-location'>"+a.events[c].location+"</div></div>";$(a.element).popover({trigger:"manual",container:"body",html:!0,content:b}),$(a.element).popover("show")}},mouseOutDay:function(a){a.events.length>0&&$(a.element).popover("hide")},dayContextMenu:function(a){$(a.element).popover("hide")},dataSource:a})},SessionMainView.prototype.getBadge=function(a,b){return b&&0!=b?"<span>"+a+'  <span class="badge">'+b+"</span></span><br />":""},SessionMainView.prototype.getLocation=function(a){var b=this.getBadge("Collect",a.dataCollectionGroupCount);return b+=this.getBadge("Images",a.imagesCount),b+=this.getBadge("XRF",a.xrfSpectrumCount),b+=this.getBadge("Energy",a.energyScanCount),b+this.getBadge("Sample",a.sampleCount)},SessionMainView.prototype.load=function(a){for(var b=[],c=0;c<a.length;c++)b.push({id:a[c].sessionId,name:a[c].Proposal_proposalCode+a[c].Proposal_ProposalNumber+"( "+a[c].beamLineName+" )",location:this.getLocation(a[c]),startDate:new Date(a[c].BLSession_startDate),endDate:new Date(a[c].BLSession_endDate)});this.showCalendar(b),this.subpanel.insert(this.sessionGrid.getPanel());var d=this;if($("#"+this.id+"_header")&&EXI.proposalManager.getProposals().length>0){var e=EXI.proposalManager.getProposals()[0];e.sessionCount=a.length,dust.render("welcomemainviewproposalheader",e,function(a,b){$("#"+d.id+"_header").html(b),d.panel.insert(0,{html:b,border:0,margin:"10 0 0 10",width:600})})}},SessionMainView.prototype.loadByDate=function(a){function b(a,b){c.sessionGrid.load(b),c.panel.setLoading(!1)}var c=this;this.panel.setLoading(!0);var d=EXI.credentialManager.getCredentials()[0].activeProposals[0],e=moment(a,"YYYYMMDD").format("YYYYMMDD");EXI.getDataAdapter({onSuccess:b}).proposal.session.getSessionsByProposalAndDate(a,e,d)},CaseForm.prototype.fillStores=function(){var a=this;this.panel.setLoading("Loading Labcontacts from database");var b=BUI.getProposal();b.onDataRetrieved.attach(function(b,c){a.labContactForSendingStore.loadData(c,!1),a.labContactForReturnStore.loadData(c,!1),a.panel.setLoading(!1)}),b.getLabContactsByProposalId()},CaseForm.prototype.refresh=function(a){this.setDewar(a)},CaseForm.prototype.getDewar=function(){return this.dewar.code=Ext.getCmp(this.id+"dewar_code").getValue(),this.dewar.comments=Ext.getCmp(this.id+"dewar_comments").getValue(),this.dewar.transportValue=Ext.getCmp(this.id+"dewar_transportValue").getValue(),this.dewar.storageLocation=this.storageLocationComboBox.getValue(),this.dewar},CaseForm.prototype.setDewar=function(a){this.dewar=a,null==this.dewar&&(this.dewar={},this.dewar.code="",this.dewar.transportValue="",this.dewar.storageLocation="",this.dewar.comments=""),Ext.getCmp(this.id+"dewar_code").setValue(this.dewar.code),Ext.getCmp(this.id+"dewar_comments").setValue(this.dewar.comments),Ext.getCmp(this.id+"dewar_transportValue").setValue(this.dewar.transportValue),this.storageLocationComboBox.setValue(this.dewar.storageLocation)},CaseForm.prototype.getStorageLocationCombo=function(){return this.storageLocationComboBox=BIOSAXS_COMBOMANAGER.getComboStorageTemperature(),this.storageLocationComboBox},CaseForm.prototype.getPanel=function(a){return this.panel=Ext.create("Ext.form.Panel",{width:this.width-10,padding:10,height:320,items:[{xtype:"container",margin:"2 2 2 2",collapsible:!1,defaultType:"textfield",layout:"anchor",items:[{xtype:"container",layout:"vbox",items:[{xtype:"requiredtextfield",fieldLabel:"Name",allowBlank:!1,name:"code",id:this.id+"dewar_code",labelWidth:200,width:500}]},this.getStorageLocationCombo(),{xtype:"numberfield",width:500,labelWidth:200,margin:"10 0 0 0",fieldLabel:"Transport Value",id:this.id+"dewar_transportValue"},{xtype:"textareafield",name:"comments",fieldLabel:"Comments",labelWidth:200,width:500,margin:"10 0 0 0",height:100,id:this.id+"dewar_comments"}]}]}),this.refresh(a),this.panel},ContainerSpreadSheet.prototype.getPanel=function(){var a=this;return this.panel=Ext.create("Ext.panel.Panel",{layout:"vbox",height:this.height+50,items:[{html:'<div  style="overflow: auto;overflow-y: hidden; border:1px solid gray;background-color:white;height:500px;width:'+(a.width-20)+'px"; id="'+this.id+'_samples"; ></div>',margin:"20 0 20 10",height:this.height,width:this.width,autoScroll:!0,resizable:!0}]}),this.panel},ContainerSpreadSheet.prototype.getSamplesData=function(a){function b(a,b){for(var c=0;c<a.length;c++)if(a[c].location==Number(b))return a[c]}function c(a){return a?a:""}var d=a.sampleVOs,e=[];d.sort(function(a,b){return Number(a.location)-Number(b.location)});for(var f=0;f<a.capacity;f++){var g=b(d,f+1);if(null!=g){var h=g.crystalVO,i=h.proteinVO,j=g.diffractionPlanVO;null==j&&(j={}),e.push([f+1,i.acronym,g.name,h.spaceGroup,j.experimentKind,g.code,c(j.observedResolution),j.requiredResolution,j.preferredBeamDiameter,j.numberOfPositions,j.radiationSensitivity,j.requiredMultiplicity,j.requiredCompleteness,h.cellA,h.cellB,h.cellC,h.cellAlpha,h.cellBeta,h.cellGamma,g.smiles,g.comments])}else e.push([f+1])}return e},ContainerSpreadSheet.prototype.getSpaceGroups=function(){return["P1","P2","P21","C2","P222","P2221","P21212","P212121","C222","C2221","F222","I222","I212121","P4","P41","P42","P43","P422","P4212","P4122","P41212","P4222","P42212","P4322","P43212","I4","I41","I422","I4122","P3","P31","P32","P31","P321","P3112","P3121","P3212","P3221","P6","P61","P65","P62","P64","P63","P622","P6122","P6522","P6222","P6422","P6322","R3","R32","P23","P213","P432","P4232","P4332","P4132","F23","F432","F4132","I23","I213","I432","I4132","UNKNOWN"];
},ContainerSpreadSheet.prototype.getAcronyms=function(){for(var a=EXI.proposalManager.getProteins(),b=[],c=0;c<a.length;c++)b.push(a[c].acronym);return b},ContainerSpreadSheet.prototype.getHeader=function(){return[{text:"#",id:"position",column:{width:20}},{text:"Protein <br />Acronym",id:"Protein Acronym",column:{width:60,type:"dropdown",source:this.getAcronyms()}},{text:"Sample<br /> Name",id:"Sample Name",column:{width:120}},{text:"Space<br /> Group",id:"Space Group",column:{width:90,type:"dropdown",source:this.getSpaceGroups()}},{text:"Exp.<br /> Type",id:"Experiment Type",column:{width:80,type:"dropdown",source:["Default","MXPressE","MXPressO","MXPressI","MXPressE_SAD","MXScore","MXPressM"]}},{text:"Pin <br />BarCode",id:"Pin BarCode",column:{width:45}},{text:"Pre-observed <br />resolution",id:"Pre-observed resolution",column:{width:45}},{text:"Needed<br /> resolution",id:"Needed resolution",column:{width:45}},{text:"Pref. <br />Diameter",id:"Pref. Diameter",column:{width:45}},{text:"Number Of<br /> positions",id:"Number Of positions",column:{width:45}},{text:"Radiation<br /> Sensitivity",id:"Radiation Sensitivity",column:{width:60}},{text:"Required<br /> multiplicity",id:"Required multiplicity",column:{width:60}},{text:"Required<br /> Completeness",id:"Required Completeness",column:{width:60}},{text:"A",id:"Unit cell A",column:{width:40}},{text:"B",id:"Unit cell B",column:{width:40}},{text:"C",id:"Unit cell C",column:{width:40}},{text:"&#945;",id:"Unit cell Alpha",column:{width:40}},{text:"&#946;",id:"Unit cell Beta",column:{width:40}},{text:"&#947;",id:"Unit cell Gamma",column:{width:40}},{text:"Smiles",id:"Required Completeness",column:{width:45}},{text:"Comments",id:"Comments",column:{width:45}}]},ContainerSpreadSheet.prototype.getHeaderWidth=function(){for(var a=this.getHeader(),b=[],c=0;c<a.length;c++)b.push(a[c].column["with"]);return b},ContainerSpreadSheet.prototype.getHeaderId=function(){for(var a=this.getHeader(),b=[],c=0;c<a.length;c++)b.push(a[c].id);return b},ContainerSpreadSheet.prototype.getHeaderText=function(){for(var a=this.getHeader(),b=[],c=0;c<a.length;c++)b.push(a[c].text);return b},ContainerSpreadSheet.prototype.getColumns=function(){for(var a=[],b=0;b<this.getHeader().length;b++)a.push(this.getHeader()[b].column);return a},ContainerSpreadSheet.prototype.getPuck=function(){function a(a){return _.filter(a,function(a){return a.location==c[e].location})}for(var b=JSON.parse(JSON.stringify(this.puck)),c=this.parseTableData(),d=[],e=0;e<c.length;e++){var f={},g=a(b.sampleVOs);g.length>0&&(f=g[0]),f.name=c[e]["Sample Name"],f.smiles=c[e].Smiles,f.location=c[e].location,f.comments=c[e].Comments;var h=[];null==f.crystalVO?(f.crystalVO={},h=EXI.proposalManager.getProteinByAcronym(c[e]["Protein Acronym"]),null!=h&&(f.crystalVO.proteinVO=h[0])):(h=EXI.proposalManager.getProteinByAcronym(c[e]["Protein Acronym"]),null!=h&&(f.crystalVO.proteinVO=h[0])),f.crystalVO.spaceGroup=c[e]["Space Group"],f.crystalVO.cellA=Number(c[e]["Unit cell A"]),f.crystalVO.cellB=Number(c[e]["Unit cell B"]),f.crystalVO.cellC=Number(c[e]["Unit cell C"]),f.crystalVO.cellAlpha=Number(c[e]["Unit cell Alpha"]),f.crystalVO.cellBeta=Number(c[e]["Unit cell Beta"]),f.crystalVO.cellGamma=Number(c[e]["Unit cell Gamma"]),f.diffractionPlanVO={},f.diffractionPlanVO.radiationSensitivity=Number(c[e]["Radiation Sensitivity"]),f.diffractionPlanVO.requiredCompleteness=Number(c[e]["Required Completeness"]),f.diffractionPlanVO.requiredMultiplicity=Number(c[e]["Required multiplicity"]),f.diffractionPlanVO.requiredResolution=Number(c[e]["Needed resolution"]),f.diffractionPlanVO.observedResolution=Number(c[e]["Pre-observed resolution"]),f.diffractionPlanVO.preferredBeamDiameter=Number(c[e]["Pref. Diameter"]),f.diffractionPlanVO.numberOfPositions=Number(c[e]["Number Of positions"]),f.diffractionPlanVO.experimentKind=c[e]["Experiment Type"],d.push(f)}return b.sampleVOs=d,b},ContainerSpreadSheet.prototype.parseTableData=function(){for(var a=[],b=this.spreadSheet.getData(),c=0;c<b.length;c++){var d={};d.location=c+1;for(var e=0;e<b[c].length;e++){var f=this.getHeaderId()[e],g=b[c][e];d[f]=g}d["Protein Acronym"]&&d["Protein Acronym"].length>0&&a.push(d)}for(var h=[],i=0;i<a.length;i++)null!=a[i]["Protein Acronym"]&&h.push(a[i]);return h},ContainerSpreadSheet.prototype.load=function(a){function b(a,b,c,d,e,f,g){return Handsontable.renderers.TextRenderer.apply(this,arguments),a.getDataAtRow(c)[1]?void(2==d&&(f&&""!=f||(b.className="custom-row-text-required"))):void(b.style.background="#EEE")}this.puck=a;var c=document.getElementById(this.id+"_samples");Handsontable.renderers.registerRenderer("ValueRenderer",b);this.spreadSheet=new Handsontable(c,{beforeChange:function(a,b){lastChange=a},data:this.getSamplesData(a),height:this.height,width:this.width,manualColumnResize:!0,colWidths:this.getHeaderWidth(),colHeaders:this.getHeaderText(),stretchH:"last",columns:this.getColumns()})},ParcelGrid.prototype._getTopButtons=function(){var a=this;return[Ext.create("Ext.Action",{icon:"../images/icon/add.png",text:"Add New Parcel",disabled:!1,handler:function(b,c){a.edit()}})]},ParcelGrid.prototype.load=function(a){function b(a,b){c.panel.setLoading(),b.sessionId=b.firstExperimentId,b.shippingId=c.shipment.shippingId;var d=(new DataAdapter,function(a,b){c.panel.setLoading(!1)});EXI.getDataAdapter({onSuccess:d}).proposal.dewar.saveDewar(c.shipment.shippingId,b)}var c=this;this.shipment=a,this.dewars=a.dewarVOs,this.parcelForms=[],this.panel.removeAll(),this.dewars.sort(function(a,b){return a.dewarId-b.dewarId});for(var d in this.dewars){var e=new ParcelPanel({height:340});this.panel.insert(e.getPanel()),e.load(this.dewars[d]),e.onSavedClick.attach(b),this.parcelForms.push(e)}},ParcelGrid.prototype.edit=function(a){var b=this,c=new CaseForm,d=Ext.create("Ext.window.Window",{title:"Parcel",height:450,width:600,modal:!0,layout:"fit",items:[c.getPanel(a)],listeners:{afterrender:function(a,c){null!=b.puck&&b.render(b.puck)}},buttons:[{text:"Save",handler:function(){new DataAdapter;b.panel.setLoading();var a=c.getDewar(),e=function(a,c){b.load(c),b.panel.setLoading(!1),d.close()};a.sessionId=a.firstExperimentId,a.shippingId=b.shipment.shippingId,EXI.getDataAdapter({onSuccess:e}).proposal.dewar.saveDewar(b.shipment.shippingId,a)}},{text:"Cancel",handler:function(){d.close()}}]});d.show()},ParcelGrid.prototype.getPanel=function(){var a=this;return this.panel=Ext.create("Ext.panel.Panel",{cls:"border-grid",height:800,autoScroll:!0}),this.panel.addDocked({height:45,xtype:"toolbar",items:a._getTopButtons(),cls:"exi-top-bar"}),this.panel},PuckForm.prototype.load=function(a,b){this.puck=a,null!=a&&(Ext.getCmp(this.id+"puck_name").setValue(this.puck.code),this.capacityCombo.setValue(this.puck.capacity),Ext.getCmp(this.id+"puck_beamline").setValue(this.puck.beamlineLocation),Ext.getCmp(this.id+"puck_sampleChangerLocation").setValue(this.puck.sampleChangerLocation),Ext.getCmp(this.id+"puck_status").setValue(this.puck.containerStatus)),this.containerSpreadSheet.load(a)},PuckForm.prototype.getToolBar=function(){var a=this;return[{text:"Remove",width:100,height:30,cls:"btn-red",handler:function(){function b(b){"yes"==b&&a.removePuck()}Ext.MessageBox.show({title:"Remove",msg:"Removing a puck from this parcel will remove also its content. <br />Are you sure you want to continue?",buttons:Ext.MessageBox.YESNO,fn:b,animateTarget:"mb4",icon:Ext.MessageBox.QUESTION})}},"->",{text:"Save",width:100,height:30,handler:function(){a.save()}}]},PuckForm.prototype.removePuck=function(){this.panel.setLoading();var a=function(a,b){},b=this.puck.containerId;EXI.getDataAdapter({onSuccess:a}).proposal.shipping.removeContainerById(b,b,b)},PuckForm.prototype.save=function(){var a=this;this.panel.setLoading("Saving Puck");var b=this.containerSpreadSheet.getPuck();b.code=Ext.getCmp(a.id+"puck_name").getValue(),b.capacity=a.capacityCombo.getValue();var c=function(b,c){a.panel.setLoading(!1),EXI.setError(c.responseText)},d=function(b,c){a.panel.setLoading(!1),a.load(c),a.onSaved.notify()};EXI.getDataAdapter({onSuccess:d,onError:c}).proposal.shipping.saveContainer(this.puck.containerId,this.puck.containerId,this.puck.containerId,b)},PuckForm.prototype.containerTypeChanged=function(a){this.puck.capacity=a;var b=this.containerSpreadSheet.spreadSheet.getData();if(b.length<a)for(var c=b.length;a>=c;c++)b.push([c]);else b=b.slice(0,a);this.containerSpreadSheet.spreadSheet.loadData(b)},PuckForm.prototype.getPanel=function(){var a=this,b=BIOSAXS_COMBOMANAGER.getComboPuckType({margin:"10 0 10 5",labelWidth:100,width:250});return b.on("select",function(b,c){var d=c[0].data.value;a.containerTypeChanged(d)}),this.capacityCombo=b,this.panel=Ext.create("Ext.panel.Panel",{buttons:this.getToolBar(),items:[{xtype:"container",margin:"5 0 2 5",layout:"hbox",items:[{xtype:"container",margin:"12 0 2 0",layout:"vbox",items:[{xtype:"requiredtextfield",id:this.id+"puck_name",fieldLabel:"Name",name:"name",width:250,margin:"0 0 0 5",labelWidth:100},this.capacityCombo,{xtype:"textfield",id:this.id+"puck_beamline",fieldLabel:"Beamline",width:250,disabled:!0,margin:"0 0 0 5",labelWidth:100},{xtype:"textfield",id:this.id+"puck_sampleChangerLocation",fieldLabel:"#Sample Changer",width:250,disabled:!0,margin:"0 0 0 5",labelWidth:100},{xtype:"textfield",id:this.id+"puck_status",fieldLabel:"Status",width:250,disabled:!0,margin:"0 0 0 5",labelWidth:100}]}]},this.containerSpreadSheet.getPanel()]}),this.panel},ShipmentForm.prototype.fillStores=function(){this.panel.setLoading("Loading Labcontacts from database");var a=EXI.proposalManager.getLabcontacts();this.labContactForSendingStore.loadData(a,!1),a.sort(function(a,b){return a.cardName<b.cardName?-1:a.cardName>b.cardName?1:0}),$.extend(a,[{cardName:"Same as for shipping to beamline",labContactId:-1},{cardName:"No return requested",labContactId:0}]),this.labContactForReturnStore.loadData(a,!1),this.labContactsReturnCombo.setValue(-1),this.panel.setLoading(!1),null!=this.shipment&&this.setShipment(this.shipment)},ShipmentForm.prototype.draw=function(a){this.getPanel().render(a)},ShipmentForm.prototype.load=function(a){this.shipment=a;var b=this;if(Ext.getCmp(b.id+"shippingName").setValue(a.shippingName),Ext.getCmp(b.id+"comments").setValue(a.comments),null!=a.sendingLabContactVO&&this.labContactsSendingCombo.setValue(a.sendingLabContactVO.labContactId),null==a.returnLabContactVO?this.labContactsReturnCombo.setValue(0):a.returnLabContactVO.labContactId==a.sendingLabContactVO.labContactId?this.labContactsReturnCombo.setValue(-1):this.labContactsReturnCombo.setValue(a.returnLabContactVO.labContactId),null!=a.sessions&&a.sessions.length>0){var c=a.sessions[0];this.sessionComboBox.setValue(c.sessionId)}},ShipmentForm.prototype._saveShipment=function(){var a=this,b=null;null!=this.shipment&&(b=this.shipment.shippingId);var c=this.labContactsSendingCombo.getValue(),d=this.labContactsReturnCombo.getValue();if(null==c)return void BUI.showError("User contact information for shipping to beamline is mandatory");0==this.labContactsReturnCombo.getValue()&&(d=0),-1==this.labContactsReturnCombo.getValue()&&(d=-1);var e=EXI.proposalManager.getLabcontactById(c),f={shippingId:b,name:Ext.getCmp(a.id+"shippingName").getValue(),status:"Not set",sendingLabContactId:c,returnLabContactId:d,returnCourier:d,courierAccount:e.courierAccount,billingReference:e.billingReference,dewarAvgCustomsValue:e.dewarAvgCustomsValue,dewarAvgTransportValue:e.dewarAvgTransportValue,comments:Ext.getCmp(a.id+"comments").getValue(),sessionId:this.sessionComboBox.getValue()},g=function(b,c){location.hash="#/shipping/"+c.shippingId+"/main",a.panel.setLoading(!1),a.onSaved.notify(c)};return""==f.name?void BUI.showError("Name field is mandatory"):null==f.sendingLabContactId?void BUI.showError("Lab contact for sending field is mandatory"):(this.panel.setLoading(),void EXI.getDataAdapter({onSuccess:g}).proposal.shipping.saveShipment(f))},ShipmentForm.prototype.getPanel=function(){var a=this,b='<span style="color:red;font-weight:bold" data-qtip="Required">*</span>',c=[];return a.creationMode?c.push({text:"Create",scope:this,handler:function(){a._saveShipment()}}):c.push({text:"Save",scope:this,handler:function(){a._saveShipment()}}),this.labContactForSendingStore=Ext.create("Ext.data.Store",{fields:["cardName","labContactId"],sorters:"cardName"}),this.labContactForReturnStore=Ext.create("Ext.data.Store",{fields:["cardName","labContactId"]}),this.labContactsSendingCombo=Ext.create("Ext.form.ComboBox",{id:a.id+"shipmentform_sendingLabContactId",fieldLabel:"Shipping Card to ESRF",afterLabelTextTpl:b,store:this.labContactForSendingStore,queryMode:"local",labelWidth:200,width:600,margin:"10 0 0 10",displayField:"cardName",valueField:"labContactId"}),this.labContactsReturnCombo=Ext.create("Ext.form.ComboBox",{id:a.id+"returnLabContactId",fieldLabel:"Shipping Card to HOME",afterLabelTextTpl:b,store:this.labContactForReturnStore,queryMode:"local",margin:"10 0 0 10",labelWidth:200,width:600,displayField:"cardName",valueField:"labContactId"}),this.sessionComboBox=BIOSAXS_COMBOMANAGER.getComboSessions(EXI.proposalManager.getSessions(),{margin:"10 0 0 10",width:400,labelWidth:200}),null==this.panel&&(this.panel=Ext.create("Ext.form.Panel",{bodyPadding:5,cls:"border-grid",buttons:c,items:[{xtype:"requiredtextfield",fieldLabel:"Name",allowBlank:!1,labelWidth:200,width:400,margin:"10 20 0 10",name:"shippingName",id:a.id+"shippingName",value:""},this.sessionComboBox,{xtype:"textareafield",name:"comments",id:a.id+"comments",fieldLabel:"Comments",value:"",labelWidth:200,margin:"10 20 0 10",width:500},this.labContactsSendingCombo,this.labContactsReturnCombo]})),this.fillStores(),this.panel},ShippingMainView.prototype.getPanel=MainView.prototype.getPanel,ShippingMainView.prototype.getContainer=MainView.prototype.getContainer,ShippingMainView.prototype.getContainer=function(){return this.tabPanel=Ext.createWidget("tabpanel",{margin:10,defaults:{anchor:"100%"},items:[{tabConfig:{title:"Delivery Details"},items:[this.shipmentForm.getPanel()]},{tabConfig:{id:this.id+"grid",title:"Parcels",icon:"../images/icon/shipping.png"},items:[this.parcelGrid.getPanel()]}]}),this.tabPanel},ShippingMainView.prototype.load=function(a){var b=this;if(this.shippingId=a,null==a&&Ext.getCmp(this.id+"grid").disable(!0),this.panel.setTitle("Shipment"),null!=a){this.panel.setLoading();var c=function(a,c){b.shipmentForm.load(c),b.parcelGrid.load(c),b.panel.setLoading(!1)};EXI.getDataAdapter({onSuccess:c}).proposal.shipping.getShipment(a)}},WelcomeMainView.prototype.getPanel=MainView.prototype.getPanel,WelcomeMainView.prototype.getContainer=function(){return{layout:{type:"fit"},items:[{html:"<iframe style='width:900px;height:900px;' frameBorder='0' src='../html/welcome.html'></iframe>",margin:"50 0 0 50"}]}},WelcomeMainView.prototype.load=function(){},AuthenticationForm.prototype.show=function(){this.window=Ext.create("Ext.window.Window",{title:'Authentication <span style="FONT-SIZE:9PX;color:red;">[INTRANET ONLY]</span>',height:250,closable:!1,width:400,modal:!0,layout:"fit",items:[this.getPanel()]}),this.window.show()},AuthenticationForm.prototype.getPanel=function(){var a=this,b=Ext.create("Ext.data.Store",{fields:["name","url","exiUrl"],data:ExtISPyB.sites});return Ext.create("Ext.form.Panel",{bodyPadding:5,width:350,layout:"anchor",defaults:{anchor:"90%"},defaultType:"textfield",items:[{fieldLabel:"User",name:"user",margin:"10 0 0 10",allowBlank:!1},{fieldLabel:"Password",margin:"10 0 0 10",name:"password",allowBlank:!1,inputType:"password"},{xtype:"combo",fieldLabel:"Choose site",name:"site",store:b,allowBlank:!1,valueField:"url",displayField:"name",margin:"10 0 0 10"}],buttons:[{text:"Login",formBind:!0,disabled:!0,handler:function(){for(var b=this.up("form").getForm(),c=null,d=0;d<ExtISPyB.sites.length;d++)ExtISPyB.sites[d].url==b.getFieldValues().site&&(c=ExtISPyB.sites[d]);a.onAuthenticate.notify({user:b.getFieldValues().user,password:b.getFieldValues().password,site:b.getFieldValues().site,exiUrl:c.exiUrl,properties:c})}}]})},CurvePlotter.prototype.getPanel=function(){return this.plotPanel=Ext.create("Ext.container.Container",{layout:{type:"hbox"},flex:.7,margin:this.margin,items:[{html:'<div id="'+this.targetId+'"></div>',id:this.id}]}),this.plotPanel.on("afterrender",function(){}),this.plotPanel.on("resize",function(){}),this.plotPanel},CurvePlotter.prototype.getPointCount=function(){return this.dygraph.rawData_.length},CurvePlotter.prototype.getColors=function(){return this.dygraph.getColors()},CurvePlotter.prototype.getLabels=function(){return this.dygraph.getLabels()},CurvePlotter.prototype.render=function(a){var b=this;null!=document.getElementById(this.targetId)&&(document.getElementById(this.targetId).innerHTML="",this.width=this.plotPanel.getWidth(),this.height=this.plotPanel.getHeight(),document.getElementById(this.targetId).setAttribute("style","border: 1px solid #000000; height:"+(this.plotPanel.getHeight()-1)+"px;width:"+(this.plotPanel.getWidth()-2)+"px;"),Ext.getCmp(this.id).setHeight(this.plotPanel.getHeight()),Ext.getCmp(this.id).setWidth(this.plotPanel.getWidth()),this.dygraph=new Dygraph(document.getElementById(this.targetId),a,{title:this.title,titleHeight:20,legend:this.legend,labelsSeparateLines:!0,errorBars:!0,connectSeparatedPoints:!0,pointClickCallback:function(a,c){b.onPointClickCallback.notify(c.name)}}),this.dygraph.ready(function(){b.onRendered.notify()}))},CurvePlotter.prototype.loadMerge=function(a,b,c,d){this.render(EXI.getDataAdapter().saxs.hplc.getFramesMergeURL(a,b,c,d))},CurvePlotter.prototype.loadHPLCFrame=function(a,b){this.render(EXI.getDataAdapter().saxs.hplc.getHPLCFramesScatteringURL(a,b))},CurvePlotter.prototype.loadUrl=function(a){this.render(a)},CurvePlotter.prototype.load=function(a){this.render(EXI.getDataAdapter().saxs.frame.getFramesURL(a.frame,a.average,a.subtracted,a.sampleaverage,a.bufferaverage))},AutoProcIntegrationCurvePlotter.prototype.getPointCount=CurvePlotter.prototype.getPointCount,AutoProcIntegrationCurvePlotter.prototype.getLabels=CurvePlotter.prototype.getLabels,AutoProcIntegrationCurvePlotter.prototype.toCSV=function(a,b){for(var c=a.toString()+"\n",d=0;d<b.length;d++){for(var e=0;e<b[d].length;e++)c=c+b[d][e]+",";c=c.substring(0,c.length-1),c+="\n"}return c},AutoProcIntegrationCurvePlotter.prototype.render=function(a,b){var c=this,d=new Dygraph(document.getElementById(this.targetId),this.toCSV(a,b),{title:this.title,titleHeight:20,legend:"always",height:this.height-100,hideOverlayOnMouseOut:!0,labelsSeparateLines:!0,labelsDiv:c.targetId+"_legend",labelsDivStyles:" { 'fontSize': 6 } ",axisLabelWidth:20,connectSeparatedPoints:!0,pointClickCallback:function(a,b){c.onPointClickCallback.notify(b.name)},axes:{x:{pixelsPerXLabel:30,axisLabelFormatter:function(a,b,d){return c.xLabels[a]}}}});d.ready(function(){})},AutoProcIntegrationCurvePlotter.prototype.loadUrl=function(a){$.ajax({url:a,context:this}).done(function(a){var b=0,c=this;if(c.xLabels=[],!a)return void EXI.setError("CSV is empty");var d=a.split("\n");if(d){if(!d[0])return void EXI.setError("No labels on csv");this.data.labels=d[0].split(",");var e=function(a){return a&&""!=a?parseFloat(a):""},f=function(a){var d=[],f=a.split(",");f=_.map(f,e),d.push(b),c.xLabels.push(f[0]);for(var g=1;g<f.length;g++)g%2!=0&&d.push(f[g]);return b+=1,d};d=d.reverse(),this.data.data=_.map(_.slice(d,1,d.length-1),f);try{this.render(this.data.labels,this.data.data)}catch(g){EXI.setError(g.message)}}})},AutoProcIntegrationCurvePlotter.prototype.getHTML=function(){return'<div  id="'+this.targetId+'"></div><div  style="height:20px" id="'+this.targetId+'_legend"></div>'},AutoProcIntegrationCurvePlotter.prototype.getPanel=function(){return this.plotPanel=Ext.create("Ext.panel.Panel",{layout:{type:"fit"},height:this.height,margin:this.margin,items:[{html:this.getHTML(),id:this.id,style:{border:"1px solid black"},height:this.height,border:1}]}),this.plotPanel},ParcelPanel.prototype.addHeaderPanel=function(){var a="No information";dust.render("parcelformsummary",this.dewar,function(b,c){a=c}),this.panel.insert({xtype:"container",width:200,border:1,padding:20,items:[{html:a}]})},ParcelPanel.prototype.render=function(){var a=this.dewar;if(this.panel.removeAll(),this.addHeaderPanel(),null!=a&&null!=a.containerVOs){a.containerVOs.sort(function(a,b){return a.containerId-b.containerId});for(var b=0;b<a.containerVOs.length;b++){var c=a.containerVOs[b],d=new PuckPanel({height:200});this.panel.insert(d.getPanel()),d.load(c)}}},ParcelPanel.prototype.load=function(a){this.dewar=a;try{this.render()}catch(b){console.log(b)}},ParcelPanel.prototype.addPuckToDewar=function(){var a=this,b=function(b,c){a.dewar.containerVOs.push(c),a.load(a.dewar)};EXI.getDataAdapter({onSuccess:b}).proposal.shipping.addPuck(this.dewar.dewarId,this.dewar.dewarId)},ParcelPanel.prototype.showCaseForm=function(){var a=this,b=new CaseForm,c=Ext.create("Ext.window.Window",{title:"Parcel",height:450,width:600,modal:!0,layout:"fit",items:[b.getPanel(a.dewar)],listeners:{afterrender:function(b,c){null!=a.puck&&a.render(a.puck)}},buttons:[{text:"Save",handler:function(){a.onSavedClick.notify(b.getDewar()),c.close()}},{text:"Cancel",handler:function(){c.close()}}]});c.show()},ParcelPanel.prototype._getTopButtons=function(){var a=this,b=[];return b.push(this.code),b.push(this.status),b.push(this.storageCondition),b.push(Ext.create("Ext.Action",{icon:"../images/icon/edit.png",text:"Edit",disabled:!1,handler:function(b,c){a.showCaseForm()}})),b.push(Ext.create("Ext.Action",{icon:"../images/print.png",text:"Print Labels",disabled:!1,handler:function(b,c){var d=a.dewar.dewarId,e=EXI.getDataAdapter().proposal.shipping.getDewarLabelURL(d,d);location.href=e}})),b.push(Ext.create("Ext.Action",{icon:"../images/icon/add.png",text:"Add puck",disabled:!1,handler:function(b,c){a.addPuckToDewar()}})),b},ParcelPanel.prototype.getPanel=function(){var a=this;return this.panel=Ext.create("Ext.panel.Panel",{layout:"hbox",cls:"border-grid",margin:10,height:this.height,autoScroll:!0,items:[],listeners:{afterrender:function(b,c){a.render()}}}),this.panel.addDocked({id:a.id+"tbar",height:45,xtype:"toolbar",items:a._getTopButtons(),cls:"exi-top-bar"}),this.panel},ProposalGrid.prototype.load=function(a){this.data=a,this.store.loadData(a,!1)},ProposalGrid.prototype.getFilter=function(a){return[{property:"Proposal_proposalNumber",value:a,anyMacth:!0}]},ProposalGrid.prototype.filter=function(a){},ProposalGrid.prototype._getTbar=function(){var a=this,b=[];return b.push({xtype:"textfield",name:"field1",emptyText:"search by number",hidden:this.isHidden,listeners:{change:function(b,c){var d=b.getValue();""!=d?a.store.filter(a.getFilter(b.getValue())):(a.store.clearFilter(!0),a.load(a.data))}}}),b},ProposalGrid.prototype.getPanel=function(){var a=this;return this.store=Ext.create("Ext.data.Store",{fields:["Proposal_proposalId","Proposal_title","Proposal_proposalCode","Proposal_proposalNumber","Proposal_proposalType"]}),this.store.sort(["Proposal_proposalCode","Proposal_proposalNumber"]),this.panel=Ext.create("Ext.grid.Panel",{title:"Proposals",store:this.store,tbar:this._getTbar(),layout:"fit",cls:"border-grid",height:this.height,margin:this.margin,emptyText:"No proposals",columns:[{text:"Proposal",dataIndex:"Proposal_code",width:125,renderer:function(a,b,c){return"<a href='#'>"+c.data.Proposal_proposalCode+c.data.Proposal_proposalNumber+"</a>"}},{text:"Code",dataIndex:"Proposal_number",width:75,hidden:!0},{text:"Number",dataIndex:"number",width:75,hidden:!0},{text:"Title",dataIndex:"Proposal_title",flex:1}],flex:1,viewConfig:{stripeRows:!0,listeners:{cellclick:function(b,c,d,e,f,g,h,i){a.onSelected.notify(e.data)}}}}),this.tbar&&this.panel.addDocked({xtype:"toolbar",cls:"toolBarGrid",height:48,items:this._getTbar()}),this.panel},SessionGrid.prototype.load=function(a){this.sessions=a,this.store.loadData(a,!1)},SessionGrid.prototype.filterByBeamline=function(a){if(a)if(a.length>0){for(var b=[],c=0;c<a.length;c++)b=_.concat(b,_.filter(this.sessions,{beamLineName:a[c]}));this.store.loadData(b,!1)}else this.store.loadData(this.sessions,!1)},SessionGrid.prototype.getToolbar=function(a){for(var b=this,c=[],d=function(a,c,d){c?b.beamlineFilter.push(a.boxLabel):b.beamlineFilter=_.remove(b.beamlineFilter,a.boxLabel),b.filterByBeamline(b.beamlineFilter)},e=0;e<EXI.credentialManager.getBeamlines().length;e++)c.push({xtype:"checkbox",boxLabel:EXI.credentialManager.getBeamlines()[e],name:EXI.credentialManager.getBeamlines()[e],handler:d});return Ext.create("Ext.toolbar.Toolbar",{items:c})},SessionGrid.prototype.getPanel=function(){var a=this;return this.store=Ext.create("Ext.data.Store",{fields:["Proposal_ProposalNumber","beamLineName","beamLineOperator","Proposal_title","Person_emailAddress","Person_familyName","Person_givenName","nbShifts","comments"],emptyText:"No sessions",data:[]}),this.panel=Ext.create("Ext.grid.Panel",{title:this.title,store:this.store,tbar:this.getToolbar(),icon:"../images/icon/sessions.png",cls:"border-grid",minHeight:300,width:this.width,height:this.height,margin:this.margin,layout:this.layout,columns:[{text:"",dataIndex:"BLSession_startDate",flex:1,hidden:!0,renderer:function(a,b,c){var d="";return c.data.BLSession_startDate&&(c.data.start=moment(c.data.BLSession_startDate,"MMMM Do YYYY, h:mm:ss a").format("MMMM Do YYYY"),c.data.day=moment(c.data.BLSession_startDate,"MMMM Do YYYY, h:mm:ss a").format("Do"),c.data.month=moment(c.data.BLSession_startDate,"MMMM Do YYYY, h:mm:ss a").format("MMMM"),c.data.year=moment(c.data.BLSession_startDate,"MMMM Do YYYY, h:mm:ss a").format("YYYY")),dust.render("session.grid",c.data,function(a,b){d+=b}),d}},{text:"Start",dataIndex:"BLSession_startDate",flex:2,hidden:!1,renderer:function(a,b,c){var d="#";return d="SAXS"==EXI.credentialManager.getTechniqueByBeamline(c.data.beamLineName)?"#/session/nav/"+c.data.sessionId+"/session":"#/mx/datacollection/session/"+c.data.sessionId+"/main",c.data.BLSession_startDate?"<a href='"+d+"'>"+moment(c.data.BLSession_startDate,"MMMM Do YYYY, h:mm:ss a").format("MMMM Do YYYY")+"</a>":void 0}},{text:"Beamline",dataIndex:"beamLineName",width:125,hidden:!1,renderer:function(a,b,c){var d="#";return d="SAXS"==EXI.credentialManager.getTechniqueByBeamline(c.data.beamLineName)?"#/session/nav/"+c.data.sessionId+"/session":"#/mx/datacollection/session/"+c.data.sessionId+"/main","<a href='"+d+"'>"+c.data.beamLineName+"</a>"}},{text:"Proposal",dataIndex:"Proposal_ProposalNumber",flex:1,hidden:!1,renderer:function(a,b,c){var d=c.data.Proposal_proposalCode+c.data.Proposal_ProposalNumber;return"<a href='#/session/nav' data-toggle='tooltip' title='Open proposal "+d+"'>"+d+"</a>"}},{text:"Shifts",dataIndex:"nbShifts",hidden:this.isHiddenNumberOfShifts,flex:1},{text:"Local Contact",dataIndex:"beamLineOperator",width:200,hidden:this.isHiddenLocalContact,flex:1},{text:"Title",dataIndex:"Proposal_title",width:200,hidden:this.isHiddenTitle,flex:4},{text:"PI",dataIndex:"Proposal_title",width:200,hidden:this.isHiddenPI,renderer:function(a,b,c){return c.data.Person_familyName+", "+c.data.Person_givenName}},{text:"e-mail",dataIndex:"Person_emailAddress",width:200,hidden:!0,flex:1},{text:"Data Collections",dataIndex:"Person_emailAddress",width:200,renderer:function(a,b,c){function d(a,b){return b&&0!=b?'<tr><td><span style="margin-left:10px;margin-top:2px;background-color:#207a7a;" class="badge">'+b+'</span></td><td style="padding-left:10px;">'+a+"</td></tr>":""}function e(a){var b="<table>";return b=b+=d("Energy",a.data.energyScanCount),b+=d("XRF",a.data.xrfSpectrumCount),b+=d("Samples",a.data.sampleCount),b+=d("Test",a.data.testDataCollectionGroupCount),b+=d("Collects",a.data.dataCollectionGroupCount),b+=d("Calibration",a.data.calibrationCount),b+=d("Sample Changer",a.data.sampleChangerCount),b+=d("HPLC",a.data.hplcCount),b+"</table>"}return e(c)}},{text:"End",dataIndex:"BLSession_endDate",hidden:!0,flex:1,renderer:function(a,b,c){return c.data.BLSession_endDate}},{text:"Comments",dataIndex:"comments",hidden:!1,flex:3,renderer:function(a,b,c){return c.data.comments?"<div style='width:50px; wordWrap: break-word;'>"+c.data.comments+"</div>":void 0}}],viewConfig:{stripeRows:!0,getRowClass:function(a,b,c,d){}},listeners:{cellclick:function(b,c,d,e,f,g,h,i){a.onSelected.notify({proposalCode:e.data.Proposal_proposalCode,proposalNumber:e.data.Proposal_ProposalNumber})}}}),this.panel},SAXSExiController.prototype.loadNavigationPanel=ExiController.prototype.loadNavigationPanel,SAXSExiController.prototype.routeNavigation=function(){function a(a){return b.loadNavigationPanel(a)}var b=this;Path.map("#/saxs/:navigation/nav").to(function(){var b=null;if("buffer"==this.params.navigation&&(EXI.clearNavigationPanel(),EXI.setLoadingNavigationPanel(!0),b=new BufferListView,b.onSelect.attach(function(a,b){location.hash="/buffer/"+b[0].bufferId+"/main"}),EXI.addNavigationPanel(b),b.load(EXI.proposalManager.getBuffers()),EXI.setLoadingNavigationPanel(!1),EXI.addMainPanel(new BufferWelcomeMainView)),"stocksolution"==this.params.navigation&&(EXI.clearNavigationPanel(),EXI.setLoadingNavigationPanel(!0),b=new StockSolutionListView,b.onSelect.attach(function(a,b){location.hash="/stocksolution/"+b[0].stockSolutionId+"/main"}),EXI.addNavigationPanel(b),b.load(EXI.proposalManager.getStockSolutions()),EXI.setLoadingNavigationPanel(!1),EXI.addMainPanel(new StockSolutionWelcomeMainView)),"macromolecule"==this.params.navigation&&(EXI.clearNavigationPanel(),EXI.setLoadingNavigationPanel(!0),b=new MacromoleculeListView,b.onSelect.attach(function(a,b){location.hash="/macromolecule/"+b[0].macromoleculeId+"/main"}),EXI.addNavigationPanel(b),b.load(EXI.proposalManager.getMacromolecules()),EXI.setLoadingNavigationPanel(!1),EXI.addMainPanel(new MacromoleculeWelcomeMainView)),"template"==this.params.navigation){EXI.clearNavigationPanel(),EXI.setLoadingNavigationPanel(!0),b=new TemplateListView,b.onSelect.attach(function(a,b){location.hash="/experiment/templateId/"+b[0].experimentId+"/main"});var c=a(b);c.saxs.experiment.getByExperimentByKey("experimentType","TEMPLATE"),EXI.addMainPanel(new ExperimentWelcomeMainView)}}).enter(this.setPageBackground)},SAXSExiController.prototype.setPageBackground=function(){},SAXSExiController.prototype.notFound=function(){},SAXSExiController.prototype.routeExperiment=function(){Path.map("#/experiment/experimentId/:experimentId/main").to(function(){var a=new ExperimentMainView;EXI.addMainPanel(a),a.load(this.params.experimentId),a.onSelect.attach(function(a,b){EXI.localExtorage.selectedSubtractionsManager.append(b)}),a.onDeselect.attach(function(a,b){EXI.localExtorage.selectedSubtractionsManager.remove(b)})}).enter(this.setPageBackground),Path.map("#/experiment/hplc/:experimentId/main").to(function(){var a=new HPLCMainView;EXI.addMainPanel(a),a.load(this.params.experimentId),a.onSelect.attach(function(a,b){EXI.localExtorage.selectedSubtractionsManager.append(b)}),a.onDeselect.attach(function(a,b){EXI.localExtorage.selectedSubtractionsManager.remove(b)})}).enter(this.setPageBackground),Path.map("#/experiment/:key/:value/main").to(function(){EXI.setLoadingMainPanel();var a=function(a,b){if(EXI.setLoadingMainPanel(!1),null!=b&&b.length>0){var c=null;"STATIC"==b[0].experimentType&&(c=new ExperimentMainView),"HPLC"==b[0].experimentType&&(c=new HPLCMainView),"TEMPLATE"==b[0].experimentType&&(c=new TemplateMainView),EXI.addMainPanel(c),c.load(b),c.onSelect.attach(function(a,b){EXI.localExtorage.selectedSubtractionsManager.append(b)}),c.onDeselect.attach(function(a,b){EXI.localExtorage.selectedSubtractionsManager.remove(b)})}};"experimentId"==this.params.key||"templateId"==this.params.key?EXI.getDataAdapter({onSuccess:a}).saxs.experiment.getByExperimentId([this.params.value]):EXI.getDataAdapter({onSuccess:a}).saxs.experiment.getByExperimentByKey(this.params.key,this.params.value)}).enter(this.setPageBackground)},SAXSExiController.prototype.routeDataCollection=function(){Path.map("#/datacollection/macromoleculeAcronym/:value/main").to(function(){
EXI.setLoadingMainPanel("Searching "+this.params.value+"...");var a=function(a,b){if(null!=b)if(b.length>0){var c=new DataCollectionMainView;EXI.addMainPanel(c),c.load(b),c.onSelect.attach(function(a,b){EXI.localExtorage.selectedSubtractionsManager.append(b)}),c.onDeselect.attach(function(a,b){EXI.localExtorage.selectedSubtractionsManager.remove(b)});var d=new DataCollectionListView;d.onSelect.attach(function(a,b){c.filter(b[0].macromoleculeId,b[0].bufferAcronym)}),EXI.addNavigationPanel(d),d.load(b),EXI.setLoadingNavigationPanel(!1)}else BUI.showWarning("No macromolecule has been found");else BUI.showWarning("No data to display");EXI.setLoadingMainPanel(!1)};EXI.getDataAdapter({onSuccess:a}).saxs.dataCollection.getDataCollectionsByKey(this.params.key,this.params.value)}).enter(this.setPageBackground),Path.map("#/saxs/datacollection/:key/:value/main").to(function(){EXI.setLoadingMainPanel();var a=function(a,b){var c=new DataCollectionMainView;EXI.addMainPanel(c),c.load(b),EXI.setLoadingMainPanel(!1),c.onSelect.attach(function(a,b){EXI.localExtorage.selectedSubtractionsManager.append(b)}),c.onDeselect.attach(function(a,b){EXI.localExtorage.selectedSubtractionsManager.remove(b)})};EXI.getDataAdapter({onSuccess:a}).saxs.dataCollection.getDataCollectionsByKey(this.params.key,this.params.value)}).enter(this.setPageBackground),Path.map("#/saxs/datacollection/:key/:value/primaryviewer").to(function(){var a=function(a,b){var c=new PrimaryDataMainView;EXI.addMainPanel(c),c.load(b)};EXI.getDataAdapter({onSuccess:a}).saxs.dataCollection.getDataCollectionsByKey(this.params.key,this.params.value)}).enter(this.setPageBackground),Path.map("#/saxs/datacollection/:key/:value/merge").to(function(){var a=function(a,b){var c=new MergeMainView;EXI.addMainPanel(c),c.load(b)};EXI.getDataAdapter({onSuccess:a}).saxs.dataCollection.getDataCollectionsByKey(this.params.key,this.params.value)}).enter(this.setPageBackground)},SAXSExiController.prototype.routePrepare=function(){Path.map("#/buffer/:bufferId/main").to(function(){var a=new BufferMainView;EXI.addMainPanel(a),a.load(this.params.bufferId)}).enter(this.setPageBackground),Path.map("#/buffer/add").to(function(){var a=new BufferMainView;EXI.addMainPanel(a)}).enter(this.setPageBackground),Path.map("#/macromolecule/:macromoleculeId/main").to(function(){var a=new MacromoleculeMainView;EXI.addMainPanel(a),a.load(this.params.macromoleculeId)}).enter(this.setPageBackground),Path.map("#/macromolecule/add").to(function(){var a=new MacromoleculeMainView;EXI.addMainPanel(a)}).enter(this.setPageBackground),Path.map("#/stocksolution/:stocksolutionId/main").to(function(){var a=new StockSolutionMainView;EXI.addMainPanel(a),a.load(this.params.stocksolutionId)}).enter(this.setPageBackground),Path.map("#/stocksolution/add").to(function(){var a=new StockSolutionMainView;EXI.addMainPanel(a),a.load()}).enter(this.setPageBackground),Path.map("#/prepare/stocksolution/main").to(function(){var a=new StockSolutionMainView;EXI.addMainPanel(a),a.load()}).enter(this.setPageBackground),Path.map("#/prepare/templates/main").to(function(){var a=new ExperimentDesignerMainView;EXI.addMainPanel(a),a.load()}).enter(this.setPageBackground),Path.map("#/prepare/shipmentpreparation").to(function(){var a=new ShipmentPreparationMainView;EXI.addMainPanel(a),a.load()}).enter(this.setPageBackground),Path.map("#/prepare/designer").to(function(){var a=new DesignerMainView;EXI.addMainPanel(a),a.load()}).enter(this.setPageBackground)},SAXSExiController.prototype.init=function(){function a(){b.notFound()}var b=this;this.routeNavigation(),this.routeExperiment(),this.routeDataCollection(),this.routePrepare(),Path.map("#/session/nav/:sessionId/session").to(function(){EXI.clearNavigationPanel();var a=new SessionSaxsListView;a.onSelect.attach(function(a,b){"HPLC"==b[0].experimentType&&(location.hash="/experiment/hplc/"+b[0].experimentId+"/main"),"STATIC"!=b[0].experimentType&&"CALIBRATION"!=b[0].experimentType||(location.hash="/experiment/experimentId/"+b[0].experimentId+"/main"),"TEMPLATE"==b[0].experimentType&&(location.hash="/experiment/templateId/"+b[0].experimentId+"/main")});var b=function(b,c){EXI.addNavigationPanel(a),a.load(c),EXI.setLoadingMainPanel(!1)};EXI.getDataAdapter({onSuccess:b}).saxs.experiment.getExperimentsBySessionId(this.params.sessionId)}).enter(this.setPageBackground),Path.map("#/project/:projectId/run/:runId/main").to(function(){var a=this.params.projectId,b=this.params.runId,c=function(a,c){for(var d=0;d<c.length;d++)if(c[d].internalId==b){var e=new RunMainView;EXI.addMainPanel(e),e.load(c[d])}},d=function(a,b){};EXI.getDataAdapter({onSuccess:c,onError:d}).exi.offline.getRuns(a)}).enter(this.setPageBackground),Path.rescue(a)},ExiSAXS.prototype.loadSelected=Exi.prototype.loadSelected,ExiSAXS.prototype.addMainPanel=Exi.prototype.addMainPanel,ExiSAXS.prototype.getSelectedDataCollections=Exi.prototype.getSelectedDataCollections,ExiSAXS.prototype.addNavigationPanel=Exi.prototype.addNavigationPanel,ExiSAXS.prototype.clearNavigationPanel=Exi.prototype.clearNavigationPanel,ExiSAXS.prototype.clearMainPanel=Exi.prototype.clearMainPanel,ExiSAXS.prototype.setLoadingNavigationPanel=Exi.prototype.setLoadingNavigationPanel,ExiSAXS.prototype.setError=Exi.prototype.setError,ExiSAXS.prototype.setLoading=Exi.prototype.setLoading,ExiSAXS.prototype.setLoadingMainPanel=Exi.prototype.setLoadingMainPanel,ExiSAXS.prototype.show=Exi.prototype.show,ExiSAXS.prototype.setAnonymousMenu=Exi.prototype.setAnonymousMenu,ExiSAXS.prototype.setUserMenu=Exi.prototype.setUserMenu,ExiSAXS.prototype.appendDataAdapterParameters=Exi.prototype.appendDataAdapterParameters,ExiSAXS.prototype.hideNavigationPanel=Exi.prototype.hideNavigationPanel,ExiSAXS.prototype.showNavigationPanel=Exi.prototype.showNavigationPanel,ExiSAXS.prototype.getHeader=function(){var a="",b={version:ExtISPyB.version,release_date:ExtISPyB.release_date};return dust.render("saxsheader",b,function(b,c){a=c}),a},ExiSAXS.prototype.getDataAdapter=function(a){return new SaxsDataAdapterFactory(this.appendDataAdapterParameters(a))},SAXSMainMenu.prototype.populateCredentialsMenu=MainMenu.prototype.populateCredentialsMenu,SAXSMainMenu.prototype.init=MainMenu.prototype.init,SAXSMainMenu.prototype.getPanel=MainMenu.prototype.getPanel,SAXSMainMenu.prototype._convertToHTMLWhiteSpan=MainMenu.prototype._convertToHTMLWhiteSpan,SAXSMainMenu.prototype.getAddCredentialMenu=MainMenu.prototype.getAddCredentialMenu,SAXSMainMenu.prototype.getLoginButton=MainMenu.prototype.getLoginButton,SAXSMainMenu.prototype.setText=MainMenu.prototype.setText,SAXSMainMenu.prototype.getHelpMenu=MainMenu.prototype.getHelpMenu,SAXSMainMenu.prototype.getHomeItem=MainMenu.prototype.getHomeItem,SAXSMainMenu.prototype.getShipmentItem=MainMenu.prototype.getShipmentItem,SAXSMainMenu.prototype.getMenuItems=function(){return[this.getHomeItem(),this.getShipmentItem(),{text:this._convertToHTMLWhiteSpan("Prepare Experiment"),cls:"ExiSAXSMenuToolBar",hidden:this.isHidden,menu:this.getPreparationMenu()},{text:this._convertToHTMLWhiteSpan("Data Explorer"),cls:"ExiSAXSMenuToolBar",hidden:this.isHidden,menu:this.getDataExplorerMenu()},{text:this._convertToHTMLWhiteSpan("Help"),cls:"ExiSAXSMenuToolBar",menu:this.getHelpMenu()},"->",{xtype:"textfield",name:"field1",emptyText:"search macromolecule",hidden:this.isHidden,listeners:{specialkey:function(a,b){b.getKey()==b.ENTER&&(location.hash="/datacollection/macromoleculeAcronym/"+a.getValue()+"/main")}}}]},SAXSMainMenu.prototype.getPreparationMenu=function(){function a(a,b){"Macromolecules"==a.text&&(location.hash="/saxs/macromolecule/nav"),"Buffers"==a.text&&(location.hash="/saxs/buffer/nav"),"Sample Tracking"==a.text&&(location.hash="/saxs/shipping/nav"),"My Experiments"==a.text&&(location.hash="/saxs/template/nav")}return Ext.create("Ext.menu.Menu",{items:[{text:"Macromolecules",icon:"../images/icon/macromolecule.png",handler:a},{text:"Buffers",icon:"../images/icon/buffer.jpg",handler:a},"-",{text:"My Experiments",icon:"../images/icon/edit.png",handler:a}]})},SAXSMainMenu.prototype.getDataReductionMenu=function(){function a(a,c){"Sessions"==a.text&&b.onSessionClicked.notify(),"Subtraction"==a.text&&(location.hash="/tool/subtraction/main"),"Experiments"==a.text&&b.onExperimentClicked.notify()}var b=this;return Ext.create("Ext.menu.Menu",{items:[{text:'<span class="menuCategoryItem">SEC</span>'},"-",{text:"Background Test"},{text:"Baseline Checker"},{text:"Frame Merge"},"-",{text:'<span class="menuCategoryItem">INDIVIDUAL CONCENTRATION</span>'},"-",{text:"Subtraction",checked:!1,group:"theme",checkHandler:a},{text:"Average"},"-",{text:'<span class="menuCategoryItem">COMBINING</span>'},"-",{text:"Merging tool"}]})},SAXSMainMenu.prototype.getDataExplorerMenu=function(){function a(a,b){"Calendar"==a.text&&(location.hash="/session/nav"),"Experiments"==a.text&&(location.hash="/experiment/nav")}return Ext.create("Ext.menu.Menu",{items:[{text:"Calendar",icon:"../images/icon/sessions.png",handler:a}]})},SAXSMainMenu.prototype.getOnlineDataAnalisysMenu=function(){function a(a,b){"Structure Validation"==a.text&&(location.hash="/tool/crysol/main"),"Job list"==a.text&&(location.hash="/tool/list")}return Ext.create("Ext.menu.Menu",{items:[{text:"Structure Validation",checked:!1,group:"theme",handler:a},"-",{text:"Job list",checked:!1,group:"theme",handler:a}]})},AddressListView.prototype.getPanel=ListView.prototype.getPanel,AddressListView.prototype.load=ListView.prototype.load,AddressListView.prototype.getFields=ListView.prototype.getFields,AddressListView.prototype.getColumns=ListView.prototype.getColumns,AddressListView.prototype.getFilter=function(a){return[{property:"cardName",value:a,anyMatch:!0}]},AddressListView.prototype.getRow=function(a){var b="";return dust.render("address.listview",a.data,function(a,c){b=c}),b},BufferListView.prototype.getPanel=ListView.prototype.getPanel,BufferListView.prototype.load=ListView.prototype.load,BufferListView.prototype.getRow=function(a){var b="<table class='listView'>";return b=b+"<tr><td>Acronym:</td><td style='color:#207a7a;font-weight:bold;'>"+a.data.acronym+"</td></tr>",b=b+"<tr><td>name:</td><td>"+a.data.name+"</td></tr>",b+"</table>"},BufferListView.prototype.getFilter=function(a){return[{property:"acronym",value:a,anyMacth:!0}]},BufferListView.prototype.getColumns=function(){var a=this;return[{text:"Buffers",flex:1,dataIndex:"bufferId",renderer:function(b,c,d){return a.getRow(d)}}]},BufferListView.prototype.getFields=function(){return["acronym","name"]},DataCollectionListView.prototype.getPanel=ListView.prototype.getPanel,DataCollectionListView.prototype.load=ListView.prototype.load,DataCollectionListView.prototype.getRow=function(a){var b="<table class='listView'>";return b=b+"<tr><td>Macromolecule:</td><td >"+a.data.macromoleculeAcronym+"</td></tr>",b=b+"<tr><td>Buffer:</td><td style='color:#207a7a;font-weight:bold;'>"+a.data.bufferAcronym+"</td></tr>",b=b+"<tr><td>Count:</td><td>"+a.data.dataCollections+"</td></tr>",b+"</table>"},DataCollectionListView.prototype.getFilter=function(a){return[{property:"bufferAcronym",value:a,anyMacth:!0}]},DataCollectionListView.prototype.getColumns=function(){var a=this;return[{text:"Data Collections",flex:1,dataIndex:"bufferAcronym",renderer:function(b,c,d){return a.getRow(d)}}]},DataCollectionListView.prototype.getFields=function(){return["macromoleculeAcronym","bufferAcronym","macromoleculeId","dataCollections"]},DataCollectionListView.prototype.formatData=function(a){a=BUI.groupBy(a,function(a){return[a.bufferAcronym]});for(var b=[],c=0;c<a.length;c++){var d=a[c];b.push({macromoleculeAcronym:d[0].macromoleculeAcronym,macromoleculeId:d[0].macromoleculeId,bufferAcronym:d[0].bufferAcronym,dataCollections:d.length})}return b},MacromoleculeListView.prototype.getPanel=ListView.prototype.getPanel,MacromoleculeListView.prototype.load=ListView.prototype.load,MacromoleculeListView.prototype.getRow=function(a){var b="<table class='listView'>";return b=b+"<tr><td>Acronym:</td><td style='color:#207a7a;font-weight:bold;'>"+a.data.acronym+"</td></tr>",b=b+"<tr><td>name:</td><td>"+a.data.name+"</td></tr>",b+"</table>"},MacromoleculeListView.prototype.getFilter=function(a){return[{property:"acronym",value:a,anyMacth:!0}]},MacromoleculeListView.prototype.getColumns=function(){var a=this;return[{text:"Macromolecule",flex:1,dataIndex:"macromoleculeId",renderer:function(b,c,d){return a.getRow(d)}}]},MacromoleculeListView.prototype.getFields=function(){return["acronym","name","comments"]},SessionSaxsListView.prototype.getPanel=ListView.prototype.getPanel,SessionSaxsListView.prototype.load=ListView.prototype.load,SessionSaxsListView.prototype.parseStatistics=function(a,b){if(b&&a)try{return a/b*100}catch(c){return 0}return 0},SessionSaxsListView.prototype.getRow=function(a){var b="";return a.data.measured=this.parseStatistics(a.data.measurementDoneCount,a.data.measurementCount),a.data.averaged=this.parseStatistics(a.data.measurementAveragedCount,a.data.measurementCount),a.data.subtracted=this.parseStatistics(a.data.dataCollectionDoneCount,a.data.dataCollectionCount),dust.render("sessionsaxslistview.template",a.data,function(a,c){b=c}),b},SessionSaxsListView.prototype.getFilter=function(a){return[{property:"name",value:a,anyMacth:!0}]},SessionSaxsListView.prototype.getColumns=function(){var a=this;return[{text:"Experiment",flex:1,dataIndex:"sessionId",renderer:function(b,c,d){return a.getRow(d)}}]},SessionSaxsListView.prototype.getFields=function(){return["creationDate","name","experimentType"]},StockSolutionListView.prototype.getPanel=ListView.prototype.getPanel,StockSolutionListView.prototype.load=ListView.prototype.load,StockSolutionListView.prototype.getFilter=ListView.prototype.getFilter,StockSolutionListView.prototype.getFields=ListView.prototype.getFields,StockSolutionListView.prototype.getColumns=ListView.prototype.getColumns,StockSolutionListView.prototype.getRow=function(a){var b="";return EXI.proposalManager.getBufferById(a.data.bufferId)&&(a.data.bufferAcronym=EXI.proposalManager.getBufferById(a.data.bufferId).acronym),EXI.proposalManager.getMacromoleculeById(a.data.macromoleculeId)&&(a.data.macromoleculeAcronym=EXI.proposalManager.getMacromoleculeById(a.data.macromoleculeId).acronym),dust.render("stocksolution.listview",a.data,function(a,c){b=c}),b},TemplateListView.prototype.getPanel=ListView.prototype.getPanel,TemplateListView.prototype.load=ListView.prototype.load,TemplateListView.prototype.getRow=function(a){var b="black",c="<table class='listView' style='color:"+b+";'>";return c=c+"<tr style='font-weight: bold;font-size:14px; color:#207a7a;'><td colspan='4'>"+a.data.name+"</td></tr>",c=c+"<tr><td style='font-weight:bold;' colspan='4'>"+a.data.comments+"</td></tr>",c=c+"<tr ><td colspan='4'>"+a.data.creationDate+"</td></tr>",c+"</table>"},TemplateListView.prototype.getFilter=function(a){return[{property:"name",value:a,anyMatch:!0}]},TemplateListView.prototype.getColumns=function(){var a=this;return[{text:"Experiment",flex:1,dataIndex:"sessionId",renderer:function(b,c,d){return a.getRow(d)}}]},TemplateListView.prototype.getFields=function(){return[{name:"creationDate",type:"string"},{name:"name",type:"string"},{name:"experimentType",type:"string"}]},BufferMainView.prototype.getPanel=MainView.prototype.getPanel,BufferMainView.prototype.getContainer=function(){return Ext.create("Ext.container.Container",{layout:{type:"hbox"},margin:15,border:1,defaults:{labelWidth:80,flex:1},items:[this.bufferForm.getPanel([])]})},BufferMainView.prototype.load=function(a){this.panel.setTitle("Buffer"),this.bufferForm.load(EXI.proposalManager.getBufferById(a))},BufferWelcomeMainView.prototype.getPanel=MainView.prototype.getPanel,BufferWelcomeMainView.prototype.getContainer=MainView.prototype.getContainer,BufferWelcomeMainView.prototype.getOptions=function(){var a="<ul><li>Define beforehand an experiment</li>";return a+="<li>Send your samples by courier</li>",a+"</ul>"},BufferWelcomeMainView.prototype.getContainer=function(){return Ext.createWidget("panel",{plain:!0,margin:"20",layout:"fit",items:[{tabConfig:{title:"Welcome"},items:[{xtype:"container",layout:"fit",padding:10,margin:0,cls:"border-grid",items:[{html:'<div class="landing-title" ><h2>Buffers on ISPyB</h2></div>',margin:"0 0 0 20"},{html:'<div class="landing-text">A buffer is the matched solution which in a sample is suspended</div><br/>',margin:"0 0 0 40"},{html:'<div class="landing-text">You should define a macromolecule on ISPyB if you want:</div>',margin:"0 0 0 40"},{html:this.getOptions(),margin:"0 0 0 40"},{html:'<br/><div class="landing-text">If your macromolecule is not in the list showed on the left you can create a new one</div><br/>',margin:"0 0 0 20"},{xtype:"container",layout:"hbox",cls:"option-bar-menu",items:[{xtype:"button",cls:"square-option",maxWidth:200,minWidth:200,margin:"0 0 0 150",height:100,text:'<div class="square-option-text"; >Add a new buffer</div>',icon:"../images/icon/add.png",iconAlign:"top",handler:function(){location.hash="/buffer/add"}}]}]}]}]})},BufferWelcomeMainView.prototype.load=function(){},DataCollectionMainView.prototype.getPanel=MainView.prototype.getPanel,DataCollectionMainView.prototype.getContainer=MainView.prototype.getContainer,DataCollectionMainView.prototype.filter=function(a,b){this.grid.key={},this.grid.store.filter([{property:"bufferAcronym",value:b,anyMacth:!0}])},DataCollectionMainView.prototype.load=function(a){var b=this;this.grid.onSelectionChange.attach(function(a,c){b.onSelectionChange.notify(c)}),this.grid.onSelect.attach(function(a,c){b.onSelect.notify(c)}),this.grid.onDeselect.attach(function(a,c){b.onDeselect.notify(c)}),this.container.insert(0,this.grid.getPanel()),this.grid.panel.setLoading(),this.grid.store.loadData(a),this.grid.panel.setLoading(!1)},DesignerMainView.prototype.getPanel=MainView.prototype.getPanel,DesignerMainView.prototype.getContainer=function(){return Ext.create("Ext.container.Container",{layout:{type:"hbox"},margin:15,border:1,defaults:{labelWidth:80,flex:1},items:[this.wizardWidget.getPanel(new MeasurementCreatorStepWizardForm(EXI.proposalManager.getMacromolecules(),EXI.proposalManager.getBuffers()))]})},DesignerMainView.prototype.load=function(a){this.panel.setTitle("Experiment Designer")},ExperimentDesignerMainView.prototype.getPanel=MainView.prototype.getPanel,ExperimentDesignerMainView.prototype.getContainer=function(){return Ext.create("Ext.container.Container",{layout:{type:"hbox"},margin:30,bodyStyle:{"background-color":"#E6E6E6"},border:1,style:{borderColor:"#000000",borderStyle:"solid",borderWidth:"1px"},defaults:{labelWidth:80,xtype:"datefield",flex:1},items:[this.templateGrid.getPanel([])]})},ExperimentDesignerMainView.prototype.load=function(){var a=this;this.panel.setLoading();var b=new ProposalUpdater;this.templateGrid.grid.setLoading(),b.onSuccess.attach(function(b,c){a.panel.setLoading(!1);var d=new DataAdapter;d.onSuccess.attach(function(b,c){a.templateGrid.store.loadData(c),a.templateGrid.grid.setLoading(!1)}),d.getByExperimentByKey("experimentType","TEMPLATE")}),b.get(),this.panel.setTitle("Experiment Designer")},ExperimentMainView.prototype.getPanel=MainView.prototype.getPanel,ExperimentMainView.prototype.getSelected=function(){for(var a=[],b=0;b<this.queueGridList.length;b++)a=this.queueGridList[b].getSelected().concat(a);return a},ExperimentMainView.prototype.getTabs=function(){return Ext.createWidget("tabpanel",{plain:!0,margin:"20 0 0 0",activeTab:2,items:[{tabConfig:{title:"Sample Plate Setup"},items:[{xtype:"container",layout:"vbox",height:700,padding:20,style:{borderColor:"gray",borderStyle:"solid",borderWidth:"1px","background-color":"white"},items:[this.specimenWidget.getPanel()]}]},{tabConfig:{title:"Measurements"},items:[{xtype:"container",layout:"fit",height:700,padding:20,style:{borderColor:"gray",borderStyle:"solid",borderWidth:"1px","background-color":"white"},items:[this.measurementGrid.getPanel()]}]},{tabConfig:{title:"Online Data Analysis"},items:[{xtype:"container",layout:"fit",height:700,padding:20,style:{borderColor:"gray",borderStyle:"solid",borderWidth:"1px","background-color":"white"},items:[this.queueGrid.getPanel()]}]}]})},ExperimentMainView.prototype.getContainer=function(){return Ext.create("Ext.container.Container",{layout:{type:"anchor"},defaults:{anchor:"100%",hideEmptyLabel:!1},margin:30,bodyStyle:{"background-color":"#E6E6E6"},items:[this.experimentHeaderForm.getPanel(),this.getTabs()]})},ExperimentMainView.prototype.load=function(a){var b=this;b.panel.setLoading(),b.queueGrid.panel.setLoading();var c=function(c,d){b.experiment=new Experiment(d[0]),b.experimentHeaderForm.load(b.experiment),b.measurementGrid.loadExperiment(b.experiment),b.specimenWidget.refresh(b.experiment),b.panel.setTitle(d[0].name),b.panel.setLoading(!1);var e=function(a,c){b.queueGrid.load(c),b.queueGrid.panel.setLoading(!1)};EXI.getDataAdapter({onSuccess:e}).saxs.dataCollection.getDataCollectionsByExperimentId(a)};EXI.getDataAdapter({onSuccess:c}).saxs.experiment.getExperimentById(a)},ExperimentWelcomeMainView.prototype.getPanel=MainView.prototype.getPanel,ExperimentWelcomeMainView.prototype.getContainer=MainView.prototype.getContainer,ExperimentWelcomeMainView.prototype.getContainer=function(){return Ext.createWidget("panel",{plain:!0,margin:"10",layout:"fit",items:[{tabConfig:{title:"Welcome"},items:[{xtype:"container",layout:"fit",padding:20,margin:0,cls:"border-grid",items:[{html:'<div class="landing-title" ><h2>Designing your experiment on ISPyB</h2></div>'},{html:'<div class="landing-text">A experiment is a set of measurements of samples.</div><br/>',margin:"0 0 0 20"},{xtype:"container",layout:"hbox",cls:"option-bar-menu",items:[{xtype:"button",cls:"square-option",maxWidth:200,minWidth:200,margin:"0 0 0 150",height:100,text:'<div class="square-option-text"; >Create a new Experiment</div>',icon:"../images/icon/add.png",iconAlign:"top",handler:function(){location.hash="/prepare/designer"}}]}]}]}]})},ExperimentWelcomeMainView.prototype.load=function(){},HPLCMainView.prototype.getPanel=MainView.prototype.getPanel,HPLCMainView.prototype.getHeader=function(a,b){return"<span class='item'>"+a+"</span><span class='item_description'>"+b+"</span>"},HPLCMainView.prototype.getPlotContainer=function(){return{xtype:"container",cls:"defaultGridPanel",border:0,defaults:{height:450},items:[this.hplcGraph.getPanel(),this.plotter.getPanel()]}},HPLCMainView.prototype.getContainer=function(){return{xtype:"container",items:[this.grid.getPanel(),this.getPlotContainer()]}},HPLCMainView.prototype.getSelected=function(){for(var a=[],b=0;b<this.queueGridList.length;b++)a=this.queueGridList[b].getSelected().concat(a);return a},HPLCMainView.prototype.loadHPLCGraph=function(a){var b=this,c=function(a,c){c=JSON.parse(c);for(var d=[],e=0;e<c.I0.length;e++)d.push(0);c=[{param:"I0",data:c.I0,std:c.I0_Stdev,color:"#0066CC",label:"I0"},{param:"sum_I",label:"sum_I",color:"#00FF00",data:c.sum_I,std:d},{param:"Rg",label:"Rg",color:"#21610B",data:c.Rg,std:c.Rg_Stdev},{param:"Mass",data:c.mass,std:c.mass_Stdev,color:"#FF9900",label:"Mass"},{param:"Vc",data:c.Vc,std:c.Vc_Stdev,color:"#990099",label:"Vc"},{param:"Qr",data:c.Qr,std:c.Qr_Stdev,color:"#FF0066",label:"Qr"},{param:"quality",label:"quality",color:"#FF00FF",data:c.quality,std:d}],b.hplcGraph.loadData(c)};EXI.getDataAdapter({onSuccess:c}).saxs.hplc.getHPLCOverviewByExperimentId(a)},HPLCMainView.prototype.load=function(a){var b=this;this.experimentId=a,this.grid.panel.setLoading();var c=function(a,c){b.grid.load(c),b.grid.panel.setLoading(!1)};EXI.getDataAdapter({onSuccess:c}).saxs.dataCollection.getDataCollectionsByExperimentId(a),this.loadHPLCGraph(a)},MacromoleculeMainView.prototype.getPanel=MainView.prototype.getPanel,MacromoleculeMainView.prototype.getHeader=function(a,b){return"<span class='item'>"+a+"</span><span class='item_description'>"+b+"</span>"},MacromoleculeMainView.prototype.getSelected=function(){for(var a=[],b=0;b<this.queueGridList.length;b++)a=this.queueGridList[b].getSelected().concat(a);return a},MacromoleculeMainView.prototype.getTabs=function(){return Ext.createWidget("tabpanel",{plain:!0,items:[{tabConfig:{title:"General"},items:[{xtype:"container",layout:"fit",height:600,padding:0,items:[this.macromoleculeForm.getPanel()]}]},{tabConfig:{title:"Advanced"},items:[{xtype:"container",layout:"fit",height:500,padding:0,items:[this.rigidBodyModelingForm.getPanel()]}]}]})},MacromoleculeMainView.prototype.getContainer=function(){return Ext.create("Ext.container.Container",{layout:{type:"anchor"},defaults:{anchor:"100%",hideEmptyLabel:!1},margin:30,bodyStyle:{"background-color":"#E6E6E6"},items:[this.getTabs()]})},MacromoleculeMainView.prototype.load=function(a){this.panel.setLoading();var b=EXI.proposalManager.getMacromoleculeById(a);this.panel.setTitle(b.acronym),this.macromoleculeForm.load(b),this.rigidBodyModelingForm.load(b),this.panel.setLoading(!1)},MacromoleculeWelcomeMainView.prototype.getPanel=MainView.prototype.getPanel,MacromoleculeWelcomeMainView.prototype.getContainer=MainView.prototype.getContainer,MacromoleculeWelcomeMainView.prototype.getOptions=function(){var a="<ul><li>Define beforehand an experiment</li>";return a+="<li>Send your samples by courier</li>",a+="<li>Online data analysis to run apriori data analysis (PDB information will be required on the advanced tab in the macromolecule view)</li>",a+"</ul>"},MacromoleculeWelcomeMainView.prototype.getContainer=function(){return Ext.createWidget("panel",{plain:!0,margin:"10",layout:"fit",items:[{tabConfig:{title:"Welcome"},items:[{xtype:"container",layout:"fit",padding:20,margin:0,cls:"border-grid",items:[{html:'<div class="landing-title" ><h2>Macromolecules on ISPyB</h2></div>'},{html:'<div class="landing-text">A macromolecule is a biological contruct for investigation.</div><br/>',margin:"0 0 0 20"},{html:'<div class="landing-text">You should define a macromolecule on ISPyB if you want:</div>',margin:"0 0 0 20"},{html:this.getOptions(),margin:"0 0 0 40"},{html:'<br/><div class="landing-text">If your macromolecule is not in the list showed on the left you can create a new one</div><br/>',margin:"0 0 0 20"},{xtype:"container",layout:"hbox",cls:"option-bar-menu",items:[{xtype:"button",cls:"square-option",maxWidth:200,minWidth:200,margin:"0 0 0 150",height:100,text:'<div class="square-option-text"; >Add a new macromolecule</div>',icon:"../images/icon/add.png",iconAlign:"top",handler:function(){location.hash="/macromolecule/add"}}]}]}]}]})},MacromoleculeWelcomeMainView.prototype.load=function(){},MergeMainView.prototype.getPanel=MainView.prototype.getPanel,MergeMainView.prototype.getContainer=MainView.prototype.getContainer,MergeMainView.prototype.populateForm=function(a,b){for(var c=0;c<this.frames.length;c++)this.editorPanel.add(this.getCurveContainer(this.frames[c].subtractionId,this.frames[c].fileName,0,5,this.frames[c].scale,a,b))},MergeMainView.prototype.getSelected=function(){for(var a=[],b=0;b<this.queueGridList.length;b++)a=this.queueGridList[b].getSelected().concat(a);return a},MergeMainView.prototype.getCurveContainer=function(a,b,c,d,e,f,g){var h=this;return Ext.create("Ext.Panel",{width:380,layout:"vbox",border:1,style:{borderStyle:"solid",borderWidth:"1px"},margin:"10 0 0 5",items:[{xtype:"container",margin:"0 0 0 0",layout:"hbox",items:[{xtype:"container",layout:"vbox",items:[{html:'<span style="font-size:12px;color:'+g[b]+';">'+b+"</span>",margin:"10 0 0 10"},{xtype:"sliderfield",margin:"10 0 0 2",hideLabel:!0,width:275,minValue:0,subtractionId:a,id:"slider"+a,maxValue:f,increment:1,values:[0,f],listeners:{changecomplete:function(a,b,c,d){for(var e=a.getValues(),f=0;f<h.frames.length;f++)h.frames[f].subtractionId==a.subtractionId&&(h.frames[f].from=h.plotter.dygraph.getValue(e[0]-1,0),h.frames[f].to=h.plotter.dygraph.getValue(e[1]-1,0));h.updateCurve()}}}]},{xtype:"container",layout:"vbox",items:[{xtype:"container",layout:"hbox",items:[{xtype:"button",text:"<",width:30,margin:"2 0 0 10",subtractionId:a,handler:function(a){var b="slider"+a.subtractionId;Ext.getCmp(b).setValue(0,Ext.getCmp(b).getValues()[0]-1);for(var c=Ext.getCmp(b).getValues(),d=0;d<h.frames.length;d++)h.frames[d].subtractionId==a.subtractionId&&(h.frames[d].from=h.plotter.dygraph.getValue(c[0]-1,0));h.updateCurve()}},{xtype:"button",text:">",width:30,margin:"2 0 0 5",subtractionId:a,handler:function(a){var b="slider"+a.subtractionId;Ext.getCmp(b).setValue(1,Ext.getCmp(b).getValues()[1]+1);for(var c=Ext.getCmp(b).getValues(),d=0;d<h.frames.length;d++)h.frames[d].subtractionId==a.subtractionId&&(h.frames[d].to=h.plotter.dygraph.getValue(c[1]-1,0));h.updateCurve()}}]},{xtype:"container",layout:"hbox",margin:"2 0 2 0",items:[{xtype:"button",text:"+",margin:"0 0 0 10",width:30,subtractionId:a,handler:function(a){for(var b=0;b<h.frames.length;b++)console.log(a.subtractionId),h.frames[b].subtractionId==a.subtractionId&&(h.frames[b].scale=h.frames[b].scale+.1);h.updateCurve()}},{xtype:"button",text:"-",width:30,margin:"0 0 0 5",subtractionId:a,handler:function(a){for(var b=0;b<h.frames.length;b++)h.frames[b].subtractionId==a.subtractionId&&(h.frames[b].scale=h.frames[b].scale-.1);h.updateCurve()}}]}]}]}]})},MergeMainView.prototype.getSubtractionEditor=function(){var a=this;return this.editorPanel=Ext.create("Ext.Panel",{border:1,height:600,width:400,layout:"vbox",scrollable:!0,style:{borderColor:"#000000",borderStyle:"solid",borderWidth:"1px"},items:[],bbar:[{text:"Download",xtype:"button",handler:function(b){var c=a.getParams();window.open((new DataAdapter).getMergeURL(c.subtractionIds.toString(),c.from.toString(),c.to.toString(),c.scale.toString()))}}]}),this.editorPanel},MergeMainView.prototype.getParams=function(){for(var a=[],b=[],c=[],d=[],e=0;e<this.frames.length;e++){var f=this.frames[e];null!=f.from?a.push(f.from):a.push(""),null!=f.to?b.push(f.to):b.push(""),null!=f.scale?c.push(f.scale):c.push(""),null!=f.subtractionId?d.push(f.subtractionId):d.push("")}return{from:a,to:b,scale:c,subtractionIds:d}},MergeMainView.prototype.updateCurve=function(){this.xAxisRange=this.plotter.dygraph.xAxisRange(),this.yAxisRange=this.plotter.dygraph.yAxisRange();var a=this.getParams();this.plotter.loadMerge(a.subtractionIds.toString(),a.from.toString(),a.to.toString(),a.scale.toString()),this.plotter.dygraph.updateOptions({dateWindow:this.xAxisRange,valueRange:this.yAxisRange})},MergeMainView.prototype.getSlavePanel=function(){return{xtype:"container",layout:"hbox",cls:"defaultGridPanel",border:0,defaults:{xtype:"container",height:600},items:[this.getSubtractionEditor(),this.plotter.getPanel()]}},MergeMainView.prototype.load=function(a){var b=new QueueGrid({maxHeight:300});this.panel.setTitle("Merge Tool"),this.container.insert(0,b.getPanel()),this.container.insert(1,this.getSlavePanel()),b.load(a),b.panel.setLoading(!1);var c=[],d=[],e=[];this.frames=[];for(var f=0;f<a.length;f++)c.push(a[f].dataCollectionId),null==e[a[f].subtractionId]&&(d.push(a[f].subtractionId),this.frames.push({fileName:a[f].substractedFilePath.substr(a[f].substractedFilePath.lastIndexOf("/")+1),subtractionId:a[f].subtractionId,scale:1}),e[a[f].subtractionId]=!0);this.plotter.load({subtracted:d})},PrimaryDataMainView.prototype.getPanel=MainView.prototype.getPanel,PrimaryDataMainView.prototype.getSlavePanel=function(){return{xtype:"container",layout:"hbox",cls:"defaultGridPanel",margin:5,border:0,defaults:{height:600},items:[{xtype:"panel",layout:{type:"accordion",titleCollapse:!1,animate:!0,activeOnTop:!0},flex:.3,border:1,style:{borderColor:"#000000",borderStyle:"solid",borderWidth:"1px"},items:[this.frameSelectorGrid.getPanel()]},this.plotter.getPanel()]}},PrimaryDataMainView.prototype.getContainer=function(){return Ext.createWidget("tabpanel",{plain:!0,height:900,margin:"10 0 0 0",items:[{tabConfig:{title:"Primary Data Reduction"},items:[{xtype:"container",layout:"fit",height:850,padding:20,style:{borderColor:"gray",borderStyle:"solid",borderWidth:"1px","background-color":"white"},items:[{xtype:"container",
items:[this.grid.getPanel(),this.getSlavePanel()]}]}]},{tabConfig:{title:"Abinitio Modeling"},items:[{xtype:"container",layout:"fit",height:850,padding:20,style:{borderColor:"gray",borderStyle:"solid",borderWidth:"1px","background-color":"white"},items:[{xtype:"container",items:[this.abinitioForm.getPanel()]}]}]}]})},PrimaryDataMainView.prototype.load=function(a){var b=this;this.panel.setTitle(" Data Collection"),this.grid.panel.setLoading();for(var c=function(a,c){if(b.grid.load(c),b.grid.panel.setLoading(!1),b.frameSelectorGrid.load(c),c[0].subtractionId){var d=function(a,c){b.abinitioForm.load(c)};EXI.getDataAdapter({onSuccess:d}).saxs.subtraction.getSubtractionsBySubtractionIdList([c[0].subtractionId])}},d=[],e=0;e<a.length;e++)d.push(a[e].dataCollectionId);EXI.getDataAdapter({onSuccess:c}).saxs.dataCollection.getDataCollectionsByDataCollectionId(d)},ShippingMainView.prototype.getPanel=MainView.prototype.getPanel,ShippingMainView.prototype.getContainer=function(){return this.tabPanel=Ext.createWidget("tabpanel",{margin:10,defaults:{anchor:"100%"},items:[{tabConfig:{title:"Delivery Details"},items:[this.shipmentForm.getPanel()]},{tabConfig:{id:this.id+"grid",title:"Parcels",icon:"../images/icon/shipping.png"},items:[this.caseGrid.getPanel()]}]}),this.tabPanel},ShippingMainView.prototype.load=function(a){this.shippingId=a,null==a&&Ext.getCmp(this.id+"grid").disable(!0),this.panel.setTitle("Shipment");var b=this;if(null!=a){this.panel.setLoading();var c=function(a,c){b.shipmentForm.load(c),b.caseGrid.load(c),b.panel.setLoading(!1)};EXI.getDataAdapter({onSuccess:c}).proposal.shipping.getShipment(a)}},ShippingWelcomeMainView.prototype.getPanel=MainView.prototype.getPanel,ShippingWelcomeMainView.prototype.getContainer=MainView.prototype.getContainer,ShippingWelcomeMainView.prototype.getContainer=function(){return Ext.createWidget("panel",{plain:!0,margin:"10",layout:"fit",items:[{tabConfig:{title:"Welcome"},items:[{xtype:"container",layout:"fit",padding:20,margin:0,cls:"border-grid",items:[{html:'<div class="landing-title" ><h2>Shipments</h2></div>'},{html:'<div class="landing-text"> A Shipment consists of a set of Dewars which is sent from your home lab to the synchrotron via a courier company. Each dry shipping Dewar within the shipment is identified by a label (barcode or sticker). The dewars(s) contains a set of Containers (Pucks or canes). Containers (typically Pucks), contain Samples. A Sample (Sample Holder) contains the Crystal</div><br/>',margin:"0 0 0 20"},{html:'<br/><div class="landing-text">Do you want to ship your samples to the beamline?</div><br/>',margin:"0 0 0 20"},{xtype:"container",layout:"hbox",cls:"option-bar-menu",items:[{xtype:"button",cls:"square-option",maxWidth:200,minWidth:200,margin:"0 0 0 150",height:100,text:'<div class="square-option-text"; >Create a new Shipment</div>',icon:"../images/icon/add.png",iconAlign:"top",handler:function(){location.hash="/shipping/main"}}]}]}]}]})},ShippingWelcomeMainView.prototype.load=function(){},StockSolutionMainView.prototype.getPanel=MainView.prototype.getPanel,StockSolutionMainView.prototype.getContainer=function(){return Ext.create("Ext.container.Container",{layout:{type:"anchor"},defaults:{anchor:"100%",hideEmptyLabel:!1},margin:30,bodyStyle:{"background-color":"#E6E6E6"},items:[this.stockSolutionForm.getPanel([])]})},StockSolutionMainView.prototype.load=function(a){this.stockSolutionId=a,this.stockSolutionForm.load(EXI.proposalManager.getStockSolutionById(a)),this.panel.setTitle("Stock Solutions")},StockSolutionWelcomeMainView.prototype.getPanel=MainView.prototype.getPanel,StockSolutionWelcomeMainView.prototype.getContainer=MainView.prototype.getContainer,StockSolutionWelcomeMainView.prototype.getOptions=function(){var a="<ul><li>Define beforehand an experiment</li>";return a+="<li>Send your samples by courier</li>",a+"</ul>"},StockSolutionWelcomeMainView.prototype.getContainer=function(){return Ext.createWidget("panel",{plain:!0,margin:"20",layout:"fit",items:[{tabConfig:{title:"Welcome"},items:[{xtype:"container",layout:"fit",padding:10,margin:0,cls:"border-grid",items:[{html:'<div class="landing-title" ><h2>Stock Solutions on ISPyB</h2></div>',margin:"0 0 0 20"},{html:'<div class="landing-text">A buffer is the matched solution which in a sample is suspended</div><br/>',margin:"0 0 0 40"},{html:'<div class="landing-text">You should define a macromolecule on ISPyB if you want:</div>',margin:"0 0 0 40"},{html:this.getOptions(),margin:"0 0 0 40"},{html:'<br/><div class="landing-text">If your macromolecule is not in the list showed on the left you can create a new one</div><br/>',margin:"0 0 0 20"},{xtype:"container",layout:"hbox",cls:"option-bar-menu",items:[{xtype:"button",cls:"square-option",maxWidth:200,minWidth:200,margin:"0 0 0 150",height:100,text:'<div class="square-option-text"; >Add a new Stock Solution</div>',icon:"../images/icon/add.png",iconAlign:"top",handler:function(){location.hash="/stocksolution/add"}}]}]}]}]})},StockSolutionWelcomeMainView.prototype.load=function(){},TemplateMainView.prototype.getPanel=MainView.prototype.getPanel,TemplateMainView.prototype.getHeader=function(a,b){return"<span class='item'>"+a+"</span><span class='item_description'>"+b+"</span>"},TemplateMainView.prototype.getSelected=function(){for(var a=[],b=0;b<this.queueGridList.length;b++)a=this.queueGridList[b].getSelected().concat(a);return a},TemplateMainView.prototype.getTabs=function(){return Ext.createWidget("tabpanel",{plain:!0,margin:"20 0 0 0",items:[{tabConfig:{title:"Measurements"},items:[{xtype:"container",layout:"fit",height:700,padding:20,style:{borderColor:"gray",borderStyle:"solid",borderWidth:"1px","background-color":"white"},items:[this.measurementGrid.getPanel()]}]},{tabConfig:{title:"Sample Plate Setup"},items:[{xtype:"container",layout:"vbox",height:700,padding:20,style:{borderColor:"gray",borderStyle:"solid",borderWidth:"1px","background-color":"white"},items:[this.specimenWidget.getPanel()]}]},{tabConfig:{title:"Sample Requirements"},items:[{xtype:"container",layout:"fit",height:700,padding:20,style:{borderColor:"gray",borderStyle:"solid",borderWidth:"1px","background-color":"white"},items:[this.volumePlanificator.getPanel()]}]}]})},TemplateMainView.prototype.getContainer=function(){return Ext.create("Ext.container.Container",{layout:{type:"anchor"},defaults:{anchor:"100%",hideEmptyLabel:!1},margin:30,bodyStyle:{"background-color":"#E6E6E6"},items:[this.experimentHeaderForm.getPanel(),this.getTabs()]})},TemplateMainView.prototype.load=function(a){var b=this;b.panel.setLoading();var c=function(a,c){b.experiment=new Experiment(c[0]),b.experimentHeaderForm.load(b.experiment),b.measurementGrid.loadExperiment(b.experiment),b.specimenWidget.refresh(b.experiment),b.volumePlanificator.load(b.experiment),b.panel.setLoading(!1)};EXI.getDataAdapter({onSuccess:c}).saxs.experiment.getExperimentById(a[0].experimentId),this.panel.setTitle("Template")},AbinitioForm.prototype._renderPDB=function(a){try{for(var b=[],c=0;c<a.length;c++)b.push({modelId:a[c],color:new THREE.Color(16737792),opacity:.8});this.viewer.refresh(b)}catch(d){console.log(d)}},AbinitioForm.prototype.getPanel=function(){return this.panel=Ext.create("Ext.panel.Panel",{width:this.width,cls:"border-grid",layout:"hbox",height:this.height,margin:5,border:1,defaultType:"textfield",items:[{xtype:"container",layout:"vbox",items:[this.abinitioGrid.getPanel()]},{xtype:"container",layout:"vbox",items:[{xtype:"container",layout:"fit",height:300,margin:"10 0 0 0",width:500,items:[this.curvePlotter.getPanel()]},this.viewer.getPanel()]}]}),this.panel},AbinitioForm.prototype.load=function(a){this.subtractions=a,this.abinitioGrid.refresh(a)},AbinitioGrid.prototype.refresh=function(a){this.store.loadData(this._prepareData(a))},AbinitioGrid.prototype._prepareData=function(a){for(var b=[],c=0;c<a.length;c++)for(var d=a[c],e=0;e<d.substractionToAbInitioModel3VOs.length;e++){var f=d.substractionToAbInitioModel3VOs[e].abinitiomodel3VO;if(null!=f.averagedModel&&(b.push(f.averagedModel),b[b.length-1].type="Reference"),null!=f.shapeDeterminationModel&&(b.push(f.shapeDeterminationModel),b[b.length-1].type="Refined"),null!=f.modelList3VO&&null!=f.modelList3VO.modeltolist3VOs)for(var g=0;g<f.modelList3VO.modeltolist3VOs.length;g++)b.push(f.modelList3VO.modeltolist3VOs[g].model3VO),b[b.length-1].type="Model"}return b},AbinitioGrid.prototype.getPanel=function(){var a=this,b=["modelId","type","chiSqrt","dmax","firFile","logFile","fitFile","pdbFile","rfactor","rg","volume"];Ext.define("AbinitioModel",{extend:"Ext.data.Model",fields:b}),this.store=Ext.create("Ext.data.Store",{model:"AbinitioModel",autoload:!0,groupField:"type"});var c=Ext.create("Ext.grid.feature.Grouping",{groupHeaderTpl:'{name} ({rows.length} model{[values.rows.length > 1 ? "s" : ""]})',startCollapsed:!1,collapsible:!0}),d=Ext.create("Ext.selection.RowModel",{allowDeselect:!0,listeners:{selectionchange:function(b,c){c.length>0&&a.onSelected.notify([c[0].data])}}});return this.grid=Ext.create("Ext.grid.Panel",{collapsible:!1,resizable:!0,selModel:d,features:[c],autoscroll:!0,multiSelect:!0,store:this.store,cls:"border-grid",height:this.height,width:this.width,margin:10,columns:[{text:"Type",dataindex:"type",hidden:!0,renderer:function(a,b,c){return c.data.type},flex:1},{text:"ModelId",dataindex:"modelId",hidden:!0,renderer:function(a,b,c){return c.data.modelId},flex:1},{text:"chiSqrt",dataindex:"chiSqrt",renderer:function(a,b,c){return null!=c.data.dmax?BUI.formatValuesUnits(c.data.chiSqrt,"",12,this.decimals):void 0},flex:1},{text:"Dmax",dataindex:"dmax",renderer:function(a,b,c){return null!=c.data.dmax?BUI.formatValuesUnits(c.data.dmax,"nm",12,this.decimals):void 0},flex:1},{text:"rFactor",dataindex:"rfactor",hidden:!0,renderer:function(a,b,c){return null!=c.data.rfactor?c.data.rfactor:void 0},flex:1},{text:"Rg",dataindex:"rg",renderer:function(a,b,c){return null!=c.data.rg?BUI.formatValuesUnits(c.data.rg,"nm",12,this.decimals):void 0},flex:1},{text:"Volume",dataindex:"volume",renderer:function(a,b,c){return null!=c.data.volume?BUI.formatValuesUnits(c.data.volume,"")+"<span style='font-size:8px;color:gray;'> nm<sub>3</sub></span>":void 0},flex:1},{text:"PDB",dataindex:"pdbFile",renderer:function(a,b,c){return null!=c.data.pdbFile?c.data.pdbFile.split("/")[c.data.pdbFile.split("/").length-1]:void 0},flex:1},{text:"Fir",dataindex:"firFile",renderer:function(a,b,c){return null!=c.data.firFile?c.data.firFile.split("/")[c.data.firFile.split("/").length-1]:void 0},flex:1},{text:"LOG",dataindex:"logFile",hidden:!0,renderer:function(a,b,c){return null!=c.data.logFile?c.data.logFile.split("/")[c.data.logFile.split("/").length-1]:void 0},flex:1}],viewConfig:{enableTextSelection:!0,preserveScrollOnRefresh:!0,stripeRows:!0,listeners:{}}}),this.grid},AddressForm.prototype.getAddress=function(){return null==this.address&&(this.address={}),this.address.billingReference=Ext.getCmp(this.id+"billingReference").getValue(),this.address.cardName=Ext.getCmp(this.id+"cardName").getValue(),this.address.courierAccount=Ext.getCmp(this.id+"courierAccount").getValue(),this.address.defaultCourrierCompany=Ext.getCmp(this.id+"courrierCompany").getValue(),this.address.dewarAvgCustomsValue=Ext.getCmp(this.id+"dewarAvgCustomsValue").getValue(),this.address.dewarAvgTransportValue=Ext.getCmp(this.id+"dewarAvgTransportValue").getValue(),null==this.address.personVO&&(this.address.personVO={}),this.address.personVO.emailAddress=Ext.getCmp(this.id+"emailAddress").getValue(),this.address.personVO.familyName=Ext.getCmp(this.id+"familyName").getValue(),this.address.personVO.givenName=Ext.getCmp(this.id+"name").getValue(),this.address.personVO.faxNumber=Ext.getCmp(this.id+"faxNumber").getValue(),this.address.personVO.phoneNumber=Ext.getCmp(this.id+"phoneNumber").getValue(),this.address},AddressForm.prototype._loadPerson=function(a,b,c,d,e){Ext.getCmp(this.id+"emailAddress").setValue(c),Ext.getCmp(this.id+"familyName").setValue(b),Ext.getCmp(this.id+"name").setValue(a),Ext.getCmp(this.id+"faxNumber").setValue(d),Ext.getCmp(this.id+"phoneNumber").setValue(e)},AddressForm.prototype.load=function(a){this.address=a,null!=a&&(Ext.getCmp(this.id+"cardName").setValue(a.cardName),Ext.getCmp(this.id+"courrierCompany").setValue(a.defaultCourrierCompany),Ext.getCmp(this.id+"dewarAvgCustomsValue").setValue(a.dewarAvgCustomsValue),Ext.getCmp(this.id+"dewarAvgTransportValue").setValue(a.dewarAvgTransportValue),Ext.getCmp(this.id+"courierAccount").setValue(a.courierAccount),Ext.getCmp(this.id+"billingReference").setValue(a.billingReference),null!=a.personVO&&this._loadPerson(a.personVO.givenName,a.personVO.familyName,a.personVO.emailAddress,a.personVO.faxNumber,a.personVO.phoneNumber))},AddressForm.prototype.getPersonPanel=function(){return this.personPanel=Ext.create("Ext.panel.Panel",{layout:"vbox",margin:"10",items:[{padding:10,xtype:"container",layout:"hbox",border:!1,items:[{xtype:"requiredtextfield",id:this.id+"name",fieldLabel:"Name",labelWidth:75,margin:"0 0 0 10",disabled:!0,width:200},{xtype:"requiredtextfield",id:this.id+"familyName",fieldLabel:"Surname",labelWidth:75,disabled:!0,margin:"0 0 0 10",width:200},{xtype:"requiredtextfield",id:this.id+"emailAddress",fieldLabel:"Email",labelWidth:75,margin:"0 0 0 10",width:300},{id:this.id+"phoneNumber",fieldLabel:"Phone",xtype:"textfield",labelWidth:75,margin:"0 0 0 10",width:220},{id:this.id+"faxNumber",fieldLabel:"Fax",xtype:"textfield",labelWidth:75,margin:"0 0 0 10",width:220}]},{padding:10,xtype:"container",layout:"hbox",border:!1,items:[{xtype:"requiredtextfield",id:this.id+"cardName",fieldLabel:"Card Name",name:"CardName",labelWidth:150,margin:"0 0 0 10",width:300},{xtype:"requiredtextfield",id:this.id+"courierAccount",fieldLabel:"Courier Account",margin:"0 0 0 30",labelWidth:150,width:300},{xtype:"requiredtextfield",id:this.id+"courrierCompany",fieldLabel:"Courier Company",margin:"0 0 0 30",labelWidth:150,width:300}]},{padding:10,xtype:"container",layout:"hbox",border:!1,items:[{id:this.id+"dewarAvgCustomsValue",fieldLabel:"Average Custom Value",xtype:"numberfield",margin:"0 0 0 10",minValue:0,maxValue:15,labelWidth:150,width:300},{id:this.id+"dewarAvgTransportValue",fieldLabel:"Average Transport Value",xtype:"numberfield",margin:"0 0 0 30",minValue:0,maxValue:15,labelWidth:150,width:300},{id:this.id+"billingReference",xtype:"textfield",fieldLabel:"Billing Reference",margin:"0 0 0 30",labelWidth:150,width:300}]}]}),this.personPanel},AddressForm.prototype.getPackagePanel=function(){return this.packagePanel=Ext.create("Ext.panel.Panel",{layout:"hbox",items:[{padding:10,xtype:"container",layout:"vbox",border:!1,items:[{xtype:"container",layout:"hbox",items:[]},{xtype:"container",layout:"hbox",margin:"10 0 0 0",items:[]}]}]}),this.packagePanel},AddressForm.prototype.getPanel=function(){return this.panel=Ext.create("Ext.panel.Panel",{hidden:this.isHidden,layout:"vbox",title:"Shipping Address Card",cls:"border-grid",buttons:this.getToolBar(),icon:"../images/icon/ic_email_black_24dp.png",items:[this.getPersonPanel()]}),this.panel},AddressForm.prototype.save=function(){var a=this;a.panel.setLoading();var b=function(b){a.panel.setLoading(!1),EXI.getDataAdapter().proposal.proposal.update()};EXI.getDataAdapter({onSuccess:b}).proposal.labcontacts.saveLabContact(a.getAddress())},AddressForm.prototype.getToolBar=function(){var a=this;return[{text:"Save",hidden:a.isSaveButtonHidden,width:100,handler:function(){a.save()}}]},AprioriRigidBodyGrid.prototype._getColumns=function(){},AprioriRigidBodyGrid.prototype._getTopButtons=function(){var a=this,b=[];return b.push(Ext.create("Ext.Action",{icon:"../images/add.png",text:"Add",disabled:!1,handler:function(b,c){a.onAddButtonClicked.notify()}})),b},AprioriRigidBodyGrid.prototype.load=function(a){this.macromolecule=a,null!=a&&this.pdbStore.loadData(a.structure3VOs)},AprioriRigidBodyGrid.prototype._prepareData=function(){for(var a=[],b=0;b<this.features.length;b++)a.push(this.features[b]);return a},AprioriRigidBodyGrid.prototype._updateProposalInformation=function(){EXI.proposalManager.get(!0),this.load(EXI.proposalManager.getMacromoleculeById(this.macromolecule.macromoleculeId)),this.panel.setLoading(!1)},AprioriRigidBodyGrid.prototype._getPlugins=function(){var a=this,b=[];return b.push(Ext.create("Ext.grid.plugin.RowEditing",{clicksToEdit:1,listeners:{validateedit:function(b,c){var d=c.newValues.multiplicity,e=c.newValues.symmetry,f=c.record.data.macromoleculeId,g=c.record.data.structureId;a.panel.setLoading();var h=function(){a._updateProposalInformation()},i=function(b){BUI.showError("Ops, there was a problem"),a._updateProposalInformation()};a.panel.setLoading(),EXI.getDataAdapter({onSuccess:h,onError:i}).saxs.macromolecule.saveStructure(f,g,d,e)}}})),b},AprioriRigidBodyGrid.prototype.getPanel=function(){var a=this;return this.pdbStore=Ext.create("Ext.data.Store",{fields:["filePath","structureId","structureType","symmetry","structureId","name","multiplicity"],groupField:"structureType",sorters:{property:"structureId",direction:"DESC"}}),this.panel=Ext.create("Ext.grid.Panel",{margin:"15 10 0 10",height:this.height,store:this.pdbStore,plugins:a._getPlugins(),cls:"border-grid",tbar:[{text:"Add Modeling Option (PDB)",icon:"../images/icon/add.png",handler:function(){a.onUploadFile.notify("PDB","Upload PDB File")}}],columns:[{text:"structureId",flex:.2,hidden:!0,dataIndex:"structureId",sortable:!0},{text:"File",flex:1,dataIndex:"filePath",sortable:!0,hidden:!0},{text:"PDB",flex:.4,dataIndex:"name",sortable:!0},{text:"Symmetry",flex:.2,dataIndex:"symmetry",sortable:!0,editor:{xtype:"combobox",typeAhead:!0,triggerAction:"all",selectOnTab:!0,store:[["P1","P1"],["P2","P2"],["P3","P3"],["P4","P4"],["P5","P5"],["P6","P6"],["P32","P32"],["P42","P42"],["P52","P52"],["P62","P62"],["P222","P222"]]}},{text:"Multiplicity",flex:.2,dataIndex:"multiplicity",sortable:!0,editor:{xtype:"textfield"}},{text:"Subunit",flex:.2,dataIndex:"isSubunit",sortable:!0,hidden:!0},{text:"Type",flex:.2,dataIndex:"structureType",sortable:!0,hidden:!0},{xtype:"actioncolumn",flex:.1,text:"Remove",editor:{xtype:"textfield"},items:[{icon:"../images/icon/ic_delete_black_24dp.png",tooltip:"Remove",handler:function(b,c,d){function e(b){if("yes"==b){var c=function(){a._updateProposalInformation()},d=function(){BUI.showWarning("ISPyB could not remove this structure. Have it been already used?"),a._updateProposalInformation()};a.panel.setLoading(),EXI.getDataAdapter({onSuccess:c,onError:d}).saxs.macromolecule.removeStructure(h,g)}}var f=b.getStore().getAt(c),g=f.data.structureId,h=f.data.macromoleculeId;Ext.MessageBox.show({title:"Warning",fn:e,msg:"You are removing a PDB structure option. <br />Sure?",buttons:Ext.MessageBox.YESNO,icon:Ext.MessageBox.QUESTION})}}]}],listeners:{beforeedit:function(a,b,c){return"actioncolumn"!=b.column.xtype}}}),this.panel},AssemblyForm.prototype._getItems=function(){return[{xtype:"label",forId:"myFieldId",text:"List of previously defined macromolecules present in the assembly. This information will be used for additional cross-checks where possible",margin:"15 0 20 10",cls:"inline-help"},this.molarityGrid.getPanel()]},AssemblyForm.prototype._getButtons=function(){return[]},AssemblyForm.prototype.getPanel=function(){return this.panel=Ext.create("Ext.form.Panel",{width:this.width,height:this.height,margin:10,border:0,defaultType:"textfield",items:this._getItems(),buttons:this._getButtons()}),this.panel},AssemblyForm.prototype.refresh=function(a){this.macromolecule=a,this.molarityGrid.refresh(a)},AssemblyForm.prototype.input=function(){return{}},AssemblyForm.prototype.test=function(a){var b=new AssemblyForm,c=b.getPanel();c.render(a)},BufferForm.prototype.getBuffer=function(){return null==this.buffer&&(this.buffer={}),this.buffer.name=Ext.getCmp(this.id+"buffer_name").getValue(),this.buffer.acronym=Ext.getCmp(this.id+"buffer_acronym").getValue(),this.buffer.comments=Ext.getCmp(this.id+"buffer_comments").getValue(),this.buffer.ph=Ext.getCmp(this.id+"buffer_ph").getValue(),this.buffer.composition=Ext.getCmp(this.id+"buffer_composition").getValue(),this.buffer.proposalId=Ext.getCmp(this.id+"proposalIdCombo").getValue(),this.buffer},BufferForm.prototype.load=function(a){this.buffer=a,null!=a&&(Ext.getCmp(this.id+"buffer_name").setValue(this.buffer.name),Ext.getCmp(this.id+"buffer_acronym").setValue(this.buffer.acronym),Ext.getCmp(this.id+"buffer_comments").setValue(this.buffer.comments),Ext.getCmp(this.id+"buffer_ph").setValue(this.buffer.ph),Ext.getCmp(this.id+"buffer_composition").setValue(this.buffer.composition)),null!=this.buffer&&null!=this.buffer.proposalId&&(Ext.getCmp(this.id+"proposalIdCombo").setValue(this.buffer.proposalId),Ext.getCmp(this.id+"proposalIdCombo").disable())},BufferForm.prototype._getTopPanel=function(){return{xtype:"container",layout:"hbox",border:0,margin:"40 0 0 0",frame:!0,items:[{xtype:"container",layout:"hbox",items:[{xtype:"container",flex:1,border:!1,layout:"anchor",items:[{xtype:"requiredtextfield",id:this.id+"buffer_name",fieldLabel:"Name",name:"name",width:300},{xtype:"requiredtextfield",id:this.id+"buffer_acronym",fieldLabel:"Acronym",maskRe:/[a-zA-Z0-9]+/,name:"acronym",width:300}]}]},{xtype:"container",flex:1,layout:"anchor",defaultType:"textfield",margin:"0 0 0 10",items:[{id:this.id+"buffer_ph",fieldLabel:"pH",name:"ph",xtype:"numberfield",width:300,minValue:0,maxValue:15},{fieldLabel:"Composition",id:this.id+"buffer_composition",name:"composition",width:300}]}]}},BufferForm.prototype.getToolBar=function(){var a=this;return[{text:"Save",width:100,handler:function(){a.panel.setLoading();var b=function(b){a.panel.setLoading(!1),EXI.getDataAdapter().proposal.proposal.update()};EXI.getDataAdapter({onSuccess:b}).saxs.buffer.saveBuffer(a.getBuffer())}}]},BufferForm.prototype.getPanel=function(){var a=this;return this.panel=Ext.create("Ext.panel.Panel",{layout:"vbox",buttons:this.getToolBar(),cls:"border-grid",layout:"vbox",items:[{xtype:"container",margin:"10 0 0 20",layout:"vbox",items:[BIOSAXS_COMBOMANAGER.getComboProposal({id:a.id+"proposalIdCombo",labelWidth:100}),this._getTopPanel(),{id:this.id+"buffer_comments",xtype:"textareafield",name:"comments",fieldLabel:"Comments",width:600,height:80}]}]}),this.panel},BufferGrid.prototype._edit=function(a){function b(){return[{text:"Save",handler:function(){var a=function(a){var b=function(a,b){c.window.close(),c.onUpdated.notify(),c.panel.setLoading(!1)};c.panel.setLoading("Updading proposal information"),EXI.getDataAdapter({onSuccess:b}).proposal.proposal.update()};return""==c.bufferForm.getBuffer().name?void BUI.showWarning("Name field is mandatory"):""==c.bufferForm.getBuffer().acronym?void BUI.showWarning("Acronym field is mandatory"):""==c.bufferForm.getBuffer().proposalId||null==c.bufferForm.getBuffer().proposalId?void BUI.showWarning("Proposal field is mandatory"):void EXI.getDataAdapter({onSuccess:a}).saxs.buffer.saveBuffer(c.bufferForm.getBuffer())}},{text:"Cancel",handler:function(){c.window.close()}}]}var c=this;this.bufferForm=new BufferForm({height:400,width:700}),this.window=Ext.create("Ext.window.Window",{title:"Edit buffer",layout:"fit",items:this.bufferForm.getPanel(),buttons:b()}).show(),this.bufferForm.load(this.getBufferById(a))},BufferGrid.prototype.getBufferById=function(a){for(var b=0;b<this.buffers.length;b++)if(this.buffers[b].bufferId==a)return this.buffers[b];return{}},BufferGrid.prototype.load=function(a){this.buffers=a,this.proposalKey={},this.proposalColor={};for(var b=0;b<a.length;b++){var c=EXI.proposalManager.getProposalById(a[b].proposalId);a[b].proposal=c.code+c.number}this.store.loadData(a,!1)},BufferGrid.prototype._getTbar=function(){var a=this,b=[];return b.push(Ext.create("Ext.Action",{text:"Add",icon:"images/icon/add.png",disabled:!1,handler:function(b,c){a._edit()}})),b},BufferGrid.prototype.getPanel=function(){var a=this;this.store=Ext.create("Ext.data.Store",{fields:["proposal","bufferId","acronym","name","composition","comments","ph"]}),this.store.sort("acronym");var b="Ext.grid.Panel";return 1==this.searchBar&&(b="Ext.ux.LiveSearchGridPanel"),this.panel=Ext.create(b,{title:"Buffers",collapsible:this.collapsible,collapsed:this.collapsed,store:this.store,height:this.height,width:this.width,columns:[{text:"Proposal",dataIndex:"proposal",flex:1},{text:"Acronym",dataIndex:"acronym",flex:2},{text:"Name",dataIndex:"name",flex:2,hidden:!1},{text:"pH",dataIndex:"ph",flex:2},{text:"Composition",dataIndex:"composition",flex:2,hidden:!1},{text:"Comments",dataIndex:"comments",flex:4,hidden:!1},{xtype:"actioncolumn",width:40,text:"Edit",items:[{icon:"images/icon/edit.png",tooltip:"Edit",handler:function(b,c,d){var e=b.getStore().getAt(c);a._edit(e.get("bufferId"))}}]}],flex:1,viewConfig:{stripeRows:!0,listeners:{celldblclick:function(b,c,d,e,f,g,h,i){a._edit(e.data.bufferId)}}}}),this.tbar&&this.panel.addDocked({xtype:"toolbar",cls:"toolBarGrid",height:48,items:this._getTbar()}),this.panel},BufferGrid.prototype.input=function(){return(new MacromoleculeGrid).input()},BufferGrid.prototype.test=function(a){var b=new BufferGrid({width:800,height:350,collapsed:!1,tbar:!0});BIOSAXS.proposal=new Proposal(b.input().proposal);var c=b.getPanel(BIOSAXS.proposal.macromolecules);c.render(a)},CaseGrid.prototype._getHTMLTable=function(a){for(var b="<table style='font-size:14px;color:gray;'>",c=0;c<a.length;c++)b+="<tr>",b+="<td>",b+=a[c].key,b+="</td>",b+="<td style='font-weight:bold;color:black;'>",b+=a[c].value,b+="</td>",b+="</tr>";return b+"</table>"},CaseGrid.prototype._getHTMLButton=function(a,b){return'<input id="'+a+' "type="button" name="btn" style="font-size:9px;width:90px; height:40px" class="btn-component" value="'+b+'" >'},CaseGrid.prototype._getUnpackStockSolutionButton=function(a,b){return'<input id="'+a+'"type="button" name="stockSolution" style="font-size:9px;width:90px; height:40px" class="btn-component-remove" value="'+b+'" >'},CaseGrid.prototype._getRemoveContainerButton=function(a,b){return'<input id="'+a+'"type="button" name="puck" style="font-size:9px;width:90px; height:40px" class="btn-component-remove" value="'+b+'" >'},CaseGrid.prototype._getEditPuckButton=function(a,b,c){return'<input id="'+a+"_"+b+'"type="button" name="edit" style="font-size:9px;width:90px; height:40px" class="btn-component-puck-edit" value="'+c+'" >'},CaseGrid.prototype._getPrintParcelButton=function(a,b){return'<input id="'+a+' "type="button" name="printLabels" style="font-size:9px;width:90px; height:40px" class="btn-component-print-parcel" value="'+b+'" >'},CaseGrid.prototype._getEditParcelButton=function(a,b){return'<input id="'+a+' "type="button" name="editParcel" style="font-size:9px;width:90px; height:40px" class="btn-component-edit-parcel" value="'+b+'" >'},CaseGrid.prototype._getRemoveParcelButton=function(a,b){return'<input id="'+a+' "type="button" name="removeParcel" style="font-size:9px;width:90px; height:40px" class="btn-component-remove" value="'+b+'" >'},CaseGrid.prototype._getComponentRowHTML=function(a,b,c,d,e){var f="";return f+="<tr  class='tr-component'>",f+="<td>",f+=this._getEditPuckButton(b,Number(e),"Edit"),f+="</td>",f+="<td>",f+=b,f+="</td>",f+="<td>",f+=c,f+="</td>",f+="<td>",f+=d,f+="</td>","Stock Solution"==b&&(f+="<td>",f+=this._getUnpackStockSolutionButton(Number(e),"Unpack"),f+="</td>"),"Puck"==b&&(f+="<td>",f+=this._getRemoveContainerButton(Number(e),"Remove"),f+="</td>"),f+="</tr>"},CaseGrid.prototype._getComponentHTML=function(a,b){var c="";if(b.length>0){c="<table  class='table-component'><tr><th class='th-component'></th><th class='th-component'>Type</th><th class='th-component'>Code</th><th class='th-component'>Capacity</th><th></th></tr>";for(var d=0;d<b.length;d++){var e="../images/BasketView_24x24_01.png";"Puck"==b[d].type&&(c+=this._getComponentRowHTML(e,b[d].type,b[d].code,b[d].sampleCount+"/"+b[d].capacity,b[d].id)),"Stock Solution"==b[d].type&&(e="../images/SampleHolderView_24x24_01.png",c+=this._getComponentRowHTML(e,b[d].type,b[d].code,b[d].capacity,b[d].id))}c+="</table>"}else c+="<br /><br /><span class='parcel-empty-msg'>This parcel is empty</span>";return 0==b.length&&(c=this._getHTMLButton(a,"Add Solution")+this._getHTMLButton(a,"Add Puck")+c),b.length>0&&(c="Puck"==b[0].type?this._getHTMLButton(a,"Add Puck")+c:this._getHTMLButton(a,"Add Solution")+c),'<div  class="header-component-table" >Components</div><div  style="margin:0px 0px 0px 0px !important;width:610px;">'+c+"</div>"},CaseGrid.prototype._getParcelHTML=function(a){var b="<table  class='table-component'><tr><th class='th-component'>Code</th><th class='th-component'>Status</th><th class='th-component'>Store Location</th><th class='th-component'>Comments</th></tr>",c=a.Dewar_storageLocation,d=a.Dewar_code,e=a.Dewar_status,f=a.Dewar_comments;return null==d&&(d="<span style='color:orange'>Not set</span>"),null==e&&(e="<span style='color:orange'>Unknown</span>"),null==c&&(c="<span style='color:orange'>Not set</span>"),null==f&&(f=""),b=b+"<tr class='tr-component'><td>"+d+"</td><td>"+e+"</td><td>"+c+"</td><td>"+f+"</td></tr></table>",b=this._getEditParcelButton(a.Dewar_dewarId,"Edit")+this._getPrintParcelButton(a.Dewar_dewarId,"Print Labels")+this._getRemoveParcelButton(a.Dewar_dewarId,"Remove")+b,'<div  class="header-component-table" >Parcel</div><div  style="margin:0px 0px 0px 0px !important;width:610px;">'+b+"</div>"},CaseGrid.prototype._getColumns=function(){var a=this,b=[{header:"General",dataIndex:"type",name:"type",type:"string",flex:.5,renderer:function(b,c,d){var e=JSON.parse(d.data.serialized);return a._getParcelHTML(e[0])}},{header:"Content",dataIndex:"Dewar_comments",name:"type",type:"string",flex:.5,renderer:function(b,c,d){var e=JSON.parse(d.data.serialized),f=e[0].Dewar_dewarId,g=[];if(null!=e&&e.length>0)for(var h=0;h<e.length;h++)if("Puck"==e[h].Container_containerType){var i="";null!=e[h].Container_code&&(i=e[h].Container_code),g.push({type:e[h].Container_containerType,code:i,capacity:e[h].Container_capacity,sampleCount:e[h].sampleCount,id:e[h].Container_containerId})}var j=EXI.proposalManager.getStockSolutionsByDewarId(f);if(j)for(var h=0;h<j.length;h++)g.push({type:"Stock Solution",code:j[h].name,capacity:j[h].volume+"ml",sampleCount:"",id:j[h].stockSolutionId});return a._getComponentHTML(f,g)}}];return b},CaseGrid.prototype._getTopButtons=function(){var a=this,b=[];return b.push(Ext.create("Ext.Action",{icon:"../images/icon/add.png",text:"Add",disabled:!1,handler:function(b,c){a.edit()}})),b},CaseGrid.prototype.groupBy=function(a,b){var c={};return a.forEach(function(a){var d=JSON.stringify(b(a));c[d]=c[d]||[],c[d].push(a)}),Object.keys(c).map(function(a){return c[a]})},CaseGrid.prototype.load=function(a){function b(a,b){for(var d=c.groupBy(b,function(a){return[a.Dewar_dewarId]}),e=[],f=0;f<d.length;f++)e.push({serialized:JSON.stringify(d[f])});c.store.loadData(e)}var c=this;this.shipment=a,this.dewars=a.dewarVOs,this.dewars.length>0&&EXI.getDataAdapter({onSuccess:b}).proposal.shipping.getDewarsByShipmentId(a.shippingId)},CaseGrid.prototype.edit=function(a){var b=this,c=new CaseForm,d=Ext.create("Ext.window.Window",{title:"Parcel",height:360,width:600,modal:!0,layout:"fit",items:[c.getPanel(a)],buttons:[{text:"Save",handler:function(){new DataAdapter;b.panel.setLoading();var a=c.getDewar(),e=function(a,c){b.load(c),d.close(),b.panel.setLoading(!1)};a.sessionId=a.firstExperimentId,a.shippingId=b.shipment.shippingId,EXI.getDataAdapter({onSuccess:e}).proposal.dewar.saveDewar(b.shipment.shippingId,a)}},{text:"Cancel",handler:function(){d.close()}}]});d.show()},CaseGrid.prototype._getStoreFields=function(){return[{name:"serialized",type:"string"}]},CaseGrid.prototype.getDewarById=function(a){for(var b=this,c=0;c<b.dewars.length;c++)if(b.dewars[c].dewarId==a)return b.dewars[c]},CaseGrid.prototype.saveStockSolution=function(a){var b=this;this.panel.setLoading();var c=function(){var a=function(){b.panel.setLoading(!1),b.load(b.shipment)};EXI.getDataAdapter({onSuccess:a}).proposal.proposal.update();
};EXI.getDataAdapter({onSuccess:c}).saxs.stockSolution.saveStockSolution(a)},CaseGrid.prototype.addPuckToDewar=function(a){var b=this;this.panel.setLoading();var c=function(){b.load(b.shipment),b.panel.setLoading(!1)};EXI.getDataAdapter({onSuccess:c}).proposal.shipping.addPuck(this.shipment.shippingId,Number(a))},CaseGrid.prototype.removePuck=function(a){var b=this;this.panel.setLoading();var c=function(a,c){b.load(b.shipment),b.panel.setLoading(!1)};EXI.getDataAdapter({onSuccess:c}).proposal.shipping.removeContainerById(b.shipment.shippingId,a,a)},CaseGrid.prototype.openStockSolutionWindow=function(a){var b=this,c=new StockSolutionGrid({btnAddVisible:!1,btnEditVisible:!1,btnRemoveVisible:!1,btnAddExisting:!1,isPackedVisible:!1,multiselect:!0}),d=Ext.create("Ext.window.Window",{height:400,width:700,items:[c.getPanel()],buttons:[{text:"Pack",handler:function(){d.close(),c.selectedStockSolutions[0].boxId=a,b.saveStockSolution(c.selectedStockSolutions[0])}},{text:"Cancel",handler:function(){d.close()}}]}).show();c.load(EXI.proposalManager.getUnpackedStockSolutions())},CaseGrid.prototype.getPanel=function(){var a=this;return this.store=Ext.create("Ext.data.Store",{fields:this._getStoreFields(),data:[],autoload:!0}),this.panel=Ext.create("Ext.grid.Panel",{style:{padding:15},cls:"border-grid",height:800,deferEmptyText:!1,emptyText:"No data",store:this.store,columns:this._getColumns(),disableSelection:!0,viewConfig:{stripeRows:!0,enableTextSelection:!0,preserveScrollOnRefresh:!0,stripeRows:!0,rowLines:!0,listeners:{celldblclick:function(b,c,d,e,f,g,h,i){a.edit(a.getDewarById(JSON.parse(e.data.serialized)[0].Dewar_dewarId))},cellclick:function(b,c,d,e,f,g,h,i){function j(b){"yes"==b&&a.removePuck(s)}if("printLabels"==h.target.name){var k=h.target.id.trim(),l=EXI.getDataAdapter().proposal.shipping.getDewarLabelURL(a.shipment.shippingId,k);return console.log(k),void(location.href=l)}if("removeParcel"==h.target.name)return void BUI.showWarning("Not implemented yet");if("editParcel"==h.target.name)return void a.edit(a.getDewarById(parseInt(h.target.id.trim())));if("edit"==h.target.name){if(-1!=h.target.id.indexOf("Stock Solution")){var m=h.target.id.split("_")[1];location.hash="/stocksolution/"+m+"/main"}if(-1!=h.target.id.indexOf("Puck")){var n=h.target.id.split("_")[1],o=new PuckForm({width:Ext.getBody().getWidth()-150});o.onSaved.attach(function(b,c){a.load(a.shipment),p.close()});var p=Ext.create("Ext.window.Window",{title:"Edit Puck",height:700,width:Ext.getBody().getWidth()-100,modal:!0,resizable:!0,layout:"fit",items:o.getPanel()}).show();if(null!=n){var q=function(a,b){o.load(b)};EXI.getDataAdapter({onSuccess:q}).proposal.shipping.getContainerById(n,n,n)}}}if("Add Solution"==h.target.defaultValue&&a.openStockSolutionWindow(h.target.id),"Add Puck"==h.target.defaultValue&&a.addPuckToDewar(h.target.id),"Unpack"==h.target.defaultValue&&"stockSolution"==h.target.name){var r=EXI.proposalManager.getStockSolutionById(h.target.id);r.boxId=null,a.saveStockSolution(r)}if("Remove"==h.target.defaultValue){var s=Number(h.target.id);"puck"==h.target.name&&Ext.MessageBox.show({title:"Save Changes?",msg:"Removing a puck from this parcel will remove also its content. <br />Are you sure you want to continue?",buttons:Ext.MessageBox.YESNOCANCEL,fn:j,animateTarget:"mb4",icon:Ext.MessageBox.QUESTION})}}}},selModel:{mode:"SINGLE"}}),this.panel.addDocked({height:45,xtype:"toolbar",items:a._getTopButtons(),cls:"exi-top-bar"}),this.panel},DataReductionForm.prototype._parseSelectedItemsToIds=function(a){var b=[];if(null!=a)for(var c=0;c<a.length;c++)b.push(a[c].id);return b},DataReductionForm.prototype.onSelectionChanged=function(a,b){null!=b&&("Frames"==a&&(this.selectedItems.frames=b,this.selectedItems.subtractions=[]),"Averages"==a&&(this.selectedItems.averages=b),"Subtractions"==a&&(this.selectedItems.frames=[],this.selectedItems.subtractions=b)),this.plotWidget.refresh(this._parseSelectedItemsToIds(this.selectedItems.frames),this._parseSelectedItemsToIds(this.selectedItems.subtractions))},DataReductionForm.prototype._getFramesExtPanel=function(a,b,c){var d=this,e=Ext.create("Ext.selection.RowModel",{allowDeselect:!0,mode:"MULTI",listeners:{selectionchange:function(a,c){for(var e=[],f=0;f<c.length;f++)e.push(c[f].data);d.onSelectionChanged(b,e)}}});return Ext.create("Ext.grid.Panel",{store:a,margin:10,height:c,width:200,selModel:e,columns:[{text:b,dataIndex:"fileName",flex:1}],viewConfig:{}})},DataReductionForm.prototype._getFramesPanel=function(){var a=["fileName","type","id"];this.framesStore=Ext.create("Ext.data.Store",{fields:a,sorters:"fileName"}),this.averagesStore=Ext.create("Ext.data.Store",{fields:a}),this.subtractionStore=Ext.create("Ext.data.Store",{fields:a});var b=this._getFramesExtPanel(this.framesStore,"Frames",375),c=(this._getFramesExtPanel(this.averagesStore,"Averages",125),this._getFramesExtPanel(this.subtractionStore,"Subtractions",75));return{xtype:"container",layout:"vbox",items:[b,c]}},DataReductionForm.prototype._getImageContainer=function(a,b){var c="<div id='"+this.id+"_"+a+"'>"+a+"</div>";return{xtype:"container",layout:"vbox",items:[{html:c,margin:"5 0 0 0",height:95,width:100},{xtype:"label",forId:"myFieldId",text:b,margin:"5 0 0 0",cls:"inline-help"}]}},DataReductionForm.prototype._getItems=function(){return[{xtype:"container",layout:"hbox",items:[this._getFramesPanel(),this.plotWidget.getPanel(),{xtype:"panel",width:110,frame:!0,margin:"10 5 5 5",border:0,layout:"vbox",items:[this._getImageContainer("scattering","Scattering"),this._getImageContainer("guinier","Guinier Region"),this._getImageContainer("kratky","Kratky Plot"),this._getImageContainer("gnom","P(r) distribution")]}]}]},DataReductionForm.prototype._getButtons=function(){return[]},DataReductionForm.prototype.getPanel=function(){var a=this;return this.panel=Ext.create("Ext.form.Panel",{width:this.width,height:this.height,border:0,items:this._getItems(),buttons:this._getButtons(),listeners:{afterrender:function(){a._populate()}}}),this.panel},DataReductionForm.prototype._populate=function(){},DataReductionForm.prototype.refresh=function(a){if(null!=a)for(var b=0;b<a.length;b++){var c=a[b],d=[{fileName:BUI.getFileName(c.bufferAverageFilePath),type:"bufferAvg",id:c.subtractionId},{fileName:BUI.getFileName(c.sampleAverageFilePath),type:"sampleAvg",id:c.subtractionId}];this.averagesStore.loadData(d,!0),this.subtractionStore.loadData([{fileName:BUI.getFileName(c.substractedFilePath),type:"SUBTRACTION",id:c.subtractionId}],!0);var e=[];if(null!=c.bufferOneDimensionalFiles&&null!=c.bufferOneDimensionalFiles.frametolist3VOs)for(var f=0;f<c.bufferOneDimensionalFiles.frametolist3VOs.length;f++){var g=c.bufferOneDimensionalFiles.frametolist3VOs[f];null!=g.frame3VO&&e.push({fileName:BUI.getFileName(g.frame3VO.filePath),type:"BUFFER",id:g.frame3VO.frameId})}if(null!=c.sampleOneDimensionalFiles&&null!=c.sampleOneDimensionalFiles.frametolist3VOs)for(var f=0;f<c.sampleOneDimensionalFiles.frametolist3VOs.length;f++){var g=c.sampleOneDimensionalFiles.frametolist3VOs[f];null!=g.frame3VO&&e.push({fileName:BUI.getFileName(g.frame3VO.filePath),type:"SAMPLE",id:g.frame3VO.frameId})}this.framesStore.loadData(e,!0),this._displayImage("scattering",c.subtractionId),this._displayImage("kratky",c.subtractionId),this._displayImage("guinier",c.subtractionId),this._displayImage("gnom",c.subtractionId)}},DataReductionForm.prototype._displayImage=function(a,b){var c=(new DataAdapter).getImage(b,a);console.log(c);var d="OnClick= window.open('"+c+"')";document.getElementById(this.id+"_"+a).innerHTML="<img src="+c+'   height="90" width="90" '+d+">"},DataReductionForm.prototype.input=function(){return{}},DataReductionForm.prototype.test=function(a){var b=new DataReductionForm,c=b.getPanel();c.render(a)},ExperimentGrid.prototype._getFilterTypes=function(){return[]},ExperimentGrid.prototype._prepareData=function(a){var b=[],c=0;a.sort(function(a,b){return b.experimentId-a.experimentId});for(var d=0;d<a.length;d++){var e=a[d];this.dates[moment(e.creationDate).format("YYYYMMDD")]=moment(e.creationDate).format("MMM Do YY"),null!=this.filtered&&e.experimentType!=this.filtered||!(c<this.limit||null==this.limit)||null!=this.sessionIdFilter&&null==this.date&&(null!=this.date||this.sessionIdFilter!=e.sessionId)||(b.push({experimentId:e.experimentId,status:e.status,dataAcquisitionFilePath:e.dataAcquisitionFilePath,type:e.experimentType,name:e.name,macromolecules_names:e.macromolecules,percentageAnalysed:{value:e.dataCollectionDoneCount/e.dataCollectionCount*100,text:e.dataCollectionDoneCount+" of "+e.dataCollectionCount},percentageCollected:{value:e.measurementDoneCount/e.measurementCount*100,text:e.measurementDoneCount+" of "+e.measurementCount},percentageMerged:{value:e.measurementAveragedCount/e.measurementCount*100,text:e.measurementAveragedCount+" of "+e.measurementCount},date:moment(e.creationDate).format("YYYYMMDD"),time:moment(e.creationDate).format("YYYYMMDDHHmmss"),creationDate:e.creationDate}),c++)}return b},ExperimentGrid.prototype.getPanel=function(a){return this.features=a,this._renderGrid(a)},ExperimentGrid.prototype.refresh=function(a){this.experiments=a;for(var b=[],c=0;c<a.length;c++)"TEMPLATE"!=a[c].experimentType&&b.push(a[c]);this.parsedData=this._prepareData(b);for(var d={},e=[],c=0;c<this.experiments.length;c++){var f=moment(this.experiments[c].creationDate).format("MMM Do YYYY");null==d[f]&&(e.push({date:f,value:moment(this.experiments[c].creationDate)}),d[f]=!0)}this.storeDate.loadData(e,!1),this.store.loadData(this.parsedData,!1),null!=this.date&&this._filterByDate(this.date)},ExperimentGrid.prototype._getTopButtons=function(){var a=this,b=[];return b.push(Ext.create("Ext.Action",{icon:"../images/calendar_icon.png",text:"Show Calendar",disabled:!1,handler:function(b,c){var d=Ext.create("Ext.window.Window",{title:"Calendar",width:600,height:600,modal:!0,closable:!0,layout:{type:"vbox",align:"stretch"},items:[{xtype:"label",html:"Click on a data acquisition to select:",margin:"5 5 5 5"},{html:'<div id="calendar" style="height:450px;overflow-y: scroll;"></div>',margin:"5 5 5 5"}]}).show(),e=new CalendarWidget({height:450}),f=a.limit;a.limit=null,a.sessionIdFilter=null,e.loadData(a._prepareData(a.experiments)),a.limit=f,e.draw("calendar"),e.onClick.attach(function(b,c){c=moment(c,"YYYY-MM-DD"),a._filterByDate(c),d.close()})}})),this.storeDate=Ext.create("Ext.data.ArrayStore",{fields:["date","value"],data:[]}),this.dateMenu=Ext.create("Ext.form.field.ComboBox",{hideLabel:!0,store:this.storeDate,displayField:"date",typeAhead:!0,queryMode:"local",margin:"0 0 0 30",triggerAction:"all",emptyText:"Select a date...",selectOnFocus:!0,width:135,listeners:{scope:this,select:function(b,c,d){a.limit=null,a._filterByDate(moment(c[0].raw.value,"YYYY-MM-DD"))}}}),b.push(this.dateMenu),b.push("->"),null!=a.filtered?b.push({html:"<span>Experiment Type: "+a.filtered+"</span>"}):b.push({html:"<span>Experiment Type: ALL</span>"}),b},ExperimentGrid.prototype._filterByDate=function(a){for(var b=[],c=0;c<this.experiments.length;c++){var d=this.experiments[c];if(null!=d.creationDate){var e=moment(d.creationDate);e.year()==a.year()&&e.month()==a.month()&&e.date()==a.date()&&b.push(d)}}var f=this._prepareData(b);this.store.loadData(f),this.date=a},ExperimentGrid.prototype._removeExperimentById=function(a){var b=this,c=new BiosaxsDataAdapter;c.onSuccess.attach(function(a,c){b.grid.setLoading(!1),document.getElementById(BIOSAXS.targetId).innerHTML="",BIOSAXS.start(BIOSAXS.targetId)}),this.grid.setLoading("Removing experiment "),c.removeExperimentById(a)},ExperimentGrid.prototype._renderGrid=function(){var a=this;this.store=Ext.create("Ext.data.Store",{fields:["name"],autoload:!0,data:[],remoteSort:!1,sorters:this.sorters});var b=Ext.create("Ext.grid.feature.Grouping",{groupHeaderTpl:Ext.create("Ext.XTemplate","<div style='background:#0ca3d2; color:white; float:left; margin:6px 8px 0 0; padding:5px 8px;'>{name:this.formatName}</div>",{formatName:function(b){return a.dates[b]}}),hideGroupedHeader:!0,startCollapsed:!1});this.features=[],this.grouping&&this.features.push(b),this.grid=Ext.create(this.gridType,{hideHeaders:this.hideHeaders,resizable:!0,title:this.title,width:this.width,minHeight:this.minHeight,height:this.height,features:this.features,store:this.store,columns:this._getColumns(),selModel:{mode:"SINGLE"},viewConfig:{stripeRows:!0,getRowClass:function(a,b,c,d){return"TEMPLATE"==a.raw.type?"template-color-row":"CALIBRATION"==a.raw.type&&"FINISHED"==a.raw.status?"blue-row":void 0},listeners:{itemdblclick:function(b,c,d,e){a._editExperiment(c.raw.experimentId)},cellclick:function(b,c,d,e,f,g,h,i){b.getGridColumns()[d].getId()==a.id+"GO"&&a._editExperiment(e.raw.experimentId),b.getGridColumns()[d].getId()==a.id+"REMOVE"&&a._removeExperimentById(e.raw.experimentId)}}}});var c=a._getTopButtons();return this.tbar&&(this.grid.addDocked({xtype:"toolbar",height:48,items:c}),this.grid.getSelectionModel().on({selectionchange:function(a,b){if(b.length)for(var d=0;d<c.length;d++)c[d].enable&&c[d].enable();else for(var d=0;d<c.length;d++)0==c[d].alwaysEnabled&&c[d].disable&&c[d].disable()}})),this.grid},ExperimentGrid.prototype._getColumns=function(){var a=this;return[{text:"experimentId",dataIndex:"experimentId",name:"experimentId",type:"string",hidden:!0},{xtype:"rownumberer",width:40},{text:"Name",dataIndex:"name",name:"name",type:"string",flex:1},{text:"Type",dataIndex:"type",name:"type",type:"string",flex:1,renderer:function(a){return"CALIBRATION"==a?"<span style='color:blue;'>"+a+"</span>":a}},{text:"Macromolecules",name:"macromolecules_names",dataIndex:"macromolecules_names",flex:1,renderer:function(a){return null!=a?" <span style='font-weight:bold'>"+a+"</span>":" <span style='font-style:italic;color:gray;'>Information not available</span>"}},{text:"Buffers",dataIndex:"buffer_names",name:"buffer_names",flex:1,hidden:!0,renderer:function(a){return"Buffer/s: <span style='font-weight:bold'>"+a+"</span>"}},{text:"Status",dataIndex:"status",name:"status",type:"string",flex:1,renderer:function(a,b,c){return"TEMPLATE"==c.raw.type?"READY":"ABORTED"==c.raw.status?"<span style='color:red;'>"+a+"</span>":"<span style='color:green;'>"+a+"</span>"}},{text:"Download",dataIndex:"creationDate",name:"creationDate",renderer:function(a,b,c){if(null!=c){if("HPLC"==c.raw.type)return;return BUI.getZipHTMLByExperimentId(c.raw.experimentId,c.raw.name)}},width:100},{header:"Measurements",dataIndex:"percentageCollected",name:"percentageCollected",type:"string",renderer:function(a,b,c){return"TEMPLATE"!=c.raw.type&&"HPLC"!=c.raw.type?"<table><tr><td>"+BUI.getProgessBar(c.raw.percentageCollected.value,c.raw.percentageCollected.text)+"</td></table>":void 0},width:100},{header:"Averaged",dataIndex:"percentageMerged",name:"percentageMerged",type:"string",renderer:function(a,b,c){return"TEMPLATE"!=c.raw.type&&"HPLC"!=c.raw.type?"<table><tr><td>"+BUI.getProgessBar(c.raw.percentageMerged.value,c.raw.percentageMerged.text)+"</td></table>":void 0},width:100},{header:"Subtractions",dataIndex:"percentageAnalysed",name:"percentageAnalysed",type:"string",renderer:function(a,b,c){return"TEMPLATE"!=c.raw.type&&"HPLC"!=c.raw.type?"<table><tr><td>"+BUI.getProgessBar(c.raw.percentageAnalysed.value,c.raw.percentageAnalysed.text)+"</td></table>":void 0},width:100},{text:"time",dataIndex:"time",name:"time",hidden:!0,renderer:function(a){return a},width:100},{text:"Date",dataIndex:"date",name:"date",renderer:function(a){return a},width:100},{text:"Time",dataIndex:"creationDate",name:"creationDate",renderer:function(a){return moment(a).format(" HH:mm:ss")},width:100},{id:a.id+"GO",width:80,sortable:!1,renderer:function(a,b,c,d,e,f){return BUI.getGreenButton("GO")}}]},ExperimentGrid.prototype._editExperiment=function(a){null!=Ext.urlDecode(window.location.href).sessionId?location.href="viewProjectList.do?reqCode=display&experimentId="+a+"&sessionId="+Ext.urlDecode(window.location.href).sessionId:location.href="viewProjectList.do?reqCode=display&experimentId="+a},ExperimentGrid.prototype.input=function(){var a=DATADOC.getExperimentList_10();return{experiments:a,proposal:(new MeasurementGrid).input().proposal}},ExperimentGrid.prototype.test=function(a){var b=new ExperimentGrid({height:350,minHeight:350,width:1e3});BIOSAXS.proposal=new Proposal(b.input().proposal);var c=b.getPanel(b.input().experiments);b.refresh(b.input().experiments),c.render(a)},ExperimentHeaderForm.prototype.load=function(a){this.experiment=a,Ext.getCmp(this.id+"name").setValue(a.name),document.getElementById(this.id+"date").innerHTML="Created on "+a.creationDate,Ext.getCmp(this.id+"comments").setValue(a.json.comments)},ExperimentHeaderForm.prototype.getToolBar=function(){var a=this;return[{text:"Save",width:100,handler:function(){a.panel.setLoading();var b=function(b){a.panel.setLoading(!1)};EXI.getDataAdapter({onSuccess:b}).saxs.experiment.saveExperiment(a.experiment.experimentId,Ext.getCmp(a.id+"name").getValue(),Ext.getCmp(a.id+"comments").getValue())}},"->",Ext.create("Ext.button.Split",{text:"Download",menu:new Ext.menu.Menu({items:[{text:"For BsxCube on bm29",handler:function(){window.open(EXI.getDataAdapter().saxs.template.getTemplateSourceFile(a.experiment.experimentId,"bsxcube"))}},{text:"For Becquerel on p12",handler:function(){window.open(EXI.getDataAdapter().saxs.template.getTemplateSourceFile(a.experiment.experimentId,"becquerel"))}}]})})]},ExperimentHeaderForm.prototype.getPanel=function(){return this.panel=Ext.create("Ext.panel.Panel",{layout:"vbox",buttons:this.getToolBar(),cls:"border-grid",items:[{xtype:"container",margin:"10 0 0 20",layout:"hbox",items:[{xtype:"container",layout:"vbox",items:[{xtype:"textfield",fieldLabel:"Name",id:this.id+"name"},{margin:"0 0 0 100",html:"<div style='color:gray;' id='"+this.id+"date';></div>"}]},{xtype:"textarea",fieldLabel:"Comments",margin:"0 0 10 20",width:600,height:80,id:this.id+"comments"}]}]}),this.panel},FrameSelectorGrid.prototype.loadData=function(a,b){function c(a){function b(a){for(var b=0;b<e.measurements.length;b++)if(e.measurements[b].measurementId==a)return null!=e.measurements[b].macromoleculeId?e.measurements[b].macromoleculeAcronym+":  "+e.measurements[b].concentration+"mg/ml":""}var c="";a.measurementtodatacollection3VOs.sort(function(a,b){return a.dataCollectionOrder-b.dataCollectionOrder});for(var d=0;d<a.measurementtodatacollection3VOs.length;d++)c=c+" "+b(a.measurementtodatacollection3VOs[d].measurementId);return c}function d(a){function b(a){var b=[];if(a.frametolist3VOs)for(var c=0;c<a.frametolist3VOs.length;c++)b.push({text:a.frametolist3VOs[c].frame3VO.filePath,type:"Frame",frameId:a.frametolist3VOs[c].frame3VO.frameId,leaf:!0});return b}var c=[];if(null!=a&&null!=a.substraction3VOs&&(a.substraction3VOs.sort(function(a,b){return a.subtractionId-b.subtractionId}),a.substraction3VOs.length>0)){var d=a.substraction3VOs[a.substraction3VOs.length-1];c.push({text:d.substractedFilePath,subtractionId:d.subtractionId,type:"Subtraction",leaf:!0}),c.push({text:d.sampleAverageFilePath,subtractionId:d.subtractionId,type:"SampleAverage",leaf:!0}),c.push({text:d.bufferAverageFilePath,subtractionId:d.subtractionId,type:"BufferAverage",leaf:!0}),null!=d.sampleOneDimensionalFiles&&c.push({text:"Sample",leaf:!1,type:"Sample",children:b(d.sampleOneDimensionalFiles,"Sample")}),null!=d.bufferOneDimensionalFiles&&c.push({text:"Buffer",leaf:!1,type:"Buffer",children:b(d.bufferOneDimensionalFiles,"Buffer")})}return c}for(var e=this,f=[],g=0;g<b.length;g++)f.push({text:c(b[g]),leaf:!1,children:d(b[g])});e.treePanel.setRootNode({expanded:!0,children:f})},FrameSelectorGrid.prototype.load=function(a){var b=this;this.measurements=a,this.subtractionIds=[];var c=[];if(null!=this.measurements)for(var d=0;d<this.measurements.length;d++)null!=this.measurements[d].dataCollectionId&&(c.push(this.measurements[d].dataCollectionId),this.subtractionIds.push(this.measurements[d].subtractionId));this.subtractionIds=$.unique(this.subtractionIds);var e=function(a,c){null!=c&&b.loadData(b.measurements,c)};EXI.getDataAdapter({onSuccess:e}).saxs.dataCollection.getDataCollectionsByIdList(c)},FrameSelectorGrid.prototype.getPanel=function(){var a=this;this.store=Ext.create("Ext.data.TreeStore",{proxy:{type:"memory"},columns:[{xtype:"treecolumn",text:"Text",dataIndex:"text"}]});var b=Ext.create("Ext.selection.RowModel",{allowDeselect:!0,mode:"multi",listeners:{selectionchange:function(b,c){var d=[],e=[],f=[],g=[];if(null!=c){for(var h=0;h<c.length;h++)c[h].data.type&&("Frame"==c[h].data.type&&d.push(c[h].data.frameId),"SampleAverage"==c[h].data.type&&e.push(c[h].data.subtractionId),"BufferAverage"==c[h].data.type&&f.push(c[h].data.subtractionId),"Subtraction"==c[h].data.type&&g.push(c[h].data.subtractionId));a.onSelectionChange.notify({frame:d,average:[],sampleaverage:e,bufferaverage:f,subtracted:g})}}}});return this.treePanel=Ext.create("Ext.tree.Panel",{title:"Data Collections",selModel:b,store:this.store,rootVisible:!1,buttons:[{text:"Download",xtype:"button",handler:function(b){window.open(EXI.getDataAdapter().saxs.subtraction.getZip(a.subtractionIds.toString()))}}],columns:[{xtype:"treecolumn",dataIndex:"text",flex:1,renderer:function(a,b,c){return c.data.leaf&&-1!=c.data.text.lastIndexOf("/")?c.data.text.substr(c.data.text.lastIndexOf("/")+1):c.data.text}}]}),this.treePanel},GenericStepWizardForm.prototype.getForm=function(){alert("[getForm] Not implemented")},GenericStepWizardForm.prototype.getNextForm=function(){alert("[getNextForm] Not implemented")},GenericStepWizardForm.prototype.reload=function(){alert("[getNextForm] Not implemented")},HPLCGraph.prototype.getMenu=function(){function a(a,c){c?b.plots[a.param]=!0:delete b.plots[a.param],b.reloadData(this.hplcData)}for(var b=this,c=[],d=0;d<this.hplcData.length;d++)if(0!=this.hplcData[d].showOnMenu){var e=this.hplcData[d].param,f="style='padding:0 0px 0 5px;'";c.push({text:"<table><tr><td>"+BUI.getRectangleColorDIV(this.hplcData[d].color,10,10)+"</td><td "+f+"> "+this.hplcData[d].label+"</td></tr></table>",id:b.id+e,param:e,enableToggle:!0,scope:this,toggleHandler:a,pressed:null!=b.plots[e]})}return c.push("-"),c.push({text:"Scale",enableToggle:!0,scope:this,pressed:this.scaled,icon:"../images/icon_graph.png",toggleHandler:function(a,c){b.scaled=c,b.reloadData(this.hplcData)}}),c.push("->"),c.push({text:"Save",scope:this,icon:"images/icon/ic_get_app_black_24dp.png",handler:function(a,b){var c=document.createElement("img");c.style.display="block",c.style.width="200px",c.style.height="200px",c.setAttribute("src",Dygraph.Export.asCanvas(this.dygraphObject.dygraph).toDataURL()),window.open(Dygraph.Export.asCanvas(this.dygraphObject.dygraph).toDataURL(),"Image","")}}),c},HPLCGraph.prototype.scaledData=function(a){for(var b=0;b<a.length;b++){var c=this.getMaxAndMinValue(a[b]);a[b]=this.divideValuesByMax(a[b],c.max),this.ranges[a[b].label]=c}return a},HPLCGraph.prototype.divideValuesByMax=function(a,b){for(var c=0;c<a.data.length;c++)0!=b&&(a.data[c]=Number(a.data[c])/b,a.std[c]=Number(a.std[c])/b);return a},HPLCGraph.prototype.getMaxAndMinValue=function(a){for(var b=0,c=a.data[0],d=0;d<a.data.length;d++)Number(a.data[d])>b&&(b=Number(a.data[d])),Number(a.std[d])>b&&(b=Number(a.std[d])),Number(a.data[d])<c&&(c=Number(a.data[d]));return{max:Number(b),min:Number(c)}},HPLCGraph.prototype.getPoint=function(a,b){var c=parseFloat(a.data[b]),d=parseFloat(a.std[b]);return null==a.fdata?[c-d,c,c+d]:null!=a.fstd?[a.fstd(c-d),a.fdata(c),a.fstd(c+d)]:[a.fdata(c)-d,a.fdata(c),a.fdata(c)+d]},HPLCGraph.prototype.reloadData=function(a){this.panel.setLoading(!1),this.hplcData=a;var b=a;this.scaled&&(b=this.scaledData(JSON.parse(JSON.stringify(a))));for(var c={},d=[],e=0,f=0;f<b[0].data.length-1;f++){var g=[];for(e=0;e<b.length;e++)null!=this.plots?null!=this.plots[b[e].param]&&(g.push(this.getPoint(b[e],f)),c[b[e].param]=g.length-1):g.push([b[e].data[f]-b[e].std[f],b[e].data[f],b[e].data[f]+b[e].std[f]]);d.push([]);var h=f;for(null!=this.xParam&&(h=parseFloat(b[this.xParam].data[f])),d[d.length-1].push(h),e=0;e<b.length;e++)null!=this.plots?null!=this.plots[b[e].param]&&d[d.length-1].push(g[c[b[e].param]]):d[d.length-1].push(g[e])}var i=[],j=[""];for(e=0;e<b.length;e++)null!=this.plots?null!=this.plots[b[e].param]&&(i.push(b[e].color),j.push(b[e].label)):d[d.length-1].push(g[e]);this._renderDygraph(d,i,j)},HPLCGraph.prototype._renderDygraph=function(a,b,c){var d=this;Ext.getCmp(this.id).setWidth(this.panel.getWidth()),this.dygraphObject=new StdDevDyGraph(this.id,{width:this.panel.getWidth()-20,height:this.height-10,xlabel:this.xlabel,showRangeSelector:this.showRangeSelector,interactionModel:this.interactionModel,scaled:this.scaled}),this.dygraphObject.draw(a,b,c);var d=this;this.dygraphObject.onZoomX.attach(function(a,b){try{d.onZoomX.notify(b)}catch(c){}}),this.dygraphObject.onResetZoom.attach(function(a,b){try{d.onResetZoom.notify(b)}catch(c){}}),this.dygraphObject.dblclick.attach(function(a,b){try{d.dblclick.notify(b)}catch(c){}})},HPLCGraph.prototype.loadData=function(a){var b=this;this.reloadData(a),this.panel.addDocked({cls:"hplcMenu",xtype:"toolbar",items:this.getMenu()}),1==this.bbar&&this.panel.addDocked({border:1,xtype:"toolbar",dock:"bottom",cls:"hplcMenu",items:[{xtype:"numberfield",id:"main_field_start",fieldLabel:"Range from",width:200,labelWidth:100,value:0,minValue:0},{xtype:"numberfield",id:"main_field_end",fieldLabel:"to",width:130,labelWidth:30,value:0,minValue:0},{xtype:"button",text:"Go",handler:function(){var a=parseFloat(Ext.getCmp("main_field_start").getValue()),c=parseFloat(Ext.getCmp("main_field_end").getValue());if(0>a&&(a=0),0>c&&(c=0),a>c){var d=c;c=a,a=d}b.dygraphObject.dygraph.updateOptions({isZoomedIgnoreProgrammaticZoom:!0,dateWindow:[a,c]})}},"->",{xtype:"button",text:"Clear Selection",handler:function(){b.onClearSelection.notify()}}]})},HPLCGraph.prototype.getPanel=function(){return this.panel=Ext.create("Ext.panel.Panel",{padding:this.plotPanelPadding,items:[{html:"",id:this.id,flex:1,height:this.height}]}),this.panel.on("afterrender",function(a){document.getElementById(this.id).setAttribute("style","border: 1px solid #000000; height:"+(a.getHeight()-1)+"px;width:"+(a.getWidth()-50)+"px;")}),this.panel},HPLCGraph.prototype.input=function(){return DATADOC.getHPLCData()},HPLCGraph.prototype.getDataByFrameNumber=function(a){var b={};b.frameNumber=a;for(var c in this.hplcData)b[this.hplcData[c].label]=this.hplcData[c].data[a];return b},HPLCGraph.prototype.test=function(a){var b=new HPLCGraph({title:"I0",width:800,height:400,plots:{I0:!0,Rg:!0,Mass:!0},xlabel:"HPLC Frames",scaled:this.scaled,interactionModel:{dblclick:function(a,b,c){}}});b.getPanel().render(a),b.loadData(b.input())},MergesHPLCGraph.prototype.scaledData=HPLCGraph.prototype.scaledData,MergesHPLCGraph.prototype.divideValuesByMax=HPLCGraph.prototype.divideValuesByMax,MergesHPLCGraph.prototype.getMaxAndMinValue=HPLCGraph.prototype.getMaxAndMinValue,MergesHPLCGraph.prototype.getPoint=HPLCGraph.prototype.getPoint,MergesHPLCGraph.prototype.reloadData=HPLCGraph.prototype.reloadData,MergesHPLCGraph.prototype._renderDygraph=HPLCGraph.prototype._renderDygraph,MergesHPLCGraph.prototype.loadData=HPLCGraph.prototype.loadData,MergesHPLCGraph.prototype.getPanel=HPLCGraph.prototype.getPanel,MergesHPLCGraph.prototype.getDataByFrameNumber=HPLCGraph.prototype.getDataByFrameNumber,MergesHPLCGraph.prototype.setPeaks=function(a){this.peaks=a,this.peakKeys=[],this.colorPeak={};var b=1;for(var c in this.peaks)if(this.peaks.hasOwnProperty(c)){var d=this.peakColors[b%this.peakColors.length];b+=1,this.peakKeys.push(c),this.colorPeak[c]=d}this.peakKeys.sort()},MergesHPLCGraph.prototype.getMenu=function(){function a(a,c){c?b.plots[a.param]=!0:delete b.plots[a.param],b.reloadData(b.hplcData)}var b=this,c=[];if(null!=this.peaks){for(var d=[],e=0;e<this.peakKeys.length;e++){var f=this.colorPeak[this.peakKeys[e]];d.push({text:"<span style='color:"+f+"; font-weight:bold;'>Peak #"+e+" "+this.peakKeys[e].replace("- "," to #").replace(".0","").replace(".0","")+"</span>",peakid:this.peakKeys[e],checked:!1,checkHandler:function(b,c){var d=new Object;d.param=b.peakid,a(d,c)}})}var g=Ext.create("Ext.menu.Menu",{id:"mainMenu",style:{overflow:"visible"},items:d}),h=Ext.create("Ext.toolbar.Toolbar");h.add({text:"Peaks Avg.",menu:g}),c.push(h)}for(var e=0;e<this.hplcData.length;e++)if(0!=this.hplcData[e].showOnMenu){var i=this.hplcData[e].param,j="style='padding:0 0px 0 5px;'";c.push({text:"<table><tr><td>"+BUI.getRectangleColorDIV(this.hplcData[e].color,10,10)+"</td><td "+j+"> "+this.hplcData[e].label+"</td></tr></table>",id:b.id+i,param:i,enableToggle:!0,scope:this,margin:5,toggleHandler:a,pressed:null!=b.plots[i]})}return c.push("->"),c.push({text:"Save",scope:this,icon:"images/icon/ic_get_app_black_24dp.png",handler:function(a,b){var c=document.createElement("img");c.style.display="block",c.style.width="200px",c.style.height="200px",c.setAttribute("src",Dygraph.Export.asCanvas(this.dygraphObject.dygraph).toDataURL()),window.open(Dygraph.Export.asCanvas(this.dygraphObject.dygraph).toDataURL(),"Image","")}}),c},MergesHPLCGraph.prototype.input=function(){return DATADOC.getScatteringHPLCFrameData()},MergesHPLCGraph.prototype.test=function(a){var b=new MergesHPLCGraph({title:"Scattering",width:this.plotWidth,height:500,showRangeSelector:!1,xParam:0,xlabel:"scattering_I",plots:{scattering_I:!0,subtracted_I:!0,buffer_I:!0}});b.getPanel().render(a),b.loadData(b.input())},MacromoleculeForm.prototype._getFieldTextWithHelp=function(a,b,c,d){return Ext.create("Ext.container.Container",{items:[{xtype:a,fieldLabel:b,name:c,id:this.id+c},{xtype:"label",forId:"myFieldId",text:d,margin:"5 0 0 105",cls:"inline-help"}]})},MacromoleculeForm.prototype._getNumericWithHelp=function(a,b,c,d){return Ext.create("Ext.container.Container",{margin:"0 0 0 10",items:[{xtype:a,fieldLabel:b,name:c,id:this.id+c,decimalPrecision:6,width:220},{xtype:"label",forId:"myFieldId",text:d,margin:"5 0 0 10",cls:"inline-help"}]})},MacromoleculeForm.prototype._getButtons=function(){var a=this;return[{text:"Save",handler:function(){a._save()}}]},MacromoleculeForm.prototype._persist=function(a,b,c,d,e,f,g,h){var i=Ext.getCmp("proposalIdCombo").getValue();if(null==i)return void BUI.showError("Please select a proposal");if(null==a&&null!=EXI.proposalManager.getMacromoleculeByAcronym(b))return void BUI.showError("Duplicated acronym");null==a?(this.macromolecule={},this.macromolecule.macromoleculeId=null):this.macromolecule.macromoleculeId=a,this.macromolecule.acronym=b,this.macromolecule.name=c,this.macromolecule.molecularMass=d,this.macromolecule.extintionCoefficient=e,this.macromolecule.comments=f,this.macromolecule.symmetry=Ext.getCmp(this.id+"comboSym").getValue(),this.macromolecule.refractiveIndex=g,this.macromolecule.solventViscosity=h,this.macromolecule.proposalId=i;var j=this,k=function(a,b){var c=function(a,b){j.panel.setLoading(!1),j.onSave.notify(),j.onClose.notify()};j.panel.setLoading("Updading proposal information"),EXI.getDataAdapter({onSuccess:c}).proposal.proposal.update()};this.panel.setLoading("Saving Macromolecule"),EXI.getDataAdapter({onSuccess:k}).saxs.macromolecule.saveMacromolecule(this.macromolecule)},MacromoleculeForm.prototype._save=function(){var a=this._getField("acronym"),b=this._getField("name"),c=this._getField("molecularMass"),d=this._getField("extintionCoefficient"),e=this._getField("comments"),f=this._getField("refractiveIndex"),g=this._getField("solventViscosity");return""==b?void BUI.showError("Name field is mandatory"):""==a?void BUI.showError("Acroynm field is mandatory"):void(null!=this.macromolecule?null==this.macromolecule.macromoleculeId?this._persist(null,a,b,c,d,e,f,g):this._persist(this.macromolecule.macromoleculeId,a,b,c,d,e,f,g):this._persist(null,a,b,c,d,e,f,g))},MacromoleculeForm.prototype._getItems=function(){var a=Ext.create("Ext.data.Store",{fields:["s"],data:this._getSymmetries()});return this.symmetryComboBox=Ext.create("Ext.form.ComboBox",{
fieldLabel:"Symmetry",store:a,id:this.id+"comboSym",queryMode:"local",displayField:"s",valueField:"s",value:"P1",margin:"0 0 0 30",width:220}),[BIOSAXS_COMBOMANAGER.getComboProposal({labelWidth:100}),this._getFieldTextWithHelp("requiredtextfield","Name","name","Long name. i.e: Bovine serum albumin"),this._getFieldTextWithHelp("requiredtextfield","Acronym","acronym","Acronym will be used in the files and analisys. i.e: BSA"),this._getFieldTextWithHelp("textfield","Mol. Mass (Da)","molecularMass","Atomic mass estimation measured in Da"),{xtype:"container",layout:"hbox",margin:"10 0 0 0",items:[this._getNumericWithHelp("numberfield","Extinction coef.","extintionCoefficient",""),this.symmetryComboBox]},{xtype:"container",layout:"hbox",margin:"5 0 0 0",items:[this._getNumericWithHelp("numberfield","Refractive Index","refractiveIndex","How radiation propagates through the medium"),this._getNumericWithHelp("numberfield","Solvent Viscosity","solventViscosity","")]},{id:this.id+"comments",xtype:"textareafield",name:"comments",margin:"35 0 0 10",fieldLabel:"Comments",width:this.width-100,height:100}]},MacromoleculeForm.prototype._getSymmetries=function(){return[{s:"P1"},{s:"P2"},{s:"P3"},{s:"P4"},{s:"P5"},{s:"P6"},{s:"P32"},{s:"P42"},{s:"P52"},{s:"P62"},{s:"P222"}]},MacromoleculeForm.prototype.getPanel=function(){return this.panel=Ext.create("Ext.panel.Panel",{layout:"hbox",buttons:this._getButtons(),cls:"border-grid",items:[{xtype:"container",margin:"20 0 0 20",layout:"vbox",items:this._getItems()}]}),this.panel},MacromoleculeForm.prototype._populateField=function(a,b){null!=b&&Ext.getCmp(this.id+a).setValue(b)},MacromoleculeForm.prototype._getField=function(a){return Ext.getCmp(this.id+a).getValue()},MacromoleculeForm.prototype.load=function(a){this.macromolecule=a,null!=a&&(this._populateField("name",a.name),this._populateField("acronym",a.acronym),this._populateField("extintionCoefficient",a.extintionCoefficient),this._populateField("molecularMass",a.molecularMass),this._populateField("comments",a.comments),this._populateField("refractiveIndex",a.refractiveIndex),this._populateField("solventViscosity",a.solventViscosity),null!=a.symmetry&&Ext.getCmp(this.id+"comboSym").setValue(a.symmetry),null!=this.macromolecule.proposalId&&(Ext.getCmp("proposalIdCombo").setValue(this.macromolecule.proposalId),Ext.getCmp("proposalIdCombo").disable()))},MacromoleculeForm.prototype.input=function(){return{}},MacromoleculeForm.prototype.test=function(a){var b=new MacromoleculeForm;b.onClose.attach(function(a){alert("Click on close")});var c=b.getPanel();c.render(a)},MacromoleculeGrid.prototype.edit=function(a){var b=this,c=new MacromoleculeWindow;c.onSave.attach(function(a){b.store.loadData(EXI.proposalManager.getMacromolecules())}),c.draw(a)},MacromoleculeGrid.prototype.getTbar=function(){var a=this,b=[];return b.push(Ext.create("Ext.Action",{icon:"images/icon/add.png",text:"Add",disabled:!1,handler:function(b,c){a.edit()}})),b.push("->"),b.push(Ext.create("Ext.Action",{icon:"images/icon/refresh.png",text:"Update From SMIS",tooltip:"Retrieve all the macromolecules of your proposal from SMIS database",disabled:!1,handler:function(b,c){a.grid.setLoading("Connecting to SMIS");var d=new BiosaxsDataAdapter;d.onSuccess.attach(function(b,c){BIOSAXS.proposal.setMacromolecules(c.macromolecules),a.refresh(BIOSAXS.proposal.macromolecules),a.grid.setLoading(!1)}),d.onError.attach(function(b,c){a.grid.setLoading(!1)}),d.updateDataBaseFromSMIS()}})),b},MacromoleculeGrid.prototype.deselectAll=function(){this.grid.getSelectionModel().deselectAll()},MacromoleculeGrid.prototype.selectById=function(a){this.grid.getSelectionModel().deselectAll();for(var b=0;b<this.grid.getStore().data.items.length;b++){var c=this.grid.getStore().data.items[b].raw;c.macromoleculeId==a&&this.grid.getSelectionModel().select(b)}},MacromoleculeGrid.prototype.load=function(a){this.store.loadData(a,!1)},MacromoleculeGrid.prototype.getColumns=function(){var a=this,b=[{text:"Acronym",dataIndex:"acronym",id:this.id+"acronym",flex:1,renderer:function(b,c,d,e,f,g){return null!=a.cssFontStyle?"<span style='"+a.cssFontStyle+"'>"+b+"</span>":b}},{text:"Name",dataIndex:"name",id:this.id+"name",flex:1,hidden:!1},{text:"Comments",dataIndex:"comments",id:this.id+"comments",flex:1,hidden:!1}];return this.btnEditVisible&&b.push({xtype:"actioncolumn",width:40,text:"Edit",items:[{icon:"images/icon/edit.png",tooltip:"Edit",handler:function(b,c,d){var e=b.getStore().getAt(c);a.edit(EXI.proposalManager.getMacromoleculeById(e.get("macromoleculeId")))}}]}),this.btnRemoveVisible&&b.push({id:a.id+"buttonRemoveMacromolecule",width:85,sortable:!1,renderer:function(b,c,d,e,f,g){return a.btnRemoveVisible?BUI.getRedButton("REMOVE"):null}}),b},MacromoleculeGrid.prototype._prepareData=function(a){return a},MacromoleculeGrid.prototype.getPanel=function(a){var b=this;this.store=Ext.create("Ext.data.Store",{fields:["macromoleculeId","name","acronym","comments"],data:b._prepareData(a)}),this.store.sort("acronym");var c="Ext.grid.Panel";1==this.searchBar&&(c="Ext.ux.LiveSearchGridPanel");var d=null;return this.multiselect&&(d=Ext.create("Ext.selection.CheckboxModel",{multiSelect:this.multiselect,listeners:{selectionchange:function(a,c){for(var d=[],e=0;e<c.length;e++)d.push(c[e].raw);b.onSelected.notify(d)}}})),this.grid=Ext.create(c,{id:this.id,title:"Macromolecules",collapsible:this.collapsible,collapsed:this.collapsed,store:this.store,height:this.height,maxHeight:this.maxHeight,selModel:d,allowDeselect:!0,columns:this.getColumns(),width:this.width,viewConfig:{stripeRows:!0,listeners:{celldblclick:function(a,c,d,e,f,g,h,i){b.edit(EXI.proposalManager.getMacromoleculeById(e.data.macromoleculeId))},cellclick:function(a,c,d,e,f,g,h,i){a.getGridColumns()[d].getId()==b.id+"buttonEditMacromolecule"&&b.edit(EXI.proposalManager.getMacromoleculeById(e.data.macromoleculeId)),a.getGridColumns()[d].getId()==b.id+"buttonRemoveMacromolecule"&&BUI.showBetaWarning()}}}}),this.tbar&&this.grid.addDocked({xtype:"toolbar",height:50,items:this.getTbar()}),this.grid},MacromoleculeGrid.prototype.input=function(){return{proposal:DATADOC.getProposal_10()}},MacromoleculeGrid.prototype.test=function(a){var b=new MacromoleculeGrid({width:800,height:350,collapsed:!1,tbar:!0});BIOSAXS.proposal=new Proposal(b.input().proposal);var c=b.getPanel(BIOSAXS.proposal.macromolecules);c.render(a)},MeasurementCreatorStepWizardForm.prototype.setData=function(a){this.data.measurementsSelected=a;for(var b={},c={},d=0;d<this.data.measurementsSelected.length;d++){var e=this.data.measurementsSelected[d];null==b[e.bufferId]&&(b[e.bufferId]={buffer:e.buffer_acronym,bufferId:e.bufferId,volume:0,concentration:0});var f=e.macromoleculeId+"_"+e.bufferId+"_"+e.concentration;null==c[f]&&(c[f]={macromolecule:e.acronym,macromoleculeId:e.macromoleculeId,buffer:e.buffer_acronym,bufferId:e.bufferId,volume:0,concentration:e.concentration}),b[e.bufferId].volume=Number(b[e.bufferId].volume)+2*e.volumeToLoad,c[f].volume=Number(c[f].volume)+e.volumeToLoad}},MeasurementCreatorStepWizardForm.prototype.getSingleMeasurementForm=function(){var a=BIOSAXS_COMBOMANAGER.getComboMacromoleculeByMacromolecules(this.macromolecules,{width:250,labelWidth:100}),b=BIOSAXS_COMBOMANAGER.getComboBuffers(this.buffers,{margin:"0 0 0 50",width:250,labelWidth:100}),c=Ext.create("Ext.Button",{width:200,height:25,margin:"0 0 20 300",text:"Add",scope:this,handler:function(){for(var c=Ext.getCmp(this.id+"quantity").getValue(),d=[],e=0;c>e;e++)d.push({acronym:EXI.proposalManager.getMacromoleculeById(a.getValue()).acronym,macromoleculeId:a.getValue(),bufferId:b.getValue(),buffer_acronym:EXI.proposalManager.getBufferById(b.getValue()).acronym,concentration:Ext.getCmp(this.id+"conc").getValue(),volumeToLoad:Ext.getCmp(this.id+"volume").getValue(),exposureTemperature:Ext.getCmp(this.id+"seu").getValue(),transmission:Ext.getCmp(this.id+"transmission").getValue(),waitTime:Ext.getCmp(this.id+"waitTime").getValue(),viscosity:Ext.getCmp(this.id+"viscosity").getValue(),flow:Ext.getCmp(this.id+"flow").getValue()});this.measurementGrid.store.loadData(d,!0),this.setData(JSON.parse(Ext.encode(Ext.pluck(this.measurementGrid.grid.getStore().data.items,"data"))))}});return Ext.create("Ext.panel.Panel",{padding:"0 0 0 0",margin:"0 10 0 0",height:240,width:1150,cls:"border-grid",items:[{xtype:"container",layout:"hbox",margin:"10 10 0 10",items:[a,b,{xtype:"numberfield",id:this.id+"quantity",fieldLabel:"Repeat",labelWidth:100,width:220,margin:"5 0 0 120",minValue:0,maxValue:300,value:1}]},{xtype:"container",layout:"hbox",margin:"10 10 0 10",items:[{xtype:"numberfield",id:this.id+"conc",fieldLabel:"Conc. (mg/ml)",labelWidth:100,width:220,margin:"5 0 0 0",minValue:0,maxValue:300,value:1},{xtype:"numberfield",id:this.id+"seu",fieldLabel:"Exposure. Temp.",labelWidth:100,width:220,margin:"5 0 0 80",value:4,minValue:4,maxValue:60}]},{xtype:"container",margin:"10 10 0 10",layout:"hbox",items:[{xtype:"numberfield",id:this.id+"volume",fieldLabel:"Vol. To Load (&#181l)",labelWidth:100,width:220,value:40,margin:"5 0 0 0",minValue:10,maxValue:300},{xtype:"numberfield",id:this.id+"transmission",fieldLabel:"Transmission (%)",labelWidth:100,width:220,margin:"5 0 0 80",value:100,minValue:0,maxValue:100}]},{xtype:"container",layout:"hbox",margin:"10 10 0 10",items:[{xtype:"numberfield",id:this.id+"waitTime",fieldLabel:"Wait Time",labelWidth:100,width:220,value:0,minValue:0,maxValue:100},{xtype:"combo",id:this.id+"viscosity",store:["low","medium","high"],fieldLabel:"SC Viscosity",value:"low",labelWidth:100,width:220,margin:"0 0 0 80"},{xtype:"checkbox",id:this.id+"flow",checked:!0,fieldLabel:"Flow",labelWidth:100,width:250,margin:"0 0 0 80"}]},{xtype:"container",layout:"hbox",margin:"10 0 0 0",items:[c]}]})},MeasurementCreatorStepWizardForm.prototype.getConcentrationMeasurementForm=function(){var a=BIOSAXS_COMBOMANAGER.getComboMacromoleculeByMacromolecules(this.macromolecules,{width:300,labelWidth:100}),b=BIOSAXS_COMBOMANAGER.getComboBuffers(this.buffers,{width:300,labelWidth:100}),c=Ext.create("Ext.Button",{width:200,height:25,margin:"0 0 20 300",text:"Add",scope:this,handler:function(){for(var c=a.getValue(),d=b.getValue(),e=Ext.getCmp(this.id+"_cs_conc").getValue(),f=Ext.getCmp(this.id+"_cs_volume").getValue(),g=Ext.getCmp(this.id+"_cs_transmission").getValue(),h=Ext.getCmp(this.id+"_cs_seu").getValue(),i=Ext.getCmp(this.id+"_cs_waitTime").getValue(),j=Ext.getCmp(this.id+"_cs_viscosity").getValue(),k=Ext.getCmp(this.id+"_cs_flow").getValue(),l=[],m=1;e>=m;m++)l.push({acronym:EXI.proposalManager.getMacromoleculeById(c).acronym,macromoleculeId:c,bufferId:d,buffer_acronym:EXI.proposalManager.getBufferById(d).acronym,concentration:m,volumeToLoad:f,exposureTemperature:h,transmission:g,waitTime:i,viscosity:j,flow:k});this.measurementGrid.store.loadData(l,!0),this.setData(JSON.parse(Ext.encode(Ext.pluck(this.measurementGrid.store.data.items,"data"))))}});return Ext.create("Ext.panel.Panel",{margin:"0 10 0 0",height:200,width:1150,cls:"border-grid",items:[{xtype:"container",layout:"hbox",items:[{xtype:"numberfield",id:this.id+"_cs_conc",fieldLabel:"How many unknow concentrations do you have?",labelWidth:300,width:500,margin:"5 0 0 10",minValue:1,maxValue:20,value:1}]},{xtype:"container",margin:"10 0 0 10",layout:"hbox",items:[a,{xtype:"numberfield",id:this.id+"_cs_seu",fieldLabel:"Exposure. Temp.",labelWidth:100,width:220,margin:"5 0 0 20",value:4,minValue:4,maxValue:60},{xtype:"numberfield",margin:"5 0 0 50",id:this.id+"_cs_volume",fieldLabel:"Vol. To Load (&#181l)",labelWidth:100,width:220,value:40,minValue:10,maxValue:300},{xtype:"numberfield",id:this.id+"_cs_transmission",fieldLabel:"Transmission (%)",labelWidth:100,width:220,margin:"5 0 0 50",value:100,minValue:0,maxValue:100}]},{xtype:"container",layout:"hbox",margin:"5 0 0 10",items:[b,{xtype:"numberfield",id:this.id+"_cs_waitTime",fieldLabel:"Wait Time",labelWidth:100,width:220,value:0,minValue:0,maxValue:100,margin:"5 0 0 20"},{xtype:"combo",id:this.id+"_cs_viscosity",store:["low","medium","high"],fieldLabel:"SC Viscosity",value:"low",margin:"5 0 0 50",labelWidth:100,width:220},{xtype:"checkbox",id:this.id+"_cs_flow",fieldLabel:"Flow",checked:!0,labelWidth:100,width:250,margin:"0 0 0 80"}]},{xtype:"container",layout:"hbox",margin:"20 0 0 0",items:[c]}]})},MeasurementCreatorStepWizardForm.prototype.getHeaderForm=function(){return this.panel=Ext.create("Ext.panel.Panel",{layout:"hbox",height:100,items:[{xtype:"textfield",name:"Name",id:this.id+"name",width:400,labelWidth:50,fieldLabel:"Name",margin:"20 20 20 20",value:""},{id:this.id+"comments",xtype:"textareafield",name:"comments",fieldLabel:"Comments",height:75,labelWidth:100,margin:"20 20 20 50",width:600}]}),this.panel},MeasurementCreatorStepWizardForm.prototype.getForm=function(){var a=this;return this.formPanel=Ext.create("Ext.tab.Panel",{padding:"0 0 0 0",plain:!0,margin:"20 5 20 10",height:290,items:[{tabConfig:{title:"Concentration Series"},items:this.getConcentrationMeasurementForm()},{tabConfig:{title:"Individual Measurement"},items:[this.getSingleMeasurementForm()]}]}),this.measurementGrid=new MeasurementGrid({height:250,maxHeight:250,minHeight:250,width:1150,tbar:!1,maxWidth:870,resizable:!1,margin:"0 10 10 10",isStatusColumnHidden:!0,isTimeColumnHidden:!0,removeBtnEnabled:!0,isPriorityColumnHidden:!0}),this.measurementGrid.onRemoved.attach(function(b,c){a.setData(JSON.parse(Ext.encode(Ext.pluck(a.measurementGrid.grid.getStore().data.items,"data"))))}),this.panel=Ext.create("Ext.panel.Panel",{plain:!0,frame:!1,border:0,items:[this.getHeaderForm(),this.formPanel,this.addButton,this.measurementGrid.getPanel([])]}),null!=this.data.measurementsSelected&&(this.measurementGrid.grid.getStore().loadData(this.data.measurementsSelected,!1),this.setData(JSON.parse(Ext.encode(Ext.pluck(this.measurementGrid.grid.getStore().data.items,"data"))))),this.panel},MeasurementCreatorStepWizardForm.prototype.getBuffers=function(a){for(var b={},c=null,d=0;d<a.length;d++)c=a[d],null==b[c.bufferId]&&(b[c.bufferId]={buffer:c.buffer_acronym,bufferId:c.bufferId,volumeToLoad:c.volumeToLoad,volume:0,concentration:0,transmission:c.transmission,flow:c.flow,viscosity:c.viscosity}),b[c.bufferId].volume=Number(b[c.bufferId].volume)+2*c.volumeToLoad;var e=[];for(var f in b)b.hasOwnProperty(f)&&(c=b[f],e.push({bufferId:c.bufferId,buffer:EXI.proposalManager.getBufferById(c.bufferId).acronym,concentration:c.concentration,volume:c.volume,volumeToLoad:c.volumeToLoad,transmission:c.transmission,flow:c.flow,viscosity:c.viscosity}));return e},MeasurementCreatorStepWizardForm.prototype.parseMeasurements=function(a){var b=[],c=null,d=null,e=this.getBuffers(a);for(d=0;d<e.length;d++)c=e[d],b.push({SEUtemperature:"",buffer:c.buffer,buffername:c.buffer,code:c.buffer,comments:"",concentration:0,enable:!0,flow:c.flow,recuperate:!1,title:"",transmission:c.transmission,macromolecule:c.buffer,type:"Buffer",typen:1,viscosity:c.viscosity,volume:c.volume,volumeToLoad:c.volumeToLoad,waittime:0,plate:null,row:null,well:null});for(d=0;d<a.length;d++){c=a[d];var f="Buffer",g="";null!=c.macromoleculeId&&(f="Sample",g=EXI.proposalManager.getMacromoleculeById(c.macromoleculeId).acronym),b.push({SEUtemperature:c.exposureTemperature,buffer:c.buffer_acronym,buffername:c.buffer_acronym,code:g,comments:"",concentration:c.concentration,enable:!0,flow:c.flow,recuperate:!1,title:"",transmission:c.transmission,macromolecule:g,type:f,typen:1,viscosity:c.viscosity,volume:c.volumeToLoad,volumeToLoad:c.volumeToLoad,waittime:c.waitTime,plate:null,row:null,well:null})}var h=new SampleAutomaticPositionFactory(b);return h.setPosition()},MeasurementCreatorStepWizardForm.prototype.getNextForm=function(){return new FinalStepWizardForm(JSON.stringify(this.parseMeasurements(this.data.measurementsSelected)))},SampleAutomaticPositionFactory.prototype.getAvailablePlates=function(){for(var a=EXI.proposalManager.getPlateByFlavour(),b=[],c=[],d=0;d<a.length;d++)if(2==a[d].plateTypeId){for(var e=0;12>e;e++)b.push({plate:2,row:Math.floor(e/3)+1,well:Number(Number(e%3)+9)});for(var f=0,e=0;32>e;e++){var g={plate:2,row:Math.floor(e/8)+1,well:Number(e%8)+1-f};c.push(g)}}for(var d=0;d<a.length;d++)if(2!=a[d].plateTypeId){for(var h=0;h<a[d].rowCount;h++)for(var i=0;i<a[d].columnCount;i++)b.push({plate:d+1,row:h+1,well:i+1});for(var h=0;h<a[d].rowCount;h++)for(var i=0;i<a[d].columnCount;i++)c.push({plate:d+1,row:h+1,well:i+1})}return{buffer:b.reverse(),sample:c.reverse()}},SampleAutomaticPositionFactory.prototype._getKey=function(a,b,c){return a+":"+b+"-"+c},SampleAutomaticPositionFactory.prototype.setPosition=function(){for(var a=this.getAvailablePlates(),b={},c=0;c<this.samples.length;c++)if("Buffer"==this.samples[c].type){var d=this._getKey(this.samples[c].plate,this.samples[c].row,this.samples[c].well);this.samples[c].plate=a.buffer[a.buffer.length-1].plate,this.samples[c].row=a.buffer[a.buffer.length-1].row,this.samples[c].well=a.buffer[a.buffer.length-1].well,b[d]=!0,a.buffer.pop()}for(var e={},c=0;c<this.samples.length;c++)if("Sample"==this.samples[c].type){for(var d=this._getKey(a.sample[a.sample.length-1].plate,a.sample[a.sample.length-1].row,a.sample[a.sample.length-1].well);null!=b[d];)a.sample.pop(),d=this._getKey(a.sample[a.sample.length-1].plate,a.sample[a.sample.length-1].row,a.sample[a.sample.length-1].well);var f=this.samples[c].macromolecule+"_"+this.samples[c].buffer+"_"+this.samples[c].concentration;if(null!=e[f]){this.samples[c].plate=e[f].plate,this.samples[c].row=e[f].row,this.samples[c].well=e[f].well;continue}e[f]={plate:a.sample[a.sample.length-1].plate,row:a.sample[a.sample.length-1].row,well:a.sample[a.sample.length-1].well},this.samples[c].plate=a.sample[a.sample.length-1].plate,this.samples[c].row=a.sample[a.sample.length-1].row,this.samples[c].well=a.sample[a.sample.length-1].well,b[d]=!0,a.sample.pop()}return this.samples},MeasurementGrid.prototype.edit=function(a){var b=new MacromoleculeWindow;b.onSave.attach(function(a){}),b.draw(a)},MeasurementGrid.prototype.deselectAll=function(){this.grid.getSelectionModel().deselectAll()},MeasurementGrid.prototype.selectById=function(a){this.grid.getSelectionModel().deselectAll();for(var b=0;b<this.grid.getStore().data.items.length;b++){var c=this.grid.getStore().data.items[b].raw;c.macromoleculeId==a&&this.grid.getSelectionModel().select(b)}},MeasurementGrid.prototype.load=function(a){this.store.loadData(a,!1)},MeasurementGrid.prototype.loadExperiment=function(a){this.experimentList=new ExperimentList([a]);var b=this._prepareData(this.experimentList.getMeasurements(),this.experimentList);this.load(b)},MeasurementGrid.prototype._prepareData=function(a,b){for(var c=[],d=0;d<a.length;d++){var e=a[d],f=b.getSampleById(e.specimenId),g=EXI.proposalManager.getBufferById(f.bufferId);if(e.buffer_acronym=g.acronym,e.bufferId=g.bufferId,e.volume=f.volume,null!=f.macromolecule3VO&&(e.acronym=f.macromolecule3VO.acronym,e.macromoleculeId=f.macromolecule3VO.macromoleculeId),e.concentration=f.concentration,null!=e.run3VO){e.energy=e.run3VO.energy,e.expExposureTemperature=e.run3VO.exposureTemperature,e.storageTemperature=e.run3VO.storageTemperature,e.timePerFrame=e.run3VO.timePerFrame,e.radiationAbsolute=e.run3VO.radiationAbsolute,e.radiationRelative=e.run3VO.radiationRelative,e.status="DONE";try{null!=e.run3VO.timeStart&&""!=e.run3VO.timeStart&&(e.miliseconds=moment(e.run3VO.timeStart).format("X"))}catch(h){console.log(h)}}if(b.getDataCollectionByMeasurementId(e.measurementId).length>0)for(var i=b.getDataCollectionByMeasurementId(e.measurementId)[0].measurementtodatacollection3VOs,j=0;j<i.length;j++)if(1==i[j].dataCollectionOrder){var k=b.getSampleById(b.getMeasurementById(i[j].measurementId).specimenId);null!=k.sampleplateposition3VO&&(e.bufferSampleplateposition3VO=k.sampleplateposition3VO,e.bufferSampleplate=b.getSamplePlateById(k.sampleplateposition3VO.samplePlateId))}this.collapsed?null!=f.macromolecule3VO&&c.push(e):c.push(e)}return c},MeasurementGrid.prototype._getEditor=function(a){return null!=this.editor&&null!=this.editor[a]?this.editor[a]:null},MeasurementGrid.prototype.getColumns=function(){var a=this,b=[{text:"Order",dataIndex:"priority",flex:.3,hidden:a.isPriorityColumnHidden,sortable:!0,hidden:!0},{text:"Run Number",dataIndex:"code",flex:.5,hidden:!0,sortable:!0},{text:"Specimen",columns:[{text:"",dataIndex:"macromoleculeId",flex:1,hidden:!0,sortable:!0},{text:"Macromolecule",dataIndex:"acronym",flex:1,sortable:!0},{text:"Conc. ",dataIndex:"concentration",flex:1,sortable:!0},{text:"",dataIndex:"bufferId",flex:1,hidden:!0,sortable:!0},{text:"Buffer",dataIndex:"buffer_acronym",flex:1,renderer:function(a,b,c){return null!=c.data.bufferSampleplateposition3VO?EXI.proposalManager.getBufferById(c.data.bufferId).acronym+"<span style='font-style:oblique;'> Plate: ["+c.data.bufferSampleplate.slotPositionColumn+", "+BUI.getSamplePlateLetters()[c.data.bufferSampleplateposition3VO.rowNumber-1]+"-"+c.data.bufferSampleplateposition3VO.columnNumber+"]</span>":a},sortable:!0},{text:"Position",flex:1,hidden:!0}]},{text:"Parameters",columns:[{text:"Ex. Flow. time (s)",dataIndex:"extraFlowTime",flex:1,hidden:!0},{text:"Exp. Temp.",dataIndex:"exposureTemperature",flex:1,sortable:!0,editor:this._getEditor("exposureTemperature")},{text:"Vol. Load",dataIndex:"volumeToLoad",flex:.5,hidden:!1,editor:this._getEditor("volumeToLoad")},{text:"Volume in Well",dataIndex:"volume",hidden:!0,editor:this._getEditor("volume"),flex:1},{text:"Trans.",dataIndex:"transmission",flex:1,editor:this._getEditor("transmission")},{text:"Wait T.",dataIndex:"waitTime",editor:this._getEditor("waitTime"),flex:.5},{text:"Flow",dataIndex:"flow",editor:this._getEditor("flow"),flex:.3},{text:"Viscosity",dataIndex:"viscosity",tooltip:'The viscosity of a fluid is a measure of its resistance to gradual deformation by shear stress or tensile stress. For liquids, it corresponds to the informal notion of "thickness"',editor:this._getEditor("viscosity"),flex:.5}]},{text:"Status",dataIndex:"status",flex:1,hidden:a.isStatusColumnHidden,renderer:function(a,b,c){return null!=a?"<span style='font-weight: bold;'>"+a+"</span>":void 0}},{text:"Time",dataIndex:"time",flex:1,hidden:a.isTimeColumnHidden},{text:"Energy",dataIndex:"energy",flex:1,hidden:!0},{text:"Real Exp. Temp.(C)",flex:1,dataIndex:"expExposureTemperature",hidden:!0},{text:"Storage Temp.(C)",flex:1,dataIndex:"storageTemperature",hidden:!0},{text:"Time/Frame (s)",flex:1,dataIndex:"timePerFrame",hidden:!0},{text:"Radiation Relative",dataIndex:"radiationRelative",flex:1,hidden:!0},{text:"Radiation Absolute",dataIndex:"radiationAbsolute",flex:1,hidden:!0},{text:"Comments",dataIndex:"comments",flex:1,hidden:!0,editor:this._getEditor("comments")},{id:a.id+"buttonRemoveSample",text:"",hidden:!a.removeBtnEnabled,flex:1,renderer:function(b,c,d,e,f,g){return null!=d.data.macromoleculeId&&a.removeBtnEnabled?BUI.getRedButton("REMOVE"):void 0}}];return b},MeasurementGrid.prototype._getPlugins=function(){var a=this,b=[];return this.updateRowEnabled&&b.push(Ext.create("Ext.grid.plugin.RowEditing",{clicksToEdit:1,listeners:{validateedit:function(b,c){for(var d in a.editor)c.record.data[d]=c.newValues[d];c.record.data.comments=c.newValues.comments;var e=function(b,c){a.onMeasurementChanged.notify(c),a.grid.setLoading(!1)};a.grid.setLoading(),EXI.getDataAdapter({onSuccess:e}).saxs.measurement.saveMeasurement(c.record.data)}}})),b},MeasurementGrid.prototype.getPanel=function(){var a=this;this.store=Ext.create("Ext.data.Store",{fields:["macromoleculeId","name","acronym","comments"],data:[],sorters:this.sorter}),this.multiselect&&(this.selModel=Ext.create("Ext.selection.CheckboxModel",{multiSelect:this.multiselect,listeners:{selectionchange:function(b,c){for(var d=[],e=0;e<c.length;e++)d.push(c[e].raw);a.onSelected.notify(d)}}}));var b=(Ext.create("Ext.grid.plugin.RowEditing",{clicksToEdit:1,autoCancel:!0}),{});try{b=Ext.create("Ext.ux.StatusBar",{id:a.id+"basic-statusbar",defaultText:"Ready",text:"Ready",iconCls:"x-status-valid",items:[]})}catch(c){console.log("bbar error")}return this.grid=Ext.create("Ext.grid.Panel",{id:this.id,title:this.title,plugins:this._getPlugins(),margin:this.margin,store:this.store,height:this.height,maxHeight:this.maxHeight,columns:this.getColumns(),bbar:b,tbar:this._getMenu(),cls:"border-grid",viewConfig:{stripeRows:!0,getRowClass:function(a,b,c,d){return"DONE"==a.data.status?"green-row":void 0},listeners:{celldblclick:function(a,b,c,d,e,f,g,h){},cellclick:function(b,c,d,e,f,g,h,i){if(-1!=c.innerHTML.indexOf("REMOVE")&&(b.getStore().removeAt(g),null!=e.data.measurementId)){b.setLoading("ISPyB: Removing measurement");var j=function(c,d){b.setLoading(!1);var e=function(b,c){a.onRemoved.notify(c),a._showStatusBarReady("Ready")};EXI.getDataAdapter({onSuccess:e}).saxs.experiment.getExperimentById(a.experimentList.experiments[0].experimentId,"MEDIUM"),a._showStatusBarBusy("ISPyB: Removing Unused Specimens")};EXI.getDataAdapter({onSuccess:j}).saxs.measurement.removeMeasurement(e.data)}}}}}),this.grid},MeasurementGrid.prototype._showStatusBarReady=function(a){var b=Ext.getCmp(this.id+"basic-statusbar");b.setStatus({text:a,iconCls:"x-status-valid",clear:!1})},MeasurementGrid.prototype._showStatusBarBusy=function(a){var b=Ext.getCmp(this.id+"basic-statusbar");b.setStatus({text:a,iconCls:"x-status-busy",clear:!1})},MeasurementGrid.prototype._openAddMeasurementWindow=function(a,b){var c=this,d=new WizardWidget({windowMode:!0,width:1200});d.onFinished.attach(function(a,b){c.grid.setLoading(),d.window.close();var e=function(a,b){c.onExperimentChanged.notify(b),c.grid.setLoading(!1)};d.current.setLoading("ISPyB: Adding measurements"),EXI.getDataAdapter({onSuccess:e}).saxs.template.saveTemplate(b.name,b.comments,b.data,c.experimentList.experiments[0].experimentId)}),d.draw(null,new MeasurementCreatorStepWizardForm(EXI.proposalManager.getMacromolecules(),EXI.proposalManager.getBuffers(),{noNext:!0}))},MeasurementGrid.prototype._getMenu=function(){var a=this;if(this.tbar){var b=[];if(a.addBtnEnable&&b.push({icon:"../images/icon/add.png",text:"Add",handler:function(){a._openAddMeasurementWindow()}}),a.sortingBtnEnable){var c=Ext.create("Ext.button.Split",{text:"Sort by",icon:"../images/icon/sort.png",handler:function(){},menu:new Ext.menu.Menu({items:[{text:"First Created First Measured",handler:function(){a._sortBy("FIFO")}},"-",{text:"Default",handler:function(){a._sortBy("DEFAULT")}}]})});b.push(c)}a.collapseBtnEnable&&b.push({text:"Collapse buffers",enableToggle:!0,scope:this,toggleHandler:function(a,b){this.collapsed=b,this.grid.getStore().loadData(this._prepareData(this.measurements,this.experiments),!1)},pressed:this.collapsed});var d=Ext.create("Ext.toolbar.Toolbar",{cls:"exi-top-bar",height:45,items:b});return d}return null},MeasurementGrid.prototype._sortBy=function(a){var b=this,c=(new DataAdapter,function(a,c){b.onExperimentChanged.notify(c),b.grid.setLoading(!1)});b.grid.setLoading("Sorting"),EXI.getDataAdapter({onSuccess:c}).saxs.measurement.sortMeasurements(this.experimentList.experiments[0].experimentId,a)},MolarityForm.prototype._getNumericWithHelp=function(a,b,c,d){return Ext.create("Ext.container.Container",{margin:"10 0 0 10",items:[{xtype:a,fieldLabel:b,name:c,id:this.id+c,decimalPrecision:6},{xtype:"label",forId:"myFieldId",text:d,margin:"5 0 0 105",cls:"inline-help"}]})},MolarityForm.prototype._getItems=function(){return this.macromoleculeCombo=BIOSAXS_COMBOMANAGER.getComboMacromoleculeByMacromolecules(this.getMacromuleculesCandidates(this.macromolecule),{width:250,labelWidth:100,margin:10}),[{xtype:"container",flex:1,margin:"10 0 0 10",border:0,layout:"anchor",defaultType:"requiredtext",items:[this.macromoleculeCombo,this._getNumericWithHelp("textfield","Ratio","ratio","Number in assymmetric units")]}]},MolarityForm.prototype._persist=function(){var a=this,b=this.macromoleculeCombo.getValue(),c=Ext.getCmp(this.id+"ratio").getValue(),d="Not used yet",e=new BiosaxsDataAdapter;this.panel.setLoading("Saving"),e.onSuccess.attach(function(b,c){a.onSave.notify()}),e.saveStoichiometry(this.macromolecule.macromoleculeId,b,c,d)},MolarityForm.prototype._getButtons=function(){function a(){b.onClose.notify()}var b=this;return[{text:"Save",handler:function(){b._persist()}},{text:"Cancel",handler:function(){a()}}]},MolarityForm.prototype.getPanel=function(){return this.panel=Ext.create("Ext.form.Panel",{height:this.height,margin:2,border:1,defaultType:"requiredtext",items:this._getItems(),buttons:this._getButtons()}),this.panel},MolarityForm.prototype.getMacromuleculesCandidates=function(a){var b=[];if(BIOSAXS.proposal.macromolecules)for(var c=0;c<BIOSAXS.proposal.macromolecules.length;c++){var d=BIOSAXS.proposal.macromolecules[c];null!=this.macromolecule&&d.macromoleculeId!=this.macromolecule.macromoleculeId&&b.push(d)}return b},MolarityForm.prototype.refresh=function(a){this.macromolecule=a},MolarityForm.prototype.input=function(){return{}},MolarityForm.prototype.test=function(a){var b=new MolarityForm,c=b.getPanel();c.render(a)},MolarityGrid.prototype._getColumns=function(){return[{text:"Subunit",columns:[{text:"Acronym",width:100,hidden:!1,dataIndex:"acronym",sortable:!0},{text:"Name",width:125,hidden:!1,dataIndex:"name",sortable:!0},{text:"MM Est.",width:100,dataIndex:"molecularMass",sortable:!0,renderer:function(a,b,c){return BUI.formatValuesUnits(c.data.molecularMass,"Da",10,2)}}]},{text:"Ratio",width:100,dataIndex:"ratio",tooltip:"Number of times the subunit is present in the macromolecule",sortable:!0},{id:this.id+"MOLARITY_REMOVE",flex:.1,sortable:!1,renderer:function(a,b,c,d,e,f){return BUI.getRedButton("REMOVE")}}]},MolarityGrid.prototype._openMolarityWindow=function(){this.molarityWindow=Ext.create("Ext.window.Window",{title:"Molarity",height:220,width:500,modal:!0,items:[this.molarityForm.getPanel()]}).show()},MolarityGrid.prototype._getButtons=function(){var a=this;return[{text:"Add subunit",icon:"../images/add.png",handler:function(){a._openMolarityWindow()}}]},MolarityGrid.prototype.updateProposal=function(){var a=this;this.panel.setLoading(),BIOSAXS.proposal.onInitialized.attach(function(){if(null!=BIOSAXS.proposal)for(var b=BIOSAXS.proposal.macromolecules,c=0;c<b.length;c++)b[c].macromoleculeId==a.macromolecule.macromoleculeId&&(a.refresh(b[c]),a.panel.setLoading(!1))}),BIOSAXS.proposal.init()},MolarityGrid.prototype.getPanel=function(){var a=this;return this.molarityStore=Ext.create("Ext.data.Store",{fields:["acronym","ratio","comments","stoichiometryId","name","molecularMass"],sorters:{property:"ratio",direction:"DESC"}}),this.panel=Ext.create("Ext.grid.Panel",{store:this.molarityStore,height:this.height,padding:5,columns:this._getColumns(),listeners:{cellclick:function(b,c,d,e,f,g,h,i){if(b.getGridColumns()[d].getId()==a.id+"MOLARITY_REMOVE"){var j=new BiosaxsDataAdapter;j.onSuccess.attach(function(b){a.updateProposal()}),j.removeStoichiometry(e.data.stoichiometryId),a.panel.setLoading("Removing Structure")}}},tbar:this._getButtons()}),this.panel},MolarityGrid.prototype._prepareData=function(a){var b=[];if(null!=a.stoichiometry)for(var c=0;c<a.stoichiometry.length;c++){var d=BIOSAXS.proposal.getMacromoleculeById(a.stoichiometry[c].macromoleculeId);b.push({ratio:a.stoichiometry[c].ratio,acronym:d.acronym,comments:d.comments,molecularMass:d.molecularMass,stoichiometryId:a.stoichiometry[c].stoichiometryId,name:d.name})}return b},MolarityGrid.prototype.refresh=function(a){null!=a&&(this.molarityStore.loadData(this._prepareData(a)),this.molarityForm.refresh(a),this.macromolecule=a)},MolarityGrid.prototype.input=function(){return{proposal:DATADOC.getProposal_10(),dewars:DATADOC.getDewars_10()}},MolarityGrid.prototype.test=function(a){var b=new b({height:150});BIOSAXS.proposal=new Proposal(b.input().proposal);var c=b.getPanel(b.input().dewars);c.render(a)},DataSet.prototype.loadFromJSON=function(a){null!=a&&this.validate(a)&&(this.json=a)},DataSet.prototype.toJSON=function(a){return this.json},DataSet.prototype.validate=function(a){
return!0};var DOM={};DOM.createNewElement=function(a,b,c){for(var d=document.createElement(a),e=0;e<c.length;e++)d.setAttribute(c[e][0],c[e][1]);return b.appendChild(d),d},DOM.createTextNode=function(a,b){var c=document.createTextNode(a);return b.appendChild(c),c},DOM.removeChilds=function(a){for(var b=document.getElementById(a);b.childNodes.length>0;)b.removeChild(b.childNodes[0])},DOM.select=function(a){return document.getElementById(a)},GraphCanvas.prototype.showLabels=function(a){this.args.labeled=a,this.removeLabels(),a&&this.renderLabels()},GraphCanvas.prototype.getSelectedVertices=function(){return this.args.selectedVertices},GraphCanvas.prototype.getSelectedEdges=function(){var a=[];for(var b in this.args.isEdgeSelected)a.push(b);return a},GraphCanvas.prototype.createSVGDom=function(a,b,c,d,e){var f=document.getElementById(a);return this._svg=SVG.createSVGCanvas(f,[["style","background-color:"+e+";"],["id",b],["dragx",0],["dragy",0],["height",this.getFormatter().getHeight()],["width",this.getFormatter().getWidth()]]),this._svg},GraphCanvas.prototype.isMultipleSelectionEnabled=function(){return this.args.multipleSelectionEnabled},GraphCanvas.prototype.setMultipleSelection=function(a){this.args.multipleSelectionEnabled=a,this.args.draggingCanvasEnabled=!a},GraphCanvas.prototype.setSelecting=function(a){this.selecting=a},GraphCanvas.prototype.setLinking=function(a){this.args.linkEnabled=a,this.selecting=!a,this.dragging=!a},GraphCanvas.prototype.setDraggingCanvas=function(a){this.args.draggingCanvasEnabled=a,this.args.multipleSelectionEnabled=!a},GraphCanvas.prototype.isDraggingCanvasEnabled=function(){return this.args.draggingCanvasEnabled},GraphCanvas.prototype.getScale=function(){return this.getFormatter().getZoomScale()},GraphCanvas.prototype.setScale=function(a){var b=document.getElementById(this.args.idGraph);b.setAttribute("transform",b.getAttribute("transform").replace("scale("+this.getScale()+")","scale("+a+")")),this.getFormatter().setZoomScale(a)},GraphCanvas.prototype.zoomIn=function(){this.setScale(this.getScale()+this.getFormatter().getZoomScaleStepFactor())},GraphCanvas.prototype.zoomOut=function(){this.setScale(this.getScale()-this.getFormatter().getZoomScaleStepFactor())},GraphCanvas.prototype.getSVGCoordenates=function(a){var b=this._svg.createSVGPoint();b.x=a.clientX,b.y=a.clientY;var c=this._svg.getScreenCTM(document.documentElement);return b=b.matrixTransform(c.inverse())},GraphCanvas.prototype.mouseClick=function(a){if(0==a.button){if(!this.args.interactive)return;this.isVertex(a.target)&&this.clickNode(this.getVertexIdFromSVGId(a.target.id)),this.dragging&&(this.dragging=!1)}},GraphCanvas.prototype.mouseMove=function(a){if(this.selecting){this.clearLabels();var b=this.getSVGCoordenates(a).x-this.selectorX,c=this.getSVGCoordenates(a).y-this.selectorY;b>0&&c>0&&this.displaySelection(this.selectorX,this.selectorY,b,c),b>0&&0>c&&this.displaySelection(this.selectorX,this.getSVGCoordenates(a).y,b,Math.abs(c)),0>b&&0>c&&this.displaySelection(this.getSVGCoordenates(a).x,this.getSVGCoordenates(a).y,Math.abs(b),Math.abs(c)),0>b&&c>0&&this.displaySelection(this.selectorX+b,this.selectorY,Math.abs(b),Math.abs(c));var d=(parseFloat(this.selectorSVGNode.getAttribute("x"))-DOM.select(this.id).getAttribute("dragx"))/this.getFormatter().getWidth(),e=(parseFloat(this.selectorSVGNode.getAttribute("y"))-DOM.select(this.id).getAttribute("dragy"))/this.getFormatter().getHeight(),f=d+parseFloat(this.selectorSVGNode.getAttribute("width")/this.getFormatter().getWidth()),g=e+parseFloat(this.selectorSVGNode.getAttribute("height")/this.getFormatter().getHeight());this.deselectNodes(this.getLayout());for(var h=this.getLayout().getVerticesByArea(d/this.getFormatter().getZoomScale(),e/this.getFormatter().getZoomScale(),f/this.getFormatter().getZoomScale(),g/this.getFormatter().getZoomScale()),i=0;i<h.length;i++)this.selectNode(h[i].getId()),this.renderLabel(h[i].getId())}var j=null;this.args.linking&&(j=this.getSVGCoordenates(a),null!=this.linkSVGNode&&(this.linkSVGNode.setAttribute("x2",j.x-2),this.linkSVGNode.setAttribute("y2",j.y-2))),this.dragging&&(j=this.getSVGCoordenates(a),j.x-=this.nMouseOffsetX,j.y-=this.nMouseOffsetY,this.desplazamientoX=this.getSVGCoordenates(a).x-this.dragStartX,this.desplazamientoY=this.getSVGCoordenates(a).y-this.dragStartY,null!=this.draggingElement&&(this.isNodeCanvas(this.draggingElement)?(j=this.getSVGCoordenates(a),j.x=this.desplazamientoX,j.y=this.desplazamientoY,this.draggingElement.setAttribute("dragx",j.x),this.draggingElement.setAttribute("dragy",j.y),this.draggingElement=document.getElementById(this.args.idGraph),this.draggingElement.setAttribute("transform","translate("+j.x+","+j.y+"), scale("+this.getScale()+")"),DOM.select(this.id).setAttribute("dragx",j.x),DOM.select(this.id).setAttribute("dragy",j.y),null!=this.NodeSVGbackgroundImage&&(this.NodeSVGbackgroundImage.setAttribute("dragx",j.x),this.NodeSVGbackgroundImage.setAttribute("dragy",j.y))):this.isVertex(this.draggingElement)?(this.selectNode(this.getVertexIdFromSVGId(this.draggingElement.id)),this.desplazamientoX=this.desplazamientoX/this.getFormatter().getZoomScale(),this.desplazamientoY=this.desplazamientoY/this.getFormatter().getZoomScale(),this.moveSelectedNodes(this.desplazamientoX,this.desplazamientoY),this.dragStartX=this.getSVGCoordenates(a).x,this.dragStartY=this.getSVGCoordenates(a).y):this.isNodeBackground(this.draggingElement)?(this.draggingElement.setAttribute("dragx",j.x),this.draggingElement.setAttribute("dragy",j.y),this.draggingElement=document.getElementById(this.args.idGraph),this.draggingElement.setAttribute("transform","translate("+j.x+","+j.y+"), scale("+this.getScale()+")")):this.draggingElement.setAttribute("transform","translate("+j.x+","+j.y+")")))},GraphCanvas.prototype.moveSelectedNodes=function(a,b){for(var c=0;c<this.getSelectedVertices().length;c++){var d=this.getSelectedVertices()[c],e=this.getSVGNodeId(d),f=parseFloat(DOM.select(e).getAttribute("dragx"))+parseFloat(a),g=parseFloat(DOM.select(e).getAttribute("dragy"))+parseFloat(b);this._movingNode(DOM.select(e),f,g)}},GraphCanvas.prototype.mouseDown=function(a){if(0==event.button){if(!this.args.interactive)return;var b=this.getSVGCoordenates(a);if((this.isNodeCanvas(a.target)||this.isNodeBackground(a.target))&&(this.deselectNodes(),this.deselectEdges(),this.onCanvasClicked.notify()),this.args.linkEnabled)return void(this.args.linking?(this.linkNodeTarget=this.getVertexIdFromSVGId(a.target.id),this.args.linking=!1,this.args.linkEnabled=!1,this.isVertex(a.target)&&this.getDataset().addEdge(this.linkNodeSource+"_"+this.linkNodeTarget,this.linkNodeSource,this.linkNodeTarget,{}),this.linkSVGNode.parentNode.removeChild(this.linkSVGNode)):(this.args.linking=!0,this.isVertex(a.target)&&(this.linkStartX=b.x,this.linkStartY=b.y,this.linkSVGNode=SVG.drawLine(b.x,b.y,b.x,b.y,this._svg,{stroke:"#FF0000"}),this.linkNodeSource=this.getVertexIdFromSVGId(a.target.id))));(this.isVertex(a.target)||this.isNodeCanvas(a.target)||this.isNodeBackground(a.target))&&this._startDragging(a),this.isEdge(a.target)&&this.selectEdge(this.getEdgeIdFromSVGId(a.target.getAttribute("id"))),this.args.multipleSelectionEnabled&&(this.dragging||(this.setSelecting(!0),this.selectorX=b.x,this.selectorY=b.y,this.displaySelection(b.x,b.y,1,1)))}1==event.button&&(this.setLinking(!1),this.setMultipleSelection(!1),this.selecting=!1,(this.isVertex(a.target)||this.isNodeCanvas(a.target)||this.isNodeBackground(a.target))&&this._startDragging(a))},GraphCanvas.prototype.mouseUp=function(a){if(this.args.interactive){if(this.dragging&&(this._stopDragging(a),this.isVertex(a.target))){var b=this.getVertexIdFromSVGId(a.target.id);this.getDataset().getVertexById(b).getEdges().length>=this.args.maxNumberEdgesMoving&&this.moveEdge(b)}if(this.selecting){this.setSelecting(!1);for(var c=(parseFloat(this.selectorSVGNode.getAttribute("x"))-DOM.select(this.id).getAttribute("dragx"))/this.getFormatter().getWidth(),d=(parseFloat(this.selectorSVGNode.getAttribute("y"))-DOM.select(this.id).getAttribute("dragy"))/this.getFormatter().getHeight(),e=c+parseFloat(this.selectorSVGNode.getAttribute("width")/this.formatter.getWidth()),f=d+parseFloat(this.selectorSVGNode.getAttribute("height")/this.formatter.getHeight()),g=this.getLayout().getVerticesByArea(c/this.getFormatter().getZoomScale,d/this.getFormatter().getZoomScale,e/this.getFormatter().getZoomScale,f/this.getFormatter().getZoomScale),h=0;h<g.length;h++)this.selectNode(g[h].getId());null!=this.selectorSVGNode&&this._svg.removeChild(this.selectorSVGNode),this.args.labeled&&(this.clearLabels(),this.renderLabels()),this.selectorSVGNode=null}}},GraphCanvas.prototype.displaySelection=function(a,b,c,d){null!=this.selectorSVGNode?(this.selectorSVGNode.setAttribute("x",a),this.selectorSVGNode.setAttribute("y",b),this.selectorSVGNode.setAttribute("width",c),this.selectorSVGNode.setAttribute("height",d)):this.selectorSVGNode=SVG.drawRectangle(a,b,c,d,this._svg,{fill:"red",stroke:"black",opacity:"0.2","stroke-opacity":"1"})},GraphCanvas.prototype._startDragging=function(a){if(this.isDraggingCanvasEnabled()||this.isNodeCanvas(a.target)&&(this.draggingElement=null),this.isVertex(a.target)||this.isNodeBackground(a.target)&&this.isDraggingCanvasEnabled()||this.isNodeCanvas(a.target)&&this.isDraggingCanvasEnabled()){this.clearLabels(),this.draggingElement=a.target,this.dragging=!0;var b=this.getSVGCoordenates(a);this.nMouseOffsetX=b.x-parseInt(a.target.getAttribute("dragx")),this.nMouseOffsetY=b.y-parseInt(a.target.getAttribute("dragy")),this.isVertex(a.target)?(this.dragStartX=parseInt(this.draggingElement.getAttribute("dragx"))*this.getFormatter().getZoomScale()+parseFloat(DOM.select(this.id).getAttribute("dragx")),this.dragStartY=parseInt(this.draggingElement.getAttribute("dragy"))*this.getFormatter().getZoomScale()+parseFloat(DOM.select(this.id).getAttribute("dragy"))):(this.dragStartX=b.x-parseInt(this.draggingElement.getAttribute("dragx")),this.dragStartY=b.y-parseInt(this.draggingElement.getAttribute("dragy")))}},GraphCanvas.prototype._stopDragging=function(a){this.nMouseOffsetX=0,this.nMouseOffsetX=0,this.dragging=!1,this.draggingElement=null,this.renderLabels(),this.setLinking(!1),this.setMultipleSelection(!0),this.selecting=!1},GraphCanvas.prototype.moveEdge=function(a){for(var b=this.getLayout().getNodeById(a).x*this.getFormatter().getWidth(),c=this.getLayout().getNodeById(a).y*this.getFormatter().getHeight(),d=0;d<this.getDataset().getVertexById(a).getEdgesOut().length;d++){var e=this.getDataset().getVertexById(a).getEdgesOut()[d].getId(),f=this.getSVGEdgeId(e),g=this.getFormatter().getEdgeById(e);g instanceof LineEdgeGraphFormatter&&(DOM.select(f+"_shadow").setAttribute("x2",b),DOM.select(f+"_shadow").setAttribute("y2",c),DOM.select(f).setAttribute("x2",b),DOM.select(f).setAttribute("y2",c)),(g instanceof DirectedLineEdgeGraphFormatter||g instanceof OdirectedLineEdgeGraphFormatter||g instanceof OdotDirectedLineEdgeGraphFormatter||g instanceof DotDirectedLineEdgeGraphFormatter||g instanceof CutDirectedLineEdgeGraphFormatter)&&(this.removeEdge(e),this.renderEdge(e))}for(var d=0;d<this.getDataset().getVertexById(a).getEdgesIn().length;d++){var e=this.getDataset().getVertexById(a).getEdgesIn()[d].getId(),f=this.getSVGEdgeId(e),g=this.getFormatter().getEdgeById(e);if(g instanceof LineEdgeGraphFormatter&&(DOM.select(f).setAttribute("x1",b),DOM.select(f).setAttribute("y1",c),DOM.select(f+"_shadow").setAttribute("x1",b),DOM.select(f+"_shadow").setAttribute("y1",c)),(g instanceof DirectedLineEdgeGraphFormatter||g instanceof OdirectedLineEdgeGraphFormatter||g instanceof OdotDirectedLineEdgeGraphFormatter||g instanceof DotDirectedLineEdgeGraphFormatter||g instanceof CutDirectedLineEdgeGraphFormatter)&&(this.removeEdge(e),this.renderEdge(e)),g instanceof BezierEdgeGraphFormatter){var h=this.getFormatter().getVertexById(a).getDefault().getSize()*this.getFormatter().getNodesMaxSize(),i=this.calculateCoordenatesBezier(h,b,c);DOM.select(f).setAttribute("d",i)}}},GraphCanvas.prototype.moveNode=function(a){var b=this.getLayout().getNodeById(a).x*this.getFormatter().getWidth(),c=this.getLayout().getNodeById(a).y*this.getFormatter().getHeight(),d=DOM.select(this.getSVGNodeId(a));d.setAttribute("dragx",b),d.setAttribute("dragy",c),d.setAttribute("transform","translate("+b+","+c+")"),this.getDataset().getVertexById(a).getEdges().length<this.args.maxNumberEdgesMoving&&this.moveEdge(a)},GraphCanvas.prototype._movingNode=function(a,b,c){var d=this.getVertexIdFromSVGId(a.getAttribute("id"));this.getLayout().getNodeById(d).setCoordinates(b/this.getFormatter().getWidth(),c/this.getFormatter().getHeight()),this.desplazamientoX=0,this.desplazamientoY=0,this.removeLabel(d),this.renderLabel(d)},GraphCanvas.prototype.init=function(){this._svg=this.createSVGDom(this.targetID,this.id,this.getFormatter().getWidth(),this.getFormatter().getHeight(),this.getFormatter().getBackgroundColor()),this.GraphGroup=SVG.drawGroup(this._svg,[["id",this.args.idGraph],["transform","translate(0,0), scale(1)"]]),this.GraphBackground=SVG.drawGroup(this.GraphGroup,[["id",this.args.idBackground]]),this.GraphEdgeGroup=SVG.drawGroup(this.GraphGroup,[["id",this.args.idEdgesGraph]]),this.GraphNodeGroup=SVG.drawGroup(this.GraphGroup,[["id",this.args.idNodesGraph]]),this.GraphLabelGroup=SVG.drawGroup(this.GraphGroup,[["id",this.args.idLabelGraph]]),null!=this.getFormatter().getBackgroundImage()&&""!=this.getFormatter().getBackgroundImage()&&this.setBackgroundImage(this.getFormatter().getBackgroundImage());var a=this;this._svg.addEventListener("click",function(b){a.mouseClick(b)},!1),this._svg.addEventListener("mousemove",function(b){a.mouseMove(b,a)},!1),this._svg.addEventListener("mousedown",function(b){a.mouseDown(b,a)},!1),this._svg.addEventListener("mouseup",function(b){a.mouseUp(b,a)},!1)},GraphCanvas.prototype.setBackgroundImage=function(){null!=this.NodeSVGbackgroundImage&&this.NodeSVGbackgroundImage.parentNode.removeChild(this.NodeSVGbackgroundImage),$("#"+this.targetID).svg(),$("#"+this.targetID).svg("get"),$("#"+this.targetID).svg("get")._svg=document.getElementById(this.id);var a=$("#"+this.targetID).svg("get");this.NodeSVGbackgroundImage=a.image(0,0,this.getFormatter().getWidth(),this.getFormatter().getHeight(),this.getFormatter().getBackgroundImage()),this.NodeSVGbackgroundImage.setAttribute("id",this.args.idBackgroundNode),this.NodeSVGbackgroundImage.setAttribute("x",0),this.NodeSVGbackgroundImage.setAttribute("y",0),this.NodeSVGbackgroundImage.setAttribute("dragx",0),this.NodeSVGbackgroundImage.setAttribute("dragy",0),null!=this.getFormatter().args.backgroundImageHeight&&this.NodeSVGbackgroundImage.setAttribute("height",this.getFormatter().args.backgroundImageHeight),null!=this.getFormatter().args.backgroundImageWidth&&this.NodeSVGbackgroundImage.setAttribute("width",this.getFormatter().args.backgroundImageWidth),null!=this.getFormatter().args.backgroundImageX&&this.NodeSVGbackgroundImage.setAttribute("x",this.getFormatter().args.backgroundImageX),null!=this.getFormatter().args.backgroundImageY&&this.NodeSVGbackgroundImage.setAttribute("y",this.getFormatter().args.backgroundImageY),this.GraphBackground.appendChild(this.NodeSVGbackgroundImage),this.NodeSVGbackgroundImage.removeAttribute("href"),this.NodeSVGbackgroundImage.setAttribute("xlink:href",this.getFormatter().getBackgroundImage())},GraphCanvas.prototype.removeBackgroundImage=function(){null!=this.NodeSVGbackgroundImage&&this.NodeSVGbackgroundImage.parentNode.removeChild(this.NodeSVGbackgroundImage)},GraphCanvas.prototype._setBackgroundColor=function(a){var b=[["fill",a]];SVG.drawRectangle(0,0,this.getFormatter().getWidth(),this.getFormatter().getHeight(),this.GraphBackground,b)},GraphCanvas.prototype.toJSON=function(){var a={};return a.dataset={},a.formatter={},a.layout={},a.dataset=this.getDataset().toJSON(),a.formatter=this.getFormatter().toJSON(),a.layout=this.getLayout().toJSON(),a},GraphCanvas.prototype.toHTML=function(){var a=this._svg.parentElement.innerHTML,b=a.indexOf("<svg"),c=a.indexOf("</svg>")+6;return a.substr(b,c)},GraphCanvas.prototype.draw=function(a,b,c){this.setDataset(a),this.setFormatter(b),this.setLayout(c);var d=this;this.getFormatter().changed.attach(function(a,b){d.removeNode(b.getId()),d.renderNode(b.getId()),d.args.labeled&&(d.removeLabel(b.getId()),d.renderLabel(b.getId()))}),this.getFormatter().edgeChanged.attach(function(a,b){d.removeEdge(b.getId()),d.renderEdge(b.getId())}),this.getFormatter().resized.attach(function(a,b){d.resize(d.getFormatter().getWidth(),d.getFormatter().getHeight())}),this.getFormatter().backgroundImageChanged.attach(function(a,b){d.setBackgroundImage(d.getFormatter().getBackgroundImage())}),this.getFormatter().backgroundColorChanged.attach(function(a,b){d._setBackgroundColor(d.getFormatter().getBackgroundColor())}),this.getLayout().changed.attach(function(a,b){d.moveNode(b.getId()),d.moveEdge(b.getId()),d.args.labeled&&(d.removeLabel(b.getId()),d.renderLabel(b.getId()))}),this.getDataset().newVertex.attach(function(a,b){d.renderNode(b.getId()),d.args.labeled&&d.renderLabel(b.getId())}),this.getDataset().newEdge.attach(function(a,b){d.renderEdge(b.getId())}),this.getDataset().vertexDeleted.attach(function(a,b){d.removeNode(b.getId()),d.args.labeled&&d.removeLabel(b.getId())}),this.getDataset().edgeDeleted.attach(function(a,b){d.removeEdge(b.getId())}),this.getDataset().vertexNameChanged.attach(function(a,b){d.args.labeled&&(d.removeLabel(b.item.getId()),d.removeLabel(b.item.getId()),d.renderLabel(b.item.getId()))}),this.init(),this.render()},GraphCanvas.prototype.render=function(){for(var a in this.getDataset().getVertices())this.renderNode(a);this.renderLabels(),this.renderEdges()},GraphCanvas.prototype.renderLabels=function(){if(this.args.labeled)for(var a in this.getDataset().getVertices())this.renderLabel(a)},GraphCanvas.prototype.removeLabels=function(){for(var a in this.getDataset().getVertices())this.removeLabel(a)},GraphCanvas.prototype.isNodeCanvas=function(a){return a.id==this.args.idGraph||a.id==this.id},GraphCanvas.prototype.isNodeBackground=function(a){return a.id==this.args.idBackgroundNode},GraphCanvas.prototype.isVertex=function(a){return null!=a.getAttribute("id")&&-1!=a.getAttribute("id").indexOf("_v_")},GraphCanvas.prototype.isLabel=function(a){return null!=a.getAttribute("id")&&-1!=a.getAttribute("id").indexOf("_l_")},GraphCanvas.prototype.isEdge=function(a){return null!=a.getAttribute("id")&&-1!=a.getAttribute("id").indexOf("_e_")},GraphCanvas.prototype.resize=function(a,b){null!=this.NodeSVGbackgroundImage&&(this.NodeSVGbackgroundImage.setAttribute("width",a),this.NodeSVGbackgroundImage.setAttribute("height",b)),this._svg.setAttribute("width",a),this._svg.setAttribute("height",b),this.clearCanvas(),this.render()},GraphCanvas.prototype.clearCanvas=function(){DOM.removeChilds(this.GraphEdgeGroup.getAttribute("id")),DOM.removeChilds(this.GraphNodeGroup.getAttribute("id")),this.clearLabels()},GraphCanvas.prototype.clearLabels=function(){DOM.removeChilds(this.GraphLabelGroup.getAttribute("id"))},GraphCanvas.prototype.getSVGNodeId=function(a){return this.id+"_v_"+a},GraphCanvas.prototype.getSVGEdgeId=function(a){return this.id+"_e_"+a},GraphCanvas.prototype.getSVGArrowEdgeId=function(a){return this.id+"_arrow_"+a},GraphCanvas.prototype.getSVGLabelId=function(a){return this.id+"_l_"+a},GraphCanvas.prototype.blinkVertexById=function(a){$("#"+this.getSVGNodeId(a)).fadeIn().fadeOut().fadeIn().fadeOut().fadeIn().fadeOut()},GraphCanvas.prototype.getVertexIdFromSVGId=function(a){return a.replace(this.id,"").replace("_v_","")},GraphCanvas.prototype.getEdgeIdFromSVGId=function(a){return a.replace(this.id,"").replace("_e_","")},GraphCanvas.prototype.getVertexById=function(a){return document.getElementById(this.getSVGNodeId(a))},GraphCanvas.prototype.renderNodes=function(){for(var a in this.getDataset().getVertices())this.renderNode(a)},GraphCanvas.prototype.overNode=function(a){if(this.args.interactive&&null==this.args.isVertexSelected[a]){var b=this.getFormatter().getVertexById(a).getOver();b.args.cursor="pointer",this.changeVertexFormat(a,b)}},GraphCanvas.prototype.outNode=function(a){this.args.interactive&&null==this.args.isVertexSelected[a]&&this.changeVertexFormat(a,this.getFormatter().getVertexById(a).getDefault())},GraphCanvas.prototype.overLabel=function(a){this.overNode(a)},GraphCanvas.prototype.outLabel=function(a){this.outNode(a)},GraphCanvas.prototype.clickNode=function(a){this.args.interactive&&(null==this.args.isVertexSelected[a]?this.selectNode(a):this.deselectNode(a))},GraphCanvas.prototype.selectNode=function(a){for(var b=0;b<this.args.selectedVertices.length;b++){var c=this.getFormatter().getVertexById(a).getSelected();c.opacity=.2,this.changeVertexFormat(a,this.getFormatter().getVertexById(a).getSelected())}if(null==this.args.isVertexSelected[a]){var c=this.getFormatter().getVertexById(a).getSelected();c.opacity=1,this.changeVertexFormat(a,this.getFormatter().getVertexById(a).getSelected()),this.args.selectedVertices.push(a),this.args.isVertexSelected[a]=this.args.selectedVertices.length-1,this.onVertexSelect.notify(a)}},GraphCanvas.prototype.selectAllEdges=function(){this.deselectNodes(),this.deselectEdges();for(var a in this.getDataset().edges)this.selectEdge(a)},GraphCanvas.prototype.selectAllNodes=function(){this.deselectNodes(),this.deselectEdges();for(var a in this.getDataset().vertices)this.selectNode(a)},GraphCanvas.prototype.selectAll=function(){this.deselectNodes(),this.deselectEdges();for(var a in this.getDataset().vertices)this.selectNode(a);for(var b in this.getDataset().edges)this.selectEdge(b)},GraphCanvas.prototype.selectEdge=function(a){null==this.args.isEdgeSelected[a]&&(this.changeEdgeFormat(a,this.getFormatter().getEdgeById(a).getSelected()),this.args.isEdgeSelected[a]=!0,this.onEdgeSelect.notify(a))},GraphCanvas.prototype.selectEdges=function(a){for(var b=0;b<a.length;b++)this.selectEdge(a[b])},GraphCanvas.prototype.deselectNode=function(a){if(null!=this.args.isVertexSelected[a]){this.changeVertexFormat(a,this.getFormatter().getVertexById(a).getDefault()),this.args.selectedVertices.splice(this.args.isVertexSelected[a],1);var b=this.args.isVertexSelected[a];delete this.args.isVertexSelected[a];for(var c in this.args.isVertexSelected)this.args.isVertexSelected[c]>b&&(this.args.isVertexSelected[c]=this.args.isVertexSelected[c]-1)}},GraphCanvas.prototype.deselectNodes=function(){for(var a=JSON.parse(JSON.stringify(this.getSelectedVertices())),b=0;b<a.length;b++)this.deselectNode(a[b])},GraphCanvas.prototype.selectNodes=function(a){for(var b=0;b<a.length;b++)this.selectNode(a[b])},GraphCanvas.prototype.changeVertexFormat=function(a,b){var c=DOM.select(this.getSVGNodeId(a));if(null!=c){var d=b.toJSON();for(var e in d)c.setAttribute(e,d[e]);if(this.getFormatter().getVertexById(a)instanceof CircleVertexGraphFormatter){var f="translate("+c.getAttribute("dragx")+","+c.getAttribute("dragy")+"), scale("+b.getSize()+")";c.setAttribute("transform",f)}}},GraphCanvas.prototype.renderLabel=function(a){var b=(Math.ceil(this.getLayout().getNodeById(a).x*this.getFormatter().getWidth()),Math.ceil(this.getLayout().getNodeById(a).y*this.getFormatter().getHeight()),JSON.parse(JSON.stringify(this.getFormatter().getVertexById(a).getDefault().toJSON().title)));b.id=this.getSVGLabelId(this.getDataset().getVertexById(a).getId()),b.dx=-1*(this.getDataset().getVertexById(a).getName().length*b["font-size"])/4-4,b.dy=parseFloat(this.getFormatter().getVertexById(a).getDefault().getSize())+parseFloat(b["font-size"])+parseFloat(this.getFormatter().getVertexById(a).getDefault().getStrokeWidth())-4,b.dragx=Math.ceil(this.getLayout().getNodeById(a).x*this.getFormatter().getWidth());var c=parseFloat(this.getFormatter().getVertexById(a).getDefault().getSize())+Math.ceil(this.getLayout().getNodeById(a).y*this.getFormatter().getHeight());b.dragy=c,b.transform="translate("+b.dragx+","+b.dragy+")";var d=SVG.drawText(0,0,this.getDataset().getVertexById(a).getName(),this.GraphLabelGroup,b);this.svgLabels[a]=d;var e=this;null!=d&&(d.addEventListener("mouseover",function(){e.overLabel(a)},!1),d.addEventListener("mouseout",function(){e.outLabel(a)},!1))},GraphCanvas.prototype.removeLabel=function(a){null!=DOM.select(this.getSVGLabelId(a))&&DOM.select(this.getSVGLabelId(a)).parentNode.removeChild(DOM.select(this.getSVGLabelId(a)))},GraphCanvas.prototype.renderNode=function(a){var b=JSON.parse(JSON.stringify(this.getFormatter().getVertexById(a).getDefault().toJSON()));b.dragx=Math.ceil(this.getLayout().getNodeById(a).x*this.getFormatter().getWidth()),b.dragy=Math.ceil(this.getLayout().getNodeById(a).y*this.getFormatter().getHeight()),b.transform="translate("+b.dragx+","+b.dragy+")",b.id=this.getSVGNodeId(a),this.circleDefaultRadius=this.getFormatter().getVertexById(a).getDefault().getSize();var c;this.getFormatter().getVertexById(a)instanceof CircleVertexGraphFormatter&&(c=SVG.drawCircle(0,0,this.circleDefaultRadius,this.GraphNodeGroup,b)),this.getFormatter().getVertexById(a)instanceof SquareVertexGraphFormatter&&(c=SVG.drawRectangle(0-this.circleDefaultRadius,0-this.circleDefaultRadius,2*this.circleDefaultRadius,2*this.circleDefaultRadius,this.GraphNodeGroup,b)),this.getFormatter().getVertexById(a)instanceof EllipseVertexGraphFormatter&&(c=SVG.drawEllipse(0,0,1.5*this.circleDefaultRadius,this.circleDefaultRadius,this.GraphNodeGroup,b)),this.getFormatter().getVertexById(a)instanceof RectangleVertexGraphFormatter&&(c=SVG.drawRectangle(0-1.5*this.circleDefaultRadius,0-this.circleDefaultRadius,2*this.circleDefaultRadius*1.5,2*this.circleDefaultRadius,this.GraphNodeGroup,b)),this.getFormatter().getVertexById(a)instanceof RoundedVertexGraphFormatter&&(b.ry=2,b.rx=2,c=SVG.drawRectangle(0-1.5*this.circleDefaultRadius,0-this.circleDefaultRadius,2*this.circleDefaultRadius*1.5,2*this.circleDefaultRadius,this.GraphNodeGroup,b)),this.getFormatter().getVertexById(a)instanceof OctagonVertexGraphFormatter&&(b.ry=2,b.rx=2,c=SVG.drawRectangle(0-1.5*this.circleDefaultRadius,0-this.circleDefaultRadius,2*this.circleDefaultRadius*1.5,2*this.circleDefaultRadius,this.GraphNodeGroup,b)),c.internalId=a;var d=this;null!=c&&(c.addEventListener("mouseover",function(){d.onVertexOver.notify(a),d.overNode(a)},!1),c.addEventListener("mouseout",function(){d.onVertexOut.notify(a),d.outNode(a)},!1),c.addEventListener("mouseup",function(){d.onVertexUp.notify(a)},!1))},GraphCanvas.prototype.removeNode=function(a){DOM.select(this.getSVGNodeId(a)).parentNode.removeChild(DOM.select(this.getSVGNodeId(a))),this.args.labeled&&this.removeLabel(a)},GraphCanvas.prototype.removeSelected=function(){this.removeSelectedEdges(),this.removeSelectedNode()},GraphCanvas.prototype.removeSelectedNode=function(){var a=JSON.parse(JSON.stringify(this.getSelectedVertices()));this.deselectNodes();for(var b=a.sort(function(a,b){return a-b}),c=0;c<b.length;c++)null!=this.getDataset().getVertexById(b[c])&&this.getDataset().getVertexById(b[c]).remove()},GraphCanvas.prototype.removeEdge=function(a){null!=DOM.select(this.getSVGEdgeId(a))&&DOM.select(this.getSVGEdgeId(a)).parentNode.removeChild(DOM.select(this.getSVGEdgeId(a))),null!=DOM.select(this.getSVGEdgeId(a)+"_shadow")&&DOM.select(this.getSVGEdgeId(a)+"_shadow").parentNode.removeChild(DOM.select(this.getSVGEdgeId(a)+"_shadow")),null!=DOM.select(this.getSVGArrowEdgeId(a))&&DOM.select(this.getSVGArrowEdgeId(a)).parentNode.removeChild(DOM.select(this.getSVGArrowEdgeId(a)))},GraphCanvas.prototype.overEdge=function(a){if(this.args.interactive&&!this.dragging&&!this.selecting&&null==this.args.isEdgeSelected[a]){var b=this.getFormatter().getEdgeById(a).getOver();b.args.cursor="pointer",this.changeEdgeFormat(a,b)}},GraphCanvas.prototype.outEdge=function(a){this.args.interactive&&null==this.args.isEdgeSelected[a]&&this.changeEdgeFormat(a,this.getFormatter().getEdgeById(a).getDefault())},GraphCanvas.prototype.changeEdgeFormat=function(a,b){var c=DOM.select(this.getSVGEdgeId(a)+"_shadow");if(null!=c){var d=b.toJSON();for(var e in d)c.setAttribute(e,d[e])}},GraphCanvas.prototype.deselectEdge=function(a){if(null!=this.args.isEdgeSelected[a]){this.changeEdgeFormat(a,this.getFormatter().getEdgeById(a).getDefault());this.args.isEdgeSelected[a];delete this.args.isEdgeSelected[a]}},GraphCanvas.prototype.deselectEdges=function(){for(var a=JSON.parse(JSON.stringify(this.getSelectedEdges())),b=0;b<a.length;b++)this.deselectEdge(a[b])},GraphCanvas.prototype.removeSelectedEdges=function(){var a=JSON.parse(JSON.stringify(this.getSelectedEdges()));this.deselectEdges();for(var b=0;b<a.length;b++)null!=this.getDataset().getEdgeById(a[b])&&this.getDataset().getEdgeById(a[b]).remove()},GraphCanvas.prototype.renderEdge=function(a){var b=this.getFormatter().getEdgeById(a).getDefault().toJSON(),c=this.getDataset().getEdgeById(a),d=this.getVertexById(c.getNodeTarget().getId()),e=this.getVertexById(c.getNodeSource().getId());b.id=this.getSVGEdgeId(c.getId())+"_shadow";var f=null;if(this.getFormatter().getEdgeById(a)instanceof LineEdgeGraphFormatter){var g=e.getAttribute("dragx"),h=e.getAttribute("dragy"),i=d.getAttribute("dragx"),j=d.getAttribute("dragy");SVG.drawLine(g,h,i,j,this.GraphEdgeGroup,b);var k={};k.id=this.getSVGEdgeId(c.getId()),k["stroke-opacity"]=0,k["stroke-width"]=4,k.stroke="black",f=SVG.drawLine(e.getAttribute("dragx"),e.getAttribute("dragy"),d.getAttribute("dragx"),d.getAttribute("dragy"),this.GraphEdgeGroup,k)}if(this.getFormatter().getEdgeById(a)instanceof BezierEdgeGraphFormatter){var l=c.getNodeTarget().getId(),m=this.formatter.getVertexById(l).getDefault().getSize()*this.getFormatter().getNodesMaxSize();b.fill="none",b.id=this.getSVGEdgeId(a);var n=this.calculateCoordenatesBezier(m,e.getAttribute("dragx"),e.getAttribute("dragy"));f=SVG.drawPath(n,this.GraphEdgeGroup,b)}if(this.getFormatter().getEdgeById(a)instanceof DirectedLineEdgeGraphFormatter||this.getFormatter().getEdgeById(a)instanceof CutDirectedLineEdgeGraphFormatter||this.getFormatter().getEdgeById(a)instanceof DotDirectedLineEdgeGraphFormatter||this.getFormatter().getEdgeById(a)instanceof OdotDirectedLineEdgeGraphFormatter||this.getFormatter().getEdgeById(a)instanceof OdirectedLineEdgeGraphFormatter){var g=e.getAttribute("dragx"),h=e.getAttribute("dragy"),i=d.getAttribute("dragx"),j=d.getAttribute("dragy"),o=parseFloat(this.getFormatter().getVertexById(this.getDataset().getEdgeById(a).getNodeTarget().getId()).getDefault().getSize()*this.circleDefaultRadius),p=this._calculateEdgePointerPosition(g,h,i,j,o);i=p.x,j=p.y,SVG.drawLine(g,h,i,j,this.GraphEdgeGroup,b);var k={};k.id=this.getSVGEdgeId(c.getId()),k["stroke-opacity"]=0,k["stroke-width"]=4,k.stroke="black",f=SVG.drawLine(g,h,i,j,this.GraphEdgeGroup,k)}if(this.getFormatter().getEdgeById(a)instanceof DirectedLineEdgeGraphFormatter||this.getFormatter().getEdgeById(a)instanceof OdirectedLineEdgeGraphFormatter){var g=e.getAttribute("dragx"),h=e.getAttribute("dragy"),i=d.getAttribute("dragx"),j=d.getAttribute("dragy"),p=this._calculateEdgePointerPosition(g,h,i,j,o);i=p.x,j=p.y;var q=Geometry.toDegree(p.angle)+90;this.arrowDefaultSize=this.getFormatter().getEdgeById(a).getArrowSize();var r,n="-"+this.arrowDefaultSize+",0 0,-"+2*parseFloat(this.arrowDefaultSize)+" "+this.arrowDefaultSize+",0";r=this.getFormatter().getEdgeById(a)instanceof DirectedLineEdgeGraphFormatter?[["fill",this.getFormatter().getEdgeById(a).getDefault().getStroke()],["stroke",this.getFormatter().getEdgeById(a).getDefault().getStroke()],["id",this.getSVGArrowEdgeId(a)]]:[["fill","#FFFFFF"],["stroke",this.getFormatter().getEdgeById(a).getDefault().getStroke()],["id",this.getSVGArrowEdgeId(a)]];var s=SVG.drawPoligon(n,this.GraphEdgeGroup,r);s.setAttribute("transform"," translate("+i+", "+j+"), rotate("+q+")")}if(this.getFormatter().getEdgeById(a)instanceof CutDirectedLineEdgeGraphFormatter){var g=e.getAttribute("dragx"),h=e.getAttribute("dragy"),i=d.getAttribute("dragx"),j=d.getAttribute("dragy"),p=this._calculateEdgePointerPosition(g,h,i,j,o);
i=p.x,j=p.y;var q=Geometry.toDegree(p.angle)+90,n="-4,0 4,0 4,-2 -4,-2",s=SVG.drawPoligon(n,this.GraphEdgeGroup,[["fill",this.getFormatter().getEdgeById(a).getDefault().getStroke()],["stroke",this.getFormatter().getEdgeById(a).getDefault().getStroke()],["id",this.getSVGArrowEdgeId(a)]]);s.setAttribute("transform"," translate("+i+", "+j+"), rotate("+q+")")}if(this.getFormatter().getEdgeById(a)instanceof DotDirectedLineEdgeGraphFormatter||this.getFormatter().getEdgeById(a)instanceof OdotDirectedLineEdgeGraphFormatter){var g=e.getAttribute("dragx"),h=e.getAttribute("dragy"),i=d.getAttribute("dragx"),j=d.getAttribute("dragy"),p=this._calculateEdgePointerPosition(g,h,i,j,o);i=p.x,j=p.y;var q=Geometry.toDegree(p.angle)+90,r=[];r=this.getFormatter().getEdgeById(a)instanceof OdotDirectedLineEdgeGraphFormatter?[["fill","#FFFFFF"],["stroke",this.getFormatter().getEdgeById(a).getDefault().getStroke()],["id",this.getSVGArrowEdgeId(a)]]:[["fill",this.getFormatter().getEdgeById(a).getDefault().getStroke()],["stroke",this.getFormatter().getEdgeById(a).getDefault().getStroke()],["id",this.getSVGArrowEdgeId(a)]];var s=SVG.drawCircle(0,0,4,this.GraphEdgeGroup,r);s.setAttribute("transform"," translate("+i+", "+j+"), rotate("+q+")")}var t=this;null!=f&&this.getDataset().getEdgesCount()<this.args.maxNumberEdgesFiringEvents&&(f.addEventListener("mouseover",function(){t.overEdge(a)},!1),f.addEventListener("mouseout",function(){t.outEdge(a)},!1))},GraphCanvas.prototype._calculateEdgePointerPosition=function(a,b,c,d,e){var f=Geometry.getAngleBetweenTwoPoints(a,b,c,d);if(0>c-a){var g=Geometry.getAdjacentSideOfRectangleRight(f,e);c=parseFloat(c)+parseFloat(g),arrowX=parseFloat(c)+parseFloat(g)+this.arrowDefaultSize/2}else{var g=Geometry.getAdjacentSideOfRectangleRight(f,e);c=parseFloat(c)-parseFloat(g),arrowX=parseFloat(c)-parseFloat(g)-this.arrowDefaultSize/2}if(d-b>0){var h=Geometry.getOppositeSideOfRectangleRight(f,e);d=parseFloat(d)-parseFloat(h),arrowY=parseFloat(d)-parseFloat(h)-this.arrowDefaultSize/2}else{var h=Geometry.getOppositeSideOfRectangleRight(f,e);d=parseFloat(d)+parseFloat(h),arrowY=parseFloat(d)+parseFloat(h)-this.arrowDefaultSize/2}return{x:arrowX,y:arrowY,angle:f}},GraphCanvas.prototype.calculateCoordenatesBezier=function(a,b,c){var d=b-a/2,e=c-a/2,f=parseFloat(b)+parseFloat(a/2),g=c-a/2,h=(f-d)/2+d,i=c-2*a,j="M"+d+","+e+" T"+h+","+i+" "+f+","+g;return j},GraphCanvas.prototype.renderEdges=function(){for(var a in this.getDataset().getEdges())this.renderEdge(this.getDataset().getEdgeById(a).getId())},GraphCanvas.prototype.getLastSelectedNode=function(){var a=null;if(this.getSelectedVertices().length>0){var b=this.getSelectedVertices()[this.getSelectedVertices().length-1];a=this.getDataset().getVertexById(b)}return a},GraphCanvas.prototype.setDataset=function(a){this.dataset=a},GraphCanvas.prototype.setFormatter=function(a){this.formatter=a},GraphCanvas.prototype.setLayout=function(a){this.layout=a},GraphCanvas.prototype.getDataset=function(){return this.dataset},GraphCanvas.prototype.getFormatter=function(){return this.formatter},GraphCanvas.prototype.getLayout=function(){return this.layout},GraphCanvas.prototype.addVertex=function(a,b){this.getDataset().addNode(a,b)},GraphCanvas.prototype.removeVertex=function(a){this.getDataset().getVertexById(a).remove()},GraphCanvas.prototype.addEdge=function(a,b,c,d){this.getDataset().addEdge(a,b,c,d)},GraphCanvas.prototype.getWidth=function(){return this.getFormatter().getWidth()},GraphCanvas.prototype.getHeight=function(){return this.getFormatter().getHeight()},GraphCanvas.prototype.getBackgroundImage=function(){return this.getFormatter().getBackgroundImage()},GraphCanvas.prototype.getBackgroundColor=function(){return this.getFormatter().getBackgroundColor()},GraphCanvas.prototype.setBackgroundColor=function(){this.getFormatter().setBackgroundColor(value)},GraphCanvas.prototype.setVertexSize=function(a,b){this.getFormatter().getVertexById(a).getDefault().setSize(b)},GraphCanvas.prototype.getVertexSize=function(a){return this.getFormatter().getVertexById(a).getDefault().getSize()},GraphCanvas.prototype.setVertexStroke=function(a,b){this.getFormatter().getVertexById(a).getDefault().setStroke(b)},GraphCanvas.prototype.getVertexStroke=function(a){return this.getFormatter().getVertexById(a).getDefault().getStroke()},GraphCanvas.prototype.setVertexStrokeOpacity=function(a,b){this.getFormatter().getVertexById(a).getDefault().setStrokeOpacity(b)},GraphCanvas.prototype.getVertexStrokeOpacity=function(a){return this.getFormatter().getVertexById(a).getDefault().getStrokeOpacity()},GraphCanvas.prototype.setVertexOpacity=function(a,b){this.getFormatter().getVertexById(a).getDefault().setOpacity(b)},GraphCanvas.prototype.getVertexOpacity=function(a){return this.getFormatter().getVertexById(a).getDefault().getOpacity()},GraphCanvas.prototype.setVertexFill=function(a,b){this.getFormatter().getVertexById(a).getDefault().setFill(b)},GraphCanvas.prototype.getVertexFill=function(a){return this.getFormatter().getVertexById(a).getDefault().getFill()},GraphCanvas.prototype.setEdgeSize=function(a,b){this.getFormatter().getEdgeById(a).getDefault().setSize(b)},GraphCanvas.prototype.getEdgeSize=function(a){return this.getFormatter().getEdgeById(a).getDefault().getSize()},GraphCanvas.prototype.setEdgeStroke=function(a,b){this.getFormatter().getEdgeById(a).getDefault().setStroke(b)},GraphCanvas.prototype.getEdgeStroke=function(a){return this.getFormatter().getEdgeById(a).getDefault().getStroke()},GraphCanvas.prototype.setEdgeStrokeOpacity=function(a,b){this.getFormatter().getEdgeById(a).getDefault().setStrokeOpacity(b)},GraphCanvas.prototype.getEdgeStrokeOpacity=function(a){return this.getFormatter().getEdgeById(a).getDefault().getStrokeOpacity()},GraphCanvas.prototype.setEdgeFill=function(a,b){this.getFormatter().getEdgeById(a).getDefault().setFill(b)},GraphCanvas.prototype.getEdgeFill=function(a){return this.getFormatter().getEdgeById(a).getDefault().getFill()},GraphCanvas.prototype.setCoordinates=function(a,b,c){return this.getLayout().getEdgeById(a).setCoordinates(b,c)},GraphDataset.prototype.loadFromJSON=DataSet.prototype.loadFromJSON,GraphDataset.prototype.toJSON=DataSet.prototype.toJSON,GraphDataset.prototype.validate=DataSet.prototype.validate,GraphDataset.prototype.getMaxClass=function(){var a=0;for(var b in this.vertices)this.vertices[b].getEdgesCount()>a&&(a=this.vertices[b].getEdgesCount());return a},GraphDataset.prototype.getMinClass=function(){var a=Math.min();for(var b in this.vertices)this.vertices[b].getEdgesCount()<a&&(a=this.vertices[b].getEdgesCount());return a},GraphDataset.prototype.getVertexByName=function(a){var b=new Array;for(var c in this.verticesIndex[a]){var d=this.getVertexById(this.verticesIndex[a][c]);return b.push(d),d}return 1>=b?this.getVertexById(this.verticesIndex[a]):b},GraphDataset.prototype.getVertexById=function(a){return this.vertices[a]},GraphDataset.prototype.toSIF=function(){var a=new SifFileDataAdapter;return a.toSIF(this)},GraphDataset.prototype.toSIFID=function(){var a=new SifFileDataAdapter;return a.toSIFID(this)},GraphDataset.prototype.toDOT=function(){var a=new DotFileDataAdapter;return a.toDOT(this)},GraphDataset.prototype.toDOTID=function(){var a=new DotFileDataAdapter;return a.toDOTID(this)},GraphDataset.prototype._addNode=function(a,b){return new Vertex(this._getVerticesCount()-1,a,b)},GraphDataset.prototype.addNode=function(a,b){this.json.vertices.push(a),this._addVerticesIndex(a,this._getVerticesCount()-1);var c=this._addNode(a,b);this.vertices[this._getVerticesCount()-1]=c,this._setNodeEvents(c),this.newVertex.notify(c)},GraphDataset.prototype._addVerticesIndex=function(a,b){null==this.verticesIndex[a]&&(this.verticesIndex[a]=new Array),this.verticesIndex[a].push(b)},GraphDataset.prototype.addEdge=function(a,b,c,d){this.json.edges.push(a);var e=this.getVertexById(b),f=this.getVertexById(c),g=this.getEdgesCount()-1;this.edges[g]=new Edge(g,a,e,f,d),this.json.relations.push({index:g,sourceIndex:b,targetIndex:c,args:d}),e.addEdge(this.edges[g]),f.addEdge(this.edges[g]),this._setEdgeEvents(this.edges[g]),this.newEdge.notify(this.edges[g])},GraphDataset.prototype.getVertices=function(){return this.vertices},GraphDataset.prototype.getEdges=function(){return this.edges},GraphDataset.prototype.getEdgeById=function(a){return this.edges[a]},GraphDataset.prototype._getVerticesCount=function(){return this.json.vertices.length},GraphDataset.prototype.getVerticesCount=function(){var a=0;for(var b in this.getVertices())a++;return a},GraphDataset.prototype.getEdgesCount=function(){return this.json.edges.length},GraphDataset.prototype.init=function(){this.edges=new Object,this.vertices=new Object},GraphDataset.prototype._setNodeEvents=function(a){var b=this;a.deleted.attach(function(a,c){b._removeNode(c)}),a.nameChanged.attach(function(a,c){for(var d=c.item,e=d.name,f=b.verticesIndex[c.previousName],g=0;g<f.length;g++)f[g]==d.id&&f.splice(g,1);0==f.length&&delete b.verticesIndex[c.previousName],b._addVerticesIndex(e,d.id),b.json.vertices[d.id]=e,b.vertexNameChanged.notify(c)})},GraphDataset.prototype._setEdgeEvents=function(a){var b=this;a.nameChanged.attach(function(a,c){b.edgeNameChanged.notify(c)}),a.deleted.attach(function(a,c){b._removeEdge(c)})},GraphDataset.prototype._connectVerticesByName=function(a,b){var c=this.getVertexByName(a),d=this.getVertexByName(b);null!=c&&null!=d?this.addEdge(c.getName()+"_"+d.getName(),c.getId(),d.getId(),{}):(null==c&&console.log("No encontrado: "+a),null==d&&console.log("No encontrado: "+b))},GraphDataset.prototype.loadFromJSON=function(a){var a=a;this.init(),this.json=new Object,this.json.vertices=new Array,this.json.edges=new Array,this.json.relations=new Array;for(var b=0;b<a.nodes.length;b++)if(null!=a.nodes[b]){var c=a.nodes[b];this.addNode(c)}else this.json.vertices.push(null);for(var b=0;b<a.edges.length;b++)if(null!=a.edges[b]){if(null!=a.relations[b]){var c=a.edges[b];this.addEdge(c,a.relations[b].sourceIndex,a.relations[b].targetIndex,a.relations[b].args)}}else this.json.edges.push(null),this.json.relations.push(null)},GraphDataset.prototype.prettyPrint=function(){for(var a in this.vertices){console.log(this.vertices[a].getName());for(var b=0;b<this.vertices[a].getEdgesIn().length;b++)console.log("          --> "+this.vertices[a].getEdgesIn()[b].getNodeTarget().getName())}},GraphDataset.prototype._removeEdge=function(a){this.json.edges[a.getId()]=null,this.json.relations[a.getId()]=null,delete this.edges[a.getId()],this.edgeDeleted.notify(a)},GraphDataset.prototype._removeNode=function(a){this.json.vertices[a.getId()]=null,delete this.vertices[a.getId()],this.vertexDeleted.notify(a)},GraphDataset.prototype.toJSON=function(){var a=new Object;new Array;return a.nodes=this.json.vertices,a.edges=this.json.edges,a.relations=this.json.relations,a},GraphDataset.prototype.clone=function(){var a=new GraphDataset;return a.loadFromJSON(this.toJSON()),a},GraphItem.prototype.getName=function(){return this.name},GraphItem.prototype.getId=function(){return this.id},GraphItem.prototype.setName=function(a){var b=this.getName();this.name=a,this.nameChanged.notify({item:this,previousName:b})},ItemGraphFormatter.prototype.getType=function(){return this.args.type},ItemGraphFormatter.prototype.toJSON=function(){var a=this.args;return a.defaultFormat=this.getDefault().toJSON(),a.over=this.getOver().toJSON(),a.selected=this.getSelected().toJSON(),a.dragging=this.getDragging().toJSON(),a.id=this.id,a},ItemGraphFormatter.prototype.loadFromJSON=function(a){this.args=a,this.defaultFormat=new ItemFormat(a.defaultFormat),this.over=new ItemFormat(a.over),this.selected=new ItemFormat(a.selected),this.dragging=new ItemFormat(a.dragging),this._setEvents()},ItemGraphFormatter.prototype._setEvents=function(){var a=this;this.defaultFormat.changed.attach(function(b,c){a.over.setSize(a.defaultFormat.getSize()),a.selected.setSize(a.defaultFormat.getSize()),a.dragging.setSize(a.defaultFormat.getSize()),a.stateChanged.notify(a)}),this.selected.changed.attach(function(b,c){a.stateChanged.notify(a)}),this.over.changed.attach(function(b,c){a.stateChanged.notify(a)}),this.dragging.changed.attach(function(b,c){a.stateChanged.notify(a)})},ItemGraphFormatter.prototype.getId=function(){return this.id},ItemGraphFormatter.prototype.getDefault=function(){return this.defaultFormat},ItemGraphFormatter.prototype.getSelected=function(){return this.selected},ItemGraphFormatter.prototype.getOver=function(){return this.over},ItemGraphFormatter.prototype.getDragging=function(){return this.dragging},ItemFormat.prototype._fixColor=function(a){var b=a;return-1!=a.indexOf("green")&&(b="#04B431"),-1!=a.indexOf("blue")&&(b="#045FB4"),-1!=a.indexOf("red")&&(b="#DF0101"),-1!=a.indexOf("black")&&(b="#000000"),-1!=a.indexOf("white")&&(b="#FFFFFF"),-1==a.indexOf("#")&&(b="#"+a),b},ItemFormat.prototype.toJSON=function(){return null!=this.args.strokeOpacity&&(this.args["stroke-opacity"]=this.args.strokeOpacity,delete this.args.strokeOpacity),null!=this.args.title.fontColor?this.args.title["font-color"]=this.args.title.fontColor:this.args.title["font-color"]=this.args.fontColor,null!=this.args.title.fontSize?this.args.title["font-size"]=this.args.title.fontSize:this.args.title["font-size"]=this.args.fontSize,this.args},ItemFormat.prototype.getAttribute=function(a){return this.args[a]},ItemFormat.prototype.setVisible=function(a){this.args.visible!=a&&(this.args.visible=a,this.changed.notify(this))},ItemFormat.prototype.getVisible=function(){return this.args.visible},ItemFormat.prototype.setHidden=function(a){this.args.hidden!=a&&(this.args.hidden=a,this.changed.notify(this))},ItemFormat.prototype.getHidden=function(){return this.args.hidden},ItemFormat.prototype.setStroke=function(a){this.args.stroke!=a&&(this.args.stroke=a,this.changed.notify(this))},ItemFormat.prototype.getStroke=function(){return this.args.stroke},ItemFormat.prototype.setStrokeOpacity=function(a){this.args.strokeOpacity!=a&&(this.args.strokeOpacity=a,this.changed.notify(this))},ItemFormat.prototype.getStrokeOpacity=function(){return this.args["stroke-opacity"]},ItemFormat.prototype.setStrokeWidth=function(a){this.args["stroke-width"]!=a&&(this.args["stroke-width"]=a,this.changed.notify(this))},ItemFormat.prototype.getFillOpacity=function(){return this.args["fill-opacity"]},ItemFormat.prototype.setfillOpacity=function(a){this.args["fill-opacity"]!=a&&(this.args["fill-opacity"]=a,this.changed.notify(this))},ItemFormat.prototype.getStrokeWidth=function(){return this.args["stroke-width"]},ItemFormat.prototype.setFill=function(a){this.args.fill!=a&&(this.args.fill=a,this.changed.notify(this))},ItemFormat.prototype.getFill=function(){return this.args.fill},ItemFormat.prototype.setSize=function(a){this.args.size!=a&&(this.args.size=a,this.changed.notify(this))},ItemFormat.prototype.getSize=function(){return this.args.size},ItemFormat.prototype.setOpacity=function(a){this.args.opacity!=a&&(this.args.opacity=a,this.changed.notify(this))},ItemFormat.prototype.getOpacity=function(){return this.args.opacity},ItemFormat.prototype.getArrowSize=function(){return this.args.arrowSize},ItemFormat.prototype.setArrowSize=function(a){this.args.arrowSize!=a&&(this.args.arrowSize=a,this.changed.notify(this))},ItemFormat.prototype.getFontSize=function(){return this.args.title.fontSize},ItemFormat.prototype.setFontSize=function(a){this.args.title.fontSize!=a&&(this.args.title.fontSize=a,this.changed.notify(this))},LayoutDataset.prototype.loadFromJSON=function(a,b){var c=this;this.vertices=new Object,this.dataset=a;for(var d in b)this.vertices[d]=new NodeLayout(d,b[d].x,b[d].y),this.vertices[d].changed.attach(function(a,b){c.changed.notify(b)});this._attachDatasetEvents()},LayoutDataset.prototype.toJSON=function(){var a=new Object;for(var b in this.vertices)a[b]=new Object,a[b].x=this.vertices[b].x,a[b].y=this.vertices[b].y;return a.dataset=new Object,a.dataset=this.dataset.toJSON(),a},LayoutDataset.prototype.dataBind=function(a){this.dataset=a,this._attachDatasetEvents(),this._calculateLayout()},LayoutDataset.prototype._removeVertex=function(a){delete this.vertices[a]},LayoutDataset.prototype._attachDatasetEvents=function(){var a=this;this.dataset.vertexDeleted.attach(function(b,c){a._removeVertex(c.getId())}),this.dataset.newVertex.attach(function(b,c){a.vertices[c.getId()]=new NodeLayout(c.getId(),.5,.5),a.vertices[c.getId()].changed.attach(function(b,c){a.changed.notify(c)})})},LayoutDataset.prototype.getType=function(){return this.args.type},LayoutDataset.prototype._calculateLayoutVertices=function(a,b){if("CIRCLE"==a){for(var c=.4,d=.5,e=.5,f=new Array,g=0;b>g;g++)x=d+c*Math.sin(2*g*Math.PI/b),y=e+c*Math.cos(2*g*Math.PI/b),f.push({x:x,y:y});return f}},LayoutDataset.prototype._calculateLayout=function(){var a=this;if("RANDOM"==this.getType())for(var b in this.dataset.getVertices())null==this.vertices[b]&&(this.vertices[b]=new NodeLayout(b,0,0)),this.vertices[b].setCoordinates(Math.random(),Math.random()),this.vertices[b].changed.attach(function(b,c){a.changed.notify(c)});if("CIRCLE"==this.getType()){var c=this.dataset._getVerticesCount(),d=this._calculateLayoutVertices(this.getType(),c),e=0;for(var b in this.dataset.getVertices())null==this.vertices[b]&&(this.vertices[b]=new NodeLayout(b,0,0)),this.vertices[b].setCoordinates(d[e].x,d[e].y),e++,this.vertices[b].changed.attach(function(b,c){a.changed.notify(c)})}if("SQUARE"==this.getType()){for(var c=this.dataset._getVerticesCount(),f=.1,g=.9,h=.1,i=Math.sqrt(c),j=(g-f)/i,d=new Array,k=0;i>k;k++)for(var l=0;i>l;l++)x=k*j+f,y=l*j+h,d.push({x:x,y:y});var e=0;for(var b in this.dataset.getVertices())null==this.vertices[b]&&(this.vertices[b]=new NodeLayout(b,0,0)),this.vertices[b].setCoordinates(d[e].x,d[e].y),e++,this.vertices[b].changed.attach(function(b,c){a.changed.notify(c)})}},LayoutDataset.prototype.getNodeById=function(a){return this.vertices[a]},LayoutDataset.prototype.getVerticesByArea=function(a,b,c,d){var e=new Array;for(var f in this.dataset.getVertices())this.vertices[f].x>=a&&this.vertices[f].x<=c&&this.vertices[f].y>=b&&this.vertices[f].y<=d&&e.push(this.vertices[f]);return e},LayoutDataset.prototype.getLayout=function(a){if("CIRCLE"==a)return this.args.type="CIRCLE",void this._calculateLayout();if("SQUARE"==a)return this.args.type="SQUARE",void this._calculateLayout();if("RANDOM"==a)return this.args.type="RANDOM",void this._calculateLayout();var b=this.dataset.toDOTID(),c="http://bioinfo.cipf.es/utils/ws/rest/network/layout/"+a+".coords",d=this;$.ajax({async:!0,type:"POST",url:c,dataType:"text",data:{dot:b},cache:!1,success:function(a){var b=JSON.parse(a);for(var c in b)d.vertices[c].setCoordinates(b[c].x,b[c].y)}})},NodeLayout.prototype.getId=function(a){return this.id},NodeLayout.prototype.setCoordinates=function(a,b){this.x=a,this.y=b,this.changed.notify(this)},NetworkDataSetFormatter.prototype.loadFromJSON=function(a,b){this.args=new Object,this.vertices=new Object,this.args=b,this._setDataset(a);for(var c in b.vertices)this.addVertex(c,b.vertices[c]);for(var d in b.edges)this.addEdge(d,b.edges[d])},NetworkDataSetFormatter.prototype.toJSON=function(){var a=new Object;a=JSON.parse(JSON.stringify(this.args)),a.vertices=new Object,a.edges=new Object;for(var b in this.vertices)a.vertices[b]=this.getVertexById(b).toJSON();for(var c in this.edges)a.edges[c]=this.getEdgeById(c).toJSON();return a},NetworkDataSetFormatter.prototype._getNodeSize=function(a){if(this.isVerticesBalanced()){var b=this.maxClass-this.minClass;0==b&&(b=1);var c=this.dataset.getVertexById(a).getEdges().length;return c*this.args.nodesMaxSize/b+this.args.nodesMinSize}return this.getVertexById(a).getDefault().getSize()},NetworkDataSetFormatter.prototype._recalculateSize=function(){if(this.isVerticesBalanced()){this.maxClass=this.dataset.getMaxClass(),this.minClass=this.dataset.getMinClass();for(var a in this.vertices){var b=this._getNodeSize(a);this.vertices[a].getDefault().setSize(b),this.vertices[a].getSelected().setSize(b),this.vertices[a].getOver().setSize(b)}}},NetworkDataSetFormatter.prototype.addVertex=function(a,b){null==b?this.vertices[a]=new CircleVertexGraphFormatter(a,this.args.vertexFormatProperties.defaultFormat,this.args.vertexFormatProperties.selected,this.args.vertexFormatProperties.over,this.args.vertexFormatProperties.dragging):(null==b.type&&(this.vertices[a]=new CircleVertexGraphFormatter(a,this.args.vertexFormatProperties.defaultFormat,this.args.vertexFormatProperties.selected,this.args.vertexFormatProperties.over,this.args.vertexFormatProperties.dragging)),"SquareVertexGraphFormatter"!=b.type&&"SquareVertexNetworkFormatter"!=b.type||(this.vertices[a]=new SquareVertexGraphFormatter(a),this.vertices[a].loadFromJSON(b)),"CircleVertexGraphFormatter"!=b.type&&"CircleVertexNetworkFormatter"!=b.type||(this.vertices[a]=new CircleVertexGraphFormatter(a),this.vertices[a].loadFromJSON(b)),"EllipseVertexGraphFormatter"!=b.type&&"EllipseVertexNetworkFormatter"!=b.type||(this.vertices[a]=new EllipseVertexGraphFormatter(a),this.vertices[a].loadFromJSON(b)),"RectangleVertexGraphFormatter"!=b.type&&"RectangleVertexNetworkFormatter"!=b.type||(this.vertices[a]=new RectangleVertexGraphFormatter(a),this.vertices[a].loadFromJSON(b)),"RoundedVertexGraphFormatter"!=b.type&&"RoundedVertexNetworkFormatter"!=b.type||(this.vertices[a]=new RoundedVertexGraphFormatter(a),this.vertices[a].loadFromJSON(b)));var c=this;this.vertices[a].stateChanged.attach(function(a,b){c.changed.notify(b)});var d=this._getNodeSize(a);this.vertices[a].defaultFormat.args.size=d,this.vertices[a].selected.args.size=d,this.vertices[a].over.args.size=d},NetworkDataSetFormatter.prototype.addEdge=function(a,b){null==b?this.dataset.getEdgeById(a).getNodeSource().getId()==this.dataset.getEdgeById(a).getNodeTarget().getId()?this.edges[a]=new BezierEdgeGraphFormatter(a,this.args.defaultEdgeProperties.defaultFormat,this.args.defaultEdgeProperties.selected,this.args.defaultEdgeProperties.over,this.args.defaultEdgeProperties.dragging):this.edges[a]=new DirectedLineEdgeGraphFormatter(a,this.args.defaultEdgeProperties.defaultFormat,this.args.defaultEdgeProperties.selected,this.args.defaultEdgeProperties.over,this.args.defaultEdgeProperties.dragging):(null==b.type&&(this.edges[a]=new LineEdgeGraphFormatter(a,this.args.defaultEdgeProperties.defaultFormat,this.args.defaultEdgeProperties.selected,this.args.defaultEdgeProperties.over,this.args.defaultEdgeProperties.dragging)),"LineEdgeGraphFormatter"!=b.type&&"LineEdgeNetworkFormatter"!=b.type||(this.edges[a]=new LineEdgeGraphFormatter(a),this.edges[a].loadFromJSON(b)),"DirectedLineEdgeGraphFormatter"!=b.type&&"DirectedLineEdgeNetworkFormatter"!=b.type||(this.edges[a]=new DirectedLineEdgeGraphFormatter(a),this.edges[a].loadFromJSON(b)),"BezierEdgeGraphFormatter"!=b.type&&"BezierEdgeNetworkFormatter"!=b.type||(this.edges[a]=new BezierEdgeGraphFormatter(a),this.edges[a].loadFromJSON(b)),"CutDirectedLineEdgeGraphFormatter"!=b.type&&"CutDirectedLineEdgeNetworkFormatter"!=b.type||(this.edges[a]=new CutDirectedLineEdgeGraphFormatter(a),this.edges[a].loadFromJSON(b)),"DotDirectedLineEdgeGraphFormatter"!=b.type&&"DotDirectedLineEdgeNetworkFormatter"!=b.type||(this.edges[a]=new DotDirectedLineEdgeGraphFormatter(a),this.edges[a].loadFromJSON(b)),"OdotDirectedLineEdgeGraphFormatter"!=b.type&&"OdotDirectedLineEdgeNetworkFormatter"!=b.type||(this.edges[a]=new OdotDirectedLineEdgeGraphFormatter(a),this.edges[a].loadFromJSON(b)),"OdirectedLineEdgeGraphFormatter"!=b.type&&"OdirectedLineEdgeNetworkFormatter"!=b.type||(this.edges[a]=new OdirectedLineEdgeGraphFormatter(a),this.edges[a].loadFromJSON(b)));var c=this;this.edges[a].stateChanged.attach(function(a,b){c.edgeChanged.notify(b)}),this._recalculateSize()},NetworkDataSetFormatter.prototype._setDataset=function(a){this.dataset=a,this.maxClass=a.getMaxClass(),this.minClass=a.getMinClass(),this._attachDatasetEvents()},NetworkDataSetFormatter.prototype.changeEdgeType=function(a,b){"LineEdgeGraphFormatter"!=b&&"LineEdgeNetworkFormatter"!=b||(this.edges[a]=new LineEdgeGraphFormatter(a,this.args.defaultEdgeProperties.defaultFormat,this.args.defaultEdgeProperties.selected,this.args.defaultEdgeProperties.over,this.args.defaultEdgeProperties.dragging)),"DirectedLineEdgeGraphFormatter"!=b&&"DirectedLineEdgeNetworkFormatter"!=b||(this.edges[a]=new DirectedLineEdgeGraphFormatter(a,this.args.defaultEdgeProperties.defaultFormat,this.args.defaultEdgeProperties.selected,this.args.defaultEdgeProperties.over,this.args.defaultEdgeProperties.dragging)),"CutDirectedLineEdgeGraphFormatter"!=b&&"CutDirectedLineEdgeNetworkFormatter"!=b||(this.edges[a]=new CutDirectedLineEdgeGraphFormatter(a,this.args.defaultEdgeProperties.defaultFormat,this.args.defaultEdgeProperties.selected,this.args.defaultEdgeProperties.over,this.args.defaultEdgeProperties.dragging)),"DotDirectedLineEdgeGraphFormatter"!=b&&"DotDirectedLineEdgeNetworkFormatter"!=b||(this.edges[a]=new DotDirectedLineEdgeGraphFormatter(a,this.args.defaultEdgeProperties.defaultFormat,this.args.defaultEdgeProperties.selected,this.args.defaultEdgeProperties.over,this.args.defaultEdgeProperties.dragging)),"OdotDirectedLineEdgeGraphFormatter"!=b&&"OdotDirectedLineEdgeNetworkFormatter"!=b||(this.edges[a]=new OdotDirectedLineEdgeGraphFormatter(a,this.args.defaultEdgeProperties.defaultFormat,this.args.defaultEdgeProperties.selected,this.args.defaultEdgeProperties.over,this.args.defaultEdgeProperties.dragging)),"OdirectedLineEdgeGraphFormatter"!=b&&"OdirectedLineEdgeNetworkFormatter"!=b||(this.edges[a]=new OdirectedLineEdgeGraphFormatter(a,this.args.defaultEdgeProperties.defaultFormat,this.args.defaultEdgeProperties.selected,this.args.defaultEdgeProperties.over,this.args.defaultEdgeProperties.dragging));var c=this;this.edges[a].stateChanged.attach(function(a,b){c.edgeChanged.notify(b)}),c.edgeChanged.notify(this.edges[a])},NetworkDataSetFormatter.prototype.changeNodeType=function(a,b){var c=JSON.parse(JSON.stringify(this.vertices[a].getDefault())),c=(JSON.parse(JSON.stringify(this.vertices[a].getSelected())),JSON.parse(JSON.stringify(this.vertices[a].getDefault()))),c=JSON.parse(JSON.stringify(this.vertices[a].getDefault()));"SquareVertexGraphFormatter"!=b&&"SquareVertexNetworkFormatter"!=b||(this.vertices[a]=new SquareVertexGraphFormatter(a,c,this.args.vertexFormatProperties.selected,this.args.vertexFormatProperties.over,this.args.vertexFormatProperties.dragging)),"CircleVertexGraphFormatter"!=b&&"CircleVertexNetworkFormatter"!=b||(this.vertices[a]=new CircleVertexGraphFormatter(a,c,this.args.vertexFormatProperties.selected,this.args.vertexFormatProperties.over,this.args.vertexFormatProperties.dragging)),"EllipseVertexGraphFormatter"!=b&&"EllipseVertexNetworkFormatter"!=b||(this.vertices[a]=new EllipseVertexGraphFormatter(a,c,this.args.vertexFormatProperties.selected,this.args.vertexFormatProperties.over,this.args.vertexFormatProperties.dragging)),"RectangleVertexGraphFormatter"!=b&&"RectangleVertexNetworkFormatter"!=b||(this.vertices[a]=new RectangleVertexGraphFormatter(a,c,this.args.vertexFormatProperties.selected,this.args.vertexFormatProperties.over,this.args.vertexFormatProperties.dragging)),"RoundedVertexGraphFormatter"!=b&&"RoundedVertexNetworkFormatter"!=b||(this.vertices[a]=new RoundedVertexGraphFormatter(a,c,this.args.vertexFormatProperties.selected,this.args.vertexFormatProperties.over,this.args.vertexFormatProperties.dragging)),"OctagonVertexGraphFormatter"!=b&&"OctagonVertexNetworkhFormatter"!=b||(this.vertices[a]=new OctagonVertexGraphFormatter(a,c,this.args.vertexFormatProperties.selected,this.args.vertexFormatProperties.over,this.args.vertexFormatProperties.dragging));var d=this;this.vertices[a].stateChanged.attach(function(a,b){d.changed.notify(b)}),d.changed.notify(this.vertices[a])},NetworkDataSetFormatter.prototype.dataBind=function(a){this._setDataset(a);for(var b in this.dataset.getVertices())this.addVertex(b);for(var c in this.dataset.getEdges())this.addEdge(c)},NetworkDataSetFormatter.prototype._removeEdge=function(a){delete this.edges[a]},NetworkDataSetFormatter.prototype._removeVertex=function(a){delete this.vertices[a]},NetworkDataSetFormatter.prototype._attachDatasetEvents=function(a){var b=this;this.dataset.vertexDeleted.attach(function(a,c){b._removeVertex(c.getId())}),this.dataset.edgeDeleted.attach(function(a,c){b._removeEdge(c.getId())}),this.dataset.newVertex.attach(function(a,c){b.addVertex(c.getId())}),this.dataset.newEdge.attach(function(a,c){b.addEdge(c.getId())})},NetworkDataSetFormatter.prototype.getVertexById=function(a){return this.vertices[a]},NetworkDataSetFormatter.prototype.getEdgeById=function(a){return this.edges[a]},NetworkDataSetFormatter.prototype.makeLabelsBigger=function(){for(var a in this.vertices){var b=this.vertices[a].getDefault().getFontSize()+2;this.vertices[a].getDefault().setFontSize(b)}},NetworkDataSetFormatter.prototype.makeLabelsSmaller=function(){for(var a in this.vertices){var b=this.vertices[a].getDefault().getFontSize()-2;this.vertices[a].getDefault().setFontSize(b)}},NetworkDataSetFormatter.prototype.resize=function(a,b){this.args.width=a,this.args.height=b,this.resized.notify()},NetworkDataSetFormatter.prototype.getZoomScaleStepFactor=function(){return this.args.zoomScaleStepFactor},NetworkDataSetFormatter.prototype.setZoomScaleStepFactor=function(a){this.args.zoomScaleStepFactor=a},NetworkDataSetFormatter.prototype.getZoomScale=function(){return this.args.zoomScale},NetworkDataSetFormatter.prototype.setZoomScale=function(a){this.args.zoomScale=a},NetworkDataSetFormatter.prototype.getNodesMaxSize=function(){return this.args.nodesMaxSize},NetworkDataSetFormatter.prototype.getNodesMinSize=function(){return this.args.nodesMinSize},NetworkDataSetFormatter.prototype.isVerticesBalanced=function(){return this.args.balanceNodes},NetworkDataSetFormatter.prototype.getWidth=function(){return this.args.width},NetworkDataSetFormatter.prototype.getHeight=function(){return this.args.height},NetworkDataSetFormatter.prototype.getBackgroundImage=function(){return this.args.backgroundImage},NetworkDataSetFormatter.prototype.setBackgroundImage=function(a){this.args.backgroundImage=a,this.backgroundImageChanged.notify(this)},NetworkDataSetFormatter.prototype.getBackgroundImageWidth=function(){return this.args.backgroundImageWidth},NetworkDataSetFormatter.prototype.setBackgroundImageWidth=function(a){this.args.backgroundImageWidth=a,this.backgroundImageChanged.notify(this)},NetworkDataSetFormatter.prototype.getBackgroundImageHeight=function(){return this.args.backgroundImageHeight},NetworkDataSetFormatter.prototype.setBackgroundImageHeight=function(a){this.args.backgroundImageHeight=a,this.backgroundImageChanged.notify(this)},NetworkDataSetFormatter.prototype.getBackgroundImageX=function(){return this.args.backgroundImageX},NetworkDataSetFormatter.prototype.setBackgroundImageX=function(a){this.args.backgroundImageX=a,this.backgroundImageChanged.notify(this)},NetworkDataSetFormatter.prototype.getBackgroundImageY=function(){return this.args.backgroundImageX},NetworkDataSetFormatter.prototype.setBackgroundImageY=function(a){this.args.backgroundImageY=a,this.backgroundImageChanged.notify(this)},NetworkDataSetFormatter.prototype.getBackgroundColor=function(){return this.args.backgroundColor},NetworkDataSetFormatter.prototype.setBackgroundColor=function(a){this.args.backgroundColor=a,this.backgroundColorChanged.notify(this)},NetworkDataSetFormatter.prototype.getWidth=function(){return this.args.width},NetworkDataSetFormatter.prototype.setWidth=function(a){this.args.width=a},NetworkDataSetFormatter.prototype.getHeight=function(){return this.args.height},NetworkDataSetFormatter.prototype.setHeight=function(a){this.args.height=a},NetworkWidget.prototype.draw=function(a,b,c){this.graphCanvas=new GraphCanvas(this.id,document.getElementById(this.targetId),{labeled:this.label,multipleSelectionEnabled:!1,draggingCanvasEnabled:!1}),this.graphCanvas.draw(a,b,c);var d=this;this.graphCanvas.onVertexOver.attach(function(a,b){
d.onVertexOver.notify(b)}),this.graphCanvas.onVertexOut.attach(function(a,b){d.onVertexOut.notify(b)})},NetworkWidget.prototype.selectVertexByName=function(a){var b=this.getDataset().getVertexByName(a);if(null!=b)for(var c in b)if(b.hasOwnProperty(c)){var d=b[c].getId();this.selectVertexById(d)}},NetworkWidget.prototype.selectVerticesByName=function(a){for(var b=0;b<a.length;b++)this.selectVertexByName(a[b])},NetworkWidget.prototype.selectVertexById=function(a){this.graphCanvas.selectNode(a),this.blinkVertexById(a)},NetworkWidget.prototype.selectVerticesById=function(a){for(var b=0;b<a.length;b++)this.selectVertexById(a[b])},NetworkWidget.prototype.selectNeighbourhood=function(){this.selectEdgesFromVertices(),this.selectAdjacent()},NetworkWidget.prototype.deselectNodes=function(){this.graphCanvas.deselectNodes()},NetworkWidget.prototype.selectAllNodes=function(){this.getGraphCanvas().selectAllNodes()},NetworkWidget.prototype.selectAll=function(){this.getGraphCanvas().selectAll()},NetworkWidget.prototype.selectAllEdges=function(){this.getGraphCanvas().selectAllEdges()},NetworkWidget.prototype.setScale=function(a){this.graphCanvas.setScale(a)},NetworkWidget.prototype.getScale=function(){return this.graphCanvas.getScale(value)},NetworkWidget.prototype.selectAdjacent=function(){for(var a=this.getGraphCanvas().getSelectedVertices(),b=[],c=0;c<a.length;c++)b=b.concat(this.getGraphCanvas().getDataset().getVertexById(a[c]).getEdges());var d=[];for(c=0;c<b.length;c++)d.push(b[c].getNodeSource().getId()),d.push(b[c].getNodeTarget().getId());this.selectVerticesById(d)},NetworkWidget.prototype.selectEdgesFromVertices=function(){for(var a=this.getGraphCanvas().getSelectedVertices(),b=[],c=0;c<a.length;c++)b=b.concat(this.getGraphCanvas().getDataset().getVertexById(a[c]).getEdges());var d=[];for(c=0;c<b.length;c++)d.push(b[c].getId());this.getGraphCanvas().selectEdges(d)},NetworkWidget.prototype.blinkVertexById=function(a){this.graphCanvas.blinkVertexById(a)},NetworkWidget.prototype.selectConnectedComponent=function(){var a=this.getConnectedComponent();this.selectVerticesById(a.nodes),this.graphCanvas.selectEdges(a.edges)},NetworkWidget.prototype.getConnectedComponent=function(){for(var a={},b={},c=[],d=[],e=this.getGraphCanvas().getSelectedVertices(),f=0;f<e.length;f++)this.visitNode(e[f],a,b,c,d);return{nodes:c,edges:d}},NetworkWidget.prototype.visitNode=function(a,b,c,d,e){b[a]=!0,d.push(a);for(var f=this.getDataset().getVertexById(a).getEdges(),g=0;g<f.length;g++){var h=f[g],i=h.getId();if(null==c[i]){c[i]=!0,e.push(i);var j=h.getNodeTarget().getId();null==b[j]&&this.visitNode(j,b,c,d,e);var k=h.getNodeSource().getId();null==b[k]&&this.visitNode(k,b,c,d,e)}}},NetworkWidget.prototype.collapse=function(){for(var a=this.getGraphCanvas().getSelectedVertices(),b=-(1/0),c=1/0,d=-(1/0),e=1/0,f=0;f<a.length;f++){var g=this.getGraphCanvas().getLayout().getNodeById(a[f]);b<g.x&&(b=g.x),c>g.x&&(c=g.x),d<g.y&&(d=g.y),e>g.y&&(e=g.y)}var h=b-c,i=d-e,j=(c-b)/4,k=a.length,l=[];for(f=0;f<a.length;f++)x=h+j*Math.sin(2*f*Math.PI/k),y=i+j*Math.cos(2*f*Math.PI/k),l.push({x:x,y:y});for(f=0;f<a.length;f++)this.getGraphCanvas().getLayout().getNodeById(a[f]).setCoordinates(l[f].x,l[f].y)},NetworkWidget.prototype.setVerticesFontSize=function(a){for(var b in this.getDataset().getVertices())this.getDataset().getVertices().hasOwnProperty(b)&&this.getFormatter().getVertexById(b).getDefault().setFontSize(a)},NetworkWidget.prototype.getFormatter=function(){return this.getGraphCanvas().getFormatter()},NetworkWidget.prototype.getLayout=function(){return this.getGraphCanvas().getLayout()},NetworkWidget.prototype.getDataset=function(){return this.getGraphCanvas().getDataset()},NetworkWidget.prototype.getGraphCanvas=function(){return this.graphCanvas};var SVG={svgns:"http://www.w3.org/2000/svg",xlinkns:"http://www.w3.org/1999/xlink",createSVGCanvas:function(a,b){b.push(["xmlns",SVG.svgns],["xmlns:xlink","http://www.w3.org/1999/xlink"]);var c=document.createElementNS("http://www.w3.org/2000/svg","svg");return this._setProperties(c,b),a.appendChild(c),c},createRectangle:function(a,b,c,d,e){var f=document.createElementNS(this.svgns,"rect");return f.setAttribute("x",a),f.setAttribute("y",b),f.setAttribute("width",c),f.setAttribute("height",d),SVG._setProperties(f,e),f},drawImage64:function(a,b,c,d,e,f,g){var h=SVG.createImage64(a,b,c,d,e,g);return f.appendChild(h),h},createImage64:function(a,b,c,d,e,f){var g=document.createElementNS(this.svgns,"image");return g.setAttribute("x",a),g.setAttribute("y",b),g.setAttribute("width",c),g.setAttribute("height",d),g.setAttribute("xlink:href",e),SVG._setProperties(g,f),g},createLine:function(a,b,c,d,e){var f=document.createElementNS(this.svgns,"line");return f.setAttribute("x1",a),f.setAttribute("y1",b),f.setAttribute("x2",c),f.setAttribute("y2",d),SVG._setProperties(f,e),f},createClip:function(a,b,c){var d=document.createElementNS(this.svgns,"clipPath");return d.setAttribute("id",a),d.appendChild(b),d},drawClip:function(a,b,c){var d=SVG.createClip(a,b);return c.appendChild(d),d},drawRectangle:function(a,b,c,d,e,f){try{var g=SVG.createRectangle(a,b,c,d,f);e.appendChild(g)}catch(h){console.log("-------------------- "),console.log("Error on drawRectangle "+h),console.log(f),console.log("-------------------- ")}return g},createEllipse:function(a,b,c,d,e){var f=document.createElementNS(this.svgns,"ellipse");return f.setAttribute("cx",a),f.setAttribute("cy",b),f.setAttribute("rx",c),f.setAttribute("ry",d),SVG._setProperties(f,e),f},drawEllipse:function(a,b,c,d,e,f){var g=SVG.createEllipse(a,b,c,d,f);return e.appendChild(g),g},drawImage:function(a,b,c,d){var e=document.createElementNS(this.svgns,"image");e.setAttribute("x",a),e.setAttribute("y",b),c.appendChild(e),SVG._setProperties(e,d)},drawLine:function(a,b,c,d,e,f){try{var g=SVG.createLine(a,b,c,d,f);e.appendChild(g)}catch(h){}return g},drawPath:function(a,b,c){var d=SVG.createPath(a,c);return b.appendChild(d),d},createPoligon:function(a,b){var c=document.createElementNS(this.svgns,"polygon");return c.setAttribute("points",a),SVG._setProperties(c,b),c},drawPoligon:function(a,b,c){var d=SVG.createPoligon(a,c);return b.appendChild(d),d},createPath:function(a,b){var c=document.createElementNS(this.svgns,"path");return c.setAttribute("d",a),SVG._setProperties(c,b),c},drawCircle:function(a,b,c,d,e){var f=document.createElementNS(this.svgns,"circle");return f.setAttribute("cx",a),f.setAttribute("cy",b),f.setAttribute("r",c),d.appendChild(f),e.cursor="pointer",this._setProperties(f,e),f},_setProperties:function(a,b){if(b instanceof Array)for(var c=0;c<b.length;c++)a.setAttribute(b[c][0],b[c][1]);else for(var d in b)a.setAttribute(d,b[d])},createText:function(a,b,c,d){var e=document.createElementNS(this.svgns,"text");e.setAttributeNS(null,"x",a),e.setAttributeNS(null,"y",b);var f=document.createTextNode(c);return e.appendChild(f),this._setProperties(e,d),e},drawText:function(a,b,c,d,e){var c=SVG.createText(a,b,c,e);return d.appendChild(c),c},drawGroup:function(a,b){var c=SVG.createGroup(b);return a.appendChild(c),c},createGroup:function(a){var b=document.createElementNS(this.svgns,"g");return this._setProperties(b,a),b}},CanvasToSVG={convert:function(a,b,c,d,e,f){for(var g=this._convert(a,b,c,d,e),h=0;h<f.length;h++)g.setAttribute(f[h][0],f[h][1])},_convert:function(a,b,c,d,e){var f="http://www.w3.org/2000/svg",g="http://www.w3.org/1999/xlink",h=a.toDataURL(),i=document.createElementNS(f,"image");return i.setAttribute("id",e),i.setAttributeNS(g,"xlink:href",h),i.setAttribute("x",c?c:0),i.setAttribute("y",d?d:0),i.setAttribute("width",a.width),i.setAttribute("height",a.height),i.imageData=h,b.appendChild(i),i},importSVG:function(a,b){svg_xml=a;var c=b.getContext("2d"),d=new Image;d.src="data:image/svg+xml;base64,"+btoa(svg_xml),c.drawImage(d,0,0)}};Vertex.prototype.getName=GraphItem.prototype.getName,Vertex.prototype.setName=GraphItem.prototype.setName,Vertex.prototype.getId=GraphItem.prototype.getId,Vertex.prototype.getEdges=function(){return this.edgesIn.concat(this.edgesOut)},Vertex.prototype.getEdgesCount=function(){return this.getEdges().length},Vertex.prototype.getEdgesIn=function(){return this.edgesIn},Vertex.prototype.getEdgesOut=function(){return this.edgesOut},Vertex.prototype.addEdge=function(a){a.getNodeSource().getId()==this.id?this.edgesIn.push(a):this.edgesOut.push(a)},Vertex.prototype.removeEdge=function(a){for(var b=0;b<this.getEdgesIn().length;b++){var c=this.edgesIn[b];c.getId()==a.getId()&&this.edgesIn.splice(b,1)}for(var b=0;b<this.getEdgesOut().length;b++){var c=this.edgesOut[b];c.getId()==a.getId()&&this.edgesOut.splice(b,1)}},Vertex.prototype.remove=function(){for(var a=this.getEdges(),b=0;b<a.length;b++){var c=a[b];c.remove()}this.deleted.notify(this)},VertexGraphFormatter.prototype.getDefault=ItemGraphFormatter.prototype.getDefault,VertexGraphFormatter.prototype.getSelected=ItemGraphFormatter.prototype.getSelected,VertexGraphFormatter.prototype.getOver=ItemGraphFormatter.prototype.getOver,VertexGraphFormatter.prototype.getDragging=ItemGraphFormatter.prototype.getDragging,VertexGraphFormatter.prototype.getId=ItemGraphFormatter.prototype.getId,VertexGraphFormatter.prototype.toJSON=ItemGraphFormatter.prototype.toJSON,VertexGraphFormatter.prototype.loadFromJSON=ItemGraphFormatter.prototype.loadFromJSON,VertexGraphFormatter.prototype._setEvents=ItemGraphFormatter.prototype._setEvents,CircleVertexGraphFormatter.prototype.getDefault=VertexGraphFormatter.prototype.getDefault,CircleVertexGraphFormatter.prototype.getSelected=VertexGraphFormatter.prototype.getSelected,CircleVertexGraphFormatter.prototype.getOver=VertexGraphFormatter.prototype.getOver,CircleVertexGraphFormatter.prototype.getDragging=VertexGraphFormatter.prototype.getDragging,CircleVertexGraphFormatter.prototype.getId=VertexGraphFormatter.prototype.getId,CircleVertexGraphFormatter.prototype.toJSON=VertexGraphFormatter.prototype.toJSON,CircleVertexGraphFormatter.prototype.loadFromJSON=VertexGraphFormatter.prototype.loadFromJSON,CircleVertexGraphFormatter.prototype._setEvents=VertexGraphFormatter.prototype._setEvents,SquareVertexGraphFormatter.prototype.getDefault=VertexGraphFormatter.prototype.getDefault,SquareVertexGraphFormatter.prototype.getSelected=VertexGraphFormatter.prototype.getSelected,SquareVertexGraphFormatter.prototype.getOver=VertexGraphFormatter.prototype.getOver,SquareVertexGraphFormatter.prototype.getDragging=VertexGraphFormatter.prototype.getDragging,SquareVertexGraphFormatter.prototype.getId=VertexGraphFormatter.prototype.getId,SquareVertexGraphFormatter.prototype.toJSON=VertexGraphFormatter.prototype.toJSON,SquareVertexGraphFormatter.prototype.loadFromJSON=VertexGraphFormatter.prototype.loadFromJSON,SquareVertexGraphFormatter.prototype._setEvents=VertexGraphFormatter.prototype._setEvents,EllipseVertexGraphFormatter.prototype.getDefault=VertexGraphFormatter.prototype.getDefault,EllipseVertexGraphFormatter.prototype.getSelected=VertexGraphFormatter.prototype.getSelected,EllipseVertexGraphFormatter.prototype.getOver=VertexGraphFormatter.prototype.getOver,EllipseVertexGraphFormatter.prototype.getDragging=VertexGraphFormatter.prototype.getDragging,EllipseVertexGraphFormatter.prototype.getId=VertexGraphFormatter.prototype.getId,EllipseVertexGraphFormatter.prototype.toJSON=VertexGraphFormatter.prototype.toJSON,EllipseVertexGraphFormatter.prototype.loadFromJSON=VertexGraphFormatter.prototype.loadFromJSON,EllipseVertexGraphFormatter.prototype._setEvents=VertexGraphFormatter.prototype._setEvents,RectangleVertexGraphFormatter.prototype.getDefault=ItemGraphFormatter.prototype.getDefault,RectangleVertexGraphFormatter.prototype.getSelected=ItemGraphFormatter.prototype.getSelected,RectangleVertexGraphFormatter.prototype.getOver=ItemGraphFormatter.prototype.getOver,RectangleVertexGraphFormatter.prototype.getDragging=ItemGraphFormatter.prototype.getDragging,RectangleVertexGraphFormatter.prototype.getId=ItemGraphFormatter.prototype.getId,RectangleVertexGraphFormatter.prototype.toJSON=ItemGraphFormatter.prototype.toJSON,RectangleVertexGraphFormatter.prototype.loadFromJSON=ItemGraphFormatter.prototype.loadFromJSON,RectangleVertexGraphFormatter.prototype._setEvents=ItemGraphFormatter.prototype._setEvents,RoundedVertexGraphFormatter.prototype.getDefault=ItemGraphFormatter.prototype.getDefault,RoundedVertexGraphFormatter.prototype.getSelected=ItemGraphFormatter.prototype.getSelected,RoundedVertexGraphFormatter.prototype.getOver=ItemGraphFormatter.prototype.getOver,RoundedVertexGraphFormatter.prototype.getDragging=ItemGraphFormatter.prototype.getDragging,RoundedVertexGraphFormatter.prototype.getId=ItemGraphFormatter.prototype.getId,RoundedVertexGraphFormatter.prototype.toJSON=ItemGraphFormatter.prototype.toJSON,RoundedVertexGraphFormatter.prototype.loadFromJSON=ItemGraphFormatter.prototype.loadFromJSON,RoundedVertexGraphFormatter.prototype._setEvents=ItemGraphFormatter.prototype._setEvents,OctagonVertexGraphFormatter.prototype.getDefault=ItemGraphFormatter.prototype.getDefault,OctagonVertexGraphFormatter.prototype.getSelected=ItemGraphFormatter.prototype.getSelected,OctagonVertexGraphFormatter.prototype.getOver=ItemGraphFormatter.prototype.getOver,OctagonVertexGraphFormatter.prototype.getDragging=ItemGraphFormatter.prototype.getDragging,OctagonVertexGraphFormatter.prototype.getId=ItemGraphFormatter.prototype.getId,OctagonVertexGraphFormatter.prototype.toJSON=ItemGraphFormatter.prototype.toJSON,OctagonVertexGraphFormatter.prototype.loadFromJSON=ItemGraphFormatter.prototype.loadFromJSON,OctagonVertexGraphFormatter.prototype._setEvents=ItemGraphFormatter.prototype._setEvents,PDBViewer.prototype.getTitle=function(){return"<div style='width:"+this.width+"px; height:20px; font-weight:bold;background-color: #E6E6E6;color:black'>"+this.title+"</div>"},PDBViewer.prototype.getTextAreaId=function(){return this.id+"_src"},PDBViewer.prototype.getCanvas=function(){var a="width:"+this.width+"px; height: "+this.height+"px;display: none;",b="<textarea id='"+this.getTextAreaId()+"'; style='"+a+"' ></textarea>",c="width: "+this.width+"px; height: "+this.height+"px; background-color: black;";return b+"<div id='"+this.id+"'; style='"+c+"' ></div>"},PDBViewer.prototype.getDownload=function(a,b){var c=BUI.getPdbURL()+"&type="+a+"&abInitioModelId="+b;return html="<a href="+c+' style="color:blue;font-weight:bold;"  height="80" width="80" >Download</a><br /><br />',"<div style='width:"+this.width+"px; height:20px; font-weight:bold;background-color: #336699;color:white'>"+html+"</div>"},PDBViewer.prototype.getBar=function(){return"<div style='width:"+this.width+"px; height:20px; font-weight:bold;background-color: #336699;color:white'></div>"},PDBViewer.prototype.refresh=function(a){var b=this;if(BUI.isWebGLEnabled()){this.models=a,b.panel.setLoading("Rendering");var c=function(a,c){null!=c.models&&null!=c.models[0]&&(document.getElementById(b.getTextAreaId()).innerHTML=c.models[0].XYZ,null==b.glMol?b.glMol=new GLmol(b.id):b.glMol.loadMolecule()),b.panel.setLoading(!1)};EXI.getDataAdapter({onSuccess:c}).saxs.model.getPDB(a,[])}else this.webGLNotAvailable()},PDBViewer.prototype.getOpacity=function(a){return"Invisible"==a?"0":"Minimum"==a?"0.2":"Medium"==a?"0.5":"High"==a?"0.7":"1"},PDBViewer.prototype.getMenu=function(a){function b(b,d,e){if(d){var f=null;if("Opacity"==b.group)for(f=0;f<c.models.length;f++){var g=c.getOpacity(b.text);a.opacity=g}if("Radius"==b.group)for(f=0;f<c.models.length;f++){var h=c.getOpacity(b.text);a.radius=h}c.refresh(c.models)}}var c=this;return Ext.create("Ext.menu.Menu",{items:[{text:"Opacity",menu:{items:[{text:"Invisible",checked:!1,group:"Opacity",checkHandler:b},{text:"Minimum",checked:!1,group:"Opacity",checkHandler:b},{text:"Medium",checked:!1,group:"Opacity",checkHandler:b},{text:"High",checked:!1,group:"Opacity",checkHandler:b},{text:"Opaque",checked:!1,group:"Opacity",checkHandler:b}]}}]})},PDBViewer.prototype.getTbar=function(){for(var a=this,b=Ext.create("Ext.toolbar.Toolbar"),c=[],d=0;d<this.models.length;d++){b.add({text:this.models[d].title,menu:this.getMenu(this.models[d])});var e="#"+this.models[d].color.replace("0x","");c.push({html:"<table><tr><td width='15px'>"+BUI.getRectangleColorDIV(e,10,10)+"</td><td>"+this.models[d].title+"</td></table>"})}return b.add({xtype:"numberfield",labelWidth:50,width:120,fieldLabel:"Radius",value:3,maxValue:10,step:.2,minValue:.1,listeners:{change:function(b){for(var c=b.getValue(),d=0;d<a.models.length;d++)a.models[d].radius=c;a.refresh(a.models)}}}),b.add("->"),b.add(c),b},PDBViewer.prototype.getPanel=function(){return this.panel=Ext.create("Ext.panel.Panel",{margin:this.margin,border:0,layout:{type:"vbox"},width:this.width-4,height:this.height+30,items:[{html:this.getCanvas()}],listeners:{afterRender:function(){}}}),this.panel.setLoading("Rendering"),this.panel},PDBViewer.prototype.webGLNotAvailable=function(){document.getElementById(_this.id).innerHTML=BUI.getWarningHTML("Your browser doesn't support WebGL"),document.getElementById(_this.id).innerHTML=document.getElementById(_this.id).innerHTML+"<br />",document.getElementById(_this.id).innerHTML=document.getElementById(_this.id).innerHTML+BUI.getTipHTML("<a href='http://www.browserleaks.com/webgl#howto-enable-disable-webgl'>How to enable WebGL</a>"),document.getElementById(_this.id).innerHTML=document.getElementById(_this.id).innerHTML+"<br />",document.getElementById(_this.id).innerHTML=document.getElementById(_this.id).innerHTML+BUI.getTipHTML("<a href='http://caniuse.com/webgl'>Can I use WebGL?</a>")},PDBViewer.prototype.draw=function(a){this.models=a;var b=this;return this.panel=Ext.create("Ext.panel.Panel",{margin:2,layout:{type:"vbox"},tbar:this.getTbar(),width:this.width-4,height:this.height+30,items:[{html:this.getCanvas()}],listeners:{afterRender:function(){b.refresh(a)}}}),this.panel.setLoading("Rendering"),this.panel},SuperpositionPDBViewer.prototype.draw=PDBViewer.prototype.draw,SuperpositionPDBViewer.prototype.getBar=PDBViewer.prototype.getBar,SuperpositionPDBViewer.prototype.getCanvas=PDBViewer.prototype.getCanvas,SuperpositionPDBViewer.prototype.getDownload=PDBViewer.prototype.getDownload,SuperpositionPDBViewer.prototype.getMenu=PDBViewer.prototype.getMenu,SuperpositionPDBViewer.prototype.getOpacity=PDBViewer.prototype.getOpacity,SuperpositionPDBViewer.prototype.getPanel=PDBViewer.prototype.getPanel,SuperpositionPDBViewer.prototype.getTbar=PDBViewer.prototype.getTbar,SuperpositionPDBViewer.prototype.getTextAreaId=PDBViewer.prototype.getTextAreaId,SuperpositionPDBViewer.prototype.getTitle=PDBViewer.prototype.getTitle,SuperpositionPDBViewer.prototype.refresh=PDBViewer.prototype.refresh,SuperpositionPDBViewer.prototype.webGLNotAvailable=PDBViewer.prototype.webGLNotAvailable,SuperpositionPDBViewer.prototype.refresh=function(a){var b=this;if(BUI.isWebGLEnabled()){this.models=a;var c=new BiosaxsDataAdapter;b.panel.setLoading("Rendering"),c.onSuccess.attach(function(a,c){document.getElementById(b.getTextAreaId()).innerHTML=c.XYZ,null==b.glMol?b.glMol=new GLmol(b.id):b.glMol.loadMolecule(),b.panel.setLoading(!1)}),c.onError.attach(function(a,c){b.panel.setLoading("Not available")}),c.getAbinitioPDBContentBySuperpositionList(a)}else this.webGLNotAvailable()},AlignedSuperpositionPDBViewer.prototype.draw=PDBViewer.prototype.draw,AlignedSuperpositionPDBViewer.prototype.getBar=PDBViewer.prototype.getBar,AlignedSuperpositionPDBViewer.prototype.getCanvas=PDBViewer.prototype.getCanvas,AlignedSuperpositionPDBViewer.prototype.getDownload=PDBViewer.prototype.getDownload,AlignedSuperpositionPDBViewer.prototype.getMenu=PDBViewer.prototype.getMenu,AlignedSuperpositionPDBViewer.prototype.getOpacity=PDBViewer.prototype.getOpacity,AlignedSuperpositionPDBViewer.prototype.getPanel=PDBViewer.prototype.getPanel,AlignedSuperpositionPDBViewer.prototype.getTbar=PDBViewer.prototype.getTbar,AlignedSuperpositionPDBViewer.prototype.getTextAreaId=PDBViewer.prototype.getTextAreaId,AlignedSuperpositionPDBViewer.prototype.getTitle=PDBViewer.prototype.getTitle,AlignedSuperpositionPDBViewer.prototype.refresh=PDBViewer.prototype.refresh,AlignedSuperpositionPDBViewer.prototype.webGLNotAvailable=PDBViewer.prototype.webGLNotAvailable,AlignedSuperpositionPDBViewer.prototype.refresh=function(a){var b=this;if(BUI.isWebGLEnabled()){this.models=a,b.panel.setLoading("Rendering PDB");var c=new BiosaxsDataAdapter;c.onError.attach(function(a,b){console.log(a)}),c.onSuccess.attach(function(c,d){var e=d.superpositions[0][a[0]];document.getElementById(b.id).innerHTML="",b.glMol=new GLmol(b.id,!1,!1,e.apriori.data),b.glMol.addSuperpositionXYZ(e.aligned.XYZ,"0xFFFFFF",.3,1);var f=b.glMol.getView();b.glMol.setView(f),b.panel.setLoading(!1)}),null!=a&&0!=a.length&&c.getDataPDB([],a)}else this.webGLNotAvailable()},StructurePDBViewer.prototype.draw=PDBViewer.prototype.draw,StructurePDBViewer.prototype.getBar=PDBViewer.prototype.getBar,StructurePDBViewer.prototype.getCanvas=PDBViewer.prototype.getCanvas,StructurePDBViewer.prototype.getDownload=PDBViewer.prototype.getDownload,StructurePDBViewer.prototype.getMenu=PDBViewer.prototype.getMenu,StructurePDBViewer.prototype.getOpacity=PDBViewer.prototype.getOpacity,StructurePDBViewer.prototype.getPanel=PDBViewer.prototype.getPanel,StructurePDBViewer.prototype.getTbar=PDBViewer.prototype.getTbar,StructurePDBViewer.prototype.getTextAreaId=PDBViewer.prototype.getTextAreaId,StructurePDBViewer.prototype.getTitle=PDBViewer.prototype.getTitle,StructurePDBViewer.prototype.refresh=PDBViewer.prototype.refresh,StructurePDBViewer.prototype.webGLNotAvailable=PDBViewer.prototype.webGLNotAvailable,StructurePDBViewer.prototype.refresh=function(a){var b=this;if(BUI.isWebGLEnabled()){this.models=a,b.panel.setLoading("Rendering");var c=new BiosaxsDataAdapter;c.onSuccess.attach(function(a,c){document.getElementById(b.getTextAreaId()).innerHTML=c;new GLmol(b.id);b.panel.setLoading(!1)}),c.onError.attach(function(a,c){b.panel.setLoading("Not available")}),c.getDataPDB(models,[])}else this.webGLNotAvailable()},QueueGrid.prototype.getSorters=function(){return{}},QueueGrid.prototype.getSelected=function(){return this.selected},QueueGrid.prototype.getSelectedData=function(){for(var a=this.panel.getSelectionModel().selected.items,b=[],c=0;c<a.length;c++)b.push(a[c].data);return b},QueueGrid.prototype.getFields=function(){return["experimentId","subtractionId","macromoleculeAcronym","priorityLevelId","code","exposureTemperature","concentration"]},QueueGrid.prototype.getRunHTML=function(a){var b=a.data.dataCollectionId,c=document.createElement("table");if(null!=this.key[b]){this.key[b].sort(function(a,b){return b.measurementId-a.measurementId});for(i in this.key[b]){var d=this.key[b][i],e=document.createElement("tr"),f=document.createElement("td");null!=d.measurementCode?null==d.macromoleculeId?(f.setAttribute("style","padding-top:1px;width:130px;color:gray;"),f.appendChild(document.createTextNode("# "+d.measurementCode))):(f.setAttribute("style","padding-top:1px;width:130px;font-weight:bold;"),f.appendChild(document.createTextNode("# "+d.measurementCode))):f.appendChild(document.createTextNode(" - ")),e.appendChild(f),c.appendChild(e)}}return"<table>"+c.innerHTML+"</table>"},QueueGrid.prototype.getPercentage=function(a,b){var c=document.createElement("td"),d="green";return null==a&&(a="NA",d="orange"),null==b&&(b="NA",d="orange"),"NA"!=a&"NA"!=b&&(a/b>=.3&&(d="orange"),a/b>.7&&(d="#BCF5A9"),.3>a/b&&(d="red")),c.appendChild(document.createTextNode(a+" / "+b)),c.setAttribute("style","background-color:"+d+";"),c},QueueGrid.prototype.getFramesHTML=function(a){var b=a.data.dataCollectionId,c=document.createElement("table");if(null!=this.key[b]){this.key[b].sort(function(a,b){return b.measurementId-a.measurementId});for(i in this.key[b]){var d=this.key[b][i],e=document.createElement("tr"),f=document.createElement("td");null==d.macromoleculeId?(f.setAttribute("style","width:130px;color:gray;"),f.appendChild(document.createTextNode(d.bufferAcronym))):(f.setAttribute("style","width:130px;font-weight:bold;"),f.appendChild(document.createTextNode(d.macromoleculeAcronym))),e.appendChild(f),e.appendChild(this.getPercentage(d.framesMerge,d.framesCount));var f=document.createElement("td"),g=document.createElement("a");null==d.macromoleculeId?g.setAttribute("href",BUI.getZipURLByAverageId(d.mergeId,d.measurementCode)):g.setAttribute("href",BUI.getZipURLBySubtractionId(d.subtractionId,d.measurementCode)),e.appendChild(f),c.appendChild(e)}}return"<table>"+c.innerHTML+"</table>"},QueueGrid.prototype.getHTMLTable=function(a){for(var b="",c=0;c<a.length;c++)b=b+"<tr><td class='key_subgrid'>"+a[c].key+"</td><td class='value_subgrid'>"+a[c].value+"</td></tr>";return"<table>"+b+"</table>"},QueueGrid.prototype.getImage=function(a,b){if(null!=a.data.macromoleculeId&&null!=a.data.subtractionId){var c=EXI.getDataAdapter().saxs.subtraction.getImage(a.data.subtractionId,b);return"<img src="+c+'   height="70" width="70" >'}},QueueGrid.prototype.getColumns=function(){var a=this;return[{header:"dataCollectionId",name:"dataCollectionId",dataIndex:"dataCollectionId",flex:1,hidden:!0},{header:"Exp. Id",name:"experimentId",dataIndex:"experimentId",flex:1,hidden:!0},{header:"Exp. Name",name:"name",dataIndex:"name",flex:1,hidden:!0},{header:"MeasurementId",name:"measurementId",dataIndex:"measurementId",hidden:!0,flex:1,renderer:function(a,b,c){return c.raw.measurementId}},{header:"Date",name:"date",flex:1,dataIndex:"runCreationDate",hidden:!0},{header:"Run",flex:.2,name:"runNumber",dataIndex:"measurementCode",renderer:function(b,c,d){return a.getRunHTML(d)}},{header:"Frames (Average/Total)",dataIndex:"macromoleculeId",name:"macromoleculeAcronym",flex:1,hidden:!1,renderer:function(b,c,d){return a.getFramesHTML(d)}},{text:"Scattering",dataIndex:"subtractionId",width:110,name:"subtractionId",renderer:function(b,c,d){return a.getImage(d,"scattering")}},{header:"Macromolecule",name:"macromoleculeAcronym",dataIndex:"macromoleculeAcronym",flex:1,hidden:!0},{header:"Concentration",name:"concentration",flex:.5,dataIndex:"concentration",hidden:!1,renderer:function(a,b,c){return 0!=c.data.concentration?BUI.formatValuesUnits(c.data.concentration,"mg/ml",7,this.decimals):void 0}},{header:"Exp. Temp.",name:"bufferAcronym",dataIndex:"bufferAcronym",flex:.5,renderer:function(a,b,c){return BUI.formatValuesUnits(c.data.exposureTemperature,"C",10,this.decimals)}},{text:"Kratky.",dataIndex:"subtractionId",hidden:!0,flex:1,name:"subtractionId",renderer:function(b,c,d){return a.getImage(d,"kratky")}},{text:"P(r).",hidden:!0,flex:1,dataIndex:"subtractionId",type:"string",renderer:function(b,c,d){return a.getImage(d,"density")}},{text:"Guinier.",hidden:!0,flex:1,dataIndex:"subtractionId",type:"string",renderer:function(b,c,d){return a.getImage(d,"guinier")}},{text:"Guinier",name:"Guinier",flex:.8,dataIndex:"subtractionId",renderer:function(b,c,d){if(null!=d.data.macromoleculeId&&null!=d.data.subtractionId){var e=[];return null!=d.data.rg?e.push({key:"Rg",value:BUI.formatValuesUnits(d.data.rg,"nm",12,this.decimals)}):e.push({key:"Rg",value:"<span class='notavailablefield'>NA</span>"}),null!=d.data.rg?e.push({key:"Points",value:"<span>"+d.data.firstPointUsed+" - "+d.data.lastPointUsed+" ("+(d.data.lastPointUsed-d.data.firstPointUsed)+")</span>"}):e.push({key:"Points",value:"<span class='notavailablefield'>NA</span>"}),null!=d.data.I0?e.push({key:"I0",value:BUI.formatValuesErrorUnitsScientificFormat(d.data.I0,d.data.I0Stdev,"")}):e.push({key:"I0",value:"<span class='notavailablefield'>NA</span>"}),a.getHTMLTable(e)}}},{text:"Gnom",name:"Gnom",flex:.7,dataIndex:"subtractionId",renderer:function(b,c,d){if(null!=d.data.macromoleculeId&&null!=d.data.subtractionId){var e=[];return null!=d.data.rgGnom?e.push({key:"Rg",value:BUI.formatValuesUnits(d.data.rgGnom,"nm")}):e.push({key:"Rg",value:"<span class='notavailablefield'>NA</span>"}),null!=d.data.rgGnom?e.push({key:"Total",value:BUI.formatValuesUnits(d.data.total,"")}):e.push({key:"Total",value:"<span class='notavailablefield'>NA</span>"}),null!=d.data.dmax?e.push({key:"D<sub>max</sub>",value:BUI.formatValuesUnits(d.data.dmax,"")+"<span style='font-size:8px;color:gray;'> nm</span>"}):e.push({key:"D<sub>max</sub>",value:"<span class='notavailablefield'>NA</span>"}),a.getHTMLTable(e)}}},{text:"Porod",name:"Porod",flex:1,dataIndex:"subtractionId",renderer:function(b,c,d){if(null!=d.data.macromoleculeId&&null!=d.data.subtractionId){var e=[];return null!=d.data.volumePorod?e.push({key:"Volume",value:BUI.formatValuesUnits(d.data.volumePorod,"")+"<span style='font-size:8px;color:gray;'> nm<sub>3</sub></span>"}):e.push({key:"Volume",value:"<span class='notavailablefield'>NA</span>"}),null!=d.data.volumePorod?e.push({key:"MM Vol. est.",value:Number(d.data.volumePorod/2).toFixed(1)+" - "+Number(d.data.volumePorod/1.5).toFixed(1)+"<span style='font-size:8px;color:gray;'>kD</span>"}):e.push({key:"MM Vol. est.",value:"<span class='notavailablefield'>NA</span>"}),a.getHTMLTable(e)}}},{text:"Advanced",hidden:!1,id:this.id+"buttonAction",dataIndex:"subtrationId",flex:1,renderer:function(a,b,c){var d="<table><tr><td style='padding-bottom: 1px;'>"+BUI.getGreenButton("Data Reduction",{width:90,height:15})+"</td></tr>";return d=c.data.abinitioCount>0?d+"<tr><td style='padding-bottom: 1px;'>"+BUI.getGreenButton("Abinitio",{width:90,height:15})+"</td></tr>":d+"<tr><td style='padding-bottom: 1px;'>"+BUI.getBlueButton("Abinitio",{width:90,height:15})+"</td></tr>",d=c.data.fitCount>0?d+"<tr><td style='padding-bottom: 1px;'>"+BUI.getGreenButton("Fit",{width:90,height:15})+"</td></tr>":d+"<tr><td style='padding-bottom: 1px;'>"+BUI.getBlueButton("Fit",{width:90,height:15})+"</td></tr>",d=c.data.superposisitionCount>0?d+"<tr><td style='padding-bottom: 1px;'>"+BUI.getGreenButton("Superposition",{width:90,height:15})+"</td></tr>":d+"<tr><td style='padding-bottom: 1px;'>"+BUI.getBlueButton("Superposition",{width:90,height:15})+"</td></tr>",d=c.data.rigidbodyCount>0?d+"<tr><td style='padding-bottom: 1px;'>"+BUI.getGreenButton("Rigid Body",{width:90,height:15})+"</td></tr>":d+"<tr><td style='padding-bottom: 1px;'>"+BUI.getBlueButton("Rigid Body",{width:90,height:15})+"</td></tr>",d+"</table>"}}]},QueueGrid.prototype.load=function(a){null!=a?(this.key={},this.store.loadData(a,!0)):this.store.load()},QueueGrid.prototype.getPanel=function(){var a=this;Ext.define("Queue",{extend:"Ext.data.Model",fields:["name","date","volumePorod","runCreationDate","measurementCode","macromoleculeAcronym","bufferAcronym","I0","I0Stdev","acronym","averageFilePath","bufferAverageFilePath","bufferId","bufferOnedimensionalFiles","code","comments","composition","concentration","creationDate","creationTime","dataAcquisitionFilePath","dataCollectionId","discardedFrameNameList","dmax","experimentId","experimentType","exposureTemperature","extintionCoefficient","extraFlowTime","firstPointUsed","flow","frameListId","framesCount","framesMerge","gnomFilePath","gnomFilePathOutput","guinierFilePath","isagregated","kratkyFilePath","lastPointUsed",{name:"macromoleculeId",id:"macromoleculeId"},{name:"measurementId",type:"int"},"mergeId","molecularMass","name","pH","priorityLevelId","proposalId","quality","rg","rgGnom","rgGuinier","rgStdev","runId","safetyLevelId","sampleAverageFilePath","sampleOneDimensionalFiles","samplePlatePositionId","scatteringFilePath","sequence","sessionId","sourceFilePath","specimenId","status","stockSolutionId","substractedFilePath","subtractionId","total","transmission","viscosity","volume","volumeToLoad","waitTime","reference","refined","fitCount","superposisitionCount","rigidbodyCount","abinitioCount"]}),this.store=Ext.create("Ext.data.Store",{model:"Queue",data:[],filters:this.filters,listeners:{beforeload:function(){return a.key={},!0},load:function(a,b){}},proxy:{type:"memory",reader:{type:"json"}}});var b=Ext.create("Ext.selection.RowModel",{allowDeselect:!0,mode:this.selectionMode,listeners:{selectionchange:function(b,c){a.selected=a.getSelectedData(),a.onSelectionChange.notify(a.selected);
},select:function(b,c){a.onSelect.notify(c.data)},deselect:function(b,c){a.onDeselect.notify(c.data)}}});return this.panel=Ext.create("Ext.grid.Panel",{title:this.title,border:!0,cls:"defaultGridPanel",maxHeight:this.maxHeight,overflow:"auto",margin:5,store:this.store,columns:this.getColumns(),allowDeselect:!0,selModel:b,collapsible:this.collapsible,collapsed:this.collapsed,viewConfig:{enableTextSelection:!0,preserveScrollOnRefresh:!0,stripeRows:!0,rowLines:!0,listeners:{cellclick:function(b,c,d,e,f,g,h,i){"Data Reduction"==h.target.defaultValue&&(location.hash="/saxs/datacollection/dataCollectionId/"+e.data.dataCollectionId+"/primaryviewer"),"Abinitio"==h.target.defaultValue&&a.onAbinitioButtonClicked(e.raw),"Fit"==h.target.defaultValue&&a.onFitButtonClicked(e.raw),"Superposition"==h.target.defaultValue&&a.onSuperpositionButtonClicked(e.raw),"Rigid Body"==h.target.defaultValue&&a.onRigidBodyButtonClicked(e.raw)}}}}),this.panel},QueueGrid.prototype.onDataReductionButtonClicked=function(a){var b=new DataAdapter,c=new DataReductionForm({});Ext.create("Ext.window.Window",{title:"Data Reduction",height:540,width:1e3,modal:!0,items:[c.getPanel()]}).show(),c.panel.setLoading(),b.onSuccess.attach(function(a,b){c.refresh(b),c.panel.setLoading(!1)}),b.getSubtractionsBySubtractionIdList([a.subtractionId])},RigidModelGrid.prototype.refresh=function(a){var b=[];if(null!=a&&a.length>0)for(var c in a){var d=a[c];if(null!=d.rigidBodyModeling3VOs)for(var e in d.rigidBodyModeling3VOs)b.push(d.rigidBodyModeling3VOs[e])}this.store.loadData(b)},RigidModelGrid.prototype.getPanel=function(){return this.store=Ext.create("Ext.data.Store",{fields:["symmetry","subtractionId","subUnitConfigFilePath","rigidBodyModelingId","rigidBodyModelFilePath","logFilePath","fitFilePath","curveConfigFilePath","crossCorrConfigFilePath","contactDescriptionFilePath"],data:[]}),this.store.sort([{property:"name",direction:"ASC"}]),this.panel=Ext.create("Ext.grid.Panel",{store:this.store,width:this.width,height:this.height,margin:10,deferredRender:!1,columns:[{text:"RBM",dataIndex:"rigidBodyModelFilePath",hidden:!1,flex:1,renderer:function(a){return BUI.getFileName(a)}},{text:"Sub Unit Conf.",dataIndex:"subUnitConfigFilePath",hidden:!0,flex:1,renderer:function(a){return BUI.getFileName(a)}},{text:"Log",dataIndex:"logFilePath",hidden:!0,flex:1,renderer:function(a){return BUI.getFileName(a)}},{text:"Fit",dataIndex:"fitFilePath",hidden:!1,flex:1,renderer:function(a){return BUI.getFileName(a)}},{text:"Curve Conf.",dataIndex:"curveConfigFilePath",hidden:!1,flex:1,renderer:function(a){return BUI.getFileName(a)}},{text:"Cross Corr.",dataIndex:"crossCorrConfigFilePath",hidden:!1,flex:1,renderer:function(a){return BUI.getFileName(a)}},{text:"Contact Desc.",dataIndex:"contactDescriptionFilePath",hidden:!0,flex:1,renderer:function(a){return BUI.getFileName(a)}}],viewConfig:{enableTextSelection:!0,preserveScrollOnRefresh:!0},listeners:{cellclick:function(a,b,c,d,e,f,g,h){},afterrender:function(){}}}),this.panel},RigidBodyModelingForm.prototype.openUploadManager=function(a){var b=this,c=new UploaderWidget(a);c.onUploaded.attach(function(a){b.panel.setLoading(),EXI.proposalManager.get(!0),b.load(EXI.proposalManager.getMacromoleculeById(b.macromolecule.macromoleculeId)),b.panel.setLoading(!1)}),c.show()},RigidBodyModelingForm.prototype._getItems=function(){var a=this;return[{xtype:"label",forId:"myFieldId",text:"Information for model fit, mixture analysis and rigid body modeling",margin:"15 0 20 10",cls:"inline-help"},this.rigidBodyGrid.getPanel(),{xtype:"label",forId:"myFieldId",text:"Distance restraints may be imposed on the model using contacts conditions file (OPTIONAL)",margin:"25 0 5 10",cls:"inline-help"},{xtype:"container",layout:"hbox",items:[{xtype:"container",border:!1,layout:"hbox",items:[{xtype:"label",forId:"myFieldId",text:"Contact Description File: (Optional)",width:150,margin:"10 0 0 10"},{id:this.id+"contactsDescriptionFilePath",xtype:"textfield",hideLabel:!0,margin:"10 0 0 0",width:400},{text:"Upload",xtype:"button",margin:"10 0 0 10",width:80,handler:function(){a.openUploadManager(EXI.getDataAdapter().saxs.macromolecule.getContactDescriptionUploadFileURL(a.macromolecule.macromoleculeId))}},{text:"Remove",id:a.id+"_remove",xtype:"button",margin:"10 0 0 10",width:80,handler:function(){a.panel.setLoading(!0);var b=function(){EXI.proposalManager.get(!0),a.load(EXI.proposalManager.getMacromoleculeById(a.macromolecule.macromoleculeId)),a.panel.setLoading(!1)};EXI.getDataAdapter({onSuccess:b}).saxs.macromolecule.removeContactDescriptionFile(a.macromolecule.macromoleculeId)}}]}]},{xtype:"panel",html:"<span class='inline-help' >Go to <a target='_blank' href='http://www.embl-hamburg.de/biosaxs/manuals/sasrefcvmx.html#input-format'>SASREF manual</a> for further information</span>",margin:"10 0 0 160",border:0}]},RigidBodyModelingForm.prototype._update=function(a,b,c){var d=this;BIOSAXS.proposal.onInitialized.attach(function(){null!=BIOSAXS.proposal&&(d.refresh(BIOSAXS.proposal.getMacromoleculeById(d.macromolecule.macromoleculeId)),d.panel.setLoading(!1))}),this.panel.setLoading(),BIOSAXS.proposal.init()},RigidBodyModelingForm.prototype.getPanel=function(){var a=this;return this.panel=Ext.create("Ext.form.Panel",{width:this.width,height:this.height,cls:"border-grid",defaultType:"textfield",items:this._getItems(),padding:20,listeners:{afterrender:function(){a._populate()}}}),this.panel},RigidBodyModelingForm.prototype._populate=function(){null!=this.macromolecule&&null!=Ext.getCmp(this.id+"contactsDescriptionFilePath")&&(null!=this.macromolecule.contactsDescriptionFilePath?(Ext.getCmp(this.id+"contactsDescriptionFilePath").setValue(this.macromolecule.contactsDescriptionFilePath),Ext.getCmp(this.id+"_remove").enable()):(Ext.getCmp(this.id+"_remove").disable(),Ext.getCmp(this.id+"contactsDescriptionFilePath").setValue("")))},RigidBodyModelingForm.prototype.load=function(a){this.macromolecule=a,this.rigidBodyGrid.load(a),this._populate()},RigidBodyModelingForm.prototype.input=function(){return{}},RigidBodyModelingForm.prototype.test=function(a){var b=new RigidBodyModelingForm,c=b.getPanel();c.render(a)},SamplePlateGroupWidget.prototype.drawPlate=function(a,b,c){var d=this,e=new SamplePlateWidget({width:this.width/3-5,height:this.heightPlates+10,nodeSize:this.nodeSize,fontSize:0,strokeWidth:1.5});this.isVerticalLayout()&&(e.width=this.width-15,e.height=this.heightPlates-10),e.draw(a,b,c),e.onVertexUp.attach(function(a,b){d.onClick.notify({samplePlate:b.samplePlate,row:b.row,column:b.column})}),this.samplePlateWidgets.push(e)},SamplePlateGroupWidget.prototype.drawPlates=function(a){if(a)for(var b=a.getPlateGroups(),c=0;c<b.length;c++)for(var d=b[c].plateGroupId,e=a.getPlatesByPlateGroupId(d),f=0;f<e.length;f++){var g=this.id+"_"+e[f].samplePlateId;null!=document.getElementById(g)&&this.drawPlate(a,e[f],g)}},SamplePlateGroupWidget.prototype.getDimensions=function(a){var b=0,c=0;if(null!=a)for(var d=0;d<a.length;d++){var e=a[d].slotPositionRow;null!=e&&(e=parseFloat(e),e>b&&(b=e));var f=a[d].slotPositionColumn;null!=f&&(f=parseFloat(f),f>c&&(c=f))}return{maxSlotPositionRow:parseFloat(b),maxSlotPositionColumn:parseFloat(c)}},SamplePlateGroupWidget.prototype.isVerticalLayout=function(){return!0},SamplePlateGroupWidget.prototype.getPlateBySlotPosition=function(a,b,c){if(null!=a)for(var d=0;d<a.length;d++)if(a[d].slotPositionRow==b&&a[d].slotPositionColumn==c)return a[d];return null},SamplePlateGroupWidget.prototype.getPlatesContainer=function(a){var b=[];null!=a&&(b=a.getPlateGroups());var c=document.createElement("div"),d=document.createElement("table");d.setAttribute("width",this.width-30+"px"),d.setAttribute("height",this.heightPlates+"px");for(var e=0;e<b.length;e++)for(var f=b[e].plateGroupId,g=a.getPlatesByPlateGroupId(f),h=this.getDimensions(g),i=1;i<=h.maxSlotPositionRow;i++)for(var j=1;j<=h.maxSlotPositionColumn;j++){var k=document.createElement("tr"),l=this.getPlateBySlotPosition(g,i,j),m=document.createElement("td");m.setAttribute("id",this.id+"_"+l.samplePlateId),m.setAttribute("style","background-color:#E6E6E6;border-width:1px;border-style:solid;");var n=document.createElement("div");n.setAttribute("class","menu-title");var o=document.createTextNode(l.platetype3VO.name);n.appendChild(o),m.appendChild(n),k.appendChild(m),d.appendChild(k)}return c.appendChild(d),c.innerHTML},SamplePlateGroupWidget.prototype.selectSpecimens=function(a){for(var b=0;b<this.samplePlateWidgets.length;b++)this.samplePlateWidgets[b].clearSelection();for(var b=0;b<a.length;b++)this.selectSpecimen(a[b])},SamplePlateGroupWidget.prototype.selectSpecimen=function(a){if(null!=a.sampleplateposition3VO)for(var b=0;b<this.samplePlateWidgets.length;b++)if(this.samplePlateWidgets[b].samplePlate.samplePlateId==a.sampleplateposition3VO.samplePlateId)return void this.samplePlateWidgets[b].selectSpecimen(a)},SamplePlateGroupWidget.prototype._refreshBbar=function(){null!=this.panel&&(this.panel.removeDocked(Ext.getCmp(this.id+"bbar")),this.panel.addDocked(this.getBbar()))},SamplePlateGroupWidget.prototype.refresh=function(a){this.experiment=a,this.samplePlateWidgets=[],null!=document.getElementById(this.id+"_container")&&(document.getElementById(this.id+"_container").innerHTML="",document.getElementById(this.id+"_container").innerHTML=this.getPlatesContainer(a),this.drawPlates(a)),this._refreshBbar()},SamplePlateGroupWidget.prototype._getAutoFillButton=function(){function a(){}function b(a){if("yes"==a){var b=e.samplePlateId,c=new BiosaxsDataAdapter;d.panel.setLoading("ISPyB: Saving Plate"),c.onSuccess.attach(function(a,b){d.onExperimentChanged.notify(b),d.panel.setLoading(!1)}),c.onError.attach(function(a){alert("error"),d.panel.setLoading(!1)}),c.autoFillPlate(b,d.experiment.experimentId)}}function c(a){e=a,Ext.MessageBox.confirm("Confirm",'Are you sure you want to fill "'+d.experiment.getSamplePlateById(e.samplePlateId).platetype3VO.name+'" plate?',b)}var d=this,e=null,f=[];if(f.push('<b class="menu-title">Select a plate:</b>'),this.experiment){var g=this.experiment.getSamplePlates();g.sort(function(a,b){return a.slotPositionColumn-b.slotPositionColumn});for(var h=0;h<g.length;h++)f.push({samplePlateId:g[h].samplePlateId,text:h+1+".- <b> "+g[h].platetype3VO.name+"</b>",handler:c})}return Ext.create("Ext.button.Split",{text:"Auto Fill",handler:a,tooltip:{text:"This will fill, if there is place, the specimens in the plate",title:"Auto Fill"},menu:{items:f}})},SamplePlateGroupWidget.prototype._getZoomButton=function(){function a(a){Ext.create("Ext.window.Window",{title:b.experiment.getSamplePlateById(a.samplePlateId).platetype3VO.name,height:600,width:900,layout:"fit",modal:!0,listeners:{afterrender:function(){var c=new SamplePlateWidget({width:880,height:560,nodeSize:4,fontSize:0,strokeWidth:1.5,showLabels:!0,backgroundColor:"#FFFFFF"});c.draw(b.experiment,b.experiment.getSamplePlateById(a.samplePlateId),"plateZoom")}},items:[{html:'<div id="plateZoom" style="background-color:red"></div>',padding:5}]}).show()}var b=this,c=[];if(this.experiment){var d=this.experiment.getSamplePlates();d.sort(function(a,b){return a.slotPositionColumn-b.slotPositionColumn}),c.push('<b class="menu-title">Select a plate:</b>');for(var e=0;e<d.length;e++)c.push({samplePlateId:d[e].samplePlateId,text:e+1+".- <b> "+d[e].platetype3VO.name+"</b>",handler:a})}return Ext.create("Ext.button.Split",{text:"Zoom In",tooltip:{text:"This will show a plate bigger",title:"Zoom In Action"},menu:{items:c}})},SamplePlateGroupWidget.prototype._getEmptyButton=function(){function a(){}function b(a){if("yes"==a){var b=e.samplePlateId,c=new BiosaxsDataAdapter;d.panel.setLoading("ISPyB: Saving Plate"),c.onSuccess.attach(function(a,b){d.onExperimentChanged.notify(b),d.panel.setLoading(!1)}),c.onError.attach(function(a){alert("error"),d.panel.setLoading(!1)}),c.emptyPlate(b,d.experiment.experimentId)}}function c(a){e=a,Ext.MessageBox.confirm("Confirm",'Are you sure you want to empty "'+d.experiment.getSamplePlateById(e.samplePlateId).platetype3VO.name+'" plate?',b)}var d=this,e=null,f=[];if(this.experiment){var g=this.experiment.getSamplePlates();g.sort(function(a,b){return a.slotPositionColumn-b.slotPositionColumn}),f.push('<b class="menu-title">Select a plate:</b>');for(var h=0;h<g.length;h++)f.push({samplePlateId:g[h].samplePlateId,text:h+1+".- <b> "+g[h].platetype3VO.name+"</b>",handler:c})}return Ext.create("Ext.button.Split",{text:"Empty",handler:a,tooltip:{text:"This will empty the specimen of a plate. It will NOT remove the specimen but will removed their position",title:"Empty Action"},menu:{items:f}})},SamplePlateGroupWidget.prototype._getPlateTypes=function(){function a(){}function b(a){if("yes"==a){var b=e.samplePlateId,c=e.plateTypeId,f=BIOSAXS.proposal.getPlateTypeById(c),g=d.experiment.getSamplePlateById(b);g.platetype3VO=f;var b=e.samplePlateId,h=new BiosaxsDataAdapter;d.panel.setLoading("ISPyB: Saving Plate"),h.onSuccess.attach(function(a,b){d.onExperimentChanged.notify(b),d.panel.setLoading(!1)}),h.onError.attach(function(a){alert("error"),d.panel.setLoading(!1)}),h.savePlates([g],d.experiment.experimentId)}}function c(a){e=a;var c=a.samplePlateId,f=a.plateTypeId;d.experiment.getSamplePlateById(c).platetype3VO.plateTypeId!=f&&Ext.MessageBox.confirm("Confirm",'Are you sure you want to change the type of "'+d.experiment.getSamplePlateById(e.samplePlateId).platetype3VO.name+'" plate?',b)}var d=this,e=null,f=[];f.push('<b class="menu-title">Select an EMPTY plate:</b>');var g=[];null!=this.experiment&&(g=this.experiment.getSamplePlates()),g.sort(function(a,b){return a.slotPositionColumn-b.slotPositionColumn});for(var h=ProposalManager.getPlateTypes(),i=0;i<g.length;i++){for(var j=g[i],k=[],l=0;l<h.length;l++)k.push({text:h[l].name,plateTypeId:h[l].plateTypeId,samplePlateId:j.samplePlateId,checked:j.platetype3VO.plateTypeId==h[l].plateTypeId,group:"theme"+j.samplePlateId,checkHandler:c});f.push({text:i+1+".- <b> "+j.platetype3VO.name+"</b>",disabled:d.experiment.getSpecimensBySamplePlateId(j.samplePlateId).length>0,menu:{items:k}})}return Ext.create("Ext.button.Split",{text:"Plate Types",handler:a,tooltip:{text:"This will change the type of a plate.",title:"Change plate type"},menu:{items:f}})},SamplePlateGroupWidget.prototype.getBbar=function(a){var b=this;return this.bbar?Ext.create("Ext.toolbar.Toolbar",{id:b.id+"bbar",dock:"bottom",items:[this._getPlateTypes(),"-",this._getAutoFillButton(),this._getEmptyButton(),"-",this._getZoomButton()]}):null},SamplePlateGroupWidget.prototype.getPanel=function(){var a=this,b=this.id+"_container";return this.panel=Ext.create("Ext.panel.Panel",{title:this.title,bbar:this.getBbar(),height:this.height,width:this.width,border:this.border,items:[{border:0,height:this.height,id:b,html:"<div id='"+b+"'></div>"}]}),this.panel.on("afterrender",function(){document.getElementById(b).innerHTML=a.getPlatesContainer(a.experiment),a.drawPlates(a.experiment),a._refreshBbar()}),this.panel},SamplePlateWidget.prototype.clear=function(a,b,c){null!=document.getElementById(this.targetId)&&(document.getElementById(this.targetId).innerHTML="")},SamplePlateWidget.prototype.draw=function(a,b,c,d){var e=this;if(this.windowContainerId=d,Ext.isIE6||Ext.isIE7||Ext.isIE8)return void(document.getElementById(c).innerHTML=BUI.getWarningHTML(this.notSupportedMessage));this.onVertexUp=new Event(this),this.samplePlate=b,this.experiment=a,this.targetId=c;var f=this.samplePlate.platetype3VO.rowCount,g=this.samplePlate.platetype3VO.columnCount;this.network=new NetworkWidget({targetId:c});var h=new GraphDataset,i=new NetworkDataSetFormatter({defaultFormat:{type:"LineEdgeNetworkFormatter","fill-opacity":1,fill:this.wellColor,"stroke-width":this.strokeWidth,"stroke-opacity":1,stroke:"#000000",size:this.nodeSize,title:{fontSize:this.fontSize,fill:"#000000"}}},null,{labeled:!1,height:this.height,width:this.width,right:this.width,backgroundColor:this.backgroundColor,balanceNodes:!1,nodesMaxSize:12,nodesMinSize:2});i.dataBind(h);var j=new LayoutDataset;j.dataBind(h),this.network.draw(h,i,j);for(var k=1;f>=k;k++)for(var l=1;g>=l;l++)this.network.getDataset().addNode("",{row:k,column:l})," 4 x ( 8 + 3 ) Block"==this.samplePlate.platetype3VO.name&&(9>l?this.network.getFormatter().vertices[this.network.getDataset().getVerticesCount()-1].getDefault().setSize(.8*this.nodeSize):this.network.getFormatter().vertices[this.network.getDataset().getVerticesCount()-1].getDefault().setSize(1.4*this.nodeSize));this.network.graphCanvas.onVertexUp.attach(function(a,b){e.onVertexUp.notify({samplePlate:e.samplePlate,row:e.network.getDataset().getVertexById(b).args.row,column:e.network.getDataset().getVertexById(b).args.column})}),this.network.graphCanvas.onVertexOver.attach(function(a,b){}),this.relayout(this.network,f,g),this.fillSimulator(this.experiment.getSamples()),this.showBorderLabels&&this.drawBorders()},SamplePlateWidget.prototype.drawBorders=function(){var a={},b={},c=[],d=[],e=this.network.graphCanvas.getLayout().vertices;for(var f in e){var g=e[f].x;null==a[g]&&(a[g]=!0,c.push(g));var h=e[f].y;null==b[h]&&(b[h]=!0,d.push(h))}for(var i=BUI.getSamplePlateLetters(),j=1;j<=c.length;j++)SVG.drawText(c[j-1]*this.network.graphCanvas.getWidth()-5,this.network.graphCanvas.getHeight(),j,this.network.graphCanvas._svg,[["font-size",this.legendFontSize+"px"],["font-weight","bold"],["fill","black"]]);for(var j=1;j<=d.length;j++)SVG.drawText(5,d[j-1]*this.network.graphCanvas.getHeight()+5,i[j-1],this.network.graphCanvas._svg,[["font-size",this.legendFontSize+"px"],["font-weight","bold"],["fill","black"]])},SamplePlateWidget.prototype.addOkIcon=function(a,b,c,d){var e=this.network.graphCanvas._svg,c=c+"_marked";null==this.markedSpecimenId[c]&&(SVG.drawRectangle(a-10,b-10,22,22,e,[["id",c],["fill","gray"],["stroke-opacity","0.5"],["fill-opacity","0.2"],["stroke","black"]]),this.markedSpecimenId[c]=!0)},SamplePlateWidget.prototype.selectSpecimen=function(a){var b=this.getVertexByPosition(a.sampleplateposition3VO.rowNumber,a.sampleplateposition3VO.columnNumber),c=this.network.getLayout().vertices[b.id].x*this.width,d=this.network.getLayout().vertices[b.id].y*this.height,e=this.network.graphCanvas._svg;this.selectedSVGNodes.push(SVG.drawRectangle(c-9,d-9,20,20,e,[["fill","red"],["fill-opacity","0"],["stroke","blue"],["stroke-width","2"]]))},SamplePlateWidget.prototype.clearSelection=function(){for(var a=this.network.graphCanvas._svg,b=0;b<this.selectedSVGNodes.length;b++)a.removeChild(this.selectedSVGNodes[b]);this.selectedSVGNodes=[]},SamplePlateWidget.prototype.getVertexByPosition=function(a,b){var c=this.network.getDataset().getVertices();for(var d in c)if(c[d].args.row==a&&c[d].args.column==b)return c[d];return null},SamplePlateWidget.prototype.showLabel=function(a,b,c){if(null!=c){var d=this.getVertexByPosition(a,b);0!=this.fontSize&&(null!=c.macromolecule3VO?this.showFullName?d.setName(c.code):d.setName(c.macromolecule3VO.acronym):this.showFullName?d.setName(c.code):d.setName(c.macromolecule3VO.acronym))}},SamplePlateWidget.prototype.getNodeIdBySpecimenId=function(a){this.ids[a]},SamplePlateWidget.prototype.markSpecimenAsOk=function(a,b,c,d){if(null!=a.measurements)for(var e=0;e<a.measurements.length;e++)null!=a.measurements[e].merge3VOs&&a.measurements[e].merge3VOs.length>0&&this.addOkIcon(b*this.network.graphCanvas.getWidth(),c*this.network.graphCanvas.getHeight(),d,a)},SamplePlateWidget.prototype.getSpecimenBufferColorFromSampleSpecimenId=function(a){var b=this.experiment.getDataCollectionsBySpecimenId(a);if(b.length>0)for(var c=b[0],d=0;d<c.measurementtodatacollection3VOs.length;d++){var e=c.measurementtodatacollection3VOs[d];if(1==e.dataCollectionOrder){var f=this.experiment.getMeasurementById(e.measurementId);return null!=f?this.experiment.getSpecimenColorByBufferId(f.specimenId):"pink"}}return"orange"},SamplePlateWidget.prototype.fillWell=function(a,b,c){if(null!=c){var d=this.getVertexByPosition(a,b);if(null==d)return void console.log(a+", "+b+" not found");var e=this.network.getGraphCanvas().getSVGNodeId(d.id);this.showLabel(a,b,c),this.ids[c.specimenId]=d.id;var f=this.network.getLayout().vertices[d.id].x,g=this.network.getLayout().vertices[d.id].y;if(this.markSpecimenAsOk(c,f,g,e),null==c.macromolecule3VO){var h=this.experiment.getSpecimenColorByBufferId(c.specimenId);this.network.getFormatter().getVertexById(d.id).getDefault().setFill(h),this.network.getFormatter().getVertexById(d.id).getDefault().setStroke("blue"),this.network.getFormatter().getVertexById(d.id).getDefault().setStrokeWidth(2)}else this.network.getFormatter().getVertexById(d.id).getDefault().setFill(this.experiment.macromoleculeColors[c.macromolecule3VO.macromoleculeId]),this.network.getFormatter().getVertexById(d.id).getDefault().setStroke("black"),this.network.getFormatter().getVertexById(d.id).getDefault().setStrokeWidth(1);if(this.showLabels){if(f=this.network.getLayout().vertices[d.id].x,g=this.network.getLayout().vertices[d.id].y,null!=c.macromolecule3VO){var i=c.macromolecule3VO.acronym;i.length>10&&(i=i.slice(0,10)+"..."),SVG.drawText(f*this.network.graphCanvas.getWidth()-this.nodeSize-10,g*this.network.graphCanvas.getHeight()+3*this.nodeSize+20,i,this.network.graphCanvas._svg,[["font-size","xx-small"],["fill","black"]]),SVG.drawText(f*this.network.graphCanvas.getWidth()-this.nodeSize-10,g*this.network.graphCanvas.getHeight()+3*this.nodeSize+35,Number(c.concentration).toFixed(2)+" mg/ml",this.network.graphCanvas._svg,[["font-size","xx-small"],["fill","black"]])}var j=this.experiment.getBufferById(c.bufferId).acronym;j.length>10&&(j=j.slice(0,10)+"..."),SVG.drawText(f*this.network.graphCanvas.getWidth()-this.nodeSize-10,g*this.network.graphCanvas.getHeight()+3*this.nodeSize+5,this.experiment.getBufferById(c.bufferId).acronym,this.network.graphCanvas._svg,[["font-size","xx-small"],["fill","blue"]])}if(this.showTooltip)var e=this.network.getGraphCanvas().getSVGNodeId(d.id)}},SamplePlateWidget.prototype._getToolTipContent=function(a){var b="<table style='font-size:11px;'>";return b=b+"<TR><TD>Specimen </TD><TD style='color:black; font-weight:bold;'>"+a.code+"</TD></TR>",b+="<TR style='height:20px'><TD></TD><TD style='color:black; font-weight:bold;'></TD></TR>",b=b+"<TR><TD>Buffer: </TD><TD style='color:blue; font-weight:bold;'>"+this.experiment.getBufferById(a.bufferId).name+"</TD></TR>",null!=a.macromolecule3VO&&(b=b+"<TR><TD>Macromolecule: </TD><TD  style='color:green; font-weight:bold;'>"+a.macromolecule3VO.acronym+"</TD></TR>",b=b+"<TR><TD>Concentration: </TD><TD >"+a.concentration+"</TD></TR>"),b=b+"<TR><TD>Volume: </TD><TD>"+a.volume+"</TD></TR>",null!=a.viscosity&&(b=b+"<TR><TD>Viscosity: </TD><TD>"+a.viscosity+"</TD></TR>"),b+="</table>"},SamplePlateWidget.prototype.fillSimulator=function(a){for(var b=0;b<a.length;b++){var c=a[b];if(null!=c.sampleplateposition3VO&&c.sampleplateposition3VO.samplePlateId==this.samplePlate.samplePlateId){var d=c.sampleplateposition3VO;this.fillWell(d.rowNumber,d.columnNumber,c)}}},SamplePlateWidget.prototype.relayout=function(a,b,c){"REC"==this.samplePlate.platetype3VO.shape&&this.squareRelayout(a,b,c),"CIR"==this.samplePlate.platetype3VO.shape&&this.circleRelayout(a,b,c)},SamplePlateWidget.prototype.squareRelayout=function(a,b,c){for(var d=(a.getDataset()._getVerticesCount(),.07),e=.9,f=.075,g=.95,h=(e-d)/(b-1),i=(g-f)/(c-1),j=[],k=0;b>k;k++)for(var l=0;c>l;l++)y=k*h+d,x=l*i+f,j.push({x:x,y:y});var m=0;for(var n in a.getDataset().getVertices())null==a.getLayout().vertices[n]&&(this.vertices[n]=new NodeLayout(n,0,0)),a.getLayout().vertices[n].setCoordinates(j[m].x,j[m].y),m++,a.getLayout().vertices[n].changed.attach(function(a,b){_this.changed.notify(b)})},SamplePlateWidget.prototype.circleRelayout=function(a,b,c){a.getLayout().getLayout("CIRCLE")},SamplesGrid.prototype.load=function(a){try{this.crystal=a,this.loadSampleList()}catch(b){EXI.setError(b)}},SamplesGrid.prototype.loadSampleList=function(){function a(a,c){b.store.loadData(c),b.panel.setLoading(!1)}var b=this;this.panel.setLoading(),EXI.getDataAdapter({onSuccess:a}).mx.sample.getSampleInfoByCrystalId(this.crystal.crystalId)},SamplesGrid.prototype.getByCrystalId=function(a){for(var b=0;b<this.data.length;b++)if(this.data[b].crystalId==a.crystalId)return this.data[b]},SamplesGrid.prototype.getPanel=function(){return this.store2=Ext.create("Ext.data.Store",{model:"BLSampleModel",data:[]}),this.store=Ext.create("Ext.data.Store",{fields:["Protein","SpaceGroup","SampleName","Code","Shipment","Dewar","Container","Location","Cell"],emptyText:"No samples",data:[]}),this.panel=Ext.create("Ext.grid.Panel",{title:this.title,store:this.store,layout:"fit",icon:"../images/icon/sessions.png",cls:"border-grid",height:this.height,margin:this.margin,emptyText:"No samples",columns:[{text:"SampleName",dataIndex:"sampleName",width:100},{text:"Protein",dataIndex:"proteinAcronym",width:100},{text:"SpaceGroup",dataIndex:"crystalSpaceGroup",width:100},{text:"Code",dataIndex:"code",width:100},{text:"Location",dataIndex:"containerSampleChangerLocation",width:100},{text:"Shipment",dataIndex:"shipment",flex:.1,renderer:function(a,b,c){return c.data.containerVO.DewarVO.ShippingVO.name}},{text:"Dewar",dataIndex:"dewar",flex:.1,renderer:function(a,b,c){return c.data.containerVO.DewarVO.code}},{text:"Location in SC",dataIndex:"sampleChangerLocation",flex:.1,renderer:function(a,b,c){return c.data.containerVO.sampleChangerLocation}},{text:"Cell",dataIndex:"cell",flex:.1,renderer:function(a,b,c){var d=2;if(c.data.crystalVO){var e=c.data.CellA?Number(c.data.crystalVO.CellA).toFixed(d)+", ":"";return e+=c.data.crystalVO.CellB?Number(c.data.crystalVO.CellB).toFixed(d)+", ":"",e+=c.data.crystalVO.CellC?Number(c.data.crystalVO.CellC).toFixed(d)+"<br />":"",e+=c.data.crystalVO.CellAlpha?Number(c.data.crystalVO.CellAlpha).toFixed(d)+", ":"",e+=c.data.crystalVO.CellBeta?Number(c.data.crystalVO.CellBeta).toFixed(d)+", ":"",e+=c.data.crystalVO.CellGamma?Number(c.data.crystalVO.CellGamma).toFixed(d):""}return""}},{text:"Protein",dataIndex:"proteinAcronym",flex:.1,renderer:function(a,b,c){return c.data.crystalVO.proteinVO.acronym}}]}),this.panel},SpecimenGrid.prototype._prepareData=function(a){for(var b=[],c=a.getSamples(),d=0;d<c.length;d++){var e=c[d];null!=e.macromolecule3VO&&(e.macromolecule=e.macromolecule3VO.acronym,e.exposureTemperature=[],e.macromoleculeId=e.macromolecule3VO.macromoleculeId),null!=e.sampleplateposition3VO?null!=e.sampleplateposition3VO.samplePlateId&&(e.samplePlateId=e.sampleplateposition3VO.samplePlateId,e.rowNumber=e.sampleplateposition3VO.rowNumber,e.columnNumber=e.sampleplateposition3VO.columnNumber,null!=a.getSamplePlateById(e.sampleplateposition3VO.samplePlateId).plategroup3VO&&(e.plateGroupName=a.getSamplePlateById(e.sampleplateposition3VO.samplePlateId).plategroup3VO.name,e.samplePlateName=a.getSamplePlateById(e.sampleplateposition3VO.samplePlateId).name+"  ["+e.plateGroupName+"]",e.slotPositionColumn=a.getSamplePlateById(e.sampleplateposition3VO.samplePlateId).slotPositionColumn)):e.samplePlateName="Unallocated Specimens",e.groupIndex=e.bufferId+e.macromoleculeId;var f=EXI.proposalManager.getMacromoleculeById(e.macromoleculeId);e.acronym="Buffers",null!=f&&(e.acronym=EXI.proposalManager.getMacromoleculeById(e.macromoleculeId).acronym),e.buffer=a.getBufferById(e.bufferId),e.volumeToLoad=a.getVolumeToLoadBySampleId(e.sampleId),b.push(e)}return b},SpecimenGrid.prototype.deselectAll=function(){this.grid.getSelectionModel().deselectAll()},SpecimenGrid.prototype.selectById=function(a){this.grid.getSelectionModel().deselectAll();for(var b=0;b<this.grid.getStore().data.items.length;b++){var c=this.grid.getStore().data.items[b].data;c.specimenId==a&&this.grid.getSelectionModel().select(b)}},SpecimenGrid.prototype.getStore=function(){return this.store},SpecimenGrid.prototype.getPlugins=function(){var a=this,b=[];return this.updateRowEnabled&&b.push(Ext.create("Ext.grid.plugin.RowEditing",{clicksToEdit:1,listeners:{validateedit:function(b,c){var d=[];if(c.newValues.bufferId!=c.record.data.bufferId){var e=[];if(null==c.record.data.macromoleculeId)e=e.concat(a.experiment.getDataCollectionsBySpecimenId(c.record.data.specimenId));else for(var f=a.experiment.getDataCollectionsBySpecimenId(c.record.data.specimenId),g=0;g<f.length;g++){var h=f[g];if(null!=h)for(var i=0;i<h.measurementtodatacollection3VOs.length;i++){var j=h.measurementtodatacollection3VOs[i];1==j.dataCollectionOrder&&(e=e.concat(a.experiment.getDataCollectionsBySpecimenId(a.experiment.getMeasurementById(j.measurementId).specimenId)))}}var g=null;for(g=0;g<e.length;g++){var k=e[g],l=a.experiment.getSpecimenByDataCollectionId(k.dataCollectionId);d=d.concat(l)}for(g=0;g<d.length;g++){var m=d[g],n=a.experiment.getSpecimenById(m.specimenId);n.bufferId=c.newValues.bufferId,(new DataAdapter).saveSpecimen(n,a.experiment)}}if(c.record.data.concentration=c.newValues.concentration,c.record.data.volume=c.newValues.volume,null!=c.record.data.sampleplateposition3VO){var o=a.experiment.getSamplePlateBySlotPositionColumn(c.newValues.slotPositionColumn);null!=o&&(c.record.data.sampleplateposition3VO={columnNumber:c.newValues.columnNumber,rowNumber:c.newValues.rowNumber,samplePlateId:o.samplePlateId})}else if(null!=c.newValues.slotPositionColumn){var o=a.experiment.getSamplePlateBySlotPositionColumn(c.newValues.slotPositionColumn);null!=o&&(c.record.data.sampleplateposition3VO={columnNumber:c.newValues.columnNumber,rowNumber:c.newValues.rowNumber,samplePlateId:o.samplePlateId})}var p=c.record.data.macromoleculeId,q=function(b,c){null!=p&&(c.macromolecule3VO=EXI.proposalManager.getMacromoleculeById(p)),a.onSpecimenChanged.notify(c),a.grid.setLoading(!1)};a.grid.setLoading(),EXI.getDataAdapter({onSuccess:q}).saxs.specimen.saveSpecimen(c.record.data)}}})),b},SpecimenGrid.prototype._getRowCombo=function(){for(var a=[],b=1;8>=b;b++)a.push({rowNumber:b,name:BUI.getSamplePlateLetters()[b-1]});var c=Ext.create("Ext.data.Store",{fields:["rowNumber","name"],data:a});return Ext.create("Ext.form.ComboBox",{store:c,queryMode:"local",displayField:"name",valueField:"rowNumber"})},SpecimenGrid.prototype._getColumnCombo=function(){for(var a=[],b=1;12>=b;b++)a.push({columnNumber:b});var c=Ext.create("Ext.data.Store",{fields:["columnNumber"],data:a});return Ext.create("Ext.form.ComboBox",{store:c,queryMode:"local",displayField:"columnNumber",valueField:"columnNumber"})},SpecimenGrid.prototype._getSlotColumBombo=function(){if(this.experiment){for(var a=this.experiment.getSamplePlates().length,b=[],c=1;a>=c;c++)b.push({slotPositionColumn:c});var d=Ext.create("Ext.data.Store",{fields:["slotPositionColumn"],data:b});return Ext.create("Ext.form.ComboBox",{store:d,queryMode:"local",displayField:"slotPositionColumn",valueField:"slotPositionColumn"})}},SpecimenGrid.prototype.getPanelByExperiment=function(a){this.experiment=a;var b=this._prepareData(a);return this.getPanel(b)},SpecimenGrid.prototype.refresh=function(a){this.experiment=a;var b=this._prepareData(a);this.store.loadData(b)},SpecimenGrid.prototype.getPanel=function(){var a=this;this.store=Ext.create("Ext.data.Store",{fields:["buffer","bufferId","code","macromolecule","acronym","macromoleculeId","concentration","volume","samplePlateId","slotPositionColumn","rowNumber","columnNumber","groupIndex"],data:[],groupField:"acronym"}),this.store.sort([{property:"concentration",direction:"ASC"},{property:"buffer",direction:"ASC"}]);var b=Ext.create("Ext.selection.RowModel",{allowDeselect:!0,listeners:{select:function(b,c,d,e){a.onSelected.notify([c.data])}}}),c=[];return this.grouped&&c.push({ftype:"grouping",groupHeaderTpl:"{name}",hideGroupedHeader:!1,startCollapsed:!1,id:"myGroupedStore"}),this.grid=Ext.create("Ext.grid.Panel",{title:this.title,height:this.height,width:this.width,selModel:b,store:this.store,features:c,margin:this.margin,plugins:this.getPlugins(),cls:"border-grid",columns:[{text:"",dataIndex:"macromolecule",width:20,renderer:function(b,c,d){var e=null;return e=null!=d.data.macromolecule3VO?d.data.macromolecule3VO.macromoleculeId:d.data.macromoleculeId,
null!=e?BUI.getRectangleColorDIV(a.experiment.macromoleculeColors[e],10,10):void 0}},{text:"Macromolecule",dataIndex:"macromolecule",width:100},{text:"",dataIndex:"buffer",width:20,renderer:function(b,c,d){var e="black";return null!=d.data.bufferId?(null!=a.experiment.getDataCollectionsBySpecimenId(d.data.specimenId)[0]&&(e=a.experiment.getSpecimenColorByBufferId(a.experiment.getMeasurementById(a.experiment.getDataCollectionsBySpecimenId(d.data.specimenId)[0].measurementtodatacollection3VOs[0].measurementId).specimenId)),BUI.getRectangleColorDIV(e,10,10)):void 0}},{text:"Buffer",dataIndex:"bufferId",width:140,editor:BIOSAXS_COMBOMANAGER.getComboBuffers(EXI.proposalManager.getBuffers(),{noLabel:!0,width:300}),renderer:function(a,b,c){return null!=c.data.bufferId?EXI.proposalManager.getBufferById(a).acronym:void 0}},{text:"Conc.",dataIndex:"concentration",width:100,editor:{allowBlank:!1},renderer:function(a,b,c){return isNaN(a)?(b.tdCls="yellow-cell",a):0!=a?BUI.formatValuesUnits(a,"mg/ml",{fontSize:16,decimals:3,unitsFontSize:this.unitsFontSize}):void 0}},{text:"Vol. Well",dataIndex:"volume",width:70,editor:{allowBlank:!0},renderer:function(a,b,c){return BUI.formatValuesUnits(c.data.volume,"&#181l",{fontSize:12,decimals:2,unitsFontSize:this.unitsFontSize})}},{text:"Position",hidden:!0,flex:1,renderer:function(b,c,d){return BUI.getSamplePositionHTML(d.data,a.experiment)}},{text:"samplePlateId",dataIndex:"samplePlateId",hidden:!0},{text:"Plate",hidden:this.isPositionColumnHidden,dataIndex:"slotPositionColumn",editor:a._getSlotColumBombo(),flex:1,renderer:function(a,b,c){return null!=a&""!=a?a:void(b.tdCls="yellow-cell")}},{text:"Row",hidden:this.isPositionColumnHidden,dataIndex:"rowNumber",editor:this._getRowCombo(),flex:1,renderer:function(a,b,c){return null!=a&&""!=a?BUI.getSamplePlateLetters()[a-1]:void(b.tdCls="yellow-cell")}},{text:"Well",hidden:this.isPositionColumnHidden,dataIndex:"columnNumber",editor:this._getColumnCombo(),flex:1,renderer:function(a,b,c){return null!=a&&""!=a?a:void(b.tdCls="yellow-cell")}},{id:a.id+"buttonEditSample",text:"Edit",width:80,sortable:!1,hidden:!a.editEnabled,renderer:function(b,c,d,e,f,g){return a.editEnabled?BUI.getGreenButton("EDIT"):void 0}},{id:a.id+"buttonRemoveSample",text:"",hidden:!a.removeBtnEnabled,width:100,sortable:!1,renderer:function(b,c,d,e,f,g){return a.removeBtnEnabled?BUI.getRedButton("REMOVE"):void 0}}],viewConfig:{preserveScrollOnRefresh:!0,stripeRows:!0,getRowClass:function(b){var c=a.experiment.getSampleByPosition(b.data.samplePlateId,b.data.rowNumber,b.data.columnNumber);return c.length>1?"red-row":void 0},listeners:{selectionchange:function(b,c){a.onClick.notify(record.data)},cellclick:function(b,c,d,e,f){b.getGridColumns()[d].getId()==a.id+"buttonEditSample",b.getGridColumns()[d].getId()==a.id+"buttonRemoveSample"&&(b.getStore().removeAt(rowIndex),a.onRemoved.notify())}}}}),this.grid},SpecimenGrid.prototype.input=function(){return{experiment:DATADOC.getExperiment_10(),proposal:DATADOC.getProposal_10()}},SpecimenGrid.prototype.test=function(a){var b=new SpecimenGrid({height:400,maxHeight:400,width:1e3});BIOSAXS.proposal=new Proposal(b.input().proposal);var c=new Experiment(b.input().experiment),d=b.getPanelByExperiment(c);d.render(a)},SpecimenWidget.prototype.getContainerLayoutConfiguration=function(a){this.samplePlateGroupWidget.getDimensions(a.getSamplePlates());return{layout:"hbox",samplePlateGroupWidth:1*this.width/3-10,samplePlateGroupHeight:this.height-10,specimenGridWidth:2*this.width/3,specimenGridHeight:this.height-10}},SpecimenWidget.prototype.refresh=function(a){this.experiment=a,this.panel.removeAll();var b=this.getContainerLayoutConfiguration(a);this.specimenGrid.width=b.specimenGridWidth,this.specimenGrid.height=b.specimenGridHeight,this.samplePlateGroupWidget.width=b.samplePlateGroupWidth,this.samplePlateGroupWidget.height=b.samplePlateGroupHeight,"hbox"==b.layout&&(this.specimenGrid.margin="0 0 0 5",this.specimenGrid.width=this.specimenGrid.width-5);var c=Ext.create("Ext.container.Container",{layout:b.layout,height:this.height,width:this.width,padding:"2px",items:[]});"vbox"==b.layout?(c.insert(this.specimenGrid.getPanel()),c.insert(this.samplePlateGroupWidget.getPanel())):(c.insert(this.samplePlateGroupWidget.getPanel()),c.insert(this.specimenGrid.getPanel())),this.panel.insert(c),this.specimenGrid.refresh(a),this.samplePlateGroupWidget.refresh(a)},SpecimenWidget.prototype.getPanel=function(){return this.panel=Ext.create("Ext.container.Container",{layout:"vbox",height:this.height,border:0,margin:5,width:this.width,items:[]}),this.panel},SpecimenWidget.prototype.input=function(){return{experiment:DATADOC.getExperiment_10(),proposal:DATADOC.getProposal_10()}},SpecimenWidget.prototype.test=function(a){var b=new SpecimenWidget({height:500,width:1e3});BIOSAXS.proposal=new Proposal(b.input().proposal);var c=new Experiment(b.input().experiment),d=b.getPanel();d.render(a),b.refresh(c)},StockSolutionForm.prototype._getButtons=function(){var a=this;return[{text:"Save",handler:function(){var b=function(b,c){a.panel.setLoading(!1),a.onSaved.notify()};return null==a.getStockSolution().bufferId?void BUI.showError("Buffer field is mandatory"):""==a.getStockSolution().name?void BUI.showError("Acronym field is mandatory"):""==a.getStockSolution().concentration?void BUI.showError("Concentration field is mandatory"):""==a.getStockSolution().volume?void BUI.showError("Volume field is mandatory"):(a.panel.setLoading("ISPyB: saving stock solution"),void EXI.getDataAdapter({onSuccess:b}).saxs.stockSolution.saveStockSolution(a.getStockSolution()))}}]},StockSolutionForm.prototype.getStockSolution=function(){return null==this.stockSolution?{concentration:Ext.getCmp(this.id+"stockSolution_concentration").getValue(),storageTemperature:this.storageLocationComboBox.getValue(),volume:Ext.getCmp(this.id+"stockSolution_volume").getValue(),comments:Ext.getCmp(this.id+"stockSolution_comments").getValue(),name:Ext.getCmp(this.id+"stockSolution_name").getValue(),bufferId:this.bufferCombo.getValue(),macromoleculeId:this.macromoleculeCombo.getValue(),proposalId:Ext.getCmp("proposalIdCombo").getValue()}:(this.stockSolution.concentration=Ext.getCmp(this.id+"stockSolution_concentration").getValue(),this.stockSolution.storageTemperature=this.storageLocationComboBox.getValue(),this.stockSolution.volume=Ext.getCmp(this.id+"stockSolution_volume").getValue(),this.stockSolution.comments=Ext.getCmp(this.id+"stockSolution_comments").getValue(),this.stockSolution.name=Ext.getCmp(this.id+"stockSolution_name").getValue(),this.stockSolution.proposalId=Ext.getCmp("proposalIdCombo").getValue(),this.stockSolution.bufferId=this.bufferCombo.getValue(),null!=this.macromoleculeCombo.getValue()?this.stockSolution.macromoleculeId=this.macromoleculeCombo.getValue():this.stockSolution.macromolecule3VO=null,this.stockSolution)},StockSolutionForm.prototype.load=function(a){this.stockSolution=a,null!=a&&(null!=a.macromoleculeId&&this.macromoleculeCombo.setValue(a.macromoleculeId),this.bufferCombo.setValue(a.bufferId),Ext.getCmp(this.id+"stockSolution_concentration").setValue(this.stockSolution.concentration),this.storageLocationComboBox.setValue(this.stockSolution.storageTemperature),Ext.getCmp(this.id+"stockSolution_volume").setValue(this.stockSolution.volume),Ext.getCmp(this.id+"stockSolution_name").setValue(this.stockSolution.name),Ext.getCmp(this.id+"stockSolution_comments").setValue(this.stockSolution.comments),null!=a&&null!=a.proposalId&&(Ext.getCmp("proposalIdCombo").setValue(a.proposalId),Ext.getCmp("proposalIdCombo").disable()))},StockSolutionForm.prototype.getBufferCombo=function(){return this.bufferCombo=BIOSAXS_COMBOMANAGER.getComboBuffers(EXI.proposalManager.getBuffers(),{labelWidth:150,margin:"0 0 10 0",width:400}),this.bufferCombo},StockSolutionForm.prototype.getMacromoleculeCombo=function(){return this.macromoleculeCombo=BIOSAXS_COMBOMANAGER.getComboMacromoleculeByMacromolecules(EXI.proposalManager.getMacromolecules(),{labelWidth:150,margin:"0 0 10 0",width:400}),this.macromoleculeCombo},StockSolutionForm.prototype.refresh=function(){},StockSolutionForm.prototype._getTopPanel=function(){return this.storageLocationComboBox=BIOSAXS_COMBOMANAGER.getComboStorageTemperature({labelWidth:150,width:400}),{xtype:"container",layout:"hbox",border:0,buttons:this._getButtons(),items:[{xtype:"container",layout:"hbox",items:[{xtype:"container",flex:1,border:!1,layout:"anchor",defaultType:"textfield",items:[BIOSAXS_COMBOMANAGER.getComboProposal({labelWidth:150,width:400}),this.getMacromoleculeCombo(),this.getBufferCombo(),{xtype:"requiredtextfield",id:this.id+"stockSolution_name",fieldLabel:"Acronym",labelWidth:150,width:400},{xtype:"requiredtextfield",id:this.id+"stockSolution_concentration",fieldLabel:"Conc. (mg/ml)",labelWidth:150,width:400},this.storageLocationComboBox,{xtype:"requiredtextfield",id:this.id+"stockSolution_volume",fieldLabel:"Volume (&#181l)",labelWidth:150,width:400}]}]}]}},StockSolutionForm.prototype.getPanel=function(){return this.panel=Ext.create("Ext.panel.Panel",{padding:0,buttons:this._getButtons(),cls:"border-grid",items:[{xtype:"container",padding:20,items:[this._getTopPanel(),{id:this.id+"stockSolution_comments",xtype:"textareafield",name:"comments",fieldLabel:"Comments",labelWidth:150,width:"100%",height:100}]}]}),this.panel},StockSolutionForm.prototype.input=function(){return{stock:{stockSolutionId:6,proposalId:3124,macromoleculeId:5933,bufferId:811,instructionSet3VO:null,boxId:305861,storageTemperature:"20",volume:"300",concentration:"1.2",comments:"Buffer EDTA with A",name:"A_EDTA_1.2",samples:[],buffer:"EDTA",macromolecule:"A"},proposal:(new MeasurementGrid).input().proposal}},StockSolutionForm.prototype.test=function(a){var b=new StockSolutionForm;BIOSAXS.proposal=new Proposal(b.input().proposal);var c=b.getPanel(new Shipment(b.input().stock));c.render(a)},StockSolutionGrid.prototype._getColumns=function(){var a=this,b=[{header:"Proposal",dataIndex:"proposal",name:"proposalId",flex:1,hidden:!1},{header:"Macromolecule",dataIndex:"macromolecule",id:a.id+"macromolecule",type:"string",renderer:function(a,b,c){return null!=a?'<span style="color:blue;">'+a+"</span>":void 0},hidden:!1,flex:1},{header:"Buffer",dataIndex:"buffer",name:"buffer",hidden:!1,renderer:function(a,b,c){return'<span style="color:green;">'+a+"</span>"},type:"string",flex:1},{header:"Acronym",dataIndex:"name",name:"name",flex:1,hidden:!0},{header:"Storage Temp. (C)",dataIndex:"storageTemperature",name:"storageTemperature",flex:1,hidden:!1},{header:"Volume (&#181l)",name:"volume",dataIndex:"volume",flex:1,hidden:!1},{header:"Concentration (mg/ml)",dataIndex:"concentration",name:"concentration",flex:1},{header:"Packed",dataIndex:"comments",id:a.id+"box",type:"string",width:50,hidden:!this.isPackedVisible,renderer:function(a,b,c){return null!=c.raw.boxId?"<div style='cursor: pointer;'><img height='15px' src='../images/plane.gif'></div>":void 0}},{header:"Comments",dataIndex:"comments",type:"string",flex:1}];return this.btnEditVisible&&b.push({xtype:"actioncolumn",width:40,text:"Edit",items:[{icon:"../images/icon/edit.png",tooltip:"Edit",handler:function(b,c,d){var e=b.getStore().getAt(c);a.edit(e.get("stockSolutionId"))}}]}),this.btnRemoveVisible&&b.push({id:a.id+"buttonRemove",width:85,sortable:!1,renderer:function(b,c,d,e,f,g){return a.btnRemoveVisible?BUI.getRedButton("REMOVE"):void 0}}),this.btnUnpackVisible&&b.push({xtype:"actioncolumn",width:40,text:"Unpack",items:[{icon:"../images/icon/ic_highlight_remove_black_24dp.png",tooltip:"Unpack",handler:function(b,c,d){var e=b.getStore().getAt(c).data;a.unpack(e)}}]}),b},StockSolutionGrid.prototype._getTopButtons=function(){var a=this,b=[];return this.btnAddVisible&&b.push(Ext.create("Ext.Action",{icon:"../images/icon/add.png",text:"Add",tooltip:"Will create a new stock solution",disabled:!1,alwaysEnabled:!0,handler:function(b,c){a.edit()}})),this.btnAddExisting&&b.push(Ext.create("Ext.Action",{icon:"images/icon/add.png",text:"Add Existing",tooltip:"Allows to select upacked stock solutions",disabled:!1,alwaysEnabled:!0,handler:function(b,c){var d=new StockSolutionGrid({btnAddVisible:!1,btnEditVisible:!1,btnRemoveVisible:!1,btnAddExisting:!1,isPackedVisible:!1,multiselect:!0}),e=Ext.create("Ext.window.Window",{title:"Select",height:800,width:900,layout:"fit",items:[d.getPanel()],buttons:[{text:"Pack",handler:function(){d.selectedStockSolutions.length>0&&a.onPack.notify(d.selectedStockSolutions[0]),e.close()}},{text:"Cancel",handler:function(){e.close()}}]}).show();d.load(EXI.proposalManager.getUnpackedStockSolutions())}})),b},StockSolutionGrid.prototype.load=function(a){for(var b=[],c=0;c<a.length;c++){var d=a[c];null!=EXI.proposalManager.getBufferById(d.bufferId)&&(d.buffer=EXI.proposalManager.getBufferById(d.bufferId).acronym),d.proposal=EXI.proposalManager.getProposalById(d.proposalId).code+EXI.proposalManager.getProposalById(d.proposalId).number,null!=EXI.proposalManager.getMacromoleculeById(d.macromoleculeId)&&(d.macromolecule=EXI.proposalManager.getMacromoleculeById(d.macromoleculeId).acronym),b.push(d)}this.store.loadData(b,!1)},StockSolutionGrid.prototype.getPanel=function(){return this._renderGrid()},StockSolutionGrid.prototype.edit=function(a){var b=this,c=new StockSolutionWindow;c.onSaved.attach(function(a,c){b.onSaved.notify(c)}),c.draw(EXI.proposalManager.getStockSolutionById(a))},StockSolutionGrid.prototype.unpack=function(a){this.onUnpack.notify(a)},StockSolutionGrid.prototype._renderGrid=function(){var a=this;this.store=Ext.create("Ext.data.Store",{fields:["proposalId","name","stockSolutionId","macromolecule","buffer","storageTemperature","volume","concentration","buffer","comments"],autoload:!0});var b=({ftype:"filters",local:!0,filters:this.filters},null);b=this.multiselect?Ext.create("Ext.selection.CheckboxModel",{mode:"SINGLE",listeners:{selectionchange:function(b,c){a.selectedStockSolutions=[];for(var d=0;d<c.length;d++)a.selectedStockSolutions.push(c[d].data)}}}):{mode:"SINGLE"},this.store.sort("stockSolutionId","desc"),this.grid=Ext.create("Ext.grid.Panel",{margin:10,cls:"defaultGridPanel",title:this.title,selModel:b,store:this.store,columns:this._getColumns(),viewConfig:{stripeRows:!0,listeners:{itemdblclick:function(b,c,d,e){a.edit(c.data.stockSolutionId)},cellclick:function(b,c,d,e,f,g,h,i){var j=null;b.getGridColumns()[d].getId()==a.id+"box"&&(window.location=BUI.getShippingURL(BIOSAXS.proposal.getShipmentByDewarId(e.raw.boxId).shippingId)),b.getGridColumns()[d].getId()==a.id+"buttonRemove"&&(a.grid.setLoading("ISPyB: Removing stock solution"),j=new BiosaxsDataAdapter,j.onSuccess.attach(function(b){a.onProposalChanged.notify(),a.grid.setLoading(!1)}),j.onError.attach(function(b){a.onProposalChanged.notify(),a.grid.setLoading(!1)}),j.removeStockSolution(e.data.stockSolutionId))}}}});var c=a._getTopButtons(),d=null;return this.grid.getSelectionModel().on({selectionchange:function(a,b){if(b.length)for(d=0;d<c.length;d++)c[d].enable&&c[d].enable();else for(d=0;d<c.length;d++)0==c[d].alwaysEnabled&&c[d].disable&&c[d].disable()}}),this.grid},TemplateGrid.prototype.getTbar=function(){var a=[];return a.push(Ext.create("Ext.Action",{icon:"images/icon/add.png",text:"Add",disabled:!1,handler:function(a,b){var c=new WizardWidget({windowMode:!0,width:1200});c.onFinished.attach(function(a,b){var d=new DataAdapter;d.onSuccess.attach(function(a,b){c.window.close(),location.hash="/experiment/experimentId/"+b.experimentId+"/main"}),c.current.setLoading(),d.saveTemplate(b.name,"comments",b.data)});var d=new ProposalUpdater;d.onSuccess.attach(function(a,b){c.draw(this.targetId,new MeasurementCreatorStepWizardForm(ProposalManager.getMacromolecules(),ProposalManager.getBuffers()))}),d.get()}})),a},TemplateGrid.prototype.deselectAll=function(){this.grid.getSelectionModel().deselectAll()},TemplateGrid.prototype.selectById=function(a){this.grid.getSelectionModel().deselectAll();for(var b=0;b<this.grid.getStore().data.items.length;b++){var c=this.grid.getStore().data.items[b].raw;c.macromoleculeId==a&&this.grid.getSelectionModel().select(b)}},TemplateGrid.prototype.load=function(a){this.store.loadData(a,!1)},TemplateGrid.prototype.getColumns=function(){var a=this,b=[{text:"Name",dataIndex:"name",id:this.id+"name",flex:1,hidden:!1},{xtype:"actioncolumn",width:40,text:"Edit",items:[{icon:"images/icon/edit.png",tooltip:"Edit",handler:function(a,b,c){location.hash="/experiment/experimentId/"+a.getStore().getAt(b).get("experimentId")+"/main"}}]},{id:a.id+"REMOVE",width:100,sortable:!1,renderer:function(a,b,c,d,e,f){return BUI.getRedButton("REMOVE")}}];return this.btnRemoveVisible&&b.push({id:a.id+"buttonRemoveMacromolecule",width:85,sortable:!1,renderer:function(b,c,d,e,f,g){return a.btnRemoveVisible?BUI.getRedButton("REMOVE"):null}}),b},TemplateGrid.prototype._prepareData=function(a){return a},TemplateGrid.prototype.getPanel=function(){return this.store=Ext.create("Ext.data.Store",{fields:["name","comments"],data:[],sorters:[{property:"experimentId",direction:"desc"}]}),this.grid=Ext.create("Ext.grid.Panel",{id:this.id,title:"My Experiments",store:this.store,height:this.height,maxHeight:this.maxHeight,columns:this.getColumns(),width:this.width,viewConfig:{stripeRows:!0,listeners:{celldblclick:function(a,b,c,d,e,f,g,h){location.hash="/experiment/experimentId/"+d.data.experimentId+"/main"},cellclick:function(a,b,c,d,e,f,g,h){}}}}),this.grid.addDocked({xtype:"toolbar",height:50,items:this.getTbar()}),this.grid},TemplateGrid.prototype.input=function(){return{proposal:DATADOC.getProposal_10()}},TemplateGrid.prototype.test=function(a){var b=new b({width:800,height:350,collapsed:!1,tbar:!0});BIOSAXS.proposal=new Proposal(b.input().proposal);var c=b.getPanel(BIOSAXS.proposal.macromolecules);c.render(a)},VolumeGrid.prototype.load=function(a){this.experiment=a,this.store.loadData(this._prepareData(a))},VolumeGrid.prototype.getPanel=function(a,b){var c=this;this.store=Ext.create("Ext.data.Store",{fields:["name","volume","macromoleculeId","bufferId"]}),this.store.sort([{property:"name",direction:"ASC"}]);var d=Ext.create("Ext.grid.Panel",{title:"Sample Requirements and existing stock solutions",cls:"border-grid",height:400,maxHeight:400,width:900,store:this.store,margin:"10 0 50 10",viewConfig:{stripeRows:!0,listeners:{cellclick:function(a,b,d,e,f,g,h,i){if(a.getGridColumns()[d].getId()==c.id+"buttonCreate"){var j=new StockSolutionWindow;j.onSaved.attach(function(a){});var k="ST";null!=e.data.macromoleculeId&&(k=k+"_"+EXI.proposalManager.getMacromoleculeById(e.data.macromoleculeId).acronym),null!=e.data.bufferId&&(k=k+"_"+EXI.proposalManager.getBufferById(e.data.bufferId).acronym),j.draw({concentration:e.data.concentration,macromoleculeId:e.data.macromoleculeId,bufferId:e.data.bufferId,name:k,volume:e.data.volume})}if(a.getGridColumns()[d].getId()==c.id+"buttonStockSolutions"){var l=new StockSolutionGrid({btnAddVisible:!1,btnEditVisible:!1,btnRemoveVisible:!1,btnAddExisting:!1,isPackedVisible:!0,multiselect:!1}),m=Ext.create("Ext.window.Window",{title:"Stock solutions by specimen",height:400,width:800,layout:"fit",items:[l.getPanel()],buttons:[{text:"Close",handler:function(){m.close()}}]}).show();l.refresh(EXI.proposalManager.getStockSolutionsBySpecimen(e.data.macromoleculeId,e.data.bufferId))}}}},columns:[{text:"Specimen",dataIndex:"name",flex:.5},{text:"Estimated Volume",dataIndex:"volume",tooltip:"Estimation of the maximum volume needed for making this experiment",flex:.5,editor:{allowBlank:!0},renderer:function(a,b,c){return BUI.formatValuesUnits(c.data.volume,"&#181l",{fontSize:16,decimals:2,unitsFontSize:this.unitsFontSize})}},{text:"Stock Solution",flex:.5,tooltip:"Stock Solutions containing this specimen in this proposal",renderer:function(a,b,c,d,e,f){var g=c.data.macromoleculeId,h=c.data.bufferId,i=EXI.proposalManager.getStockSolutionsBySpecimen(g,h);return i.length>0?"<div><span style='font-size:18px'>"+i.length+"</span> x<img height='15px' src='images/icon/testtube.png'></div>":void 0}},{id:c.id+"buttonCreate",text:"",hidden:!0,tooltip:"Create a new stock solution for shipping",width:170,sortable:!1,renderer:function(a,b,c,d,e,f){return BUI.getGreenButton("CREATE STOCK SOLUTION",{width:160})}}]});return d},VolumeGrid.prototype._prepareData=function(a){for(var b={},c=0;c<a.getSamples().length;c++){var d=a.getSamples()[c],e="";null==d.macromoleculeId&&(e=a.getBufferById(d.bufferId).acronym,null==b[e]&&(b[e]={macromoleculeId:d.macromoleculeId,name:e,bufferId:d.bufferId,volume:0}),b[e].volume=Number(d.volume)+Number(b[e].volume)),null==d.macromolecule3VO&&null==d.macromoleculeId||(macromoleculeId=d.macromoleculeId,null==d.macromoleculeId&&(d.macromoleculeId=d.macromolecule3VO.macromoleculeId),e=EXI.proposalManager.getMacromoleculeById(d.macromoleculeId).acronym+" + "+a.getBufferById(d.bufferId).acronym,null==b[e]&&(b[e]={macromoleculeId:d.macromoleculeId,name:e,bufferId:d.bufferId,volume:0}),b[e].volume=Number(d.volume)+Number(b[e].volume))}var f=[];for(var g in b)f.push(b[g]);return f},VolumeGrid.prototype.refresh=function(a){this.experiment=a,this.macromoleculeGrid.getStore().loadData(this._prepareData(this.experiment),!1)},VolumeGrid.prototype.render=function(){return this.macromoleculeGrid=this.getPanel([],"Estimation of required Volume"),{xtype:"container",layout:"vbox",margin:"0, 0, 0, 5",items:[{xtype:"container",layout:"hbox",margin:"0, 0, 0, 0",items:[this.macromoleculeGrid]}]}},VolumeGrid.prototype.input=function(a){return{experiment:DATADOC.getExperiment_10()}},VolumeGrid.prototype.test=function(a){var b=new VolumeGrid;BIOSAXS.proposal=new Proposal((new MeasurementGrid).input().proposal);var c=b.getPanel(new Experiment((new VolumeGrid).input().experiment));Ext.create("Ext.panel.Panel",{height:500,width:1e3,renderTo:a,items:[c]})},WizardWidget.prototype.draw=function(a,b){this.targetId=a,this.forms.push(b),this.renderMasterContainer()},WizardWidget.prototype.getButtons=function(a,b,c){var d=this;return null!=d.forms[d.step].onWizardFinished?[{text:"Back",handler:function(){d.step=d.step-1,d.renderMasterContainer(),c(),d.forms[d.step].reload()}},"->",{text:"Finish",handler:function(){d.forms[d.step].onWizardFinished.attach(function(a,b){d.onFinished.notify(b)}),b()}}]:0==a?["->",{text:"Next",handler:function(){d.forms.push(d.forms[d.step].getNextForm()),d.step=d.step+1,d.renderMasterContainer(),b(d.forms[d.step-1].data)}}]:this.step>0&&null==this.forms[d.step].onWizardFinished?[{text:"Back",handler:function(){d.step=d.step-1,d.renderMasterContainer(),c(),d.forms[d.step].reload()}},"->",{text:"Next",handler:function(){null==d.forms[d.step].onWizardFinished?(d.forms.push(d.forms[d.step].getNextForm()),d.step=d.step+1,b(d.forms[d.step-1].data),d.renderMasterContainer()):(d.forms[d.step].onWizardFinished.attach(function(a,b){d.window.close(),d.onFinished.notify(b)}),d.step=d.step+1,b(d.forms[d.step-1].data))}}]:void 0},WizardWidget.prototype.getPanel=function(a){return this.forms.push(a),Ext.create("Ext.form.Panel",{width:this.width,height:800,items:[this.forms[this.step].getForm()],buttons:this.getButtons(this.step,this.forms[this.step].onNext,this.forms[this.step].onBack)})},WizardWidget.prototype.renderMasterContainer=function(){null!=this.current&&this.current.destroy(),null!=this.window&&this.window.destroy(),this.current=this.getPanel(),0==this.windowMode?this.current.render(this.targetId):(this.window=Ext.create("Ext.Window",{id:this.id,resizable:!0,constrain:!0,modal:!0,frame:!1,draggable:!0,autoscroll:!0,layout:{type:"vbox",align:"stretch"},items:this.current,width:this.width,title:"BIOSAXS Experiment Designer",listeners:{scope:this,minimize:function(){this.panel.hide()},destroy:function(){delete this.panel}}}),this.window.show())},function(a){function b(a,b){return a.w("<table class='listView'><tr><td>cardName:</td><td style='color:#207a7a;font-weight:bold;'>").f(b.getPath(!0,["cardName"]),b,"h").w("</td></tr><tr><td>Familiy Name:</td><td>").f(b.getPath(!0,["personVO","familyName"]),b,"h").w("</td></tr><tr><td>Name:</td><td>").f(b.getPath(!0,["personVO","givenName"]),b,"h").w("</td></tr><tr><td>Email:</td><td>").f(b.getPath(!0,["personVO","emailAddress"]),b,"h").w("</td></tr></table>")}return a.register("address.listview",b),b.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w("<table><tr><td class='summary_datacollection_parameter_name'>Code</td><td class='summary_datacollection_parameter'>").f(b.getPath(!0,["code"]),b,"h").w("</td></tr>	<tr><td class='summary_datacollection_parameter_name'>Status</td><td class='summary_datacollection_parameter'>").f(b.getPath(!0,["dewarStatus"]),b,"h").w("</td></tr>	<tr><td class='summary_datacollection_parameter_name'>Pucks</td><td class='summary_datacollection_parameter'>").f(b.getPath(!0,["containerVOs","length"]),b,"h").w("</td></tr>	<tr><td class='summary_datacollection_parameter_name'>BarCode</td><td class='summary_datacollection_parameter'>").f(b.getPath(!0,["barCode"]),b,"h").w("</td></tr>	</table>")}return a.register("dewarlistview",b),b.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w('<div class="panel panel-default"><div class="panel-heading"><h3 class="panel-title">  ').f(b.getPath(!0,["month"]),b,"h").w(" ").f(b.getPath(!0,["day"]),b,"h").w(" ").f(b.getPath(!0,["year"]),b,"h").w("</h3></div><div class=\"panel-body\"><p style='font-size:18px;'>").f(b.getPath(!0,["beamLineName"]),b,"h").w("</p><p>").f(b.getPath(!0,["nbShifts"]),b,"h").w(" shifts</p><div style='font-weight:italic;font-size:10px;width: 100%;  word-break: break-all;  white-space: normal;'>").f(b.getPath(!0,["comments"]),b,"h").w('</div><!-- List group --><ul class="list-group">').h("gt",b,{block:c},{key:b.get(["sampleCount"],!1),value:0},"h").h("gt",b,{block:d},{key:b.get(["testDataCollectionGroupCount"],!1),value:0},"h").h("gt",b,{block:e},{key:b.get(["dataCollectionGroupCount"],!1),value:0},"h").h("gt",b,{block:f},{key:b.get(["xrfSpectrumCount"],!1),value:0},"h").h("gt",b,{block:g},{key:b.get(["energyScanCount"],!1),value:0},"h").w("</ul><p style='font-size:10px;'>Local contact: ").f(b.getPath(!0,["beamLineOperator"]),b,"h").w("</p></div></div>")}function c(a,b){return a.w('<li class="list-group-item"><span style=\'background-color:#337ab7;\' class="badge badge-primary">').f(b.getPath(!0,["sampleCount"]),b,"h").w("</span>Samples</li>")}function d(a,b){return a.w('<li class="list-group-item"><span style=\'background-color:#337ab7;\' class="badge">').f(b.getPath(!0,["testDataCollectionGroupCount"]),b,"h").w("</span>Tests</li>")}function e(a,b){return a.w('<li class="list-group-item"><span style=\'background-color:#337ab7;\' class="badge">').f(b.getPath(!0,["dataCollectionGroupCount"]),b,"h").w("</span>Data Collections</li>")}function f(a,b){return a.w('<li class="list-group-item"><span style=\'background-color:#337ab7;\' class="badge">').f(b.getPath(!0,["xrfSpectrumCount"]),b,"h").w("</span>Spectra</li>")}function g(a,b){return a.w('<li class="list-group-item"><span style=\'background-color:#337ab7;\' class="badge">').f(b.getPath(!0,["energyScanCount"]),b,"h").w("</span>Energy Scans</li>")}return a.register("session.listview",b),b.__dustBody=!0,c.__dustBody=!0,d.__dustBody=!0,e.__dustBody=!0,f.__dustBody=!0,g.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w('<div class="panel panel-default"><div class="panel-heading"><h3 class="panel-title">').f(b.getPath(!0,["proposal"]),b,"h").w('</h3></div><div class="panel-body">').f(b.getPath(!0,["title"]),b,"h").w("<br />").f(b.getPath(!0,["sessionCount"]),b,"h").w(" sessions</div></div>")}return a.register("welcomemainviewproposalheader",b),b.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w("<table> <tr><td>Name:</td><td style='color:#207a7a;font-weight:bold;'>").f(b.getPath(!0,["Shipping_shippingName"]),b,"h").w("</td></tr><tr><td>Type:</td><td>").f(b.getPath(!0,["Shipping_shippingType"]),b,"h").w("</td></tr><tr><td>Status:</td><td>").f(b.getPath(!0,["Shipping_shippingStatus"]),b,"h").w("</td></tr></table>")}return a.register("shipping.listview",b),b.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w("<table> <tr><td>Program:</td><td style='color:#207a7a;font-weight:bold;'>").f(b.getPath(!0,["v_datacollection_processingPrograms"]),b,"h").w("</td></tr><tr><td>Space group:</td><td>").f(b.getPath(!0,["v_datacollection_summary_phasing_autoproc_space_group"]),b,"h").w("</td></tr>	</table>")}return a.register("autoprocintegration.listview",b),b.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w('<div class="container-fluid"><div class="panel with-nav-tabs panel-default"><div class="panel-heading clearfix"><div class="pull-left">                                <h1 class="panel-title" style=\'color:#337ab7;\'><kbd> ').f(b.getPath(!0,["v_datacollection_processingPrograms"]),b,"h").w("</kbd><kbd style='background-color:#337ab7;'>").f(b.getPath(!0,["v_datacollection_summary_phasing_autoproc_space_group"]),b,"h").w(" </kbd>").h("eq",b,{block:c},{key:b.get(["v_datacollection_summary_phasing_anomalous"],!1),value:"true",type:"boolean"},"h").w('</h1></div><div class="pull-right"><ul class="nav nav-tabs"><li class="active"><a data-toggle="tab" href="#autoproc_').f(b.get(["AutoProcIntegration_autoProcIntegrationId"],!1),b,"h").w('">Statistics</a></li><li ><a data-toggle="tab" href="#tab_files_').f(b.getPath(!0,["v_datacollection_summary_phasing_autoProcProgramId"]),b,"h").w('">Files</a></li><li ><a data-toggle="tab" href="#plots').f(b.getPath(!0,["v_datacollection_summary_phasing_autoProcProgramId"]),b,"h").w('">Plots</a></li></ul></div></div><br /><div class="tab-content"><div id="autoproc_').f(b.get(["AutoProcIntegration_autoProcIntegrationId"],!1),b,"h").w('" class="tab-pane fade in active"><div class="container-fluid"><div class="row"><div class="col-xs-6 col-md-2">                   ').p("unitcell.autoprocintegrationgrid.template",b,b,{}).w('                             </div><div class="col-xs-6 col-md-7">').p("statistics.autoprocintegrationgrid.template",b,b,{}).w('                         </div><div class="col-xs-6 col-md-1">').p("phasing.autoprocintegrationgrid.template",b,b,{}).w('                         </div></div></div></div><div id="tab_files_').f(b.getPath(!0,["v_datacollection_summary_phasing_autoProcProgramId"]),b,"h").w('" class="tab-pane fade"><div class="container-fluid"><div id="fl_').f(b.getPath(!0,["v_datacollection_summary_phasing_autoProcProgramId"]),b,"h").w('" class="row"></div></div></div><div id="plots').f(b.getPath(!0,["v_datacollection_summary_phasing_autoProcProgramId"]),b,"h").w('" class="tab-pane fade">').p("plots.autoprocintegrationgrid.template",b,b,{}).w("  </div>                  </div></div></div>")}function c(a,b){return a.w("                                          <kbd style='background-color:orange;'>ANOMALOUS</kbd> ")}return a.register("autoprocintegrationgrid.template",b),b.__dustBody=!0,c.__dustBody=!0,b}(dust),function(a){function b(a,b){return a}return a.register("autoprocintegrationgrid_tool",b),b.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w('<div class="container-fluid containerWithScroll"><div class="row"><div class="col-xs-12 col-md-2"><table style=\'width: 100px;font-size:10px\' class=\'table\'><tbody><tr><th class=\'innershell\' >InnerShell</th><th class=\'overallshell\' >Overall</th><th class=\'outershell\' >OuterShell</th></tr></tbody></table><table class="table table-striped table-hover"><thead><tr><th  ><a href="#"  data-toggle="tooltip" title="Rank is done based on the space group and lower rMerge">Rank</a></th><th  >Pipeline</th><th  >SpaceGroup</th><th  >Anom</th><th  >A</th><th > B</th><th > C</th><th  >&#x3B1;</th><th >&beta;</th><th >&gamma;</th><th >Resolution</th><th >Multiplicity</th><th >Completeness</th><th >I/Sigma</th><th >Rmeas</th><th >Rmerge</th><th >Rpim</th><th >cc(1/2)</th><th >Download</th></tr></thead>').s(b.getPath(!0,[]),b,{block:c},{}).w("</table></div></div></div>")}function c(a,b){return a.w("<tr><td  >#").f(b.getPath(!0,["rank"]),b,"h").w('</td><td  ><a target="_blank" href=\'#/autoprocintegration/datacollection/').f(b.getPath(!0,["AutoProcIntegration_dataCollectionId"]),b,"h").w("/main'>").f(b.getPath(!0,["v_datacollection_processingPrograms"]),b,"h").w("</a></td><td  >").f(b.getPath(!0,["v_datacollection_summary_phasing_autoproc_space_group"]),b,"h").w("</td><td  >").h("eq",b,{
"else":d,block:e},{key:b.get(["v_datacollection_summary_phasing_anomalous"],!1),type:"boolean",value:"true"},"h").w("</td><td  >").h("decimal",b,{block:f},{key:"v_datacollection_summary_phasing_cell_a",decimals:1},"h").w("</td><td >").h("decimal",b,{block:g},{key:"v_datacollection_summary_phasing_cell_b",decimals:1},"h").w("</td><td >").h("decimal",b,{block:h},{key:"v_datacollection_summary_phasing_cell_c",decimals:1},"h").w("</td><td  >").h("decimal",b,{block:i},{key:"v_datacollection_summary_phasing_cell_alpha",decimals:1},"h").w("</td><td >").h("decimal",b,{block:j},{key:"v_datacollection_summary_phasing_cell_beta",decimals:1},"h").w("</td><td >").h("decimal",b,{block:k},{key:"v_datacollection_summary_phasing_cell_gamma",decimals:1},"h").w("</td><td ><span class='innershell'>").f(b.getPath(!0,["innerShell","resolutionLimitLow"]),b,"h").w("-").f(b.getPath(!0,["innerShell","resolutionLimitHigh"]),b,"h").w(" </span><span class='overallshell'>").f(b.getPath(!0,["overall","resolutionLimitLow"]),b,"h").w("-").f(b.getPath(!0,["overall","resolutionLimitHigh"]),b,"h").w(" </span> <span class='outershell'>").f(b.getPath(!0,["outerShell","resolutionLimitLow"]),b,"h").w("-").f(b.getPath(!0,["outerShell","resolutionLimitHigh"]),b,"h").w("</span></td><td ><span class='innershell'>").f(b.getPath(!0,["innerShell","multiplicity"]),b,"h").w(" </span><span class='overallshell'>").f(b.getPath(!0,["overall","multiplicity"]),b,"h").w("</span> <span class='outershell'>").f(b.getPath(!0,["outerShell","multiplicity"]),b,"h").w("</span></td><td ><span class='innershell'>").f(b.getPath(!0,["innerShell","completeness"]),b,"h").w(" </span><span class='overallshell'>").f(b.getPath(!0,["overall","completeness"]),b,"h").w("</span> <span class='outershell'>").f(b.getPath(!0,["outerShell","completeness"]),b,"h").w("</span></td><td ><span class='innershell'>").f(b.getPath(!0,["innerShell","meanIOverSigI"]),b,"h").w(" </span><span class='overallshell'>").f(b.getPath(!0,["overall","meanIOverSigI"]),b,"h").w("</span> <span class='outershell'>").f(b.getPath(!0,["outerShell","meanIOverSigI"]),b,"h").w("</span></td><td ><span class='innershell'>").f(b.getPath(!0,["innerShell","rMeasAllIPlusIMinus"]),b,"h").w(" </span><span class='overallshell'>").f(b.getPath(!0,["overall","rMeasAllIPlusIMinus"]),b,"h").w("</span> <span class='outershell'>").f(b.getPath(!0,["outerShell","rMeasAllIPlusIMinus"]),b,"h").w("</span></td><td ><span class='innershell'>").f(b.getPath(!0,["innerShell","rMerge"]),b,"h").w(" </span><span class='overallshell'>").f(b.getPath(!0,["overall","rMerge"]),b,"h").w("</span> <span class='outershell'>").f(b.getPath(!0,["outerShell","rMerge"]),b,"h").w("</span></td><td ><span class='innershell'>").f(b.getPath(!0,["innerShell","rPimWithinIPlusIMinus"]),b,"h").w(" </span><span class='overallshell'>").f(b.getPath(!0,["overall","rPimWithinIPlusIMinus"]),b,"h").w("</span> <span class='outershell'>").f(b.getPath(!0,["outerShell","rPimWithinIPlusIMinus"]),b,"h").w("</span></td><td ><span class='innershell'>").f(b.getPath(!0,["innerShell","ccHalf"]),b,"h").w(" </span><span class='overallshell'>").f(b.getPath(!0,["overall","ccHalf"]),b,"h").w("</span> <span class='outershell'>").f(b.getPath(!0,["outerShell","ccHalf"]),b,"h").w("</span></td><td ><a href='").f(b.getPath(!0,["downloadFilesUrl"]),b,"h").w("' ><span style='font-size: 1.5em;' class=\"glyphicon glyphicon-download \" ></span></a></td></tr>")}function d(a,b){return a}function e(a,b){return a.w("<span style='color:green;' class=\"glyphicon glyphicon-ok\"></span>")}function f(a,b){return a}function g(a,b){return a}function h(a,b){return a}function i(a,b){return a}function j(a,b){return a}function k(a,b){return a}return a.register("collapsed.autoprocintegrationgrid.template",b),b.__dustBody=!0,c.__dustBody=!0,d.__dustBody=!0,e.__dustBody=!0,f.__dustBody=!0,g.__dustBody=!0,h.__dustBody=!0,i.__dustBody=!0,j.__dustBody=!0,k.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w(' <div class="container-fluid" class=\'containerWithScroll\' ><div class="row"><div class="col-xs-12 col-md-2" >        <table class="table"  ><thead><tr><th>Name</th><th>Type</th><th>Path</th></tr></thead>').s(b.getPath(!0,[]),b,{block:c},{}).w("    </table></div></div></div>")}function c(a,b){return a.w("<tbody><tr><td><a href='").f(b.getPath(!0,["url"]),b,"h").w("'>").f(b.getPath(!0,["fileName"]),b,"h").w("</a></td> <td>").f(b.getPath(!0,["fileType"]),b,"h").w("</td> <td>").f(b.getPath(!0,["filePath"]),b,"h").w("</td></tr></tbody>")}return a.register("files.autoprocintegrationgrid.template",b),b.__dustBody=!0,c.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w("<table class='table-sm table table-striped'>").s(b.getPath(!0,["phasing","0"]),b,{block:c},{}).w("<tbody>               ").s(b.getPath(!0,["phasing"]),b,{block:d},{}).w("</tbody></table>")}function c(a,b){return a.w('	<thead>   <tr><th>Phasing</th><th><abbr title="Prepare Step">PR</abbr></th><th><abbr title="Substructure Determination Step">SU</abbr></th><th><abbr title="Phasing Step">PH</abbr></th><th><abbr title="Model Building Step">MO</abbr></th></tr></thead>')}function d(a,b){return a.w("		<tr><td><a href='#/phasing/autoprocintegrationId/").f(b.getPath(!0,["autoProcIntegrationId"]),b,"h").w("/main'>").f(b.getPath(!0,["spaceGroup"]),b,"h").w("</a></td><td>").h("eq",b,{"else":e,block:f},{key:b.get(["prepare"],!1),type:"boolean",value:"true"},"h").w("</td><td>").h("eq",b,{"else":g,block:h},{key:b.get(["sub"],!1),type:"boolean",value:"true"},"h").w("</td><td>").h("eq",b,{"else":i,block:j},{key:b.get(["phasing"],!1),type:"boolean",value:"true"},"h").w("</td><td>").h("eq",b,{"else":k,block:l},{key:b.get(["model"],!1),type:"boolean",value:"true"},"h").w("</td></tr>")}function e(a,b){return a.w("<span style='color:red;' class=\"glyphicon glyphicon-remove\"></span>")}function f(a,b){return a.w("<span style='color:green;' class=\"glyphicon glyphicon-ok\"></span>")}function g(a,b){return a.w("<span style='color:red;' class=\"glyphicon glyphicon-remove\"></span>")}function h(a,b){return a.w("<span style='color:green;' class=\"glyphicon glyphicon-ok\"></span>")}function i(a,b){return a.w("<span style='color:red;' class=\"glyphicon glyphicon-remove\"></span>")}function j(a,b){return a.w("<span style='color:green;' class=\"glyphicon glyphicon-ok\"></span>")}function k(a,b){return a.w("<span style='color:red;' class=\"glyphicon glyphicon-remove\"></span>")}function l(a,b){return a.w("<span style='color:green;' class=\"glyphicon glyphicon-ok\"></span>")}return a.register("phasing.autoprocintegrationgrid.template",b),b.__dustBody=!0,c.__dustBody=!0,d.__dustBody=!0,e.__dustBody=!0,f.__dustBody=!0,g.__dustBody=!0,h.__dustBody=!0,i.__dustBody=!0,j.__dustBody=!0,k.__dustBody=!0,l.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w(' <div class="container-fluid"><div class="row"><div id=\'rFactor_').f(b.getPath(!0,["v_datacollection_summary_phasing_autoProcProgramId"]),b,"h").w('\' class="col-xs-12 col-md-4">                   1   ').f(b.getPath(!0,["v_datacollection_summary_phasing_autoProcProgramId"]),b,"h").w("                        </div><div id='completeness_").f(b.getPath(!0,["v_datacollection_summary_phasing_autoProcProgramId"]),b,"h").w("' class=\"col-xs-12 col-md-4\">                    2                        </div><div id='sigmaI_").f(b.getPath(!0,["v_datacollection_summary_phasing_autoProcProgramId"]),b,"h").w('\' class="col-xs-12 col-md-4">3                    </div></div><div class="row"><div id=\'cc2_').f(b.getPath(!0,["v_datacollection_summary_phasing_autoProcProgramId"]),b,"h").w("' class=\"col-xs-12 col-md-4\">                   4                           </div><div id='sigmaAnno_").f(b.getPath(!0,["v_datacollection_summary_phasing_autoProcProgramId"]),b,"h").w("' class=\"col-xs-12 col-md-4\">                    5                       </div><div id='anno_").f(b.getPath(!0,["v_datacollection_summary_phasing_autoProcProgramId"]),b,"h").w('\' class="col-xs-12 col-md-4">6                    </div></div></div>')}return a.register("plots.autoprocintegrationgrid.template",b),b.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w("<table class='table-sm table table-striped'><thead><tr><th style='padding:0 15px 0 15px;'>Data Range</th><th style='padding:0 15px 0 15px;'>Resolution</th><th style='padding:0 15px 0 15px;'>Multiplicity</th><th style='padding:0 15px 0 15px;'>Completeness</th><th  style='padding:0 15px 0 15px;'>I/Sigmal</th><th style='padding:0 15px 0 15px;'>Rmeas</th><th style='padding:0 15px 0 15px;'>Rmerge</th><th style='padding:0 15px 0 15px;'>Rpim</th><th style='padding:0 15px 0 15px;'>cc(1/2)</th></tr></thead><tbody>").s(b.getPath(!0,["statistics"]),b,{block:c},{}).w("<tbody></table>")}function c(a,b){return a.w("<tr><td>").f(b.getPath(!0,["type"]),b,"h").w("</td><td >").h("decimal",b,{block:d},{key:"resolutionLimitLow",decimals:1},"h").w(" - ").h("decimal",b,{block:e},{key:"resolutionLimitHigh",decimals:1},"h").w("</td><td >").h("decimal",b,{block:f},{key:"multiplicity",decimals:1},"h").w("</td><td > ").h("gt",b,{block:g},{key:b.get(["completeness"],!1),value:20},"h").h("lte",b,{block:l},{key:b.get(["completeness"],!1),value:20},"h").w("</td><td > ").h("decimal",b,{block:n},{key:"meanIOverSigI",decimals:1},"h").w("</td><td > ").h("decimal",b,{block:o},{key:"rMeasAllIPlusIMinus",decimals:1},"h").w("</td><td > ").h("decimal",b,{block:p},{key:"rMerge",decimals:1},"h").w("</td><td > ").h("decimal",b,{block:q},{key:"rPimWithinIPlusIMinus",decimals:1},"h").w("</td><td > ").h("decimal",b,{block:r},{key:"ccHalf",decimals:1},"h").w("</td></tr>	")}function d(a,b){return a}function e(a,b){return a}function f(a,b){return a}function g(a,b){return a.h("gt",b,{"else":h,block:j},{key:b.get(["completeness"],!1),value:60},"h")}function h(a,b){return a.w('<div  style="background-repeat: repeat-x;border:1px solid #f0ad4e;color:#fff;background-color:#f0ad4e;width:').f(b.getPath(!0,["completeness"]),b,"h").w('%">                        ').h("decimal",b,{block:i},{key:"completeness",decimals:0},"h").w("%</div>")}function i(a,b){return a}function j(a,b){return a.w('<div  style="background-repeat: repeat-x;border:1px solid gray;color:#fff;background-image:linear-gradient(to bottom,#337ab7 0,#286090 100%);width:').f(b.getPath(!0,["completeness"]),b,"h").w('%">').h("decimal",b,{block:k},{key:"completeness",decimals:0},"h").w("%</div>")}function k(a,b){return a}function l(a,b){return a.w('<div  style="background-repeat: repeat-x;border:1px solid #d9534f;color:#fff;background-color:#d9534f;width:').f(b.getPath(!0,["completeness"]),b,"h").w('%">').h("decimal",b,{block:m},{key:"completeness",decimals:0},"h").w("%</div>")}function m(a,b){return a}function n(a,b){return a}function o(a,b){return a}function p(a,b){return a}function q(a,b){return a}function r(a,b){return a}return a.register("statistics.autoprocintegrationgrid.template",b),b.__dustBody=!0,c.__dustBody=!0,d.__dustBody=!0,e.__dustBody=!0,f.__dustBody=!0,g.__dustBody=!0,h.__dustBody=!0,i.__dustBody=!0,j.__dustBody=!0,k.__dustBody=!0,l.__dustBody=!0,m.__dustBody=!0,n.__dustBody=!0,o.__dustBody=!0,p.__dustBody=!0,q.__dustBody=!0,r.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w("<table class='table table-striped'><thead>   <tr><th  style='padding:0 15px 0 15px;'>cell A</th><th style='padding:0 15px 0 15px;'>cell B</th><th style='padding:0 15px 0 15px;'>cell C</th></tr></thead><tbody><tr><td  style='padding:0 15px 0 15px;'>").h("decimal",b,{block:c},{key:"v_datacollection_summary_phasing_cell_a",decimals:1},"h").w("</td><td style='padding:0 15px 0 15px;'>").h("decimal",b,{block:d},{key:"v_datacollection_summary_phasing_cell_b",decimals:1},"h").w("</td><td style='padding:0 15px 0 15px;'>").h("decimal",b,{block:e},{key:"v_datacollection_summary_phasing_cell_c",decimals:1},"h").w("</td></tr></tbody></table><table class='table table-striped'><thead>   <tr><th  style='padding:0 15px 0 15px;'>Alpha</th><th style='padding:0 15px 0 15px;'>Beta</th><th style='padding:0 15px 0 15px;'>Gamma</th></tr></thead><tbody><tr><td  style='padding:0 15px 0 15px;'>").h("decimal",b,{block:f},{key:"v_datacollection_summary_phasing_cell_alpha",decimals:1},"h").w("</td><td style='padding:0 15px 0 15px;'>").h("decimal",b,{block:g},{key:"v_datacollection_summary_phasing_cell_beta",decimals:1},"h").w("</td><td style='padding:0 15px 0 15px;'>").h("decimal",b,{block:h},{key:"v_datacollection_summary_phasing_cell_gamma",decimals:1},"h").w("</td></tr></tbody></table>")}function c(a,b){return a}function d(a,b){return a}function e(a,b){return a}function f(a,b){return a}function g(a,b){return a}function h(a,b){return a}return a.register("unitcell.autoprocintegrationgrid.template",b),b.__dustBody=!0,c.__dustBody=!0,d.__dustBody=!0,e.__dustBody=!0,f.__dustBody=!0,g.__dustBody=!0,h.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w("<table> <tr><td>Acronym:</td><td style='color:#207a7a;font-weight:bold;'>").f(b.getPath(!0,["proteinVO","acronym"]),b,"h").w("</td></tr><tr><td>Name:</td><td>").f(b.getPath(!0,["proteinVO","name"]),b,"h").w("</td></tr><tr><td>Experiment:</td><td>").f(b.getPath(!0,["diffractionPlanVO","experimentKind"]),b,"h").w("</td></tr><tr><td>Space Group:</td><td>").f(b.getPath(!0,["spaceGroup"]),b,"h").w("</td></tr></table>")}return a.register("crystal.listview",b),b.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.s(b.getPath(!0,["onlineresults","0"]),b,{block:c},{})}function c(a,b){return a.w("       ").p("completeness.autoproc.mxdatacollectiongrid.template",b,b,{}).w("<br />                    ").p("unitcell.autoproc.mxdatacollectiongrid.template",b,b,{}).w("         ")}return a.register("autoproc.mxdatacollectiongrid.template",b),b.__dustBody=!0,c.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w("<table class=\"table\">                    <tr><td>Number of passes</td><td  class='column_parameter_value'> ").f(b.getPath(!0,["DataCollection_numberOfPasses"]),b,"h").w("</td></tr><tr><td>Detector Distance</td><td  class='column_parameter_value'>").f(b.getPath(!0,["DataCollection_detectorDistance"]),b,"h").w(" mm</td></tr><tr><td>X Beam</td><td  class='column_parameter_value'>").f(b.getPath(!0,["DataCollection_xBeam"]),b,"h").w("</td></tr><tr><td>Y Beam</td><td  class='column_parameter_value'>").f(b.getPath(!0,["DataCollection_yBeam"]),b,"h").w("</td></tr><tr><td>Kappa Start</td><td  class='column_parameter_value'>").f(b.getPath(!0,["DataCollection_kappaStart"]),b,"h").w("</td></tr><tr><td>Phi Start</td><td  class='column_parameter_value'>").f(b.getPath(!0,["DataCollection_phiStart"]),b,"h").w("</td></tr></table>       ")}return a.register("beamline.mxdatacollectiongrid.template",b),b.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w('<div class="container-fluid"><div class="row"><div class="col-xs-6 col-md-1">#').f(b.getPath(!0,["DataCollection_dataCollectionNumber"]),b,"h").w(" ").f(b.getPath(!0,["DataCollectionGroup_experimentType"]),b,"h").w(" <br />").f(b.getPath(!0,["DataCollectionGroup_startTime"]),b,"h").w("</div><div class=\"col-xs-6 col-md-2\"><table class='table-sm table-condensed '><thead><tr><th  colspan=2 style='padding:0 15px 0 15px;'> </th></tr></thead><tbody><tr><td  style='padding:0 15px 0 15px;'>Protein</td><td  style='padding:0 15px 0 15px;' class='column_parameter_value'>").f(b.getPath(!0,["Protein_acronym"]),b,"h").w("</td></tr><tr><td  style='padding:0 15px 0 15px;'>Prefix</td><td  style='padding:0 15px 0 15px;'><a href='#/mx/datacollection/datacollectionid/").f(b.getPath(!0,["DataCollection_dataCollectionId"]),b,"h").w("/main'>").f(b.getPath(!0,["DataCollection_imagePrefix"]),b,"h").w("</a></td></tr><tr><td  style='padding:0 15px 0 15px;'>Images</td><td  style='padding:0 15px 0 15px;' class='column_parameter_value'>").f(b.getPath(!0,["totalNumberOfImages"]),b,"h").w("</td></tr></tbody></table></div><div class=\"col-xs-6 col-md-2\"><table class='table-sm table-condensed'><thead><tr><th  colspan=2 style='padding:0 15px 0 15px;'></th></tr></thead><tbody><tr><td  style='padding:0 15px 0 15px;'>Type</td><td  style='padding:0 15px 0 15px;' class='column_parameter_value'>").f(b.getPath(!0,["DataCollectionGroup_experimentType"]),b,"h").w("</td></tr><tr><td  style='padding:0 15px 0 15px;'>Res. (corner)</td><td  style='padding:0 15px 0 15px;' class='column_parameter_value'>").f(b.getPath(!0,["DataCollection_resolution"]),b,"h").w(" &#8491; (").f(b.getPath(!0,["DataCollection_resolutionAtCorner"]),b,"h").w(" &#8491;)</td></tr><tr><td  style='padding:0 15px 0 15px;'>Wavelenth</td><td  style='padding:0 15px 0 15px;' class='column_parameter_value'>").f(b.getPath(!0,["DataCollection_wavelength"]),b,"h").w(' &#8491;</td></tr></tbody></table></div><div class="col-xs-6 col-md-2">').s(b.getPath(!0,["onlineresults","0"]),b,{block:c},{}).w('                           </div><div class="col-xs-12 col-md-2">').s(b.getPath(!0,["onlineresults","0"]),b,{block:d},{}).w("                           </div><div class=\"col-sm-2 col-md-1 \" style='margin: 0 10px 10px 0;'>").s(b.getPath(!0,["autoprocessing"]),b,{block:e},{}).w("</div><div class=\"col-sm-2 col-md-1 \" style='margin: 0 10px 10px 0;'>").s(b.getPath(!0,["screening"]),b,{block:k},{}).w("</div></div></div>")}function c(a,b){return a.w("       ").p("sm.completeness.autoproc.mxdatacollectiongrid.template",b,b,{})}function d(a,b){return a.w("       ").p("unitcell.autoproc.mxdatacollectiongrid.template",b,b,{}).w("       ")}function e(a,b){return a.h("gt",b,{block:f},{key:b.getPath(!1,["items","length"]),value:0},"h")}function f(a,b){return a.w("  ").s(b.getPath(!0,[]),b,{block:g},{}).w(" ")}function g(a,b){return a.w("<table class='table-sm table-condensed'>").s(b.getPath(!0,["items"]),b,{block:h},{}).w("</table>")}function h(a,b){return a.w("<tr>").h("eq",b,{block:i},{key:b.get(["status"],!1),value:"Success"},"h").h("ne",b,{block:j},{key:b.get(["status"],!1),value:"Success"},"h").w("</tr>")}function i(a,b){return a.w("<td> <span style='color:green;' class=\"glyphicon glyphicon-ok\"></span></td><td>").f(b.getPath(!0,["name"]),b,"h").w(" </td>")}function j(a,b){return a.w(" <td> <span style='color:red;' class=\"glyphicon glyphicon-remove\"></span></td><td>").f(b.getPath(!0,["name"]),b,"h").w(" </td>")}function k(a,b){return a.h("gt",b,{block:l},{key:b.getPath(!1,["items","length"]),value:0},"h")}function l(a,b){return a.w("  ").s(b.getPath(!0,[]),b,{block:m},{}).w(" ")}function m(a,b){return a.w("<table class='table-sm table-condensed'>").s(b.getPath(!0,["items"]),b,{block:n},{}).w("</table>")}function n(a,b){return a.w("<tr>").h("eq",b,{block:o},{key:b.get(["status"],!1),value:"Success"},"h").h("ne",b,{block:p},{key:b.get(["status"],!1),value:"Success"},"h").w("</tr>")}function o(a,b){return a.w("<td> <span style='color:green;' class=\"glyphicon glyphicon-ok\"></span></td><td>").f(b.getPath(!0,["name"]),b,"h").w(" </td>")}function p(a,b){return a.w(" <td> <span style='color:red;' class=\"glyphicon glyphicon-remove\"></span></td><td>").f(b.getPath(!0,["name"]),b,"h").w(" </td>")}return a.register("collapsed.mxdatacollectiongrid.template",b),b.__dustBody=!0,c.__dustBody=!0,d.__dustBody=!0,e.__dustBody=!0,f.__dustBody=!0,g.__dustBody=!0,h.__dustBody=!0,i.__dustBody=!0,j.__dustBody=!0,k.__dustBody=!0,l.__dustBody=!0,m.__dustBody=!0,n.__dustBody=!0,o.__dustBody=!0,p.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w("<table class='table-sm'><thead><tr><th>").f(b.getPath(!0,["spaceGroup"]),b,"h").w('</th><th style=\'padding:0 15px 0 15px;\'>Completeness</th><th style=\'padding:0 15px 0 15px;\'>Res.</th><th>Rmerge</th></tr><tr><td valign="top">Inner</td><td><div class="progress"><div class="progress-bar progress-bar"  role="progressbar" aria-valuenow="').f(b.getPath(!0,["innerShell","completeness"]),b,"h").w('" aria-valuemin="0" aria-valuemax="100" style="width:').f(b.getPath(!0,["innerShell","completeness"]),b,"h").w('%">').f(b.getPath(!0,["innerShell","completeness"]),b,"h").w("%</div></div></td><td valign=\"top\" style='padding:0 15px 0 15px;'>").f(b.getPath(!0,["innerShell","resolutionsLimitHigh"]),b,"h").w('</td><td valign="top">').f(b.getPath(!0,["innerShell","rMerge"]),b,"h").w('</td></tr><tr><td valign="top">Outer</td><td><div class="progress"><div class="progress-bar progress-bar"   role="progressbar" aria-valuenow="').f(b.getPath(!0,["outerShell","completeness"]),b,"h").w('" aria-valuemin="0" aria-valuemax="100" style="width:').f(b.getPath(!0,["outerShell","completeness"]),b,"h").w('%">').f(b.getPath(!0,["outerShell","completeness"]),b,"h").w("%</div></div></td><td valign=\"top\" style='padding:0 15px 0 15px;'>").f(b.getPath(!0,["outerShell","resolutionsLimitHigh"]),b,"h").w('</td><td valign="top">').f(b.getPath(!0,["outerShell","rMerge"]),b,"h").w('</td></tr><tr><td valign="top">Overall</td><td><div class="progress"><div class="progress-bar progress-bar"   role="progressbar" aria-valuenow="').f(b.getPath(!0,["overall","completeness"]),b,"h").w('" aria-valuemin="0" aria-valuemax="100" style="width:').f(b.getPath(!0,["overall","completeness"]),b,"h").w('%">').f(b.getPath(!0,["overall","completeness"]),b,"h").w("%</div></div></td><td valign=\"top\"  style='padding:0 15px 0 15px;'>").f(b.getPath(!0,["overall","resolutionsLimitHigh"]),b,"h").w('</td><td valign="top">').f(b.getPath(!0,["overall","rMerge"]),b,"h").w("</td></tr></thead></table>")}return a.register("completeness.autoproc.mxdatacollectiongrid.template",b),b.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w(' <div class="container-fluid containerWithScroll" ><div class="row"><div class="col-xs-12 col-md-2">        <table class="table table-striped table-hover"><thead><tr><th>Run</th><th>Prefix</th><th>#Images</th><th>ExposureTime</th><th>Res. (corner)</th><th>Wavelenth</th><th>Transmission</th><th>Directory</th><th>Time</th><th>Run status</th></tr></thead>').s(b.getPath(!0,[]),b,{block:c},{}).w("    </table></div></div></div>")}function c(a,b){return a.h("eq",b,{"else":d,block:e},{key:b.get(["runStatus"],!1),value:"failed"},"h").w("    <td>#").f(b.getPath(!0,["dataCollectionNumber"]),b,"h").w("</td><td>").f(b.getPath(!0,["imagePrefix"]),b,"h").w("</td><td ><span class=\"badge\" style='background-color:#337ab7;'>").f(b.getPath(!0,["numberOfImages"]),b,"h").w("</span></td><td >").f(b.getPath(!0,["exposureTime"]),b,"h").w(" s</td><td >").h("decimal",b,{block:f},{key:"resolution",decimals:1},"h").w(" &#8491; (").h("decimal",b,{block:g},{key:"resolutionAtCorner",decimals:1},"h").w(" &#8491;)</td><td > ").h("decimal",b,{block:h},{key:"wavelength",decimals:1},"h").w(" &#8491;</td><td>").f(b.getPath(!0,["transmission"]),b,"h").w("%</td><td>").f(b.getPath(!0,["imageDirectory"]),b,"h").w("</td><td>").f(b.getPath(!0,["startTime"]),b,"h").w("</td><td>").f(b.getPath(!0,["runStatus"]),b,"h").w("</td></tr>")}function d(a,b){return a.w("<tr>")}function e(a,b){return a.w('<tr class="danger">')}function f(a,b){return a}function g(a,b){return a}function h(a,b){return a}return a.register("datacollections.mxdatacollectiongrid.template",b),b.__dustBody=!0,c.__dustBody=!0,d.__dustBody=!0,e.__dustBody=!0,f.__dustBody=!0,g.__dustBody=!0,h.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w("<table class=\"table\">                    <tr><td>Detector Type</td><td  class='column_parameter_value'> ").f(b.getPath(!0,["detectorType"]),b,"h").w("</td></tr><tr><td>Detector Model</td><td  class='column_parameter_value'>").f(b.getPath(!0,["detectorModel"]),b,"h").w("</td></tr><tr><td>Manufacturer</td><td  class='column_parameter_value'>").f(b.getPath(!0,["detectorManufacturer"]),b,"h").w("</td></tr><tr><td>Hor. Pixel Size</td><td  class='column_parameter_value'>").f(b.getPath(!0,["detectorPixelSizeHorizontal"]),b,"h").w("</td></tr><tr><td>Ver. Pixel Size</td><td  class='column_parameter_value'>").f(b.getPath(!0,["detectorPixelSizeVertical"]),b,"h").w("</td></tr><tr><td>Mode</td><td  class='column_parameter_value'>").f(b.getPath(!0,["detectorMode"]),b,"h").w("</td></tr></table>       ")}return a.register("detector.mxdatacollectiongrid.template",b),b.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w(' <div class="col-xs-6 col-md-2"><table class="table"> <tr><td>Kind</td><td class=\'column_parameter_value\'>').f(b.getPath(!0,["experimentKind"]),b,"h").w("</td></tr> <tr><td>Positions</td><td class='column_parameter_value'>").f(b.getPath(!0,["numberOfPositions"]),b,"h").w("</td></tr><tr><td>Observed Res.</td><td class='column_parameter_value'> ").f(b.getPath(!0,["observedResolution"]),b,"h").w(" &#8491;</td></tr><tr><td>Min. Resolution </td><td class='column_parameter_value'>").f(b.getPath(!0,["minimalResolution"]),b,"h").w(" &#8491;</td></tr><tr><td>Max. Resolution</td><td class='column_parameter_value'>").f(b.getPath(!0,["maximalResolution"]),b,"h").w(" &#8491;</td></tr><tr><td>Screening Resolution</td><td class='column_parameter_value'>").f(b.getPath(!0,["screeningResolution"]),b,"h").w(" &#8491;</td></tr></table>       </div>")}return a.register("diffraction.mxdatacollectiongrid.template",b),b.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w("<table class=\"table\"><tr><td  >Workflow</td><td class='column_parameter_value'>").h("eq",b,{block:c},{key:b.get(["Workflow_status"],!1),value:"Success"},"h").h("eq",b,{block:d},{key:b.get(["Workflow_status"],!1),value:"Failure"},"h").f(b.getPath(!0,["Workflow_workflowType"]),b,"h").w("</td></tr><tr><td>Protein</td><td class='column_parameter_value'>").f(b.getPath(!0,["Protein_acronym"]),b,"h").w("</td></tr><tr><td>Sample</td><td class='column_parameter_value'>").f(b.getPath(!0,["BLSample_name"]),b,"h").w("</td></tr><tr><td>Prefix</td><td class='column_parameter_value'>").f(b.getPath(!0,["DataCollection_imagePrefix"]),b,"h").w("</td></tr><tr><td>Images</td><td class='column_parameter_value'>").f(b.getPath(!0,["totalNumberOfImages"]),b,"h").w("</td></tr><tr><td>Transmission</td><td class='column_parameter_value'>").f(b.getPath(!0,["transmission"]),b,"h").w("</td></tr><tr><td>Flux start</td><td class='column_parameter_value'>").f(b.getPath(!0,["DataCollection_flux"]),b,"h").w(" ph/sec</td></tr></table>")}function c(a,b){return a.w("<div class='summary_datacollection_success'></div>")}function d(a,b){return a.w("<div class='summary_datacollection_failed'></div>")}return a.register("first.general.mxdatacollectiongrid.template",b),b.__dustBody=!0,c.__dustBody=!0,d.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w(' <div class="col-xs-6 col-md-2">').p("first.general.mxdatacollectiongrid.template",b,b,{}).w('                             </div><div class="col-xs-6 col-md-2">').p("second.general.mxdatacollectiongrid.template",b,b,{}).w("                             </div> ")}return a.register("general.mxdatacollectiongrid.template",b),b.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w("<table><tr><td class='summary_datacollection_parameter_name'>Data Coll Group</td><td class='summary_datacollection_parameter'>").f(b.getPath(!0,["DataCollection_dataCollectionGroupId"]),b,"h").w("</td>        </tr><tr><td class='summary_datacollection_parameter_name'>Data Collection</td><td class='summary_datacollection_parameter'>").f(b.getPath(!0,["DataCollection_dataCollectionId"]),b,"h").w("</td>        </tr><tr><td class='summary_datacollection_parameter_name'>Sample</td><td class='summary_datacollection_parameter'>").f(b.getPath(!0,["BLSample_blSampleId"]),b,"h").w("</td>        </tr><tr><td class='summary_datacollection_parameter_name'>Crystal</td><td class='summary_datacollection_parameter'>").f(b.getPath(!0,["BLSample_crystalId"]),b,"h").w("</td>        </tr><tr><td class='summary_datacollection_parameter_name'>Session</td><td class='summary_datacollection_parameter'>").f(b.getPath(!0,["BLSession_sessionId"]),b,"h").w("</td>        </tr><tr><td class='summary_datacollection_parameter_name'>Protein</td><td class='summary_datacollection_parameter'>").f(b.getPath(!0,["Protein_proteinId"]),b,"h").w("</td>                </tr><tr><td class='summary_datacollection_parameter_name'>Auto Proc Int.</td><td class='summary_datacollection_parameter'>").f(b.getPath(!0,["autoProcIntegrationId"]),b,"h").w("</td>                </tr>   <tr><td class='summary_datacollection_parameter_name'>Workflow Steps</td><td class='summary_datacollection_parameter'>").f(b.getPath(!0,["WorkflowStep_workflowStepId"]),b,"h").w("</td>                </tr> <tr><td class='summary_datacollection_parameter_name'>Shipping</td><td class='summary_datacollection_parameter'>").f(b.getPath(!0,["shippingId"]),b,"h").w("</td>                </tr>    </table> ")}return a.register("ids.mxdatacollectiongrid.template",b),b.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w('<div class="container-fluid"><div class="panel with-nav-tabs panel-default"><div class="panel-heading clearfix"><div class="pull-left"><span style=\'font-size:12px;color:blue;\' ><kbd style=\'background-color:#CCCCCC;color:blue;\'>Run #').f(b.getPath(!0,["DataCollection_dataCollectionNumber"]),b,"h").w(" ").f(b.getPath(!0,["DataCollectionGroup_experimentType"]),b,"h").w("</kbd> <span style='color:blue;'>").f(b.getPath(!0,["DataCollectionGroup_startTime"]),b,"h").w("</span>                                   </span><p>").f(b.getPath(!0,["DataCollection_imageDirectory"]),b,"h").w('</p>      </div><div class="pull-right"><ul class="nav nav-tabs" id="myTabs"><li class="active"><a data-toggle="tab" href="#datacollection_').f(b.getPath(!0,["DataCollection_dataCollectionId"]),b,"h").w('"> Summary</a></li><li><a data-toggle="tab" href="#experimentparameters_').f(b.getPath(!0,["DataCollection_dataCollectionId"]),b,"h").w('">Beamline Parameters</a></li>               <li><a data-toggle="tab" href="#dc_').f(b.getPath(!0,["DataCollectionGroup_dataCollectionGroupId"]),b,"h").w('">Data Collections <span class="badge" style=\'background-color:#337ab7;\'>').f(b.getPath(!0,["totalNumberOfDataCollections"]),b,"h").w('</span></a></li><li><a data-toggle="tab" href="#sample_').f(b.getPath(!0,["DataCollection_dataCollectionId"]),b,"h").w('">Sample</a></li><li><a data-toggle="tab" href="#re_').f(b.getPath(!0,["DataCollection_dataCollectionId"]),b,"h").w('">Results  <span class="badge" style=\'background-color:#337ab7;\'>').f(b.getPath(!0,["resultsCount"]),b,"h").w('</span></a></li><li><a data-toggle="tab" href="#wf_').f(b.getPath(!0,["DataCollection_dataCollectionId"]),b,"h").w('">Workflow  <span class="badge" style=\'background-color:#337ab7;\'>').f(b.getPath(!0,["workflows","length"]),b,"h").w('</span></a></li></ul></div></div><br /><div class="tab-content"><div id="datacollection_').f(b.getPath(!0,["DataCollection_dataCollectionId"]),b,"h").w('" class="tab-pane fade in active"><div class="container-fluid"><div class="row">').p("general.mxdatacollectiongrid.template",b,b,{}).w('<div class="col-xs-12 col-md-2">  ').h("eq",b,{block:c},{key:b.get(["isScreeningVisible"],!1),type:"boolean",value:"true"},"h").w("  ").p("autoproc.mxdatacollectiongrid.template",b,b,{}).w('       </div><div class="col-xs-12 col-md-2"><a href="').f(b.getPath(!0,["url"]),b,"h").w("\" data-lightbox='").f(b.getPath(!0,["url"]),b,"h").w("' data-title=\"#").f(b.getPath(!0,["runNumber"]),b,"h").w(" ").f(b.getPath(!0,["folder"]),b,"h").w('"> <img  alt="Image not found" class="img-responsive lazy"  data-src="').f(b.getPath(!0,["urlThumbnail"]),b,"h").w('" /></a>                           </div><div class="col-xs-12 col-md-2"><a href="').f(b.getPath(!0,["xtal1"]),b,"h").w('"  data-lightbox="').f(b.getPath(!0,["DataCollection_dataCollectionId"]),b,"h").w('" data-title="').f(b.getPath(!0,["Protein_acronym"]),b,"h").w(" : ").f(b.getPath(!0,["Protein_name"]),b,"h").w('"><img alt="Image not found" class="img-responsive smalllazy" data-src="').f(b.getPath(!0,["xtal1"]),b,"h").w('" /></a>                           </div><div class="col-xs-6 col-md-2"><a href="').f(b.getPath(!0,["indicator"]),b,"h").w("\" data-lightbox='").f(b.getPath(!0,["indicator"]),b,"h").w("' data-title=\"#").f(b.getPath(!0,["runNumber"]),b,"h").w(" ").f(b.getPath(!0,["folder"]),b,"h").w('"> <img  alt="Image not found" class="img-responsive lazy"  data-src="').f(b.getPath(!0,["indicator"]),b,"h").w('" /></a> </div></div><div class="container-fluid"><div class="col-xs-12 col-md-12">').f(b.getPath(!0,["DataCollectionGroup_comments"]),b,"h").w('</div></div></div></div><div id="experimentparameters_').f(b.getPath(!0,["DataCollection_dataCollectionId"]),b,"h").w('" class="tab-pane fade"><div class="container-fluid"><div class="row">').p("general.mxdatacollectiongrid.template",b,b,{}).w('<div class="col-xs-6 col-md-2">').p("beamline.mxdatacollectiongrid.template",b,b,{}).w('                             </div><div class="col-xs-6 col-md-2">').p("detector.mxdatacollectiongrid.template",b,b,{}).w('                             </div></div></div></div><div id="sample_').f(b.getPath(!0,["DataCollection_dataCollectionId"]),b,"h").w('" class="tab-pane fade"><div class="container-fluid"><div class="row"><div class="col-xs-6 col-md-2">').p("sample.mxdatacollectiongrid.template",b,b,{}).w('                             </div><div class="col-xs-12 col-md-2"><a href="').f(b.getPath(!0,["xtal1"]),b,"h").w('"  data-lightbox="').f(b.getPath(!0,["DataCollection_dataCollectionId"]),b,"h").w('" data-title="').f(b.getPath(!0,["Protein_acronym"]),b,"h").w(" : ").f(b.getPath(!0,["Protein_name"]),b,"h").w('"><img alt="Image not found" class="img-responsive smalllazy" data-src="').f(b.getPath(!0,["xtal1"]),b,"h").w('" /></a>                           </div><div class="col-xs-12 col-md-2"><a href="').f(b.getPath(!0,["xtal2"]),b,"h").w('"  data-lightbox="').f(b.getPath(!0,["DataCollection_dataCollectionId"]),b,"h").w('" data-title="').f(b.getPath(!0,["Protein_acronym"]),b,"h").w(" : ").f(b.getPath(!0,["Protein_name"]),b,"h").w('"><img alt="Image not found" class="img-responsive smalllazy" data-src="').f(b.getPath(!0,["xtal2"]),b,"h").w('" /></a>                           </div><div class="col-xs-12 col-md-2"><a href="').f(b.getPath(!0,["xtal3"]),b,"h").w('"  data-lightbox="').f(b.getPath(!0,["DataCollection_dataCollectionId"]),b,"h").w('" data-title="').f(b.getPath(!0,["Protein_acronym"]),b,"h").w(" : ").f(b.getPath(!0,["Protein_name"]),b,"h").w('"><img alt="Image not found" class="img-responsive smalllazy" data-src="').f(b.getPath(!0,["xtal3"]),b,"h").w('" /></a>                           </div><div class="col-xs-12 col-md-2"><a href="').f(b.getPath(!0,["xtal4"]),b,"h").w('"  data-lightbox="').f(b.getPath(!0,["DataCollection_dataCollectionId"]),b,"h").w('" data-title="').f(b.getPath(!0,["Protein_acronym"]),b,"h").w(" : ").f(b.getPath(!0,["Protein_name"]),b,"h").w('"><img alt="Image not found" class="img-responsive smalllazy" data-src="').f(b.getPath(!0,["xtal4"]),b,"h").w('" /></a>                           </div><div class="col-xs-12 col-md-2">Sample Layout                           </div></div></div></div><div id="dc_').f(b.getPath(!0,["DataCollectionGroup_dataCollectionGroupId"]),b,"h").w('" class="tab-pane fade"><div class="container-fluid"><div class="row"><div class="col-xs-12 col-md-12" id="__dc_').f(b.getPath(!0,["DataCollection_dataCollectionId"]),b,"h").w("\"><img style='display:block;margin-left: auto;margin-right: auto;height:150px;width:150px;'src='../images/loading-animation.gif' />                                           </div></div></div></div><div id=\"re_").f(b.getPath(!0,["DataCollection_dataCollectionId"]),b,"h").w('" class="tab-pane fade"><div class="container-fluid"><div class="row"><div class="col-xs-12 col-md-12" id="__re_').f(b.getPath(!0,["DataCollection_dataCollectionId"]),b,"h").w("\"><img style='display:block;margin-left: auto;margin-right: auto;height:150px;width:150px;'src='../images/loading-animation.gif' />                                           </div></div></div></div><div id=\"wf_").f(b.getPath(!0,["DataCollection_dataCollectionId"]),b,"h").w('" class="tab-pane fade"><div class="container-fluid"><div class="row"><div class="col-xs-12 col-md-12" id="__wf_').f(b.getPath(!0,["DataCollection_dataCollectionId"]),b,"h").w("\"><img style='display:block;margin-left: auto;margin-right: auto;height:150px;width:150px;'src='../images/loading-animation.gif' />                                           </div></div></div></div></div></div></div>");
}function c(a,b){return a.h("ne",b,{block:d},{key:b.get(["ScreeningOutput_indexingSuccess"],!1),value:b.get(["null"],!1)},"h")}function d(a,b){return a.w("<table class=\"table\"><tr><td ><kbd style='background-color:#CCCCCC;color:blue;'>Indexed</kbd></td> <td>").h("eq",b,{"else":e,block:f},{key:b.get(["ScreeningOutput_indexingSuccess"],!1),type:"boolean",value:"true"},"h").w("</td></tr><tr><td>Mosaicity</td> <td class='column_parameter_value'>").f(b.getPath(!0,["ScreeningOutput_mosaicity"]),b,"h").w("</td></tr>  ").h("ne",b,{block:g},{key:b.get(["ScreeningOutput_strategySuccess"],!1),value:b.get(["null"],!1)},"h").w("                                                                                                                                                                                                           </table> ").h("eq",b,{block:j},{key:b.get(["ScreeningOutput_strategySuccess"],!1),type:"boolean",value:"true"},"h").w("                             ")}function e(a,b){return a.w("<div class='summary_datacollection_failed'></div>")}function f(a,b){return a.w("<div class='summary_datacollection_success'></div>")}function g(a,b){return a.w("                    <tr><td><kbd style='background-color:#CCCCCC;color:blue;'>Strategy</kbd></td> ").h("eq",b,{"else":h,block:i},{key:b.get(["ScreeningOutput_strategySuccess"],!1),type:"boolean",value:"true"},"h").w("</tr>")}function h(a,b){return a.w("<td><div class='summary_datacollection_failed'></div></td>")}function i(a,b){return a.w("<td> <div class='summary_datacollection_success'></div></td><tr><td>Rank. Res.</td> <td class='column_parameter_value'>").f(b.getPath(!0,["ScreeningOutput_rankingResolution"]),b,"h").w("</td></tr>                                                               <tr><td>Space Group</td> <td class='column_parameter_value'>").f(b.getPath(!0,["ScreeningOutputLattice_spaceGroup"]),b,"h").w("</td></tr>     ")}function j(a,b){return a.p("unitcell.screening.mxdatacollectiongrid.template",b,b,{}).w("  ")}return a.register("mxdatacollectiongrid.template",b),b.__dustBody=!0,c.__dustBody=!0,d.__dustBody=!0,e.__dustBody=!0,f.__dustBody=!0,g.__dustBody=!0,h.__dustBody=!0,i.__dustBody=!0,j.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w('<br /><div class="container-fluid"><div class="row">     <div class="col-sm-2 col-md-4 " style=\'margin: 0 10px 10px 0;\'>    </div>        ').s(b.getPath(!0,["autoprocessing"]),b,{block:c},{}).s(b.getPath(!0,["screening"]),b,{block:l},{}).w('<div class="col-sm-2 col-md-1 " style=\'margin: 0 10px 10px 0;\'>                                <div class="dropup">').h("eq",b,{block:v},{key:b.getPath(!1,["workflows","length"]),value:0},"h").h("gt",b,{block:w},{key:b.getPath(!1,["workflows","length"]),value:0},"h").w("</div>                            </div><div class=\"col-sm-2 col-md-2 \" style='margin: 0 10px 10px 0;'> ").h("gt",b,{block:G},{key:b.get(["phasingStepLength"],!1),value:0},"h").w("</div></div>   </div>                                                                                                                             ")}function c(a,b){return a.w('<div class="col-sm-2 col-md-1 " style=\'margin: 0 10px 10px 0;\'>                                  <div class="dropup">').h("eq",b,{block:d},{key:b.getPath(!1,["items","length"]),value:0},"h").w("                        ").h("gt",b,{block:e},{key:b.getPath(!1,["items","length"]),value:0},"h").w("</div></div>")}function d(a,b){return a.w('<button class="btn btn-xs btn-warning dropdown-toggle" type="button" data-toggle="dropdown"><span class="glyphicon glyphicon-cog"></span>  Processing <span class="badge">').h("size",b,{},{key:b.get(["items"],!1)},"h").w('</span><span class="caret"></span></button>')}function e(a,b){return a.w('  <button class="btn btn-xs btn-success dropdown-toggle" type="button" data-toggle="dropdown"><span class="glyphicon glyphicon-cog"></span>  Processing <span class="badge">').h("size",b,{},{key:b.get(["items"],!1)},"h").w('</span><span class="caret"></span></button>  <ul class="dropdown-menu">').s(b.getPath(!0,[]),b,{block:f},{}).w(" ").s(b.getPath(!0,[]),b,{block:j},{}).w("  </ul>")}function f(a,b){return a.s(b.getPath(!0,["items"]),b,{block:g},{})}function g(a,b){return a.w("<li> ").h("eq",b,{block:h},{key:b.get(["status"],!1),value:"Success"},"h").h("ne",b,{block:i},{key:b.get(["status"],!1),value:"Success"},"h").w("</li> ")}function h(a,b){return a.w("  <div class='summary_datacollection_success'></div>").f(b.getPath(!0,["name"]),b,"h").w(" ")}function i(a,b){return a.w("  <div class='summary_datacollection_failed'></div>").f(b.getPath(!0,["name"]),b,"h").w(" ")}function j(a,b){return a.s(b.getPath(!0,["items","0"]),b,{block:k},{})}function k(a,b){return a.w('<li class="divider"></li><li >                                                                                                  <div class="btn-group btn-group-xs" style=\'margin:0 0 0 30px;\'>                                                                <a href="#/autoprocintegration/datacollection/').f(b.getPath(!0,["dataCollectionId"]),b,"h").w('/main" class="btn btn-default" role="button"> <span class="glyphicon glyphicon-eye-open"></span> Open</a><a href="#/autoprocintegration/datacollection/').f(b.getPath(!0,["dataCollectionId"]),b,"h").w('/files" style=\'margin:0 0 0 10px;\' class="btn btn-default" role="button"> <span class="glyphicon glyphicon-file">Files</span></a></div></li>  ')}function l(a,b){return a.w('<div class="col-sm-2 col-md-1 " style=\'margin: 0 10px 10px 0;\'>                                  <div class="dropup">').h("eq",b,{block:m},{key:b.getPath(!1,["items","length"]),value:0},"h").w("                        ").h("gt",b,{block:n},{key:b.getPath(!1,["items","length"]),value:0},"h").w("</div></div>")}function m(a,b){return a.w('<button class="btn btn-xs btn-warning dropdown-toggle" type="button" data-toggle="dropdown"><span class="glyphicon glyphicon-screenshot"></span> Characterization <span class="badge">').h("size",b,{},{key:b.get(["items"],!1)},"h").w('</span><span class="caret"></span></button>')}function n(a,b){return a.w("  ").h("eq",b,{block:o},{key:b.get(["status"],!1),value:"Success"},"h").w(" ").h("ne",b,{block:p},{key:b.get(["status"],!1),value:"Success"},"h").w('  <ul class="dropdown-menu">').s(b.getPath(!0,[]),b,{block:q},{}).w("    </ul>")}function o(a,b){return a.w('<button class="btn btn-xs btn-success dropdown-toggle" type="button" data-toggle="dropdown"><span class="glyphicon glyphicon-screenshot"></span> Characterization <span class="badge">').h("size",b,{},{key:b.get(["items"],!1)},"h").w('</span><span class="caret"></span></button>')}function p(a,b){return a.w('<button class="btn btn-xs btn-danger dropdown-toggle" type="button" data-toggle="dropdown"><span class="glyphicon glyphicon-screenshot"></span> Characterization <span class="badge">').h("size",b,{},{key:b.get(["items"],!1)},"h").w('</span><span class="caret"></span></button>')}function q(a,b){return a.s(b.getPath(!0,["items"]),b,{block:r},{}).w("                                                ")}function r(a,b){return a.w("<li> ").h("eq",b,{block:s},{key:b.get(["status"],!1),value:"Success"},"h").h("ne",b,{block:t},{key:b.get(["status"],!1),value:"Success"},"h").w("<table class=\"table\"  style='margin:0 0 20 0px;'>").s(b.getPath(!0,["items"]),b,{block:u},{}).w("</table>                                                                                                                 </li> ")}function s(a,b){return a.w("  <div class='summary_datacollection_success'></div>").f(b.getPath(!0,["name"]),b,"h").w(" ")}function t(a,b){return a.w("  <div class='summary_datacollection_failed'></div>").f(b.getPath(!0,["name"]),b,"h").w(" ")}function u(a,b){return a.w("<tr><td>").f(b.getPath(!0,["name"]),b,"h").w("</td><td>").f(b.getPath(!0,["value"]),b,"h").w("</td></tr>    ")}function v(a,b){return a.w('<button class="btn btn-xs btn-warning dropdown-toggle" type="button" data-toggle="dropdown"><span class="glyphicon glyphicon-sort-by-attributes"></span>Workflow <span class="badge">').h("size",b,{},{key:b.get(["workflows"],!1)},"h").w('</span><span class="caret"></span></button>')}function w(a,b){return a.w('<button class="btn btn-xs btn-success dropdown-toggle" type="button" data-toggle="dropdown"><span class="glyphicon glyphicon-sort-by-attributes"></span>Workflow <span class="badge">').h("size",b,{},{key:b.get(["workflows"],!1)},"h").w('</span><span class="caret"></span></button><ul class="dropdown-menu">').s(b.getPath(!0,["workflows"]),b,{block:x},{}).w(" ").s(b.getPath(!0,["workflows","0"]),b,{block:F},{}).w("  </ul>")}function x(a,b){return a.w(" ").s(b.getPath(!0,[]),b,{block:y},{}).w("  ")}function y(a,b){return a.h("eq",b,{block:z},{key:b.get(["status"],!1),value:"Success"},"h").w("                                                                                                                                                                                                                                                            ").h("ne",b,{block:C},{key:b.get(["status"],!1),value:"Success"},"h")}function z(a,b){return a.w("<li> ").h("eq",b,{block:A},{key:b.get(["status"],!1),value:"Success"},"h").h("ne",b,{block:B},{key:b.get(["status"],!1),value:"Success"},"h").w("</li>                                                                                       ")}function A(a,b){return a.w(" <img  src='").f(b.getPath(!0,["img"]),b,"h").w("' style='width:30px;height:30px;'/><div class='summary_datacollection_success'></div>").f(b.getPath(!0,["name"]),b,"h")}function B(a,b){return a.w(" <img src='").f(b.getPath(!0,["img"]),b,"h").w("' style='width:30px;height:30px;'/><div class='summary_datacollection_failed'></div>").f(b.getPath(!0,["name"]),b,"h")}function C(a,b){return a.w("<li>").h("eq",b,{block:D},{key:b.get(["status"],!1),value:"Success"},"h").h("ne",b,{block:E},{key:b.get(["status"],!1),value:"Success"},"h").w("</li>                                                                                       ")}function D(a,b){return a.w("<img  src='").f(b.getPath(!0,["img"]),b,"h").w("' style='width:30px;height:30px;'/><div class='summary_datacollection_success'></div> ").f(b.getPath(!0,["name"]),b,"h").w(" ")}function E(a,b){return a.w("<div class='summary_datacollection_failed'></div ").f(b.getPath(!0,["name"]),b,"h").w(" ")}function F(a,b){return a.w('<li class="divider"></li><li ><div class="btn-group btn-group-xs" style=\'margin:0 0 0 30px;\'><a href="#/mx/workflow/step/').f(b.getPath(!0,["workflowStepIds"]),b,"h").w('/main" class="btn btn-default" role="button"> <span class="glyphicon glyphicon-eye-open"></span>Open</a></div></li>  ')}function G(a,b){return a}return a.register("online.mxdatacollectiongrid.template",b),b.__dustBody=!0,c.__dustBody=!0,d.__dustBody=!0,e.__dustBody=!0,f.__dustBody=!0,g.__dustBody=!0,h.__dustBody=!0,i.__dustBody=!0,j.__dustBody=!0,k.__dustBody=!0,l.__dustBody=!0,m.__dustBody=!0,n.__dustBody=!0,o.__dustBody=!0,p.__dustBody=!0,q.__dustBody=!0,r.__dustBody=!0,s.__dustBody=!0,t.__dustBody=!0,u.__dustBody=!0,v.__dustBody=!0,w.__dustBody=!0,x.__dustBody=!0,y.__dustBody=!0,z.__dustBody=!0,A.__dustBody=!0,B.__dustBody=!0,C.__dustBody=!0,D.__dustBody=!0,E.__dustBody=!0,F.__dustBody=!0,G.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w("<table class=\"table\"><tr><td>Protein</td><td  class='column_parameter_value'>").f(b.getPath(!0,["Protein_acronym"]),b,"h").w("</td></tr> <tr><td>Sample</td><td  class='column_parameter_value'>").f(b.getPath(!0,["BLSample_name"]),b,"h").w("</td></tr> <tr><td> Location </td><td  class='column_parameter_value'> ").f(b.getPath(!0,["BLSample_location"]),b,"h").w(" </td></tr> <tr><td> status</td><td  class='column_parameter_value'> ").f(b.getPath(!0,["BLSample_blSampleStatus"]),b,"h").w("</td></tr>                   <tr><td>Container</td><td  class='column_parameter_value'> ").f(b.getPath(!0,["Container_containerType"]),b,"h").w(" - ").f(b.getPath(!0,["Container_capacity"]),b,"h").w("  </td></tr><tr><td>sampleChangerLocation</td><td  class='column_parameter_value'>").f(b.getPath(!0,["Container_sampleChangerLocation"]),b,"h").w("</td></tr><tr><td>Barcode</td><td  class='column_parameter_value'>").f(b.getPath(!0,["barCode"]),b,"h").w("</td></tr><tr><td>beamlineLocation</td><td  class='column_parameter_value'>").f(b.getPath(!0,["Container_beamlineLocation"]),b,"h").w("</td></tr></table>       ")}return a.register("sample.mxdatacollectiongrid.template",b),b.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w("<table class=\"table\">                    <tr><td>Type</td><td  class='column_parameter_value'> ").f(b.getPath(!0,["DataCollectionGroup_experimentType"]),b,"h").w("</td></tr><tr><td>Res. (corner)</td><td  class='column_parameter_value'>").f(b.getPath(!0,["DataCollection_resolution"]),b,"h").w(" &#8491; (").f(b.getPath(!0,["DataCollection_resolutionAtCorner"]),b,"h").w(" &#8491;)</td></tr><tr><td>Wavelength</td><td  class='column_parameter_value'>").f(b.getPath(!0,["DataCollection_wavelength"]),b,"h").w(" &#8491;</td></tr><tr><td>").f(b.getPath(!0,["DataCollection_rotationAxis"]),b,"h").w(" range</td><td  class='column_parameter_value'>").f(b.getPath(!0,["DataCollection_axisRange"]),b,"h").w(" &deg;</td></tr><tr><td>").f(b.getPath(!0,["DataCollection_rotationAxis"]),b,"h").w(" start (total)</td><td  class='column_parameter_value'>").f(b.getPath(!0,["DataCollection_axisEnd"]),b,"h").w("&deg; (").f(b.getPath(!0,["DataCollection_axisTotal"]),b,"h").w("&deg;)</td></tr><tr><td>Exposure Time</td><td  class='column_parameter_value'>").f(b.getPath(!0,["DataCollection_exposureTime"]),b,"h").w(" s</td></tr><tr><td>Flux end</td><td  class='column_parameter_value'>").f(b.getPath(!0,["DataCollection_flux_end"]),b,"h").w(" ph/sec</td></tr></table>")}return a.register("second.general.mxdatacollectiongrid.template",b),b.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w("<table class='table-sm table table-striped'><thead>   <tr><th  style='padding:0 15px 0 15px;'>").f(b.getPath(!0,["spaceGroup"]),b,"h").w("</th><th style='padding:0 15px 0 15px;'>Completeness</th><th style='padding:0 15px 0 15px;'>Res.</th><th style='padding:0 15px 0 15px;'>Rmerge</th>                    </tr></thead><tbody><tr><td  style='padding:0 15px 0 15px;'>Inner</td><td  style='padding:0 15px 0 15px;'>").h("gt",b,{block:c},{key:b.getPath(!1,["innerShell","completeness"]),value:20},"h").h("lte",b,{block:f},{key:b.getPath(!1,["innerShell","completeness"]),value:20},"h").w("</td><td style='padding:0 15px 0 15px;'>").f(b.getPath(!0,["innerShell","resolutionsLimitHigh"]),b,"h").w("</td><td style='padding:0 15px 0 15px;'>").f(b.getPath(!0,["innerShell","rMerge"]),b,"h").w("</td></tr><tr><td  style='padding:0 15px 0 15px;'>Outer</td><td  style='padding:0 15px 0 15px;'>").h("gt",b,{block:g},{key:b.getPath(!1,["outerShell","completeness"]),value:20},"h").h("lte",b,{block:j},{key:b.getPath(!1,["outerShell","completeness"]),value:20},"h").w("</td><td style='padding:0 15px 0 15px;'>").f(b.getPath(!0,["outerShell","resolutionsLimitHigh"]),b,"h").w("</td><td style='padding:0 15px 0 15px;'>").f(b.getPath(!0,["outerShell","rMerge"]),b,"h").w("</td></tr><tr><td  style='padding:0 15px 0 15px;'>Overall</td><td  style='padding:0 15px 0 15px;'>").h("gt",b,{block:k},{key:b.getPath(!1,["overall","completeness"]),value:20},"h").h("lte",b,{block:n},{key:b.getPath(!1,["overall","completeness"]),value:20},"h").w("</td><td style='padding:0 15px 0 15px;'>").f(b.getPath(!0,["overall","resolutionsLimitHigh"]),b,"h").w("</td><td style='padding:0 15px 0 15px;'>").f(b.getPath(!0,["overall","rMerge"]),b,"h").w("</td></tr></tbody></table>")}function c(a,b){return a.h("gt",b,{"else":d,block:e},{key:b.getPath(!1,["innerShell","completeness"]),value:70},"h")}function d(a,b){return a.w('<div  style="background-repeat: repeat-x;border:1px solid #f0ad4e;color:#fff;background-color:#f0ad4e;width:').f(b.getPath(!0,["innerShell","completeness"]),b,"h").w('%">').f(b.getPath(!0,["innerShell","completeness"]),b,"h").w("%</div>")}function e(a,b){return a.w('<div  style="background-repeat: repeat-x;border:1px solid gray;color:#fff;background-image:linear-gradient(to bottom,#337ab7 0,#286090 100%);width:').f(b.getPath(!0,["innerShell","completeness"]),b,"h").w('%">').f(b.getPath(!0,["innerShell","completeness"]),b,"h").w("%</div>")}function f(a,b){return a.w('<div  style="background-repeat: repeat-x;border:1px solid #d9534f;color:#fff;background-color:#d9534f;width:').f(b.getPath(!0,["innerShell","completeness"]),b,"h").w('%">').f(b.getPath(!0,["innerShell","completeness"]),b,"h").w("%</div>")}function g(a,b){return a.h("gt",b,{"else":h,block:i},{key:b.getPath(!1,["outerShell","completeness"]),value:70},"h")}function h(a,b){return a.w('<div  style="background-repeat: repeat-x;border:1px solid #f0ad4e;color:#fff;background-color:#f0ad4e;width:').f(b.getPath(!0,["outerShell","completeness"]),b,"h").w('%">').f(b.getPath(!0,["outerShell","completeness"]),b,"h").w("%</div>")}function i(a,b){return a.w('<div  style="background-repeat: repeat-x;border:1px solid gray;color:#fff;background-image:linear-gradient(to bottom,#337ab7 0,#286090 100%);width:').f(b.getPath(!0,["outerShell","completeness"]),b,"h").w('%">').f(b.getPath(!0,["outerShell","completeness"]),b,"h").w("%</div>")}function j(a,b){return a.w('<div  style="background-repeat: repeat-x;border:1px solid #d9534f;color:#fff;background-color:#d9534f;width:').f(b.getPath(!0,["outerShell","completeness"]),b,"h").w('%">').f(b.getPath(!0,["outerShell","completeness"]),b,"h").w("%</div>")}function k(a,b){return a.h("gt",b,{"else":l,block:m},{key:b.getPath(!1,["overall","completeness"]),value:70},"h")}function l(a,b){return a.w('<div  style="background-repeat: repeat-x;border:1px solid #f0ad4e;color:#fff;background-color:#f0ad4e;width:').f(b.getPath(!0,["overall","completeness"]),b,"h").w('%">').f(b.getPath(!0,["overall","completeness"]),b,"h").w("%</div>")}function m(a,b){return a.w('<div  style="background-repeat: repeat-x;border:1px solid gray;color:#fff;background-image:linear-gradient(to bottom,#337ab7 0,#286090 100%);width:').f(b.getPath(!0,["overall","completeness"]),b,"h").w('%">').f(b.getPath(!0,["outerShell","completeness"]),b,"h").w("%</div>")}function n(a,b){return a.w('<div  style="background-repeat: repeat-x;border:1px solid #d9534f;color:#fff;background-color:#d9534f;width:').f(b.getPath(!0,["overall","completeness"]),b,"h").w('%">').f(b.getPath(!0,["overall","completeness"]),b,"h").w("%</div>")}return a.register("sm.completeness.autoproc.mxdatacollectiongrid.template",b),b.__dustBody=!0,c.__dustBody=!0,d.__dustBody=!0,e.__dustBody=!0,f.__dustBody=!0,g.__dustBody=!0,h.__dustBody=!0,i.__dustBody=!0,j.__dustBody=!0,k.__dustBody=!0,l.__dustBody=!0,m.__dustBody=!0,n.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w("   <table class='table-sm table table-striped'><thead>   <tr><th  style='padding:0 15px 0 15px;'>cell A</th><th style='padding:0 15px 0 15px;'>cell B</th><th style='padding:0 15px 0 15px;'>cell C</th></tr></thead><tbody><tr><td  style='padding:0 15px 0 15px;'>").f(b.getPath(!0,["overall","cell_a"]),b,"h").w("</td><td style='padding:0 15px 0 15px;'>").f(b.getPath(!0,["overall","cell_b"]),b,"h").w("</td><td style='padding:0 15px 0 15px;'>").f(b.getPath(!0,["overall","cell_c"]),b,"h").w("</td></tr><tr><th  style='padding:0 15px 0 15px;'>Alpha</th><th style='padding:0 15px 0 15px;'>Beta</th><th style='padding:0 15px 0 15px;'>Gamma</th></tr><tr><td  style='padding:0 15px 0 15px;'>").f(b.getPath(!0,["overall","cell_alpha"]),b,"h").w("</td><td style='padding:0 15px 0 15px;'>").f(b.getPath(!0,["overall","cell_beta"]),b,"h").w("</td><td style='padding:0 15px 0 15px;'>").f(b.getPath(!0,["overall","cell_gamma"]),b,"h").w("</td></tr></tbody></table>")}return a.register("unitcell.autoproc.mxdatacollectiongrid.template",b),b.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w("   <table class='table-sm table table-striped'><thead>   <tr><th  style='padding:0 15px 0 15px;'>cell A</th><th style='padding:0 15px 0 15px;'>cell B</th><th style='padding:0 15px 0 15px;'>cell C</th></tr></thead><tbody><tr><td  style='padding:0 15px 0 15px;'>").f(b.getPath(!0,["ScreeningOutputLattice_unitCell_a"]),b,"h").w("</td><td style='padding:0 15px 0 15px;'>").f(b.getPath(!0,["ScreeningOutputLattice_unitCell_b"]),b,"h").w("</td><td style='padding:0 15px 0 15px;'>").f(b.getPath(!0,["ScreeningOutputLattice_unitCell_c"]),b,"h").w("</td></tr><tr><th  style='padding:0 15px 0 15px;'>Alpha</th><th style='padding:0 15px 0 15px;'>Beta</th><th style='padding:0 15px 0 15px;'>Gamma</th></tr><tr><td  style='padding:0 15px 0 15px;'>").f(b.getPath(!0,["ScreeningOutputLattice_unitCell_alpha"]),b,"h").w("</td><td style='padding:0 15px 0 15px;'>").f(b.getPath(!0,["ScreeningOutputLattice_unitCell_beta"]),b,"h").w("</td><td style='padding:0 15px 0 15px;'>").f(b.getPath(!0,["ScreeningOutputLattice_unitCell_gamma"]),b,"h").w("</td></tr></tbody></table>")}return a.register("unitcell.screening.mxdatacollectiongrid.template",b),b.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w('<div class="container-fluid containerWithScroll"><div class="row"><div class="col-xs-12 col-md-2"><table class="table table-striped table-hover"><thead><tr>').s(b.getPath(!0,[]),b,{block:c},{}).w("</tr></thead><tr>").s(b.getPath(!0,[]),b,{block:d},{}).w("</tr></tr><tr>").s(b.getPath(!0,[]),b,{block:e},{}).w("</tr></table></div></div></div>")}function c(a,b){return a.w('<th> <a href="#/mx/workflow/step/').f(b.getPath(!0,["workflowStepIds"]),b,"h").w('/main" >').f(b.getPath(!0,["name"]),b,"h").w("</a></th>                 ")}function d(a,b){return a.w('<td  ><a href="#/mx/workflow/step/').f(b.getPath(!0,["workflowStepIds"]),b,"h").w("/main\" ><img style='height:150px;width:150px;' src='").f(b.getPath(!0,["img"]),b,"h").w("' /></a></td>")}function e(a,b){return a.w("<td  >").f(b.getPath(!0,["status"]),b,"h").w("</td>")}return a.register("workflows.mxdatacollectiongrid.template",b),b.__dustBody=!0,c.__dustBody=!0,d.__dustBody=!0,e.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w('<div class="container-fluid"><div class="panel with-nav-tabs panel-default"><div class="panel-heading clearfix"><div class="pull-left"><h1 class="panel-title" style=\'color:#337ab7;\'><span style=\'font-size:12px;\'>   ').f(b.getPath(!0,["startTime"]),b,"h").w('</span></h1></div><div class="pull-right"><ul class="nav nav-tabs"><li class="active"><a data-toggle="tab" href="#datacollection_').f(b.get(["DataCollection_dataCollectionId"],!1),b,"h").w('">Summary </a></li></ul></div></div><br /><div class="tab-content"><div id="datacollection_').f(b.get(["DataCollection_dataCollectionId"],!1),b,"h").w('" class="tab-pane fade in active"><div class="container-fluid"><div class="row"><div class="col-xs-1 col-md-1"><div class="well" style=\'font-size:30px;\'>').f(b.getPath(!0,["element"]),b,"h").w('</div></div><div class="col-xs-3 col-md-3"><table class="table table-condensed"><tr><td>Start Time</td><td class=\'column_parameter_value\'>').f(b.getPath(!0,["startTime"]),b,"h").w("</td></tr><tr><td>Protein</td><td class='column_parameter_value'>").f(b.getPath(!0,["acronym"]),b,"h").w("</td></tr><tr><td>Sample</td><td class='column_parameter_value'>").f(b.getPath(!0,["name"]),b,"h").w("</td></tr><tr><td>Fluorescence Detector</td><td class='column_parameter_value'>").f(b.getPath(!0,["fluorescenceDetector"]),b,"h").w("</td></tr><tr><td style='width:150px;'>Energy Scan Range</td><td class='column_parameter_value'>").f(b.getPath(!0,["startEnergy"]),b,"h").w(" kev - ").f(b.getPath(!0,["endEnergy"]),b,"h").w(" kev</td></tr><tr><td>Edge Energy (theoretical)</td><td class='column_parameter_value'>").f(b.getPath(!0,["edgeEnergy"]),b,"h").w(" kev</td></tr><tr><td>Flux @100%</td><td class='column_parameter_value'>").f(b.getPath(!0,["flux"]),b,"h").w(" ph/sec</td></tr><tr><td>Transmission</td><td class='column_parameter_value'>").f(b.getPath(!0,["transmissionFactor"]),b,"h").w(" %</td></tr><tr><td style='width:150px;'>Beam Size Hor</td><td class='column_parameter_value'>").f(b.getPath(!0,["beamSizeHorizontal"]),b,"h").w(" micrometer</td></tr><tr><td>Beam Size Vert</td><td class='column_parameter_value'>").f(b.getPath(!0,["beamSizeVertical"]),b,"h").w(" micrometer</td></tr><tr><td>Exposure Time</td><td class='column_parameter_value'>").f(b.getPath(!0,["exposureTime"]),b,"h").w(" sec</td></tr><tr><td>Filename</td><td class='column_parameter_value'>").f(b.getPath(!0,["filename"]),b,"h").w('</td></tr></table></div><div class="col-xs-3 col-md-3"><table class="table table-condensed"><tr><td >Peak Energy</td><td class=\'column_parameter_value\'>').f(b.getPath(!0,["peakEnergy"]),b,"h").w(" kev</td></tr><tr><td >Pk f'</td><td class='column_parameter_value'>").f(b.getPath(!0,["peakFPrime"]),b,"h").w(" e</td></tr><tr><td >Pk f''</td><td class='column_parameter_value'>").f(b.getPath(!0,["peakFDoublePrime"]),b,"h").w(" e</td></tr><tr><td >Inflection Energy</td><td class='column_parameter_value'>").f(b.getPath(!0,["inflectionEnergy"]),b,"h").w(" kev</td></tr><tr><td >Ip f'</td><td class='column_parameter_value'>").f(b.getPath(!0,["inflectionFPrime"]),b,"h").w(" e </td></tr><tr><td >Ip f''</td><td class='column_parameter_value'>").f(b.getPath(!0,["inflectionFDoublePrime"]),b,"h").w(' e </td></tr></table></div><div class="col-xs-3 col-md-3"><a href=\'').f(b.getPath(!0,["choochURL"]),b,"h").w("' data-lightbox='").f(b.getPath(!0,["choochURL"]),b,"h").w('\' data-title="Chooch"><img class="lazy"  data-src=\'').f(b.getPath(!0,["choochURL"]),b,"h").w("' src='").f(b.getPath(!0,["choochURL"]),b,"h").w("' /> </a></div></div></div></div></div></div></div>")}return a.register("energyscangrid.template",b),b.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w('<div id="container"><div style=\'float:left;\' id="left"><img class="titleImage" src="../images/logo_EXI.jpg" /><span class="title">ExiMX<span class="subtitle">Extended ISPyB for MX<sub style="font-size:10px;color:orange">BETA</sub></span></span></div><div id="center"></div><div style=\'float:right;width:120px;\' id="logos"><img class="logoImage" src="../images/logo_EMBL.png" /><img class="logoImage" src="../images/logo_ESRF.png" /></div><div style=\'float:right;width:120px;\' id="right"><div style=\'color:white;font-size:10px; \'>Version: ').f(b.getPath(!0,["version"]),b,"h").w("</div><div style='color:white;font-size:10px; '>Released: ").f(b.getPath(!0,["release_date"]),b,"h").w("</div><div style='color:white;font-size:10px;'>").f(b.getPath(!0,["database"]),b,"h").w("</div></div></div>")}return a.register("mxheader",b),b.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w("<div><table  style='border:1px solid #FAFAFA;'>").s(b.getPath(!0,[]),b,{block:c},{}).w("       </table></div>")}function c(a,b){return a.w("	<tr><td class='summary_datacollection_parameter_name'>Space Group</td><td class='summary_datacollection_parameter'>").f(b.getPath(!0,["spaceGroupShortName"]),b,"h").w(" (").f(b.getPath(!0,["spaceGroup"]),b,"h").w(")</td></tr> <tr><td class='summary_datacollection_parameter_name'>Type</td><td class='summary_datacollection_parameter'>").f(b.getPath(!0,["phasingStepType"]),b,"h").w("</td></tr> <tr><td class='summary_datacollection_parameter_name'>Program</td><td class='summary_datacollection_parameter'>").f(b.getPath(!0,["phasingPrograms"]),b,"h").w("</td></tr>     <tr><td class='summary_datacollection_parameter_name'>Resolution</td><td class='summary_datacollection_parameter'>").f(b.getPath(!0,["lowRes"]),b,"h").w(" - ").f(b.getPath(!0,["highRes"]),b,"h").w("</td></tr>  <tr>  <td class='summary_datacollection_parameter_name'>StartTime</td><td class='summary_datacollection_parameter'>").f(b.getPath(!0,["phasingStartTime"]),b,"h").w("</td></tr>  <tr>  <td class='summary_datacollection_parameter_name'>Protein</td><td class='summary_datacollection_parameter'>").f(b.getPath(!0,["acronym"]),b,"h").w("</td></tr>                         ")}return a.register("phasinggrid.prepare",b),b.__dustBody=!0,c.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w("<div><table>").s(b.getPath(!0,["0"]),b,{block:c},{}).w("  ").s(b.getPath(!0,[]),b,{block:d},{}).w("       </table></div>")}function c(a,b){return a.w("<tr><th class=\"datacollection_parameter_name\" style='width:70px;'>Resolution</th><th class=\"datacollection_parameter_name\" style='width:70px;'>Method</th><th class=\"datacollection_parameter_name\" style='width:70px;'>Enantiomorph</th><th  class=\"datacollection_parameter_name\"style='width:70px;'>SpaceGroup</th><th class=\"datacollection_parameter_name\" style='width:70px;'>Solvent</th><th class=\"datacollection_parameter_name\" style='width:120px;'>Statistics</th>            </tr>  ")}function d(a,b){return a.w("	    <tr  class='selectable_row'><td>").f(b.getPath(!0,["lowRes"]),b,"h").w(" - ").f(b.getPath(!0,["highRes"]),b,"h").w("</td><td>").f(b.getPath(!0,["method"]),b,"h").w("</td><td>").f(b.getPath(!0,["enantiomorph"]),b,"h").w("</td><td>").f(b.getPath(!0,["spaceGroup"]),b,"h").w(" (").f(b.getPath(!0,["spaceGroupShortName"]),b,"h").w(")</td><td>").f(b.getPath(!0,["solventContent"]),b,"h").w("</td><td><table>").s(b.getPath(!0,["statistics"]),b,{block:e},{}).w("</table>  </td></tr>  ")}function e(a,b){return a.w("<tr><td>").f(b.getPath(!0,["name"]),b,"h").w("</td><td>").f(b.getPath(!0,["value"]),b,"h").w("</td><tr>")}return a.register("phasinggrid.stats",b),b.__dustBody=!0,c.__dustBody=!0,d.__dustBody=!0,e.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w("<div><table>").s(b.getPath(!0,["0"]),b,{block:c},{}).w(" ").s(b.getPath(!0,[]),b,{block:d},{}).w("       </table></div>")}function c(a,b){return a.w("<tr><th class=\"datacollection_parameter_name\" style='width:70px;'>Type</th><th class=\"datacollection_parameter_name\" style='width:70px;'>Program</th><th class=\"datacollection_parameter_name\" style='width:70px;'>Resolution</th><th  class=\"datacollection_parameter_name\"style='width:70px;'>Method</th></tr>  ")}function d(a,b){return a.w("	<tr class='selectable_row'><td class='summary_datacollection_parameter'>").f(b.getPath(!0,["phasingStepType"]),b,"h").w("</td>        <td class='summary_datacollection_parameter'>").f(b.getPath(!0,["phasingPrograms"]),b,"h").w("</td><td class='summary_datacollection_parameter'>").f(b.getPath(!0,["lowRes"]),b,"h").w(" - ").f(b.getPath(!0,["highRes"]),b,"h").w("</td><td class='summary_datacollection_parameter'>").f(b.getPath(!0,["method"]),b,"h").w("</td></tr> ")}return a.register("phasinggrid.substructure",b),b.__dustBody=!0,c.__dustBody=!0,d.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.s(b.get(["prepare"],!1),b,{block:c},{}).w("<br />").s(b.get(["prepare"],!1),b,{block:d},{}).w("<br />").s(b.get(["substructure"],!1),b,{block:h},{}).w("<br />").s(b.get(["phasing"],!1),b,{block:n},{}).w("<br />").s(b.get(["models"],!1),b,{block:v},{}).w("<br /><br />")}function c(a,b){return a.w("<span style='font-size:12px;'>").f(b.getPath(!0,["spaceGroup"]),b,"h").w(" (").f(b.getPath(!0,["spaceGroupShortName"]),b,"h").w(")</span>  ")}function d(a,b){return a.h("eq",b,{block:e},{key:b.get(["status"],!1),value:"Success"},"h").h("eq",b,{block:f},{key:b.get(["status"],!1),value:"Failure"},"h").h("eq",b,{block:g},{key:b.get(["status"],!1),value:"Not found"},"h").f(b.getPath(!0,["type"]),b,"h")}function e(a,b){return a.w("<div class='summary_datacollection_success'></div>")}function f(a,b){return a.w("<div class='summary_datacollection_failed'></div>")}function g(a,b){return a.w("<div class='summary_datacollection_noFound'></div>")}function h(a,b){return a.h("eq",b,{block:i},{key:b.get(["status"],!1),value:"Success"},"h").h("eq",b,{block:j},{key:b.get(["status"],!1),value:"Failure"},"h").h("eq",b,{block:k},{key:b.get(["status"],!1),value:"Not found"},"h").h("gt",b,{block:l},{key:b.get(["runs"],!1),value:0},"h").h("eq",b,{block:m},{key:b.get(["runs"],!1),value:0},"h");
}function i(a,b){return a.w("<div class='summary_datacollection_success'></div>")}function j(a,b){return a.w("<div class='summary_datacollection_failed'></div>")}function k(a,b){return a.w("<div class='summary_datacollection_noFound'></div>")}function l(a,b){return a.w(" ").f(b.getPath(!0,["type"]),b,"h").w("  <span style='color:gray;font-size:10px'>(").f(b.getPath(!0,["runs"]),b,"h").w(" runs)</span> ")}function m(a,b){return a.w(" <span style='color:gray;font-size:10px'> ").f(b.getPath(!0,["type"]),b,"h").w(" (").f(b.getPath(!0,["runs"]),b,"h").w(" runs)</span> ")}function n(a,b){return a.h("eq",b,{block:o},{key:b.get(["status"],!1),value:"Success"},"h").h("eq",b,{block:p},{key:b.get(["status"],!1),value:"Failure"},"h").h("eq",b,{block:q},{key:b.get(["status"],!1),value:"Not found"},"h").h("gt",b,{block:r},{key:b.get(["runs"],!1),value:0},"h").h("eq",b,{block:s},{key:b.get(["runs"],!1),value:0},"h").h("gt",b,{block:t},{key:b.get(["runs"],!1),value:0},"h")}function o(a,b){return a.w("<div class='summary_datacollection_success'></div>")}function p(a,b){return a.w("<div class='summary_datacollection_failed'></div>")}function q(a,b){return a.w("<div class='summary_datacollection_noFound'></div>")}function r(a,b){return a.w(" ").f(b.getPath(!0,["type"]),b,"h").w("  <span style='color:gray;font-size:10px'>(").f(b.getPath(!0,["runs"]),b,"h").w(" runs)</span> ")}function s(a,b){return a.w(" <span style='color:gray;font-size:10px'> ").f(b.getPath(!0,["type"]),b,"h").w(" (").f(b.getPath(!0,["runs"]),b,"h").w(" runs)</span> ")}function t(a,b){return a.w("   ").s(b.get(["stats"],!1),b,{block:u},{})}function u(a,b){return a.w("<table style='margin-left:30px;'><tr><td> ").f(b.getPath(!0,["successCondition"]),b,"h").w(" runs with successful stats</td></tr><tr><td> ").f(b.getPath(!0,["withStatistics"]),b,"h").w(" runs with statistics</td></tr><tr><td> ").f(b.getPath(!0,["withoutStatistics"]),b,"h").w(" runs with no statistics</td></tr></table>")}function v(a,b){return a.h("eq",b,{block:w},{key:b.get(["status"],!1),value:"Success"},"h").h("eq",b,{block:x},{key:b.get(["status"],!1),value:"Failure"},"h").h("eq",b,{block:y},{key:b.get(["status"],!1),value:"Not found"},"h").h("gt",b,{block:z},{key:b.get(["runs"],!1),value:0},"h").h("eq",b,{block:A},{key:b.get(["runs"],!1),value:0},"h")}function w(a,b){return a.w("<div class='summary_datacollection_success'></div>")}function x(a,b){return a.w("<div class='summary_datacollection_failed'></div>")}function y(a,b){return a.w("<div class='summary_datacollection_noFound'></div>")}function z(a,b){return a.w(" ").f(b.getPath(!0,["type"]),b,"h").w("  <span style='color:gray;font-size:10px'>(").f(b.getPath(!0,["runs"]),b,"h").w(" runs)</span> ")}function A(a,b){return a.w(" <span style='color:gray;font-size:10px'> ").f(b.getPath(!0,["type"]),b,"h").w(" (").f(b.getPath(!0,["runs"]),b,"h").w(" runs)</span> ")}return a.register("phasinglistview",b),b.__dustBody=!0,c.__dustBody=!0,d.__dustBody=!0,e.__dustBody=!0,f.__dustBody=!0,g.__dustBody=!0,h.__dustBody=!0,i.__dustBody=!0,j.__dustBody=!0,k.__dustBody=!0,l.__dustBody=!0,m.__dustBody=!0,n.__dustBody=!0,o.__dustBody=!0,p.__dustBody=!0,q.__dustBody=!0,r.__dustBody=!0,s.__dustBody=!0,t.__dustBody=!0,u.__dustBody=!0,v.__dustBody=!0,w.__dustBody=!0,x.__dustBody=!0,y.__dustBody=!0,z.__dustBody=!0,A.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w("Code : ").f(b.getPath(!0,["Container_code"]),b,"h").w("<br />Type: ").f(b.getPath(!0,["Container_containerType"]),b,"h").w("<br />Status : ").f(b.getPath(!0,["Dewar_dewarStatus"]),b,"h").w("<br />Beamline : ").f(b.getPath(!0,["Container_beamlineLocation"]),b,"h").w("<br />Date: ").f(b.getPath(!0,["Shipping_bltimeStamp"]),b,"h")}return a.register("puck.listview",b),b.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w('<div class="container-fluid"><div class="row"><div style=\'font-size:10px;text-align:center;\' class="col-sm-2 col-md-1 " style=\'margin: 0 10px 0px 0;\'><a href=\'#/mx/datacollection/session/').f(b.getPath(!0,["sessionId"]),b,"h").w('/main\' title=\'click to go\' type="button" class="btn btn-link">').f(b.getPath(!0,["month"]),b,"h").w(" ").f(b.getPath(!0,["day"]),b,"h").w(" ").f(b.getPath(!0,["year"]),b,"h").w("</a><br />").f(b.getPath(!0,["beamLineName"]),b,"h").w("<br />").f(b.getPath(!0,["beamLineOperator"]),b,"h").w("</div><div style='font-size:14px;text-align:center;' class=\"col-sm-2 col-md-1\" ><a href='#/mx/datacollection/session/").f(b.getPath(!0,["sessionId"]),b,"h").w("/main'   title=\"").f(b.getPath(!0,["Proposal_title"]),b,"h").w('" class="btn btn-link">').f(b.getPath(!0,["Proposal_proposalCode"]),b,"h").f(b.getPath(!0,["Proposal_ProposalNumber"]),b,"h").w("</a><br />").f(b.getPath(!0,["nbShifts"]),b,"h").w(' shifts     </div><div class="col-sm-1"  style=\'margin: 10px 10px 0px 0;\'><!-- List group --><ul class="list-group">').h("gt",b,{block:c},{key:b.get(["sampleCount"],!1),value:0},"h").w('</ul></div><div class="col-sm-1"  style=\'margin: 10px 10px 0px 0;\'><!-- List group --><ul class="list-group">').h("gt",b,{block:d},{key:b.get(["testDataCollectionGroupCount"],!1),value:0},"h").w('</ul></div><div class="col-sm-1"  style=\'margin: 10px 10px 0px 0;\'><!-- List group --><ul class="list-group">').h("gt",b,{block:e},{key:b.get(["dataCollectionGroupCount"],!1),value:0},"h").w('</ul></div><div class="col-sm-1"  style=\'margin: 10px 10px 0px 0;\'><!-- List group --><ul class="list-group">').h("gt",b,{block:f},{key:b.get(["xrfSpectrumCount"],!1),value:0},"h").w('</ul></div><div class="col-sm-1"  style=\'margin: 10px 10px 0px 0;\'><!-- List group --><ul class="list-group">        ').h("gt",b,{block:g},{key:b.get(["energyScanCount"],!1),value:0},"h").w("        </ul></div><div class=\"col-sm-3\"  style='margin: 10px 10px 0px 0;'>").f(b.getPath(!0,["comments"]),b,"h").w("</div></div></div>")}function c(a,b){return a.w('<li class="list-group-item"><span style=\'background-color:#337ab7;\' class="badge badge-primary">').f(b.getPath(!0,["sampleCount"]),b,"h").w("</span>Samples</li>")}function d(a,b){return a.w('<li class="list-group-item"><span style=\'background-color:#337ab7;\' class="badge">').f(b.getPath(!0,["testDataCollectionGroupCount"]),b,"h").w("</span>Tests</li>")}function e(a,b){return a.w('<li class="list-group-item"><span style=\'background-color:#337ab7;\' class="badge">').f(b.getPath(!0,["dataCollectionGroupCount"]),b,"h").w("</span>Collect.</li>")}function f(a,b){return a.w('<li class="list-group-item"><span style=\'background-color:#337ab7;\' class="badge">').f(b.getPath(!0,["xrfSpectrumCount"]),b,"h").w("</span>XRF</li>")}function g(a,b){return a.w('<li class="list-group-item"><span style=\'background-color:#337ab7;\' class="badge">').f(b.getPath(!0,["energyScanCount"]),b,"h").w("</span>En. Scans</li>")}return a.register("session.grid",b),b.__dustBody=!0,c.__dustBody=!0,d.__dustBody=!0,e.__dustBody=!0,f.__dustBody=!0,g.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w("<table><tr><td  class='summary_datacollection_parameter_name'>Space Group</td><td class='summary_datacollection_parameter'>").f(b.getPath(!0,["spaceGroupShortName"]),b,"h").w(" (").f(b.getPath(!0,["spaceGroup"]),b,"h").w(")</td></tr><tr><td  class='summary_datacollection_parameter_name'>Type</td><td class='summary_datacollection_parameter'>").f(b.getPath(!0,["phasingStepType"]),b,"h").w(" (").f(b.getPath(!0,["phasingPrograms"]),b,"h").w(")</td></tr><tr><td  class='summary_datacollection_parameter_name'>Method</td><td class='summary_datacollection_parameter'>").f(b.getPath(!0,["method"]),b,"h").w("</td></tr><tr><td  class='summary_datacollection_parameter_name'>Resolution</td><td class='summary_datacollection_parameter'>").f(b.getPath(!0,["lowRes"]),b,"h").w(" - ").f(b.getPath(!0,["highRes"]),b,"h").w("</td></tr><tr><td  class='summary_datacollection_parameter_name'>Protein</td><td class='summary_datacollection_parameter'>").f(b.getPath(!0,["acronym"]),b,"h").w("</td></tr><tr><td  class='summary_datacollection_parameter_name'>Start Time</td><td class='summary_datacollection_parameter'>").f(b.getPath(!0,["phasingStartTime"]),b,"h").w("</td></tr><tr><td  class='summary_datacollection_parameter_name'>End Time</td><td class='summary_datacollection_parameter'>").f(b.getPath(!0,["phasingEndTime"]),b,"h").w("</td></tr></table>")}return a.register("summaryphasinggrid.first.step",b),b.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.h("eq",b,{block:c},{key:b.get(["type"],!1),value:"images"},"h").h("eq",b,{block:e},{key:b.get(["type"],!1),value:"image"},"h").h("eq",b,{block:f},{key:b.get(["type"],!1),value:"logFile"},"h").h("eq",b,{block:g},{key:b.get(["type"],!1),value:"title"},"h").h("eq",b,{block:h},{key:b.get(["type"],!1),value:"info"},"h").h("eq",b,{block:i},{key:b.get(["type"],!1),value:"table"},"h").w("  ")}function c(a,b){return a.w('<table align="center"><tr>').s(b.get(["items"],!1),b,{block:d},{}).w("</tr>	</table>	")}function d(a,b){return a.w('<td><a href="data:image/png;base64,').f(b.getPath(!0,["value"]),b,"h").w("\" data-lightbox='a' data-title=\"").f(b.getPath(!0,["title"]),b,"h").w('"><img height="').f(b.getPath(!0,["ysize"]),b,"h").w('" width="').f(b.getPath(!0,["xsize"]),b,"h").w('" src="data:image/png;base64,').f(b.getPath(!0,["value"]),b,"h").w("\" /></a><br /><span class='summary_datacollection_parameter'>").f(b.getPath(!0,["title"]),b,"h").w("</span></td></div>	")}function e(a,b){return a.w('<div align="center"><img height="200" width="200" src="data:image/png;base64,').f(b.getPath(!0,["value"]),b,"h").w("\" /><br /><span class='summary_datacollection_parameter'>").f(b.getPath(!0,["title"]),b,"h").w("</span></div>			")}function f(a,b){return a.w("<div  style='border:1px solid gray;background-color:#FAFAFA;margin:10px;'><span  style='color: #157fcc;font-size: 17px;   font-weight: 300;'>").f(b.getPath(!0,["title"]),b,"h").w('</span><textarea style=\'margin:10px;\' rows="10" cols="150">').f(b.getPath(!0,["logText"]),b,"h").w(" </textarea></div>			")}function g(a,b){return a.w("<div><h1 >").f(b.getPath(!0,["value"]),b,"h").w("</h1></div>			")}function h(a,b){return a.w('<span style="display: inline; padding: .2em .6em .3em .6em;border-radius: .25em;color: #5bc0de; background-color: white;">').f(b.getPath(!0,["value"]),b,"h").w("</span>			")}function i(a,b){return a.w("<table style='border:1px solid gray;'><tr>").s(b.get(["columns"],!1),b,{block:j},{}).w("</tr>	").s(b.get(["data"],!1),b,{block:k},{}).w("</table>                                   		")}function j(a,b){return a.w("<th style='border: 1px solid black;'>").f(b.getPath(!0,[]),b,"h").w("</th>")}function k(a,b){return a.w("<tr>").s(b.getPath(!0,[]),b,{block:l},{}).w("</tr> ")}function l(a,b){return a.w("<td style='border: 1px solid black;'>").f(b.getPath(!0,[]),b,"h").w("</td>")}return a.register("workflowmainview.template",b),b.__dustBody=!0,c.__dustBody=!0,d.__dustBody=!0,e.__dustBody=!0,f.__dustBody=!0,g.__dustBody=!0,h.__dustBody=!0,i.__dustBody=!0,j.__dustBody=!0,k.__dustBody=!0,l.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.s(b.getPath(!0,[]),b,{block:c},{}).w("	")}function c(a,b){return a.w("<table><tr><td style='text-align:center;'>").h("eq",b,{block:d},{key:b.get(["status"],!1),value:"Success"},"h").h("eq",b,{block:e},{key:b.get(["status"],!1),value:"Failure"},"h").w("<span>").f(b.getPath(!0,["workflowStepType"]),b,"h").w('</span></td></tr><tr><td><img src="').f(b.getPath(!0,["imageURL"]),b,"h").w("\" style='border:1px solid #3892d3;' alt=\"").f(b.getPath(!0,["workflowStepType"]),b,"h").w('" height="100" width="100"></td></tr></table>')}function d(a,b){return a.w("<div class='summary_datacollection_success'></div>")}function e(a,b){return a.w("<div class='summary_datacollection_failed'></div>")}return a.register("workflowstepmain_steps",b),b.__dustBody=!0,c.__dustBody=!0,d.__dustBody=!0,e.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w('<div class="container-fluid"><div class="panel with-nav-tabs panel-default"><div class="panel-heading clearfix"><div class="pull-left"><h1 class="panel-title" style=\'color:#337ab7;\'><span style=\'font-size:12px;\'>   ').f(b.getPath(!0,["startTime"]),b,"h").w('</span></h1></div><div class="pull-right"><ul class="nav nav-tabs"><li class="active"><a data-toggle="tab" href="#datacollection_').f(b.get(["DataCollection_dataCollectionId"],!1),b,"h").w('">Summary </a></li></ul></div></div><br /><div class="tab-content"><div id="datacollection_').f(b.get(["DataCollection_dataCollectionId"],!1),b,"h").w('" class="tab-pane fade in active"><div class="container-fluid"><div class="row"><div class="col-xs-6 col-md-6"><table class="table table-condensed"><tr>      <td >Start Time</td><td class=\'column_parameter_value\'>').f(b.getPath(!0,["startTime"]),b,"h").w("</td>        </tr><tr><td >Filename</td><td class='column_parameter_value'>").f(b.getPath(!0,["filename"]),b,"h").w("</td></tr><tr><td >Fluorescence Detector</td><td class='column_parameter_value'>To be added to DB</td></tr><tr><td >Energy</td><td class='column_parameter_value'> ").f(b.getPath(!0,["energy"]),b,"h").w(" kev</td></tr><tr><td >Flux @100%</td><td class='column_parameter_value'>").f(b.getPath(!0,["flux"]),b,"h").w(" ph/s</td>    </tr><tr>      <td >Transmission</td><td class='column_parameter_value'>").f(b.getPath(!0,["beamTransmission"]),b,"h").w("%</td></tr><tr>       <td style='width:150px;' >Beam Size Hor</td><td class='column_parameter_value'>").f(b.getPath(!0,["beamSizeHorizontal"]),b,"h").w(" micrometer</td></tr><tr>                            <td >Beam Size Vert</td><td class='column_parameter_value'>").f(b.getPath(!0,["beamSizeVertical"]),b,"h").w(" micrometer</td></tr><tr>                                <td >Exposure Time</td><td class='column_parameter_value'>").f(b.getPath(!0,["exposureTime"]),b,"h").w(" s</td>                                    </tr><tr>                                <td >Directory</td><td class='column_parameter_value'>").f(b.getPath(!0,["workingDirectory"]),b,"h").w('</td>                                    </tr></table></div><div class="col-xs-2 col-md-2"><div id=\'').f(b.getPath(!0,["containerId"]),b,"h").w("'></div><br /><a href='#/mx/xfe/").f(b.getPath(!0,["xfeFluorescenceSpectrumId"]),b,"h").w('/main\' type="button" class="btn btn-default">Open</a></div>        </div></div></div></div></div>')}return a.register("xfescangrid.template",b),b.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w("<h2>").f(b.getPath(!0,["code"]),b,"h").w("</h2>").s(b.getPath(!0,[]),b,{block:c},{})}function c(a,b){return a.w("<br />Storage conditions: ").f(b.getPath(!0,["storageLocation"]),b,"h").w("<br />").f(b.getPath(!0,["comments"]),b,"h")}return a.register("parcelformsummary",b),b.__dustBody=!0,c.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w('<div id="container"><div style=\'float:left;\' id="left"><img class="titleImage" src="../images/logo_EXI.jpg" /><span class="title">ExiSAXS<span class="subtitle">Extended ISPyB forSAXS<sub style="font-size:10px;color:orange">BETA</sub></span></span></div><div id="center"></div><div style=\'float:right;width:120px;\' id="logos"><img class="logoImage" src="../images/logo_EMBL.png" /><img class="logoImage" src="../images/logo_ESRF.png" /></div><div style=\'float:right;width:120px;\' id="right"><div style=\'color:white;font-size:10px; \'>Version: ').f(b.getPath(!0,["version"]),b,"h").w("</div><div style='color:white;font-size:10px; '>Released: ").f(b.getPath(!0,["release_date"]),b,"h").w("</div><div style='color:white;font-size:10px;'>").f(b.getPath(!0,["database"]),b,"h").w("</div></div></div>")}return a.register("saxsheader",b),b.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w(" <kbd style='background-color:#AC58FA;font-size:12px;'>").f(b.getPath(!0,["experimentType"]),b,"h").w("</kbd><br />").f(b.getPath(!0,["creationDate"]),b,"h").w("<br />").f(b.getPath(!0,["name"]),b,"h").w('<br /><table style=\'margin-left:10px;\'>           <tr><td  style="height:10px;">Subtractions</td><td style=\'padding-left:10px;\'><div class="meter-wrap"><div class="meter-value" style="background-color: #99CC00 ; width: ').f(b.getPath(!0,["subtracted"]),b,"h").w('%;"><div class="meter-text">').f(b.getPath(!0,["dataCollectionDoneCount"]),b,"h").w(" of ").f(b.getPath(!0,["dataCollectionCount"]),b,"h").w("</div></div></div></td></tr></table>")}return a.register("hplc.sessionsaxslistview.template",b),b.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.h("eq",b,{block:c},{key:b.get(["experimentType"],!1),value:"STATIC"},"h").w("    ").h("eq",b,{block:d},{key:b.get(["experimentType"],!1),value:"SAMPLE CHANGER"},"h").w("   ").h("eq",b,{block:e},{key:b.get(["experimentType"],!1),value:"CALIBRATION"},"h").w("  ").h("eq",b,{block:f},{key:b.get(["experimentType"],!1),value:"HPLC"},"h").w("   ")}function c(a,b){return a.p("static.sessionsaxslistview.template",b,b,{})}function d(a,b){return a.p("static.sessionsaxslistview.template",b,b,{})}function e(a,b){return a.p("static.sessionsaxslistview.template",b,b,{})}function f(a,b){return a.p("hplc.sessionsaxslistview.template",b,b,{})}return a.register("sessionsaxslistview.template",b),b.__dustBody=!0,c.__dustBody=!0,d.__dustBody=!0,e.__dustBody=!0,f.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w(" ").h("eq",b,{"else":c,block:d},{key:b.get(["experimentType"],!1),value:"STATIC"},"h").w(" <br />").f(b.getPath(!0,["creationDate"]),b,"h").w("<br />").f(b.getPath(!0,["name"]),b,"h").w('<br /><table style=\'margin-left:10px;\'><tr><td  style="height:10px;">Samples</td><td style=\'padding-left:10px;\'><div class="meter-wrap"><div class="meter-value" style="background-color: #99CC00 ; width: ').f(b.getPath(!0,["measured"]),b,"h").w('%;"><div class="meter-text">').f(b.getPath(!0,["measurementDoneCount"]),b,"h").w(" of ").f(b.getPath(!0,["measurementCount"]),b,"h").w('</div></div></div></td></tr><tr><td  style="height:10px;">Averages</td><td style=\'padding-left:10px;\'><div class="meter-wrap"><div class="meter-value" style="background-color: #99CC00 ; width: ').f(b.getPath(!0,["averaged"]),b,"h").w('%;"><div class="meter-text">').f(b.getPath(!0,["measurementAveragedCount"]),b,"h").w(" of ").f(b.getPath(!0,["measurementCount"]),b,"h").w('</div></div></div></td></tr><tr><td  style="height:10px;">Subtractions</td><td style=\'padding-left:10px;\'><div class="meter-wrap"><div class="meter-value" style="background-color: #99CC00 ; width: ').f(b.getPath(!0,["subtracted"]),b,"h").w('%;"><div class="meter-text">').f(b.getPath(!0,["dataCollectionDoneCount"]),b,"h").w(" of ").f(b.getPath(!0,["dataCollectionCount"]),b,"h").w("</div></div></div></td></tr></table>")}function c(a,b){return a.w("<kbd style='background-color:#2E9AFE;font-size:12px;'>").f(b.getPath(!0,["experimentType"]),b,"h").w("</kbd>")}function d(a,b){return a.w("       <kbd style='background-color:#088A08;font-size:12px;'>SAMPLE CHANGER</kbd>")}return a.register("static.sessionsaxslistview.template",b),b.__dustBody=!0,c.__dustBody=!0,d.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w("<table> <tr><td>Macromolecule:</td><td style='color:#207a7a;font-weight:bold;'>").f(b.getPath(!0,["macromoleculeAcronym"]),b,"h").w(" ").f(b.getPath(!0,["record","data","concentration"]),b,"h").w(" mg/ml</td></tr><tr><td>Buffer:</td><td>").f(b.getPath(!0,["bufferAcronym"]),b,"h").w("</td></tr><tr><td>Storage Temperature:</td><td>").f(b.getPath(!0,["storageTemperature"]),b,"h").w("</td></tr></table>")}return a.register("stocksolution.listview",b),b.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w("<table>").s(b.getPath(!0,[]),b,{block:c},{}).w("</table>")}function c(a,b){return a.w("<tr><td>").f(b.getPath(!0,["count"]),b,"h").w("</td><td>").f(b.getPath(!0,["step"]),b,"h").w("</td></tr>")}return a.register("test",b),b.__dustBody=!0,c.__dustBody=!0,b}(dust);