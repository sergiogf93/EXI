function display_content(a){var b=$("#content");b.empty();var c=$("#title");c.empty(),c.text(a.title);var d=$("#selectSection");d.empty();var e=a.sections;b.data(e);for(var f=0;f<e.length;f++)console.log(e[f].title),d.append($("<option/>").val(f).text(e[f].title));d.change(function(){var a=parseInt($("#selectSection").val());display_section(a)}),display_section(0)}function display_section(a){var b=$("#content");b.empty(),all_content=b.data();var c=all_content[a];b.append($("<h3/>").text(c.title)),b.append($("<hr/>")),i_graph=0;for(var d=0;d<c.content.length;d++){var e=c.content[d];if(e.content_type==CONTENT_SUB_HEADER)b.append($("<h4/>").text(e.content));else if(e.content_type==CONTENT_PARA_HEADER)b.append($("<h5/>").text(e.content));else if(e.content_type==CONTENT_TEXT)b.append($("<p/>").text(e.content));else if(e.content_type==CONTENT_PREFORMATTED)b.append($("<pre/>").text(e.content));else if(e.content_type==CONTENT_TABLE){console.log("TABLE");for(var f=$("<table/>").attr("class","data_display"),g=0;g<e.content.rows.length;g++){var h=e.content.rows[g],i=$("<tr/>");f.append(i),0==g?i.attr("class","header"):i.attr("class","content");for(var j=0;j<h.length;j++)i.append($("<td/>").text(h[j]).attr("class","data_cell"))}b.append(f)}else if(e.content_type==CONTENT_PLOT){var k="graph"+i_graph;b.append($("<div/>").attr("id",k).attr("class","loggraph"));new xtal.loggraph.Loggraph("#"+k,[e.content],i_graph,!0);i_graph++,b.append($("<br/>"))}}}function sprintf(){var a=/%%|%(\d+\$)?([-+\'#0 ]*)(\*\d+\$|\*|\d+)?(\.(\*\d+\$|\*|\d+))?([scboxXuideEfFgG])/g,b=arguments,c=0,d=b[c++],e=function(a,b,c,d){c||(c=" ");var e=a.length>=b?"":new Array(1+b-a.length>>>0).join(c);return d?a+e:e+a},f=function(a,b,c,d,f,g){var h=d-a.length;return h>0&&(a=c||!f?e(a,d,g,c):a.slice(0,b.length)+e("",h,"0",!0)+a.slice(b.length)),a},g=function(a,b,c,d,g,h,i){var j=a>>>0;return c=c&&j&&{2:"0b",8:"0",16:"0x"}[b]||"",a=c+e(j.toString(b),h||0,"0",!1),f(a,c,d,g,i)},h=function(a,b,c,d,e,g){return null!=d&&(a=a.slice(0,d)),f(a,"",b,c,e,g)},i=function(a,d,i,j,k,l,m){var n,o,p,q,r;if("%%"===a)return"%";for(var s=!1,t="",u=!1,v=!1,w=" ",x=i.length,y=0;i&&x>y;y++)switch(i.charAt(y)){case" ":t=" ";break;case"+":t="+";break;case"-":s=!0;break;case"'":w=i.charAt(y+1);break;case"0":u=!0,w="0";break;case"#":v=!0}if(j=j?"*"===j?+b[c++]:"*"==j.charAt(0)?+b[j.slice(1,-1)]:+j:0,0>j&&(j=-j,s=!0),!isFinite(j))throw new Error("sprintf: (minimum-)width must be finite");switch(l=l?"*"===l?+b[c++]:"*"==l.charAt(0)?+b[l.slice(1,-1)]:+l:"fFeE".indexOf(m)>-1?6:"d"===m?0:void 0,r=d?b[d.slice(0,-1)]:b[c++],m){case"s":return h(String(r),s,j,l,u,w);case"c":return h(String.fromCharCode(+r),s,j,l,u);case"b":return g(r,2,v,s,j,l,u);case"o":return g(r,8,v,s,j,l,u);case"x":return g(r,16,v,s,j,l,u);case"X":return g(r,16,v,s,j,l,u).toUpperCase();case"u":return g(r,10,v,s,j,l,u);case"i":case"d":return n=+r||0,n=Math.round(n-n%1),o=0>n?"-":t,r=o+e(String(Math.abs(n)),l,"0",!1),f(r,o,s,j,u);case"e":case"E":case"f":case"F":case"g":case"G":return n=+r,o=0>n?"-":t,p=["toExponential","toFixed","toPrecision"]["efg".indexOf(m.toLowerCase())],q=["toString","toUpperCase"]["eEfFgG".indexOf(m)%2],r=o+Math.abs(n)[p](l),f(r,o,s,j,u)[q]();default:return a}};return d.replace(a,i)}function run_app(){$("#run_app").submit()}function display_grid(a,b){for(var c=$("#restraints_grid"),d=a.get_block("comp_list"),e=d.loop_dict("_chem_comp"),f=0;f<e.length;f++){var g=e[f].three_letter_code;"."==g&&(g=e[f].id);var h="comp_"+g.toLowerCase();console.log(h);var i=a.get_block(h),j=$("<ul/>").attr("class","ui-tabs-nav");c.append(j),add_tab(j,"bonds-div","Bonds"),add_tab(j,"angles-div","Angles"),add_tab(j,"dihedrals-div","Dihedrals"),add_tab(j,"chirals-div","Chirals"),add_tab(j,"planes-div","Planes");var k=create_table("bonds",["Atom 1","Atom 2","Type","Value","Sigma"]),l=$("<div/>").attr("id","bonds-div").attr("class","ui-tabs-panel");c.append(l),l.append(k),console.log(i);for(var m=i.loop_dict("_chem_comp_bond"),n=0;n<m.length;n++){var o=m[n];add_row(k,[o.atom_id_1,o.atom_id_2,o.type,o.value_dist,o.value_dist_esd],[0,1],b)}var p=create_table("angles",["Atom 1","Atom 2","Atom 3","Value","Sigma"]),q=$("<div/>").attr("id","angles-div");c.append(q),q.append(p);for(var r=i.loop_dict("_chem_comp_angle"),s=0;s<r.length;s++){var t=r[s];add_row(p,[t.atom_id_1,t.atom_id_2,t.atom_id_3,t.value_angle,t.value_angle_esd],[0,1,2],b)}var u=create_table("dihedrals",["Atom 1","Atom 2","Atom 3","Atom 4","Value","Sigma","Period"]),v=$("<div/>").attr("id","dihedrals-div");c.append(v),v.append(u);for(var w=i.loop_dict("_chem_comp_tor"),x=0;x<w.length;x++){var y=w[x];add_row(u,[y.atom_id_1,y.atom_id_2,y.atom_id_3,y.atom_id_4,y.value_angle,y.value_angle_esd,y.period],[0,1,2,3],b)}}c.tabs()}function add_tab(a,b,c){var d=$("<li/>").append($("<a/>").attr("href","#"+b).attr("class","ui-tabs-anchor").text(c));return a.append(d),a}function create_table(a,b){var c=$("<table/>").attr("id",a).attr("class","data_display_narrow"),d=$("<tr/>").attr("class","header");c.append(d);for(var e=0;e<b.length;e++)d.append($("<td/>").attr("class","data_cell").text(b[e]));return c}function add_row(a,b,c,d){for(var e=$("<tr/>").attr("class","content"),f=0;f<b.length;f++)e.append($("<td/>").attr("class","data_cell").text(b[f]));if(a.append(e),c){var g=[];for(var f in c)g.push(b[f]);e.data(g),e.click(function(){OnSelect($(this),a,d)})}return e}function OnSelect(a,b,c){b.find("tr").each(function(){"selected"==$(this).attr("class")&&$(this).attr("class","content")}),a.attr("class","selected");var d=a.data(),e=[];for(var f in d)e.push(d[f]);c(e)}function mapDisplayObject(a,b,c,d){this.data=a,this.name=b,this.display_data=null,this.flag_difference_map=c,this.parameters={isolevel:1,visible:!0,color:"#00c0ff"},c?d?(this.parameters.isolevel=3,this.parameters.color="#ffff00",this.parameters["color-"]="#ff00ff"):(this.parameters.isolevel=3,this.parameters.color="#00ff00",this.parameters["color-"]="#ff0000"):d&&(this.parameters.isolevel=3,this.parameters.color="#ffa0a0"),this.meshes=[],this.update_isolevel=function(a,b,c){return update_map_isolevel(this,a,b,c)},this.update_mesh=function(a,b){return update_mesh(this,a,b)},this.update_color=function(a,b){return update_map_color(this,a,b)}}function isomesh(a,b,c){var d=new THREE.MeshBasicMaterial({color:49407,wireframe:!0,transparent:!0});d.color.setHex(c.replace("#","0x"));var e=new THREE.Mesh(a,d);return e.name=b,e}function update_mesh(a,b,c){a.display_data=null,a.update_isolevel(a.parameters.isolevel,b,c)}function update_map_isolevel(a,b,c,d){if(a.parameters.visible){a.display_data||(a.display_data=a.data.points_and_values(d,c));var e=[1],f=[a.parameters.color];a.flag_difference_map&&(e=[1,-1],f=[a.parameters.color,a.parameters["color-"]]);for(var g=0;g<e.length;g++)geometry=xtal.marchingcubes.isosurface(a.display_data.points,a.display_data.values,a.display_data.size,e[g]*a.parameters.isolevel),mesh=isomesh(geometry,"mesh_obj",f[g]),a.meshes.push(mesh)}}function update_map_color(a,b,c){c||(c=""),a.parameters["color"+c]=b,a.parameters.visible&&(a.flag_difference_map?(a.meshes[0].material.color.setHex(a.parameters.color.replace("#","0x")),a.meshes[1].material.color.setHex(a.parameters["color-"].replace("#","0x"))):a.meshes[0].material.color.setHex(b.replace("#","0x")))}function modelDisplayObject(a,b){this.parameters={visible:!0,render_style:"lines",color_scheme:"element",carbon_color:"#ffff00",hydrogens:"monlib"==a.source},this.model=a,this.name=b,this.geom_objects=null,this.selected=null,this._ribbon=null,this.update_geom=function(){"lines"==this.parameters.render_style?this.geom_objects=[new Bonds(this.model,this.parameters)]:"trace"==this.parameters.render_style?this.geom_objects=[new Trace(this.model,this.parameters)]:"trace+ligands"==this.parameters.render_style?this.geom_objects=[new Trace(this.model,this.parameters),new Bonds(this.model,this.parameters)]:"ribbon"==this.parameters.render_style?(null==this._ribbon&&(this._ribbon=new RibbonGeometry(this.model)),this.geom_objects=[new Ribbon(this.model,this._ribbon),new Bonds(this.model,this.parameters,!0)]):"ellipsoids"==this.parameters.render_style&&(anisous=new Ellipsoids(this.model,this.parameters),this.geom_objects=[new Bonds(this.model,this.parameters),anisous])},this.show_selection=function(a){this.selected=new Highlights(this.model,a)},this.select_atoms=function(a){var b=this.model.selection(a);console.log(b.length),this.show_selection(b)},this.show_selection_by_atom_names=function(a){if(console.log(a),atom_selection=this.model.select_atom_names(a),0==atom_selection.length)throw Error("No atoms selected for "+a);this.show_selection(atom_selection)},this.update_colors=function(){return this.update_geom()}}function color_by_property(a){var b=Math.max.apply(null,a),c=Math.min.apply(null,a);b-=c,0>=b&&(b=1);for(var d=[],e=0;e<a.length;e++){var f=(a[e]-c)/b,g=new THREE.Color(14737632),h=(240-240*f)/360;g.setHSL(h,1,.5),d.push(g)}return d}function color_by_bfactor(a,b){for(var c=[],d=0;d<a.length;d++)c.push(a[d].b);return color_by_property(c)}function color_by_index(a,b){for(var c=[],d=0;d<a.length;d++)c.push(d);return color_by_property(c)}function color_by_element(a,b,c){for(var d=[],e={H:new THREE.Color(15790320),C:new THREE.Color(16776960).setHex(b.replace("#","0x")),N:new THREE.Color(4210943),O:new THREE.Color(16728128),MG:new THREE.Color(12632256),P:new THREE.Color(16760896),S:new THREE.Color(4259648),CL:new THREE.Color(10551136),CA:new THREE.Color(16777215),MN:new THREE.Color(16748736),FE:new THREE.Color(10498048),NI:new THREE.Color(65408)},f=new THREE.Color(10526880),g=0;g<a.length;g++){var h=e[a[g].element];h||(h=f),d.push(h)}return d}function draw_isolated_atom(a,b,c){for(var d=[[-.5,0,0],[.5,0,0],[0,-.5,0],[0,.5,0],[0,0,-.5],[0,0,.5]],e=0;6>e;e+=2){var f=a.xyz[0]+d[e][0],g=a.xyz[1]+d[e][1],h=a.xyz[2]+d[e][2],i=a.xyz[0]+d[e+1][0],j=a.xyz[1]+d[e+1][1],k=a.xyz[2]+d[e+1][2];b.vertices.push(new THREE.Vector3(a.xyz[0],a.xyz[1],a.xyz[2]),new THREE.Vector3(f,g,h),new THREE.Vector3(a.xyz[0],a.xyz[1],a.xyz[2]),new THREE.Vector3(i,j,k)),b.colors.push(c),b.colors.push(c),b.colors.push(c),b.colors.push(c)}}function draw_bonded_atom(a,b,c,d,e,f,g,h){for(var i=c.atoms(),j=0;j<d.length;j++){var k=i[d[j]];if((f||"H"!=k.element)&&(!g||h[d[j]])){var l=e.midpoint(k);a.vertices.push(new THREE.Vector3(e.xyz[0],e.xyz[1],e.xyz[2]),new THREE.Vector3(l[0],l[1],l[2])),a.colors.push(b,b)}}}function RibbonGeometry(a){this.c_alpha_i_seqs=[],this.o_i_seqs=[],this.c_i_seqs=[],this._segments=[];var b=a.chains(),c=0;console.log("CHAINS:",b.length);for(var d=0;d<b.length;d++){var e=null,f=b[d].residues(),g=null;console.log("RESIDUES:",f.length);for(var h=0;h<f.length;h++){var i=f[h];if(i.n_atoms()<3)e=null;else{var j=i.get_atom("CA"),k=i.get_atom("C"),l=i.get_atom("O");null!=j&&null!=k&&null!=l?(c++,null!=e&&j.distance(e)>5.5&&(e=null,g=null),null==g?(g=new RibbonSegment(j,e,k,l),this._segments.push(g)):g.add_residue(j,k,l),e=j):e=null}}}console.log("SEGMENTS:",this._segments.length),this.draw_ribbon=function(a,b){for(var c=0;c<this._segments.length;c++){var d=this._segments[c];d.draw_ribbon(a,b)}}}function RibbonSegment(a,b,c,d,e){e||(e=1),this._last_site=null,this._anchors=[a.as_vec3()],this._indices=[a.i_seq],this._peptide_vectors=[d.as_vec3().sub(c.as_vec3())],this._vertices=null,this._vertex_i_seqs=[],this._ribbon_vertex_vectors=null,null!=b&&(this._last_site=b.as_vec3()),this.add_residue=function(a,b,c){this._anchors.push(a.as_vec3()),this._indices.push(a.i_seq),this._peptide_vectors.push(c.as_vec3().sub(b.as_vec3()))},this.construct_geometry=function(a){var b=this._anchors.length;a||(a=5),null!=this._last_site?(this._anchors.splice(0,0,this._last_site),this._indices.splice(0,0,this._indices[0])):(v01=this._anchors[0].clone().sub(this._anchors[1]),v00=this._anchors[0].clone().add(v01),this._anchors.splice(0,0,v00),this._indices.splice(0,0,this._indices[0]));for(var c=this._anchors,d=this._indices,f=a,g=[],h=[],i=[],j=-4;4>=j;j++){for(var k=e/2*j/4,l=[],m=[],n=this._peptide_vectors[0].clone(),o=1;b-1>o;o++){var p=this._peptide_vectors[o].clone(),q=this._peptide_vectors[o+1].clone(),r=180*p.angleTo(n)/Math.PI;r>90&&p.multiplyScalar(-1);var s=p.clone().add(n).normalize(),t=180*p.angleTo(q)/Math.PI;t>90&&q.multiplyScalar(-1);var u=p.clone().add(q).normalize();n=p;var v=s.multiplyScalar(k),w=u.multiplyScalar(k),x=c[o-1].clone().add(v),y=c[o].clone().add(v),z=c[o+1].clone().add(w),A=c[o+2].clone().add(w),B=y.clone().sub(x).normalize(),C=z.clone().sub(A).normalize(),D=x.clone().add(y).multiplyScalar(.5),E=y.clone().add(z).multiplyScalar(.5),F=z.clone().add(A).multiplyScalar(.5),G=E.add(B.clone().add(C).multiplyScalar(.5));if(1==o){m.push(D),i.push(p),l.push(d[0]);for(var H=interpolate(x,D,y,G,f),I=0;I<H.length;I++)m.push(H[I]),i.push(p),l.push(d[o])}m.push(y),i.push(p),l.push(d[o]);for(var J=interpolate(D,y,G,z,f),I=0;I<J.length;I++)m.push(J[I]),l.push(d[o]),i.push(p);m.push(G),i.push(p),l.push(d[o]);for(var K=interpolate(y,G,z,F,f),I=0;I<K.length;I++)m.push(K[I]),l.push(d[o+1]),i.push(p);if(o==b-1)for(var L=interpolate(G,z,F,A,f),I=0;I<L.length;I++)m.push(L[I]),l.push(d[b]),i.push(p)}if(m.length!=l.length)throw Error("Array size mismatch:",m.length,l.length);g.push(m),h.push(l)}this._vertices=g,this._vertex_i_seqs=h,this._ribbon_vertex_vectors=i},this.draw_ribbon=function(a,b){null==this._vertices&&this.construct_geometry(8);for(var c=0;9>c;c++){vertices=this._vertices[c],indices=this._vertex_i_seqs[c];for(var d=1;d<vertices.length;d++){var e=indices[d];a.vertices.push(vertices[d-1],vertices[d]),a.colors.push(b[e],b[e])}}}}function assert_vector_is_defined(a,b){for(var c=0;c<a.length;c++)if(NaN==a[c])throw Error("undefined vector "+b);return!0}function UnitCellBox(a){if(!a)throw Error("Unit cell not defined!");for(var b=[[0,0,0],[1,0,0],[0,0,0],[0,1,0],[0,0,0],[0,0,1],[1,0,0],[1,1,0],[1,0,0],[1,0,1],[0,1,0],[1,1,0],[0,1,0],[0,1,1],[0,0,1],[1,0,1],[0,0,1],[0,1,1],[1,0,1],[1,1,1],[1,1,0],[1,1,1],[0,1,1],[1,1,1]],c=new THREE.Geometry,d=0;d<b.length;d+=2){var e=a.orthogonalize(b[d]),f=a.orthogonalize(b[d+1]);c.vertices.push(new THREE.Vector3(e[0],e[1],e[2]),new THREE.Vector3(f[0],f[1],f[2]))}c.colors.push(new THREE.Color(16711680),new THREE.Color(16755200),new THREE.Color(65280),new THREE.Color(11206400),new THREE.Color(255),new THREE.Color(43775));for(var d=6;d<b.length;d++)c.colors.push(new THREE.Color(16777215));var g=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors});THREE.Line.call(this,c,g,THREE.LinePieces)}function vec3(a,b,c){return new THREE.Vector3(a,b,c)}function interpolate(a,b,c,d,e){for(var f=new THREE.Spline([a,b,c,d]),g=[],h=1;e>=h;h++){var i=(1+h/e)/3,j=f.getPoint(i);g.push(new THREE.Vector3(j.x,j.y,j.z))}return g}function detectmob(){return!0}function XtalViewer(a,b,c,d){a||(a="ThreeJS");var e;b?(e=[b.width(),Math.max(b.height(),800)],console.log("SIZE "+e)):e=[window.innerWidth,window.innerHeight],this.element=b,this.maps=[],this.models=[],this.gui_folders=[],this.global_parameters={map_radius:10,auto_zoom:!0};var f,g,h,i,j;i=new THREE.Scene,this.scene=i;var k=e[0],l=e[1];console.log(k+" "+l);var m=k/l;if(orthographic){var n=5,o=100;g=new THREE.OrthographicCamera(-50,50,50/m,-50/m,n,o)}else{var p=45,n=5,o=1e3;g=new THREE.PerspectiveCamera(p,m,n,o)}this.camera=g,this.fov=g.fov,i.add(g),i.fog=new THREE.Fog(0,60,100),g.position.set(20,20,60),g.lookAt(i.position),h=Detector.webgl?new THREE.WebGLRenderer({antialias:!0}):new THREE.CanvasRenderer,this.renderer=h,h.setClearColorHex(0,1),h.setSize(k,l),this.element||(h.domElement.style.position="absolute",h.domElement.style.top="0px",h.domElement.style.left="0px"),j=document.getElementById(a),j.appendChild(h.domElement),f=new THREE.TrackballControls(g,h.domElement),this.controls=f,f.minDistance=5,f.maxDistance=400,this.last_center=[f.target.x,f.target.y,f.target.z];var q=new THREE.PointLight(16777215);q.position.set(g.position.x,g.position.y,g.position.z),i.add(q),this.light=q,origin=new Axis(.5,[0,0,0],!0),i.add(origin),this.lastValidFrame=null,this.create_gui=function(){return create_gui(this)},c?this.create_gui():this.gui=null;var r=this;this.OnWindowResize=function(a){return OnWindowResize(r)},this.OnChange=function(a){return OnChange(r)},this.OnEnd=function(a){return OnEnd(r)},this.animate=function(){return animate(r)},window.addEventListener("resize",this.OnWindowResize,!1),this.controls.addEventListener("end",this.OnEnd),this.controls.addEventListener("change",this.OnChange),this.update=function(){this.controls.update()},this.render=function(){this.renderer.render(this.scene,this.camera)},this.redrawAxes=function(){this.axes&&this.scene.remove(this.axes);var a=this.controls.target;this.axes=new Axis(.5,[a.x,a.y,a.z],!1),this.scene.add(this.axes)},this.reset=function(){this.gui&&(this.gui.destroy(),this.create_gui());for(var a=0;a<this.maps.length;a++)this.maps[a].clear_mesh(!0),delete this.maps[a];for(var a=0;a<this.models.length;a++)this.clear_model_geom(this.models[a]),delete this.models[a];this.gui_folders=[],this.maps=[],this.models=[],this.camera.position.set(20,20,60),this.camera.lookAt(this.scene.position),this.controls.update(),this.OnChange(),this.lastValidFrame=null},this.recenter=function(a){this.controls.target.x=a[0],this.controls.target.y=a[1],this.controls.target.z=a[2],this.camera.lookAt(a),this.controls.update(),this.camera.updateProjectionMatrix(),this.redrawMaps(),this.animate(),this.lastValidFrame=null},this.force_redraw=function(){this.OnChange()},this.zoomXYZ=function(a){this.camera.position.x=a[0],this.camera.position.y=a[1],this.camera.position.z=a[2]+20,this.recenter(a),this.lastValidFrame=null},this.redrawMaps=function(a){var b=[this.controls.target.x,this.controls.target.y,this.controls.target.z];if(a||Math.abs(b[0]-this.last_center[0])>.01||Math.abs(b[1]-this.last_center[1])>.01||Math.abs(b[2]-this.last_center[2])>.01){this.last_center=b;for(var c=0;c<this.maps.length;c++)this.maps[c].clear_mesh(!0),this.maps[c].update_mesh(this.global_parameters.map_radius,b),this.render_mesh(this.maps[c]);this.lastValidFrame=null}},this.clear_mesh=function(a,b){for(var c=a.meshes.length-1;c>=0;)a.meshes[c]&&(this.scene.remove(a.meshes[c]),a.meshes.pop()),c--;b&&(a.display_data=null)},this.clear_model_geom=function(a){if(a.geom_objects)for(var b=0;b<a.geom_objects.length;b++)this.scene.remove(a.geom_objects[b]);a.geom_objects=null,this.clear_model_selection(a)},this.clear_model_selection=function(a){a.selected&&this.scene.remove(a.selected),a.selected=null},this.select_atoms=function(a,b){if(!b){if(0==this.models.length)throw alert("No models loaded!"),Error();if(this.models.length>1)throw alert("More than one model possible"),Error();b=this.models[0]}this.clear_model_selection(b),b.select_atoms(a),b.selected?(this.scene.add(b.selected),this.render()):alert("No atoms selected!")},this.toggle_map_visibility=function(a,b){a.parameters.visible=b,b?(a.update_mesh(this.global_parameters.map_radius,this.last_center),this.render_mesh(a)):a.clear_mesh()},this.toggle_model_visibility=function(a,b){a.parameters.visible=b,b?(a.update_geom(),this.render_model(a)):a.clear_geom()},this.redraw_model=function(a){a.clear_geom(),a.update_geom(),this.render_model(a)},this.render_mesh=function(a){for(var b=0;b<a.meshes.length;b++)this.scene.add(a.meshes[b]);this.render()},this.render_model=function(a){if(a.geom_objects)for(var b=0;b<a.geom_objects.length;b++)this.scene.add(a.geom_objects[b]);this.render()},this.initialize_map_object=function(a,b,c,d){return initialize_map_object(this,a,b,c,d)},this.initialize_model_object=function(a,b){return initialize_model_object(this,a,b)},this.fetchPDB=function(a){return fetchPDB(this,a)},this.load_pdb=function(a,b){return load_pdb(this,a,b)},this.load_mon_lib=function(a,b){return load_mon_lib(this,a,b)},this.load_mmcif=function(a,b){return load_mmcif(this,a,b)},this.load_cif=function(a,b){return load_cif(this,a,b)},this.load_ccp4_map=function(a,b,c){return load_ccp4_map(this,a,b,c)},this.load_dsn6_map=function(a,b,c){return load_dsn6_map(this,a,b,c)},this.load_eds_maps=function(a){return load_eds_maps(this,a)},this.enable_leap_motion=function(){var a=this;Leap.loop(function(b){OnFrame(a,b)})}}function OnWindowResize(a){var b,c;a.element?(b=a.element.width(),c=a.element.height()):(b=window.innerWidth,c=window.innerHeight),a.camera.aspect=b/c,a.camera.updateProjectionMatrix(),a.renderer.setSize(b,c)}function OnChange(a){var b=a.camera.position.x,c=a.camera.position.y,d=a.camera.position.z,e=a.controls.target.x,f=a.controls.target.y,g=a.controls.target.z,h=Math.sqrt(Math.pow(b-e,2)+Math.pow(c-f,2)+Math.pow(d-g,2));a.scene.fog.near=2,a.scene.fog.far=Math.min(1.2*h,h+10),a.camera.near=.8*h,a.camera.far=2*h,a.light.position.set(a.camera.position.x,a.camera.position.y,a.camera.position.z),a.camera.updateProjectionMatrix(),a.redrawAxes()}function OnEnd(a){a.redrawAxes(),a.redrawMaps()}function OnFrame(a,b){if(b.valid){a.lastValidFrame||(a.lastValidFrame=b);var c=a.lastValidFrame.translation(b);if(a.lastValidFrame=b,c[0]<.001&&c[1]<.001&&c[2]<.001)return;console.log(c);var d=a.camera.position.x,e=a.camera.position.y,f=a.camera.position.z,g=a.controls.target.x,h=a.controls.target.y,i=a.controls.target.z,j=Math.sqrt((d-g)*(d-g)+(e-h)*(e-h)+(f-i)*(f-i));curY=Math.max(0,Math.min((c[1]+300)/600*179,179)),rotateX=c[0],rotateY=-curY,zoom=c[2],zoomFactor=1/(1+zoom/150),zoomFactor>1?zoomFactor=Math.min(zoomFactor,1.05):zoomFactor=Math.max(zoomFactor,.95),5>j&&zoomFactor>0&&(zoomFactor=1),j=1,a.camera.position.x=d+j*Math.sin(rotateY*Math.PI/180)*Math.cos(rotateX*Math.PI/180),a.camera.position.z=e+j*Math.sin(rotateY*Math.PI/180)*Math.sin(rotateX*Math.PI/180),a.camera.position.y=f+j*Math.cos(rotateY*Math.PI/180),a.camera.lookAt(a.controls.target),OnChange(a),a.render(),a.update()}}function animate(a){a.render(),a.update(),requestAnimationFrame(a.animate)}function initialize_map_object(a,b,c,d,e){if(!d)var d="mFo-DFc"==c||-1!=c.indexOf("_mFo-DFc");if(!e)var e="anom"==c||-1!=c.indexOf("_anom");var f=new mapDisplayObject(b,c,d,e);f.clear_mesh=function(){a.clear_mesh(f)},a.gui&&setup_map_dat_gui(a,f),a.maps.push(f),f.update_mesh(a.global_parameters.map_radius,a.last_center),a.render_mesh(f),a.force_redraw()}function initialize_model_object(a,b,c){var d=new modelDisplayObject(b,c);d.clear_geom=function(){a.clear_model_geom(d)},a.gui&&setup_model_dat_gui(a,d),a.models.push(d),a.redraw_model(d),a.global_parameters.auto_zoom&&(center_and_size=b.get_center_and_size(),a.recenter(center_and_size[0]))}function create_gui(a){a.gui=new dat.GUI;var b=a.gui.add(a.global_parameters,"map_radius").min(5).max(20).step(1).name("Map radius").listen();b.onChange(function(b){a.redrawMaps(!0)}),detectmob()?a.gui.close():a.gui.open()}function setup_map_dat_gui(a,b){var c=a.gui.addFolder("Map: "+b.name);a.gui_folders.push(c);var d=c.add(b.parameters,"visible").name("Display").listen();d.onChange(function(c){a.toggle_map_visibility(b,c)});var e=c.add(b.parameters,"isolevel").min(0).max(8).step(.1).name("Contour level").listen();if(e.onChange(function(c){b.clear_mesh(),b.update_isolevel(c,a.global_parameters.map_radius,a.last_center),a.render_mesh(b)}),b.flag_difference_map){var f=c.addColor(b.parameters,"color").name("Color (+)").listen();f.onChange(function(a){b.update_color(a,"")});var g=c.addColor(b.parameters,"color-").name("Color (-)").listen();g.onChange(function(a){b.update_color(a,"-")})}else{var h=c.addColor(b.parameters,"color").name("Color").listen();h.onChange(function(a){b.update_color(a,"")})}a.gui.closed||c.open()}function setup_model_dat_gui(a,b){var c=a.gui.addFolder("Model: "+b.name);a.gui_folders.push(c);var d=c.add(b.parameters,"visible").name("Display").listen();d.onChange(function(c){a.toggle_model_visibility(b,c)});var e=c.add(b.parameters,"render_style",["lines","trace","trace+ligands","ribbon","ellipsoids"]).name("Draw as").listen();e.onChange(function(c){a.redraw_model(b)});var f=c.add(b.parameters,"color_scheme",["element","rainbow","bfactor"]).name("Color scheme").listen();f.onChange(function(c){a.redraw_model(b)});var g=c.addColor(b.parameters,"carbon_color").name("C atom color").listen();g.onChange(function(c){"element"==b.color_scheme&&a.redraw_model(b)}),a.gui.closed||c.open()}function load_mon_lib(a,b,c){var d=new xtal.cif.Reader;d.load(b,function(b){var d=b.get_block("comp_list"),e=d.get("_chem_comp.id")[0],e=b.get_block("comp_"+e),f=new xtal.model.Model;f.from_monlib(e),a.initialize_model_object(f,c)})}function load_mmcif(a,b,c){var d=new xtal.cif.Reader;d.load(b,function(b){var d=new xtal.model.Model;d.from_mmcif(b.first_block()),a.initialize_model_object(d,c)})}function load_cif(a,b,c){var d=new xtal.cif.Reader;d.load(b,function(b){var d=new xtal.model.Model;d.from_cif(b.first_block()),a.initialize_model_object(d,c)})}function load_pdb(a,b,c){var d=new XMLHttpRequest;d.open("GET",b,!0),d.onreadystatechange=function(e){if(4==d.readyState)if(200==d.status){var f=new xtal.model.Model;f.from_pdb(d.responseText),a.initialize_model_object(f,c)}else console.log("Error fetching "+b)},d.send(null)}function load_ccp4_map(a,b,c,d){var e=new XMLHttpRequest;e.responseType="arraybuffer",e.open("GET",b,!0),e.onreadystatechange=function(f){if(4==e.readyState)if(200==e.status){var g=new Int32Array(e.response),h=new xtal.Map;h.from_ccp4(g),h.show(),a.initialize_map_object(h,c,d)}else console.log("Error fetching "+b)},e.send(null)}function load_dsn6_map(a,b,c,d){var e=new XMLHttpRequest;e.responseType="arraybuffer",e.open("GET",b,!0),e.onreadystatechange=function(f){if(4==e.readyState)if(200==e.status){var g=new Uint8Array(e.response),h=new xtal.Map;h.from_dsn6(g),console.log("DSN6 MAP:"),h.show(),a.initialize_map_object(h,c,d)}else console.log("Error fetching "+b)},e.send(null)}function validate_pdb_id(a){if(console.log("PDB ID: "+a),4!=a.length)throw $("The string '"+a+"' is not a valid PDB ID.").dialog({modal:!0,buttons:{Ok:function(){$(this).dialog("close")}}}),Error("Bad PDB ID.")}function fetchPDB(a,b){url="http://www.rcsb.org/pdb/files/"+b+".pdb",load_pdb(a,url,b)}function requestPDB(a,b){validate_pdb_id(b);var c=new XMLHttpRequest;c.open("GET","/"+b+".json"),c.onreadystatechange=function(d){if(4==c.readyState){console.log("RESPONSE");var e=jQuery.parseJSON(c.responseText);if(e.error)throw Error(e.error);e.pdb_mmcif?a.load_mmcif(e.pdb_mmcif,b):e.pdb_file&&a.loadPDBFromServer(e.pdb_file,b),e.features&&display_features_gui(e.features),e.two_fofc_map&&loadMapFromServer(e.two_fofc_map,"2mFo-Dfc",!1),e.fofc_map&&loadMapFromServer(e.fofc_map,"mFo-Dfc",!0)}},c.send(null)}function load_eds_maps(a,b){b=b.toLowerCase(),validate_pdb_id(b),a.fetchPDB(b),subdir=b.substring(1,3),base_url="/eds/dfs/"+subdir+"/"+b+"/",two_fofc_map=base_url+b+".omap",fofc_map=base_url+b+"_diff.omap",a.load_dsn6_map(two_fofc_map,b+"_2mFo-DFc",!1),a.load_dsn6_map(fofc_map,b+"_mFo-DFc",!0)}function draw_pdb_id_request(a,b){var c=$("body"),d=$("<div/>").attr("class","centeredControls").attr("id","loadControls").append($("<form/>").attr("id","pdbIdForm").append($("<div/>").attr("class","controlItem").attr("id","pdbFetch").append($("<span/>").text("Load PDB ID:"),$("<input/>").attr("type","text").attr("id","pdbIdInput").attr("class","pdbIdInput"))));$(document).on("submit","#pdbIdForm",function(c){c.preventDefault();var d=$("#pdbIdInput").val();return collapsePanel(),b(a,d),!1}),c.append(d);var e=$("<div/>").attr("class","controlButton").attr("id","loadControlsButton").append($("<div/>").attr("class","controlMargin").attr("id","loadControlsBtnMargin").append($("<div/>").attr("class","controlItem").attr("id","loadControlsShow").text("Load structure...")));c.append(e)}function draw_selection_console(a){var b=$("body"),c=$("<div/>").attr("id","selectionWindow").append($("<form/>").attr("id","selectionForm").append($("<div/>").attr("class","controlItem").attr("id","atomSel").append($("<span/>").text("Select atoms:"),$("<input/>").attr("type","text").attr("id","selectionInput").attr("class","selectionInput"))));$(document).on("submit","#selectionForm",function(b){b.preventDefault();var c=$("#selectionInput").val();return collapsePanel(),a.select_atoms(c),!1}),b.append(c);var d=$("<div/>").attr("class","controlButton").attr("id","selectionControlsButton").append($("<div/>").attr("class","controlMargin").attr("id","selectionControlsBtnMargin").append($("<div/>").attr("class","controlItem").attr("id","selectionControlsShow").text("Select atoms...")));b.append(d),$("#selectionControlsButton").click(expandSelection)}function draw_feature_list(a){var b=$("body"),c=$("<div/>").attr("class","controlBox").attr("id","featureBox").append($("<div/>").attr("id","featuresBoxInner").append($("<div/>").attr("class","controlMargin").append($("<div/>").attr("class","controlHeader").attr("id","featureHandle").text("Important features"))));b.append(c)}function expandPanel(){$("#loadControls").fadeIn("fast"),$("#loadControlsButton").click(collapsePanel),$("#loadControlsShow").text("Hide controls")}function collapsePanel(){$("#loadControls").fadeOut("fast"),$("#loadControlsButton").unbind("click"),$("#loadControlsButton").click(expandPanel),$("#loadControlsShow").text("Load structure...")}function expandSelection(){$("#selectionWindow").slideDown("fast"),$("#selectionControlsButton").unbind("click"),$("#selectionControlsButton").click(collapseSelection),$("#selectronControlsShow").text("Hide selection window")}function collapseSelection(){$("#selectionWindow").slideUp("fast"),$("#selectionControlsButton").unbind("click"),$("#selectionControlsButton").click(expandSelection),$("#selectronControlsShow").text("Select atoms...")}function expandFeatures(){$("#featureList").slideDown("fast"),$("#featureHandle").click(collapseFeatures)}function collapseFeatures(){$("#featureList").slideUp("fast")}function init_gui(){$(document).ready(function(){$("#loadControlsButton").click(expandPanel),$("#selectionControlsButton").click(expandSelection);var a=$("#featureHandle");a&&($("#featureHandle").click(expandFeatures),$("#featureHandle").hoverIntent({over:expandFeatures,timeout:10,out:function(){return!0}}),$("#featureList").hoverIntent({over:function(){return!0},timeout:10,out:collapseFeatures}))})}function display_features_gui(a,b){$("#featureList").empty(),console.log("Adding "+b.length+" features"),expandFeatures();for(var c=0;c<b.length;c++){var d=$("<div/>",{id:"feature"+c,"class":"featureItem"}).text(b[c][0]),e=$("<div/>",{id:"featuresMargin","class":"controlMargin"}).text("");e.append(d),e.appendTo("#featureList"),d.data("Data",{label:b[c][0],xyz:b[c][1]}),d.click(function(){var b=$(this).data("Data");a.zoomXYZ(b.xyz)})}list_height=0,list_height=$("#featuresBoxInner").height(),console.log("height: "+list_height)}function getQuery(a,b){b||(b=window.location.search.substring(1));var c=b.split("&");have_query=!1;for(var d=0;d<c.length;d++){var e=c[d].split("=");"model"==e[0]?(a.load_mmcif("data/"+e[1]+".cif",e[1]),have_query=!0):"cif"==e[0]?(a.load_cif("data/"+e[1]+".cif",e[1]),have_query=!0):"monlib"==e[0]?(a.load_mon_lib("data/"+e[1]+".cif",e[1]),have_query=!0):"pdb"==e[0]?(a.load_pdb("data/"+e[1]+".pdb",e[1]),have_query=!0):"map"==e[0]?(a.load_ccp4_map("data/"+e[1],e[1],0),have_query=!0):"omap"==e[0]&&(a.load_dsn6_map("data/"+e[1],e[1],0),have_query=!0)}return have_query&&a.animate(),have_query}function requestFromServer(a){collapsePanel(),a.reset();var b=$("#pdbIdInput").val();a.requestPDB(b)}function loadPDBFromForm(a,b){validate_pdb_id(b),a.fetchPDB(b)}function loadEDSFromForm(a,b){a.reset(),a.load_eds_maps(b)}function getEDSQuery(a,b){b||(b=window.location.search.substring(1));var c=b.split("&");have_query=!1;for(var d=0;d<c.length;d++){var e=c[d].split("=");if("pdb"==e[0])return a.load_eds_maps(e[1]),!0}return!1}function Exi(a){var b=this;if(this.headerCssClass="titlePanel",this.mainMenu=new MainMenu,this.anonymousMenu=null,this.userMenu=null,this.keepTabs=!1,this.controllers=[new ExiController,new ProposalExiController,new ShippingExiController],null!=a&&(null!=a.menu&&(this.mainMenu=a.menu,
this.userMenu=a.menu),null!=a.anonymousMenu&&(this.anonymousMenu=a.anonymousMenu),null!=a.headerCssClass&&(this.headerCssClass=a.headerCssClass),null!=a.controllers))for(var c=0;c<a.controllers.length;c++)this.controllers.push(a.controllers[c]);this.mainStatusBar=new MainStatusBar,this.proposalManager=new ProposalManager,this.credentialManager=new CredentialManager,this.credentialManager.onLogout.attach(function(a){b.mainMenu.populateCredentialsMenu(),b.clearMainPanel(),b.clearNavigationPanel(),b.setAnonymousMenu(),Ext.getCmp("navigation").collapse(),location.hash="/welcome"}),this.credentialManager.onLogin.attach(function(a){b.mainMenu.populateCredentialsMenu(),b.setUserMenu()}),this.credentialManager.onActiveProposalChanged.attach(function(a){b.mainMenu.populateCredentialsMenu()}),this.authenticationForm=new AuthenticationForm,this.authenticationForm.onAuthenticate.attach(function(a,c){var d=new AuthenticationManager;d.onSuccess.attach(function(a,d){b.credentialManager.addCredential(d.user,d.roles,d.token,c.site,c.exiUrl,c.properties),b.authenticationForm.window.close();var e=EXI.credentialManager.getCredentialByUserName(d.user);e.isManager()||e.isLocalContact()?location.hash="/welcome/manager/"+d.user+"/main":location.hash="/welcome/user/"+d.user+"/main",b.getDataAdapter().exi.offline.authenticate()}),d.onError.attach(function(a,b){alert("error")}),d.login(c.user,c.password,c.site)}),this.onAfterRender=new Event(this)}function MainStatusBar(){}function ProposalManager(){this.onActiveProposalChanged=new Event(this)}function ExiGenericController(){this.init()}function MainView(a){this.id=BUI.id(),this.title="New Tab",this.closable=!0,this.onSelectionChange=new Event(this),this.onSelect=new Event(this),this.onDeselect=new Event(this),null!=a&&null!=a.title&&(this.title=a.title)}function AuthenticationManager(){this.onSuccess=new Event(this),this.onError=new Event(this)}function ExiController(){this.init()}function ExiGenericController(){this.init()}function LabContactExiController(){this.init()}function OfflineExiController(){this.init()}function ProposalExiController(){this.init()}function SessionController(){this.init()}function ShippingExiController(){this.init()}function BootstrapGrid(a){this.id=BUI.id(),this.data={},this.width=300,this.height=300,this.template="",a&&(a.width&&(this.width=a.width),a.height&&(this.height=a.height),a.template&&(this.template=a.template)),this.data.id=this.id,this.rowSelected=new Event(this)}function MainMenu(a){this.id=BUI.id(),this.loginButtonId="loginButton"+this.id,this.cssClass="mainMenu",this.isHidden=!0,null!=a&&(null!=a.cssClass&&(this.cssClass=a.cssClass),null!=a.isHidden&&(this.isHidden=a.isHidden))}function ListView(){this.width=250,this.height=Ext.getBody().getHeight()-215,this.onSelect=new Event}function AddressListView(){this.title="Addresses",this.sorters=[{property:"cardName",direction:"ASC"}],ListView.call(this)}function RunListView(){this.sorters=[],ListView.call(this)}function SessionListView(){this.sorters=[{property:"sessionId",direction:"DESC"}],ListView.call(this)}function ShippingListView(){this.sorters=[{property:"sessionId",direction:"DESC"}],ListView.call(this)}function WorkSpaceListView(){this.width=250,this.height=800,this.selectionMenu=new SelectionMenu,this.onSelect=new Event,this.projectId=null}function Credential(a,b,c,d,e,f,g,h){this.username=a.toLowerCase(),this.roles=b,this.url=d,this.exiUrl=e,this.token=c,this.activeProposals=f,this.tokenExpires=g,this.properties=h}function CredentialManager(){this.onLogin=new Event(this),this.onLogout=new Event(this),this.onActiveProposalChanged=new Event(this)}function MainView(a){this.id=BUI.id(),this.title="New Tab",this.closable=!0,this.onSelectionChange=new Event(this),this.onSelect=new Event(this),this.onDeselect=new Event(this),null!=a&&null!=a.title&&(this.title=a.title)}function AddressMainView(){this.icon="../images/icon/contacts.png",this.queueGridList=[],MainView.call(this),this.addressForm=new AddressForm,this.onSelect=new Event(this),this.onDeselect=new Event(this)}function ManagerWelcomeMainView(){this.icon="../images/icon/rsz_ic_home_black_24dp.png",MainView.call(this),this.title="Home",this.closable=!1,this.sessionGrid=new SessionGrid({width:null,height:600,isHiddenTitle:!0,isHiddenPI:!1,isHiddenNumberOfShifts:!1,isHiddenLocalContact:!1,margin:"10 10 10 10"}),this.proposalGrid=new ProposalGrid({width:900,height:600,margin:"10 10 10 10"})}function RunMainView(){this.id=BUI.id(),MainView.call(this)}function DimpleRunMainView(){this.title="Experiment",this.icon="images/icon/ic_satellite_black_18dp.png",this.queueGridList=[],this.id=BUI.id(),RunMainView.call(this)}function SessionMainView(a){this.icon="images/icon/ic_satellite_black_18dp.png",MainView.call(this,a);this.sessionGrid=new SessionGrid({width:700,height:598,margin:"0 0 0 20",title:"Click on calendar to see the sessions"})}function CaseForm(a){this.id=BUI.id(),this.width=600,this.showTitle=!0,null!=a&&null!=a.showTitle&&(this.showTitle=a.showTitle),this.onSaved=new Event(this)}function ContainerSpreadSheet(a){this.id=BUI.id(),this.height=380,this.width=500,null!=a&&(null!=a.height&&(this.height=a.height),null!=a.width&&(this.width=a.width)),this.onModified=new Event(this)}function ParcelGrid(a){this.height=100,this.width=100,this.btnEditVisible=!0,this.btnRemoveVisible=!0,null!=a&&(null!=a.height&&(this.height=a.height),null!=a.width&&(this.width=a.width),null!=a.btnEditVisible&&(this.btnEditVisible=a.btnEditVisible),null!=a.btnRemoveVisible&&(this.btnRemoveVisible=a.btnRemoveVisible)),this.onSuccess=new Event(this),this.onAdd=new Event(this),this.onRemove=new Event(this)}function PuckForm(a){this.id=BUI.id(),this.height=500,this.width=500,null!=a&&(null!=a.height&&(this.height=a.height),null!=a.width&&(this.width=a.width));this.containerSpreadSheet=new ContainerSpreadSheet({width:1300}),this.onRemoved=new Event(this),this.onSaved=new Event(this)}function ShipmentForm(a){this.id=BUI.id(),this.width=600,null!=a&&(null!=a.creationMode&&(this.creationMode=a.creationMode),null!=a.width&&(this.width=a.width)),this.onSaved=new Event(this)}function ShippingMainView(){MainView.call(this);this.shipmentForm=new ShipmentForm({width:Ext.getBody().getWidth()-200}),this.shipmentForm.onSaved.attach(function(a,b){location.hash="#/proposal/shipping/nav?nomain"}),this.parcelGrid=new ParcelGrid({height:580,width:Ext.getBody().getWidth()-200})}function ShippingMainViewTest(){MainView.call(this);this.shipmentForm=new ShipmentForm({width:Ext.getBody().getWidth()-200}),this.shipmentForm.onSaved.attach(function(a,b){location.hash="#/proposal/shipping/nav?nomain"}),this.parcelGrid=new ParcelGrid({height:580,width:Ext.getBody().getWidth()-200})}function WelcomeMainView(){this.icon="../images/icon/rsz_ic_home_black_24dp.png",MainView.call(this),this.title="Welcome",this.closable=!0}function AuthenticationForm(){this.singleSite=!1,this.siteURL=null,this.icon=null,this.onAuthenticate=new Event(this)}function CurvePlotter(a){this.id=BUI.id(),this.backgroundColor="#FFFFFF",this.margin="0 0 0 5",this.ruleColor="black",this.targetId="plotCanvas"+BUI.id(),this.legend="onmouseover",null!=a&&(null!=a.margin&&(this.margin=a.margin),null!=a.legend&&(this.legend=a.legend),null!=a.targetId&&(this.targetId=a.targetId)),this.onRendered=new Event(this),this.onPointClickCallback=new Event}function AutoProcIntegrationCurvePlotter(a){CurvePlotter.call(this,a),this.margin="10 0 0 0",this.height=null,this.title="",null!=a&&(null!=a.height&&(this.height=a.height),null!=a.title&&(this.title=a.title)),this.data={labels:[],data:[]},this.xLabels=[]}function ParcelPanel(a){this.id=BUI.id(),this.height=500,this.width=500,this.pucksPanelHeight=200,this.isSaveButtonHidden=!1,this.isHidden=!1,null!=a&&(null!=a.height&&(this.height=a.height),null!=a.width&&(this.width=a.width)),this.onSavedClick=new Event(this)}function ProposalGrid(a){this.height=500,this.tbar=!1,this.id=BUI.id(),this.margin="0 0 0 0",null!=a&&(null!=a.height&&(this.height=a.height),null!=a.searchBar&&(this.searchBar=a.searchBar),null!=a.tbar&&(this.tbar=a.tbar),null!=a.collapsed&&(this.collapsed=a.collapsed),null!=a.width&&(this.width=a.width),null!=a.margin&&(this.margin=a.margin)),this.onSelected=new Event(this)}function PuckParcelPanel(a){this.height=220,this.containerId=0,this.code="",this.data={puckType:"Unipuck",mainRadius:.3*this.height,xMargin:this.width/2-.3*this.height,yMargin:2.5,enableMouseOver:!0},this.width=2*this.data.mainRadius+20,null!=a&&(null!=a.height&&(this.height=a.height,this.data.mainRadius=.3*this.height,this.width=2*this.data.mainRadius+20,this.data.xMargin=this.width/2-this.data.mainRadius),null!=a.width&&(this.width=a.width),null!=a.containerId&&(this.containerId=a.containerId),null!=a.code&&(this.code=a.code),null!=a.capacity&&16!=a.capacity&&(this.data.puckType="Spinepuck")),this.onPuckRemoved=new Event(this),this.onPuckSaved=new Event(this)}function SessionGrid(a){this.height=500,this.tbar=!1,this.id=BUI.id(),this.width=null,this.title=null,this.margin=10,this.hiddenGoColumn=!0,this.isHiddenTitle=!0,this.isHiddenNumberOfShifts=!0,this.isHiddenPI=!0,this.isHiddenLocalContact=!0,this.layout="fit",this.beamlineFilter=[],null!=a&&(null!=a.isHiddenLocalContact&&(this.isHiddenLocalContact=a.isHiddenLocalContact),null!=a.isHiddenNumberOfShifts&&(this.isHiddenNumberOfShifts=a.isHiddenNumberOfShifts),null!=a.width&&(this.width=a.width),null!=a.isHiddenTitle&&(this.isHiddenTitle=a.isHiddenTitle),null!=a.isHiddenPI&&(this.isHiddenPI=a.isHiddenPI),null!=a.title&&(this.title=a.title),null!=a.margin&&(this.margin=a.margin),null!=a.height&&(this.height=a.height),null!=a.tbar&&(this.tbar=a.tbar),null!=a.width&&(this.width=a.width,this.layout=null),null!=a.hiddenGoColumn&&(this.hiddenGoColumn=a.hiddenGoColumn)),this.onSelected=new Event(this)}function SAXSExiController(){this.init()}function ExiSAXS(){Exi.call(this,{menu:new SAXSMainMenu,anonymousMenu:new MainMenu,controllers:[new SAXSExiController,new OfflineExiController,new ProposalExiController,new SessionController,new LabContactExiController]})}function SAXSMainMenu(){this.id=BUI.id(),MainMenu.call(this,{isHidden:!1,cssClass:"mainMenu"})}function BufferListView(){ListView.call(this)}function DataCollectionListView(){ListView.call(this)}function MacromoleculeListView(){this.sorters=[{property:"experimentId",direction:"DESC"}],ListView.call(this)}function SessionSaxsListView(){this.sorters=[{property:"experimentId",direction:"DESC"}],ListView.call(this)}function StockSolutionListView(){this.sorters=[{property:"experimentId",direction:"DESC"}],ListView.call(this)}function TemplateListView(){this.sorters=[{property:"experimentId",direction:"DESC"}],ListView.call(this)}function BufferMainView(){this.icon="images/icon/ic_satellite_black_18dp.png",this.queueGridList=[],MainView.call(this),this.bufferForm=new BufferForm({height:800,collapsed:!1,tbar:!0});this.onSelect=new Event(this),this.onDeselect=new Event(this)}function BufferWelcomeMainView(){this.icon="../images/icon/rsz_ic_home_black_24dp.png",MainView.call(this),this.title="Macromolecules",this.closable=!1}function DataCollectionMainView(){this.title="Experiment",this.icon="images/icon/ic_satellite_black_18dp.png",MainView.call(this),this.grid=new QueueGrid({positionColumnsHidden:!0,maxHeight:Ext.getCmp("main_panel").getHeight()-50,sorters:[{property:"macromoleculeAcronym",direction:"ASC"}]}),this.onSelect=new Event(this),this.onDeselect=new Event(this)}function DesignerMainView(){this.icon="images/icon/ic_satellite_black_18dp.png",this.queueGridList=[],MainView.call(this);this.wizardWidget=new WizardWidget({windowMode:!0,width:1200}),this.wizardWidget.onFinished.attach(function(a,b){EXI.setLoading();var c=function(a,b){location.hash="/experiment/templateId/"+b.experimentId+"/main"};EXI.getDataAdapter({onSuccess:c}).saxs.template.saveTemplate(b.name,b.comments,b.data)}),this.onSelect=new Event(this),this.onDeselect=new Event(this)}function ExperimentDesignerMainView(){this.icon="images/icon/ic_satellite_black_18dp.png",this.queueGridList=[],MainView.call(this),this.templateGrid=new TemplateGrid({minHeight:300,height:440,gridType:"Ext.grid.Panel",title:"Experiments",grouping:!1,tbar:!0}),this.onSelect=new Event(this),this.onDeselect=new Event(this)}function ExperimentMainView(){this.icon="images/icon/ic_satellite_black_18dp.png",MainView.call(this),this.experimentHeaderForm=new ExperimentHeaderForm;var a=this,b=Ext.create("Ext.data.Store",{fields:["name"],data:[{name:"low"},{name:"medium"},{name:"high"}]}),c=Ext.create("Ext.form.ComboBox",{fieldLabel:"",store:b,queryMode:"local",displayField:"name",valueField:"name"});this.specimenWidget=new SpecimenWidget({height:this.height,width:1200}),this.measurementGrid=new MeasurementGrid({height:600,minHeight:600,maxHeight:600,estimateTime:!1,positionColumnsHidden:!1,isPriorityColumnHidden:!0,isStatusColumnHidden:!1,addBtnEnable:!1,isTimeColumnHidden:!1,updateRowEnabled:!1,collapsed:!1,removeBtnEnabled:!1,showTitle:!1,collapseBtnEnable:!1,addBtnMultipleEdit:!1,sortingBtnEnable:!1,editor:{exposureTemperature:{xtype:"textfield",allowBlank:!0},comments:{xtype:"textfield",allowBlank:!0},volumeToLoad:{xtype:"numberfield",allowBlank:!0},transmission:{xtype:"numberfield",allowBlank:!0},viscosity:c,waitTime:{xtype:"numberfield",allowBlank:!0},flow:{xtype:"checkbox",allowBlank:!0}}}),this.measurementGrid.onMeasurementChanged.attach(function(b,c){a.experiment.setMeasurement(c),a.measurementGrid.loadExperiment(a.experiment),a.volumePlanificator.load(a.experiment)}),this.measurementGrid.onExperimentChanged.attach(function(b,c){a.experiment=new Experiment(c),a.measurementGrid.loadExperiment(a.experiment),a.specimenWidget.refresh(a.experiment),a.volumePlanificator.load(a.experiment)}),this.measurementGrid.onRemoved.attach(function(b,c){a.experiment=new Experiment(c[0]),a.specimenWidget.refresh(a.experiment),a.volumePlanificator.load(a.experiment)}),this.queueGrid=new QueueGrid({positionColumnsHidden:!0,sorters:[{property:"macromoleculeAcronym",direction:"ASC"}]})}function ExperimentWelcomeMainView(){this.icon="../images/icon/rsz_ic_home_black_24dp.png",MainView.call(this),this.title="Welcome",this.closable=!1}function HPLCMainView(){this.title="Experiment",this.icon="images/icon/ic_satellite_black_18dp.png",this.queueGridList=[],MainView.call(this),this.grid=new QueueGrid({collapsed:!0,positionColumnsHidden:!0,maxHeight:Ext.getCmp("main_panel").getHeight()-50,sorters:[{property:"macromoleculeAcronym",direction:"ASC"}]}),this.grid.onSelectionChange.attach(function(b,c){a.onSelectionChange.notify(c)}),this.grid.onSelect.attach(function(b,c){a.onSelect.notify(c)}),this.grid.onDeselect.attach(function(b,c){a.onDeselect.notify(c)});var a=this;a.annotations=[],a.selectedFrameNumber=[],this.hplcGraph=new HPLCGraph({title:"I0",width:800,height:350,bbar:!0,plots:{I0:!0,Rg:!0},xlabel:"HPLC Frames",scaled:!0,interactionModel:{dblclick:function(b,c,d){a.selectedFrameNumber.push(c.lastx_),a.plotter.loadHPLCFrame(a.experimentId,a.selectedFrameNumber),a.annotations.push({series:c.selPoints_[0].name,x:c.lastx_,width:30,height:23,tickHeight:2,shortText:c.lastx_,text:c.lastx_,attachAtBottom:!0}),c.setAnnotations(a.annotations)}}}),this.hplcGraph.onClearSelection.attach(function(b){a.annotations=[],a.selectedFrameNumber=[],a.hplcGraph.dygraphObject.dygraph.setAnnotations([])}),this.plotter=new CurvePlotter({margin:"10 0 0 0"}),this.onSelect=new Event(this),this.onDeselect=new Event(this)}function MacromoleculeMainView(){this.icon="../images/icon/macromolecule.png",this.queueGridList=[],MainView.call(this),this.macromoleculeForm=new MacromoleculeForm({height:800,collapsed:!1,tbar:!0}),this.rigidBodyModelingForm=new RigidBodyModelingForm({}),this.rigidBodyModelingForm.onSave.attach(function(a,b){});this.onSelect=new Event(this),this.onDeselect=new Event(this)}function MacromoleculeWelcomeMainView(){this.icon="../images/icon/rsz_ic_home_black_24dp.png",MainView.call(this),this.title="Macromolecules",this.closable=!1}function MergeMainView(){this.title="Primary Data View",this.icon="images/icon/ic_blur_on_black_18dp.png",this.queueGridList=[];var a=this;this.plotter=new CurvePlotter({}),this.formPopulated=!1,this.plotter.onRendered.attach(function(b){if(!a.formPopulated){for(var c={},d=1;d<b.getLabels().length;d++)c[b.getLabels()[d]]=b.getColors()[d-1];a.populateForm(b.getPointCount(),c),a.formPopulated=!0}plotter=b})}function PrimaryDataMainView(){this.title="Primary Data View",this.icon="images/icon/ic_blur_on_black_18dp.png",MainView.call(this),this.onMeasurementSelectionChange=new Event(this);var a=this;this.frameSelectorGrid=new FrameSelectorGrid,this.frameSelectorGrid.onSelectionChange.attach(function(b,c){a.plotter.load(c)}),this.plotter=new CurvePlotter({}),this.grid=new QueueGrid({maxHeight:300}),this.abinitioForm=new AbinitioForm({height:700})}function ShippingMainView(){MainView.call(this);var a=this;this.shipmentForm=new ShipmentForm,this.shipmentForm.onSaved.attach(function(a,b){location.hash="#/proposal/shipping/nav?nomain"}),this.caseGrid=new CaseGrid({height:300}),this.caseGrid.onRemove.attach(function(b,c){var d=function(b){a.load(a.shippingId),a.panel.setLoading(!1)};EXI.getDataAdapter({onSuccess:d}).proposal.dewar.removeDewar(a.shippingId,c.dewarId)})}function ShippingWelcomeMainView(){this.icon="../images/icon/rsz_ic_home_black_24dp.png",MainView.call(this),this.title="Welcome",this.closable=!1}function StockSolutionMainView(){this.icon="images/icon/ic_satellite_black_18dp.png",this.queueGridList=[],MainView.call(this),this.stockSolutionForm=new StockSolutionForm({minHeight:800,height:800,tbar:!0,showTitle:!0,isPackedVisible:!1,btnAddExisting:!1,btnRemoveVisible:!1,btnUnpackVisible:!1});var a=this;this.stockSolutionForm.onSaved.attach(function(b,c){var d=function(b,c){a.stockSolutionForm.load(EXI.proposalManager.getStockSolutionById(a.stockSolutionId)),a.panel.setLoading(!1)};a.panel.setLoading("Updading proposal information"),EXI.getDataAdapter({onSuccess:d}).proposal.proposal.update()}),this.onSelect=new Event(this),this.onDeselect=new Event(this)}function StockSolutionWelcomeMainView(){this.icon="../images/icon/rsz_ic_home_black_24dp.png",MainView.call(this),this.title="Macromolecules",this.closable=!1}function TemplateMainView(){this.icon="images/icon/ic_satellite_black_18dp.png",this.queueGridList=[],MainView.call(this),this.experimentHeaderForm=new ExperimentHeaderForm;var a=this,b=Ext.create("Ext.data.Store",{fields:["name"],data:[{name:"low"},{name:"medium"},{name:"high"}]}),c=Ext.create("Ext.form.ComboBox",{fieldLabel:"",store:b,queryMode:"local",displayField:"name",valueField:"name"});this.specimenWidget=new SpecimenWidget({height:this.height,width:1200}),this.measurementGrid=new MeasurementGrid({height:600,minHeight:600,maxHeight:600,estimateTime:!1,positionColumnsHidden:!0,isPriorityColumnHidden:!0,isStatusColumnHidden:!0,addBtnEnable:!0,isTimeColumnHidden:!0,updateRowEnabled:!0,collapsed:!0,removeBtnEnabled:!0,showTitle:!1,collapseBtnEnable:!1,addBtnMultipleEdit:!0,sortingBtnEnable:!0,editor:{exposureTemperature:{xtype:"textfield",allowBlank:!0},comments:{xtype:"textfield",allowBlank:!0},volumeToLoad:{xtype:"numberfield",allowBlank:!0},transmission:{xtype:"numberfield",allowBlank:!0},viscosity:c,waitTime:{xtype:"numberfield",allowBlank:!0},flow:{xtype:"checkbox",allowBlank:!0}}}),this.measurementGrid.onMeasurementChanged.attach(function(b,c){a.experiment.setMeasurement(c),a.measurementGrid.loadExperiment(a.experiment),a.volumePlanificator.load(a.experiment)}),this.measurementGrid.onExperimentChanged.attach(function(b,c){a.experiment=new Experiment(c),a.measurementGrid.loadExperiment(a.experiment),a.specimenWidget.refresh(a.experiment),a.volumePlanificator.load(a.experiment)}),this.measurementGrid.onRemoved.attach(function(b,c){a.experiment=new Experiment(c[0]),a.specimenWidget.refresh(a.experiment),a.volumePlanificator.load(a.experiment)}),this.volumePlanificator=new VolumeGrid}function AbinitioForm(a){this.id=BUI.id(),this.width=null,this.height=null,null!=a&&(null!=a.width&&(this.width=a.width),null!=a.height&&(this.height=a.height));var b=this;this.abinitioGrid=new AbinitioGrid({width:700,height:600}),this.abinitioGrid.onSelected.attach(function(a,c){var d=[];for(var e in c)d.push(c[e].modelId);b.curvePlotter.loadUrl(EXI.getDataAdapter().saxs.frame.getFramesURL([],[],[],[],[],d)),b._renderPDB(d)}),this.curvePlotter=new CurvePlotter({}),this.viewer=new PDBViewer({width:500,height:300})}function AbinitioGrid(a){this.height=null,this.width=null,this.id=BUI.id(),null!=a&&null!=a.height&&(this.height=a.height,null!=a.width&&(this.width=a.width)),this.onSelected=new Event(this)}function AddressForm(a){this.id=BUI.id(),this.height=500,this.width=500,this.isSaveButtonHidden=!1,this.isHidden=!1,null!=a&&(null!=a.height&&(this.height=a.height),null!=a.width&&(this.width=a.width),null!=a.isSaveButtonHidden&&(this.isSaveButtonHidden=a.isSaveButtonHidden),null!=a.isHidden&&(this.isHidden=a.isHidden))}function AprioriRigidBodyGrid(a){this.height=250,this.btnEditVisible=!0,this.btnRemoveVisible=!0,null!=a&&(null!=a.height&&(this.height=a.height),null!=a.btnEditVisible&&(this.btnEditVisible=a.btnEditVisible),null!=a.btnRemoveVisible&&(this.btnRemoveVisible=a.btnRemoveVisible)),this.onUploadFile=new Event(this),this.onRemove=new Event(this)}function AssemblyForm(a){this.id=BUI.id(),this.width=700,this.height=500,null!=a&&(null!=a.width&&(this.width=a.width),null!=a.height&&(this.height=a.height)),this.molarityGrid=new MolarityGrid({height:this.height-50})}function BufferForm(a){this.id=BUI.id(),this.height=500,this.width=500,null!=a&&(null!=a.height&&(this.height=a.height),null!=a.width&&(this.width=a.width)),this.onRemoveAdditive=new Event(this)}function BufferGrid(a){this.height=500,this.searchBar=!1,this.tbar=!1,this.collapsed=!1,this.id=BUI.id(),this.collapsible=!1,null!=a&&(null!=a.height&&(this.height=a.height),null!=a.searchBar&&(this.searchBar=a.searchBar),null!=a.tbar&&(this.tbar=a.tbar),null!=a.collapsed&&(this.collapsed=a.collapsed),null!=a.width&&(this.width=a.width)),this.onUpdated=new Event(this)}function CaseGrid(a){this.height=100,this.btnEditVisible=!0,this.btnRemoveVisible=!0,null!=a&&(null!=a.height&&(this.height=a.height),null!=a.btnEditVisible&&(this.btnEditVisible=a.btnEditVisible),null!=a.btnRemoveVisible&&(this.btnRemoveVisible=a.btnRemoveVisible)),this.onSuccess=new Event(this),this.onAdd=new Event(this),this.onRemove=new Event(this)}function DataReductionForm(a){this.id=BUI.id(),this.width=null,this.height=null,null!=a&&(null!=a.width&&(this.width=a.width),null!=a.height&&(this.height=a.height));this.plotWidget=new PlotWidget({width:650,height:490}),this.selectedItems={frames:[],averages:[],subtractions:[]}}function ExperimentGrid(a){this.width="100%",this.height=700,this.minHeight=500,this.id=BUI.id(),this.gridType="Ext.grid.Panel",this.tbar=!1,this.hideHeaders=!1,this.grouping=!0,this.title=null,this.filtered=null,this.limit=100,this.sessionIdFilter=null,this.date=null,this.sorters=[{property:"date",direction:"DESC"},{property:"time",direction:"DESC"}],this.dates={},null!=a&&(null!=a.height&&(this.height=a.height),null!=a.limit&&(this.limit=a.limit),null!=a.sorters&&(this.sorters=a.sorters),null!=a.sessionId&&(this.sessionIdFilter=a.sessionId),null!=a.filtered&&(this.filtered=a.filtered),null!=a.minHeight&&(this.minHeight=a.minHeight),null!=a.gridType&&(this.gridType=a.gridType),null!=a.tbar&&(this.tbar=a.tbar),null!=a.grouping&&(this.grouping=a.grouping),null!=a.width&&(this.width=a.width),null!=a.title&&(this.title=a.title)),this.onEditButtonClicked=new Event(this)}function ExperimentHeaderForm(a){this.id=BUI.id(),this.backgroundColor="#FFFFFF"}function FrameSelectorGrid(a){this.onSelectionChange=new Event(this)}function GenericStepWizardForm(a,b,c,d,e){this.id=BUI.id(),this.title=a,this.description=b,this.data=c,this.onNext=d,this.onBack=e}function HPLCGraph(a){this.width=600,this.height=600,this.title="",this.bbar=!1,this.plotInnerPanelPadding=10,this.plotPanelPadding=10,this.id=BUI.id(),this.hidePlots=null,this.xlabel="",this.scaled=!1,this.xParam=null,this.showRangeSelector=!0,this.interactionModel=null,this.ranges={},null!=a&&(null!=a.interactionModel&&(this.interactionModel=a.interactionModel),null!=a.width&&(this.width=a.width),null!=a.height&&(this.height=a.height),null!=a.bbar&&(this.bbar=a.bbar),null!=a.title&&(this.title=a.title),null!=a.plots&&(this.plots=a.plots),null!=a.scaled&&(this.scaled=a.scaled),null!=a.xlabel&&(this.xlabel=a.xlabel),null!=a.xParam&&(this.xParam=a.xParam),null!=a.showRangeSelector&&(this.showRangeSelector=a.showRangeSelector)),this.onZoomX=new Event(this),this.onResetZoom=new Event(this),this.dblclick=new Event(this),this.onClearSelection=new Event(this)}function MergesHPLCGraph(a){HPLCGraph.prototype.constructor.call(this,a),this.peakColors=["#DEBD00","#6D9100","#872900","#0092CC"]}function MacromoleculeForm(a){this.id=BUI.id(),this.width=700,this.height=700,null!=a&&(null!=a.width&&(this.width=a.width),null!=a.height&&(this.height=a.height)),this.onSave=new Event(this),this.onClose=new Event(this)}function MacromoleculeGrid(a){this.height=500,this.width=500,this.id=BUI.id(),this.maxHeight=this.height,this.searchBar=!1,this.tbar=!1,this.collapsible=!0,this.collapsed=!0,this.btnEditVisible=!0,this.btnRemoveVisible=!1,this.multiselect=!1,this.cssFontStyle=null,null!=a&&(null!=a.height&&(this.height=a.height,this.maxHeight=this.height),null!=a.maxHeight&&(this.maxHeight=a.maxHeight),null!=a.width&&(this.width=a.width),null!=a.cssFontStyle&&(this.cssFontStyle=a.cssFontStyle),null!=a.searchBar&&(this.searchBar=a.searchBar),null!=a.tbar&&(this.tbar=a.tbar),null!=a.collapsible&&(this.collapsible=a.collapsible),null!=a.collapsed&&(this.collapsed=a.collapsed),null!=a.btnEditVisible&&(this.btnEditVisible=a.btnEditVisible),null!=a.btnRemoveVisible&&(this.btnRemoveVisible=a.btnRemoveVisible),null!=a.multiselect&&(this.multiselect=a.multiselect)),this.onSelected=new Event,this.onMacromoleculesChanged=new Event}function MeasurementCreatorStepWizardForm(a,b,c){var d=this;this.height=700,this.noNext=!1,this.macromolecules=a,this.buffers=b,GenericStepWizardForm.call(this,"Define Measurements",{margin:"0 0 0 0",width:800,border:0,html:"Define only the macromolecule's measurement you want to make. This wizard will add <span style='font-weight:bold;'> buffers' measurement needed for substraction automatically. </span>"},{measurementsSelected:null},function(){var a={name:Ext.getCmp(d.id+"name").getValue(),comments:Ext.getCmp(d.id+"comments").getValue(),data:JSON.stringify(d.parseMeasurements(d.data.measurementsSelected))};d.onWizardFinished.notify(a)},function(){}),null!=c&&null!=c.noNext&&(this.noNext=c.noNext),this.noNext&&(this.onWizardFinished=new Event(this)),this.onWizardFinished=new Event(this)}function SampleAutomaticPositionFactory(a){this.samples=a}function MeasurementGrid(a){this.id=BUI.id(),this.height=500,this.width=900,this.maxWidth=1200,this.minHeight=500,this.unitsFontSize=9,this.title="Measurements",this.estimateTime=!1,this.collapsed=!0,this.tbar=!0,this.showTitle=!0,this.resizable=!0,this.updateRowEnabled=!0,this.isStatusColumnHidden=!0,this.isTimeColumnHidden=!0,this.removeBtnEnabled=!0,this.margin="10 10 0 10",this.height=250,this.maxHeight=250,this.collapsible=!1,this.addBtnEnable=!1,this.editor={comments:{xtype:"textfield",allowBlank:!0}},this.sorter=[{property:"priority",direction:"ASC"}],null!=a&&(null!=a.selModel&&(this.selModel=a.selModel),null!=a.removeBtnEnabled&&(this.removeBtnEnabled=a.removeBtnEnabled),null!=a.addBtnMultipleEdit&&(this.addBtnMultipleEdit=a.addBtnMultipleEdit),null!=a.collapsed&&(this.collapsed=a.collapsed),null!=a.resizable&&(this.resizable=a.resizable),null!=a.editor&&(this.editor=a.editor),null!=a.collapseBtnEnable&&(this.collapseBtnEnable=a.collapseBtnEnable),null!=a.addBtnEnable&&(this.addBtnEnable=a.addBtnEnable),null!=a.sortingBtnEnable&&(this.sortingBtnEnable=a.sortingBtnEnable),null!=a.isPriorityColumnHidden&&(this.isPriorityColumnHidden=a.isPriorityColumnHidden),null!=a.width&&(this.width=a.width),null!=a.updateRowEnabled&&(this.updateRowEnabled=a.updateRowEnabled),null!=a.showTitle&&(this.showTitle=a.showTitle,0==this.showTitle&&(this.title=null)),null!=a.height&&(this.height=a.height),null!=a.maxHeight&&(this.maxHeight=a.maxHeight),null!=a.minHeight&&(this.minHeight=a.minHeight),null!=a.maxWidth&&(this.maxWidth=a.maxWidth),null!=a.isStatusColumnHidden&&(this.isStatusColumnHidden=a.isStatusColumnHidden),null!=a.isTimeColumnHidden&&(this.isTimeColumnHidden=a.isTimeColumnHidden),null!=a.title&&(this.title=a.title),null!=a.estimateTime&&(this.estimateTime=a.estimateTime),null!=a.margin&&(this.margin=a.margin),null!=a.tbar&&(this.tbar=a.tbar),null!=a.sorter&&(this.sorter=a.sorter)),this.onRemoved=new Event(this),this.onMeasurementChanged=new Event(this),this.onExperimentChanged=new Event(this)}function MolarityForm(a){this.id=BUI.id(),this.width=700,this.height=500,null!=a&&(null!=a.width&&(this.width=a.width),null!=a.height&&(this.height=a.height)),this.onSave=new Event(this),this.onClose=new Event(this)}function MolarityGrid(a){this.height=100,this.width=100,null!=a&&(null!=a.height&&(this.height=a.height),null!=a.width&&(this.width=a.width));var b=this;this.molarityForm=new MolarityForm({height:180,width:455}),this.molarityForm.onSave.attach(function(a){b.molarityWindow.destroy(),b.updateProposal()}),this.molarityForm.onClose.attach(function(a){b.molarityWindow.destroy()}),this.onEditButtonClicked=new Event(this)}function DataSet(){this.json=null}function GraphCanvas(a,b,c){this.args={},this.targetID=b.id,this.id=a,this.args.idGraph=this.id+"main",this.args.idBackgroundNode=this.id+"background",this.args.idEdgesGraph=this.id+"edges",this.args.idNodesGraph=this.id+"vertices",this.args.idLabelGraph=this.id+"label",this.args.idBackground=this.id+"background",this.dataset=null,this.formatter=null,this.layout=null,this.circleDefaultRadius=2,this.squareDefaultSide=1.5*this.circleDefaultRadius,this.arrowDefaultSize=this.circleDefaultRadius,this.GraphGroup=null,this.GraphNodeGroup=null,this.GraphLabelGroup=null,this.GraphBackground=null,this.args.draggingCanvasEnabled=!1,this.args.multipleSelectionEnabled=!1,this.args.interactive=!1,this.args.labeled=!1,this.args.linkEnabled=!1,this.args.maxNumberEdgesMoving=3,this.args.maxNumberEdgesFiringEvents=50,this.args.linking=!1,this.linkStartX=0,this.linkStartY=0,this.linkSVGNode=null,this.linkNodeSource=null,this.linkNodeTarget=null,this.draggingElement=null,this.dragging=!1,this.nMouseOffsetX=0,this.nMouseOffsetY=0,this.dragStartX=0,this.dragStartY=0,this.desplazamientoX=0,this.desplazamientoY=0,this.selecting=!1,this.selectorX=null,this.selectorY=null,this.selectorSVGNode=null,this.args.isVertexSelected={},this.args.selectedVertices=[],this.args.isEdgeSelected={},null!=c&&(null!=c.multipleSelectionEnabled&&(this.args.multipleSelectionEnabled=c.multipleSelectionEnabled,this.args.draggingCanvasEnabled=!this.args.multipleSelectionEnabled),null!=c.draggingCanvasEnabled&&(this.args.draggingCanvasEnabled=c.draggingCanvasEnabled,this.args.multipleSelectionEnabled=!this.args.draggingCanvasEnabled),null!=c.interactive&&(this.args.interactive=c.interactive),null!=c.labeled&&(this.args.labeled=c.labeled)),this.svgLabels={},this.onVertexOut=new Event(this),this.onVertexOver=new Event(this),this.onVertexSelect=new Event(this),this.onEdgeSelect=new Event(this),this.onCanvasClicked=new Event(this),this.onVertexUp=new Event(this)}function GraphDataset(){DataSet.prototype.constructor.call(this),this.edges=new Object,this.vertices=new Object,this.verticesIndex=new Object,this.newVertex=new Event(this),this.vertexNameChanged=new Event(this),this.vertexDeleted=new Event(this),this.newEdge=new Event(this),this.edgeNameChanged=new Event(this),this.edgeDeleted=new Event(this),this.json=new Object,this.json.vertices=new Array,this.json.edges=new Array,
this.json.relations=new Array}function labels(){var a=new Array,b=interactomeViewer.graphEditorWidget.dataset,c=interactomeViewer.graphEditorWidget.layout;for(var d in interactomeViewer.graphEditorWidget.dataset.getVertices())a.push(interactomeViewer.graphEditorWidget.dataset.getVertexById(d).getName());var e=a.sort();console.log(e);for(var f=.01,g=.6,h=0;h<a.length;h++){var i=b.getVertexByName(a[h]).getId();c.getNodeById(i).setCoordenates(f,g),f=parseFloat(f)+parseFloat(.03),g=parseFloat(g)+parseFloat(.02),.9800000000000003==parseFloat(g)&&(g=.6,f-=.51)}}function GraphItem(a,b,c){this.id=a,this.name=b,this.type="NONE",this.args=new Object,null!=c&&(this.args=c,null!=c.type&&(this.type=c.type)),this.nameChanged=new Event(this),this.deleted=new Event(this)}function ItemGraphFormatter(a,b,c,d,e){this.id=a,this.args=new Object,this.defaultFormat=new ItemFormat(b),null!=c?this.selected=new ItemFormat(c):this.selected=new ItemFormat(b),null!=d?this.over=new ItemFormat(d):this.over=new ItemFormat(b),null!=e?this.dragging=new ItemFormat(e):this.dragging=new ItemFormat(b),this.stateChanged=new Event(this);this._setEvents()}function ItemFormat(a){this.defaultFormat=new Object,this.args=new Object,this.args.title=new Object,this.args.visible=!0,this.args.hidden=!1,this.args.stroke="#000000",this.args.strokeOpacity=.8,this.args["stroke-width"]=1,this.args.fill="#000000",this.args["fill-opacity"]=1,this.args.size=1,this.args.opacity=1,this.args.fontSize="8",this.args.fontColor="#000000",this.args.display="block",this.args.style="display:block",null!=a&&(null!=a.visible&&(this.args.visible=a.visible),null!=a.opacity&&(this.args.opacity=a.opacity),null!=a.size&&(this.args.size=a.size),null!=a.hidden&&(this.args.hidden=a.hidden),null!=a.stroke&&(this.args.stroke=this._fixColor(a.stroke)),null!=a.strokeOpacity&&(this.args.strokeOpacity=a.strokeOpacity),null!=a["stroke-width"]&&(this.args["stroke-width"]=a["stroke-width"]),null!=a["fill-opacity"]&&(this.args["fill-opacity"]=a["fill-opacity"]),null!=a.shape&&(this.args.shape=a.shape),null!=a.fill&&(this.args.fill=this._fixColor(a.fill)),null!=a.title&&(null!=a.title.fontSize&&(this.args.title.fontSize=a.title.fontSize),null!=a.title.fill&&(this.args.title.fill=this._fixColor(a.title.fill)))),this.changed=new Event}function LayoutDataset(){this.dataset=null,this.vertices=new Object,this.changed=new Event(this),this.args=new Object,this.args.type="CIRCLE"}function NodeLayout(a,b,c,d){this.id=a,this.x=b,this.y=c,this.changed=new Event(this)}function NetworkDataSetFormatter(a,b,c){DataSet.prototype.constructor.call(this),this.args=new Object,this.vertices=new Object,this.edges=new Object,this.dataset=null,this.maxClass=0,this.minClass=0,this.args.width=1100,this.args.height=500,this.args.backgroundColor="#FFFFFF",this.args.backgroundImage=null,this.args.backgroundImageHeight=null,this.args.backgroundImageWidth=null,this.args.backgroundImageX=null,this.args.backgroundImageY=null,this.args.balanceNodes=!1,this.args.nodesMaxSize=3,this.args.nodesMinSize=.5,this.args.zoomScale=1,this.args.zoomScaleStepFactor=.4,null!=c&&(null!=c.backgroundImage&&(this.args.backgroundImage=c.backgroundImage),null!=c.width&&(this.args.width=c.width),null!=c.height&&(this.args.height=c.height,this.args.svgHeight=c.height),null!=c.svgHeight&&(this.args.svgHeight=c.svgHeight),null!=c.backgroundColor&&(this.args.backgroundColor=c.backgroundColor),null!=c.balanceNodes&&(this.args.balanceNodes=c.balanceNodes),null!=c.nodesMaxSize&&(this.args.nodesMaxSize=c.nodesMaxSize),null!=c.nodesMinSize&&(this.args.nodesMinSize=c.nodesMinSize)),this.args.defaultEdgeProperties={fill:"#000000",radius:"1",stroke:"#000000",size:1,title:{fontSize:10,fontColor:"#000000"}},this.args.vertexFormatProperties={fill:"#000000",stroke:"#000000","stroke-opacity":"#000000"},null!=a&&(this.args.vertexFormatProperties=a),null!=b&&(this.args.defaultEdgeProperties=b),this.changed=new Event(this),this.edgeChanged=new Event(this),this.resized=new Event(this),this.backgroundImageChanged=new Event(this),this.backgroundColorChanged=new Event(this)}function NetworkWidget(a){this.id="NetworkViewer_"+Math.random().toString().replace(".","_"),this.label=!0,null!=a&&(null!=a.targetId&&(this.targetId=a.targetId),null!=a.label&&(this.label=a.label)),this.onVertexOver=new Event(this),this.onVertexOut=new Event(this)}function Vertex(a,b,c){GraphItem.prototype.constructor.call(this,a,b,c),this.edgesIn=new Array,this.edgesOut=new Array}function VertexGraphFormatter(a,b,c,d){ItemGraphFormatter.prototype.constructor.call(this,a,b,c,d)}function CircleVertexGraphFormatter(a,b,c,d,e){VertexGraphFormatter.prototype.constructor.call(this,a,b,c,d,e),this.args.type="CircleVertexGraphFormatter",null!=b&&null!=b.radius&&(this.defaultFormat.args.radius=b.radius),null!=c&&null!=c.radius&&(this.selected.args.radius=c.radius),null!=d&&null!=d.radius&&(this.over.args.radius=d.radius),null!=e&&null!=e.radius&&(this.dragging.args.draggingFormat=e.radius)}function SquareVertexGraphFormatter(a,b,c,d,e){VertexGraphFormatter.prototype.constructor.call(this,a,b,c,d,e),this.args.type="SquareVertexGraphFormatter",null!=b&&null!=b.radius&&(this.defaultFormat.args.radius=b.radius),null!=c&&null!=c.radius&&(this.selected.args.radius=c.radius),null!=d&&null!=d.radius&&(this.over.args.radius=d.radius),null!=e&&null!=e.radius&&(this.dragging.args.draggingFormat=e.radius)}function EllipseVertexGraphFormatter(a,b,c,d,e){VertexGraphFormatter.prototype.constructor.call(this,a,b,c,d,e),this.args.type="EllipseVertexGraphFormatter",null!=b&&null!=b.radius&&(this.defaultFormat.args.radius=b.radius),null!=c&&null!=c.radius&&(this.selected.args.radius=c.radius),null!=d&&null!=d.radius&&(this.over.args.radius=d.radius),null!=e&&null!=e.radius&&(this.dragging.args.draggingFormat=e.radius)}function RectangleVertexGraphFormatter(a,b,c,d,e){VertexGraphFormatter.prototype.constructor.call(this,a,b,c,d,e),this.args.type="RectangleVertexGraphFormatter",null!=b&&null!=b.radius&&(this.defaultFormat.args.radius=b.radius),null!=c&&null!=c.radius&&(this.selected.args.radius=c.radius),null!=d&&null!=d.radius&&(this.over.args.radius=d.radius),null!=e&&null!=e.radius&&(this.dragging.args.draggingFormat=e.radius)}function RoundedVertexGraphFormatter(a,b,c,d,e){VertexGraphFormatter.prototype.constructor.call(this,a,b,c,d,e),this.args.type="RoundedVertexGraphFormatter",null!=b&&null!=b.radius&&(this.defaultFormat.args.radius=b.radius),null!=c&&null!=c.radius&&(this.selected.args.radius=c.radius),null!=d&&null!=d.radius&&(this.over.args.radius=d.radius),null!=e&&null!=e.radius&&(this.dragging.args.draggingFormat=e.radius)}function OctagonVertexGraphFormatter(a,b,c,d,e){VertexGraphFormatter.prototype.constructor.call(this,a,b,c,d,e),this.args.type="OctagonVertexGraphFormatter",null!=b&&null!=b.radius&&(this.defaultFormat.args.radius=b.radius),null!=c&&null!=c.radius&&(this.selected.args.radius=c.radius),null!=d&&null!=d.radius&&(this.over.args.radius=d.radius),null!=e&&null!=e.radius&&(this.dragging.args.draggingFormat=e.radius)}function PDBViewer(a){this.id=BUI.id(),this.glMol=null,this.width=600,this.height=600,this.title="",this.margin="10 0 0 5",null!=a&&(null!=a.width&&(this.width=a.width),null!=a.height&&(this.height=a.height),null!=a.title&&(this.title=a.title),null!=a.margin&&(this.margin=a.margin))}function SuperpositionPDBViewer(a){this.width=550,this.height=500,null!=a&&null!=a.actions&&(this.actions=a.actions);this.form=new BufferForm,this.onSuccess=new Event,PDBViewer.prototype.constructor.call(this,a)}function AlignedSuperpositionPDBViewer(a){this.width=550,this.height=500,null!=a&&null!=a.actions&&(this.actions=a.actions);this.form=new BufferForm,this.onSuccess=new Event,PDBViewer.prototype.constructor.call(this,a)}function StructurePDBViewer(a){this.width=550,this.height=500,null!=a&&null!=a.actions&&(this.actions=a.actions);this.form=new BufferForm,this.onSuccess=new Event,PDBViewer.prototype.constructor.call(this,a)}function QueueGrid(a){this.decimals=3,this.onSelect=new Event,this.maxHeight=600,this.id=BUI.id(),this.title="Data Collections",this.key={},this.selectionMode="MULTI",this.collapsible=!0,this.collapsed=!1;var b=this;this.filters=[function(a){return null==a.data.dataCollectionId?!1:(null==b.key[a.data.dataCollectionId]&&(b.key[a.data.dataCollectionId]=[]),b.key[a.data.dataCollectionId].push(a.data),null!=a.data.macromoleculeId)}],null!=a&&(null!=a.maxHeight&&(this.maxHeight=a.maxHeight),null!=a.collapsible&&(this.collapsible=a.collapsible),null!=a.collapsed&&(this.collapsed=a.collapsed),null!=a.selectionMode&&(this.selectionMode=a.selectionMode),null!=a.title&&0==a.title&&(this.title=null)),this.selected=[],this.onSelectionChange=new Event,this.onDeselect=new Event(this),this.onSelect=new Event(this)}function RigidModelGrid(a){this.height=null,this.width=null,this.id=BUI.id(),null!=a&&null!=a.height&&(this.height=a.height,null!=a.width&&(this.width=a.width)),this.onSelected=new Event(this)}function RigidBodyModelingForm(a){this.id=BUI.id(),this.width=700,this.height=500,null!=a&&(null!=a.width&&(this.width=a.width),null!=a.height&&(this.height=a.height));var b=this;this.rigidBodyGrid=new AprioriRigidBodyGrid,this.rigidBodyGrid.onUploadFile.attach(function(a,c,d){b.openUploadManager(EXI.getDataAdapter().saxs.macromolecule.getAddPDBURL(b.macromolecule.macromoleculeId))}),this.rigidBodyGrid.onRemove.attach(function(a,c,d){b._update()}),this.onSave=new Event(this)}function SamplePlateGroupWidget(a){this.id=BUI.id(),this.width=900,this.height=300,this.titleTypePlate=20,this.margin=0,this.samplePlateWidgets=[],this.bbar=!1,this.border=1,this.showTitle=!0,this.title=null,this.nodeSize=8,null!=a&&(null!=a.margin&&(this.margin=a.margin),null!=a.bbar&&(this.bbar=a.bbar),null!=a.showTitle&&(this.showTitle=a.showTitle,this.showTitle&&(this.title="Plates Groups")),null!=a.border&&(this.border=a.border),null!=a.height&&(this.height=a.height)),this.heightPlates=this.height-this.titleTypePlate-60,this.onClick=new Event(this),this.onExperimentChanged=new Event(this)}function SamplePlateWidget(a){this.actions=[],this.width="1",this.height="1",this.legendFontSize=7,this.backgroundColor="#E6E6E6",this.wellColor="#FFFFFF ",this.id=BUI.id(),this.notSupportedMessage="IE doesn't support HTML5 features",this.nodeSize=14,this.fontSize=10,this.strokeWidth=2,this.showTooltip=!0,this.showBorderLabels=!0,this.showFullName=!1,this.showLabels=!1,null!=a&&(null!=a.showBorderLabels&&(this.showBorderLabels=a.showBorderLabels),null!=a.showLabels&&(this.showLabels=a.showLabels),null!=a.width&&(this.width=a.width),null!=a.height&&(this.height=a.height),null!=a.nodeSize&&(this.nodeSize=a.nodeSize),null!=a.notSupportedMessage&&(this.notSupportedMessage=a.notSupportedMessage),null!=a.fontSize&&(this.fontSize=a.fontSize),null!=a.showFullName&&(this.showFullName=a.showFullName),null!=a.showTooltip&&(this.showTooltip=a.showTooltip),null!=a.backgroundColor&&(this.backgroundColor=a.backgroundColor),null!=a.strokeWidth&&(this.strokeWidth=a.strokeWidth)),this.ids={},this.onVertexUp=new Event(this),this.selectedSVGNodes=[],this.markedSpecimenId={}}function SamplesGrid(a){this.height=500,this.id=BUI.id(),this.tbar=!1,this.width=100,this.title="Samples list",this.margin="5 5 5 5",null!=a&&(null!=a.title&&(this.title=a.title),null!=a.margin&&(this.margin=a.margin),null!=a.height&&(this.height=a.height),null!=a.tbar&&(this.tbar=a.tbar),null!=a.width&&(this.width=a.width)),this.onSelected=new Event(this),Ext.define("BLSampleModel",{extend:"Ext.data.Model",fields:[{name:"proteinAcronym",mapping:"proteinAcronym"},{name:"name",mapping:"name"},{name:"spaceGroup",mapping:"spaceGroup"},{name:"beamlineLocation",mapping:"beamlineLocation"},{name:"code",mapping:"code"},{name:"shipment",mapping:"shipping"},{name:"cellA",mapping:"cellA"},{name:"cellB",mapping:"cellB"},{name:"cellC",mapping:"cellC"},{name:"cellAlpha",mapping:"cellAlpha"},{name:"cellBeta",mapping:"cellBeta"},{name:"cellGamma",mapping:"cellGamma"}],idProperty:"blSampleId"})}function SpecimenGrid(a){this.id=BUI.id(),this.height=500,this.unitsFontSize=9,this.editEnabled=!1,this.isPositionColumnHidden=!1,this.removeBtnEnabled=!1,this.updateRowEnabled=!1,this.grouped=!0,this.width=900,this.title="Specimens",this.margin="0 0 0 0",null!=a&&(null!=a.height&&(this.height=a.height),0==a.showTitle&&(this.title=null),0==a.margin&&(this.margin=a.margin),0==a.grouped&&(this.grouped=null),null!=a.width&&(this.width=a.width),null!=a.editEnabled&&(this.editEnabled=a.editEnabled),null!=a.removeBtnEnabled&&(this.removeBtnEnabled=a.removeBtnEnabled),null!=a.isPositionColumnHidden&&(this.isPositionColumnHidden=a.isPositionColumnHidden),null!=a.updateRowEnabled&&(this.updateRowEnabled=a.updateRowEnabled)),this.onClick=new Event(this),this.onSelected=new Event(this),this.onRemoved=new Event(this),this.onSpecimenChanged=new Event}function SpecimenWidget(a){this.width=1e3,this.height=600,null!=a&&(null!=a.width&&(this.width=a.width),null!=a.height&&(this.height=a.height));var b=this;this.specimenGrid=new SpecimenGrid({minHeight:425,selectionMode:"SINGLE",editEnabled:!1,updateRowEnabled:!0,width:900,showTitle:!1}),this.specimenGrid.onSpecimenChanged.attach(function(a,c){b.experiment.setSpecimenById(c),b.refresh(b.experiment)}),this.specimenGrid.onSelected.attach(function(a,c){c.length>0?b.specimenSelected=c[0]:b.specimenSelected=null,b.samplePlateGroupWidget.selectSpecimens(c)}),this.samplePlateGroupWidget=new SamplePlateGroupWidget({showTitle:!1,height:250,margin:5,bbar:!1}),this.samplePlateGroupWidget.onExperimentChanged.attach(function(a,c){b.refresh(new Experiment(c))}),this.samplePlateGroupWidget.onClick.attach(function(a,c){var d=c.row,e=c.column,f=c.samplePlate.samplePlateId;if(null!=b.specimenSelected)if(0==b.experiment.getSampleByPosition(c.samplePlate.samplePlateId,c.row,c.column).length){var g=b.experiment.getSampleById(b.specimenSelected.specimenId);null==g.sampleplateposition3VO&&(g.sampleplateposition3VO={}),g.sampleplateposition3VO={columnNumber:e,rowNumber:d,samplePlateId:f},b.samplePlateGroupWidget.panel.setLoading("ISPyB: Saving specimen");var h=function(a,c){b.samplePlateGroupWidget.panel.setLoading(!1)};EXI.getDataAdapter({onSuccess:h}).saxs.specimen.saveSpecimen(g),b.samplePlateGroupWidget.refresh(b.experiment),b.specimenGrid.refresh(b.experiment),b.specimenSelected=null,b.specimenGrid.deselectAll()}else{var i=b.experiment.getSampleByPosition(c.samplePlate.samplePlateId,c.row,c.column)[0],g=b.experiment.getSampleById(b.specimenSelected.specimenId);if(g.bufferId==i.bufferId&&g.concentration==i.concentration){if(null!=g.macromolecule3VO&&null!=i.macromolecule3VO&&g.macromolecule3VO.macromoleculeId==i.macromolecule3VO.macromoleculeId||null==g.macromolecule3VO&&null==i.macromolecule3VO){var h=function(a,c){b.refresh(new Experiment(c)),b.samplePlateGroupWidget.panel.setLoading(!1),b.onExperimentChanged.notify(experiment)};b.samplePlateGroupWidget.panel.setLoading("ISPyB: Merging specimens"),EXI.getDataAdapter({onSuccess:h}).saxs.specimen.mergeSpecimens(g.specimenId,i.specimenId),b.specimenSelected=null,b.specimenGrid.deselectAll()}}else alert("Well is not empty. Select another well!")}else{var g=b.experiment.getSampleByPosition(c.samplePlate.samplePlateId,c.row,c.column)[0];null!=g&&b.specimenGrid.selectById(g.specimenId)}}),this.onExperimentChanged=new Event(this)}function StockSolutionForm(a){this.id=BUI.id(),this.actions=[],this.height=500,null!=a&&(null!=a.actions&&(this.actions=a.actions),null!=a.height&&(this.height=a.height)),this.onSaved=new Event(this)}function StockSolutionGrid(a){this.id=BUI.id(),this.tbar=!0,this.title="Stock Solutions",this.btnEditVisible=!0,this.btnRemoveVisible=!0,this.btnAddVisible=!0,this.btnAddExisting=!1,this.isPackedVisible=!0,this.btnUnpackVisible=!1,this.multiselect=!1,this.selectedStockSolutions=[],null!=a&&(null!=a.btnUnpackVisible&&(this.btnUnpackVisible=a.btnUnpackVisible),null!=a.multiselect&&(this.multiselect=a.multiselect),null!=a.height&&(this.height=a.height),null!=a.btnEditVisible&&(this.btnEditVisible=a.btnEditVisible),null!=a.btnAddVisible&&(this.btnAddVisible=a.btnAddVisible),null!=a.btnAddExisting&&(this.btnAddExisting=a.btnAddExisting),null!=a.width&&(this.width=a.width),null!=a.minHeight&&(this.minHeight=a.minHeight),null!=a.tbar&&(this.tbar=a.tbar),null!=a.btnRemoveVisible&&(this.btnRemoveVisible=a.btnRemoveVisible),null!=a.isPackedVisible&&(this.isPackedVisible=a.isPackedVisible),null!=a.showTitle&&(this.showTitle=a.showTitle,0==this.showTitle&&(this.title=null))),this.onSaved=new Event(this),this.onUnpack=new Event(this),this.onPack=new Event(this)}function TemplateGrid(a){this.height=500}function VolumeGrid(){this.id=BUI.id()}function WizardWidget(a){this.targetId=null,this.width=910,this.height=400,this.windowMode=!0,null!=a&&(null!=a.windowMode&&(this.windowMode=a.windowMode),null!=a.width&&(this.width=a.width)),this.step=0,this.forms=[],this.onFinished=new Event(this)}function TestController(){this.init()}function SampleForm(a){this.id=a}function TestContainer(){this.container=Ext.create("Ext.container.Container",{layout:{type:"hbox"},width:400,border:1,style:{borderColor:"#000000",borderStyle:"solid",borderWidth:"1px"},items:[]})}function TestListView(){this.title="Samples",ListView.call(this)}function TestMainPanel(){this.title="Samples",ListView.call(this)}function TestMainWidgetPanel(){this.title="Samples",ListView.call(this)}function PuckWidgetView(){this.queueGridList=[],this.widget=new FlexHCDWidget,this.title="Samples",MainView.call(this)}function TestMainView(a){MainView.call(this),this.crystalId=a,this.testMainPanel=new TestMainPanel,this.onSelect=new Event(this),this.onDeselect=new Event(this)}dust.helpers.decimal=function(a,b,c,d){if(d.key){var e=b.current()[d.key];if(e)if(null!=d.decimals)try{a.write(Number(e).toFixed(d.decimals))}catch(f){a.write(b.current()[d.key])}else a.write(b.current()[d.key])}else a.write("WARN: NO KEY SET");return a},dust.helpers.sizeOf=function(a,b,c,d){var e=this.size(a,b,c,d);return c&&c.block?a.render(c.block,b.push({isSelect:!0,isResolved:!1,selectKey:e})):e};var CONTENT_SUB_HEADER=1,CONTENT_PARA_HEADER=2,CONTENT_TEXT=3,CONTENT_PREFORMATTED=4,CONTENT_TABLE=5,CONTENT_PLOT=6,CONTENT_PLOT_TABLE=7,CONTENT_BREAK=8,dat=dat||{};dat.gui=dat.gui||{},dat.utils=dat.utils||{},dat.controllers=dat.controllers||{},dat.dom=dat.dom||{},dat.color=dat.color||{},dat.utils.css=function(){return{load:function(a,b){var b=b||document,c=b.createElement("link");c.type="text/css",c.rel="stylesheet",c.href=a,b.getElementsByTagName("head")[0].appendChild(c)},inject:function(a,b){var b=b||document,c=document.createElement("style");c.type="text/css",c.innerHTML=a,b.getElementsByTagName("head")[0].appendChild(c)}}}(),dat.utils.common=function(){var a=Array.prototype.forEach,b=Array.prototype.slice;return{BREAK:{},extend:function(a){return this.each(b.call(arguments,1),function(b){for(var c in b)this.isUndefined(b[c])||(a[c]=b[c])},this),a},defaults:function(a){return this.each(b.call(arguments,1),function(b){for(var c in b)this.isUndefined(a[c])&&(a[c]=b[c])},this),a},compose:function(){var a=b.call(arguments);return function(){for(var c=b.call(arguments),d=a.length-1;d>=0;d--)c=[a[d].apply(this,c)];return c[0]}},each:function(b,c,d){if(a&&b.forEach===a)b.forEach(c,d);else if(b.length===b.length+0)for(var e=0,f=b.length;f>e&&!(e in b&&c.call(d,b[e],e)===this.BREAK);e++);else for(e in b)if(c.call(d,b[e],e)===this.BREAK)break},defer:function(a){setTimeout(a,0)},toArray:function(a){return a.toArray?a.toArray():b.call(a)},isUndefined:function(a){return void 0===a},isNull:function(a){return null===a},isNaN:function(a){return a!==a},isArray:Array.isArray||function(a){return a.constructor===Array},isObject:function(a){return a===Object(a)},isNumber:function(a){return a===a+0},isString:function(a){return a===a+""},isBoolean:function(a){return a===!1||a===!0},isFunction:function(a){return"[object Function]"===Object.prototype.toString.call(a)}}}(),dat.controllers.Controller=function(a){var b=function(a,b){this.initialValue=a[b],this.domElement=document.createElement("div"),this.object=a,this.property=b,this.__onFinishChange=this.__onChange=void 0};return a.extend(b.prototype,{onChange:function(a){return this.__onChange=a,this},onFinishChange:function(a){return this.__onFinishChange=a,this},setValue:function(a){return this.object[this.property]=a,this.__onChange&&this.__onChange.call(this,a),this.updateDisplay(),this},getValue:function(){return this.object[this.property]},updateDisplay:function(){return this},isModified:function(){return this.initialValue!==this.getValue()}}),b}(dat.utils.common),dat.dom.dom=function(a){function b(b){return"0"===b||a.isUndefined(b)?0:(b=b.match(d),a.isNull(b)?0:parseFloat(b[1]))}var c={};a.each({HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},function(b,d){a.each(b,function(a){c[a]=d})});var d=/(\d+(\.\d+)?)px/,e={makeSelectable:function(a,b){void 0!==a&&void 0!==a.style&&(a.onselectstart=b?function(){return!1}:function(){},a.style.MozUserSelect=b?"auto":"none",a.style.KhtmlUserSelect=b?"auto":"none",a.unselectable=b?"on":"off")},makeFullscreen:function(b,c,d){a.isUndefined(c)&&(c=!0),a.isUndefined(d)&&(d=!0),b.style.position="absolute",c&&(b.style.left=0,b.style.right=0),d&&(b.style.top=0,b.style.bottom=0)},fakeEvent:function(b,d,e,f){var e=e||{},g=c[d];if(!g)throw Error("Event type "+d+" not supported.");var h=document.createEvent(g);switch(g){case"MouseEvents":h.initMouseEvent(d,e.bubbles||!1,e.cancelable||!0,window,e.clickCount||1,0,0,e.x||e.clientX||0,e.y||e.clientY||0,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":g=h.initKeyboardEvent||h.initKeyEvent,a.defaults(e,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),g(d,e.bubbles||!1,e.cancelable,window,e.ctrlKey,e.altKey,e.shiftKey,e.metaKey,e.keyCode,e.charCode);break;default:h.initEvent(d,e.bubbles||!1,e.cancelable||!0)}a.defaults(h,f),b.dispatchEvent(h)},bind:function(a,b,c,d){return a.addEventListener?a.addEventListener(b,c,d||!1):a.attachEvent&&a.attachEvent("on"+b,c),e},unbind:function(a,b,c,d){return a.removeEventListener?a.removeEventListener(b,c,d||!1):a.detachEvent&&a.detachEvent("on"+b,c),e},addClass:function(a,b){if(void 0===a.className)a.className=b;else if(a.className!==b){var c=a.className.split(/ +/);-1==c.indexOf(b)&&(c.push(b),a.className=c.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return e},removeClass:function(a,b){if(b){if(void 0!==a.className)if(a.className===b)a.removeAttribute("class");else{var c=a.className.split(/ +/),d=c.indexOf(b);-1!=d&&(c.splice(d,1),a.className=c.join(" "))}}else a.className=void 0;return e},hasClass:function(a,b){return RegExp("(?:^|\\s+)"+b+"(?:\\s+|$)").test(a.className)||!1},getWidth:function(a){return a=getComputedStyle(a),b(a["border-left-width"])+b(a["border-right-width"])+b(a["padding-left"])+b(a["padding-right"])+b(a.width)},getHeight:function(a){return a=getComputedStyle(a),b(a["border-top-width"])+b(a["border-bottom-width"])+b(a["padding-top"])+b(a["padding-bottom"])+b(a.height)},getOffset:function(a){var b={left:0,top:0};if(a.offsetParent)do b.left+=a.offsetLeft,b.top+=a.offsetTop;while(a=a.offsetParent);return b},isActive:function(a){return a===document.activeElement&&(a.type||a.href)}};return e}(dat.utils.common),dat.controllers.OptionController=function(a,b,c){var d=function(a,e,f){d.superclass.call(this,a,e);var g=this;if(this.__select=document.createElement("select"),c.isArray(f)){var h={};c.each(f,function(a){h[a]=a}),f=h}c.each(f,function(a,b){var c=document.createElement("option");c.innerHTML=b,c.setAttribute("value",a),g.__select.appendChild(c)}),this.updateDisplay(),b.bind(this.__select,"change",function(){g.setValue(this.options[this.selectedIndex].value)}),this.domElement.appendChild(this.__select)};return d.superclass=a,c.extend(d.prototype,a.prototype,{setValue:function(a){return a=d.superclass.prototype.setValue.call(this,a),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),a},updateDisplay:function(){return this.__select.value=this.getValue(),d.superclass.prototype.updateDisplay.call(this)}}),d}(dat.controllers.Controller,dat.dom.dom,dat.utils.common),dat.controllers.NumberController=function(a,b){var c=function(a,d,e){c.superclass.call(this,a,d),e=e||{},this.__min=e.min,this.__max=e.max,this.__step=e.step,a=this.__impliedStep=b.isUndefined(this.__step)?0==this.initialValue?1:Math.pow(10,Math.floor(Math.log(this.initialValue)/Math.LN10))/10:this.__step,a=a.toString(),this.__precision=a.indexOf(".")>-1?a.length-a.indexOf(".")-1:0};return c.superclass=a,b.extend(c.prototype,a.prototype,{setValue:function(a){return void 0!==this.__min&&a<this.__min?a=this.__min:void 0!==this.__max&&a>this.__max&&(a=this.__max),void 0!==this.__step&&a%this.__step!=0&&(a=Math.round(a/this.__step)*this.__step),c.superclass.prototype.setValue.call(this,a)},min:function(a){return this.__min=a,this},max:function(a){return this.__max=a,this},step:function(a){return this.__step=a,this}}),c}(dat.controllers.Controller,dat.utils.common),dat.controllers.NumberControllerBox=function(a,b,c){var d=function(a,e,f){function g(){var a=parseFloat(k.__input.value);c.isNaN(a)||k.setValue(a)}function h(a){var b=j-a.clientY;k.setValue(k.getValue()+b*k.__impliedStep),j=a.clientY}function i(){b.unbind(window,"mousemove",h),b.unbind(window,"mouseup",i)}this.__truncationSuspended=!1,d.superclass.call(this,a,e,f);var j,k=this;this.__input=document.createElement("input"),this.__input.setAttribute("type","text"),b.bind(this.__input,"change",g),b.bind(this.__input,"blur",function(){g(),k.__onFinishChange&&k.__onFinishChange.call(k,k.getValue())}),b.bind(this.__input,"mousedown",function(a){b.bind(window,"mousemove",h),b.bind(window,"mouseup",i),j=a.clientY}),b.bind(this.__input,"keydown",function(a){13===a.keyCode&&(k.__truncationSuspended=!0,this.blur(),k.__truncationSuspended=!1)}),this.updateDisplay(),this.domElement.appendChild(this.__input)};return d.superclass=a,c.extend(d.prototype,a.prototype,{updateDisplay:function(){var a,b=this.__input;if(this.__truncationSuspended)a=this.getValue();else{a=this.getValue();var c=Math.pow(10,this.__precision);a=Math.round(a*c)/c}return b.value=a,d.superclass.prototype.updateDisplay.call(this)}}),d}(dat.controllers.NumberController,dat.dom.dom,dat.utils.common),dat.controllers.NumberControllerSlider=function(a,b,c,d,e){var f=function(a,c,d,e,g){function h(a){a.preventDefault();var c=b.getOffset(j.__background),d=b.getWidth(j.__background);return j.setValue(j.__min+(j.__max-j.__min)*((a.clientX-c.left)/(c.left+d-c.left))),!1}function i(){b.unbind(window,"mousemove",h),b.unbind(window,"mouseup",i),j.__onFinishChange&&j.__onFinishChange.call(j,j.getValue())}f.superclass.call(this,a,c,{min:d,max:e,step:g});var j=this;this.__background=document.createElement("div"),this.__foreground=document.createElement("div"),b.bind(this.__background,"mousedown",function(a){b.bind(window,"mousemove",h),b.bind(window,"mouseup",i),h(a)}),b.addClass(this.__background,"slider"),b.addClass(this.__foreground,"slider-fg"),this.updateDisplay(),this.__background.appendChild(this.__foreground),this.domElement.appendChild(this.__background)};return f.superclass=a,f.useDefaultStyles=function(){c.inject(e)},d.extend(f.prototype,a.prototype,{updateDisplay:function(){return this.__foreground.style.width=(this.getValue()-this.__min)/(this.__max-this.__min)*100+"%",f.superclass.prototype.updateDisplay.call(this)}}),f}(dat.controllers.NumberController,dat.dom.dom,dat.utils.css,dat.utils.common,".slider {\n  box-shadow: inset 0 2px 4px rgba(0,0,0,0.15);\n  height: 1em;\n  border-radius: 1em;\n  background-color: #eee;\n  padding: 0 0.5em;\n  overflow: hidden;\n}\n\n.slider-fg {\n  padding: 1px 0 2px 0;\n  background-color: #aaa;\n  height: 1em;\n  margin-left: -0.5em;\n  padding-right: 0.5em;\n  border-radius: 1em 0 0 1em;\n}\n\n.slider-fg:after {\n  display: inline-block;\n  border-radius: 1em;\n  background-color: #fff;\n  border:  1px solid #aaa;\n  content: '';\n  float: right;\n  margin-right: -1em;\n  margin-top: -1px;\n  height: 0.9em;\n  width: 0.9em;\n}"),dat.controllers.FunctionController=function(a,b,c){var d=function(a,c,e){d.superclass.call(this,a,c);var f=this;this.__button=document.createElement("div"),this.__button.innerHTML=void 0===e?"Fire":e,b.bind(this.__button,"click",function(a){return a.preventDefault(),f.fire(),!1}),b.addClass(this.__button,"button"),this.domElement.appendChild(this.__button)};return d.superclass=a,c.extend(d.prototype,a.prototype,{fire:function(){this.__onChange&&this.__onChange.call(this),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.getValue().call(this.object)}}),d}(dat.controllers.Controller,dat.dom.dom,dat.utils.common),dat.controllers.BooleanController=function(a,b,c){var d=function(a,c){d.superclass.call(this,a,c);var e=this;this.__prev=this.getValue(),this.__checkbox=document.createElement("input"),this.__checkbox.setAttribute("type","checkbox"),b.bind(this.__checkbox,"change",function(){e.setValue(!e.__prev)},!1),this.domElement.appendChild(this.__checkbox),this.updateDisplay()};return d.superclass=a,c.extend(d.prototype,a.prototype,{setValue:function(a){return a=d.superclass.prototype.setValue.call(this,a),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),a},updateDisplay:function(){return this.getValue()===!0?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0):this.__checkbox.checked=!1,d.superclass.prototype.updateDisplay.call(this)}}),d}(dat.controllers.Controller,dat.dom.dom,dat.utils.common),dat.color.toString=function(a){return function(b){if(1==b.a||a.isUndefined(b.a)){for(b=b.hex.toString(16);b.length<6;)b="0"+b;return"#"+b}return"rgba("+Math.round(b.r)+","+Math.round(b.g)+","+Math.round(b.b)+","+b.a+")"}}(dat.utils.common),dat.color.interpret=function(a,b){var c,d,e=[{litmus:b.isString,conversions:{THREE_CHAR_HEX:{read:function(a){return a=a.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i),null===a?!1:{space:"HEX",hex:parseInt("0x"+a[1].toString()+a[1].toString()+a[2].toString()+a[2].toString()+a[3].toString()+a[3].toString())}},write:a},SIX_CHAR_HEX:{read:function(a){return a=a.match(/^#([A-F0-9]{6})$/i),null===a?!1:{space:"HEX",hex:parseInt("0x"+a[1].toString())}},write:a},CSS_RGB:{read:function(a){return a=a.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/),null===a?!1:{space:"RGB",r:parseFloat(a[1]),g:parseFloat(a[2]),b:parseFloat(a[3])}},write:a},CSS_RGBA:{read:function(a){return a=a.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\,\s*(.+)\s*\)/),null===a?!1:{space:"RGB",r:parseFloat(a[1]),g:parseFloat(a[2]),b:parseFloat(a[3]),a:parseFloat(a[4])}},write:a}}},{litmus:b.isNumber,conversions:{HEX:{read:function(a){return{space:"HEX",hex:a,conversionName:"HEX"}},write:function(a){return a.hex}}}},{litmus:b.isArray,conversions:{RGB_ARRAY:{read:function(a){return 3!=a.length?!1:{space:"RGB",r:a[0],g:a[1],b:a[2]}},write:function(a){return[a.r,a.g,a.b]}},RGBA_ARRAY:{read:function(a){return 4!=a.length?!1:{space:"RGB",r:a[0],g:a[1],b:a[2],a:a[3]}},write:function(a){return[a.r,a.g,a.b,a.a]}}}},{litmus:b.isObject,conversions:{RGBA_OBJ:{read:function(a){return b.isNumber(a.r)&&b.isNumber(a.g)&&b.isNumber(a.b)&&b.isNumber(a.a)?{space:"RGB",r:a.r,g:a.g,b:a.b,a:a.a}:!1},write:function(a){return{r:a.r,g:a.g,b:a.b,a:a.a}}},RGB_OBJ:{read:function(a){return b.isNumber(a.r)&&b.isNumber(a.g)&&b.isNumber(a.b)?{space:"RGB",r:a.r,g:a.g,b:a.b}:!1},write:function(a){return{r:a.r,g:a.g,b:a.b}}},HSVA_OBJ:{read:function(a){return b.isNumber(a.h)&&b.isNumber(a.s)&&b.isNumber(a.v)&&b.isNumber(a.a)?{space:"HSV",h:a.h,s:a.s,v:a.v,a:a.a}:!1},write:function(a){return{h:a.h,s:a.s,v:a.v,a:a.a}}},HSV_OBJ:{read:function(a){return b.isNumber(a.h)&&b.isNumber(a.s)&&b.isNumber(a.v)?{space:"HSV",h:a.h,s:a.s,v:a.v}:!1},write:function(a){
return{h:a.h,s:a.s,v:a.v}}}}}];return function(){d=!1;var a=arguments.length>1?b.toArray(arguments):arguments[0];return b.each(e,function(e){return e.litmus(a)?(b.each(e.conversions,function(e,f){return c=e.read(a),d===!1&&c!==!1?(d=c,c.conversionName=f,c.conversion=e,b.BREAK):void 0}),b.BREAK):void 0}),d}}(dat.color.toString,dat.utils.common),dat.GUI=dat.gui.GUI=function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){function p(a,b,c,f){if(void 0===b[c])throw Error("Object "+b+' has no property "'+c+'"');f.color?b=new k(b,c):(b=[b,c].concat(f.factoryArgs),b=d.apply(a,b)),f.before instanceof e&&(f.before=f.before.__li),s(a,b),n.addClass(b.domElement,"c"),c=document.createElement("span"),n.addClass(c,"property-name"),c.innerHTML=b.property;var g=document.createElement("div");return g.appendChild(c),g.appendChild(b.domElement),f=q(a,g,f.before),n.addClass(f,I.CLASS_CONTROLLER_ROW),n.addClass(f,typeof b.getValue()),r(a,f,b),a.__controllers.push(b),b}function q(a,b,c){var d=document.createElement("li");return b&&d.appendChild(b),c?a.__ul.insertBefore(d,params.before):a.__ul.appendChild(d),a.onResize(),d}function r(a,b,c){if(c.__li=b,c.__gui=a,o.extend(c,{options:function(b){return arguments.length>1?(c.remove(),p(a,c.object,c.property,{before:c.__li.nextElementSibling,factoryArgs:[o.toArray(arguments)]})):o.isArray(b)||o.isObject(b)?(c.remove(),p(a,c.object,c.property,{before:c.__li.nextElementSibling,factoryArgs:[b]})):void 0},name:function(a){return c.__li.firstElementChild.firstElementChild.innerHTML=a,c},listen:function(){return c.__gui.listen(c),c},remove:function(){return c.__gui.remove(c),c}}),c instanceof i){var d=new h(c.object,c.property,{min:c.__min,max:c.__max,step:c.__step});o.each(["updateDisplay","onChange","onFinishChange"],function(a){var b=c[a],e=d[a];c[a]=d[a]=function(){var a=Array.prototype.slice.call(arguments);return b.apply(c,a),e.apply(d,a)}}),n.addClass(b,"has-slider"),c.domElement.insertBefore(d.domElement,c.domElement.firstElementChild)}else if(c instanceof h){var e=function(b){return o.isNumber(c.__min)&&o.isNumber(c.__max)?(c.remove(),p(a,c.object,c.property,{before:c.__li.nextElementSibling,factoryArgs:[c.__min,c.__max,c.__step]})):b};c.min=o.compose(e,c.min),c.max=o.compose(e,c.max)}else c instanceof f?(n.bind(b,"click",function(){n.fakeEvent(c.__checkbox,"click")}),n.bind(c.__checkbox,"click",function(a){a.stopPropagation()})):c instanceof g?(n.bind(b,"click",function(){n.fakeEvent(c.__button,"click")}),n.bind(b,"mouseover",function(){n.addClass(c.__button,"hover")}),n.bind(b,"mouseout",function(){n.removeClass(c.__button,"hover")})):c instanceof k&&(n.addClass(b,"color"),c.updateDisplay=o.compose(function(a){return b.style.borderLeftColor=c.__color.toString(),a},c.updateDisplay),c.updateDisplay());c.setValue=o.compose(function(b){return a.getRoot().__preset_select&&c.isModified()&&y(a.getRoot(),!0),b},c.setValue)}function s(a,b){var c=a.getRoot(),d=c.__rememberedObjects.indexOf(b.object);if(-1!=d){var e=c.__rememberedObjectIndecesToControllers[d];if(void 0===e&&(e={},c.__rememberedObjectIndecesToControllers[d]=e),e[b.property]=b,c.load&&c.load.remembered){if(c=c.load.remembered,c[a.preset])c=c[a.preset];else{if(!c[B])return;c=c[B]}c[d]&&void 0!==c[d][b.property]&&(d=c[d][b.property],b.initialValue=d,b.setValue(d))}}}function t(a){var b=a.__save_row=document.createElement("li");n.addClass(a.domElement,"has-save"),a.__ul.insertBefore(b,a.__ul.firstChild),n.addClass(b,"save-row");var c=document.createElement("span");c.innerHTML="&nbsp;",n.addClass(c,"button gears");var d=document.createElement("span");d.innerHTML="Save",n.addClass(d,"button"),n.addClass(d,"save");var e=document.createElement("span");e.innerHTML="New",n.addClass(e,"button"),n.addClass(e,"save-as");var f=document.createElement("span");f.innerHTML="Revert",n.addClass(f,"button"),n.addClass(f,"revert");var g=a.__preset_select=document.createElement("select");if(a.load&&a.load.remembered?o.each(a.load.remembered,function(b,c){x(a,c,c==a.preset)}):x(a,B,!1),n.bind(g,"change",function(){for(var b=0;b<a.__preset_select.length;b++)a.__preset_select[b].innerHTML=a.__preset_select[b].value;a.preset=this.value}),b.appendChild(g),b.appendChild(c),b.appendChild(d),b.appendChild(e),b.appendChild(f),A){var b=document.getElementById("dg-save-locally"),h=document.getElementById("dg-local-explain");b.style.display="block",b=document.getElementById("dg-local-storage"),"true"===localStorage.getItem(document.location.href+".isLocal")&&b.setAttribute("checked","checked");var i=function(){h.style.display=a.useLocalStorage?"block":"none"};i(),n.bind(b,"change",function(){a.useLocalStorage=!a.useLocalStorage,i()})}var j=document.getElementById("dg-new-constructor");n.bind(j,"keydown",function(a){a.metaKey&&(67===a.which||67==a.keyCode)&&D.hide()}),n.bind(c,"click",function(){j.innerHTML=JSON.stringify(a.getSaveObject(),void 0,2),D.show(),j.focus(),j.select()}),n.bind(d,"click",function(){a.save()}),n.bind(e,"click",function(){var b=prompt("Enter a new preset name.");b&&a.saveAs(b)}),n.bind(f,"click",function(){a.revert()})}function u(a){function b(b){return b.preventDefault(),e=b.clientX,n.addClass(a.__closeButton,I.CLASS_DRAG),n.bind(window,"mousemove",c),n.bind(window,"mouseup",d),!1}function c(b){return b.preventDefault(),a.width+=e-b.clientX,a.onResize(),e=b.clientX,!1}function d(){n.removeClass(a.__closeButton,I.CLASS_DRAG),n.unbind(window,"mousemove",c),n.unbind(window,"mouseup",d)}a.__resize_handle=document.createElement("div"),o.extend(a.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"});var e;n.bind(a.__resize_handle,"mousedown",b),n.bind(a.__closeButton,"mousedown",b),a.domElement.insertBefore(a.__resize_handle,a.domElement.firstElementChild)}function v(a,b){a.domElement.style.width=b+"px",a.__save_row&&a.autoPlace&&(a.__save_row.style.width=b+"px"),a.__closeButton&&(a.__closeButton.style.width=b+"px")}function w(a,b){var c={};return o.each(a.__rememberedObjects,function(d,e){var f={};o.each(a.__rememberedObjectIndecesToControllers[e],function(a,c){f[c]=b?a.initialValue:a.getValue()}),c[e]=f}),c}function x(a,b,c){var d=document.createElement("option");d.innerHTML=b,d.value=b,a.__preset_select.appendChild(d),c&&(a.__preset_select.selectedIndex=a.__preset_select.length-1)}function y(a,b){var c=a.__preset_select[a.__preset_select.selectedIndex];c.innerHTML=b?c.value+"*":c.value}function z(a){0!=a.length&&l(function(){z(a)}),o.each(a,function(a){a.updateDisplay()})}a.inject(c);var A,B="Default";try{A="localStorage"in window&&null!==window.localStorage}catch(C){A=!1}var D,E,F=!0,G=!1,H=[],I=function(a){function b(){localStorage.setItem(document.location.href+".gui",JSON.stringify(d.getSaveObject()))}function c(){var a=d.getRoot();a.width+=1,o.defer(function(){a.width-=1})}var d=this;this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),n.addClass(this.domElement,"dg"),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],a=a||{},a=o.defaults(a,{autoPlace:!0,width:I.DEFAULT_WIDTH}),a=o.defaults(a,{resizable:a.autoPlace,hideable:a.autoPlace}),o.isUndefined(a.load)?a.load={preset:B}:a.preset&&(a.load.preset=a.preset),o.isUndefined(a.parent)&&a.hideable&&H.push(this),a.resizable=o.isUndefined(a.parent)&&a.resizable,a.autoPlace&&o.isUndefined(a.scrollable)&&(a.scrollable=!0);var e=A&&"true"===localStorage.getItem(document.location.href+".isLocal");if(Object.defineProperties(this,{parent:{get:function(){return a.parent}},scrollable:{get:function(){return a.scrollable}},autoPlace:{get:function(){return a.autoPlace}},preset:{get:function(){return d.parent?d.getRoot().preset:a.load.preset},set:function(b){for(d.parent?d.getRoot().preset=b:a.load.preset=b,b=0;b<this.__preset_select.length;b++)this.__preset_select[b].value==this.preset&&(this.__preset_select.selectedIndex=b);d.revert()}},width:{get:function(){return a.width},set:function(b){a.width=b,v(d,b)}},name:{get:function(){return a.name},set:function(b){a.name=b,g&&(g.innerHTML=a.name)}},closed:{get:function(){return a.closed},set:function(b){a.closed=b,a.closed?n.addClass(d.__ul,I.CLASS_CLOSED):n.removeClass(d.__ul,I.CLASS_CLOSED),this.onResize(),d.__closeButton&&(d.__closeButton.innerHTML=b?I.TEXT_OPEN:I.TEXT_CLOSED)}},load:{get:function(){return a.load}},useLocalStorage:{get:function(){return e},set:function(a){A&&((e=a)?n.bind(window,"unload",b):n.unbind(window,"unload",b),localStorage.setItem(document.location.href+".isLocal",a))}}}),o.isUndefined(a.parent)){if(a.closed=!1,n.addClass(this.domElement,I.CLASS_MAIN),n.makeSelectable(this.domElement,!1),A&&e){d.useLocalStorage=!0;var f=localStorage.getItem(document.location.href+".gui");f&&(a.load=JSON.parse(f))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=I.TEXT_CLOSED,n.addClass(this.__closeButton,I.CLASS_CLOSE_BUTTON),this.domElement.appendChild(this.__closeButton),n.bind(this.__closeButton,"click",function(){d.closed=!d.closed})}else{void 0===a.closed&&(a.closed=!0);var g=document.createTextNode(a.name);n.addClass(g,"controller-name"),f=q(d,g),n.addClass(this.__ul,I.CLASS_CLOSED),n.addClass(f,"title"),n.bind(f,"click",function(a){return a.preventDefault(),d.closed=!d.closed,!1}),a.closed||(this.closed=!1)}a.autoPlace&&(o.isUndefined(a.parent)&&(F&&(E=document.createElement("div"),n.addClass(E,"dg"),n.addClass(E,I.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(E),F=!1),E.appendChild(this.domElement),n.addClass(this.domElement,I.CLASS_AUTO_PLACE)),this.parent||v(d,a.width)),n.bind(window,"resize",function(){d.onResize()}),n.bind(this.__ul,"webkitTransitionEnd",function(){d.onResize()}),n.bind(this.__ul,"transitionend",function(){d.onResize()}),n.bind(this.__ul,"oTransitionEnd",function(){d.onResize()}),this.onResize(),a.resizable&&u(this),d.getRoot(),a.parent||c()};return I.toggleHide=function(){G=!G,o.each(H,function(a){a.domElement.style.zIndex=G?-999:999,a.domElement.style.opacity=G?0:1})},I.CLASS_AUTO_PLACE="a",I.CLASS_AUTO_PLACE_CONTAINER="ac",I.CLASS_MAIN="main",I.CLASS_CONTROLLER_ROW="cr",I.CLASS_TOO_TALL="taller-than-window",I.CLASS_CLOSED="closed",I.CLASS_CLOSE_BUTTON="close-button",I.CLASS_DRAG="drag",I.DEFAULT_WIDTH=245,I.TEXT_CLOSED="Close Controls",I.TEXT_OPEN="Open Controls",n.bind(window,"keydown",function(a){"text"!==document.activeElement.type&&(72===a.which||72==a.keyCode)&&I.toggleHide()},!1),o.extend(I.prototype,{add:function(a,b){return p(this,a,b,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(a,b){return p(this,a,b,{color:!0})},remove:function(a){this.__ul.removeChild(a.__li),this.__controllers.slice(this.__controllers.indexOf(a),1);var b=this;o.defer(function(){b.onResize()})},destroy:function(){this.autoPlace&&E.removeChild(this.domElement)},addFolder:function(a){if(void 0!==this.__folders[a])throw Error('You already have a folder in this GUI by the name "'+a+'"');var b={name:a,parent:this};return b.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[a]&&(b.closed=this.load.folders[a].closed,b.load=this.load.folders[a]),b=new I(b),this.__folders[a]=b,a=q(this,b.domElement),n.addClass(a,"folder"),b},open:function(){this.closed=!1},close:function(){this.closed=!0},onResize:function(){var a=this.getRoot();if(a.scrollable){var b=n.getOffset(a.__ul).top,c=0;o.each(a.__ul.childNodes,function(b){a.autoPlace&&b===a.__save_row||(c+=n.getHeight(b))}),window.innerHeight-b-20<c?(n.addClass(a.domElement,I.CLASS_TOO_TALL),a.__ul.style.height=window.innerHeight-b-20+"px"):(n.removeClass(a.domElement,I.CLASS_TOO_TALL),a.__ul.style.height="auto")}a.__resize_handle&&o.defer(function(){a.__resize_handle.style.height=a.__ul.offsetHeight+"px"}),a.__closeButton&&(a.__closeButton.style.width=a.width+"px")},remember:function(){if(o.isUndefined(D)&&(D=new m,D.domElement.innerHTML=b),this.parent)throw Error("You can only call remember on a top level GUI.");var a=this;o.each(Array.prototype.slice.call(arguments),function(b){0==a.__rememberedObjects.length&&t(a),-1==a.__rememberedObjects.indexOf(b)&&a.__rememberedObjects.push(b)}),this.autoPlace&&v(this,this.width)},getRoot:function(){for(var a=this;a.parent;)a=a.parent;return a},getSaveObject:function(){var a=this.load;return a.closed=this.closed,this.__rememberedObjects.length>0&&(a.preset=this.preset,a.remembered||(a.remembered={}),a.remembered[this.preset]=w(this)),a.folders={},o.each(this.__folders,function(b,c){a.folders[c]=b.getSaveObject()}),a},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=w(this),y(this,!1)},saveAs:function(a){this.load.remembered||(this.load.remembered={},this.load.remembered[B]=w(this,!0)),this.load.remembered[a]=w(this),this.preset=a,x(this,a,!0)},revert:function(a){o.each(this.__controllers,function(b){this.getRoot().load.remembered?s(a||this.getRoot(),b):b.setValue(b.initialValue)},this),o.each(this.__folders,function(a){a.revert(a)}),a||y(this.getRoot(),!1)},listen:function(a){var b=0==this.__listening.length;this.__listening.push(a),b&&z(this.__listening)}}),I}(dat.utils.css,'<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n      \n    </div>\n    \n  </div>\n\n</div>',".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity 0.1s linear;-o-transition:opacity 0.1s linear;-moz-transition:opacity 0.1s linear;transition:opacity 0.1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity 0.1s linear;-o-transition:opacity 0.1s linear;-moz-transition:opacity 0.1s linear;transition:opacity 0.1s linear;border:0;position:absolute;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-x:hidden}.dg.a.has-save ul{margin-top:27px}.dg.a.has-save ul.closed{margin-top:0}.dg.a .save-row{position:fixed;top:0;z-index:1002}.dg li{-webkit-transition:height 0.1s ease-out;-o-transition:height 0.1s ease-out;-moz-transition:height 0.1s ease-out;transition:height 0.1s ease-out}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;overflow:hidden;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li > *{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:9px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2fa1d6}.dg .cr.number input[type=text]{color:#2fa1d6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2fa1d6}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n",dat.controllers.factory=function(a,b,c,d,e,f,g){return function(h,i,j,k){var l=h[i];return g.isArray(j)||g.isObject(j)?new a(h,i,j):g.isNumber(l)?g.isNumber(j)&&g.isNumber(k)?new c(h,i,j,k):new b(h,i,{min:j,max:k}):g.isString(l)?new d(h,i):g.isFunction(l)?new e(h,i,""):g.isBoolean(l)?new f(h,i):void 0}}(dat.controllers.OptionController,dat.controllers.NumberControllerBox,dat.controllers.NumberControllerSlider,dat.controllers.StringController=function(a,b,c){var d=function(a,c){function e(){f.setValue(f.__input.value)}d.superclass.call(this,a,c);var f=this;this.__input=document.createElement("input"),this.__input.setAttribute("type","text"),b.bind(this.__input,"keyup",e),b.bind(this.__input,"change",e),b.bind(this.__input,"blur",function(){f.__onFinishChange&&f.__onFinishChange.call(f,f.getValue())}),b.bind(this.__input,"keydown",function(a){13===a.keyCode&&this.blur()}),this.updateDisplay(),this.domElement.appendChild(this.__input)};return d.superclass=a,c.extend(d.prototype,a.prototype,{updateDisplay:function(){return b.isActive(this.__input)||(this.__input.value=this.getValue()),d.superclass.prototype.updateDisplay.call(this)}}),d}(dat.controllers.Controller,dat.dom.dom,dat.utils.common),dat.controllers.FunctionController,dat.controllers.BooleanController,dat.utils.common),dat.controllers.Controller,dat.controllers.BooleanController,dat.controllers.FunctionController,dat.controllers.NumberControllerBox,dat.controllers.NumberControllerSlider,dat.controllers.OptionController,dat.controllers.ColorController=function(a,b,c,d,e){function f(a,b,c,d){a.style.background="",e.each(i,function(e){a.style.cssText+="background: "+e+"linear-gradient("+b+", "+c+" 0%, "+d+" 100%); "})}function g(a){a.style.background="",a.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",a.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",a.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",a.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",a.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);"}var h=function(a,i){function j(a){n(a),b.bind(window,"mousemove",n),b.bind(window,"mouseup",k)}function k(){b.unbind(window,"mousemove",n),b.unbind(window,"mouseup",k)}function l(){var a=d(this.value);a!==!1?(p.__color.__state=a,p.setValue(p.__color.toOriginal())):this.value=p.__color.toString()}function m(){b.unbind(window,"mousemove",o),b.unbind(window,"mouseup",m)}function n(a){a.preventDefault();var c=b.getWidth(p.__saturation_field),d=b.getOffset(p.__saturation_field),e=(a.clientX-d.left+document.body.scrollLeft)/c,a=1-(a.clientY-d.top+document.body.scrollTop)/c;return a>1?a=1:0>a&&(a=0),e>1?e=1:0>e&&(e=0),p.__color.v=a,p.__color.s=e,p.setValue(p.__color.toOriginal()),!1}function o(a){a.preventDefault();var c=b.getHeight(p.__hue_field),d=b.getOffset(p.__hue_field),a=1-(a.clientY-d.top+document.body.scrollTop)/c;return a>1?a=1:0>a&&(a=0),p.__color.h=360*a,p.setValue(p.__color.toOriginal()),!1}h.superclass.call(this,a,i),this.__color=new c(this.getValue()),this.__temp=new c(0);var p=this;this.domElement=document.createElement("div"),b.makeSelectable(this.domElement,!1),this.__selector=document.createElement("div"),this.__selector.className="selector",this.__saturation_field=document.createElement("div"),this.__saturation_field.className="saturation-field",this.__field_knob=document.createElement("div"),this.__field_knob.className="field-knob",this.__field_knob_border="2px solid ",this.__hue_knob=document.createElement("div"),this.__hue_knob.className="hue-knob",this.__hue_field=document.createElement("div"),this.__hue_field.className="hue-field",this.__input=document.createElement("input"),this.__input.type="text",this.__input_textShadow="0 1px 1px ",b.bind(this.__input,"keydown",function(a){13===a.keyCode&&l.call(this)}),b.bind(this.__input,"blur",l),b.bind(this.__selector,"mousedown",function(){b.addClass(this,"drag").bind(window,"mouseup",function(){b.removeClass(p.__selector,"drag")})});var q=document.createElement("div");e.extend(this.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),e.extend(this.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:this.__field_knob_border+(this.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),e.extend(this.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),e.extend(this.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),e.extend(q.style,{width:"100%",height:"100%",background:"none"}),f(q,"top","rgba(0,0,0,0)","#000"),e.extend(this.__hue_field.style,{width:"15px",height:"100px",display:"inline-block",border:"1px solid #555",cursor:"ns-resize"}),g(this.__hue_field),e.extend(this.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:this.__input_textShadow+"rgba(0,0,0,0.7)"}),b.bind(this.__saturation_field,"mousedown",j),b.bind(this.__field_knob,"mousedown",j),b.bind(this.__hue_field,"mousedown",function(a){o(a),b.bind(window,"mousemove",o),b.bind(window,"mouseup",m)}),this.__saturation_field.appendChild(q),this.__selector.appendChild(this.__field_knob),this.__selector.appendChild(this.__saturation_field),this.__selector.appendChild(this.__hue_field),this.__hue_field.appendChild(this.__hue_knob),this.domElement.appendChild(this.__input),this.domElement.appendChild(this.__selector),this.updateDisplay()};h.superclass=a,e.extend(h.prototype,a.prototype,{updateDisplay:function(){var a=d(this.getValue());if(a!==!1){var b=!1;e.each(c.COMPONENTS,function(c){return e.isUndefined(a[c])||e.isUndefined(this.__color.__state[c])||a[c]===this.__color.__state[c]?void 0:(b=!0,{})},this),b&&e.extend(this.__color.__state,a)}e.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var g=this.__color.v<.5||this.__color.s>.5?255:0,h=255-g;e.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toString(),border:this.__field_knob_border+"rgb("+g+","+g+","+g+")"}),this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px",this.__temp.s=1,this.__temp.v=1,f(this.__saturation_field,"left","#fff",this.__temp.toString()),e.extend(this.__input.style,{backgroundColor:this.__input.value=this.__color.toString(),color:"rgb("+g+","+g+","+g+")",textShadow:this.__input_textShadow+"rgba("+h+","+h+","+h+",.7)"})}});var i=["-moz-","-o-","-webkit-","-ms-",""];return h}(dat.controllers.Controller,dat.dom.dom,dat.color.Color=function(a,b,c,d){function e(a,b,c){Object.defineProperty(a,b,{get:function(){return"RGB"===this.__state.space?this.__state[b]:(g(this,b,c),this.__state[b])},set:function(a){"RGB"!==this.__state.space&&(g(this,b,c),this.__state.space="RGB"),this.__state[b]=a}})}function f(a,b){Object.defineProperty(a,b,{get:function(){return"HSV"===this.__state.space?this.__state[b]:(h(this),this.__state[b])},set:function(a){"HSV"!==this.__state.space&&(h(this),this.__state.space="HSV"),this.__state[b]=a}})}function g(a,c,e){if("HEX"===a.__state.space)a.__state[c]=b.component_from_hex(a.__state.hex,e);else{if("HSV"!==a.__state.space)throw"Corrupted color state";d.extend(a.__state,b.hsv_to_rgb(a.__state.h,a.__state.s,a.__state.v))}}function h(a){var c=b.rgb_to_hsv(a.r,a.g,a.b);d.extend(a.__state,{s:c.s,v:c.v}),d.isNaN(c.h)?d.isUndefined(a.__state.h)&&(a.__state.h=0):a.__state.h=c.h}var i=function(){if(this.__state=a.apply(this,arguments),this.__state===!1)throw"Failed to interpret color arguments";this.__state.a=this.__state.a||1};return i.COMPONENTS="r,g,b,h,s,v,hex,a".split(","),d.extend(i.prototype,{toString:function(){return c(this)},toOriginal:function(){return this.__state.conversion.write(this)}}),e(i.prototype,"r",2),e(i.prototype,"g",1),e(i.prototype,"b",0),f(i.prototype,"h"),f(i.prototype,"s"),f(i.prototype,"v"),Object.defineProperty(i.prototype,"a",{get:function(){return this.__state.a},set:function(a){this.__state.a=a}}),Object.defineProperty(i.prototype,"hex",{get:function(){return"HEX"!==!this.__state.space&&(this.__state.hex=b.rgb_to_hex(this.r,this.g,this.b)),this.__state.hex},set:function(a){this.__state.space="HEX",this.__state.hex=a}}),i}(dat.color.interpret,dat.color.math=function(){var a;return{hsv_to_rgb:function(a,b,c){var d=a/60-Math.floor(a/60),e=c*(1-b),f=c*(1-d*b),b=c*(1-(1-d)*b),a=[[c,b,e],[f,c,e],[e,c,b],[e,f,c],[b,e,c],[c,e,f]][Math.floor(a/60)%6];return{r:255*a[0],g:255*a[1],b:255*a[2]}},rgb_to_hsv:function(a,b,c){var d=Math.min(a,b,c),e=Math.max(a,b,c),d=e-d;return 0==e?{h:NaN,s:0,v:0}:(a=a==e?(b-c)/d:b==e?2+(c-a)/d:4+(a-b)/d,a/=6,0>a&&(a+=1),{h:360*a,s:d/e,v:e/255})},rgb_to_hex:function(a,b,c){return a=this.hex_with_component(0,2,a),a=this.hex_with_component(a,1,b),a=this.hex_with_component(a,0,c)},component_from_hex:function(a,b){return a>>8*b&255},hex_with_component:function(b,c,d){return d<<(a=8*c)|b&~(255<<a)}}}(),dat.color.toString,dat.utils.common),dat.color.interpret,dat.utils.common),dat.utils.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}(),dat.dom.CenteredDiv=function(a,b){var c=function(){this.backgroundElement=document.createElement("div"),b.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear"}),a.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),b.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var c=this;a.bind(this.backgroundElement,"click",function(){c.hide()})};return c.prototype.show=function(){var a=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),b.defer(function(){a.backgroundElement.style.opacity=1,a.domElement.style.opacity=1,a.domElement.style.webkitTransform="scale(1)"})},c.prototype.hide=function(){var b=this,c=function(){b.domElement.style.display="none",b.backgroundElement.style.display="none",a.unbind(b.domElement,"webkitTransitionEnd",c),a.unbind(b.domElement,"transitionend",c),a.unbind(b.domElement,"oTransitionEnd",c)};a.bind(this.domElement,"webkitTransitionEnd",c),a.bind(this.domElement,"transitionend",c),a.bind(this.domElement,"oTransitionEnd",c),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"},c.prototype.layout=function(){this.domElement.style.left=window.innerWidth/2-a.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-a.getHeight(this.domElement)/2+"px"},c}(dat.dom.dom,dat.utils.common),dat.dom.dom,dat.utils.common);var Detector={canvas:!!window.CanvasRenderingContext2D,webgl:function(){try{var a=document.createElement("canvas");return!!window.WebGLRenderingContext&&(a.getContext("webgl")||a.getContext("experimental-webgl"))}catch(b){return!1}}(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob,getWebGLErrorMessage:function(){var a=document.createElement("div");return a.id="webgl-error-message",a.style.fontFamily="monospace",a.style.fontSize="13px",a.style.fontWeight="normal",a.style.textAlign="center",a.style.background="#fff",a.style.color="#000",a.style.padding="1.5em",a.style.width="400px",a.style.margin="5em auto 0",this.webgl||(a.innerHTML=window.WebGLRenderingContext?['Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br />','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join("\n"):['Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br/>','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join("\n")),
a},addGetWebGLMessage:function(a){var b,c,d;a=a||{},b=void 0!==a.parent?a.parent:document.body,c=void 0!==a.id?a.id:"oldie",d=Detector.getWebGLErrorMessage(),d.id=c,b.appendChild(d)}};!function(){function a(b){var c=a.modules[b];if(!c)throw new Error('failed to require "'+b+'"');return"exports"in c||"function"!=typeof c.definition||(c.client=c.component=!0,c.definition.call(this,c.exports={},c),delete c.definition),c.exports}a.modules={},a.register=function(b,c){a.modules[b]={definition:c}},a.define=function(b,c){a.modules[b]={exports:c}},a.register("component~emitter@1.1.2",function(a,b){function c(a){return a?d(a):void 0}function d(a){for(var b in c.prototype)a[b]=c.prototype[b];return a}b.exports=c,c.prototype.on=c.prototype.addEventListener=function(a,b){return this._callbacks=this._callbacks||{},(this._callbacks[a]=this._callbacks[a]||[]).push(b),this},c.prototype.once=function(a,b){function c(){d.off(a,c),b.apply(this,arguments)}var d=this;return this._callbacks=this._callbacks||{},c.fn=b,this.on(a,c),this},c.prototype.off=c.prototype.removeListener=c.prototype.removeAllListeners=c.prototype.removeEventListener=function(a,b){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var c=this._callbacks[a];if(!c)return this;if(1==arguments.length)return delete this._callbacks[a],this;for(var d,e=0;e<c.length;e++)if(d=c[e],d===b||d.fn===b){c.splice(e,1);break}return this},c.prototype.emit=function(a){this._callbacks=this._callbacks||{};var b=[].slice.call(arguments,1),c=this._callbacks[a];if(c){c=c.slice(0);for(var d=0,e=c.length;e>d;++d)c[d].apply(this,b)}return this},c.prototype.listeners=function(a){return this._callbacks=this._callbacks||{},this._callbacks[a]||[]},c.prototype.hasListeners=function(a){return!!this.listeners(a).length}}),a.register("dropzone",function(b,c){c.exports=a("dropzone/lib/dropzone.js")}),a.register("dropzone/lib/dropzone.js",function(b,c){(function(){var b,d,e,f,g,h,i,j,k={}.hasOwnProperty,l=function(a,b){function c(){this.constructor=a}for(var d in b)k.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},m=[].slice;d="undefined"!=typeof Emitter&&null!==Emitter?Emitter:a("component~emitter@1.1.2"),i=function(){},b=function(a){function b(a,d){var e,f,g;if(this.element=a,this.version=b.version,this.defaultOptions.previewTemplate=this.defaultOptions.previewTemplate.replace(/\n*/g,""),this.clickableElements=[],this.listeners=[],this.files=[],"string"==typeof this.element&&(this.element=document.querySelector(this.element)),!this.element||null==this.element.nodeType)throw new Error("Invalid dropzone element.");if(this.element.dropzone)throw new Error("Dropzone already attached.");if(b.instances.push(this),this.element.dropzone=this,e=null!=(g=b.optionsForElement(this.element))?g:{},this.options=c({},this.defaultOptions,e,null!=d?d:{}),this.options.forceFallback||!b.isBrowserSupported())return this.options.fallback.call(this);if(null==this.options.url&&(this.options.url=this.element.getAttribute("action")),!this.options.url)throw new Error("No URL provided.");if(this.options.acceptedFiles&&this.options.acceptedMimeTypes)throw new Error("You can't provide both 'acceptedFiles' and 'acceptedMimeTypes'. 'acceptedMimeTypes' is deprecated.");this.options.acceptedMimeTypes&&(this.options.acceptedFiles=this.options.acceptedMimeTypes,delete this.options.acceptedMimeTypes),this.options.method=this.options.method.toUpperCase(),(f=this.getExistingFallback())&&f.parentNode&&f.parentNode.removeChild(f),this.options.previewsContainer!==!1&&(this.options.previewsContainer?this.previewsContainer=b.getElement(this.options.previewsContainer,"previewsContainer"):this.previewsContainer=this.element),this.options.clickable&&(this.options.clickable===!0?this.clickableElements=[this.element]:this.clickableElements=b.getElements(this.options.clickable,"clickable")),this.init()}var c;return l(b,a),b.prototype.events=["drop","dragstart","dragend","dragenter","dragover","dragleave","addedfile","removedfile","thumbnail","error","errormultiple","processing","processingmultiple","uploadprogress","totaluploadprogress","sending","sendingmultiple","success","successmultiple","canceled","canceledmultiple","complete","completemultiple","reset","maxfilesexceeded","maxfilesreached"],b.prototype.defaultOptions={url:null,method:"post",withCredentials:!1,parallelUploads:2,uploadMultiple:!1,maxFilesize:256,paramName:"file",createImageThumbnails:!0,maxThumbnailFilesize:10,thumbnailWidth:100,thumbnailHeight:100,maxFiles:null,params:{},clickable:!0,ignoreHiddenFiles:!0,acceptedFiles:null,acceptedMimeTypes:null,autoProcessQueue:!0,autoQueue:!0,addRemoveLinks:!1,previewsContainer:null,dictDefaultMessage:"Drop files here to upload",dictFallbackMessage:"Your browser does not support drag'n'drop file uploads.",dictFallbackText:"Please use the fallback form below to upload your files like in the olden days.",dictFileTooBig:"File is too big ({{filesize}}MiB). Max filesize: {{maxFilesize}}MiB.",dictInvalidFileType:"You can't upload files of this type.",dictResponseError:"Server responded with {{statusCode}} code.",dictCancelUpload:"Cancel upload",dictCancelUploadConfirmation:"Are you sure you want to cancel this upload?",dictRemoveFile:"Remove file",dictRemoveFileConfirmation:null,dictMaxFilesExceeded:"You can not upload any more files.",accept:function(a,b){return b()},init:function(){return i},forceFallback:!1,fallback:function(){var a,c,d,e,f,g;for(this.element.className=""+this.element.className+" dz-browser-not-supported",g=this.element.getElementsByTagName("div"),e=0,f=g.length;f>e;e++)a=g[e],/(^| )dz-message($| )/.test(a.className)&&(c=a,a.className="dz-message");return c||(c=b.createElement('<div class="dz-message"><span></span></div>'),this.element.appendChild(c)),d=c.getElementsByTagName("span")[0],d&&(d.textContent=this.options.dictFallbackMessage),this.element.appendChild(this.getFallbackForm())},resize:function(a){var b,c,d;return b={srcX:0,srcY:0,srcWidth:a.width,srcHeight:a.height},c=a.width/a.height,b.optWidth=this.options.thumbnailWidth,b.optHeight=this.options.thumbnailHeight,null==b.optWidth&&null==b.optHeight?(b.optWidth=b.srcWidth,b.optHeight=b.srcHeight):null==b.optWidth?b.optWidth=c*b.optHeight:null==b.optHeight&&(b.optHeight=1/c*b.optWidth),d=b.optWidth/b.optHeight,a.height<b.optHeight||a.width<b.optWidth?(b.trgHeight=b.srcHeight,b.trgWidth=b.srcWidth):c>d?(b.srcHeight=a.height,b.srcWidth=b.srcHeight*d):(b.srcWidth=a.width,b.srcHeight=b.srcWidth/d),b.srcX=(a.width-b.srcWidth)/2,b.srcY=(a.height-b.srcHeight)/2,b},drop:function(a){return this.element.classList.remove("dz-drag-hover")},dragstart:i,dragend:function(a){return this.element.classList.remove("dz-drag-hover")},dragenter:function(a){return this.element.classList.add("dz-drag-hover")},dragover:function(a){return this.element.classList.add("dz-drag-hover")},dragleave:function(a){return this.element.classList.remove("dz-drag-hover")},paste:i,reset:function(){return this.element.classList.remove("dz-started")},addedfile:function(a){var c,d,e,f,g,h,i,j,k,l,m,n,o;if(this.element===this.previewsContainer&&this.element.classList.add("dz-started"),this.previewsContainer){for(a.previewElement=b.createElement(this.options.previewTemplate.trim()),a.previewTemplate=a.previewElement,this.previewsContainer.appendChild(a.previewElement),l=a.previewElement.querySelectorAll("[data-dz-name]"),f=0,i=l.length;i>f;f++)c=l[f],c.textContent=a.name;for(m=a.previewElement.querySelectorAll("[data-dz-size]"),g=0,j=m.length;j>g;g++)c=m[g],c.innerHTML=this.filesize(a.size);for(this.options.addRemoveLinks&&(a._removeLink=b.createElement('<a class="dz-remove" href="javascript:undefined;" data-dz-remove>'+this.options.dictRemoveFile+"</a>"),a.previewElement.appendChild(a._removeLink)),d=function(c){return function(d){return d.preventDefault(),d.stopPropagation(),a.status===b.UPLOADING?b.confirm(c.options.dictCancelUploadConfirmation,function(){return c.removeFile(a)}):c.options.dictRemoveFileConfirmation?b.confirm(c.options.dictRemoveFileConfirmation,function(){return c.removeFile(a)}):c.removeFile(a)}}(this),n=a.previewElement.querySelectorAll("[data-dz-remove]"),o=[],h=0,k=n.length;k>h;h++)e=n[h],o.push(e.addEventListener("click",d));return o}},removedfile:function(a){var b;return a.previewElement&&null!=(b=a.previewElement)&&b.parentNode.removeChild(a.previewElement),this._updateMaxFilesReachedClass()},thumbnail:function(a,b){var c,d,e,f,g;if(a.previewElement){for(a.previewElement.classList.remove("dz-file-preview"),a.previewElement.classList.add("dz-image-preview"),f=a.previewElement.querySelectorAll("[data-dz-thumbnail]"),g=[],d=0,e=f.length;e>d;d++)c=f[d],c.alt=a.name,g.push(c.src=b);return g}},error:function(a,b){var c,d,e,f,g;if(a.previewElement){for(a.previewElement.classList.add("dz-error"),"String"!=typeof b&&b.error&&(b=b.error),f=a.previewElement.querySelectorAll("[data-dz-errormessage]"),g=[],d=0,e=f.length;e>d;d++)c=f[d],g.push(c.textContent=b);return g}},errormultiple:i,processing:function(a){return a.previewElement&&(a.previewElement.classList.add("dz-processing"),a._removeLink)?a._removeLink.textContent=this.options.dictCancelUpload:void 0},processingmultiple:i,uploadprogress:function(a,b,c){var d,e,f,g,h;if(a.previewElement){for(g=a.previewElement.querySelectorAll("[data-dz-uploadprogress]"),h=[],e=0,f=g.length;f>e;e++)d=g[e],h.push(d.style.width=""+b+"%");return h}},totaluploadprogress:i,sending:i,sendingmultiple:i,success:function(a){return a.previewElement?a.previewElement.classList.add("dz-success"):void 0},successmultiple:i,canceled:function(a){return this.emit("error",a,"Upload canceled.")},canceledmultiple:i,complete:function(a){return a._removeLink?a._removeLink.textContent=this.options.dictRemoveFile:void 0},completemultiple:i,maxfilesexceeded:i,maxfilesreached:i,previewTemplate:'<div class="dz-preview dz-file-preview">\n  <div class="dz-details">\n    <div class="dz-filename"><span data-dz-name></span></div>\n    <div class="dz-size" data-dz-size></div>\n    <img data-dz-thumbnail />\n  </div>\n  <div class="dz-progress"><span class="dz-upload" data-dz-uploadprogress></span></div>\n  <div class="dz-success-mark"><span></span></div>\n  <div class="dz-error-mark"><span></span></div>\n  <div class="dz-error-message"><span data-dz-errormessage></span></div>\n</div>'},c=function(){var a,b,c,d,e,f,g;for(d=arguments[0],c=2<=arguments.length?m.call(arguments,1):[],f=0,g=c.length;g>f;f++){b=c[f];for(a in b)e=b[a],d[a]=e}return d},b.prototype.getAcceptedFiles=function(){var a,b,c,d,e;for(d=this.files,e=[],b=0,c=d.length;c>b;b++)a=d[b],a.accepted&&e.push(a);return e},b.prototype.getRejectedFiles=function(){var a,b,c,d,e;for(d=this.files,e=[],b=0,c=d.length;c>b;b++)a=d[b],a.accepted||e.push(a);return e},b.prototype.getFilesWithStatus=function(a){var b,c,d,e,f;for(e=this.files,f=[],c=0,d=e.length;d>c;c++)b=e[c],b.status===a&&f.push(b);return f},b.prototype.getQueuedFiles=function(){return this.getFilesWithStatus(b.QUEUED)},b.prototype.getUploadingFiles=function(){return this.getFilesWithStatus(b.UPLOADING)},b.prototype.getActiveFiles=function(){var a,c,d,e,f;for(e=this.files,f=[],c=0,d=e.length;d>c;c++)a=e[c],a.status!==b.UPLOADING&&a.status!==b.QUEUED||f.push(a);return f},b.prototype.init=function(){var a,c,d,e,f,g,h;for("form"===this.element.tagName&&this.element.setAttribute("enctype","multipart/form-data"),this.element.classList.contains("dropzone")&&!this.element.querySelector(".dz-message")&&this.element.appendChild(b.createElement('<div class="dz-default dz-message"><span>'+this.options.dictDefaultMessage+"</span></div>")),this.clickableElements.length&&(d=function(a){return function(){return a.hiddenFileInput&&document.body.removeChild(a.hiddenFileInput),a.hiddenFileInput=document.createElement("input"),a.hiddenFileInput.setAttribute("type","file"),(null==a.options.maxFiles||a.options.maxFiles>1)&&a.hiddenFileInput.setAttribute("multiple","multiple"),a.hiddenFileInput.className="dz-hidden-input",null!=a.options.acceptedFiles&&a.hiddenFileInput.setAttribute("accept",a.options.acceptedFiles),a.hiddenFileInput.style.visibility="hidden",a.hiddenFileInput.style.position="absolute",a.hiddenFileInput.style.top="0",a.hiddenFileInput.style.left="0",a.hiddenFileInput.style.height="0",a.hiddenFileInput.style.width="0",document.body.appendChild(a.hiddenFileInput),a.hiddenFileInput.addEventListener("change",function(){var b,c,e,f;if(c=a.hiddenFileInput.files,c.length)for(e=0,f=c.length;f>e;e++)b=c[e],a.addFile(b);return d()})}}(this))(),this.URL=null!=(g=window.URL)?g:window.webkitURL,h=this.events,e=0,f=h.length;f>e;e++)a=h[e],this.on(a,this.options[a]);return this.on("uploadprogress",function(a){return function(){return a.updateTotalUploadProgress()}}(this)),this.on("removedfile",function(a){return function(){return a.updateTotalUploadProgress()}}(this)),this.on("canceled",function(a){return function(b){return a.emit("complete",b)}}(this)),this.on("complete",function(a){return function(b){return 0===a.getUploadingFiles().length&&0===a.getQueuedFiles().length?setTimeout(function(){return a.emit("queuecomplete")},0):void 0}}(this)),c=function(a){return a.stopPropagation(),a.preventDefault?a.preventDefault():a.returnValue=!1},this.listeners=[{element:this.element,events:{dragstart:function(a){return function(b){return a.emit("dragstart",b)}}(this),dragenter:function(a){return function(b){return c(b),a.emit("dragenter",b)}}(this),dragover:function(a){return function(b){var d;try{d=b.dataTransfer.effectAllowed}catch(e){}return b.dataTransfer.dropEffect="move"===d||"linkMove"===d?"move":"copy",c(b),a.emit("dragover",b)}}(this),dragleave:function(a){return function(b){return a.emit("dragleave",b)}}(this),drop:function(a){return function(b){return c(b),a.drop(b)}}(this),dragend:function(a){return function(b){return a.emit("dragend",b)}}(this)}}],this.clickableElements.forEach(function(a){return function(c){return a.listeners.push({element:c,events:{click:function(d){return c!==a.element||d.target===a.element||b.elementInside(d.target,a.element.querySelector(".dz-message"))?a.hiddenFileInput.click():void 0}}})}}(this)),this.enable(),this.options.init.call(this)},b.prototype.destroy=function(){var a;return this.disable(),this.removeAllFiles(!0),(null!=(a=this.hiddenFileInput)?a.parentNode:void 0)&&(this.hiddenFileInput.parentNode.removeChild(this.hiddenFileInput),this.hiddenFileInput=null),delete this.element.dropzone,b.instances.splice(b.instances.indexOf(this),1)},b.prototype.updateTotalUploadProgress=function(){var a,b,c,d,e,f,g,h;if(d=0,c=0,a=this.getActiveFiles(),a.length){for(h=this.getActiveFiles(),f=0,g=h.length;g>f;f++)b=h[f],d+=b.upload.bytesSent,c+=b.upload.total;e=100*d/c}else e=100;return this.emit("totaluploadprogress",e,c,d)},b.prototype._getParamName=function(a){return"function"==typeof this.options.paramName?this.options.paramName(a):""+this.options.paramName+(this.options.uploadMultiple?"["+a+"]":"")},b.prototype.getFallbackForm=function(){var a,c,d,e;return(a=this.getExistingFallback())?a:(d='<div class="dz-fallback">',this.options.dictFallbackText&&(d+="<p>"+this.options.dictFallbackText+"</p>"),d+='<input type="file" name="'+this._getParamName(0)+'" '+(this.options.uploadMultiple?'multiple="multiple"':void 0)+' /><input type="submit" value="Upload!"></div>',c=b.createElement(d),"FORM"!==this.element.tagName?(e=b.createElement('<form action="'+this.options.url+'" enctype="multipart/form-data" method="'+this.options.method+'"></form>'),e.appendChild(c)):(this.element.setAttribute("enctype","multipart/form-data"),this.element.setAttribute("method",this.options.method)),null!=e?e:c)},b.prototype.getExistingFallback=function(){var a,b,c,d,e,f;for(b=function(a){var b,c,d;for(c=0,d=a.length;d>c;c++)if(b=a[c],/(^| )fallback($| )/.test(b.className))return b},f=["div","form"],d=0,e=f.length;e>d;d++)if(c=f[d],a=b(this.element.getElementsByTagName(c)))return a},b.prototype.setupEventListeners=function(){var a,b,c,d,e,f,g;for(f=this.listeners,g=[],d=0,e=f.length;e>d;d++)a=f[d],g.push(function(){var d,e;d=a.events,e=[];for(b in d)c=d[b],e.push(a.element.addEventListener(b,c,!1));return e}());return g},b.prototype.removeEventListeners=function(){var a,b,c,d,e,f,g;for(f=this.listeners,g=[],d=0,e=f.length;e>d;d++)a=f[d],g.push(function(){var d,e;d=a.events,e=[];for(b in d)c=d[b],e.push(a.element.removeEventListener(b,c,!1));return e}());return g},b.prototype.disable=function(){var a,b,c,d,e;for(this.clickableElements.forEach(function(a){return a.classList.remove("dz-clickable")}),this.removeEventListeners(),d=this.files,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(this.cancelUpload(a));return e},b.prototype.enable=function(){return this.clickableElements.forEach(function(a){return a.classList.add("dz-clickable")}),this.setupEventListeners()},b.prototype.filesize=function(a){var b;return a>=109951162777.6?(a/=109951162777.6,b="TiB"):a>=107374182.4?(a/=107374182.4,b="GiB"):a>=104857.6?(a/=104857.6,b="MiB"):a>=102.4?(a/=102.4,b="KiB"):(a=10*a,b="b"),"<strong>"+Math.round(a)/10+"</strong> "+b},b.prototype._updateMaxFilesReachedClass=function(){return null!=this.options.maxFiles&&this.getAcceptedFiles().length>=this.options.maxFiles?(this.getAcceptedFiles().length===this.options.maxFiles&&this.emit("maxfilesreached",this.files),this.element.classList.add("dz-max-files-reached")):this.element.classList.remove("dz-max-files-reached")},b.prototype.drop=function(a){var b,c;a.dataTransfer&&(this.emit("drop",a),b=a.dataTransfer.files,b.length&&(c=a.dataTransfer.items,c&&c.length&&null!=c[0].webkitGetAsEntry?this._addFilesFromItems(c):this.handleFiles(b)))},b.prototype.paste=function(a){var b,c;if(null!=(null!=a&&null!=(c=a.clipboardData)?c.items:void 0))return this.emit("paste",a),b=a.clipboardData.items,b.length?this._addFilesFromItems(b):void 0},b.prototype.handleFiles=function(a){var b,c,d,e;for(e=[],c=0,d=a.length;d>c;c++)b=a[c],e.push(this.addFile(b));return e},b.prototype._addFilesFromItems=function(a){var b,c,d,e,f;for(f=[],d=0,e=a.length;e>d;d++)c=a[d],null!=c.webkitGetAsEntry&&(b=c.webkitGetAsEntry())?b.isFile?f.push(this.addFile(c.getAsFile())):b.isDirectory?f.push(this._addFilesFromDirectory(b,b.name)):f.push(void 0):null!=c.getAsFile&&(null==c.kind||"file"===c.kind)?f.push(this.addFile(c.getAsFile())):f.push(void 0);return f},b.prototype._addFilesFromDirectory=function(a,b){var c,d;return c=a.createReader(),d=function(a){return function(c){var d,e,f;for(e=0,f=c.length;f>e;e++)d=c[e],d.isFile?d.file(function(c){return a.options.ignoreHiddenFiles&&"."===c.name.substring(0,1)?void 0:(c.fullPath=""+b+"/"+c.name,a.addFile(c))}):d.isDirectory&&a._addFilesFromDirectory(d,""+b+"/"+d.name)}}(this),c.readEntries(d,function(a){return"undefined"!=typeof console&&null!==console&&"function"==typeof console.log?console.log(a):void 0})},b.prototype.accept=function(a,c){return a.size>1024*this.options.maxFilesize*1024?c(this.options.dictFileTooBig.replace("{{filesize}}",Math.round(a.size/1024/10.24)/100).replace("{{maxFilesize}}",this.options.maxFilesize)):b.isValidFile(a,this.options.acceptedFiles)?null!=this.options.maxFiles&&this.getAcceptedFiles().length>=this.options.maxFiles?(c(this.options.dictMaxFilesExceeded.replace("{{maxFiles}}",this.options.maxFiles)),this.emit("maxfilesexceeded",a)):this.options.accept.call(this,a,c):c(this.options.dictInvalidFileType)},b.prototype.addFile=function(a){return a.upload={progress:0,total:a.size,bytesSent:0},this.files.push(a),a.status=b.ADDED,this.emit("addedfile",a),this._enqueueThumbnail(a),this.accept(a,function(b){return function(c){return c?(a.accepted=!1,b._errorProcessing([a],c)):(a.accepted=!0,b.options.autoQueue&&b.enqueueFile(a)),b._updateMaxFilesReachedClass()}}(this))},b.prototype.enqueueFiles=function(a){var b,c,d;for(c=0,d=a.length;d>c;c++)b=a[c],this.enqueueFile(b);return null},b.prototype.enqueueFile=function(a){if(a.status!==b.ADDED||a.accepted!==!0)throw new Error("This file can't be queued because it has already been processed or was rejected.");return a.status=b.QUEUED,this.options.autoProcessQueue?setTimeout(function(a){return function(){return a.processQueue()}}(this),0):void 0},b.prototype._thumbnailQueue=[],b.prototype._processingThumbnail=!1,b.prototype._enqueueThumbnail=function(a){return this.options.createImageThumbnails&&a.type.match(/image.*/)&&a.size<=1024*this.options.maxThumbnailFilesize*1024?(this._thumbnailQueue.push(a),setTimeout(function(a){return function(){return a._processThumbnailQueue()}}(this),0)):void 0},b.prototype._processThumbnailQueue=function(){return this._processingThumbnail||0===this._thumbnailQueue.length?void 0:(this._processingThumbnail=!0,this.createThumbnail(this._thumbnailQueue.shift(),function(a){return function(){return a._processingThumbnail=!1,a._processThumbnailQueue()}}(this)))},b.prototype.removeFile=function(a){return a.status===b.UPLOADING&&this.cancelUpload(a),this.files=j(this.files,a),this.emit("removedfile",a),0===this.files.length?this.emit("reset"):void 0},b.prototype.removeAllFiles=function(a){var c,d,e,f;for(null==a&&(a=!1),f=this.files.slice(),d=0,e=f.length;e>d;d++)c=f[d],(c.status!==b.UPLOADING||a)&&this.removeFile(c);return null},b.prototype.createThumbnail=function(a,b){var c;return c=new FileReader,c.onload=function(d){return function(){var e;return e=document.createElement("img"),e.onload=function(){var c,f,g,i,j,k,l,m;return a.width=e.width,a.height=e.height,g=d.options.resize.call(d,a),null==g.trgWidth&&(g.trgWidth=g.optWidth),null==g.trgHeight&&(g.trgHeight=g.optHeight),c=document.createElement("canvas"),f=c.getContext("2d"),c.width=g.trgWidth,c.height=g.trgHeight,h(f,e,null!=(j=g.srcX)?j:0,null!=(k=g.srcY)?k:0,g.srcWidth,g.srcHeight,null!=(l=g.trgX)?l:0,null!=(m=g.trgY)?m:0,g.trgWidth,g.trgHeight),i=c.toDataURL("image/png"),d.emit("thumbnail",a,i),null!=b?b():void 0},e.src=c.result}}(this),c.readAsDataURL(a)},b.prototype.processQueue=function(){var a,b,c,d;if(b=this.options.parallelUploads,c=this.getUploadingFiles().length,a=c,!(c>=b)&&(d=this.getQueuedFiles(),d.length>0)){if(this.options.uploadMultiple)return this.processFiles(d.slice(0,b-c));for(;b>a;){if(!d.length)return;this.processFile(d.shift()),a++}}},b.prototype.processFile=function(a){return this.processFiles([a])},b.prototype.processFiles=function(a){var c,d,e;for(d=0,e=a.length;e>d;d++)c=a[d],c.processing=!0,c.status=b.UPLOADING,this.emit("processing",c);return this.options.uploadMultiple&&this.emit("processingmultiple",a),this.uploadFiles(a)},b.prototype._getFilesWithXhr=function(a){var b,c;return c=function(){var c,d,e,f;for(e=this.files,f=[],c=0,d=e.length;d>c;c++)b=e[c],b.xhr===a&&f.push(b);return f}.call(this)},b.prototype.cancelUpload=function(a){var c,d,e,f,g,h,i;if(a.status===b.UPLOADING){for(d=this._getFilesWithXhr(a.xhr),e=0,g=d.length;g>e;e++)c=d[e],c.status=b.CANCELED;for(a.xhr.abort(),f=0,h=d.length;h>f;f++)c=d[f],this.emit("canceled",c);this.options.uploadMultiple&&this.emit("canceledmultiple",d)}else(i=a.status)!==b.ADDED&&i!==b.QUEUED||(a.status=b.CANCELED,this.emit("canceled",a),this.options.uploadMultiple&&this.emit("canceledmultiple",[a]));return this.options.autoProcessQueue?this.processQueue():void 0},b.prototype.uploadFile=function(a){return this.uploadFiles([a])},b.prototype.uploadFiles=function(a){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I;for(t=new XMLHttpRequest,u=0,y=a.length;y>u;u++)d=a[u],d.xhr=t;t.open(this.options.method,this.options.url,!0),t.withCredentials=!!this.options.withCredentials,q=null,f=function(b){return function(){var c,e,f;for(f=[],c=0,e=a.length;e>c;c++)d=a[c],f.push(b._errorProcessing(a,q||b.options.dictResponseError.replace("{{statusCode}}",t.status),t));return f}}(this),r=function(b){return function(c){var e,f,g,h,i,j,k,l,m;if(null!=c)for(f=100*c.loaded/c.total,g=0,j=a.length;j>g;g++)d=a[g],d.upload={progress:f,total:c.total,bytesSent:c.loaded};else{for(e=!0,f=100,h=0,k=a.length;k>h;h++)d=a[h],100===d.upload.progress&&d.upload.bytesSent===d.upload.total||(e=!1),d.upload.progress=f,d.upload.bytesSent=d.upload.total;if(e)return}for(m=[],i=0,l=a.length;l>i;i++)d=a[i],m.push(b.emit("uploadprogress",d,f,d.upload.bytesSent));return m}}(this),t.onload=function(c){return function(d){var e;if(a[0].status!==b.CANCELED&&4===t.readyState){if(q=t.responseText,t.getResponseHeader("content-type")&&~t.getResponseHeader("content-type").indexOf("application/json"))try{q=JSON.parse(q)}catch(g){d=g,q="Invalid JSON response from server."}return r(),200<=(e=t.status)&&300>e?c._finished(a,q,d):f()}}}(this),t.onerror=function(c){return function(){return a[0].status!==b.CANCELED?f():void 0}}(this),p=null!=(D=t.upload)?D:t,p.onprogress=r,i={Accept:"application/json","Cache-Control":"no-cache","X-Requested-With":"XMLHttpRequest"},this.options.headers&&c(i,this.options.headers);for(g in i)h=i[g],t.setRequestHeader(g,h);if(e=new FormData,this.options.params){E=this.options.params;for(n in E)s=E[n],e.append(n,s)}for(v=0,z=a.length;z>v;v++)d=a[v],this.emit("sending",d,t,e);if(this.options.uploadMultiple&&this.emit("sendingmultiple",a,t,e),"FORM"===this.element.tagName)for(F=this.element.querySelectorAll("input, textarea, select, button"),w=0,A=F.length;A>w;w++)if(k=F[w],l=k.getAttribute("name"),m=k.getAttribute("type"),"SELECT"===k.tagName&&k.hasAttribute("multiple"))for(G=k.options,x=0,B=G.length;B>x;x++)o=G[x],o.selected&&e.append(l,o.value);else(!m||"checkbox"!==(H=m.toLowerCase())&&"radio"!==H||k.checked)&&e.append(l,k.value);for(j=C=0,I=a.length-1;I>=0?I>=C:C>=I;j=I>=0?++C:--C)e.append(this._getParamName(j),a[j],a[j].name);return t.send(e)},b.prototype._finished=function(a,c,d){var e,f,g;for(f=0,g=a.length;g>f;f++)e=a[f],e.status=b.SUCCESS,this.emit("success",e,c,d),this.emit("complete",e);return this.options.uploadMultiple&&(this.emit("successmultiple",a,c,d),this.emit("completemultiple",a)),this.options.autoProcessQueue?this.processQueue():void 0},b.prototype._errorProcessing=function(a,c,d){var e,f,g;for(f=0,g=a.length;g>f;f++)e=a[f],e.status=b.ERROR,this.emit("error",e,c,d),this.emit("complete",e);return this.options.uploadMultiple&&(this.emit("errormultiple",a,c,d),this.emit("completemultiple",a)),this.options.autoProcessQueue?this.processQueue():void 0},b}(d),b.version="3.10.2",b.options={},b.optionsForElement=function(a){return a.getAttribute("id")?b.options[e(a.getAttribute("id"))]:void 0},b.instances=[],b.forElement=function(a){if("string"==typeof a&&(a=document.querySelector(a)),null==(null!=a?a.dropzone:void 0))throw new Error("No Dropzone found for given element. This is probably because you're trying to access it before Dropzone had the time to initialize. Use the `init` option to setup any additional observers on your Dropzone.");return a.dropzone},b.autoDiscover=!0,b.discover=function(){var a,c,d,e,f,g;for(document.querySelectorAll?d=document.querySelectorAll(".dropzone"):(d=[],a=function(a){var b,c,e,f;for(f=[],c=0,e=a.length;e>c;c++)b=a[c],/(^| )dropzone($| )/.test(b.className)?f.push(d.push(b)):f.push(void 0);return f},a(document.getElementsByTagName("div")),a(document.getElementsByTagName("form"))),g=[],e=0,f=d.length;f>e;e++)c=d[e],b.optionsForElement(c)!==!1?g.push(new b(c)):g.push(void 0);return g},b.blacklistedBrowsers=[/opera.*Macintosh.*version\/12/i],b.isBrowserSupported=function(){var a,c,d,e,f;if(a=!0,window.File&&window.FileReader&&window.FileList&&window.Blob&&window.FormData&&document.querySelector)if("classList"in document.createElement("a"))for(f=b.blacklistedBrowsers,d=0,e=f.length;e>d;d++)c=f[d],c.test(navigator.userAgent)&&(a=!1);else a=!1;else a=!1;return a},j=function(a,b){var c,d,e,f;for(f=[],d=0,e=a.length;e>d;d++)c=a[d],c!==b&&f.push(c);return f},e=function(a){return a.replace(/[\-_](\w)/g,function(a){return a.charAt(1).toUpperCase()})},b.createElement=function(a){var b;return b=document.createElement("div"),b.innerHTML=a,b.childNodes[0]},b.elementInside=function(a,b){if(a===b)return!0;for(;a=a.parentNode;)if(a===b)return!0;return!1},b.getElement=function(a,b){var c;if("string"==typeof a?c=document.querySelector(a):null!=a.nodeType&&(c=a),null==c)throw new Error("Invalid `"+b+"` option provided. Please provide a CSS selector or a plain HTML element.");return c},b.getElements=function(a,b){var c,d,e,f,g,h,i,j;if(a instanceof Array){e=[];try{for(f=0,h=a.length;h>f;f++)d=a[f],e.push(this.getElement(d,b))}catch(k){c=k,e=null}}else if("string"==typeof a)for(e=[],j=document.querySelectorAll(a),g=0,i=j.length;i>g;g++)d=j[g],e.push(d);else null!=a.nodeType&&(e=[a]);if(null==e||!e.length)throw new Error("Invalid `"+b+"` option provided. Please provide a CSS selector, a plain HTML element or a list of those.");return e},b.confirm=function(a,b,c){return window.confirm(a)?b():null!=c?c():void 0},b.isValidFile=function(a,b){var c,d,e,f,g;if(!b)return!0;for(b=b.split(","),d=a.type,c=d.replace(/\/.*$/,""),f=0,g=b.length;g>f;f++)if(e=b[f],e=e.trim(),"."===e.charAt(0)){if(-1!==a.name.toLowerCase().indexOf(e.toLowerCase(),a.name.length-e.length))return!0}else if(/\/\*$/.test(e)){if(c===e.replace(/\/.*$/,""))return!0}else if(d===e)return!0;return!1},"undefined"!=typeof jQuery&&null!==jQuery&&(jQuery.fn.dropzone=function(a){return this.each(function(){return new b(this,a)})}),"undefined"!=typeof c&&null!==c?c.exports=b:window.Dropzone=b,b.ADDED="added",b.QUEUED="queued",b.ACCEPTED=b.QUEUED,b.UPLOADING="uploading",b.PROCESSING=b.UPLOADING,b.CANCELED="canceled",b.ERROR="error",b.SUCCESS="success",g=function(a){var b,c,d,e,f,g,h,i,j,k;for(h=a.naturalWidth,g=a.naturalHeight,c=document.createElement("canvas"),c.width=1,c.height=g,d=c.getContext("2d"),d.drawImage(a,0,0),e=d.getImageData(0,0,1,g).data,k=0,f=g,i=g;i>k;)b=e[4*(i-1)+3],0===b?f=i:k=i,i=f+k>>1;return j=i/g,0===j?1:j},h=function(a,b,c,d,e,f,h,i,j,k){var l;return l=g(b),a.drawImage(b,c,d,e,f,h,i,j,k/l)},f=function(a,b){var c,d,e,f,g,h,i,j,k;if(e=!1,k=!0,d=a.document,j=d.documentElement,c=d.addEventListener?"addEventListener":"attachEvent",i=d.addEventListener?"removeEventListener":"detachEvent",h=d.addEventListener?"":"on",f=function(c){return"readystatechange"!==c.type||"complete"===d.readyState?(("load"===c.type?a:d)[i](h+c.type,f,!1),!e&&(e=!0)?b.call(a,c.type||c):void 0):void 0},g=function(){var a;try{j.doScroll("left")}catch(b){return a=b,void setTimeout(g,50)}return f("poll")},"complete"!==d.readyState){if(d.createEventObject&&j.doScroll){try{k=!a.frameElement}catch(l){}k&&g()}return d[c](h+"DOMContentLoaded",f,!1),d[c](h+"readystatechange",f,!1),a[c](h+"load",f,!1)}},b._autoDiscoverFunction=function(){return b.autoDiscover?b.discover():void 0},f(window,b._autoDiscoverFunction)}).call(this)}),"object"==typeof exports?module.exports=a("dropzone"):"function"==typeof define&&define.amd?define([],function(){return a("dropzone")}):this.Dropzone=a("dropzone")}()(function(a){a.fn.hoverIntent=function(b,c,d){var e={interval:100,sensitivity:7,timeout:0};e="object"==typeof b?a.extend(e,b):a.isFunction(c)?a.extend(e,{over:b,out:c,selector:d}):a.extend(e,{over:b,out:b,selector:c});var f,g,h,i,j=function(a){f=a.pageX,g=a.pageY},k=function(b,c){return c.hoverIntent_t=clearTimeout(c.hoverIntent_t),Math.abs(h-f)+Math.abs(i-g)<e.sensitivity?(a(c).off("mousemove.hoverIntent",j),c.hoverIntent_s=1,e.over.apply(c,[b])):(h=f,i=g,c.hoverIntent_t=setTimeout(function(){k(b,c)},e.interval),void 0)},l=function(a,b){return b.hoverIntent_t=clearTimeout(b.hoverIntent_t),b.hoverIntent_s=0,e.out.apply(b,[a])},m=function(b){var c=jQuery.extend({},b),d=this;d.hoverIntent_t&&(d.hoverIntent_t=clearTimeout(d.hoverIntent_t)),"mouseenter"==b.type?(h=c.pageX,i=c.pageY,a(d).on("mousemove.hoverIntent",j),1!=d.hoverIntent_s&&(d.hoverIntent_t=setTimeout(function(){k(c,d)},e.interval))):(a(d).off("mousemove.hoverIntent",j),1==d.hoverIntent_s&&(d.hoverIntent_t=setTimeout(function(){l(c,d)},e.timeout)))};return this.on({"mouseenter.hoverIntent":m,"mouseleave.hoverIntent":m},e.selector)}})(jQuery),THREE.TrackballControls=function(a,b){
function c(a){l.enabled!==!1&&(window.removeEventListener("keydown",c),p=o,o===m.NONE&&(a.keyCode!==l.keys[m.ROTATE]||l.noRotate?a.keyCode!==l.keys[m.ZOOM]||l.noZoom?a.keyCode!==l.keys[m.PAN]||l.noPan||(o=m.PAN):o=m.ZOOM:o=m.ROTATE))}function d(a){l.enabled!==!1&&(o=p,window.addEventListener("keydown",c,!1))}function e(a){l.enabled!==!1&&(a.preventDefault(),a.stopPropagation(),o===m.NONE&&(o=a.button),o!==m.ROTATE||l.noRotate?o!==m.ZOOM||l.noZoom?o!==m.PAN||l.noPan||(l.getMouseOnScreen(a.pageX,a.pageY,x),y.copy(x)):(l.getMouseOnScreen(a.pageX,a.pageY,t),u.copy(t)):(l.getMouseProjectionOnBall(a.pageX,a.pageY,r),s.copy(r)),document.addEventListener("mousemove",f,!1),document.addEventListener("mouseup",g,!1),l.dispatchEvent(A))}function f(a){l.enabled!==!1&&(a.preventDefault(),a.stopPropagation(),o!==m.ROTATE||l.noRotate?o!==m.ZOOM||l.noZoom?o!==m.PAN||l.noPan||l.getMouseOnScreen(a.pageX,a.pageY,y):l.getMouseOnScreen(a.pageX,a.pageY,u):l.getMouseProjectionOnBall(a.pageX,a.pageY,s))}function g(a){l.enabled!==!1&&(a.preventDefault(),a.stopPropagation(),o=m.NONE,document.removeEventListener("mousemove",f),document.removeEventListener("mouseup",g),l.dispatchEvent(B))}function h(a){if(l.enabled!==!1){a.preventDefault(),a.stopPropagation();var b=0;a.wheelDelta?b=a.wheelDelta/40:a.detail&&(b=-a.detail/3),t.y+=.01*b,l.dispatchEvent(A),l.dispatchEvent(B)}}function i(a){if(l.enabled!==!1){switch(a.touches.length){case 1:o=m.TOUCH_ROTATE,s.copy(l.getMouseProjectionOnBall(a.touches[0].pageX,a.touches[0].pageY,r));break;case 2:o=m.TOUCH_ZOOM;var b=a.touches[0].pageX-a.touches[1].pageX,c=a.touches[0].pageY-a.touches[1].pageY;w=v=Math.sqrt(b*b+c*c);break;case 3:o=m.TOUCH_PAN,y.copy(l.getMouseOnScreen(a.touches[0].pageX,a.touches[0].pageY,x));break;default:o=m.NONE}l.dispatchEvent(A)}}function j(a){if(l.enabled!==!1)switch(a.preventDefault(),a.stopPropagation(),a.touches.length){case 1:l.getMouseProjectionOnBall(a.touches[0].pageX,a.touches[0].pageY,s);break;case 2:var b=a.touches[0].pageX-a.touches[1].pageX,c=a.touches[0].pageY-a.touches[1].pageY;w=Math.sqrt(b*b+c*c);break;case 3:l.getMouseOnScreen(a.touches[0].pageX,a.touches[0].pageY,y);break;default:o=m.NONE}}function k(a){if(l.enabled!==!1){switch(a.touches.length){case 1:r.copy(l.getMouseProjectionOnBall(a.touches[0].pageX,a.touches[0].pageY,s));break;case 2:v=w=0;break;case 3:x.copy(l.getMouseOnScreen(a.touches[0].pageX,a.touches[0].pageY,y))}o=m.NONE,l.dispatchEvent(B)}}var l=this,m={NONE:-1,ROTATE:0,ZOOM:2,PAN:1,TOUCH_ROTATE:3,TOUCH_ZOOM:4,TOUCH_PAN:5};this.object=a,this.domElement=void 0!==b?b:document,this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.noRoll=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.keys=[18,17,16],this.target=new THREE.Vector3;var n=new THREE.Vector3,o=m.NONE,p=m.NONE,q=new THREE.Vector3,r=new THREE.Vector3,s=new THREE.Vector3,t=new THREE.Vector2,u=new THREE.Vector2,v=0,w=0,x=new THREE.Vector2,y=new THREE.Vector2;this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone();var z={type:"change"},A={type:"start"},B={type:"end"};this.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{this.screen=this.domElement.getBoundingClientRect();var a=this.domElement.ownerDocument.documentElement;this.screen.left+=window.pageXOffset-a.clientLeft,this.screen.top+=window.pageYOffset-a.clientTop}},this.handleEvent=function(a){"function"==typeof this[a.type]&&this[a.type](a)},this.getMouseOnScreen=function(a,b,c){return c.set((a-l.screen.left)/l.screen.width,(b-l.screen.top)/l.screen.height)},this.getMouseProjectionOnBall=function(){var a=new THREE.Vector3,b=new THREE.Vector3;return function(c,d,e){b.set((c-.5*l.screen.width-l.screen.left)/(.5*l.screen.width),(.5*l.screen.height+l.screen.top-d)/(.5*l.screen.height),0);var f=b.length();return l.noRoll?f<Math.SQRT1_2?b.z=Math.sqrt(1-f*f):b.z=.5/f:f>1?b.normalize():b.z=Math.sqrt(1-f*f),q.copy(l.object.position).sub(l.target),e.copy(l.object.up).setLength(b.y),e.add(a.copy(l.object.up).cross(q).setLength(b.x)),e.add(q.setLength(b.z)),e}}(),this.rotateCamera=function(){var a=new THREE.Vector3,b=new THREE.Quaternion;return function(){var c=Math.acos(r.dot(s)/r.length()/s.length());c&&(a.crossVectors(r,s).normalize(),c*=l.rotateSpeed,b.setFromAxisAngle(a,-c),q.applyQuaternion(b),l.object.up.applyQuaternion(b),s.applyQuaternion(b),l.staticMoving?r.copy(s):(b.setFromAxisAngle(a,c*(l.dynamicDampingFactor-1)),r.applyQuaternion(b)))}}(),this.zoomCamera=function(){if(o===m.TOUCH_ZOOM){var a=v/w;v=w,q.multiplyScalar(a)}else{var a=1+(u.y-t.y)*l.zoomSpeed;1!==a&&a>0&&(q.multiplyScalar(a),l.staticMoving?t.copy(u):t.y+=(u.y-t.y)*this.dynamicDampingFactor)}},this.panCamera=function(){var a=new THREE.Vector2,b=new THREE.Vector3,c=new THREE.Vector3;return function(){a.copy(y).sub(x),a.lengthSq()&&(a.multiplyScalar(q.length()*l.panSpeed),c.copy(q).cross(l.object.up).setLength(a.x),c.add(b.copy(l.object.up).setLength(a.y)),l.object.position.add(c),l.target.add(c),l.staticMoving?x.copy(y):x.add(a.subVectors(y,x).multiplyScalar(l.dynamicDampingFactor)))}}(),this.checkDistances=function(){l.noZoom&&l.noPan||(q.lengthSq()>l.maxDistance*l.maxDistance&&l.object.position.addVectors(l.target,q.setLength(l.maxDistance)),q.lengthSq()<l.minDistance*l.minDistance&&l.object.position.addVectors(l.target,q.setLength(l.minDistance)))},this.update=function(){q.subVectors(l.object.position,l.target),l.noRotate||l.rotateCamera(),l.noZoom||l.zoomCamera(),l.noPan||l.panCamera(),l.object.position.addVectors(l.target,q),l.checkDistances(),l.object.lookAt(l.target),n.distanceToSquared(l.object.position)>0&&(l.dispatchEvent(z),n.copy(l.object.position))},this.reset=function(){o=m.NONE,p=m.NONE,l.target.copy(l.target0),l.object.position.copy(l.position0),l.object.up.copy(l.up0),q.subVectors(l.object.position,l.target),l.object.lookAt(l.target),l.dispatchEvent(z),n.copy(l.object.position)},this.domElement.addEventListener("contextmenu",function(a){a.preventDefault()},!1),this.domElement.addEventListener("mousedown",e,!1),this.domElement.addEventListener("mousewheel",h,!1),this.domElement.addEventListener("DOMMouseScroll",h,!1),this.domElement.addEventListener("touchstart",i,!1),this.domElement.addEventListener("touchend",k,!1),this.domElement.addEventListener("touchmove",j,!1),window.addEventListener("keydown",c,!1),window.addEventListener("keyup",d,!1),this.handleResize()},THREE.TrackballControls.prototype=Object.create(THREE.EventDispatcher.prototype);var THREE={REVISION:"67"};self.console=self.console||{info:function(){},log:function(){},debug:function(){},warn:function(){},error:function(){}},function(){for(var a=0,b=["ms","moz","webkit","o"],c=0;c<b.length&&!self.requestAnimationFrame;++c)self.requestAnimationFrame=self[b[c]+"RequestAnimationFrame"],self.cancelAnimationFrame=self[b[c]+"CancelAnimationFrame"]||self[b[c]+"CancelRequestAnimationFrame"];void 0===self.requestAnimationFrame&&void 0!==self.setTimeout&&(self.requestAnimationFrame=function(b){var c=Date.now(),d=Math.max(0,16-(c-a)),e=self.setTimeout(function(){b(c+d)},d);return a=c+d,e}),void 0===self.cancelAnimationFrame&&void 0!==self.clearTimeout&&(self.cancelAnimationFrame=function(a){self.clearTimeout(a)})}(),THREE.CullFaceNone=0,THREE.CullFaceBack=1,THREE.CullFaceFront=2,THREE.CullFaceFrontBack=3,THREE.FrontFaceDirectionCW=0,THREE.FrontFaceDirectionCCW=1,THREE.BasicShadowMap=0,THREE.PCFShadowMap=1,THREE.PCFSoftShadowMap=2,THREE.FrontSide=0,THREE.BackSide=1,THREE.DoubleSide=2,THREE.NoShading=0,THREE.FlatShading=1,THREE.SmoothShading=2,THREE.NoColors=0,THREE.FaceColors=1,THREE.VertexColors=2,THREE.NoBlending=0,THREE.NormalBlending=1,THREE.AdditiveBlending=2,THREE.SubtractiveBlending=3,THREE.MultiplyBlending=4,THREE.CustomBlending=5,THREE.AddEquation=100,THREE.SubtractEquation=101,THREE.ReverseSubtractEquation=102,THREE.ZeroFactor=200,THREE.OneFactor=201,THREE.SrcColorFactor=202,THREE.OneMinusSrcColorFactor=203,THREE.SrcAlphaFactor=204,THREE.OneMinusSrcAlphaFactor=205,THREE.DstAlphaFactor=206,THREE.OneMinusDstAlphaFactor=207,THREE.DstColorFactor=208,THREE.OneMinusDstColorFactor=209,THREE.SrcAlphaSaturateFactor=210,THREE.MultiplyOperation=0,THREE.MixOperation=1,THREE.AddOperation=2,THREE.UVMapping=function(){},THREE.CubeReflectionMapping=function(){},THREE.CubeRefractionMapping=function(){},THREE.SphericalReflectionMapping=function(){},THREE.SphericalRefractionMapping=function(){},THREE.RepeatWrapping=1e3,THREE.ClampToEdgeWrapping=1001,THREE.MirroredRepeatWrapping=1002,THREE.NearestFilter=1003,THREE.NearestMipMapNearestFilter=1004,THREE.NearestMipMapLinearFilter=1005,THREE.LinearFilter=1006,THREE.LinearMipMapNearestFilter=1007,THREE.LinearMipMapLinearFilter=1008,THREE.UnsignedByteType=1009,THREE.ByteType=1010,THREE.ShortType=1011,THREE.UnsignedShortType=1012,THREE.IntType=1013,THREE.UnsignedIntType=1014,THREE.FloatType=1015,THREE.UnsignedShort4444Type=1016,THREE.UnsignedShort5551Type=1017,THREE.UnsignedShort565Type=1018,THREE.AlphaFormat=1019,THREE.RGBFormat=1020,THREE.RGBAFormat=1021,THREE.LuminanceFormat=1022,THREE.LuminanceAlphaFormat=1023,THREE.RGB_S3TC_DXT1_Format=2001,THREE.RGBA_S3TC_DXT1_Format=2002,THREE.RGBA_S3TC_DXT3_Format=2003,THREE.RGBA_S3TC_DXT5_Format=2004,THREE.Color=function(a){return 3===arguments.length?this.setRGB(arguments[0],arguments[1],arguments[2]):this.set(a)},THREE.Color.prototype={constructor:THREE.Color,r:1,g:1,b:1,set:function(a){return a instanceof THREE.Color?this.copy(a):"number"==typeof a?this.setHex(a):"string"==typeof a&&this.setStyle(a),this},setHex:function(a){return a=Math.floor(a),this.r=(a>>16&255)/255,this.g=(a>>8&255)/255,this.b=(255&a)/255,this},setRGB:function(a,b,c){return this.r=a,this.g=b,this.b=c,this},setHSL:function(a,b,c){if(0===b)this.r=this.g=this.b=c;else{var d=function(a,b,c){return 0>c&&(c+=1),c>1&&(c-=1),1/6>c?a+6*(b-a)*c:.5>c?b:2/3>c?a+6*(b-a)*(2/3-c):a};b=.5>=c?c*(1+b):c+b-c*b,c=2*c-b,this.r=d(c,b,a+1/3),this.g=d(c,b,a),this.b=d(c,b,a-1/3)}return this},setStyle:function(a){return/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.test(a)?(a=/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.exec(a),this.r=Math.min(255,parseInt(a[1],10))/255,this.g=Math.min(255,parseInt(a[2],10))/255,this.b=Math.min(255,parseInt(a[3],10))/255,this):/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.test(a)?(a=/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.exec(a),this.r=Math.min(100,parseInt(a[1],10))/100,this.g=Math.min(100,parseInt(a[2],10))/100,this.b=Math.min(100,parseInt(a[3],10))/100,this):/^\#([0-9a-f]{6})$/i.test(a)?(a=/^\#([0-9a-f]{6})$/i.exec(a),this.setHex(parseInt(a[1],16)),this):/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.test(a)?(a=/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(a),this.setHex(parseInt(a[1]+a[1]+a[2]+a[2]+a[3]+a[3],16)),this):/^(\w+)$/i.test(a)?(this.setHex(THREE.ColorKeywords[a]),this):void 0},copy:function(a){return this.r=a.r,this.g=a.g,this.b=a.b,this},copyGammaToLinear:function(a){return this.r=a.r*a.r,this.g=a.g*a.g,this.b=a.b*a.b,this},copyLinearToGamma:function(a){return this.r=Math.sqrt(a.r),this.g=Math.sqrt(a.g),this.b=Math.sqrt(a.b),this},convertGammaToLinear:function(){var a=this.r,b=this.g,c=this.b;return this.r=a*a,this.g=b*b,this.b=c*c,this},convertLinearToGamma:function(){return this.r=Math.sqrt(this.r),this.g=Math.sqrt(this.g),this.b=Math.sqrt(this.b),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(a){a=a||{h:0,s:0,l:0};var b,c=this.r,d=this.g,e=this.b,f=Math.max(c,d,e),g=Math.min(c,d,e),h=(g+f)/2;if(g===f)g=b=0;else{var i=f-g,g=.5>=h?i/(f+g):i/(2-f-g);switch(f){case c:b=(d-e)/i+(e>d?6:0);break;case d:b=(e-c)/i+2;break;case e:b=(c-d)/i+4}b/=6}return a.h=b,a.s=g,a.l=h,a},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(a,b,c){var d=this.getHSL();return d.h+=a,d.s+=b,d.l+=c,this.setHSL(d.h,d.s,d.l),this},add:function(a){return this.r+=a.r,this.g+=a.g,this.b+=a.b,this},addColors:function(a,b){return this.r=a.r+b.r,this.g=a.g+b.g,this.b=a.b+b.b,this},addScalar:function(a){return this.r+=a,this.g+=a,this.b+=a,this},multiply:function(a){return this.r*=a.r,this.g*=a.g,this.b*=a.b,this},multiplyScalar:function(a){return this.r*=a,this.g*=a,this.b*=a,this},lerp:function(a,b){return this.r+=(a.r-this.r)*b,this.g+=(a.g-this.g)*b,this.b+=(a.b-this.b)*b,this},equals:function(a){return a.r===this.r&&a.g===this.g&&a.b===this.b},fromArray:function(a){return this.r=a[0],this.g=a[1],this.b=a[2],this},toArray:function(){return[this.r,this.g,this.b]},clone:function(){return(new THREE.Color).setRGB(this.r,this.g,this.b)}},THREE.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},THREE.Quaternion=function(a,b,c,d){this._x=a||0,this._y=b||0,this._z=c||0,this._w=void 0!==d?d:1},THREE.Quaternion.prototype={constructor:THREE.Quaternion,_x:0,_y:0,_z:0,_w:0,get x(){return this._x},set x(a){this._x=a,this.onChangeCallback()},get y(){return this._y},set y(a){this._y=a,this.onChangeCallback()},get z(){return this._z},set z(a){this._z=a,this.onChangeCallback()},get w(){return this._w},set w(a){this._w=a,this.onChangeCallback()},set:function(a,b,c,d){return this._x=a,this._y=b,this._z=c,this._w=d,this.onChangeCallback(),this},copy:function(a){return this._x=a._x,this._y=a._y,this._z=a._z,this._w=a._w,this.onChangeCallback(),this},setFromEuler:function(a,b){if(!1==a instanceof THREE.Euler)throw Error("ERROR: Quaternion's .setFromEuler() now expects a Euler rotation rather than a Vector3 and order.  Please update your code.");var c=Math.cos(a._x/2),d=Math.cos(a._y/2),e=Math.cos(a._z/2),f=Math.sin(a._x/2),g=Math.sin(a._y/2),h=Math.sin(a._z/2);return"XYZ"===a.order?(this._x=f*d*e+c*g*h,this._y=c*g*e-f*d*h,this._z=c*d*h+f*g*e,this._w=c*d*e-f*g*h):"YXZ"===a.order?(this._x=f*d*e+c*g*h,this._y=c*g*e-f*d*h,this._z=c*d*h-f*g*e,this._w=c*d*e+f*g*h):"ZXY"===a.order?(this._x=f*d*e-c*g*h,this._y=c*g*e+f*d*h,this._z=c*d*h+f*g*e,this._w=c*d*e-f*g*h):"ZYX"===a.order?(this._x=f*d*e-c*g*h,this._y=c*g*e+f*d*h,this._z=c*d*h-f*g*e,this._w=c*d*e+f*g*h):"YZX"===a.order?(this._x=f*d*e+c*g*h,this._y=c*g*e+f*d*h,this._z=c*d*h-f*g*e,this._w=c*d*e-f*g*h):"XZY"===a.order&&(this._x=f*d*e-c*g*h,this._y=c*g*e-f*d*h,this._z=c*d*h+f*g*e,this._w=c*d*e+f*g*h),!1!==b&&this.onChangeCallback(),this},setFromAxisAngle:function(a,b){var c=b/2,d=Math.sin(c);return this._x=a.x*d,this._y=a.y*d,this._z=a.z*d,this._w=Math.cos(c),this.onChangeCallback(),this},setFromRotationMatrix:function(a){var b=a.elements,c=b[0];a=b[4];var d=b[8],e=b[1],f=b[5],g=b[9],h=b[2],i=b[6],b=b[10],j=c+f+b;return j>0?(c=.5/Math.sqrt(j+1),this._w=.25/c,this._x=(i-g)*c,this._y=(d-h)*c,this._z=(e-a)*c):c>f&&c>b?(c=2*Math.sqrt(1+c-f-b),this._w=(i-g)/c,this._x=.25*c,this._y=(a+e)/c,this._z=(d+h)/c):f>b?(c=2*Math.sqrt(1+f-c-b),this._w=(d-h)/c,this._x=(a+e)/c,this._y=.25*c,this._z=(g+i)/c):(c=2*Math.sqrt(1+b-c-f),this._w=(e-a)/c,this._x=(d+h)/c,this._y=(g+i)/c,this._z=.25*c),this.onChangeCallback(),this},setFromUnitVectors:function(){var a,b;return function(c,d){return void 0===a&&(a=new THREE.Vector3),b=c.dot(d)+1,1e-6>b?(b=0,Math.abs(c.x)>Math.abs(c.z)?a.set(-c.y,c.x,0):a.set(0,-c.z,c.y)):a.crossVectors(c,d),this._x=a.x,this._y=a.y,this._z=a.z,this._w=b,this.normalize(),this}}(),inverse:function(){return this.conjugate().normalize(),this},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var a=this.length();return 0===a?(this._z=this._y=this._x=0,this._w=1):(a=1/a,this._x*=a,this._y*=a,this._z*=a,this._w*=a),this.onChangeCallback(),this},multiply:function(a,b){return void 0!==b?(console.warn("DEPRECATED: Quaternion's .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(a,b)):this.multiplyQuaternions(this,a)},multiplyQuaternions:function(a,b){var c=a._x,d=a._y,e=a._z,f=a._w,g=b._x,h=b._y,i=b._z,j=b._w;return this._x=c*j+f*g+d*i-e*h,this._y=d*j+f*h+e*g-c*i,this._z=e*j+f*i+c*h-d*g,this._w=f*j-c*g-d*h-e*i,this.onChangeCallback(),this},multiplyVector3:function(a){return console.warn("DEPRECATED: Quaternion's .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),a.applyQuaternion(this)},slerp:function(a,b){var c=this._x,d=this._y,e=this._z,f=this._w,g=f*a._w+c*a._x+d*a._y+e*a._z;if(0>g?(this._w=-a._w,this._x=-a._x,this._y=-a._y,this._z=-a._z,g=-g):this.copy(a),g>=1)return this._w=f,this._x=c,this._y=d,this._z=e,this;var h=Math.acos(g),i=Math.sqrt(1-g*g);return.001>Math.abs(i)?(this._w=.5*(f+this._w),this._x=.5*(c+this._x),this._y=.5*(d+this._y),this._z=.5*(e+this._z),this):(g=Math.sin((1-b)*h)/i,h=Math.sin(b*h)/i,this._w=f*g+this._w*h,this._x=c*g+this._x*h,this._y=d*g+this._y*h,this._z=e*g+this._z*h,this.onChangeCallback(),this)},equals:function(a){return a._x===this._x&&a._y===this._y&&a._z===this._z&&a._w===this._w},fromArray:function(a){return this._x=a[0],this._y=a[1],this._z=a[2],this._w=a[3],this.onChangeCallback(),this},toArray:function(){return[this._x,this._y,this._z,this._w]},onChange:function(a){return this.onChangeCallback=a,this},onChangeCallback:function(){},clone:function(){return new THREE.Quaternion(this._x,this._y,this._z,this._w)}},THREE.Quaternion.slerp=function(a,b,c,d){return c.copy(a).slerp(b,d)},THREE.Vector2=function(a,b){this.x=a||0,this.y=b||0},THREE.Vector2.prototype={constructor:THREE.Vector2,set:function(a,b){return this.x=a,this.y=b,this},setX:function(a){return this.x=a,this},setY:function(a){return this.y=a,this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;default:throw Error("index is out of range: "+a)}},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;default:throw Error("index is out of range: "+a)}},copy:function(a){return this.x=a.x,this.y=a.y,this},add:function(a,b){return void 0!==b?(console.warn("DEPRECATED: Vector2's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(a,b)):(this.x+=a.x,this.y+=a.y,this)},addVectors:function(a,b){return this.x=a.x+b.x,this.y=a.y+b.y,this},addScalar:function(a){return this.x+=a,this.y+=a,this},sub:function(a,b){return void 0!==b?(console.warn("DEPRECATED: Vector2's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(a,b)):(this.x-=a.x,this.y-=a.y,this)},subVectors:function(a,b){return this.x=a.x-b.x,this.y=a.y-b.y,this},multiply:function(a){return this.x*=a.x,this.y*=a.y,this},multiplyScalar:function(a){return this.x*=a,this.y*=a,this},divide:function(a){return this.x/=a.x,this.y/=a.y,this},divideScalar:function(a){return 0!==a?(a=1/a,this.x*=a,this.y*=a):this.y=this.x=0,this},min:function(a){return this.x>a.x&&(this.x=a.x),this.y>a.y&&(this.y=a.y),this},max:function(a){return this.x<a.x&&(this.x=a.x),this.y<a.y&&(this.y=a.y),this},clamp:function(a,b){return this.x<a.x?this.x=a.x:this.x>b.x&&(this.x=b.x),this.y<a.y?this.y=a.y:this.y>b.y&&(this.y=b.y),this},clampScalar:function(){var a,b;return function(c,d){return void 0===a&&(a=new THREE.Vector2,b=new THREE.Vector2),a.set(c,c),b.set(d,d),this.clamp(a,b)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x),this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.multiplyScalar(-1)},dot:function(a){return this.x*a.x+this.y*a.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){var b=this.x-a.x;return a=this.y-a.y,b*b+a*a},setLength:function(a){var b=this.length();return 0!==b&&a!==b&&this.multiplyScalar(a/b),this},lerp:function(a,b){return this.x+=(a.x-this.x)*b,this.y+=(a.y-this.y)*b,this},equals:function(a){return a.x===this.x&&a.y===this.y},fromArray:function(a){return this.x=a[0],this.y=a[1],this},toArray:function(){return[this.x,this.y]},clone:function(){return new THREE.Vector2(this.x,this.y)}},THREE.Vector3=function(a,b,c){this.x=a||0,this.y=b||0,this.z=c||0},THREE.Vector3.prototype={constructor:THREE.Vector3,set:function(a,b,c){return this.x=a,this.y=b,this.z=c,this},setX:function(a){return this.x=a,this},setY:function(a){return this.y=a,this},setZ:function(a){return this.z=a,this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;case 2:this.z=b;break;default:throw Error("index is out of range: "+a)}},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw Error("index is out of range: "+a)}},copy:function(a){return this.x=a.x,this.y=a.y,this.z=a.z,this},add:function(a,b){return void 0!==b?(console.warn("DEPRECATED: Vector3's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(a,b)):(this.x+=a.x,this.y+=a.y,this.z+=a.z,this)},addScalar:function(a){return this.x+=a,this.y+=a,this.z+=a,this},addVectors:function(a,b){return this.x=a.x+b.x,this.y=a.y+b.y,this.z=a.z+b.z,this},sub:function(a,b){return void 0!==b?(console.warn("DEPRECATED: Vector3's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(a,b)):(this.x-=a.x,this.y-=a.y,this.z-=a.z,this)},subVectors:function(a,b){return this.x=a.x-b.x,this.y=a.y-b.y,this.z=a.z-b.z,this},multiply:function(a,b){return void 0!==b?(console.warn("DEPRECATED: Vector3's .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(a,b)):(this.x*=a.x,this.y*=a.y,this.z*=a.z,this)},multiplyScalar:function(a){return this.x*=a,this.y*=a,this.z*=a,this},multiplyVectors:function(a,b){return this.x=a.x*b.x,this.y=a.y*b.y,this.z=a.z*b.z,this},applyEuler:function(){var a;return function(b){return!1==b instanceof THREE.Euler&&console.error("ERROR: Vector3's .applyEuler() now expects a Euler rotation rather than a Vector3 and order.  Please update your code."),void 0===a&&(a=new THREE.Quaternion),this.applyQuaternion(a.setFromEuler(b)),this}}(),applyAxisAngle:function(){var a;return function(b,c){return void 0===a&&(a=new THREE.Quaternion),this.applyQuaternion(a.setFromAxisAngle(b,c)),this}}(),applyMatrix3:function(a){var b=this.x,c=this.y,d=this.z;return a=a.elements,this.x=a[0]*b+a[3]*c+a[6]*d,this.y=a[1]*b+a[4]*c+a[7]*d,this.z=a[2]*b+a[5]*c+a[8]*d,this},applyMatrix4:function(a){var b=this.x,c=this.y,d=this.z;return a=a.elements,this.x=a[0]*b+a[4]*c+a[8]*d+a[12],this.y=a[1]*b+a[5]*c+a[9]*d+a[13],this.z=a[2]*b+a[6]*c+a[10]*d+a[14],this},applyProjection:function(a){var b=this.x,c=this.y,d=this.z;a=a.elements;var e=1/(a[3]*b+a[7]*c+a[11]*d+a[15]);return this.x=(a[0]*b+a[4]*c+a[8]*d+a[12])*e,this.y=(a[1]*b+a[5]*c+a[9]*d+a[13])*e,this.z=(a[2]*b+a[6]*c+a[10]*d+a[14])*e,this},applyQuaternion:function(a){var b=this.x,c=this.y,d=this.z,e=a.x,f=a.y,g=a.z;a=a.w;var h=a*b+f*d-g*c,i=a*c+g*b-e*d,j=a*d+e*c-f*b,b=-e*b-f*c-g*d;return this.x=h*a+b*-e+i*-g-j*-f,this.y=i*a+b*-f+j*-e-h*-g,this.z=j*a+b*-g+h*-f-i*-e,this},transformDirection:function(a){var b=this.x,c=this.y,d=this.z;return a=a.elements,this.x=a[0]*b+a[4]*c+a[8]*d,this.y=a[1]*b+a[5]*c+a[9]*d,this.z=a[2]*b+a[6]*c+a[10]*d,this.normalize(),this},divide:function(a){return this.x/=a.x,this.y/=a.y,this.z/=a.z,this},divideScalar:function(a){return 0!==a?(a=1/a,this.x*=a,this.y*=a,this.z*=a):this.z=this.y=this.x=0,this},min:function(a){return this.x>a.x&&(this.x=a.x),this.y>a.y&&(this.y=a.y),this.z>a.z&&(this.z=a.z),this},max:function(a){return this.x<a.x&&(this.x=a.x),this.y<a.y&&(this.y=a.y),this.z<a.z&&(this.z=a.z),this},clamp:function(a,b){return this.x<a.x?this.x=a.x:this.x>b.x&&(this.x=b.x),this.y<a.y?this.y=a.y:this.y>b.y&&(this.y=b.y),this.z<a.z?this.z=a.z:this.z>b.z&&(this.z=b.z),this},clampScalar:function(){var a,b;return function(c,d){return void 0===a&&(a=new THREE.Vector3,b=new THREE.Vector3),a.set(c,c,c),b.set(d,d,d),this.clamp(a,b)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x),this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y),this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.multiplyScalar(-1)},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(a){var b=this.length();return 0!==b&&a!==b&&this.multiplyScalar(a/b),this},lerp:function(a,b){return this.x+=(a.x-this.x)*b,this.y+=(a.y-this.y)*b,this.z+=(a.z-this.z)*b,this},cross:function(a,b){if(void 0!==b)return console.warn("DEPRECATED: Vector3's .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(a,b);var c=this.x,d=this.y,e=this.z;return this.x=d*a.z-e*a.y,this.y=e*a.x-c*a.z,this.z=c*a.y-d*a.x,this},crossVectors:function(a,b){var c=a.x,d=a.y,e=a.z,f=b.x,g=b.y,h=b.z;return this.x=d*h-e*g,this.y=e*f-c*h,this.z=c*g-d*f,this},projectOnVector:function(){var a,b;return function(c){return void 0===a&&(a=new THREE.Vector3),a.copy(c).normalize(),b=this.dot(a),this.copy(a).multiplyScalar(b)}}(),projectOnPlane:function(){var a;return function(b){return void 0===a&&(a=new THREE.Vector3),a.copy(this).projectOnVector(b),this.sub(a)}}(),reflect:function(){var a;return function(b){return void 0===a&&(a=new THREE.Vector3),this.sub(a.copy(b).multiplyScalar(2*this.dot(b)))}}(),angleTo:function(a){return a=this.dot(a)/(this.length()*a.length()),Math.acos(THREE.Math.clamp(a,-1,1))},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){var b=this.x-a.x,c=this.y-a.y;return a=this.z-a.z,b*b+c*c+a*a},setEulerFromRotationMatrix:function(a,b){console.error("REMOVED: Vector3's setEulerFromRotationMatrix has been removed in favor of Euler.setFromRotationMatrix(), please update your code.")},setEulerFromQuaternion:function(a,b){console.error("REMOVED: Vector3's setEulerFromQuaternion: has been removed in favor of Euler.setFromQuaternion(), please update your code.")},getPositionFromMatrix:function(a){return console.warn("DEPRECATED: Vector3's .getPositionFromMatrix() has been renamed to .setFromMatrixPosition(). Please update your code."),this.setFromMatrixPosition(a)},getScaleFromMatrix:function(a){return console.warn("DEPRECATED: Vector3's .getScaleFromMatrix() has been renamed to .setFromMatrixScale(). Please update your code."),this.setFromMatrixScale(a)},getColumnFromMatrix:function(a,b){return console.warn("DEPRECATED: Vector3's .getColumnFromMatrix() has been renamed to .setFromMatrixColumn(). Please update your code."),this.setFromMatrixColumn(a,b)},setFromMatrixPosition:function(a){return this.x=a.elements[12],this.y=a.elements[13],this.z=a.elements[14],this},setFromMatrixScale:function(a){var b=this.set(a.elements[0],a.elements[1],a.elements[2]).length(),c=this.set(a.elements[4],a.elements[5],a.elements[6]).length();return a=this.set(a.elements[8],a.elements[9],a.elements[10]).length(),this.x=b,this.y=c,this.z=a,this},setFromMatrixColumn:function(a,b){var c=4*a,d=b.elements;return this.x=d[c],this.y=d[c+1],this.z=d[c+2],this},equals:function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z},fromArray:function(a){return this.x=a[0],this.y=a[1],this.z=a[2],this},toArray:function(){return[this.x,this.y,this.z]},clone:function(){return new THREE.Vector3(this.x,this.y,this.z)}},THREE.Vector4=function(a,b,c,d){this.x=a||0,this.y=b||0,this.z=c||0,this.w=void 0!==d?d:1},THREE.Vector4.prototype={constructor:THREE.Vector4,set:function(a,b,c,d){return this.x=a,this.y=b,this.z=c,this.w=d,this},setX:function(a){return this.x=a,this},setY:function(a){return this.y=a,this},setZ:function(a){return this.z=a,this},setW:function(a){return this.w=a,this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;case 2:this.z=b;break;case 3:this.w=b;break;default:throw Error("index is out of range: "+a)}},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw Error("index is out of range: "+a)}},copy:function(a){return this.x=a.x,this.y=a.y,
this.z=a.z,this.w=void 0!==a.w?a.w:1,this},add:function(a,b){return void 0!==b?(console.warn("DEPRECATED: Vector4's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(a,b)):(this.x+=a.x,this.y+=a.y,this.z+=a.z,this.w+=a.w,this)},addScalar:function(a){return this.x+=a,this.y+=a,this.z+=a,this.w+=a,this},addVectors:function(a,b){return this.x=a.x+b.x,this.y=a.y+b.y,this.z=a.z+b.z,this.w=a.w+b.w,this},sub:function(a,b){return void 0!==b?(console.warn("DEPRECATED: Vector4's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(a,b)):(this.x-=a.x,this.y-=a.y,this.z-=a.z,this.w-=a.w,this)},subVectors:function(a,b){return this.x=a.x-b.x,this.y=a.y-b.y,this.z=a.z-b.z,this.w=a.w-b.w,this},multiplyScalar:function(a){return this.x*=a,this.y*=a,this.z*=a,this.w*=a,this},applyMatrix4:function(a){var b=this.x,c=this.y,d=this.z,e=this.w;return a=a.elements,this.x=a[0]*b+a[4]*c+a[8]*d+a[12]*e,this.y=a[1]*b+a[5]*c+a[9]*d+a[13]*e,this.z=a[2]*b+a[6]*c+a[10]*d+a[14]*e,this.w=a[3]*b+a[7]*c+a[11]*d+a[15]*e,this},divideScalar:function(a){return 0!==a?(a=1/a,this.x*=a,this.y*=a,this.z*=a,this.w*=a):(this.z=this.y=this.x=0,this.w=1),this},setAxisAngleFromQuaternion:function(a){this.w=2*Math.acos(a.w);var b=Math.sqrt(1-a.w*a.w);return 1e-4>b?(this.x=1,this.z=this.y=0):(this.x=a.x/b,this.y=a.y/b,this.z=a.z/b),this},setAxisAngleFromRotationMatrix:function(a){var b,c,d;a=a.elements;var e=a[0];d=a[4];var f=a[8],g=a[1],h=a[5],i=a[9];c=a[2],b=a[6];var j=a[10];return.01>Math.abs(d-g)&&.01>Math.abs(f-c)&&.01>Math.abs(i-b)?.1>Math.abs(d+g)&&.1>Math.abs(f+c)&&.1>Math.abs(i+b)&&.1>Math.abs(e+h+j-3)?(this.set(1,0,0,0),this):(a=Math.PI,e=(e+1)/2,h=(h+1)/2,j=(j+1)/2,d=(d+g)/4,f=(f+c)/4,i=(i+b)/4,e>h&&e>j?.01>e?(b=0,d=c=.707106781):(b=Math.sqrt(e),c=d/b,d=f/b):h>j?.01>h?(b=.707106781,c=0,d=.707106781):(c=Math.sqrt(h),b=d/c,d=i/c):.01>j?(c=b=.707106781,d=0):(d=Math.sqrt(j),b=f/d,c=i/d),this.set(b,c,d,a),this):(a=Math.sqrt((b-i)*(b-i)+(f-c)*(f-c)+(g-d)*(g-d)),.001>Math.abs(a)&&(a=1),this.x=(b-i)/a,this.y=(f-c)/a,this.z=(g-d)/a,this.w=Math.acos((e+h+j-1)/2),this)},min:function(a){return this.x>a.x&&(this.x=a.x),this.y>a.y&&(this.y=a.y),this.z>a.z&&(this.z=a.z),this.w>a.w&&(this.w=a.w),this},max:function(a){return this.x<a.x&&(this.x=a.x),this.y<a.y&&(this.y=a.y),this.z<a.z&&(this.z=a.z),this.w<a.w&&(this.w=a.w),this},clamp:function(a,b){return this.x<a.x?this.x=a.x:this.x>b.x&&(this.x=b.x),this.y<a.y?this.y=a.y:this.y>b.y&&(this.y=b.y),this.z<a.z?this.z=a.z:this.z>b.z&&(this.z=b.z),this.w<a.w?this.w=a.w:this.w>b.w&&(this.w=b.w),this},clampScalar:function(){var a,b;return function(c,d){return void 0===a&&(a=new THREE.Vector4,b=new THREE.Vector4),a.set(c,c,c,c),b.set(d,d,d,d),this.clamp(a,b)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x),this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y),this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z),this.w=0>this.w?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.multiplyScalar(-1)},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z+this.w*a.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(a){var b=this.length();return 0!==b&&a!==b&&this.multiplyScalar(a/b),this},lerp:function(a,b){return this.x+=(a.x-this.x)*b,this.y+=(a.y-this.y)*b,this.z+=(a.z-this.z)*b,this.w+=(a.w-this.w)*b,this},equals:function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z&&a.w===this.w},fromArray:function(a){return this.x=a[0],this.y=a[1],this.z=a[2],this.w=a[3],this},toArray:function(){return[this.x,this.y,this.z,this.w]},clone:function(){return new THREE.Vector4(this.x,this.y,this.z,this.w)}},THREE.Euler=function(a,b,c,d){this._x=a||0,this._y=b||0,this._z=c||0,this._order=d||THREE.Euler.DefaultOrder},THREE.Euler.RotationOrders="XYZ YZX ZXY XZY YXZ ZYX".split(" "),THREE.Euler.DefaultOrder="XYZ",THREE.Euler.prototype={constructor:THREE.Euler,_x:0,_y:0,_z:0,_order:THREE.Euler.DefaultOrder,get x(){return this._x},set x(a){this._x=a,this.onChangeCallback()},get y(){return this._y},set y(a){this._y=a,this.onChangeCallback()},get z(){return this._z},set z(a){this._z=a,this.onChangeCallback()},get order(){return this._order},set order(a){this._order=a,this.onChangeCallback()},set:function(a,b,c,d){return this._x=a,this._y=b,this._z=c,this._order=d||this._order,this.onChangeCallback(),this},copy:function(a){return this._x=a._x,this._y=a._y,this._z=a._z,this._order=a._order,this.onChangeCallback(),this},setFromRotationMatrix:function(a,b){var c=THREE.Math.clamp,d=a.elements,e=d[0],f=d[4],g=d[8],h=d[1],i=d[5],j=d[9],k=d[2],l=d[6],d=d[10];return b=b||this._order,"XYZ"===b?(this._y=Math.asin(c(g,-1,1)),.99999>Math.abs(g)?(this._x=Math.atan2(-j,d),this._z=Math.atan2(-f,e)):(this._x=Math.atan2(l,i),this._z=0)):"YXZ"===b?(this._x=Math.asin(-c(j,-1,1)),.99999>Math.abs(j)?(this._y=Math.atan2(g,d),this._z=Math.atan2(h,i)):(this._y=Math.atan2(-k,e),this._z=0)):"ZXY"===b?(this._x=Math.asin(c(l,-1,1)),.99999>Math.abs(l)?(this._y=Math.atan2(-k,d),this._z=Math.atan2(-f,i)):(this._y=0,this._z=Math.atan2(h,e))):"ZYX"===b?(this._y=Math.asin(-c(k,-1,1)),.99999>Math.abs(k)?(this._x=Math.atan2(l,d),this._z=Math.atan2(h,e)):(this._x=0,this._z=Math.atan2(-f,i))):"YZX"===b?(this._z=Math.asin(c(h,-1,1)),.99999>Math.abs(h)?(this._x=Math.atan2(-j,i),this._y=Math.atan2(-k,e)):(this._x=0,this._y=Math.atan2(g,d))):"XZY"===b?(this._z=Math.asin(-c(f,-1,1)),.99999>Math.abs(f)?(this._x=Math.atan2(l,i),this._y=Math.atan2(g,e)):(this._x=Math.atan2(-j,d),this._y=0)):console.warn("WARNING: Euler.setFromRotationMatrix() given unsupported order: "+b),this._order=b,this.onChangeCallback(),this},setFromQuaternion:function(a,b,c){var d=THREE.Math.clamp,e=a.x*a.x,f=a.y*a.y,g=a.z*a.z,h=a.w*a.w;return b=b||this._order,"XYZ"===b?(this._x=Math.atan2(2*(a.x*a.w-a.y*a.z),h-e-f+g),this._y=Math.asin(d(2*(a.x*a.z+a.y*a.w),-1,1)),this._z=Math.atan2(2*(a.z*a.w-a.x*a.y),h+e-f-g)):"YXZ"===b?(this._x=Math.asin(d(2*(a.x*a.w-a.y*a.z),-1,1)),this._y=Math.atan2(2*(a.x*a.z+a.y*a.w),h-e-f+g),this._z=Math.atan2(2*(a.x*a.y+a.z*a.w),h-e+f-g)):"ZXY"===b?(this._x=Math.asin(d(2*(a.x*a.w+a.y*a.z),-1,1)),this._y=Math.atan2(2*(a.y*a.w-a.z*a.x),h-e-f+g),this._z=Math.atan2(2*(a.z*a.w-a.x*a.y),h-e+f-g)):"ZYX"===b?(this._x=Math.atan2(2*(a.x*a.w+a.z*a.y),h-e-f+g),this._y=Math.asin(d(2*(a.y*a.w-a.x*a.z),-1,1)),this._z=Math.atan2(2*(a.x*a.y+a.z*a.w),h+e-f-g)):"YZX"===b?(this._x=Math.atan2(2*(a.x*a.w-a.z*a.y),h-e+f-g),this._y=Math.atan2(2*(a.y*a.w-a.x*a.z),h+e-f-g),this._z=Math.asin(d(2*(a.x*a.y+a.z*a.w),-1,1))):"XZY"===b?(this._x=Math.atan2(2*(a.x*a.w+a.y*a.z),h-e+f-g),this._y=Math.atan2(2*(a.x*a.z+a.y*a.w),h+e-f-g),this._z=Math.asin(d(2*(a.z*a.w-a.x*a.y),-1,1))):console.warn("WARNING: Euler.setFromQuaternion() given unsupported order: "+b),this._order=b,!1!==c&&this.onChangeCallback(),this},reorder:function(){var a=new THREE.Quaternion;return function(b){a.setFromEuler(this),this.setFromQuaternion(a,b)}}(),equals:function(a){return a._x===this._x&&a._y===this._y&&a._z===this._z&&a._order===this._order},fromArray:function(a){return this._x=a[0],this._y=a[1],this._z=a[2],void 0!==a[3]&&(this._order=a[3]),this.onChangeCallback(),this},toArray:function(){return[this._x,this._y,this._z,this._order]},onChange:function(a){return this.onChangeCallback=a,this},onChangeCallback:function(){},clone:function(){return new THREE.Euler(this._x,this._y,this._z,this._order)}},THREE.Line3=function(a,b){this.start=void 0!==a?a:new THREE.Vector3,this.end=void 0!==b?b:new THREE.Vector3},THREE.Line3.prototype={constructor:THREE.Line3,set:function(a,b){return this.start.copy(a),this.end.copy(b),this},copy:function(a){return this.start.copy(a.start),this.end.copy(a.end),this},center:function(a){return(a||new THREE.Vector3).addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(a){return(a||new THREE.Vector3).subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(a,b){var c=b||new THREE.Vector3;return this.delta(c).multiplyScalar(a).add(this.start)},closestPointToPointParameter:function(){var a=new THREE.Vector3,b=new THREE.Vector3;return function(c,d){a.subVectors(c,this.start),b.subVectors(this.end,this.start);var e=b.dot(b),e=b.dot(a)/e;return d&&(e=THREE.Math.clamp(e,0,1)),e}}(),closestPointToPoint:function(a,b,c){return a=this.closestPointToPointParameter(a,b),c=c||new THREE.Vector3,this.delta(c).multiplyScalar(a).add(this.start)},applyMatrix4:function(a){return this.start.applyMatrix4(a),this.end.applyMatrix4(a),this},equals:function(a){return a.start.equals(this.start)&&a.end.equals(this.end)},clone:function(){return(new THREE.Line3).copy(this)}},THREE.Box2=function(a,b){this.min=void 0!==a?a:new THREE.Vector2(1/0,1/0),this.max=void 0!==b?b:new THREE.Vector2(-(1/0),-(1/0))},THREE.Box2.prototype={constructor:THREE.Box2,set:function(a,b){return this.min.copy(a),this.max.copy(b),this},setFromPoints:function(a){if(0<a.length){var b=a[0];this.min.copy(b),this.max.copy(b);for(var c=1,d=a.length;d>c;c++)b=a[c],b.x<this.min.x?this.min.x=b.x:b.x>this.max.x&&(this.max.x=b.x),b.y<this.min.y?this.min.y=b.y:b.y>this.max.y&&(this.max.y=b.y)}else this.makeEmpty();return this},setFromCenterAndSize:function(){var a=new THREE.Vector2;return function(b,c){var d=a.copy(c).multiplyScalar(.5);return this.min.copy(b).sub(d),this.max.copy(b).add(d),this}}(),copy:function(a){return this.min.copy(a.min),this.max.copy(a.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-(1/0),this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},center:function(a){return(a||new THREE.Vector2).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(a){return(a||new THREE.Vector2).subVectors(this.max,this.min)},expandByPoint:function(a){return this.min.min(a),this.max.max(a),this},expandByVector:function(a){return this.min.sub(a),this.max.add(a),this},expandByScalar:function(a){return this.min.addScalar(-a),this.max.addScalar(a),this},containsPoint:function(a){return!(a.x<this.min.x||a.x>this.max.x||a.y<this.min.y||a.y>this.max.y)},containsBox:function(a){return this.min.x<=a.min.x&&a.max.x<=this.max.x&&this.min.y<=a.min.y&&a.max.y<=this.max.y},getParameter:function(a,b){return(b||new THREE.Vector2).set((a.x-this.min.x)/(this.max.x-this.min.x),(a.y-this.min.y)/(this.max.y-this.min.y))},isIntersectionBox:function(a){return!(a.max.x<this.min.x||a.min.x>this.max.x||a.max.y<this.min.y||a.min.y>this.max.y)},clampPoint:function(a,b){return(b||new THREE.Vector2).copy(a).clamp(this.min,this.max)},distanceToPoint:function(){var a=new THREE.Vector2;return function(b){return a.copy(b).clamp(this.min,this.max).sub(b).length()}}(),intersect:function(a){return this.min.max(a.min),this.max.min(a.max),this},union:function(a){return this.min.min(a.min),this.max.max(a.max),this},translate:function(a){return this.min.add(a),this.max.add(a),this},equals:function(a){return a.min.equals(this.min)&&a.max.equals(this.max)},clone:function(){return(new THREE.Box2).copy(this)}},THREE.Box3=function(a,b){this.min=void 0!==a?a:new THREE.Vector3(1/0,1/0,1/0),this.max=void 0!==b?b:new THREE.Vector3(-(1/0),-(1/0),-(1/0))},THREE.Box3.prototype={constructor:THREE.Box3,set:function(a,b){return this.min.copy(a),this.max.copy(b),this},addPoint:function(a){return a.x<this.min.x?this.min.x=a.x:a.x>this.max.x&&(this.max.x=a.x),a.y<this.min.y?this.min.y=a.y:a.y>this.max.y&&(this.max.y=a.y),a.z<this.min.z?this.min.z=a.z:a.z>this.max.z&&(this.max.z=a.z),this},setFromPoints:function(a){if(0<a.length){var b=a[0];this.min.copy(b),this.max.copy(b);for(var b=1,c=a.length;c>b;b++)this.addPoint(a[b])}else this.makeEmpty();return this},setFromCenterAndSize:function(){var a=new THREE.Vector3;return function(b,c){var d=a.copy(c).multiplyScalar(.5);return this.min.copy(b).sub(d),this.max.copy(b).add(d),this}}(),setFromObject:function(){var a=new THREE.Vector3;return function(b){var c=this;return b.updateMatrixWorld(!0),this.makeEmpty(),b.traverse(function(b){if(void 0!==b.geometry&&void 0!==b.geometry.vertices)for(var d=b.geometry.vertices,e=0,f=d.length;f>e;e++)a.copy(d[e]),a.applyMatrix4(b.matrixWorld),c.expandByPoint(a)}),this}}(),copy:function(a){return this.min.copy(a.min),this.max.copy(a.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-(1/0),this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},center:function(a){return(a||new THREE.Vector3).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(a){return(a||new THREE.Vector3).subVectors(this.max,this.min)},expandByPoint:function(a){return this.min.min(a),this.max.max(a),this},expandByVector:function(a){return this.min.sub(a),this.max.add(a),this},expandByScalar:function(a){return this.min.addScalar(-a),this.max.addScalar(a),this},containsPoint:function(a){return!(a.x<this.min.x||a.x>this.max.x||a.y<this.min.y||a.y>this.max.y||a.z<this.min.z||a.z>this.max.z)},containsBox:function(a){return this.min.x<=a.min.x&&a.max.x<=this.max.x&&this.min.y<=a.min.y&&a.max.y<=this.max.y&&this.min.z<=a.min.z&&a.max.z<=this.max.z},getParameter:function(a,b){return(b||new THREE.Vector3).set((a.x-this.min.x)/(this.max.x-this.min.x),(a.y-this.min.y)/(this.max.y-this.min.y),(a.z-this.min.z)/(this.max.z-this.min.z))},isIntersectionBox:function(a){return!(a.max.x<this.min.x||a.min.x>this.max.x||a.max.y<this.min.y||a.min.y>this.max.y||a.max.z<this.min.z||a.min.z>this.max.z)},clampPoint:function(a,b){return(b||new THREE.Vector3).copy(a).clamp(this.min,this.max)},distanceToPoint:function(){var a=new THREE.Vector3;return function(b){return a.copy(b).clamp(this.min,this.max).sub(b).length()}}(),getBoundingSphere:function(){var a=new THREE.Vector3;return function(b){return b=b||new THREE.Sphere,b.center=this.center(),b.radius=.5*this.size(a).length(),b}}(),intersect:function(a){return this.min.max(a.min),this.max.min(a.max),this},union:function(a){return this.min.min(a.min),this.max.max(a.max),this},applyMatrix4:function(){var a=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];return function(b){return a[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(b),a[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(b),a[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(b),a[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(b),a[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(b),a[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(b),a[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(b),a[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(b),this.makeEmpty(),this.setFromPoints(a),this}}(),translate:function(a){return this.min.add(a),this.max.add(a),this},equals:function(a){return a.min.equals(this.min)&&a.max.equals(this.max)},clone:function(){return(new THREE.Box3).copy(this)}},THREE.Matrix3=function(a,b,c,d,e,f,g,h,i){var j=this.elements=new Float32Array(9);j[0]=void 0!==a?a:1,j[3]=b||0,j[6]=c||0,j[1]=d||0,j[4]=void 0!==e?e:1,j[7]=f||0,j[2]=g||0,j[5]=h||0,j[8]=void 0!==i?i:1},THREE.Matrix3.prototype={constructor:THREE.Matrix3,set:function(a,b,c,d,e,f,g,h,i){var j=this.elements;return j[0]=a,j[3]=b,j[6]=c,j[1]=d,j[4]=e,j[7]=f,j[2]=g,j[5]=h,j[8]=i,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},copy:function(a){return a=a.elements,this.set(a[0],a[3],a[6],a[1],a[4],a[7],a[2],a[5],a[8]),this},multiplyVector3:function(a){return console.warn("DEPRECATED: Matrix3's .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),a.applyMatrix3(this)},multiplyVector3Array:function(a){return console.warn("DEPRECATED: Matrix3's .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead."),this.applyToVector3Array(a)},applyToVector3Array:function(){var a=new THREE.Vector3;return function(b,c,d){void 0===c&&(c=0),void 0===d&&(d=b.length);for(var e=0;d>e;e+=3,c+=3)a.x=b[c],a.y=b[c+1],a.z=b[c+2],a.applyMatrix3(this),b[c]=a.x,b[c+1]=a.y,b[c+2]=a.z;return b}}(),multiplyScalar:function(a){var b=this.elements;return b[0]*=a,b[3]*=a,b[6]*=a,b[1]*=a,b[4]*=a,b[7]*=a,b[2]*=a,b[5]*=a,b[8]*=a,this},determinant:function(){var a=this.elements,b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],a=a[8];return b*f*a-b*g*i-c*e*a+c*g*h+d*e*i-d*f*h},getInverse:function(a,b){var c=a.elements,d=this.elements;if(d[0]=c[10]*c[5]-c[6]*c[9],d[1]=-c[10]*c[1]+c[2]*c[9],d[2]=c[6]*c[1]-c[2]*c[5],d[3]=-c[10]*c[4]+c[6]*c[8],d[4]=c[10]*c[0]-c[2]*c[8],d[5]=-c[6]*c[0]+c[2]*c[4],d[6]=c[9]*c[4]-c[5]*c[8],d[7]=-c[9]*c[0]+c[1]*c[8],d[8]=c[5]*c[0]-c[1]*c[4],c=c[0]*d[0]+c[1]*d[3]+c[2]*d[6],0===c){if(b)throw Error("Matrix3.getInverse(): can't invert matrix, determinant is 0");return console.warn("Matrix3.getInverse(): can't invert matrix, determinant is 0"),this.identity(),this}return this.multiplyScalar(1/c),this},transpose:function(){var a,b=this.elements;return a=b[1],b[1]=b[3],b[3]=a,a=b[2],b[2]=b[6],b[6]=a,a=b[5],b[5]=b[7],b[7]=a,this},flattenToArrayOffset:function(a,b){var c=this.elements;return a[b]=c[0],a[b+1]=c[1],a[b+2]=c[2],a[b+3]=c[3],a[b+4]=c[4],a[b+5]=c[5],a[b+6]=c[6],a[b+7]=c[7],a[b+8]=c[8],a},getNormalMatrix:function(a){return this.getInverse(a).transpose(),this},transposeIntoArray:function(a){var b=this.elements;return a[0]=b[0],a[1]=b[3],a[2]=b[6],a[3]=b[1],a[4]=b[4],a[5]=b[7],a[6]=b[2],a[7]=b[5],a[8]=b[8],this},fromArray:function(a){return this.elements.set(a),this},toArray:function(){var a=this.elements;return[a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8]]},clone:function(){var a=this.elements;return new THREE.Matrix3(a[0],a[3],a[6],a[1],a[4],a[7],a[2],a[5],a[8])}},THREE.Matrix4=function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q=this.elements=new Float32Array(16);q[0]=void 0!==a?a:1,q[4]=b||0,q[8]=c||0,q[12]=d||0,q[1]=e||0,q[5]=void 0!==f?f:1,q[9]=g||0,q[13]=h||0,q[2]=i||0,q[6]=j||0,q[10]=void 0!==k?k:1,q[14]=l||0,q[3]=m||0,q[7]=n||0,q[11]=o||0,q[15]=void 0!==p?p:1},THREE.Matrix4.prototype={constructor:THREE.Matrix4,set:function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q=this.elements;return q[0]=a,q[4]=b,q[8]=c,q[12]=d,q[1]=e,q[5]=f,q[9]=g,q[13]=h,q[2]=i,q[6]=j,q[10]=k,q[14]=l,q[3]=m,q[7]=n,q[11]=o,q[15]=p,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},copy:function(a){return this.elements.set(a.elements),this},extractPosition:function(a){return console.warn("DEPRECATED: Matrix4's .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(a)},copyPosition:function(a){var b=this.elements;return a=a.elements,b[12]=a[12],b[13]=a[13],b[14]=a[14],this},extractRotation:function(){var a=new THREE.Vector3;return function(b){var c=this.elements;b=b.elements;var d=1/a.set(b[0],b[1],b[2]).length(),e=1/a.set(b[4],b[5],b[6]).length(),f=1/a.set(b[8],b[9],b[10]).length();return c[0]=b[0]*d,c[1]=b[1]*d,c[2]=b[2]*d,c[4]=b[4]*e,c[5]=b[5]*e,c[6]=b[6]*e,c[8]=b[8]*f,c[9]=b[9]*f,c[10]=b[10]*f,this}}(),makeRotationFromEuler:function(a){!1==a instanceof THREE.Euler&&console.error("ERROR: Matrix's .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.  Please update your code.");var b=this.elements,c=a.x,d=a.y,e=a.z,f=Math.cos(c),c=Math.sin(c),g=Math.cos(d),d=Math.sin(d),h=Math.cos(e),e=Math.sin(e);if("XYZ"===a.order){a=f*h;var i=f*e,j=c*h,k=c*e;b[0]=g*h,b[4]=-g*e,b[8]=d,b[1]=i+j*d,b[5]=a-k*d,b[9]=-c*g,b[2]=k-a*d,b[6]=j+i*d,b[10]=f*g}else"YXZ"===a.order?(a=g*h,i=g*e,j=d*h,k=d*e,b[0]=a+k*c,b[4]=j*c-i,b[8]=f*d,b[1]=f*e,b[5]=f*h,b[9]=-c,b[2]=i*c-j,b[6]=k+a*c,b[10]=f*g):"ZXY"===a.order?(a=g*h,i=g*e,j=d*h,k=d*e,b[0]=a-k*c,b[4]=-f*e,b[8]=j+i*c,b[1]=i+j*c,b[5]=f*h,b[9]=k-a*c,b[2]=-f*d,b[6]=c,b[10]=f*g):"ZYX"===a.order?(a=f*h,i=f*e,j=c*h,k=c*e,b[0]=g*h,b[4]=j*d-i,b[8]=a*d+k,b[1]=g*e,b[5]=k*d+a,b[9]=i*d-j,b[2]=-d,b[6]=c*g,b[10]=f*g):"YZX"===a.order?(a=f*g,i=f*d,j=c*g,k=c*d,b[0]=g*h,b[4]=k-a*e,b[8]=j*e+i,b[1]=e,b[5]=f*h,b[9]=-c*h,b[2]=-d*h,b[6]=i*e+j,b[10]=a-k*e):"XZY"===a.order&&(a=f*g,i=f*d,j=c*g,k=c*d,b[0]=g*h,b[4]=-e,b[8]=d*h,b[1]=a*e+k,b[5]=f*h,b[9]=i*e-j,b[2]=j*e-i,b[6]=c*h,b[10]=k*e+a);return b[3]=0,b[7]=0,b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,this},setRotationFromQuaternion:function(a){return console.warn("DEPRECATED: Matrix4's .setRotationFromQuaternion() has been deprecated in favor of makeRotationFromQuaternion.  Please update your code."),this.makeRotationFromQuaternion(a)},makeRotationFromQuaternion:function(a){var b=this.elements,c=a.x,d=a.y,e=a.z,f=a.w,g=c+c,h=d+d,i=e+e;a=c*g;var j=c*h,c=c*i,k=d*h,d=d*i,e=e*i,g=f*g,h=f*h,f=f*i;return b[0]=1-(k+e),b[4]=j-f,b[8]=c+h,b[1]=j+f,b[5]=1-(a+e),b[9]=d-g,b[2]=c-h,b[6]=d+g,b[10]=1-(a+k),b[3]=0,b[7]=0,b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,this},lookAt:function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Vector3;return function(d,e,f){var g=this.elements;return c.subVectors(d,e).normalize(),0===c.length()&&(c.z=1),a.crossVectors(f,c).normalize(),0===a.length()&&(c.x+=1e-4,a.crossVectors(f,c).normalize()),b.crossVectors(c,a),g[0]=a.x,g[4]=b.x,g[8]=c.x,g[1]=a.y,g[5]=b.y,g[9]=c.y,g[2]=a.z,g[6]=b.z,g[10]=c.z,this}}(),multiply:function(a,b){return void 0!==b?(console.warn("DEPRECATED: Matrix4's .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(a,b)):this.multiplyMatrices(this,a)},multiplyMatrices:function(a,b){var c=a.elements,d=b.elements,e=this.elements,f=c[0],g=c[4],h=c[8],i=c[12],j=c[1],k=c[5],l=c[9],m=c[13],n=c[2],o=c[6],p=c[10],q=c[14],r=c[3],s=c[7],t=c[11],c=c[15],u=d[0],v=d[4],w=d[8],x=d[12],y=d[1],z=d[5],A=d[9],B=d[13],C=d[2],D=d[6],E=d[10],F=d[14],G=d[3],H=d[7],I=d[11],d=d[15];return e[0]=f*u+g*y+h*C+i*G,e[4]=f*v+g*z+h*D+i*H,e[8]=f*w+g*A+h*E+i*I,e[12]=f*x+g*B+h*F+i*d,e[1]=j*u+k*y+l*C+m*G,e[5]=j*v+k*z+l*D+m*H,e[9]=j*w+k*A+l*E+m*I,e[13]=j*x+k*B+l*F+m*d,e[2]=n*u+o*y+p*C+q*G,e[6]=n*v+o*z+p*D+q*H,e[10]=n*w+o*A+p*E+q*I,e[14]=n*x+o*B+p*F+q*d,e[3]=r*u+s*y+t*C+c*G,e[7]=r*v+s*z+t*D+c*H,e[11]=r*w+s*A+t*E+c*I,e[15]=r*x+s*B+t*F+c*d,this},multiplyToArray:function(a,b,c){var d=this.elements;return this.multiplyMatrices(a,b),c[0]=d[0],c[1]=d[1],c[2]=d[2],c[3]=d[3],c[4]=d[4],c[5]=d[5],c[6]=d[6],c[7]=d[7],c[8]=d[8],c[9]=d[9],c[10]=d[10],c[11]=d[11],c[12]=d[12],c[13]=d[13],c[14]=d[14],c[15]=d[15],this},multiplyScalar:function(a){var b=this.elements;return b[0]*=a,b[4]*=a,b[8]*=a,b[12]*=a,b[1]*=a,b[5]*=a,b[9]*=a,b[13]*=a,b[2]*=a,b[6]*=a,b[10]*=a,b[14]*=a,b[3]*=a,b[7]*=a,b[11]*=a,b[15]*=a,this},multiplyVector3:function(a){return console.warn("DEPRECATED: Matrix4's .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead."),a.applyProjection(this)},multiplyVector4:function(a){return console.warn("DEPRECATED: Matrix4's .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),a.applyMatrix4(this)},multiplyVector3Array:function(a){return console.warn("DEPRECATED: Matrix4's .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead."),this.applyToVector3Array(a)},applyToVector3Array:function(){var a=new THREE.Vector3;return function(b,c,d){void 0===c&&(c=0),void 0===d&&(d=b.length);for(var e=0;d>e;e+=3,c+=3)a.x=b[c],a.y=b[c+1],a.z=b[c+2],a.applyMatrix4(this),b[c]=a.x,b[c+1]=a.y,b[c+2]=a.z;return b}}(),rotateAxis:function(a){console.warn("DEPRECATED: Matrix4's .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),a.transformDirection(this)},crossVector:function(a){return console.warn("DEPRECATED: Matrix4's .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),a.applyMatrix4(this)},determinant:function(){var a=this.elements,b=a[0],c=a[4],d=a[8],e=a[12],f=a[1],g=a[5],h=a[9],i=a[13],j=a[2],k=a[6],l=a[10],m=a[14];return a[3]*(+e*h*k-d*i*k-e*g*l+c*i*l+d*g*m-c*h*m)+a[7]*(+b*h*m-b*i*l+e*f*l-d*f*m+d*i*j-e*h*j)+a[11]*(+b*i*k-b*g*m-e*f*k+c*f*m+e*g*j-c*i*j)+a[15]*(-d*g*j-b*h*k+b*g*l+d*f*k-c*f*l+c*h*j)},transpose:function(){var a,b=this.elements;return a=b[1],b[1]=b[4],b[4]=a,a=b[2],b[2]=b[8],b[8]=a,a=b[6],b[6]=b[9],b[9]=a,a=b[3],b[3]=b[12],b[12]=a,a=b[7],b[7]=b[13],b[13]=a,a=b[11],b[11]=b[14],b[14]=a,this},flattenToArrayOffset:function(a,b){var c=this.elements;return a[b]=c[0],a[b+1]=c[1],a[b+2]=c[2],a[b+3]=c[3],a[b+4]=c[4],a[b+5]=c[5],a[b+6]=c[6],a[b+7]=c[7],a[b+8]=c[8],a[b+9]=c[9],a[b+10]=c[10],a[b+11]=c[11],a[b+12]=c[12],a[b+13]=c[13],a[b+14]=c[14],a[b+15]=c[15],a},getPosition:function(){var a=new THREE.Vector3;return function(){console.warn("DEPRECATED: Matrix4's .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.");var b=this.elements;return a.set(b[12],b[13],b[14])}}(),setPosition:function(a){var b=this.elements;return b[12]=a.x,b[13]=a.y,b[14]=a.z,this},getInverse:function(a,b){var c=this.elements,d=a.elements,e=d[0],f=d[4],g=d[8],h=d[12],i=d[1],j=d[5],k=d[9],l=d[13],m=d[2],n=d[6],o=d[10],p=d[14],q=d[3],r=d[7],s=d[11],d=d[15];if(c[0]=k*p*r-l*o*r+l*n*s-j*p*s-k*n*d+j*o*d,c[4]=h*o*r-g*p*r-h*n*s+f*p*s+g*n*d-f*o*d,c[8]=g*l*r-h*k*r+h*j*s-f*l*s-g*j*d+f*k*d,c[12]=h*k*n-g*l*n-h*j*o+f*l*o+g*j*p-f*k*p,c[1]=l*o*q-k*p*q-l*m*s+i*p*s+k*m*d-i*o*d,c[5]=g*p*q-h*o*q+h*m*s-e*p*s-g*m*d+e*o*d,c[9]=h*k*q-g*l*q-h*i*s+e*l*s+g*i*d-e*k*d,c[13]=g*l*m-h*k*m+h*i*o-e*l*o-g*i*p+e*k*p,c[2]=j*p*q-l*n*q+l*m*r-i*p*r-j*m*d+i*n*d,c[6]=h*n*q-f*p*q-h*m*r+e*p*r+f*m*d-e*n*d,c[10]=f*l*q-h*j*q+h*i*r-e*l*r-f*i*d+e*j*d,c[14]=h*j*m-f*l*m-h*i*n+e*l*n+f*i*p-e*j*p,c[3]=k*n*q-j*o*q-k*m*r+i*o*r+j*m*s-i*n*s,c[7]=f*o*q-g*n*q+g*m*r-e*o*r-f*m*s+e*n*s,c[11]=g*j*q-f*k*q-g*i*r+e*k*r+f*i*s-e*j*s,c[15]=f*k*m-g*j*m+g*i*n-e*k*n-f*i*o+e*j*o,c=e*c[0]+i*c[4]+m*c[8]+q*c[12],0==c){if(b)throw Error("Matrix4.getInverse(): can't invert matrix, determinant is 0");return console.warn("Matrix4.getInverse(): can't invert matrix, determinant is 0"),this.identity(),this}return this.multiplyScalar(1/c),this},translate:function(a){console.warn("DEPRECATED: Matrix4's .translate() has been removed.")},rotateX:function(a){console.warn("DEPRECATED: Matrix4's .rotateX() has been removed.")},rotateY:function(a){console.warn("DEPRECATED: Matrix4's .rotateY() has been removed.")},rotateZ:function(a){console.warn("DEPRECATED: Matrix4's .rotateZ() has been removed.")},rotateByAxis:function(a,b){console.warn("DEPRECATED: Matrix4's .rotateByAxis() has been removed.")},scale:function(a){var b=this.elements,c=a.x,d=a.y;return a=a.z,b[0]*=c,b[4]*=d,b[8]*=a,b[1]*=c,b[5]*=d,b[9]*=a,b[2]*=c,b[6]*=d,b[10]*=a,b[3]*=c,b[7]*=d,b[11]*=a,this},getMaxScaleOnAxis:function(){var a=this.elements;return Math.sqrt(Math.max(a[0]*a[0]+a[1]*a[1]+a[2]*a[2],Math.max(a[4]*a[4]+a[5]*a[5]+a[6]*a[6],a[8]*a[8]+a[9]*a[9]+a[10]*a[10])))},makeTranslation:function(a,b,c){return this.set(1,0,0,a,0,1,0,b,0,0,1,c,0,0,0,1),this},makeRotationX:function(a){var b=Math.cos(a);return a=Math.sin(a),this.set(1,0,0,0,0,b,-a,0,0,a,b,0,0,0,0,1),this},makeRotationY:function(a){var b=Math.cos(a);return a=Math.sin(a),this.set(b,0,a,0,0,1,0,0,-a,0,b,0,0,0,0,1),this},makeRotationZ:function(a){var b=Math.cos(a);return a=Math.sin(a),this.set(b,-a,0,0,a,b,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(a,b){var c=Math.cos(b),d=Math.sin(b),e=1-c,f=a.x,g=a.y,h=a.z,i=e*f,j=e*g;return this.set(i*f+c,i*g-d*h,i*h+d*g,0,i*g+d*h,j*g+c,j*h-d*f,0,i*h-d*g,j*h+d*f,e*h*h+c,0,0,0,0,1),this},makeScale:function(a,b,c){return this.set(a,0,0,0,0,b,0,0,0,0,c,0,0,0,0,1),this},compose:function(a,b,c){return this.makeRotationFromQuaternion(b),this.scale(c),this.setPosition(a),this},decompose:function(){var a=new THREE.Vector3,b=new THREE.Matrix4;return function(c,d,e){var f=this.elements,g=a.set(f[0],f[1],f[2]).length(),h=a.set(f[4],f[5],f[6]).length(),i=a.set(f[8],f[9],f[10]).length();0>this.determinant()&&(g=-g),c.x=f[12],c.y=f[13],c.z=f[14],b.elements.set(this.elements),c=1/g;var f=1/h,j=1/i;return b.elements[0]*=c,b.elements[1]*=c,b.elements[2]*=c,b.elements[4]*=f,b.elements[5]*=f,b.elements[6]*=f,b.elements[8]*=j,b.elements[9]*=j,b.elements[10]*=j,d.setFromRotationMatrix(b),e.x=g,e.y=h,e.z=i,this}}(),makeFrustum:function(a,b,c,d,e,f){var g=this.elements;return g[0]=2*e/(b-a),g[4]=0,g[8]=(b+a)/(b-a),g[12]=0,g[1]=0,g[5]=2*e/(d-c),g[9]=(d+c)/(d-c),g[13]=0,g[2]=0,g[6]=0,g[10]=-(f+e)/(f-e),g[14]=-2*f*e/(f-e),g[3]=0,g[7]=0,g[11]=-1,g[15]=0,this},makePerspective:function(a,b,c,d){a=c*Math.tan(THREE.Math.degToRad(.5*a));var e=-a;return this.makeFrustum(e*b,a*b,e,a,c,d)},makeOrthographic:function(a,b,c,d,e,f){var g=this.elements,h=b-a,i=c-d,j=f-e;return g[0]=2/h,g[4]=0,g[8]=0,g[12]=-((b+a)/h),g[1]=0,g[5]=2/i,g[9]=0,g[13]=-((c+d)/i),g[2]=0,g[6]=0,g[10]=-2/j,g[14]=-((f+e)/j),g[3]=0,g[7]=0,g[11]=0,g[15]=1,this},fromArray:function(a){return this.elements.set(a),this},toArray:function(){var a=this.elements;return[a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],a[9],a[10],a[11],a[12],a[13],a[14],a[15]]},clone:function(){var a=this.elements;return new THREE.Matrix4(a[0],a[4],a[8],a[12],a[1],a[5],a[9],a[13],a[2],a[6],a[10],a[14],a[3],a[7],a[11],a[15])}},THREE.Ray=function(a,b){this.origin=void 0!==a?a:new THREE.Vector3,this.direction=void 0!==b?b:new THREE.Vector3},THREE.Ray.prototype={constructor:THREE.Ray,set:function(a,b){return this.origin.copy(a),this.direction.copy(b),this},copy:function(a){return this.origin.copy(a.origin),this.direction.copy(a.direction),this},at:function(a,b){return(b||new THREE.Vector3).copy(this.direction).multiplyScalar(a).add(this.origin)},recast:function(){var a=new THREE.Vector3;return function(b){return this.origin.copy(this.at(b,a)),this}}(),closestPointToPoint:function(a,b){var c=b||new THREE.Vector3;c.subVectors(a,this.origin);var d=c.dot(this.direction);return 0>d?c.copy(this.origin):c.copy(this.direction).multiplyScalar(d).add(this.origin)},distanceToPoint:function(){var a=new THREE.Vector3;return function(b){var c=a.subVectors(b,this.origin).dot(this.direction);return 0>c?this.origin.distanceTo(b):(a.copy(this.direction).multiplyScalar(c).add(this.origin),a.distanceTo(b))}}(),distanceSqToSegment:function(a,b,c,d){var e=a.clone().add(b).multiplyScalar(.5),f=b.clone().sub(a).normalize(),g=.5*a.distanceTo(b),h=this.origin.clone().sub(e);a=-this.direction.dot(f),b=h.dot(this.direction);var i,j,k=-h.dot(f),l=h.lengthSq(),m=Math.abs(1-a*a);return m>=0?(h=a*k-b,i=a*b-k,j=g*m,h>=0?i>=-j?j>=i?(g=1/m,h*=g,i*=g,a=h*(h+a*i+2*b)+i*(a*h+i+2*k)+l):(i=g,h=Math.max(0,-(a*i+b)),a=-h*h+i*(i+2*k)+l):(i=-g,h=Math.max(0,-(a*i+b)),a=-h*h+i*(i+2*k)+l):-j>=i?(h=Math.max(0,-(-a*g+b)),i=h>0?-g:Math.min(Math.max(-g,-k),g),a=-h*h+i*(i+2*k)+l):j>=i?(h=0,i=Math.min(Math.max(-g,-k),g),a=i*(i+2*k)+l):(h=Math.max(0,-(a*g+b)),i=h>0?g:Math.min(Math.max(-g,-k),g),a=-h*h+i*(i+2*k)+l)):(i=a>0?-g:g,h=Math.max(0,-(a*i+b)),a=-h*h+i*(i+2*k)+l),c&&c.copy(this.direction.clone().multiplyScalar(h).add(this.origin)),d&&d.copy(f.clone().multiplyScalar(i).add(e)),a},isIntersectionSphere:function(a){return this.distanceToPoint(a.center)<=a.radius},isIntersectionPlane:function(a){var b=a.distanceToPoint(this.origin);return 0===b||0>a.normal.dot(this.direction)*b},distanceToPlane:function(a){var b=a.normal.dot(this.direction);return 0==b?0==a.distanceToPoint(this.origin)?0:null:(a=-(this.origin.dot(a.normal)+a.constant)/b,a>=0?a:null);
},intersectPlane:function(a,b){var c=this.distanceToPlane(a);return null===c?null:this.at(c,b)},isIntersectionBox:function(){var a=new THREE.Vector3;return function(b){return null!==this.intersectBox(b,a)}}(),intersectBox:function(a,b){var c,d,e,f,g;d=1/this.direction.x,f=1/this.direction.y,g=1/this.direction.z;var h=this.origin;return d>=0?(c=(a.min.x-h.x)*d,d*=a.max.x-h.x):(c=(a.max.x-h.x)*d,d*=a.min.x-h.x),f>=0?(e=(a.min.y-h.y)*f,f*=a.max.y-h.y):(e=(a.max.y-h.y)*f,f*=a.min.y-h.y),c>f||e>d?null:((e>c||c!==c)&&(c=e),(d>f||d!==d)&&(d=f),g>=0?(e=(a.min.z-h.z)*g,g*=a.max.z-h.z):(e=(a.max.z-h.z)*g,g*=a.min.z-h.z),c>g||e>d?null:((e>c||c!==c)&&(c=e),(d>g||d!==d)&&(d=g),0>d?null:this.at(c>=0?c:d,b)))},intersectTriangle:function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Vector3,d=new THREE.Vector3;return function(e,f,g,h,i){if(b.subVectors(f,e),c.subVectors(g,e),d.crossVectors(b,c),f=this.direction.dot(d),f>0){if(h)return null;h=1}else{if(!(0>f))return null;h=-1,f=-f}return a.subVectors(this.origin,e),e=h*this.direction.dot(c.crossVectors(a,c)),0>e?null:(g=h*this.direction.dot(b.cross(a)),0>g||e+g>f?null:(e=-h*a.dot(d),0>e?null:this.at(e/f,i)))}}(),applyMatrix4:function(a){return this.direction.add(this.origin).applyMatrix4(a),this.origin.applyMatrix4(a),this.direction.sub(this.origin),this.direction.normalize(),this},equals:function(a){return a.origin.equals(this.origin)&&a.direction.equals(this.direction)},clone:function(){return(new THREE.Ray).copy(this)}},THREE.Sphere=function(a,b){this.center=void 0!==a?a:new THREE.Vector3,this.radius=void 0!==b?b:0},THREE.Sphere.prototype={constructor:THREE.Sphere,set:function(a,b){return this.center.copy(a),this.radius=b,this},setFromPoints:function(){var a=new THREE.Box3;return function(b,c){var d=this.center;void 0!==c?d.copy(c):a.setFromPoints(b).center(d);for(var e=0,f=0,g=b.length;g>f;f++)e=Math.max(e,d.distanceToSquared(b[f]));return this.radius=Math.sqrt(e),this}}(),copy:function(a){return this.center.copy(a.center),this.radius=a.radius,this},empty:function(){return 0>=this.radius},containsPoint:function(a){return a.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(a){return a.distanceTo(this.center)-this.radius},intersectsSphere:function(a){var b=this.radius+a.radius;return a.center.distanceToSquared(this.center)<=b*b},clampPoint:function(a,b){var c=this.center.distanceToSquared(a),d=b||new THREE.Vector3;return d.copy(a),c>this.radius*this.radius&&(d.sub(this.center).normalize(),d.multiplyScalar(this.radius).add(this.center)),d},getBoundingBox:function(a){return a=a||new THREE.Box3,a.set(this.center,this.center),a.expandByScalar(this.radius),a},applyMatrix4:function(a){return this.center.applyMatrix4(a),this.radius*=a.getMaxScaleOnAxis(),this},translate:function(a){return this.center.add(a),this},equals:function(a){return a.center.equals(this.center)&&a.radius===this.radius},clone:function(){return(new THREE.Sphere).copy(this)}},THREE.Frustum=function(a,b,c,d,e,f){this.planes=[void 0!==a?a:new THREE.Plane,void 0!==b?b:new THREE.Plane,void 0!==c?c:new THREE.Plane,void 0!==d?d:new THREE.Plane,void 0!==e?e:new THREE.Plane,void 0!==f?f:new THREE.Plane]},THREE.Frustum.prototype={constructor:THREE.Frustum,set:function(a,b,c,d,e,f){var g=this.planes;return g[0].copy(a),g[1].copy(b),g[2].copy(c),g[3].copy(d),g[4].copy(e),g[5].copy(f),this},copy:function(a){for(var b=this.planes,c=0;6>c;c++)b[c].copy(a.planes[c]);return this},setFromMatrix:function(a){var b=this.planes,c=a.elements;a=c[0];var d=c[1],e=c[2],f=c[3],g=c[4],h=c[5],i=c[6],j=c[7],k=c[8],l=c[9],m=c[10],n=c[11],o=c[12],p=c[13],q=c[14],c=c[15];return b[0].setComponents(f-a,j-g,n-k,c-o).normalize(),b[1].setComponents(f+a,j+g,n+k,c+o).normalize(),b[2].setComponents(f+d,j+h,n+l,c+p).normalize(),b[3].setComponents(f-d,j-h,n-l,c-p).normalize(),b[4].setComponents(f-e,j-i,n-m,c-q).normalize(),b[5].setComponents(f+e,j+i,n+m,c+q).normalize(),this},intersectsObject:function(){var a=new THREE.Sphere;return function(b){var c=b.geometry;return null===c.boundingSphere&&c.computeBoundingSphere(),a.copy(c.boundingSphere),a.applyMatrix4(b.matrixWorld),this.intersectsSphere(a)}}(),intersectsSphere:function(a){var b=this.planes,c=a.center;a=-a.radius;for(var d=0;6>d;d++)if(b[d].distanceToPoint(c)<a)return!1;return!0},intersectsBox:function(){var a=new THREE.Vector3,b=new THREE.Vector3;return function(c){for(var d=this.planes,e=0;6>e;e++){var f=d[e];a.x=0<f.normal.x?c.min.x:c.max.x,b.x=0<f.normal.x?c.max.x:c.min.x,a.y=0<f.normal.y?c.min.y:c.max.y,b.y=0<f.normal.y?c.max.y:c.min.y,a.z=0<f.normal.z?c.min.z:c.max.z,b.z=0<f.normal.z?c.max.z:c.min.z;var g=f.distanceToPoint(a),f=f.distanceToPoint(b);if(0>g&&0>f)return!1}return!0}}(),containsPoint:function(a){for(var b=this.planes,c=0;6>c;c++)if(0>b[c].distanceToPoint(a))return!1;return!0},clone:function(){return(new THREE.Frustum).copy(this)}},THREE.Plane=function(a,b){this.normal=void 0!==a?a:new THREE.Vector3(1,0,0),this.constant=void 0!==b?b:0},THREE.Plane.prototype={constructor:THREE.Plane,set:function(a,b){return this.normal.copy(a),this.constant=b,this},setComponents:function(a,b,c,d){return this.normal.set(a,b,c),this.constant=d,this},setFromNormalAndCoplanarPoint:function(a,b){return this.normal.copy(a),this.constant=-b.dot(this.normal),this},setFromCoplanarPoints:function(){var a=new THREE.Vector3,b=new THREE.Vector3;return function(c,d,e){return d=a.subVectors(e,d).cross(b.subVectors(c,d)).normalize(),this.setFromNormalAndCoplanarPoint(d,c),this}}(),copy:function(a){return this.normal.copy(a.normal),this.constant=a.constant,this},normalize:function(){var a=1/this.normal.length();return this.normal.multiplyScalar(a),this.constant*=a,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(a){return this.normal.dot(a)+this.constant},distanceToSphere:function(a){return this.distanceToPoint(a.center)-a.radius},projectPoint:function(a,b){return this.orthoPoint(a,b).sub(a).negate()},orthoPoint:function(a,b){var c=this.distanceToPoint(a);return(b||new THREE.Vector3).copy(this.normal).multiplyScalar(c)},isIntersectionLine:function(a){var b=this.distanceToPoint(a.start);return a=this.distanceToPoint(a.end),0>b&&a>0||0>a&&b>0},intersectLine:function(){var a=new THREE.Vector3;return function(b,c){var d=c||new THREE.Vector3,e=b.delta(a),f=this.normal.dot(e);return 0!=f?(f=-(b.start.dot(this.normal)+this.constant)/f,0>f||f>1?void 0:d.copy(e).multiplyScalar(f).add(b.start)):0==this.distanceToPoint(b.start)?d.copy(b.start):void 0}}(),coplanarPoint:function(a){return(a||new THREE.Vector3).copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Matrix3;return function(d,e){var f=e||c.getNormalMatrix(d),f=a.copy(this.normal).applyMatrix3(f),g=this.coplanarPoint(b);return g.applyMatrix4(d),this.setFromNormalAndCoplanarPoint(f,g),this}}(),translate:function(a){return this.constant-=a.dot(this.normal),this},equals:function(a){return a.normal.equals(this.normal)&&a.constant==this.constant},clone:function(){return(new THREE.Plane).copy(this)}},THREE.Math={generateUUID:function(){var a,b="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),c=Array(36),d=0;return function(){for(var e=0;36>e;e++)8==e||13==e||18==e||23==e?c[e]="-":14==e?c[e]="4":(2>=d&&(d=33554432+16777216*Math.random()|0),a=15&d,d>>=4,c[e]=b[19==e?3&a|8:a]);return c.join("")}}(),clamp:function(a,b,c){return b>a?b:a>c?c:a},clampBottom:function(a,b){return b>a?b:a},mapLinear:function(a,b,c,d,e){return d+(a-b)*(e-d)/(c-b)},smoothstep:function(a,b,c){return b>=a?0:a>=c?1:(a=(a-b)/(c-b),a*a*(3-2*a))},smootherstep:function(a,b,c){return b>=a?0:a>=c?1:(a=(a-b)/(c-b),a*a*a*(a*(6*a-15)+10))},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(a,b){return a+Math.floor(Math.random()*(b-a+1))},randFloat:function(a,b){return a+Math.random()*(b-a)},randFloatSpread:function(a){return a*(.5-Math.random())},sign:function(a){return 0>a?-1:a>0?1:0},degToRad:function(){var a=Math.PI/180;return function(b){return b*a}}(),radToDeg:function(){var a=180/Math.PI;return function(b){return b*a}}(),isPowerOfTwo:function(a){return 0===(a&a-1)&&0!==a}},THREE.Spline=function(a){function b(a,b,c,d,e,f,g){return a=.5*(c-a),d=.5*(d-b),(2*(b-c)+a+d)*g+(-3*(b-c)-2*a-d)*f+a*e+b}this.points=a;var c,d,e,f,g,h,i,j,k,l=[],m={x:0,y:0,z:0};this.initFromArray=function(a){this.points=[];for(var b=0;b<a.length;b++)this.points[b]={x:a[b][0],y:a[b][1],z:a[b][2]}},this.getPoint=function(a){return c=(this.points.length-1)*a,d=Math.floor(c),e=c-d,l[0]=0===d?d:d-1,l[1]=d,l[2]=d>this.points.length-2?this.points.length-1:d+1,l[3]=d>this.points.length-3?this.points.length-1:d+2,h=this.points[l[0]],i=this.points[l[1]],j=this.points[l[2]],k=this.points[l[3]],f=e*e,g=e*f,m.x=b(h.x,i.x,j.x,k.x,e,f,g),m.y=b(h.y,i.y,j.y,k.y,e,f,g),m.z=b(h.z,i.z,j.z,k.z,e,f,g),m},this.getControlPointsArray=function(){var a,b,c=this.points.length,d=[];for(a=0;c>a;a++)b=this.points[a],d[a]=[b.x,b.y,b.z];return d},this.getLength=function(a){var b,c,d,e=b=b=0,f=new THREE.Vector3,g=new THREE.Vector3,h=[],i=0;for(h[0]=0,a||(a=100),c=this.points.length*a,f.copy(this.points[0]),a=1;c>a;a++)b=a/c,d=this.getPoint(b),g.copy(d),i+=g.distanceTo(f),f.copy(d),b*=this.points.length-1,b=Math.floor(b),b!=e&&(h[b]=i,e=b);return h[h.length]=i,{chunks:h,total:i}},this.reparametrizeByArcLength=function(a){var b,c,d,e,f,g,h=[],i=new THREE.Vector3,j=this.getLength();for(h.push(i.copy(this.points[0]).clone()),b=1;b<this.points.length;b++){for(c=j.chunks[b]-j.chunks[b-1],g=Math.ceil(a*c/j.total),e=(b-1)/(this.points.length-1),f=b/(this.points.length-1),c=1;g-1>c;c++)d=e+1/g*c*(f-e),d=this.getPoint(d),h.push(i.copy(d).clone());h.push(i.copy(this.points[b]).clone())}this.points=h}},THREE.Triangle=function(a,b,c){this.a=void 0!==a?a:new THREE.Vector3,this.b=void 0!==b?b:new THREE.Vector3,this.c=void 0!==c?c:new THREE.Vector3},THREE.Triangle.normal=function(){var a=new THREE.Vector3;return function(b,c,d,e){return e=e||new THREE.Vector3,e.subVectors(d,c),a.subVectors(b,c),e.cross(a),b=e.lengthSq(),b>0?e.multiplyScalar(1/Math.sqrt(b)):e.set(0,0,0)}}(),THREE.Triangle.barycoordFromPoint=function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Vector3;return function(d,e,f,g,h){a.subVectors(g,e),b.subVectors(f,e),c.subVectors(d,e),d=a.dot(a),e=a.dot(b),f=a.dot(c);var i=b.dot(b);g=b.dot(c);var j=d*i-e*e;return h=h||new THREE.Vector3,0==j?h.set(-2,-1,-1):(j=1/j,i=(i*f-e*g)*j,d=(d*g-e*f)*j,h.set(1-i-d,d,i))}}(),THREE.Triangle.containsPoint=function(){var a=new THREE.Vector3;return function(b,c,d,e){return b=THREE.Triangle.barycoordFromPoint(b,c,d,e,a),0<=b.x&&0<=b.y&&1>=b.x+b.y}}(),THREE.Triangle.prototype={constructor:THREE.Triangle,set:function(a,b,c){return this.a.copy(a),this.b.copy(b),this.c.copy(c),this},setFromPointsAndIndices:function(a,b,c,d){return this.a.copy(a[b]),this.b.copy(a[c]),this.c.copy(a[d]),this},copy:function(a){return this.a.copy(a.a),this.b.copy(a.b),this.c.copy(a.c),this},area:function(){var a=new THREE.Vector3,b=new THREE.Vector3;return function(){return a.subVectors(this.c,this.b),b.subVectors(this.a,this.b),.5*a.cross(b).length()}}(),midpoint:function(a){return(a||new THREE.Vector3).addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(a){return THREE.Triangle.normal(this.a,this.b,this.c,a)},plane:function(a){return(a||new THREE.Plane).setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(a,b){return THREE.Triangle.barycoordFromPoint(a,this.a,this.b,this.c,b)},containsPoint:function(a){return THREE.Triangle.containsPoint(a,this.a,this.b,this.c)},equals:function(a){return a.a.equals(this.a)&&a.b.equals(this.b)&&a.c.equals(this.c)},clone:function(){return(new THREE.Triangle).copy(this)}},THREE.Vertex=function(a){return console.warn("THREE.Vertex has been DEPRECATED. Use THREE.Vector3 instead."),a},THREE.Clock=function(a){this.autoStart=void 0!==a?a:!0,this.elapsedTime=this.oldTime=this.startTime=0,this.running=!1},THREE.Clock.prototype={constructor:THREE.Clock,start:function(){this.oldTime=this.startTime=void 0!==self.performance&&void 0!==self.performance.now?self.performance.now():Date.now(),this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var a=0;if(this.autoStart&&!this.running&&this.start(),this.running){var b=void 0!==self.performance&&void 0!==self.performance.now?self.performance.now():Date.now(),a=.001*(b-this.oldTime);this.oldTime=b,this.elapsedTime+=a}return a}},THREE.EventDispatcher=function(){},THREE.EventDispatcher.prototype={constructor:THREE.EventDispatcher,apply:function(a){a.addEventListener=THREE.EventDispatcher.prototype.addEventListener,a.hasEventListener=THREE.EventDispatcher.prototype.hasEventListener,a.removeEventListener=THREE.EventDispatcher.prototype.removeEventListener,a.dispatchEvent=THREE.EventDispatcher.prototype.dispatchEvent},addEventListener:function(a,b){void 0===this._listeners&&(this._listeners={});var c=this._listeners;void 0===c[a]&&(c[a]=[]),-1===c[a].indexOf(b)&&c[a].push(b)},hasEventListener:function(a,b){if(void 0===this._listeners)return!1;var c=this._listeners;return void 0!==c[a]&&-1!==c[a].indexOf(b)},removeEventListener:function(a,b){if(void 0!==this._listeners){var c=this._listeners[a];if(void 0!==c){var d=c.indexOf(b);-1!==d&&c.splice(d,1)}}},dispatchEvent:function(a){if(void 0!==this._listeners){var b=this._listeners[a.type];if(void 0!==b){a.target=this;for(var c=[],d=b.length,e=0;d>e;e++)c[e]=b[e];for(e=0;d>e;e++)c[e].call(this,a)}}}},function(a){a.Raycaster=function(b,c,d,e){this.ray=new a.Ray(b,c),this.near=d||0,this.far=e||1/0};var b=new a.Sphere,c=new a.Ray;new a.Plane,new a.Vector3;var d=new a.Vector3,e=new a.Matrix4,f=function(a,b){return a.distance-b.distance},g=new a.Vector3,h=new a.Vector3,i=new a.Vector3,j=function(f,k,l){if(f instanceof a.Sprite){d.setFromMatrixPosition(f.matrixWorld);var m=k.ray.distanceToPoint(d);if(m>f.scale.x)return l;l.push({distance:m,point:f.position,face:null,object:f})}else if(f instanceof a.LOD)d.setFromMatrixPosition(f.matrixWorld),m=k.ray.origin.distanceTo(d),j(f.getObjectForDistance(m),k,l);else if(f instanceof a.Mesh){var n=f.geometry;if(null===n.boundingSphere&&n.computeBoundingSphere(),b.copy(n.boundingSphere),b.applyMatrix4(f.matrixWorld),!1===k.ray.isIntersectionSphere(b))return l;if(e.getInverse(f.matrixWorld),c.copy(k.ray).applyMatrix4(e),null!==n.boundingBox&&!1===c.isIntersectionBox(n.boundingBox))return l;if(n instanceof a.BufferGeometry){var o=f.material;if(void 0===o)return l;var p,q,r=n.attributes,s=k.precision;if(void 0!==r.index){var t=r.index.array,u=r.position.array,v=n.offsets;0===v.length&&(v=[{start:0,count:u.length,index:0}]);for(var w=0,x=v.length;x>w;++w)for(var r=v[w].start,y=v[w].index,n=r,z=r+v[w].count;z>n;n+=3){r=y+t[n],p=y+t[n+1],q=y+t[n+2],g.set(u[3*r],u[3*r+1],u[3*r+2]),h.set(u[3*p],u[3*p+1],u[3*p+2]),i.set(u[3*q],u[3*q+1],u[3*q+2]);var A=o.side===a.BackSide?c.intersectTriangle(i,h,g,!0):c.intersectTriangle(g,h,i,o.side!==a.DoubleSide);null!==A&&(A.applyMatrix4(f.matrixWorld),m=k.ray.origin.distanceTo(A),s>m||m<k.near||m>k.far||l.push({distance:m,point:A,indices:[r,p,q],face:null,faceIndex:null,object:f}))}}else for(u=r.position.array,n=0,z=r.position.array.length;z>n;n+=3)r=n,p=n+1,q=n+2,g.set(u[3*r],u[3*r+1],u[3*r+2]),h.set(u[3*p],u[3*p+1],u[3*p+2]),i.set(u[3*q],u[3*q+1],u[3*q+2]),A=o.side===a.BackSide?c.intersectTriangle(i,h,g,!0):c.intersectTriangle(g,h,i,o.side!==a.DoubleSide),null!==A&&(A.applyMatrix4(f.matrixWorld),m=k.ray.origin.distanceTo(A),s>m||m<k.near||m>k.far||l.push({distance:m,point:A,indices:[r,p,q],face:null,faceIndex:null,object:f}))}else if(n instanceof a.Geometry)for(u=f.material instanceof a.MeshFaceMaterial,v=!0===u?f.material.materials:null,s=k.precision,t=n.vertices,w=0,x=n.faces.length;x>w;w++)if(y=n.faces[w],o=!0===u?v[y.materialIndex]:f.material,void 0!==o){if(r=t[y.a],p=t[y.b],q=t[y.c],!0===o.morphTargets){m=n.morphTargets,A=f.morphTargetInfluences,g.set(0,0,0),h.set(0,0,0),i.set(0,0,0);for(var z=0,B=m.length;B>z;z++){var C=A[z];if(0!==C){var D=m[z].vertices;g.x+=(D[y.a].x-r.x)*C,g.y+=(D[y.a].y-r.y)*C,g.z+=(D[y.a].z-r.z)*C,h.x+=(D[y.b].x-p.x)*C,h.y+=(D[y.b].y-p.y)*C,h.z+=(D[y.b].z-p.z)*C,i.x+=(D[y.c].x-q.x)*C,i.y+=(D[y.c].y-q.y)*C,i.z+=(D[y.c].z-q.z)*C}}g.add(r),h.add(p),i.add(q),r=g,p=h,q=i}A=o.side===a.BackSide?c.intersectTriangle(q,p,r,!0):c.intersectTriangle(r,p,q,o.side!==a.DoubleSide),null!==A&&(A.applyMatrix4(f.matrixWorld),m=k.ray.origin.distanceTo(A),s>m||m<k.near||m>k.far||l.push({distance:m,point:A,face:y,faceIndex:w,object:f}))}}else if(f instanceof a.Line){if(s=k.linePrecision,o=s*s,n=f.geometry,null===n.boundingSphere&&n.computeBoundingSphere(),b.copy(n.boundingSphere),b.applyMatrix4(f.matrixWorld),!1===k.ray.isIntersectionSphere(b))return l;if(e.getInverse(f.matrixWorld),c.copy(k.ray).applyMatrix4(e),n instanceof a.Geometry)for(t=n.vertices,s=t.length,r=new a.Vector3,p=new a.Vector3,q=f.type===a.LineStrip?1:2,n=0;s-1>n;n+=q)c.distanceSqToSegment(t[n],t[n+1],p,r)>o||(m=c.origin.distanceTo(p),m<k.near||m>k.far||l.push({distance:m,point:r.clone().applyMatrix4(f.matrixWorld),face:null,faceIndex:null,object:f}))}},k=function(a,b,c){a=a.getDescendants();for(var d=0,e=a.length;e>d;d++)j(a[d],b,c)};a.Raycaster.prototype.precision=1e-4,a.Raycaster.prototype.linePrecision=1,a.Raycaster.prototype.set=function(a,b){this.ray.set(a,b)},a.Raycaster.prototype.intersectObject=function(a,b){var c=[];return!0===b&&k(a,this,c),j(a,this,c),c.sort(f),c},a.Raycaster.prototype.intersectObjects=function(a,b){for(var c=[],d=0,e=a.length;e>d;d++)j(a[d],this,c),!0===b&&k(a[d],this,c);return c.sort(f),c}}(THREE),THREE.Object3D=function(){this.id=THREE.Object3DIdCount++,this.uuid=THREE.Math.generateUUID(),this.name="",this.parent=void 0,this.children=[],this.up=new THREE.Vector3(0,1,0),this.position=new THREE.Vector3;var a=this;Object.defineProperties(this,{rotation:{enumerable:!0,value:(new THREE.Euler).onChange(function(){a.quaternion.setFromEuler(a.rotation,!1)})},quaternion:{enumerable:!0,value:(new THREE.Quaternion).onChange(function(){a.rotation.setFromQuaternion(a.quaternion,void 0,!1)})},scale:{enumerable:!0,value:new THREE.Vector3(1,1,1)}}),this.renderDepth=null,this.rotationAutoUpdate=!0,this.matrix=new THREE.Matrix4,this.matrixWorld=new THREE.Matrix4,this.matrixAutoUpdate=!0,this.matrixWorldNeedsUpdate=!1,this.visible=!0,this.receiveShadow=this.castShadow=!1,this.frustumCulled=!0,this.userData={}},THREE.Object3D.prototype={constructor:THREE.Object3D,get eulerOrder(){return console.warn("DEPRECATED: Object3D's .eulerOrder has been moved to Object3D's .rotation.order."),this.rotation.order},set eulerOrder(a){console.warn("DEPRECATED: Object3D's .eulerOrder has been moved to Object3D's .rotation.order."),this.rotation.order=a},get useQuaternion(){console.warn("DEPRECATED: Object3D's .useQuaternion has been removed. The library now uses quaternions by default.")},set useQuaternion(a){console.warn("DEPRECATED: Object3D's .useQuaternion has been removed. The library now uses quaternions by default.")},applyMatrix:function(a){this.matrix.multiplyMatrices(a,this.matrix),this.matrix.decompose(this.position,this.quaternion,this.scale)},setRotationFromAxisAngle:function(a,b){this.quaternion.setFromAxisAngle(a,b)},setRotationFromEuler:function(a){this.quaternion.setFromEuler(a,!0)},setRotationFromMatrix:function(a){this.quaternion.setFromRotationMatrix(a)},setRotationFromQuaternion:function(a){this.quaternion.copy(a)},rotateOnAxis:function(){var a=new THREE.Quaternion;return function(b,c){return a.setFromAxisAngle(b,c),this.quaternion.multiply(a),this}}(),rotateX:function(){var a=new THREE.Vector3(1,0,0);return function(b){return this.rotateOnAxis(a,b)}}(),rotateY:function(){var a=new THREE.Vector3(0,1,0);return function(b){return this.rotateOnAxis(a,b)}}(),rotateZ:function(){var a=new THREE.Vector3(0,0,1);return function(b){return this.rotateOnAxis(a,b)}}(),translateOnAxis:function(){var a=new THREE.Vector3;return function(b,c){return a.copy(b),a.applyQuaternion(this.quaternion),this.position.add(a.multiplyScalar(c)),this}}(),translate:function(a,b){return console.warn("DEPRECATED: Object3D's .translate() has been removed. Use .translateOnAxis( axis, distance ) instead. Note args have been changed."),this.translateOnAxis(b,a)},translateX:function(){var a=new THREE.Vector3(1,0,0);return function(b){return this.translateOnAxis(a,b)}}(),translateY:function(){var a=new THREE.Vector3(0,1,0);return function(b){return this.translateOnAxis(a,b)}}(),translateZ:function(){var a=new THREE.Vector3(0,0,1);return function(b){return this.translateOnAxis(a,b)}}(),localToWorld:function(a){return a.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var a=new THREE.Matrix4;return function(b){return b.applyMatrix4(a.getInverse(this.matrixWorld))}}(),lookAt:function(){var a=new THREE.Matrix4;return function(b){a.lookAt(b,this.position,this.up),this.quaternion.setFromRotationMatrix(a)}}(),add:function(a){if(a===this)console.warn("THREE.Object3D.add: An object can't be added as a child of itself.");else if(a instanceof THREE.Object3D){void 0!==a.parent&&a.parent.remove(a),a.parent=this,a.dispatchEvent({type:"added"}),this.children.push(a);for(var b=this;void 0!==b.parent;)b=b.parent;void 0!==b&&b instanceof THREE.Scene&&b.__addObject(a)}},remove:function(a){var b=this.children.indexOf(a);if(-1!==b){for(a.parent=void 0,a.dispatchEvent({type:"removed"}),this.children.splice(b,1),b=this;void 0!==b.parent;)b=b.parent;void 0!==b&&b instanceof THREE.Scene&&b.__removeObject(a)}},traverse:function(a){a(this);for(var b=0,c=this.children.length;c>b;b++)this.children[b].traverse(a)},getObjectById:function(a,b){for(var c=0,d=this.children.length;d>c;c++){var e=this.children[c];if(e.id===a||!0===b&&(e=e.getObjectById(a,b),void 0!==e))return e}},getObjectByName:function(a,b){for(var c=0,d=this.children.length;d>c;c++){var e=this.children[c];if(e.name===a||!0===b&&(e=e.getObjectByName(a,b),void 0!==e))return e}},getChildByName:function(a,b){return console.warn("DEPRECATED: Object3D's .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(a,b)},getDescendants:function(a){void 0===a&&(a=[]),Array.prototype.push.apply(a,this.children);for(var b=0,c=this.children.length;c>b;b++)this.children[b].getDescendants(a);return a},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(a){!0===this.matrixAutoUpdate&&this.updateMatrix(),!0!==this.matrixWorldNeedsUpdate&&!0!==a||(void 0===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,a=!0);for(var b=0,c=this.children.length;c>b;b++)this.children[b].updateMatrixWorld(a)},clone:function(a,b){if(void 0===a&&(a=new THREE.Object3D),void 0===b&&(b=!0),a.name=this.name,a.up.copy(this.up),a.position.copy(this.position),a.quaternion.copy(this.quaternion),a.scale.copy(this.scale),a.renderDepth=this.renderDepth,a.rotationAutoUpdate=this.rotationAutoUpdate,a.matrix.copy(this.matrix),a.matrixWorld.copy(this.matrixWorld),a.matrixAutoUpdate=this.matrixAutoUpdate,a.matrixWorldNeedsUpdate=this.matrixWorldNeedsUpdate,a.visible=this.visible,a.castShadow=this.castShadow,a.receiveShadow=this.receiveShadow,a.frustumCulled=this.frustumCulled,a.userData=JSON.parse(JSON.stringify(this.userData)),!0===b)for(var c=0;c<this.children.length;c++)a.add(this.children[c].clone());return a}},THREE.EventDispatcher.prototype.apply(THREE.Object3D.prototype),THREE.Object3DIdCount=0,THREE.Projector=function(){function a(){if(i===t){var a=new THREE.RenderableVertex;return s.push(a),t++,i++,a}return s[i++]}function b(){if(k===v){var a=new THREE.RenderableFace;return u.push(a),v++,k++,a}return u[k++]}function c(){if(m===x){var a=new THREE.RenderableLine;return w.push(a),x++,m++,a}return w[m++]}function d(a,b){return a.z!==b.z?b.z-a.z:a.id!==b.id?a.id-b.id:0}function e(a,b){var c=0,d=1,e=a.z+a.w,f=b.z+b.w,g=-a.z+a.w,h=-b.z+b.w;return e>=0&&f>=0&&g>=0&&h>=0?!0:0>e&&0>f||0>g&&0>h?!1:(0>e?c=Math.max(c,e/(e-f)):0>f&&(d=Math.min(d,e/(e-f))),0>g?c=Math.max(c,g/(g-h)):0>h&&(d=Math.min(d,g/(g-h))),c>d?!1:(a.lerp(b,c),b.lerp(a,1-d),!0))}var f,g,h,i,j,k,l,m,n,o,p,q=[],r=0,s=[],t=0,u=[],v=0,w=[],x=0,y=[],z=0,A={objects:[],lights:[],elements:[]},B=new THREE.Vector3,C=new THREE.Vector3,D=new THREE.Vector3,E=new THREE.Vector3,F=new THREE.Vector4,G=new THREE.Box3(new THREE.Vector3(-1,-1,-1),new THREE.Vector3(1,1,1)),H=new THREE.Box3,I=Array(3),J=new THREE.Matrix4,K=new THREE.Matrix4,L=new THREE.Matrix4,M=new THREE.Matrix3,N=new THREE.Frustum,O=new THREE.Vector4,P=new THREE.Vector4;this.projectVector=function(a,b){return b.matrixWorldInverse.getInverse(b.matrixWorld),K.multiplyMatrices(b.projectionMatrix,b.matrixWorldInverse),a.applyProjection(K)},this.unprojectVector=function(){var a=new THREE.Matrix4;return function(b,c){return a.getInverse(c.projectionMatrix),K.multiplyMatrices(c.matrixWorld,a),b.applyProjection(K)}}(),this.pickingRay=function(a,b){a.z=-1;var c=new THREE.Vector3(a.x,a.y,1);return this.unprojectVector(a,b),this.unprojectVector(c,b),c.sub(a).normalize(),new THREE.Raycaster(a,c)};var Q=function(a){if(!1!==a.visible){if(a instanceof THREE.Light)A.lights.push(a);else if((a instanceof THREE.Mesh||a instanceof THREE.Line||a instanceof THREE.Sprite)&&(!1===a.frustumCulled||!0===N.intersectsObject(a))){if(g===r){var b=new THREE.RenderableObject;q.push(b),r++,g++,f=b}else f=q[g++];f.id=a.id,f.object=a,null!==a.renderDepth?f.z=a.renderDepth:(E.setFromMatrixPosition(a.matrixWorld),E.applyProjection(K),f.z=E.z),A.objects.push(f)}for(var b=0,c=a.children.length;c>b;b++)Q(a.children[b])}},R=new function(){var d=[],e=[],f=null,g=null,i=new THREE.Matrix3,k=function(a){var b=a.positionWorld,c=a.positionScreen;b.copy(a.position).applyMatrix4(p),c.copy(b).applyMatrix4(K),b=1/c.w,c.x*=b,c.y*=b,c.z*=b,a.visible=-1<=c.x&&1>=c.x&&-1<=c.y&&1>=c.y&&-1<=c.z&&1>=c.z},m=function(a,b,c){return!0===a.visible||!0===b.visible||!0===c.visible?!0:(I[0]=a.positionScreen,I[1]=b.positionScreen,I[2]=c.positionScreen,G.isIntersectionBox(H.setFromPoints(I)))},n=function(a,b,c){return 0>(c.positionScreen.x-a.positionScreen.x)*(b.positionScreen.y-a.positionScreen.y)-(c.positionScreen.y-a.positionScreen.y)*(b.positionScreen.x-a.positionScreen.x)};return{setObject:function(a){f=a,g=f.material,i.getNormalMatrix(f.matrixWorld),d.length=0,e.length=0},projectVertex:k,checkTriangleVisibility:m,checkBackfaceCulling:n,pushVertex:function(b,c,d){h=a(),h.position.set(b,c,d),k(h)},pushNormal:function(a,b,c){d.push(a,b,c)},pushUv:function(a,b){e.push(a,b)},pushLine:function(a,b){var d=s[a],e=s[b];l=c(),l.id=f.id,l.v1.copy(d),l.v2.copy(e),l.z=(d.positionScreen.z+e.positionScreen.z)/2,l.material=f.material,A.elements.push(l)},pushTriangle:function(a,c,h){var k=s[a],l=s[c],o=s[h];if(!1!==m(k,l,o)&&(g.side===THREE.DoubleSide||!0===n(k,l,o))){for(j=b(),j.id=f.id,j.v1.copy(k),j.v2.copy(l),j.v3.copy(o),j.z=(k.positionScreen.z+l.positionScreen.z+o.positionScreen.z)/3,k=0;3>k;k++)l=3*arguments[k],o=j.vertexNormalsModel[k],o.set(d[l],d[l+1],d[l+2]),o.applyMatrix3(i).normalize(),l=2*arguments[k],j.uvs[k].set(e[l],e[l+1]);j.vertexNormalsLength=3,j.material=f.material,A.elements.push(j)}}}};this.projectScene=function(f,h,q,r){var t,u,v,w,x,E,G,H;for(o=m=k=0,A.elements.length=0,!0===f.autoUpdate&&f.updateMatrixWorld(),void 0===h.parent&&h.updateMatrixWorld(),J.copy(h.matrixWorldInverse.getInverse(h.matrixWorld)),K.multiplyMatrices(h.projectionMatrix,J),N.setFromMatrix(K),g=0,A.objects.length=0,A.lights.length=0,Q(f),!0===q&&A.objects.sort(d),f=0,q=A.objects.length;q>f;f++)if(t=A.objects[f].object,u=t.geometry,R.setObject(t),p=t.matrixWorld,i=0,t instanceof THREE.Mesh){if(u instanceof THREE.BufferGeometry){if(E=u.attributes,t=u.offsets,void 0!==E.position){for(G=E.position.array,u=0,w=G.length;w>u;u+=3)R.pushVertex(G[u],G[u+1],G[u+2]);if(void 0!==E.normal)for(H=E.normal.array,u=0,w=H.length;w>u;u+=3)R.pushNormal(H[u],H[u+1],H[u+2]);if(void 0!==E.uv)for(H=E.uv.array,u=0,w=H.length;w>u;u+=2)R.pushUv(H[u],H[u+1]);if(void 0!==E.index)if(E=E.index.array,0<t.length)for(f=0;f<t.length;f++)for(w=t[f],G=w.index,u=w.start,w=w.start+w.count;w>u;u+=3)R.pushTriangle(E[u]+G,E[u+1]+G,E[u+2]+G);else for(u=0,w=E.length;w>u;u+=3)R.pushTriangle(E[u],E[u+1],E[u+2]);else for(u=0,w=G.length/3;w>u;u+=3)R.pushTriangle(u,u+1,u+2)}}else if(u instanceof THREE.Geometry){v=u.vertices,w=u.faces,E=u.faceVertexUvs[0],M.getNormalMatrix(p),G=t.material instanceof THREE.MeshFaceMaterial,H=!0===G?t.material:null;for(var I=0,S=v.length;S>I;I++){var T=v[I];R.pushVertex(T.x,T.y,T.z)}for(I=0,S=w.length;S>I;I++){v=w[I];var U=!0===G?H.materials[v.materialIndex]:t.material;if(void 0!==U){var V=U.side,T=s[v.a],W=s[v.b],X=s[v.c];if(!0===U.morphTargets){x=u.morphTargets;var Y=t.morphTargetInfluences,Z=T.position,$=W.position,_=X.position;B.set(0,0,0),C.set(0,0,0),D.set(0,0,0);for(var aa=0,ba=x.length;ba>aa;aa++){var ca=Y[aa];if(0!==ca){var da=x[aa].vertices;B.x+=(da[v.a].x-Z.x)*ca,B.y+=(da[v.a].y-Z.y)*ca,B.z+=(da[v.a].z-Z.z)*ca,C.x+=(da[v.b].x-$.x)*ca,C.y+=(da[v.b].y-$.y)*ca,C.z+=(da[v.b].z-$.z)*ca,D.x+=(da[v.c].x-_.x)*ca,D.y+=(da[v.c].y-_.y)*ca,D.z+=(da[v.c].z-_.z)*ca}}T.position.add(B),W.position.add(C),X.position.add(D),R.projectVertex(T),R.projectVertex(W),R.projectVertex(X)}if(!1!==R.checkTriangleVisibility(T,W,X)){if(Y=R.checkBackfaceCulling(T,W,X),V!==THREE.DoubleSide){if(V===THREE.FrontSide&&!1===Y)continue;if(V===THREE.BackSide&&!0===Y)continue}for(j=b(),j.id=t.id,j.v1.copy(T),j.v2.copy(W),j.v3.copy(X),j.normalModel.copy(v.normal),!1!==Y||V!==THREE.BackSide&&V!==THREE.DoubleSide||j.normalModel.negate(),j.normalModel.applyMatrix3(M).normalize(),x=v.vertexNormals,Z=0,$=Math.min(x.length,3);$>Z;Z++)_=j.vertexNormalsModel[Z],_.copy(x[Z]),!1!==Y||V!==THREE.BackSide&&V!==THREE.DoubleSide||_.negate(),_.applyMatrix3(M).normalize();if(j.vertexNormalsLength=x.length,V=E[I],void 0!==V)for(x=0;3>x;x++)j.uvs[x].copy(V[x]);j.color=v.color,j.material=U,j.z=(T.positionScreen.z+W.positionScreen.z+X.positionScreen.z)/3,A.elements.push(j)}}}}}else if(t instanceof THREE.Line){if(u instanceof THREE.BufferGeometry){if(E=u.attributes,void 0!==E.position){for(G=E.position.array,u=0,w=G.length;w>u;u+=3)R.pushVertex(G[u],G[u+1],G[u+2]);if(void 0!==E.index)for(E=E.index.array,u=0,w=E.length;w>u;u+=2)R.pushLine(E[u],E[u+1]);else for(u=0,w=G.length/3-1;w>u;u++)R.pushLine(u,u+1)}}else if(u instanceof THREE.Geometry&&(L.multiplyMatrices(K,p),v=t.geometry.vertices,0!==v.length))for(T=a(),T.positionScreen.copy(v[0]).applyMatrix4(L),u=t.type===THREE.LinePieces?2:1,I=1,S=v.length;S>I;I++)T=a(),T.positionScreen.copy(v[I]).applyMatrix4(L),(I+1)%u>0||(W=s[i-2],O.copy(T.positionScreen),P.copy(W.positionScreen),!0===e(O,P)&&(O.multiplyScalar(1/O.w),P.multiplyScalar(1/P.w),l=c(),l.id=t.id,l.v1.positionScreen.copy(O),l.v2.positionScreen.copy(P),l.z=Math.max(O.z,P.z),l.material=t.material,t.material.vertexColors===THREE.VertexColors&&(l.vertexColors[0].copy(t.geometry.colors[I]),l.vertexColors[1].copy(t.geometry.colors[I-1])),A.elements.push(l)))}else t instanceof THREE.Sprite&&(F.set(p.elements[12],p.elements[13],p.elements[14],1),F.applyMatrix4(K),u=1/F.w,F.z*=u,-1<=F.z&&1>=F.z&&(o===z?(w=new THREE.RenderableSprite,y.push(w),z++,o++,n=w):n=y[o++],n.id=t.id,n.x=F.x*u,n.y=F.y*u,n.z=F.z,n.object=t,n.rotation=t.rotation,n.scale.x=t.scale.x*Math.abs(n.x-(F.x+h.projectionMatrix.elements[0])/(F.w+h.projectionMatrix.elements[12])),n.scale.y=t.scale.y*Math.abs(n.y-(F.y+h.projectionMatrix.elements[5])/(F.w+h.projectionMatrix.elements[13])),n.material=t.material,A.elements.push(n)));return!0===r&&A.elements.sort(d),A}},THREE.Face3=function(a,b,c,d,e,f){this.a=a,this.b=b,
this.c=c,this.normal=d instanceof THREE.Vector3?d:new THREE.Vector3,this.vertexNormals=d instanceof Array?d:[],this.color=e instanceof THREE.Color?e:new THREE.Color,this.vertexColors=e instanceof Array?e:[],this.vertexTangents=[],this.materialIndex=void 0!==f?f:0},THREE.Face3.prototype={constructor:THREE.Face3,clone:function(){var a=new THREE.Face3(this.a,this.b,this.c);a.normal.copy(this.normal),a.color.copy(this.color),a.materialIndex=this.materialIndex;var b,c;for(b=0,c=this.vertexNormals.length;c>b;b++)a.vertexNormals[b]=this.vertexNormals[b].clone();for(b=0,c=this.vertexColors.length;c>b;b++)a.vertexColors[b]=this.vertexColors[b].clone();for(b=0,c=this.vertexTangents.length;c>b;b++)a.vertexTangents[b]=this.vertexTangents[b].clone();return a}},THREE.Face4=function(a,b,c,d,e,f,g){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new THREE.Face3(a,b,c,e,f,g)},THREE.BufferAttribute=function(){},THREE.BufferAttribute.prototype={constructor:THREE.BufferAttribute,get length(){return this.array.length},set:function(a){this.array.set(a)},setX:function(a,b){this.array[a*this.itemSize]=b},setY:function(a,b){this.array[a*this.itemSize+1]=b},setZ:function(a,b){this.array[a*this.itemSize+2]=b},setXY:function(a,b,c){a*=this.itemSize,this.array[a]=b,this.array[a+1]=c},setXYZ:function(a,b,c,d){a*=this.itemSize,this.array[a]=b,this.array[a+1]=c,this.array[a+2]=d},setXYZW:function(a,b,c,d,e){a*=this.itemSize,this.array[a]=b,this.array[a+1]=c,this.array[a+2]=d,this.array[a+3]=e}},THREE.Int8Attribute=function(a,b){this.array=new Int8Array(a*b),this.itemSize=b},THREE.Int8Attribute.prototype=Object.create(THREE.BufferAttribute.prototype),THREE.Uint8Attribute=function(a,b){this.array=new Uint8Array(a*b),this.itemSize=b},THREE.Uint8Attribute.prototype=Object.create(THREE.BufferAttribute.prototype),THREE.Uint8ClampedAttribute=function(a,b){this.array=new Uint8ClampedArray(a*b),this.itemSize=b},THREE.Uint8ClampedAttribute.prototype=Object.create(THREE.BufferAttribute.prototype),THREE.Int16Attribute=function(a,b){this.array=new Int16Array(a*b),this.itemSize=b},THREE.Int16Attribute.prototype=Object.create(THREE.BufferAttribute.prototype),THREE.Uint16Attribute=function(a,b){this.array=new Uint16Array(a*b),this.itemSize=b},THREE.Uint16Attribute.prototype=Object.create(THREE.BufferAttribute.prototype),THREE.Int32Attribute=function(a,b){this.array=new Int32Array(a*b),this.itemSize=b},THREE.Int32Attribute.prototype=Object.create(THREE.BufferAttribute.prototype),THREE.Uint32Attribute=function(a,b){this.array=new Uint32Array(a*b),this.itemSize=b},THREE.Uint32Attribute.prototype=Object.create(THREE.BufferAttribute.prototype),THREE.Float32Attribute=function(a,b){this.array=new Float32Array(a*b),this.itemSize=b},THREE.Float32Attribute.prototype=Object.create(THREE.BufferAttribute.prototype),THREE.Float64Attribute=function(a,b){this.array=new Float64Array(a*b),this.itemSize=b},THREE.Float64Attribute.prototype=Object.create(THREE.BufferAttribute.prototype),THREE.BufferGeometry=function(){this.id=THREE.GeometryIdCount++,this.uuid=THREE.Math.generateUUID(),this.name="",this.attributes={},this.offsets=this.drawcalls=[],this.boundingSphere=this.boundingBox=null},THREE.BufferGeometry.prototype={constructor:THREE.BufferGeometry,addAttribute:function(a,b,c){!1==b instanceof THREE.BufferAttribute?(console.warn("DEPRECATED: BufferGeometry's addAttribute() now expects ( name, attribute )."),this.attributes[a]={array:b,itemSize:c}):this.attributes[a]=b},getAttribute:function(a){return this.attributes[a]},addDrawCall:function(a,b,c){this.drawcalls.push({start:a,count:b,index:void 0!==c?c:0})},applyMatrix:function(a){var b=this.attributes.position;void 0!==b&&(a.applyToVector3Array(b.array),b.needsUpdate=!0),b=this.attributes.normal,void 0!==b&&((new THREE.Matrix3).getNormalMatrix(a).applyToVector3Array(b.array),b.needsUpdate=!0)},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new THREE.Box3);var a=this.attributes.position.array;if(a){var b=this.boundingBox;3<=a.length&&(b.min.x=b.max.x=a[0],b.min.y=b.max.y=a[1],b.min.z=b.max.z=a[2]);for(var c=3,d=a.length;d>c;c+=3){var e=a[c],f=a[c+1],g=a[c+2];e<b.min.x?b.min.x=e:e>b.max.x&&(b.max.x=e),f<b.min.y?b.min.y=f:f>b.max.y&&(b.max.y=f),g<b.min.z?b.min.z=g:g>b.max.z&&(b.max.z=g)}}void 0!==a&&0!==a.length||(this.boundingBox.min.set(0,0,0),this.boundingBox.max.set(0,0,0))},computeBoundingSphere:function(){var a=new THREE.Box3,b=new THREE.Vector3;return function(){null===this.boundingSphere&&(this.boundingSphere=new THREE.Sphere);var c=this.attributes.position.array;if(c){a.makeEmpty();for(var d=this.boundingSphere.center,e=0,f=c.length;f>e;e+=3)b.set(c[e],c[e+1],c[e+2]),a.addPoint(b);a.center(d);for(var g=0,e=0,f=c.length;f>e;e+=3)b.set(c[e],c[e+1],c[e+2]),g=Math.max(g,d.distanceToSquared(b));this.boundingSphere.radius=Math.sqrt(g)}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){if(this.attributes.position){var a,b,c,d;if(a=this.attributes.position.array.length,void 0===this.attributes.normal)this.attributes.normal={itemSize:3,array:new Float32Array(a)};else for(a=0,b=this.attributes.normal.array.length;b>a;a++)this.attributes.normal.array[a]=0;var e,f,g,h,i,j,k=this.attributes.position.array,l=this.attributes.normal.array,m=new THREE.Vector3,n=new THREE.Vector3,o=new THREE.Vector3,p=new THREE.Vector3,q=new THREE.Vector3;if(this.attributes.index){var r=this.attributes.index.array,s=0<this.offsets.length?this.offsets:[{start:0,count:r.length,index:0}];for(c=0,d=s.length;d>c;++c){b=s[c].start,e=s[c].count;var t=s[c].index;for(a=b,b+=e;b>a;a+=3)e=t+r[a],f=t+r[a+1],g=t+r[a+2],h=k[3*e],i=k[3*e+1],j=k[3*e+2],m.set(h,i,j),h=k[3*f],i=k[3*f+1],j=k[3*f+2],n.set(h,i,j),h=k[3*g],i=k[3*g+1],j=k[3*g+2],o.set(h,i,j),p.subVectors(o,n),q.subVectors(m,n),p.cross(q),l[3*e]+=p.x,l[3*e+1]+=p.y,l[3*e+2]+=p.z,l[3*f]+=p.x,l[3*f+1]+=p.y,l[3*f+2]+=p.z,l[3*g]+=p.x,l[3*g+1]+=p.y,l[3*g+2]+=p.z}}else for(a=0,b=k.length;b>a;a+=9)h=k[a],i=k[a+1],j=k[a+2],m.set(h,i,j),h=k[a+3],i=k[a+4],j=k[a+5],n.set(h,i,j),h=k[a+6],i=k[a+7],j=k[a+8],o.set(h,i,j),p.subVectors(o,n),q.subVectors(m,n),p.cross(q),l[a]=p.x,l[a+1]=p.y,l[a+2]=p.z,l[a+3]=p.x,l[a+4]=p.y,l[a+5]=p.z,l[a+6]=p.x,l[a+7]=p.y,l[a+8]=p.z;this.normalizeNormals(),this.normalsNeedUpdate=!0}},computeTangents:function(){function a(a,b,c){l=d[3*a],m=d[3*a+1],n=d[3*a+2],o=d[3*b],p=d[3*b+1],q=d[3*b+2],r=d[3*c],s=d[3*c+1],t=d[3*c+2],u=f[2*a],v=f[2*a+1],w=f[2*b],x=f[2*b+1],y=f[2*c],z=f[2*c+1],A=o-l,B=r-l,C=p-m,D=s-m,E=q-n,F=t-n,G=w-u,H=y-u,I=x-v,J=z-v,K=1/(G*J-H*I),Q.set((J*A-I*B)*K,(J*C-I*D)*K,(J*E-I*F)*K),R.set((G*B-H*A)*K,(G*D-H*C)*K,(G*F-H*E)*K),i[a].add(Q),i[b].add(Q),i[c].add(Q),j[a].add(R),j[b].add(R),j[c].add(R)}function b(a){Z.x=e[3*a],Z.y=e[3*a+1],Z.z=e[3*a+2],$.copy(Z),V=i[a],X.copy(V),X.sub(Z.multiplyScalar(Z.dot(V))).normalize(),Y.crossVectors($,V),W=Y.dot(j[a]),U=0>W?-1:1,h[4*a]=X.x,h[4*a+1]=X.y,h[4*a+2]=X.z,h[4*a+3]=U}if(void 0===this.attributes.index||void 0===this.attributes.position||void 0===this.attributes.normal||void 0===this.attributes.uv)console.warn("Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()");else{var c=this.attributes.index.array,d=this.attributes.position.array,e=this.attributes.normal.array,f=this.attributes.uv.array,g=d.length/3;void 0===this.attributes.tangent&&(this.attributes.tangent={itemSize:4,array:new Float32Array(4*g)});for(var h=this.attributes.tangent.array,i=[],j=[],k=0;g>k;k++)i[k]=new THREE.Vector3,j[k]=new THREE.Vector3;var l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q=new THREE.Vector3,R=new THREE.Vector3,S=this.offsets,k=0;for(M=S.length;M>k;++k){L=S[k].start,N=S[k].count;var T=S[k].index,g=L;for(L+=N;L>g;g+=3)N=T+c[g],O=T+c[g+1],P=T+c[g+2],a(N,O,P)}var U,V,W,X=new THREE.Vector3,Y=new THREE.Vector3,Z=new THREE.Vector3,$=new THREE.Vector3,k=0;for(M=S.length;M>k;++k)for(L=S[k].start,N=S[k].count,T=S[k].index,g=L,L+=N;L>g;g+=3)N=T+c[g],O=T+c[g+1],P=T+c[g+2],b(N),b(O),b(P)}},computeOffsets:function(a){var b=a;void 0===a&&(b=65535),Date.now(),a=this.attributes.index.array;for(var c=this.attributes.position.array,d=a.length/3,e=new Uint16Array(a.length),f=0,g=0,h=[{start:0,count:0,index:0}],i=h[0],j=0,k=0,l=new Int32Array(6),m=new Int32Array(c.length),n=new Int32Array(c.length),o=0;o<c.length;o++)m[o]=-1,n[o]=-1;for(c=0;d>c;c++){for(var p=k=0;3>p;p++)o=a[3*c+p],-1==m[o]?(l[2*p]=o,l[2*p+1]=-1,k++):m[o]<i.index?(l[2*p]=o,l[2*p+1]=-1,j++):(l[2*p]=o,l[2*p+1]=m[o]);if(g+k>i.index+b)for(i={start:f,count:0,index:g},h.push(i),k=0;6>k;k+=2)p=l[k+1],p>-1&&p<i.index&&(l[k+1]=-1);for(k=0;6>k;k+=2)o=l[k],p=l[k+1],-1===p&&(p=g++),m[o]=p,n[p]=o,e[f++]=p-i.index,i.count++}return this.reorderBuffers(e,n,g),this.offsets=h},merge:function(){console.log("BufferGeometry.merge(): TODO")},normalizeNormals:function(){for(var a,b,c,d=this.attributes.normal.array,e=0,f=d.length;f>e;e+=3)a=d[e],b=d[e+1],c=d[e+2],a=1/Math.sqrt(a*a+b*b+c*c),d[e]*=a,d[e+1]*=a,d[e+2]*=a},reorderBuffers:function(a,b,c){var d,e={},f=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];for(d in this.attributes)if("index"!=d)for(var g=this.attributes[d].array,h=0,i=f.length;i>h;h++){var j=f[h];if(g instanceof j){e[d]=new j(this.attributes[d].itemSize*c);break}}for(f=0;c>f;f++)for(d in g=b[f],this.attributes)if("index"!=d)for(var h=this.attributes[d].array,i=this.attributes[d].itemSize,j=e[d],k=0;i>k;k++)j[f*i+k]=h[g*i+k];this.attributes.index.array=a;for(d in this.attributes)"index"!=d&&(this.attributes[d].array=e[d],this.attributes[d].numItems=this.attributes[d].itemSize*c)},clone:function(){var a,b=new THREE.BufferGeometry,c=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];for(a in this.attributes){for(var d=this.attributes[a],e=d.array,f={itemSize:d.itemSize,array:null},d=0,g=c.length;g>d;d++){var h=c[d];if(e instanceof h){f.array=new h(e);break}}b.attributes[a]=f}for(d=0,g=this.offsets.length;g>d;d++)c=this.offsets[d],b.offsets.push({start:c.start,index:c.index,count:c.count});return b},dispose:function(){this.dispatchEvent({type:"dispose"})}},THREE.EventDispatcher.prototype.apply(THREE.BufferGeometry.prototype),THREE.Geometry=function(){this.id=THREE.GeometryIdCount++,this.uuid=THREE.Math.generateUUID(),this.name="",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphColors=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingSphere=this.boundingBox=null,this.hasTangents=!1,this.dynamic=!0,this.buffersNeedUpdate=this.lineDistancesNeedUpdate=this.colorsNeedUpdate=this.tangentsNeedUpdate=this.normalsNeedUpdate=this.uvsNeedUpdate=this.elementsNeedUpdate=this.verticesNeedUpdate=!1},THREE.Geometry.prototype={constructor:THREE.Geometry,applyMatrix:function(a){for(var b=(new THREE.Matrix3).getNormalMatrix(a),c=0,d=this.vertices.length;d>c;c++)this.vertices[c].applyMatrix4(a);for(c=0,d=this.faces.length;d>c;c++){a=this.faces[c],a.normal.applyMatrix3(b).normalize();for(var e=0,f=a.vertexNormals.length;f>e;e++)a.vertexNormals[e].applyMatrix3(b).normalize()}this.boundingBox instanceof THREE.Box3&&this.computeBoundingBox(),this.boundingSphere instanceof THREE.Sphere&&this.computeBoundingSphere()},computeFaceNormals:function(){for(var a=new THREE.Vector3,b=new THREE.Vector3,c=0,d=this.faces.length;d>c;c++){var e=this.faces[c],f=this.vertices[e.a],g=this.vertices[e.b];a.subVectors(this.vertices[e.c],g),b.subVectors(f,g),a.cross(b),a.normalize(),e.normal.copy(a)}},computeVertexNormals:function(a){var b,c,d;for(d=Array(this.vertices.length),b=0,c=this.vertices.length;c>b;b++)d[b]=new THREE.Vector3;if(a){var e,f,g,h=new THREE.Vector3,i=new THREE.Vector3;for(new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,a=0,b=this.faces.length;b>a;a++)c=this.faces[a],e=this.vertices[c.a],f=this.vertices[c.b],g=this.vertices[c.c],h.subVectors(g,f),i.subVectors(e,f),h.cross(i),d[c.a].add(h),d[c.b].add(h),d[c.c].add(h)}else for(a=0,b=this.faces.length;b>a;a++)c=this.faces[a],d[c.a].add(c.normal),d[c.b].add(c.normal),d[c.c].add(c.normal);for(b=0,c=this.vertices.length;c>b;b++)d[b].normalize();for(a=0,b=this.faces.length;b>a;a++)c=this.faces[a],c.vertexNormals[0]=d[c.a].clone(),c.vertexNormals[1]=d[c.b].clone(),c.vertexNormals[2]=d[c.c].clone()},computeMorphNormals:function(){var a,b,c,d,e;for(c=0,d=this.faces.length;d>c;c++)for(e=this.faces[c],e.__originalFaceNormal?e.__originalFaceNormal.copy(e.normal):e.__originalFaceNormal=e.normal.clone(),e.__originalVertexNormals||(e.__originalVertexNormals=[]),a=0,b=e.vertexNormals.length;b>a;a++)e.__originalVertexNormals[a]?e.__originalVertexNormals[a].copy(e.vertexNormals[a]):e.__originalVertexNormals[a]=e.vertexNormals[a].clone();var f=new THREE.Geometry;for(f.faces=this.faces,a=0,b=this.morphTargets.length;b>a;a++){if(!this.morphNormals[a]){this.morphNormals[a]={},this.morphNormals[a].faceNormals=[],this.morphNormals[a].vertexNormals=[],e=this.morphNormals[a].faceNormals;var g,h,i=this.morphNormals[a].vertexNormals;for(c=0,d=this.faces.length;d>c;c++)g=new THREE.Vector3,h={a:new THREE.Vector3,b:new THREE.Vector3,c:new THREE.Vector3},e.push(g),i.push(h)}for(i=this.morphNormals[a],f.vertices=this.morphTargets[a].vertices,f.computeFaceNormals(),f.computeVertexNormals(),c=0,d=this.faces.length;d>c;c++)e=this.faces[c],g=i.faceNormals[c],h=i.vertexNormals[c],g.copy(e.normal),h.a.copy(e.vertexNormals[0]),h.b.copy(e.vertexNormals[1]),h.c.copy(e.vertexNormals[2])}for(c=0,d=this.faces.length;d>c;c++)e=this.faces[c],e.normal=e.__originalFaceNormal,e.vertexNormals=e.__originalVertexNormals},computeTangents:function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r=[],s=[];c=new THREE.Vector3;var t=new THREE.Vector3,u=new THREE.Vector3,v=new THREE.Vector3,w=new THREE.Vector3;for(a=0,b=this.vertices.length;b>a;a++)r[a]=new THREE.Vector3,s[a]=new THREE.Vector3;for(a=0,b=this.faces.length;b>a;a++)e=this.faces[a],f=this.faceVertexUvs[0][a],d=e.a,q=e.b,e=e.c,g=this.vertices[d],h=this.vertices[q],i=this.vertices[e],j=f[0],k=f[1],l=f[2],f=h.x-g.x,m=i.x-g.x,n=h.y-g.y,o=i.y-g.y,h=h.z-g.z,g=i.z-g.z,i=k.x-j.x,p=l.x-j.x,k=k.y-j.y,j=l.y-j.y,l=1/(i*j-p*k),c.set((j*f-k*m)*l,(j*n-k*o)*l,(j*h-k*g)*l),t.set((i*m-p*f)*l,(i*o-p*n)*l,(i*g-p*h)*l),r[d].add(c),r[q].add(c),r[e].add(c),s[d].add(t),s[q].add(t),s[e].add(t);for(t=["a","b","c","d"],a=0,b=this.faces.length;b>a;a++)for(e=this.faces[a],c=0;c<Math.min(e.vertexNormals.length,3);c++)w.copy(e.vertexNormals[c]),d=e[t[c]],q=r[d],u.copy(q),u.sub(w.multiplyScalar(w.dot(q))).normalize(),v.crossVectors(e.vertexNormals[c],q),d=v.dot(s[d]),d=0>d?-1:1,e.vertexTangents[c]=new THREE.Vector4(u.x,u.y,u.z,d);this.hasTangents=!0},computeLineDistances:function(){for(var a=0,b=this.vertices,c=0,d=b.length;d>c;c++)c>0&&(a+=b[c].distanceTo(b[c-1])),this.lineDistances[c]=a},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new THREE.Box3),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new THREE.Sphere),this.boundingSphere.setFromPoints(this.vertices)},merge:function(a,b,c){if(!1==a instanceof THREE.Geometry)console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",a);else{var d,e=this.vertices.length,f=this.vertices,g=a.vertices,h=this.faces,i=a.faces,j=this.faceVertexUvs[0];a=a.faceVertexUvs[0],void 0===c&&(c=0),void 0!==b&&(d=(new THREE.Matrix3).getNormalMatrix(b));for(var k=0,l=g.length;l>k;k++){var m=g[k].clone();void 0!==b&&m.applyMatrix4(b),f.push(m)}for(k=0,l=i.length;l>k;k++){var n,g=i[k],o=g.vertexNormals,p=g.vertexColors,m=new THREE.Face3(g.a+e,g.b+e,g.c+e);for(m.normal.copy(g.normal),void 0!==d&&m.normal.applyMatrix3(d).normalize(),b=0,f=o.length;f>b;b++)n=o[b].clone(),void 0!==d&&n.applyMatrix3(d).normalize(),m.vertexNormals.push(n);for(m.color.copy(g.color),b=0,f=p.length;f>b;b++)n=p[b],m.vertexColors.push(n.clone());m.materialIndex=g.materialIndex+c,h.push(m)}for(k=0,l=a.length;l>k;k++)if(c=a[k],d=[],void 0!==c){for(b=0,f=c.length;f>b;b++)d.push(new THREE.Vector2(c[b].x,c[b].y));j.push(d)}}},mergeVertices:function(){var a,b,c,d={},e=[],f=[],g=Math.pow(10,4);for(b=0,c=this.vertices.length;c>b;b++)a=this.vertices[b],a=Math.round(a.x*g)+"_"+Math.round(a.y*g)+"_"+Math.round(a.z*g),void 0===d[a]?(d[a]=b,e.push(this.vertices[b]),f[b]=e.length-1):f[b]=f[d[a]];for(d=[],b=0,c=this.faces.length;c>b;b++)for(g=this.faces[b],g.a=f[g.a],g.b=f[g.b],g.c=f[g.c],g=[g.a,g.b,g.c],a=0;3>a;a++)if(g[a]==g[(a+1)%3]){d.push(b);break}for(b=d.length-1;b>=0;b--)for(g=d[b],this.faces.splice(g,1),f=0,c=this.faceVertexUvs.length;c>f;f++)this.faceVertexUvs[f].splice(g,1);return b=this.vertices.length-e.length,this.vertices=e,b},makeGroups:function(){var a=0;return function(b,c){var d,e,f,g,h={},i=this.morphTargets.length,j=this.morphNormals.length;for(this.geometryGroups={},d=0,e=this.faces.length;e>d;d++)f=this.faces[d],f=b?f.materialIndex:0,f in h||(h[f]={hash:f,counter:0}),g=h[f].hash+"_"+h[f].counter,g in this.geometryGroups||(this.geometryGroups[g]={faces3:[],materialIndex:f,vertices:0,numMorphTargets:i,numMorphNormals:j}),this.geometryGroups[g].vertices+3>c&&(h[f].counter+=1,g=h[f].hash+"_"+h[f].counter,g in this.geometryGroups||(this.geometryGroups[g]={faces3:[],materialIndex:f,vertices:0,numMorphTargets:i,numMorphNormals:j})),this.geometryGroups[g].faces3.push(d),this.geometryGroups[g].vertices+=3;this.geometryGroupsList=[];for(var k in this.geometryGroups)this.geometryGroups[k].id=a++,this.geometryGroupsList.push(this.geometryGroups[k])}}(),clone:function(){for(var a=new THREE.Geometry,b=this.vertices,c=0,d=b.length;d>c;c++)a.vertices.push(b[c].clone());for(b=this.faces,c=0,d=b.length;d>c;c++)a.faces.push(b[c].clone());for(b=this.faceVertexUvs[0],c=0,d=b.length;d>c;c++){for(var e=b[c],f=[],g=0,h=e.length;h>g;g++)f.push(new THREE.Vector2(e[g].x,e[g].y));a.faceVertexUvs[0].push(f)}return a},dispose:function(){this.dispatchEvent({type:"dispose"})}},THREE.EventDispatcher.prototype.apply(THREE.Geometry.prototype),THREE.GeometryIdCount=0,THREE.Camera=function(){THREE.Object3D.call(this),this.matrixWorldInverse=new THREE.Matrix4,this.projectionMatrix=new THREE.Matrix4},THREE.Camera.prototype=Object.create(THREE.Object3D.prototype),THREE.Camera.prototype.lookAt=function(){var a=new THREE.Matrix4;return function(b){a.lookAt(this.position,b,this.up),this.quaternion.setFromRotationMatrix(a)}}(),THREE.Camera.prototype.clone=function(a){return void 0===a&&(a=new THREE.Camera),THREE.Object3D.prototype.clone.call(this,a),a.matrixWorldInverse.copy(this.matrixWorldInverse),a.projectionMatrix.copy(this.projectionMatrix),a},THREE.OrthographicCamera=function(a,b,c,d,e,f){THREE.Camera.call(this),this.left=a,this.right=b,this.top=c,this.bottom=d,this.near=void 0!==e?e:.1,this.far=void 0!==f?f:2e3,this.updateProjectionMatrix()},THREE.OrthographicCamera.prototype=Object.create(THREE.Camera.prototype),THREE.OrthographicCamera.prototype.updateProjectionMatrix=function(){this.projectionMatrix.makeOrthographic(this.left,this.right,this.top,this.bottom,this.near,this.far)},THREE.OrthographicCamera.prototype.clone=function(){var a=new THREE.OrthographicCamera;return THREE.Camera.prototype.clone.call(this,a),a.left=this.left,a.right=this.right,a.top=this.top,a.bottom=this.bottom,a.near=this.near,a.far=this.far,a},THREE.PerspectiveCamera=function(a,b,c,d){THREE.Camera.call(this),this.fov=void 0!==a?a:50,this.aspect=void 0!==b?b:1,this.near=void 0!==c?c:.1,this.far=void 0!==d?d:2e3,this.updateProjectionMatrix()},THREE.PerspectiveCamera.prototype=Object.create(THREE.Camera.prototype),THREE.PerspectiveCamera.prototype.setLens=function(a,b){void 0===b&&(b=24),this.fov=2*THREE.Math.radToDeg(Math.atan(b/(2*a))),this.updateProjectionMatrix()},THREE.PerspectiveCamera.prototype.setViewOffset=function(a,b,c,d,e,f){this.fullWidth=a,this.fullHeight=b,this.x=c,this.y=d,this.width=e,this.height=f,this.updateProjectionMatrix()},THREE.PerspectiveCamera.prototype.updateProjectionMatrix=function(){if(this.fullWidth){var a=this.fullWidth/this.fullHeight,b=Math.tan(THREE.Math.degToRad(.5*this.fov))*this.near,c=-b,d=a*c,a=Math.abs(a*b-d),c=Math.abs(b-c);this.projectionMatrix.makeFrustum(d+this.x*a/this.fullWidth,d+(this.x+this.width)*a/this.fullWidth,b-(this.y+this.height)*c/this.fullHeight,b-this.y*c/this.fullHeight,this.near,this.far)}else this.projectionMatrix.makePerspective(this.fov,this.aspect,this.near,this.far)},THREE.PerspectiveCamera.prototype.clone=function(){var a=new THREE.PerspectiveCamera;return THREE.Camera.prototype.clone.call(this,a),a.fov=this.fov,a.aspect=this.aspect,a.near=this.near,a.far=this.far,a},THREE.Light=function(a){THREE.Object3D.call(this),this.color=new THREE.Color(a)},THREE.Light.prototype=Object.create(THREE.Object3D.prototype),THREE.Light.prototype.clone=function(a){return void 0===a&&(a=new THREE.Light),THREE.Object3D.prototype.clone.call(this,a),a.color.copy(this.color),a},THREE.AmbientLight=function(a){THREE.Light.call(this,a)},THREE.AmbientLight.prototype=Object.create(THREE.Light.prototype),THREE.AmbientLight.prototype.clone=function(){var a=new THREE.AmbientLight;return THREE.Light.prototype.clone.call(this,a),a},THREE.AreaLight=function(a,b){THREE.Light.call(this,a),this.normal=new THREE.Vector3(0,-1,0),this.right=new THREE.Vector3(1,0,0),this.intensity=void 0!==b?b:1,this.height=this.width=1,this.constantAttenuation=1.5,this.linearAttenuation=.5,this.quadraticAttenuation=.1},THREE.AreaLight.prototype=Object.create(THREE.Light.prototype),THREE.DirectionalLight=function(a,b){THREE.Light.call(this,a),this.position.set(0,1,0),this.target=new THREE.Object3D,this.intensity=void 0!==b?b:1,this.onlyShadow=this.castShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraLeft=-500,this.shadowCameraTop=this.shadowCameraRight=500,this.shadowCameraBottom=-500,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapHeight=this.shadowMapWidth=512,this.shadowCascade=!1,this.shadowCascadeOffset=new THREE.Vector3(0,0,-1e3),this.shadowCascadeCount=2,this.shadowCascadeBias=[0,0,0],this.shadowCascadeWidth=[512,512,512],this.shadowCascadeHeight=[512,512,512],this.shadowCascadeNearZ=[-1,.99,.998],this.shadowCascadeFarZ=[.99,.998,1],this.shadowCascadeArray=[],this.shadowMatrix=this.shadowCamera=this.shadowMapSize=this.shadowMap=null},THREE.DirectionalLight.prototype=Object.create(THREE.Light.prototype),THREE.DirectionalLight.prototype.clone=function(){var a=new THREE.DirectionalLight;return THREE.Light.prototype.clone.call(this,a),a.target=this.target.clone(),a.intensity=this.intensity,a.castShadow=this.castShadow,a.onlyShadow=this.onlyShadow,a.shadowCameraNear=this.shadowCameraNear,a.shadowCameraFar=this.shadowCameraFar,a.shadowCameraLeft=this.shadowCameraLeft,a.shadowCameraRight=this.shadowCameraRight,a.shadowCameraTop=this.shadowCameraTop,a.shadowCameraBottom=this.shadowCameraBottom,a.shadowCameraVisible=this.shadowCameraVisible,a.shadowBias=this.shadowBias,a.shadowDarkness=this.shadowDarkness,a.shadowMapWidth=this.shadowMapWidth,a.shadowMapHeight=this.shadowMapHeight,a.shadowCascade=this.shadowCascade,a.shadowCascadeOffset.copy(this.shadowCascadeOffset),a.shadowCascadeCount=this.shadowCascadeCount,a.shadowCascadeBias=this.shadowCascadeBias.slice(0),a.shadowCascadeWidth=this.shadowCascadeWidth.slice(0),a.shadowCascadeHeight=this.shadowCascadeHeight.slice(0),a.shadowCascadeNearZ=this.shadowCascadeNearZ.slice(0),a.shadowCascadeFarZ=this.shadowCascadeFarZ.slice(0),a},THREE.HemisphereLight=function(a,b,c){THREE.Light.call(this,a),this.position.set(0,100,0),this.groundColor=new THREE.Color(b),this.intensity=void 0!==c?c:1},THREE.HemisphereLight.prototype=Object.create(THREE.Light.prototype),THREE.HemisphereLight.prototype.clone=function(){var a=new THREE.HemisphereLight;return THREE.Light.prototype.clone.call(this,a),a.groundColor.copy(this.groundColor),a.intensity=this.intensity,a},THREE.PointLight=function(a,b,c){THREE.Light.call(this,a),this.intensity=void 0!==b?b:1,this.distance=void 0!==c?c:0},THREE.PointLight.prototype=Object.create(THREE.Light.prototype),THREE.PointLight.prototype.clone=function(){var a=new THREE.PointLight;return THREE.Light.prototype.clone.call(this,a),a.intensity=this.intensity,a.distance=this.distance,a},THREE.SpotLight=function(a,b,c,d,e){THREE.Light.call(this,a),this.position.set(0,1,0),this.target=new THREE.Object3D,this.intensity=void 0!==b?b:1,this.distance=void 0!==c?c:0,this.angle=void 0!==d?d:Math.PI/3,this.exponent=void 0!==e?e:10,this.onlyShadow=this.castShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraFov=50,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapHeight=this.shadowMapWidth=512,this.shadowMatrix=this.shadowCamera=this.shadowMapSize=this.shadowMap=null},THREE.SpotLight.prototype=Object.create(THREE.Light.prototype),THREE.SpotLight.prototype.clone=function(){var a=new THREE.SpotLight;return THREE.Light.prototype.clone.call(this,a),a.target=this.target.clone(),a.intensity=this.intensity,a.distance=this.distance,a.angle=this.angle,a.exponent=this.exponent,a.castShadow=this.castShadow,a.onlyShadow=this.onlyShadow,a.shadowCameraNear=this.shadowCameraNear,a.shadowCameraFar=this.shadowCameraFar,a.shadowCameraFov=this.shadowCameraFov,a.shadowCameraVisible=this.shadowCameraVisible,a.shadowBias=this.shadowBias,a.shadowDarkness=this.shadowDarkness,a.shadowMapWidth=this.shadowMapWidth,a.shadowMapHeight=this.shadowMapHeight,a},THREE.Cache=function(){this.files={}},THREE.Cache.prototype={constructor:THREE.Cache,add:function(a,b){this.files[a]=b},get:function(a){return this.files[a]},remove:function(a){delete this.files[a]},clear:function(){this.files={}}},THREE.Loader=function(a){this.statusDomElement=(this.showStatus=a)?THREE.Loader.prototype.addStatusElement():null,this.imageLoader=new THREE.ImageLoader,this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){}},THREE.Loader.prototype={constructor:THREE.Loader,crossOrigin:void 0,addStatusElement:function(){var a=document.createElement("div");return a.style.position="absolute",a.style.right="0px",a.style.top="0px",a.style.fontSize="0.8em",a.style.textAlign="left",a.style.background="rgba(0,0,0,0.25)",a.style.color="#fff",a.style.width="120px",a.style.padding="0.5em 0.5em 0.5em 0.5em",a.style.zIndex=1e3,a.innerHTML="Loading ...",a},updateProgress:function(a){var b="Loaded ",b=a.total?b+((100*a.loaded/a.total).toFixed(0)+"%"):b+((a.loaded/1024).toFixed(2)+" KB");this.statusDomElement.innerHTML=b},extractUrlBase:function(a){return a=a.split("/"),1===a.length?"./":(a.pop(),a.join("/")+"/")},initMaterials:function(a,b){for(var c=[],d=0;d<a.length;++d)c[d]=this.createMaterial(a[d],b);return c},needsTangents:function(a){for(var b=0,c=a.length;c>b;b++)if(a[b]instanceof THREE.ShaderMaterial)return!0;return!1},createMaterial:function(a,b){function c(a){return a=Math.log(a)/Math.LN2,Math.pow(2,Math.round(a))}function d(a,d,e,g,h,i,j){var k=/\.dds$/i.test(e),l=b+e;if(k){var m=THREE.ImageUtils.loadCompressedTexture(l);a[d]=m}else m=document.createElement("canvas"),a[d]=new THREE.Texture(m);a[d].sourceFile=e,g&&(a[d].repeat.set(g[0],g[1]),1!==g[0]&&(a[d].wrapS=THREE.RepeatWrapping),1!==g[1]&&(a[d].wrapT=THREE.RepeatWrapping)),h&&a[d].offset.set(h[0],h[1]),i&&(e={repeat:THREE.RepeatWrapping,mirror:THREE.MirroredRepeatWrapping},void 0!==e[i[0]]&&(a[d].wrapS=e[i[0]]),void 0!==e[i[1]]&&(a[d].wrapT=e[i[1]])),j&&(a[d].anisotropy=j),k||(m=a[d],f.imageLoader.crossOrigin=f.crossOrigin,f.imageLoader.load(l,function(a){if(!1===THREE.Math.isPowerOfTwo(a.width)||!1===THREE.Math.isPowerOfTwo(a.height)){var b=c(a.width),d=c(a.height);m.image.width=b,m.image.height=d,m.image.getContext("2d").drawImage(a,0,0,b,d)}else m.image=a;m.needsUpdate=!0}))}function e(a){return(255*a[0]<<16)+(255*a[1]<<8)+255*a[2]}var f=this,g="MeshLambertMaterial",h={color:15658734,opacity:1,map:null,lightMap:null,normalMap:null,bumpMap:null,wireframe:!1};if(a.shading){var i=a.shading.toLowerCase();"phong"===i?g="MeshPhongMaterial":"basic"===i&&(g="MeshBasicMaterial")}return void 0!==a.blending&&void 0!==THREE[a.blending]&&(h.blending=THREE[a.blending]),(void 0!==a.transparent||1>a.opacity)&&(h.transparent=a.transparent),void 0!==a.depthTest&&(h.depthTest=a.depthTest),void 0!==a.depthWrite&&(h.depthWrite=a.depthWrite),void 0!==a.visible&&(h.visible=a.visible),void 0!==a.flipSided&&(h.side=THREE.BackSide),void 0!==a.doubleSided&&(h.side=THREE.DoubleSide),void 0!==a.wireframe&&(h.wireframe=a.wireframe),void 0!==a.vertexColors&&("face"===a.vertexColors?h.vertexColors=THREE.FaceColors:a.vertexColors&&(h.vertexColors=THREE.VertexColors)),a.colorDiffuse?h.color=e(a.colorDiffuse):a.DbgColor&&(h.color=a.DbgColor),a.colorSpecular&&(h.specular=e(a.colorSpecular)),a.colorAmbient&&(h.ambient=e(a.colorAmbient)),a.colorEmissive&&(h.emissive=e(a.colorEmissive)),a.transparency&&(h.opacity=a.transparency),a.specularCoef&&(h.shininess=a.specularCoef),a.mapDiffuse&&b&&d(h,"map",a.mapDiffuse,a.mapDiffuseRepeat,a.mapDiffuseOffset,a.mapDiffuseWrap,a.mapDiffuseAnisotropy),a.mapLight&&b&&d(h,"lightMap",a.mapLight,a.mapLightRepeat,a.mapLightOffset,a.mapLightWrap,a.mapLightAnisotropy),a.mapBump&&b&&d(h,"bumpMap",a.mapBump,a.mapBumpRepeat,a.mapBumpOffset,a.mapBumpWrap,a.mapBumpAnisotropy),a.mapNormal&&b&&d(h,"normalMap",a.mapNormal,a.mapNormalRepeat,a.mapNormalOffset,a.mapNormalWrap,a.mapNormalAnisotropy),a.mapSpecular&&b&&d(h,"specularMap",a.mapSpecular,a.mapSpecularRepeat,a.mapSpecularOffset,a.mapSpecularWrap,a.mapSpecularAnisotropy),a.mapBumpScale&&(h.bumpScale=a.mapBumpScale),a.mapNormal?(g=THREE.ShaderLib.normalmap,i=THREE.UniformsUtils.clone(g.uniforms),i.tNormal.value=h.normalMap,a.mapNormalFactor&&i.uNormalScale.value.set(a.mapNormalFactor,a.mapNormalFactor),h.map&&(i.tDiffuse.value=h.map,i.enableDiffuse.value=!0),h.specularMap&&(i.tSpecular.value=h.specularMap,i.enableSpecular.value=!0),h.lightMap&&(i.tAO.value=h.lightMap,i.enableAO.value=!0),i.diffuse.value.setHex(h.color),i.specular.value.setHex(h.specular),i.ambient.value.setHex(h.ambient),i.shininess.value=h.shininess,void 0!==h.opacity&&(i.opacity.value=h.opacity),g=new THREE.ShaderMaterial({fragmentShader:g.fragmentShader,vertexShader:g.vertexShader,uniforms:i,lights:!0,fog:!0}),h.transparent&&(g.transparent=!0)):g=new THREE[g](h),void 0!==a.DbgName&&(g.name=a.DbgName),g}},THREE.XHRLoader=function(a){this.cache=new THREE.Cache,this.manager=void 0!==a?a:THREE.DefaultLoadingManager},THREE.XHRLoader.prototype={constructor:THREE.XHRLoader,load:function(a,b,c,d){var e=this,f=e.cache.get(a);void 0!==f?b(f):(f=new XMLHttpRequest,void 0!==b&&f.addEventListener("load",function(c){e.cache.add(a,c.target.responseText),b(c.target.responseText),e.manager.itemEnd(a)},!1),void 0!==c&&f.addEventListener("progress",function(a){c(a)},!1),void 0!==d&&f.addEventListener("error",function(a){d(a)},!1),void 0!==this.crossOrigin&&(f.crossOrigin=this.crossOrigin),f.open("GET",a,!0),f.send(null),e.manager.itemStart(a))},setCrossOrigin:function(a){this.crossOrigin=a}},THREE.ImageLoader=function(a){this.cache=new THREE.Cache,this.manager=void 0!==a?a:THREE.DefaultLoadingManager},THREE.ImageLoader.prototype={constructor:THREE.ImageLoader,load:function(a,b,c,d){var e=this,f=e.cache.get(a);return void 0===f?(f=document.createElement("img"),void 0!==b&&f.addEventListener("load",function(c){e.cache.add(a,this),b(this),e.manager.itemEnd(a)},!1),void 0!==c&&f.addEventListener("progress",function(a){c(a)},!1),void 0!==d&&f.addEventListener("error",function(a){d(a)},!1),void 0!==this.crossOrigin&&(f.crossOrigin=this.crossOrigin),f.src=a,e.manager.itemStart(a),f):void b(f)},setCrossOrigin:function(a){this.crossOrigin=a}},THREE.JSONLoader=function(a){THREE.Loader.call(this,a),this.withCredentials=!1},THREE.JSONLoader.prototype=Object.create(THREE.Loader.prototype),
THREE.JSONLoader.prototype.load=function(a,b,c){c=c&&"string"==typeof c?c:this.extractUrlBase(a),this.onLoadStart(),this.loadAjaxJSON(this,a,b,c)},THREE.JSONLoader.prototype.loadAjaxJSON=function(a,b,c,d,e){var f=new XMLHttpRequest,g=0;f.onreadystatechange=function(){if(f.readyState===f.DONE)if(200===f.status||0===f.status){if(f.responseText){var h=JSON.parse(f.responseText);if(void 0!==h.metadata&&"scene"===h.metadata.type)return void console.error('THREE.JSONLoader: "'+b+'" seems to be a Scene. Use THREE.SceneLoader instead.');h=a.parse(h,d),c(h.geometry,h.materials)}else console.error('THREE.JSONLoader: "'+b+'" seems to be unreachable or the file is empty.');a.onLoadComplete()}else console.error("THREE.JSONLoader: Couldn't load \""+b+'" ('+f.status+")");else f.readyState===f.LOADING?e&&(0===g&&(g=f.getResponseHeader("Content-Length")),e({total:g,loaded:f.responseText.length})):f.readyState===f.HEADERS_RECEIVED&&void 0!==e&&(g=f.getResponseHeader("Content-Length"))},f.open("GET",b,!0),f.withCredentials=this.withCredentials,f.send(null)},THREE.JSONLoader.prototype.parse=function(a,b){var c=new THREE.Geometry,d=void 0!==a.scale?1/a.scale:1;return function(b){var d,e,f,g,h,i,j,k,l,m,n,o,p,q=a.faces;i=a.vertices;var r=a.normals,s=a.colors,t=0;if(void 0!==a.uvs){for(d=0;d<a.uvs.length;d++)a.uvs[d].length&&t++;for(d=0;t>d;d++)c.faceVertexUvs[d]=[]}for(g=0,h=i.length;h>g;)d=new THREE.Vector3,d.x=i[g++]*b,d.y=i[g++]*b,d.z=i[g++]*b,c.vertices.push(d);for(g=0,h=q.length;h>g;)if(b=q[g++],l=1&b,f=2&b,d=8&b,j=16&b,m=32&b,i=64&b,b&=128,l){if(l=new THREE.Face3,l.a=q[g],l.b=q[g+1],l.c=q[g+3],n=new THREE.Face3,n.a=q[g+1],n.b=q[g+2],n.c=q[g+3],g+=4,f&&(f=q[g++],l.materialIndex=f,n.materialIndex=f),f=c.faces.length,d)for(d=0;t>d;d++)for(o=a.uvs[d],c.faceVertexUvs[d][f]=[],c.faceVertexUvs[d][f+1]=[],e=0;4>e;e++)k=q[g++],p=o[2*k],k=o[2*k+1],p=new THREE.Vector2(p,k),2!==e&&c.faceVertexUvs[d][f].push(p),0!==e&&c.faceVertexUvs[d][f+1].push(p);if(j&&(j=3*q[g++],l.normal.set(r[j++],r[j++],r[j]),n.normal.copy(l.normal)),m)for(d=0;4>d;d++)j=3*q[g++],m=new THREE.Vector3(r[j++],r[j++],r[j]),2!==d&&l.vertexNormals.push(m),0!==d&&n.vertexNormals.push(m);if(i&&(i=q[g++],i=s[i],l.color.setHex(i),n.color.setHex(i)),b)for(d=0;4>d;d++)i=q[g++],i=s[i],2!==d&&l.vertexColors.push(new THREE.Color(i)),0!==d&&n.vertexColors.push(new THREE.Color(i));c.faces.push(l),c.faces.push(n)}else{if(l=new THREE.Face3,l.a=q[g++],l.b=q[g++],l.c=q[g++],f&&(f=q[g++],l.materialIndex=f),f=c.faces.length,d)for(d=0;t>d;d++)for(o=a.uvs[d],c.faceVertexUvs[d][f]=[],e=0;3>e;e++)k=q[g++],p=o[2*k],k=o[2*k+1],p=new THREE.Vector2(p,k),c.faceVertexUvs[d][f].push(p);if(j&&(j=3*q[g++],l.normal.set(r[j++],r[j++],r[j])),m)for(d=0;3>d;d++)j=3*q[g++],m=new THREE.Vector3(r[j++],r[j++],r[j]),l.vertexNormals.push(m);if(i&&(i=q[g++],l.color.setHex(s[i])),b)for(d=0;3>d;d++)i=q[g++],l.vertexColors.push(new THREE.Color(s[i]));c.faces.push(l)}}(d),function(){var b=void 0!==a.influencesPerVertex?a.influencesPerVertex:2;if(a.skinWeights)for(var d=0,e=a.skinWeights.length;e>d;d+=b)c.skinWeights.push(new THREE.Vector4(a.skinWeights[d],b>1?a.skinWeights[d+1]:0,b>2?a.skinWeights[d+2]:0,b>3?a.skinWeights[d+3]:0));if(a.skinIndices)for(d=0,e=a.skinIndices.length;e>d;d+=b)c.skinIndices.push(new THREE.Vector4(a.skinIndices[d],b>1?a.skinIndices[d+1]:0,b>2?a.skinIndices[d+2]:0,b>3?a.skinIndices[d+3]:0));c.bones=a.bones,c.bones&&0<c.bones.length&&(c.skinWeights.length!==c.skinIndices.length||c.skinIndices.length!==c.vertices.length)&&console.warn("When skinning, number of vertices ("+c.vertices.length+"), skinIndices ("+c.skinIndices.length+"), and skinWeights ("+c.skinWeights.length+") should match."),c.animation=a.animation,c.animations=a.animations}(),function(b){if(void 0!==a.morphTargets){var d,e,f,g,h,i;for(d=0,e=a.morphTargets.length;e>d;d++)for(c.morphTargets[d]={},c.morphTargets[d].name=a.morphTargets[d].name,c.morphTargets[d].vertices=[],h=c.morphTargets[d].vertices,i=a.morphTargets[d].vertices,f=0,g=i.length;g>f;f+=3){var j=new THREE.Vector3;j.x=i[f]*b,j.y=i[f+1]*b,j.z=i[f+2]*b,h.push(j)}}if(void 0!==a.morphColors)for(d=0,e=a.morphColors.length;e>d;d++)for(c.morphColors[d]={},c.morphColors[d].name=a.morphColors[d].name,c.morphColors[d].colors=[],g=c.morphColors[d].colors,h=a.morphColors[d].colors,b=0,f=h.length;f>b;b+=3)i=new THREE.Color(16755200),i.setRGB(h[b],h[b+1],h[b+2]),g.push(i)}(d),c.computeFaceNormals(),c.computeBoundingSphere(),void 0===a.materials||0===a.materials.length?{geometry:c}:(d=this.initMaterials(a.materials,b),this.needsTangents(d)&&c.computeTangents(),{geometry:c,materials:d})},THREE.LoadingManager=function(a,b,c){var d=this,e=0,f=0;this.onLoad=a,this.onProgress=b,this.onError=c,this.itemStart=function(a){f++},this.itemEnd=function(a){e++,void 0!==d.onProgress&&d.onProgress(a,e,f),e===f&&void 0!==d.onLoad&&d.onLoad()}},THREE.DefaultLoadingManager=new THREE.LoadingManager,THREE.BufferGeometryLoader=function(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager},THREE.BufferGeometryLoader.prototype={constructor:THREE.BufferGeometryLoader,load:function(a,b,c,d){var e=this;c=new THREE.XHRLoader,c.setCrossOrigin(this.crossOrigin),c.load(a,function(a){b(e.parse(JSON.parse(a)))})},setCrossOrigin:function(a){this.crossOrigin=a},parse:function(a){var b=new THREE.BufferGeometry,c=a.attributes,d=a.offsets;a=a.boundingSphere;for(var e in c){var f=c[e];b.attributes[e]={itemSize:f.itemSize,array:new self[f.type](f.array)}}return void 0!==d&&(b.offsets=JSON.parse(JSON.stringify(d))),void 0!==a&&(b.boundingSphere=new THREE.Sphere((new THREE.Vector3).fromArray(void 0!==a.center?a.center:[0,0,0]),a.radius)),b}},THREE.MaterialLoader=function(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager},THREE.MaterialLoader.prototype={constructor:THREE.MaterialLoader,load:function(a,b,c,d){var e=this;c=new THREE.XHRLoader,c.setCrossOrigin(this.crossOrigin),c.load(a,function(a){b(e.parse(JSON.parse(a)))})},setCrossOrigin:function(a){this.crossOrigin=a},parse:function(a){var b=new THREE[a.type];if(void 0!==a.color&&b.color.setHex(a.color),void 0!==a.ambient&&b.ambient.setHex(a.ambient),void 0!==a.emissive&&b.emissive.setHex(a.emissive),void 0!==a.specular&&b.specular.setHex(a.specular),void 0!==a.shininess&&(b.shininess=a.shininess),void 0!==a.vertexColors&&(b.vertexColors=a.vertexColors),void 0!==a.blending&&(b.blending=a.blending),void 0!==a.side&&(b.side=a.side),void 0!==a.opacity&&(b.opacity=a.opacity),void 0!==a.transparent&&(b.transparent=a.transparent),void 0!==a.wireframe&&(b.wireframe=a.wireframe),void 0!==a.materials)for(var c=0,d=a.materials.length;d>c;c++)b.materials.push(this.parse(a.materials[c]));return b}},THREE.ObjectLoader=function(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager},THREE.ObjectLoader.prototype={constructor:THREE.ObjectLoader,load:function(a,b,c,d){var e=this;c=new THREE.XHRLoader(e.manager),c.setCrossOrigin(this.crossOrigin),c.load(a,function(a){b(e.parse(JSON.parse(a)))})},setCrossOrigin:function(a){this.crossOrigin=a},parse:function(a){var b=this.parseGeometries(a.geometries),c=this.parseMaterials(a.materials);return this.parseObject(a.object,b,c)},parseGeometries:function(a){var b={};if(void 0!==a)for(var c=new THREE.JSONLoader,d=new THREE.BufferGeometryLoader,e=0,f=a.length;f>e;e++){var g,h=a[e];switch(h.type){case"PlaneGeometry":g=new THREE.PlaneGeometry(h.width,h.height,h.widthSegments,h.heightSegments);break;case"BoxGeometry":case"CubeGeometry":g=new THREE.BoxGeometry(h.width,h.height,h.depth,h.widthSegments,h.heightSegments,h.depthSegments);break;case"CircleGeometry":g=new THREE.CircleGeometry(h.radius,h.segments);break;case"CylinderGeometry":g=new THREE.CylinderGeometry(h.radiusTop,h.radiusBottom,h.height,h.radialSegments,h.heightSegments,h.openEnded);break;case"SphereGeometry":g=new THREE.SphereGeometry(h.radius,h.widthSegments,h.heightSegments,h.phiStart,h.phiLength,h.thetaStart,h.thetaLength);break;case"IcosahedronGeometry":g=new THREE.IcosahedronGeometry(h.radius,h.detail);break;case"TorusGeometry":g=new THREE.TorusGeometry(h.radius,h.tube,h.radialSegments,h.tubularSegments,h.arc);break;case"TorusKnotGeometry":g=new THREE.TorusKnotGeometry(h.radius,h.tube,h.radialSegments,h.tubularSegments,h.p,h.q,h.heightScale);break;case"BufferGeometry":g=d.parse(h.data);break;case"Geometry":g=c.parse(h.data).geometry}g.uuid=h.uuid,void 0!==h.name&&(g.name=h.name),b[h.uuid]=g}return b},parseMaterials:function(a){var b={};if(void 0!==a)for(var c=new THREE.MaterialLoader,d=0,e=a.length;e>d;d++){var f=a[d],g=c.parse(f);g.uuid=f.uuid,void 0!==f.name&&(g.name=f.name),b[f.uuid]=g}return b},parseObject:function(){var a=new THREE.Matrix4;return function(b,c,d){var e;switch(b.type){case"Scene":e=new THREE.Scene;break;case"PerspectiveCamera":e=new THREE.PerspectiveCamera(b.fov,b.aspect,b.near,b.far);break;case"OrthographicCamera":e=new THREE.OrthographicCamera(b.left,b.right,b.top,b.bottom,b.near,b.far);break;case"AmbientLight":e=new THREE.AmbientLight(b.color);break;case"DirectionalLight":e=new THREE.DirectionalLight(b.color,b.intensity);break;case"PointLight":e=new THREE.PointLight(b.color,b.intensity,b.distance);break;case"SpotLight":e=new THREE.SpotLight(b.color,b.intensity,b.distance,b.angle,b.exponent);break;case"HemisphereLight":e=new THREE.HemisphereLight(b.color,b.groundColor,b.intensity);break;case"Mesh":e=c[b.geometry];var f=d[b.material];void 0===e&&console.error("THREE.ObjectLoader: Undefined geometry "+b.geometry),void 0===f&&console.error("THREE.ObjectLoader: Undefined material "+b.material),e=new THREE.Mesh(e,f);break;case"Sprite":f=d[b.material],void 0===f&&console.error("THREE.ObjectLoader: Undefined material "+b.material),e=new THREE.Sprite(f);break;default:e=new THREE.Object3D}if(e.uuid=b.uuid,void 0!==b.name&&(e.name=b.name),void 0!==b.matrix?(a.fromArray(b.matrix),a.decompose(e.position,e.quaternion,e.scale)):(void 0!==b.position&&e.position.fromArray(b.position),void 0!==b.rotation&&e.rotation.fromArray(b.rotation),void 0!==b.scale&&e.scale.fromArray(b.scale)),void 0!==b.visible&&(e.visible=b.visible),void 0!==b.userData&&(e.userData=b.userData),void 0!==b.children)for(var g in b.children)e.add(this.parseObject(b.children[g],c,d));return e}}()},THREE.SceneLoader=function(){this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){},this.callbackSync=function(){},this.callbackProgress=function(){},this.geometryHandlers={},this.hierarchyHandlers={},this.addGeometryHandler("ascii",THREE.JSONLoader)},THREE.SceneLoader.prototype={constructor:THREE.SceneLoader,load:function(a,b,c,d){var e=this;c=new THREE.XHRLoader(e.manager),c.setCrossOrigin(this.crossOrigin),c.load(a,function(c){e.parse(JSON.parse(c),b,a)})},setCrossOrigin:function(a){this.crossOrigin=a},addGeometryHandler:function(a,b){this.geometryHandlers[a]={loaderClass:b}},addHierarchyHandler:function(a,b){this.hierarchyHandlers[a]={loaderClass:b}},parse:function(a,b,c){function d(a,b){return"relativeToHTML"==b?a:z+a}function e(){f(w.scene,B.objects)}function f(a,b){var c,e,g,h,j,k;for(k in b){var l=w.objects[k],p=b[k];if(void 0===l){if(p.type&&p.type in y.hierarchyHandlers){if(void 0===p.loading){c={type:1,url:1,material:1,position:1,rotation:1,scale:1,visible:1,children:1,userData:1,skin:1,morph:1,mirroredLoop:1,duration:1};var q,s={};for(q in p)q in c||(s[q]=p[q]);n=w.materials[p.material],p.loading=!0,c=y.hierarchyHandlers[p.type].loaderObject,c.options?c.load(d(p.url,B.urlBaseType),i(k,a,n,p)):c.load(d(p.url,B.urlBaseType),i(k,a,n,p),s)}}else if(void 0!==p.geometry){if(m=w.geometries[p.geometry]){if(l=!1,n=w.materials[p.material],l=n instanceof THREE.ShaderMaterial,e=p.position,g=p.rotation,h=p.scale,c=p.matrix,j=p.quaternion,p.material||(n=new THREE.MeshFaceMaterial(w.face_materials[p.geometry])),n instanceof THREE.MeshFaceMaterial&&0===n.materials.length&&(n=new THREE.MeshFaceMaterial(w.face_materials[p.geometry])),n instanceof THREE.MeshFaceMaterial)for(s=0;s<n.materials.length;s++)l=l||n.materials[s]instanceof THREE.ShaderMaterial;l&&m.computeTangents(),p.skin?l=new THREE.SkinnedMesh(m,n):p.morph?(l=new THREE.MorphAnimMesh(m,n),void 0!==p.duration&&(l.duration=p.duration),void 0!==p.time&&(l.time=p.time),void 0!==p.mirroredLoop&&(l.mirroredLoop=p.mirroredLoop),n.morphNormals&&m.computeMorphNormals()):l=new THREE.Mesh(m,n),l.name=k,c?(l.matrixAutoUpdate=!1,l.matrix.set(c[0],c[1],c[2],c[3],c[4],c[5],c[6],c[7],c[8],c[9],c[10],c[11],c[12],c[13],c[14],c[15])):(l.position.fromArray(e),j?l.quaternion.fromArray(j):l.rotation.fromArray(g),l.scale.fromArray(h)),l.visible=p.visible,l.castShadow=p.castShadow,l.receiveShadow=p.receiveShadow,a.add(l),w.objects[k]=l}}else if("AmbientLight"===p.type||"PointLight"===p.type||"DirectionalLight"===p.type||"SpotLight"===p.type||"HemisphereLight"===p.type||"AreaLight"===p.type){switch(s=p.color,c=p.intensity,e=p.distance,g=p.position,h=p.rotation,p.type){case"AmbientLight":r=new THREE.AmbientLight(s);break;case"PointLight":r=new THREE.PointLight(s,c,e),r.position.fromArray(g);break;case"DirectionalLight":r=new THREE.DirectionalLight(s,c),r.position.fromArray(p.direction);break;case"SpotLight":r=new THREE.SpotLight(s,c,e,1),r.angle=p.angle,r.position.fromArray(g),r.target.set(g[0],g[1]-e,g[2]),r.target.applyEuler(new THREE.Euler(h[0],h[1],h[2],"XYZ"));break;case"HemisphereLight":r=new THREE.DirectionalLight(s,c,e),r.target.set(g[0],g[1]-e,g[2]),r.target.applyEuler(new THREE.Euler(h[0],h[1],h[2],"XYZ"));break;case"AreaLight":r=new THREE.AreaLight(s,c),r.position.fromArray(g),r.width=p.size,r.height=p.size_y}a.add(r),r.name=k,w.lights[k]=r,w.objects[k]=r}else"PerspectiveCamera"===p.type||"OrthographicCamera"===p.type?(e=p.position,g=p.rotation,j=p.quaternion,"PerspectiveCamera"===p.type?o=new THREE.PerspectiveCamera(p.fov,p.aspect,p.near,p.far):"OrthographicCamera"===p.type&&(o=new THREE.OrthographicCamera(p.left,p.right,p.top,p.bottom,p.near,p.far)),o.name=k,o.position.fromArray(e),void 0!==j?o.quaternion.fromArray(j):void 0!==g&&o.rotation.fromArray(g),a.add(o),w.cameras[k]=o,w.objects[k]=o):(e=p.position,g=p.rotation,h=p.scale,j=p.quaternion,l=new THREE.Object3D,l.name=k,l.position.fromArray(e),j?l.quaternion.fromArray(j):l.rotation.fromArray(g),l.scale.fromArray(h),l.visible=void 0!==p.visible?p.visible:!1,a.add(l),w.objects[k]=l,w.empties[k]=l);if(l){if(void 0!==p.userData)for(var t in p.userData)l.userData[t]=p.userData[t];if(void 0!==p.groups)for(s=0;s<p.groups.length;s++)c=p.groups[s],void 0===w.groups[c]&&(w.groups[c]=[]),w.groups[c].push(k)}}void 0!==l&&void 0!==p.children&&f(l,p.children)}}function g(a,b,c,d,f){var g=f.rotation,h=f.quaternion,i=f.scale;a.position.fromArray(f.position),h?a.quaternion.fromArray(h):a.rotation.fromArray(g),a.scale.fromArray(i),d&&a.traverse(function(a){a.material=d});var j=void 0!==f.visible?f.visible:!0;a.traverse(function(a){a.visible=j}),c.add(a),a.name=b,w.objects[b]=a,e()}function h(a){return function(b,c){b.name=a,w.geometries[a]=b,w.face_materials[a]=c,e(),s-=1,y.onLoadComplete(),k()}}function i(a,b,c,d){return function(e){g(e.content?e.content:e.dae?e.scene:e,a,b,c,d),s-=1,y.onLoadComplete(),k()}}function j(a){return function(b,c){b.name=a,w.geometries[a]=b,w.face_materials[a]=c}}function k(){if(y.callbackProgress({totalModels:u,totalTextures:v,loadedModels:u-s,loadedTextures:v-t},w),y.onLoadProgress(),0===s&&0===t){for(var a=0;a<A.length;a++){var c=A[a],d=w.objects[c.targetName];d?c.object.target=d:(c.object.target=new THREE.Object3D,w.scene.add(c.object.target)),c.object.target.userData.targetInverse=c.object}b(w)}}function l(a,b){if(b(a),void 0!==a.children)for(var c in a.children)l(a.children[c],b)}var m,n,o,p,q,r,s,t,u,v,w,x,y=this,z=THREE.Loader.prototype.extractUrlBase(c),A=[],B=a;for(x in this.geometryHandlers)a=this.geometryHandlers[x].loaderClass,this.geometryHandlers[x].loaderObject=new a;for(x in this.hierarchyHandlers)a=this.hierarchyHandlers[x].loaderClass,this.hierarchyHandlers[x].loaderObject=new a;t=s=0,w={scene:new THREE.Scene,geometries:{},face_materials:{},materials:{},textures:{},objects:{},cameras:{},lights:{},fogs:{},empties:{},groups:{}},B.transform&&(x=B.transform.position,a=B.transform.rotation,c=B.transform.scale,x&&w.scene.position.fromArray(x),a&&w.scene.rotation.fromArray(a),c&&w.scene.scale.fromArray(c),x||a||c)&&(w.scene.updateMatrix(),w.scene.updateMatrixWorld()),x=function(a){return function(){t-=a,k(),y.onLoadComplete()}};for(var C in B.fogs)a=B.fogs[C],"linear"===a.type?p=new THREE.Fog(0,a.near,a.far):"exp2"===a.type&&(p=new THREE.FogExp2(0,a.density)),a=a.color,p.color.setRGB(a[0],a[1],a[2]),w.fogs[C]=p;for(var D in B.geometries)p=B.geometries[D],p.type in this.geometryHandlers&&(s+=1,y.onLoadStart());for(var E in B.objects)l(B.objects[E],function(a){a.type&&a.type in y.hierarchyHandlers&&(s+=1,y.onLoadStart())});u=s;for(D in B.geometries)if(p=B.geometries[D],"cube"===p.type)m=new THREE.BoxGeometry(p.width,p.height,p.depth,p.widthSegments,p.heightSegments,p.depthSegments),m.name=D,w.geometries[D]=m;else if("plane"===p.type)m=new THREE.PlaneGeometry(p.width,p.height,p.widthSegments,p.heightSegments),m.name=D,w.geometries[D]=m;else if("sphere"===p.type)m=new THREE.SphereGeometry(p.radius,p.widthSegments,p.heightSegments),m.name=D,w.geometries[D]=m;else if("cylinder"===p.type)m=new THREE.CylinderGeometry(p.topRad,p.botRad,p.height,p.radSegs,p.heightSegs),m.name=D,w.geometries[D]=m;else if("torus"===p.type)m=new THREE.TorusGeometry(p.radius,p.tube,p.segmentsR,p.segmentsT),m.name=D,w.geometries[D]=m;else if("icosahedron"===p.type)m=new THREE.IcosahedronGeometry(p.radius,p.subdivisions),m.name=D,w.geometries[D]=m;else if(p.type in this.geometryHandlers){E={};for(q in p)"type"!==q&&"url"!==q&&(E[q]=p[q]);this.geometryHandlers[p.type].loaderObject.load(d(p.url,B.urlBaseType),h(D),E)}else"embedded"===p.type&&(E=B.embeds[p.id],E.metadata=B.metadata,E&&(E=this.geometryHandlers.ascii.loaderObject.parse(E,""),j(D)(E.geometry,E.materials)));for(var F in B.textures)if(D=B.textures[F],D.url instanceof Array)for(t+=D.url.length,q=0;q<D.url.length;q++)y.onLoadStart();else t+=1,y.onLoadStart();v=t;for(F in B.textures){if(D=B.textures[F],void 0!==D.mapping&&void 0!==THREE[D.mapping]&&(D.mapping=new THREE[D.mapping]),D.url instanceof Array){for(E=D.url.length,p=[],q=0;E>q;q++)p[q]=d(D.url[q],B.urlBaseType);q=(q=/\.dds$/i.test(p[0]))?THREE.ImageUtils.loadCompressedTextureCube(p,D.mapping,x(E)):THREE.ImageUtils.loadTextureCube(p,D.mapping,x(E))}else q=/\.dds$/i.test(D.url),E=d(D.url,B.urlBaseType),p=x(1),q=q?THREE.ImageUtils.loadCompressedTexture(E,D.mapping,p):THREE.ImageUtils.loadTexture(E,D.mapping,p),void 0!==THREE[D.minFilter]&&(q.minFilter=THREE[D.minFilter]),void 0!==THREE[D.magFilter]&&(q.magFilter=THREE[D.magFilter]),D.anisotropy&&(q.anisotropy=D.anisotropy),D.repeat&&(q.repeat.set(D.repeat[0],D.repeat[1]),1!==D.repeat[0]&&(q.wrapS=THREE.RepeatWrapping),1!==D.repeat[1]&&(q.wrapT=THREE.RepeatWrapping)),D.offset&&q.offset.set(D.offset[0],D.offset[1]),D.wrap&&(E={repeat:THREE.RepeatWrapping,mirror:THREE.MirroredRepeatWrapping},void 0!==E[D.wrap[0]]&&(q.wrapS=E[D.wrap[0]]),void 0!==E[D.wrap[1]]&&(q.wrapT=E[D.wrap[1]]));w.textures[F]=q}var G,H;for(G in B.materials){F=B.materials[G];for(H in F.parameters)"envMap"===H||"map"===H||"lightMap"===H||"bumpMap"===H?F.parameters[H]=w.textures[F.parameters[H]]:"shading"===H?F.parameters[H]="flat"===F.parameters[H]?THREE.FlatShading:THREE.SmoothShading:"side"===H?F.parameters[H]="double"==F.parameters[H]?THREE.DoubleSide:"back"==F.parameters[H]?THREE.BackSide:THREE.FrontSide:"blending"===H?F.parameters[H]=F.parameters[H]in THREE?THREE[F.parameters[H]]:THREE.NormalBlending:"combine"===H?F.parameters[H]=F.parameters[H]in THREE?THREE[F.parameters[H]]:THREE.MultiplyOperation:"vertexColors"===H?"face"==F.parameters[H]?F.parameters[H]=THREE.FaceColors:F.parameters[H]&&(F.parameters[H]=THREE.VertexColors):"wrapRGB"===H&&(x=F.parameters[H],F.parameters[H]=new THREE.Vector3(x[0],x[1],x[2]));void 0!==F.parameters.opacity&&1>F.parameters.opacity&&(F.parameters.transparent=!0),F.parameters.normalMap?(x=THREE.ShaderLib.normalmap,D=THREE.UniformsUtils.clone(x.uniforms),q=F.parameters.color,E=F.parameters.specular,p=F.parameters.ambient,C=F.parameters.shininess,D.tNormal.value=w.textures[F.parameters.normalMap],F.parameters.normalScale&&D.uNormalScale.value.set(F.parameters.normalScale[0],F.parameters.normalScale[1]),F.parameters.map&&(D.tDiffuse.value=F.parameters.map,D.enableDiffuse.value=!0),F.parameters.envMap&&(D.tCube.value=F.parameters.envMap,D.enableReflection.value=!0,D.reflectivity.value=F.parameters.reflectivity),F.parameters.lightMap&&(D.tAO.value=F.parameters.lightMap,D.enableAO.value=!0),F.parameters.specularMap&&(D.tSpecular.value=w.textures[F.parameters.specularMap],D.enableSpecular.value=!0),F.parameters.displacementMap&&(D.tDisplacement.value=w.textures[F.parameters.displacementMap],D.enableDisplacement.value=!0,D.uDisplacementBias.value=F.parameters.displacementBias,D.uDisplacementScale.value=F.parameters.displacementScale),D.diffuse.value.setHex(q),D.specular.value.setHex(E),D.ambient.value.setHex(p),D.shininess.value=C,F.parameters.opacity&&(D.opacity.value=F.parameters.opacity),n=new THREE.ShaderMaterial({fragmentShader:x.fragmentShader,vertexShader:x.vertexShader,uniforms:D,lights:!0,fog:!0})):n=new THREE[F.type](F.parameters),n.name=G,w.materials[G]=n}for(G in B.materials)if(F=B.materials[G],F.parameters.materials){for(H=[],q=0;q<F.parameters.materials.length;q++)H.push(w.materials[F.parameters.materials[q]]);w.materials[G].materials=H}e(),w.cameras&&B.defaults.camera&&(w.currentCamera=w.cameras[B.defaults.camera]),w.fogs&&B.defaults.fog&&(w.scene.fog=w.fogs[B.defaults.fog]),y.callbackSync(w),k()}},THREE.TextureLoader=function(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager},THREE.TextureLoader.prototype={constructor:THREE.TextureLoader,load:function(a,b,c,d){c=new THREE.ImageLoader(this.manager),c.setCrossOrigin(this.crossOrigin),c.load(a,function(a){a=new THREE.Texture(a),a.needsUpdate=!0,void 0!==b&&b(a)})},setCrossOrigin:function(a){this.crossOrigin=a}},THREE.Material=function(){this.id=THREE.MaterialIdCount++,this.uuid=THREE.Math.generateUUID(),this.name="",this.side=THREE.FrontSide,this.opacity=1,this.transparent=!1,this.blending=THREE.NormalBlending,this.blendSrc=THREE.SrcAlphaFactor,this.blendDst=THREE.OneMinusSrcAlphaFactor,this.blendEquation=THREE.AddEquation,this.depthWrite=this.depthTest=!0,this.polygonOffset=!1,this.overdraw=this.alphaTest=this.polygonOffsetUnits=this.polygonOffsetFactor=0,this.needsUpdate=this.visible=!0},THREE.Material.prototype={constructor:THREE.Material,setValues:function(a){if(void 0!==a)for(var b in a){var c=a[b];if(void 0===c)console.warn("THREE.Material: '"+b+"' parameter is undefined.");else if(b in this){var d=this[b];d instanceof THREE.Color?d.set(c):d instanceof THREE.Vector3&&c instanceof THREE.Vector3?d.copy(c):this[b]="overdraw"==b?Number(c):c}}},clone:function(a){return void 0===a&&(a=new THREE.Material),a.name=this.name,a.side=this.side,a.opacity=this.opacity,a.transparent=this.transparent,a.blending=this.blending,a.blendSrc=this.blendSrc,a.blendDst=this.blendDst,a.blendEquation=this.blendEquation,a.depthTest=this.depthTest,a.depthWrite=this.depthWrite,a.polygonOffset=this.polygonOffset,a.polygonOffsetFactor=this.polygonOffsetFactor,a.polygonOffsetUnits=this.polygonOffsetUnits,a.alphaTest=this.alphaTest,a.overdraw=this.overdraw,a.visible=this.visible,a},dispose:function(){this.dispatchEvent({type:"dispose"})}},THREE.EventDispatcher.prototype.apply(THREE.Material.prototype),THREE.MaterialIdCount=0,THREE.LineBasicMaterial=function(a){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.linewidth=1,this.linejoin=this.linecap="round",this.vertexColors=!1,this.fog=!0,this.setValues(a)},THREE.LineBasicMaterial.prototype=Object.create(THREE.Material.prototype),THREE.LineBasicMaterial.prototype.clone=function(){var a=new THREE.LineBasicMaterial;return THREE.Material.prototype.clone.call(this,a),a.color.copy(this.color),a.linewidth=this.linewidth,a.linecap=this.linecap,a.linejoin=this.linejoin,a.vertexColors=this.vertexColors,a.fog=this.fog,a},THREE.LineDashedMaterial=function(a){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.scale=this.linewidth=1,this.dashSize=3,this.gapSize=1,this.vertexColors=!1,this.fog=!0,this.setValues(a)},THREE.LineDashedMaterial.prototype=Object.create(THREE.Material.prototype),THREE.LineDashedMaterial.prototype.clone=function(){var a=new THREE.LineDashedMaterial;return THREE.Material.prototype.clone.call(this,a),a.color.copy(this.color),a.linewidth=this.linewidth,a.scale=this.scale,a.dashSize=this.dashSize,a.gapSize=this.gapSize,a.vertexColors=this.vertexColors,a.fog=this.fog,a},THREE.MeshBasicMaterial=function(a){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.envMap=this.specularMap=this.lightMap=this.map=null,this.combine=THREE.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=THREE.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinejoin=this.wireframeLinecap="round",this.vertexColors=THREE.NoColors,this.morphTargets=this.skinning=!1,this.setValues(a)},THREE.MeshBasicMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshBasicMaterial.prototype.clone=function(){var a=new THREE.MeshBasicMaterial;return THREE.Material.prototype.clone.call(this,a),a.color.copy(this.color),a.map=this.map,a.lightMap=this.lightMap,a.specularMap=this.specularMap,a.envMap=this.envMap,a.combine=this.combine,a.reflectivity=this.reflectivity,a.refractionRatio=this.refractionRatio,a.fog=this.fog,a.shading=this.shading,a.wireframe=this.wireframe,a.wireframeLinewidth=this.wireframeLinewidth,a.wireframeLinecap=this.wireframeLinecap,a.wireframeLinejoin=this.wireframeLinejoin,a.vertexColors=this.vertexColors,a.skinning=this.skinning,a.morphTargets=this.morphTargets,a},THREE.MeshLambertMaterial=function(a){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.ambient=new THREE.Color(16777215),this.emissive=new THREE.Color(0),this.wrapAround=!1,this.wrapRGB=new THREE.Vector3(1,1,1),this.envMap=this.specularMap=this.lightMap=this.map=null,this.combine=THREE.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=THREE.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinejoin=this.wireframeLinecap="round",this.vertexColors=THREE.NoColors,this.morphNormals=this.morphTargets=this.skinning=!1,this.setValues(a)},THREE.MeshLambertMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshLambertMaterial.prototype.clone=function(){var a=new THREE.MeshLambertMaterial;return THREE.Material.prototype.clone.call(this,a),a.color.copy(this.color),a.ambient.copy(this.ambient),a.emissive.copy(this.emissive),a.wrapAround=this.wrapAround,a.wrapRGB.copy(this.wrapRGB),a.map=this.map,a.lightMap=this.lightMap,a.specularMap=this.specularMap,a.envMap=this.envMap,a.combine=this.combine,a.reflectivity=this.reflectivity,a.refractionRatio=this.refractionRatio,a.fog=this.fog,a.shading=this.shading,a.wireframe=this.wireframe,a.wireframeLinewidth=this.wireframeLinewidth,a.wireframeLinecap=this.wireframeLinecap,a.wireframeLinejoin=this.wireframeLinejoin,a.vertexColors=this.vertexColors,a.skinning=this.skinning,a.morphTargets=this.morphTargets,a.morphNormals=this.morphNormals,a},THREE.MeshPhongMaterial=function(a){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.ambient=new THREE.Color(16777215),this.emissive=new THREE.Color(0),this.specular=new THREE.Color(1118481),this.shininess=30,this.wrapAround=this.metal=!1,this.wrapRGB=new THREE.Vector3(1,1,1),this.bumpMap=this.lightMap=this.map=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new THREE.Vector2(1,1),this.envMap=this.specularMap=null,this.combine=THREE.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=THREE.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinejoin=this.wireframeLinecap="round",this.vertexColors=THREE.NoColors,this.morphNormals=this.morphTargets=this.skinning=!1,this.setValues(a)},THREE.MeshPhongMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshPhongMaterial.prototype.clone=function(){var a=new THREE.MeshPhongMaterial;return THREE.Material.prototype.clone.call(this,a),a.color.copy(this.color),a.ambient.copy(this.ambient),a.emissive.copy(this.emissive),a.specular.copy(this.specular),a.shininess=this.shininess,a.metal=this.metal,a.wrapAround=this.wrapAround,a.wrapRGB.copy(this.wrapRGB),a.map=this.map,a.lightMap=this.lightMap,a.bumpMap=this.bumpMap,a.bumpScale=this.bumpScale,a.normalMap=this.normalMap,a.normalScale.copy(this.normalScale),a.specularMap=this.specularMap,a.envMap=this.envMap,a.combine=this.combine,a.reflectivity=this.reflectivity,a.refractionRatio=this.refractionRatio,a.fog=this.fog,a.shading=this.shading,a.wireframe=this.wireframe,a.wireframeLinewidth=this.wireframeLinewidth,a.wireframeLinecap=this.wireframeLinecap,a.wireframeLinejoin=this.wireframeLinejoin,a.vertexColors=this.vertexColors,a.skinning=this.skinning,a.morphTargets=this.morphTargets,a.morphNormals=this.morphNormals,a},THREE.MeshDepthMaterial=function(a){THREE.Material.call(this),this.wireframe=this.morphTargets=!1,this.wireframeLinewidth=1,this.setValues(a)},THREE.MeshDepthMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshDepthMaterial.prototype.clone=function(){var a=new THREE.MeshDepthMaterial;return THREE.Material.prototype.clone.call(this,a),a.wireframe=this.wireframe,a.wireframeLinewidth=this.wireframeLinewidth,a},THREE.MeshNormalMaterial=function(a){THREE.Material.call(this,a),this.shading=THREE.FlatShading,this.wireframe=!1,this.wireframeLinewidth=1,this.morphTargets=!1,this.setValues(a)},THREE.MeshNormalMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshNormalMaterial.prototype.clone=function(){var a=new THREE.MeshNormalMaterial;return THREE.Material.prototype.clone.call(this,a),a.shading=this.shading,a.wireframe=this.wireframe,a.wireframeLinewidth=this.wireframeLinewidth,a},THREE.MeshFaceMaterial=function(a){this.materials=a instanceof Array?a:[]},THREE.MeshFaceMaterial.prototype.clone=function(){for(var a=new THREE.MeshFaceMaterial,b=0;b<this.materials.length;b++)a.materials.push(this.materials[b].clone());return a},THREE.ParticleSystemMaterial=function(a){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.vertexColors=!1,this.fog=!0,this.setValues(a)},THREE.ParticleSystemMaterial.prototype=Object.create(THREE.Material.prototype),THREE.ParticleSystemMaterial.prototype.clone=function(){var a=new THREE.ParticleSystemMaterial;return THREE.Material.prototype.clone.call(this,a),a.color.copy(this.color),a.map=this.map,a.size=this.size,a.sizeAttenuation=this.sizeAttenuation,a.vertexColors=this.vertexColors,a.fog=this.fog,a},THREE.ParticleBasicMaterial=THREE.ParticleSystemMaterial,THREE.ShaderMaterial=function(a){THREE.Material.call(this),this.vertexShader=this.fragmentShader="void main() {}",this.uniforms={},this.defines={},this.attributes=null,this.shading=THREE.SmoothShading,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.lights=this.fog=!1,this.vertexColors=THREE.NoColors,this.morphNormals=this.morphTargets=this.skinning=!1,this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.setValues(a)},THREE.ShaderMaterial.prototype=Object.create(THREE.Material.prototype),THREE.ShaderMaterial.prototype.clone=function(){var a=new THREE.ShaderMaterial;return THREE.Material.prototype.clone.call(this,a),a.fragmentShader=this.fragmentShader,a.vertexShader=this.vertexShader,a.uniforms=THREE.UniformsUtils.clone(this.uniforms),a.attributes=this.attributes,a.defines=this.defines,a.shading=this.shading,a.wireframe=this.wireframe,a.wireframeLinewidth=this.wireframeLinewidth,
a.fog=this.fog,a.lights=this.lights,a.vertexColors=this.vertexColors,a.skinning=this.skinning,a.morphTargets=this.morphTargets,a.morphNormals=this.morphNormals,a},THREE.RawShaderMaterial=function(a){THREE.ShaderMaterial.call(this,a)},THREE.RawShaderMaterial.prototype=Object.create(THREE.ShaderMaterial.prototype),THREE.RawShaderMaterial.prototype.clone=function(){var a=new THREE.RawShaderMaterial;return THREE.ShaderMaterial.prototype.clone.call(this,a),a},THREE.SpriteMaterial=function(a){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.map=null,this.rotation=0,this.fog=!1,this.setValues(a)},THREE.SpriteMaterial.prototype=Object.create(THREE.Material.prototype),THREE.SpriteMaterial.prototype.clone=function(){var a=new THREE.SpriteMaterial;return THREE.Material.prototype.clone.call(this,a),a.color.copy(this.color),a.map=this.map,a.rotation=this.rotation,a.fog=this.fog,a},THREE.SpriteCanvasMaterial=function(a){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.program=function(a,b){},this.setValues(a)},THREE.SpriteCanvasMaterial.prototype=Object.create(THREE.Material.prototype),THREE.SpriteCanvasMaterial.prototype.clone=function(){var a=new THREE.SpriteCanvasMaterial;return THREE.Material.prototype.clone.call(this,a),a.color.copy(this.color),a.program=this.program,a},THREE.ParticleCanvasMaterial=THREE.SpriteCanvasMaterial,THREE.Texture=function(a,b,c,d,e,f,g,h,i){this.id=THREE.TextureIdCount++,this.uuid=THREE.Math.generateUUID(),this.name="",this.image=a,this.mipmaps=[],this.mapping=void 0!==b?b:new THREE.UVMapping,this.wrapS=void 0!==c?c:THREE.ClampToEdgeWrapping,this.wrapT=void 0!==d?d:THREE.ClampToEdgeWrapping,this.magFilter=void 0!==e?e:THREE.LinearFilter,this.minFilter=void 0!==f?f:THREE.LinearMipMapLinearFilter,this.anisotropy=void 0!==i?i:1,this.format=void 0!==g?g:THREE.RGBAFormat,this.type=void 0!==h?h:THREE.UnsignedByteType,this.offset=new THREE.Vector2(0,0),this.repeat=new THREE.Vector2(1,1),this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this._needsUpdate=!1,this.onUpdate=null},THREE.Texture.prototype={constructor:THREE.Texture,get needsUpdate(){return this._needsUpdate},set needsUpdate(a){!0===a&&this.update(),this._needsUpdate=a},clone:function(a){return void 0===a&&(a=new THREE.Texture),a.image=this.image,a.mipmaps=this.mipmaps.slice(0),a.mapping=this.mapping,a.wrapS=this.wrapS,a.wrapT=this.wrapT,a.magFilter=this.magFilter,a.minFilter=this.minFilter,a.anisotropy=this.anisotropy,a.format=this.format,a.type=this.type,a.offset.copy(this.offset),a.repeat.copy(this.repeat),a.generateMipmaps=this.generateMipmaps,a.premultiplyAlpha=this.premultiplyAlpha,a.flipY=this.flipY,a.unpackAlignment=this.unpackAlignment,a},update:function(){this.dispatchEvent({type:"update"})},dispose:function(){this.dispatchEvent({type:"dispose"})}},THREE.EventDispatcher.prototype.apply(THREE.Texture.prototype),THREE.TextureIdCount=0,THREE.CompressedTexture=function(a,b,c,d,e,f,g,h,i,j,k){THREE.Texture.call(this,null,f,g,h,i,j,d,e,k),this.image={width:b,height:c},this.mipmaps=a,this.generateMipmaps=!1},THREE.CompressedTexture.prototype=Object.create(THREE.Texture.prototype),THREE.CompressedTexture.prototype.clone=function(){var a=new THREE.CompressedTexture;return THREE.Texture.prototype.clone.call(this,a),a},THREE.DataTexture=function(a,b,c,d,e,f,g,h,i,j,k){THREE.Texture.call(this,null,f,g,h,i,j,d,e,k),this.image={data:a,width:b,height:c}},THREE.DataTexture.prototype=Object.create(THREE.Texture.prototype),THREE.DataTexture.prototype.clone=function(){var a=new THREE.DataTexture;return THREE.Texture.prototype.clone.call(this,a),a},THREE.ParticleSystem=function(a,b){THREE.Object3D.call(this),this.geometry=void 0!==a?a:new THREE.Geometry,this.material=void 0!==b?b:new THREE.ParticleSystemMaterial({color:16777215*Math.random()}),this.frustumCulled=this.sortParticles=!1},THREE.ParticleSystem.prototype=Object.create(THREE.Object3D.prototype),THREE.ParticleSystem.prototype.clone=function(a){return void 0===a&&(a=new THREE.ParticleSystem(this.geometry,this.material)),a.sortParticles=this.sortParticles,THREE.Object3D.prototype.clone.call(this,a),a},THREE.Line=function(a,b,c){THREE.Object3D.call(this),this.geometry=void 0!==a?a:new THREE.Geometry,this.material=void 0!==b?b:new THREE.LineBasicMaterial({color:16777215*Math.random()}),this.type=void 0!==c?c:THREE.LineStrip},THREE.LineStrip=0,THREE.LinePieces=1,THREE.Line.prototype=Object.create(THREE.Object3D.prototype),THREE.Line.prototype.clone=function(a){return void 0===a&&(a=new THREE.Line(this.geometry,this.material,this.type)),THREE.Object3D.prototype.clone.call(this,a),a},THREE.Mesh=function(a,b){THREE.Object3D.call(this),this.geometry=void 0!==a?a:new THREE.Geometry,this.material=void 0!==b?b:new THREE.MeshBasicMaterial({color:16777215*Math.random()}),this.updateMorphTargets()},THREE.Mesh.prototype=Object.create(THREE.Object3D.prototype),THREE.Mesh.prototype.updateMorphTargets=function(){if(void 0!==this.geometry.morphTargets&&0<this.geometry.morphTargets.length){this.morphTargetBase=-1,this.morphTargetForcedOrder=[],this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var a=0,b=this.geometry.morphTargets.length;b>a;a++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[a].name]=a}},THREE.Mesh.prototype.getMorphTargetIndexByName=function(a){return void 0!==this.morphTargetDictionary[a]?this.morphTargetDictionary[a]:(console.log("THREE.Mesh.getMorphTargetIndexByName: morph target "+a+" does not exist. Returning 0."),0)},THREE.Mesh.prototype.clone=function(a,b){return void 0===a&&(a=new THREE.Mesh(this.geometry,this.material)),THREE.Object3D.prototype.clone.call(this,a,b),a},THREE.Bone=function(a){THREE.Object3D.call(this),this.skin=a,this.skinMatrix=new THREE.Matrix4,this.accumulatedSclWeight=this.accumulatedPosWeight=this.accumulatedRotWeight=0},THREE.Bone.prototype=Object.create(THREE.Object3D.prototype),THREE.Bone.prototype.update=function(a,b){this.matrixAutoUpdate&&(b|=this.updateMatrix()),(b||this.matrixWorldNeedsUpdate)&&(a?this.skinMatrix.multiplyMatrices(a,this.matrix):this.skinMatrix.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,b=!0,this.accumulatedSclWeight=this.accumulatedPosWeight=this.accumulatedRotWeight=0);for(var c=0,d=this.children.length;d>c;c++)this.children[c].update(this.skinMatrix,b)},THREE.Skeleton=function(a,b){this.useVertexTexture=void 0!==b?b:!0,this.bones=[],this.boneMatrices=[];var c,d,e,f,g;if(void 0!==a){for(var h=0;h<a.length;++h)d=a[h],e=d.pos,f=d.rotq,g=d.scl,c=this.addBone(),c.name=d.name,c.position.set(e[0],e[1],e[2]),c.quaternion.set(f[0],f[1],f[2],f[3]),void 0!==g?c.scale.set(g[0],g[1],g[2]):c.scale.set(1,1,1);for(h=0;h<a.length;++h)d=a[h],-1!==d.parent&&this.bones[d.parent].add(this.bones[h]);c=this.bones.length,this.useVertexTexture?(this.boneTextureHeight=this.boneTextureWidth=c=c>256?64:c>64?32:c>16?16:8,this.boneMatrices=new Float32Array(this.boneTextureWidth*this.boneTextureHeight*4),this.boneTexture=new THREE.DataTexture(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,THREE.RGBAFormat,THREE.FloatType),this.boneTexture.minFilter=THREE.NearestFilter,this.boneTexture.magFilter=THREE.NearestFilter,this.boneTexture.generateMipmaps=!1,this.boneTexture.flipY=!1):this.boneMatrices=new Float32Array(16*c)}},THREE.Skeleton.prototype=Object.create(THREE.Mesh.prototype),THREE.Skeleton.prototype.addBone=function(a){return void 0===a&&(a=new THREE.Bone(this)),this.bones.push(a),a},THREE.Skeleton.prototype.calculateInverses=function(a){this.boneInverses=[],a=0;for(var b=this.bones.length;b>a;++a){var c=new THREE.Matrix4;c.getInverse(this.bones[a].skinMatrix),this.boneInverses.push(c)}},THREE.SkinnedMesh=function(a,b,c){for(THREE.Mesh.call(this,a,b),this.skeleton=new THREE.Skeleton(this.geometry&&this.geometry.bones,c),a=0;a<this.skeleton.bones.length;++a)b=this.skeleton.bones[a],void 0===b.parent&&this.add(b);this.identityMatrix=new THREE.Matrix4,this.pose()},THREE.SkinnedMesh.prototype=Object.create(THREE.Mesh.prototype),THREE.SkinnedMesh.prototype.updateMatrixWorld=function(){var a=new THREE.Matrix4;return function(b){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||b)&&(this.parent?this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1),b=0;for(var c=this.children.length;c>b;b++){var d=this.children[b];d instanceof THREE.Bone?d.update(this.identityMatrix,!1):d.updateMatrixWorld(!0)}for(void 0===this.skeleton.boneInverses&&this.skeleton.calculateInverses(),b=0,c=this.skeleton.bones.length;c>b;b++)a.multiplyMatrices(this.skeleton.bones[b].skinMatrix,this.skeleton.boneInverses[b]),a.flattenToArrayOffset(this.skeleton.boneMatrices,16*b);this.skeleton.useVertexTexture&&(this.skeleton.boneTexture.needsUpdate=!0)}}(),THREE.SkinnedMesh.prototype.pose=function(){this.updateMatrixWorld(!0),this.normalizeSkinWeights()},THREE.SkinnedMesh.prototype.normalizeSkinWeights=function(){if(this.geometry instanceof THREE.Geometry)for(var a=0;a<this.geometry.skinIndices.length;a++){var b=this.geometry.skinWeights[a],c=1/b.lengthManhattan();1/0!==c?b.multiplyScalar(c):b.set(1)}},THREE.SkinnedMesh.prototype.clone=function(a){return void 0===a&&(a=new THREE.SkinnedMesh(this.geometry,this.material,this.useVertexTexture)),THREE.Mesh.prototype.clone.call(this,a),a},THREE.MorphAnimMesh=function(a,b){THREE.Mesh.call(this,a,b),this.duration=1e3,this.mirroredLoop=!1,this.currentKeyframe=this.lastKeyframe=this.time=0,this.direction=1,this.directionBackwards=!1,this.setFrameRange(0,this.geometry.morphTargets.length-1)},THREE.MorphAnimMesh.prototype=Object.create(THREE.Mesh.prototype),THREE.MorphAnimMesh.prototype.setFrameRange=function(a,b){this.startKeyframe=a,this.endKeyframe=b,this.length=this.endKeyframe-this.startKeyframe+1},THREE.MorphAnimMesh.prototype.setDirectionForward=function(){this.direction=1,this.directionBackwards=!1},THREE.MorphAnimMesh.prototype.setDirectionBackward=function(){this.direction=-1,this.directionBackwards=!0},THREE.MorphAnimMesh.prototype.parseAnimations=function(){var a=this.geometry;a.animations||(a.animations={});for(var b,c=a.animations,d=/([a-z]+)(\d+)/,e=0,f=a.morphTargets.length;f>e;e++){var g=a.morphTargets[e].name.match(d);if(g&&1<g.length){g=g[1],c[g]||(c[g]={start:1/0,end:-(1/0)});var h=c[g];e<h.start&&(h.start=e),e>h.end&&(h.end=e),b||(b=g)}}a.firstAnimation=b},THREE.MorphAnimMesh.prototype.setAnimationLabel=function(a,b,c){this.geometry.animations||(this.geometry.animations={}),this.geometry.animations[a]={start:b,end:c}},THREE.MorphAnimMesh.prototype.playAnimation=function(a,b){var c=this.geometry.animations[a];c?(this.setFrameRange(c.start,c.end),this.duration=(c.end-c.start)/b*1e3,this.time=0):console.warn("animation["+a+"] undefined")},THREE.MorphAnimMesh.prototype.updateAnimation=function(a){var b=this.duration/this.length;this.time+=this.direction*a,this.mirroredLoop?(this.time>this.duration||0>this.time)&&(this.direction*=-1,this.time>this.duration&&(this.time=this.duration,this.directionBackwards=!0),0>this.time&&(this.time=0,this.directionBackwards=!1)):(this.time%=this.duration,0>this.time&&(this.time+=this.duration)),a=this.startKeyframe+THREE.Math.clamp(Math.floor(this.time/b),0,this.length-1),a!==this.currentKeyframe&&(this.morphTargetInfluences[this.lastKeyframe]=0,this.morphTargetInfluences[this.currentKeyframe]=1,this.morphTargetInfluences[a]=0,this.lastKeyframe=this.currentKeyframe,this.currentKeyframe=a),b=this.time%b/b,this.directionBackwards&&(b=1-b),this.morphTargetInfluences[this.currentKeyframe]=b,this.morphTargetInfluences[this.lastKeyframe]=1-b},THREE.MorphAnimMesh.prototype.clone=function(a){return void 0===a&&(a=new THREE.MorphAnimMesh(this.geometry,this.material)),a.duration=this.duration,a.mirroredLoop=this.mirroredLoop,a.time=this.time,a.lastKeyframe=this.lastKeyframe,a.currentKeyframe=this.currentKeyframe,a.direction=this.direction,a.directionBackwards=this.directionBackwards,THREE.Mesh.prototype.clone.call(this,a),a},THREE.LOD=function(){THREE.Object3D.call(this),this.objects=[]},THREE.LOD.prototype=Object.create(THREE.Object3D.prototype),THREE.LOD.prototype.addLevel=function(a,b){void 0===b&&(b=0),b=Math.abs(b);for(var c=0;c<this.objects.length&&!(b<this.objects[c].distance);c++);this.objects.splice(c,0,{distance:b,object:a}),this.add(a)},THREE.LOD.prototype.getObjectForDistance=function(a){for(var b=1,c=this.objects.length;c>b&&!(a<this.objects[b].distance);b++);return this.objects[b-1].object},THREE.LOD.prototype.update=function(){var a=new THREE.Vector3,b=new THREE.Vector3;return function(c){if(1<this.objects.length){a.setFromMatrixPosition(c.matrixWorld),b.setFromMatrixPosition(this.matrixWorld),c=a.distanceTo(b),this.objects[0].object.visible=!0;for(var d=1,e=this.objects.length;e>d&&c>=this.objects[d].distance;d++)this.objects[d-1].object.visible=!1,this.objects[d].object.visible=!0;for(;e>d;d++)this.objects[d].object.visible=!1}}}(),THREE.LOD.prototype.clone=function(a){void 0===a&&(a=new THREE.LOD),THREE.Object3D.prototype.clone.call(this,a);for(var b=0,c=this.objects.length;c>b;b++){var d=this.objects[b].object.clone();d.visible=0===b,a.addLevel(d,this.objects[b].distance)}return a},THREE.Sprite=function(){var a=new THREE.Float32Attribute(3,3);a.set([-.5,-.5,0,.5,-.5,0,.5,.5,0]);var b=new THREE.BufferGeometry;return b.addAttribute("position",a),function(a){THREE.Object3D.call(this),this.geometry=b,this.material=void 0!==a?a:new THREE.SpriteMaterial}}(),THREE.Sprite.prototype=Object.create(THREE.Object3D.prototype),THREE.Sprite.prototype.updateMatrix=function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},THREE.Sprite.prototype.clone=function(a){return void 0===a&&(a=new THREE.Sprite(this.material)),THREE.Object3D.prototype.clone.call(this,a),a},THREE.Particle=THREE.Sprite,THREE.Scene=function(){THREE.Object3D.call(this),this.overrideMaterial=this.fog=null,this.autoUpdate=!0,this.matrixAutoUpdate=!1,this.__lights=[],this.__objectsAdded=[],this.__objectsRemoved=[]},THREE.Scene.prototype=Object.create(THREE.Object3D.prototype),THREE.Scene.prototype.__addObject=function(a){if(a instanceof THREE.Light)-1===this.__lights.indexOf(a)&&this.__lights.push(a),a.target&&void 0===a.target.parent&&this.add(a.target);else if(!(a instanceof THREE.Camera||a instanceof THREE.Bone)){this.__objectsAdded.push(a);var b=this.__objectsRemoved.indexOf(a);-1!==b&&this.__objectsRemoved.splice(b,1)}for(this.dispatchEvent({type:"objectAdded",object:a}),a.dispatchEvent({type:"addedToScene",scene:this}),b=0;b<a.children.length;b++)this.__addObject(a.children[b])},THREE.Scene.prototype.__removeObject=function(a){if(a instanceof THREE.Light){var b=this.__lights.indexOf(a);if(-1!==b&&this.__lights.splice(b,1),a.shadowCascadeArray)for(b=0;b<a.shadowCascadeArray.length;b++)this.__removeObject(a.shadowCascadeArray[b])}else a instanceof THREE.Camera||(this.__objectsRemoved.push(a),b=this.__objectsAdded.indexOf(a),-1!==b&&this.__objectsAdded.splice(b,1));for(this.dispatchEvent({type:"objectRemoved",object:a}),a.dispatchEvent({type:"removedFromScene",scene:this}),b=0;b<a.children.length;b++)this.__removeObject(a.children[b])},THREE.Scene.prototype.clone=function(a){return void 0===a&&(a=new THREE.Scene),THREE.Object3D.prototype.clone.call(this,a),null!==this.fog&&(a.fog=this.fog.clone()),null!==this.overrideMaterial&&(a.overrideMaterial=this.overrideMaterial.clone()),a.autoUpdate=this.autoUpdate,a.matrixAutoUpdate=this.matrixAutoUpdate,a},THREE.Fog=function(a,b,c){this.name="",this.color=new THREE.Color(a),this.near=void 0!==b?b:1,this.far=void 0!==c?c:1e3},THREE.Fog.prototype.clone=function(){return new THREE.Fog(this.color.getHex(),this.near,this.far)},THREE.FogExp2=function(a,b){this.name="",this.color=new THREE.Color(a),this.density=void 0!==b?b:25e-5},THREE.FogExp2.prototype.clone=function(){return new THREE.FogExp2(this.color.getHex(),this.density)},THREE.CanvasRenderer=function(a){function b(a,b,c,d){j(b),k(c),l(d),m(a.getStyle()),E.stroke(),ia.expandByScalar(2*b)}function c(a){n(a.getStyle()),E.fill()}function d(a){e(a.target)}function e(a){var b=a.wrapS===THREE.RepeatWrapping,c=a.wrapT===THREE.RepeatWrapping,d=a.image,e=document.createElement("canvas");e.width=d.width,e.height=d.height;var f=e.getContext("2d");f.setTransform(1,0,0,-1,0,d.height),f.drawImage(d,0,0),fa[a.id]=E.createPattern(e,!0===b&&!0===c?"repeat":!0===b&&!1===c?"repeat-x":!1===b&&!0===c?"repeat-y":"no-repeat")}function f(a,b,c,f,g,h,i,j,k,l,m,o,p){if(!(p instanceof THREE.DataTexture)){!1===p.hasEventListener("update",d)&&(void 0!==p.image&&0<p.image.width&&e(p),p.addEventListener("update",d));var q=fa[p.id];if(void 0!==q){n(q);var q=p.offset.x/p.repeat.x,r=p.offset.y/p.repeat.y,s=p.image.width*p.repeat.x;p=p.image.height*p.repeat.y,i=(i+q)*s,j=(j+r)*p,c-=a,f-=b,g-=a,h-=b,k=(k+q)*s-i,l=(l+r)*p-j,m=(m+q)*s-i,o=(o+r)*p-j,p=k*o-m*l,0!==p&&(q=1/p,p=(o*c-l*g)*q,l=(o*f-l*h)*q,c=(k*g-m*c)*q,f=(k*h-m*f)*q,a=a-p*i-c*j,b=b-l*i-f*j,E.save(),E.transform(p,l,c,f,a,b),E.fill(),E.restore())}else n("rgba(0,0,0,1)"),E.fill()}}function g(a,b,c){var d=b.x-a.x,e=b.y-a.y,f=d*d+e*e;0!==f&&(c/=Math.sqrt(f),d*=c,e*=c,b.x+=d,b.y+=e,a.x-=d,a.y-=e)}function h(a){H!==a&&(H=E.globalAlpha=a)}function i(a){I!==a&&(a===THREE.NormalBlending?E.globalCompositeOperation="source-over":a===THREE.AdditiveBlending?E.globalCompositeOperation="lighter":a===THREE.SubtractiveBlending&&(E.globalCompositeOperation="darker"),I=a)}function j(a){L!==a&&(L=E.lineWidth=a)}function k(a){M!==a&&(M=E.lineCap=a)}function l(a){N!==a&&(N=E.lineJoin=a)}function m(a){J!==a&&(J=E.strokeStyle=a)}function n(a){K!==a&&(K=E.fillStyle=a)}function o(a,b){O===a&&P===b||(E.setLineDash([a,b]),O=a,P=b)}console.log("THREE.CanvasRenderer",THREE.REVISION);var p=THREE.Math.smoothstep;a=a||{};var q,r,s,t,u,v,w,x=this,y=new THREE.Projector,z=void 0!==a.canvas?a.canvas:document.createElement("canvas"),A=z.width,B=z.height,C=Math.floor(A/2),D=Math.floor(B/2),E=z.getContext("2d",{alpha:!0===a.alpha}),F=new THREE.Color(0),G=0,H=1,I=0,J=null,K=null,L=null,M=null,N=null,O=null,P=0;new THREE.RenderableVertex,new THREE.RenderableVertex;var Q,R,S,T,U,V,W=new THREE.Color;new THREE.Color,new THREE.Color,new THREE.Color,new THREE.Color;var X,Y,Z,$,_,aa,ba,ca=new THREE.Color,da=new THREE.Color,ea=new THREE.Color,fa={},ga=new THREE.Box2,ha=new THREE.Box2,ia=new THREE.Box2,ja=new THREE.Color,ka=new THREE.Color,la=new THREE.Color,ma=new THREE.Vector3,na=new THREE.Vector3,oa=new THREE.Vector3,pa=new THREE.Matrix3;void 0===E.setLineDash&&(E.setLineDash=function(){}),this.domElement=z,this.devicePixelRatio=void 0!==a.devicePixelRatio?a.devicePixelRatio:void 0!==self.devicePixelRatio?self.devicePixelRatio:1,this.sortElements=this.sortObjects=this.autoClear=!0,this.info={render:{vertices:0,faces:0}},this.supportsVertexTextures=function(){},this.setFaceCulling=function(){},this.setSize=function(a,b,c){A=a*this.devicePixelRatio,B=b*this.devicePixelRatio,z.width=A,z.height=B,C=Math.floor(A/2),D=Math.floor(B/2),!1!==c&&(z.style.width=a+"px",z.style.height=b+"px"),ga.min.set(-C,-D),ga.max.set(C,D),ha.min.set(-C,-D),ha.max.set(C,D),H=1,I=0,N=M=L=K=J=null,this.setViewport(0,0,a,b)},this.setViewport=function(a,b,c,d){E.setTransform(c*this.devicePixelRatio/A,0,0,-(d*this.devicePixelRatio)/B,a*this.devicePixelRatio,B-b*this.devicePixelRatio),E.translate(C,D)},this.setScissor=function(){},this.enableScissorTest=function(){},this.setClearColor=function(a,b){F.set(a),G=void 0!==b?b:1,ha.min.set(-C,-D),ha.max.set(C,D)},this.setClearColorHex=function(a,b){console.warn("DEPRECATED: .setClearColorHex() is being removed. Use .setClearColor() instead."),this.setClearColor(a,b)},this.getMaxAnisotropy=function(){return 0},this.clear=function(){!1===ha.empty()&&(ha.intersect(ga),ha.expandByScalar(2),1>G&&E.clearRect(0|ha.min.x,0|ha.min.y,ha.max.x-ha.min.x|0,ha.max.y-ha.min.y|0),G>0&&(i(THREE.NormalBlending),h(1),n("rgba("+Math.floor(255*F.r)+","+Math.floor(255*F.g)+","+Math.floor(255*F.b)+","+G+")"),E.fillRect(0|ha.min.x,0|ha.min.y,ha.max.x-ha.min.x|0,ha.max.y-ha.min.y|0)),ha.makeEmpty())},this.clearColor=function(){},this.clearDepth=function(){},this.clearStencil=function(){},this.render=function(a,z){if(!1==z instanceof THREE.Camera)console.error("THREE.CanvasRenderer.render: camera is not an instance of THREE.Camera.");else{!0===this.autoClear&&this.clear(),x.info.render.vertices=0,x.info.render.faces=0,q=y.projectScene(a,z,this.sortObjects,this.sortElements),r=q.elements,s=q.lights,t=z,pa.getNormalMatrix(z.matrixWorldInverse),ja.setRGB(0,0,0),ka.setRGB(0,0,0),la.setRGB(0,0,0);for(var A=0,B=s.length;B>A;A++){var F=s[A],G=F.color;F instanceof THREE.AmbientLight?ja.add(G):F instanceof THREE.DirectionalLight?ka.add(G):F instanceof THREE.PointLight&&la.add(G)}for(A=0,B=r.length;B>A;A++){var H=r[A],I=H.material;if(void 0!==I&&0!==I.opacity){if(ia.makeEmpty(),H instanceof THREE.RenderableSprite){u=H,u.x*=C,u.y*=D;var F=u,J=H,G=I;h(G.opacity),i(G.blending);var K=J.scale.x*C,J=J.scale.y*D,H=.5*Math.sqrt(K*K+J*J);if(ia.min.set(F.x-H,F.y-H),ia.max.set(F.x+H,F.y+H),G instanceof THREE.SpriteMaterial||G instanceof THREE.ParticleSystemMaterial){var L=G.map;if(null!==L){!1===L.hasEventListener("update",d)&&(void 0!==L.image&&0<L.image.width&&e(L),L.addEventListener("update",d)),H=fa[L.id],n(void 0!==H?H:"rgba( 0, 0, 0, 1 )");var M=L.image,H=M.width*L.offset.x,I=M.height*L.offset.y,N=M.width*L.repeat.x,L=M.height*L.repeat.y,M=K/N,O=J/L;E.save(),E.translate(F.x,F.y),0!==G.rotation&&E.rotate(G.rotation),E.translate(-K/2,-J/2),E.scale(M,O),E.translate(-H,-I),E.fillRect(H,I,N,L)}else n(G.color.getStyle()),E.save(),E.translate(F.x,F.y),0!==G.rotation&&E.rotate(G.rotation),E.scale(K,-J),E.fillRect(-.5,-.5,1,1);E.restore()}else G instanceof THREE.SpriteCanvasMaterial&&(m(G.color.getStyle()),n(G.color.getStyle()),E.save(),E.translate(F.x,F.y),0!==G.rotation&&E.rotate(G.rotation),E.scale(K,J),G.program(E),E.restore())}else if(H instanceof THREE.RenderableLine){if(u=H.v1,v=H.v2,u.positionScreen.x*=C,u.positionScreen.y*=D,v.positionScreen.x*=C,v.positionScreen.y*=D,ia.setFromPoints([u.positionScreen,v.positionScreen]),!0===ga.isIntersectionBox(ia))if(F=u,G=v,K=H,J=I,h(J.opacity),i(J.blending),E.beginPath(),E.moveTo(F.positionScreen.x,F.positionScreen.y),E.lineTo(G.positionScreen.x,G.positionScreen.y),J instanceof THREE.LineBasicMaterial){if(j(J.linewidth),k(J.linecap),l(J.linejoin),J.vertexColors!==THREE.VertexColors)m(J.color.getStyle());else if(H=K.vertexColors[0].getStyle(),K=K.vertexColors[1].getStyle(),H===K)m(H);else{try{var P=E.createLinearGradient(F.positionScreen.x,F.positionScreen.y,G.positionScreen.x,G.positionScreen.y);P.addColorStop(0,H),P.addColorStop(1,K)}catch(qa){P=H}m(P)}E.stroke(),ia.expandByScalar(2*J.linewidth)}else J instanceof THREE.LineDashedMaterial&&(j(J.linewidth),k(J.linecap),l(J.linejoin),m(J.color.getStyle()),o(J.dashSize,J.gapSize),E.stroke(),ia.expandByScalar(2*J.linewidth),o(null,null))}else if(H instanceof THREE.RenderableFace){if(u=H.v1,v=H.v2,w=H.v3,-1>u.positionScreen.z||1<u.positionScreen.z)continue;if(-1>v.positionScreen.z||1<v.positionScreen.z)continue;if(-1>w.positionScreen.z||1<w.positionScreen.z)continue;if(u.positionScreen.x*=C,u.positionScreen.y*=D,v.positionScreen.x*=C,v.positionScreen.y*=D,w.positionScreen.x*=C,w.positionScreen.y*=D,0<I.overdraw&&(g(u.positionScreen,v.positionScreen,I.overdraw),g(v.positionScreen,w.positionScreen,I.overdraw),g(w.positionScreen,u.positionScreen,I.overdraw)),ia.setFromPoints([u.positionScreen,v.positionScreen,w.positionScreen]),!0===ga.isIntersectionBox(ia)){G=u,K=v,J=w,F=I,x.info.render.vertices+=3,x.info.render.faces++,h(F.opacity),i(F.blending),Q=G.positionScreen.x,R=G.positionScreen.y,S=K.positionScreen.x,T=K.positionScreen.y,U=J.positionScreen.x,V=J.positionScreen.y;var I=Q,N=R,L=S,M=T,O=U,ra=V;if(E.beginPath(),E.moveTo(I,N),E.lineTo(L,M),E.lineTo(O,ra),E.closePath(),(F instanceof THREE.MeshLambertMaterial||F instanceof THREE.MeshPhongMaterial)&&null===F.map){for(ca.copy(F.color),da.copy(F.emissive),F.vertexColors===THREE.FaceColors&&ca.multiply(H.color),W.copy(ja),na.copy(G.positionWorld).add(K.positionWorld).add(J.positionWorld).divideScalar(3),G=na,K=H.normalModel,J=W,H=0,I=s.length;I>H;H++)N=s[H],ea.copy(N.color),N instanceof THREE.DirectionalLight?(L=ma.setFromMatrixPosition(N.matrixWorld).normalize(),M=K.dot(L),0>=M||(M*=N.intensity,J.add(ea.multiplyScalar(M)))):N instanceof THREE.PointLight&&(L=ma.setFromMatrixPosition(N.matrixWorld),M=K.dot(ma.subVectors(L,G).normalize()),0>=M||(M*=0==N.distance?1:1-Math.min(G.distanceTo(L)/N.distance,1),0!=M&&(M*=N.intensity,J.add(ea.multiplyScalar(M)))));W.multiply(ca).add(da),!0===F.wireframe?b(W,F.wireframeLinewidth,F.wireframeLinecap,F.wireframeLinejoin):c(W)}else F instanceof THREE.MeshBasicMaterial||F instanceof THREE.MeshLambertMaterial||F instanceof THREE.MeshPhongMaterial?null!==F.map?F.map.mapping instanceof THREE.UVMapping&&(X=H.uvs,f(Q,R,S,T,U,V,X[0].x,X[0].y,X[1].x,X[1].y,X[2].x,X[2].y,F.map)):null!==F.envMap?F.envMap.mapping instanceof THREE.SphericalReflectionMapping?(oa.copy(H.vertexNormalsModel[0]).applyMatrix3(pa),Y=.5*oa.x+.5,Z=.5*oa.y+.5,oa.copy(H.vertexNormalsModel[1]).applyMatrix3(pa),$=.5*oa.x+.5,_=.5*oa.y+.5,oa.copy(H.vertexNormalsModel[2]).applyMatrix3(pa),aa=.5*oa.x+.5,ba=.5*oa.y+.5,f(Q,R,S,T,U,V,Y,Z,$,_,aa,ba,F.envMap)):F.envMap.mapping instanceof THREE.SphericalRefractionMapping&&(oa.copy(H.vertexNormalsModel[0]).applyMatrix3(pa),Y=-.5*oa.x+.5,Z=-.5*oa.y+.5,oa.copy(H.vertexNormalsModel[1]).applyMatrix3(pa),$=-.5*oa.x+.5,_=-.5*oa.y+.5,oa.copy(H.vertexNormalsModel[2]).applyMatrix3(pa),aa=-.5*oa.x+.5,ba=-.5*oa.y+.5,f(Q,R,S,T,U,V,Y,Z,$,_,aa,ba,F.envMap)):(W.copy(F.color),F.vertexColors===THREE.FaceColors&&W.multiply(H.color),!0===F.wireframe?b(W,F.wireframeLinewidth,F.wireframeLinecap,F.wireframeLinejoin):c(W)):(F instanceof THREE.MeshDepthMaterial?W.r=W.g=W.b=1-p(G.positionScreen.z*G.positionScreen.w,t.near,t.far):F instanceof THREE.MeshNormalMaterial?(oa.copy(H.normalModel).applyMatrix3(pa),W.setRGB(oa.x,oa.y,oa.z).multiplyScalar(.5).addScalar(.5)):W.setRGB(1,1,1),!0===F.wireframe?b(W,F.wireframeLinewidth,F.wireframeLinecap,F.wireframeLinejoin):c(W))}}ha.union(ia)}}}}},THREE.ShaderChunk={fog_pars_fragment:"#ifdef USE_FOG\n	uniform vec3 fogColor;\n	#ifdef FOG_EXP2\n		uniform float fogDensity;\n	#else\n		uniform float fogNear;\n		uniform float fogFar;\n	#endif\n#endif",fog_fragment:"#ifdef USE_FOG\n	#ifdef USE_LOGDEPTHBUF_EXT\n		float depth = gl_FragDepthEXT / gl_FragCoord.w;\n	#else\n		float depth = gl_FragCoord.z / gl_FragCoord.w;\n	#endif\n	#ifdef FOG_EXP2\n		const float LOG2 = 1.442695;\n		float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\n		fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n	#else\n		float fogFactor = smoothstep( fogNear, fogFar, depth );\n	#endif\n	gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n	uniform float reflectivity;\n	uniform samplerCube envMap;\n	uniform float flipEnvMap;\n	uniform int combine;\n	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n		uniform bool useRefract;\n		uniform float refractionRatio;\n	#else\n		varying vec3 vReflect;\n	#endif\n#endif",envmap_fragment:"#ifdef USE_ENVMAP\n	vec3 reflectVec;\n	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n		vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n		vec3 worldNormal = normalize( vec3( vec4( normal, 0.0 ) * viewMatrix ) );\n		if ( useRefract ) {\n			reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n		} else { \n			reflectVec = reflect( cameraToVertex, worldNormal );\n		}\n	#else\n		reflectVec = vReflect;\n	#endif\n	#ifdef DOUBLE_SIDED\n		float flipNormal = ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n		vec4 cubeColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n	#else\n		vec4 cubeColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n	#endif\n	#ifdef GAMMA_INPUT\n		cubeColor.xyz *= cubeColor.xyz;\n	#endif\n	if ( combine == 1 ) {\n		gl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularStrength * reflectivity );\n	} else if ( combine == 2 ) {\n		gl_FragColor.xyz += cubeColor.xyz * specularStrength * reflectivity;\n	} else {\n		gl_FragColor.xyz = mix( gl_FragColor.xyz, gl_FragColor.xyz * cubeColor.xyz, specularStrength * reflectivity );\n	}\n#endif",envmap_pars_vertex:"#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )\n	varying vec3 vReflect;\n	uniform float refractionRatio;\n	uniform bool useRefract;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )\n	#ifdef USE_SKINNING\n		vec4 worldPosition = modelMatrix * skinned;\n	#endif\n	#if defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )\n		vec4 worldPosition = modelMatrix * vec4( morphed, 1.0 );\n	#endif\n	#if ! defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )\n		vec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n	#endif\n#endif",envmap_vertex:"#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )\n	vec3 worldNormal = mat3( modelMatrix[ 0 ].xyz, modelMatrix[ 1 ].xyz, modelMatrix[ 2 ].xyz ) * objectNormal;\n	worldNormal = normalize( worldNormal );\n	vec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n	if ( useRefract ) {\n		vReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n	} else {\n		vReflect = reflect( cameraToVertex, worldNormal );\n	}\n#endif",map_particle_pars_fragment:"#ifdef USE_MAP\n	uniform sampler2D map;\n#endif",map_particle_fragment:"#ifdef USE_MAP\n	gl_FragColor = gl_FragColor * texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) );\n#endif",map_pars_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )\n	varying vec2 vUv;\n	uniform vec4 offsetRepeat;\n#endif",map_pars_fragment:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )\n	varying vec2 vUv;\n#endif\n#ifdef USE_MAP\n	uniform sampler2D map;\n#endif",map_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )\n	vUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n#endif",map_fragment:"#ifdef USE_MAP\n	vec4 texelColor = texture2D( map, vUv );\n	#ifdef GAMMA_INPUT\n		texelColor.xyz *= texelColor.xyz;\n	#endif\n	gl_FragColor = gl_FragColor * texelColor;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n	varying vec2 vUv2;\n	uniform sampler2D lightMap;\n#endif",lightmap_pars_vertex:"#ifdef USE_LIGHTMAP\n	varying vec2 vUv2;\n#endif",lightmap_fragment:"#ifdef USE_LIGHTMAP\n	gl_FragColor = gl_FragColor * texture2D( lightMap, vUv2 );\n#endif",lightmap_vertex:"#ifdef USE_LIGHTMAP\n	vUv2 = uv2;\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n	uniform sampler2D bumpMap;\n	uniform float bumpScale;\n	vec2 dHdxy_fwd() {\n		vec2 dSTdx = dFdx( vUv );\n		vec2 dSTdy = dFdy( vUv );\n		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n		return vec2( dBx, dBy );\n	}\n	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n		vec3 vSigmaX = dFdx( surf_pos );\n		vec3 vSigmaY = dFdy( surf_pos );\n		vec3 vN = surf_norm;\n		vec3 R1 = cross( vSigmaY, vN );\n		vec3 R2 = cross( vN, vSigmaX );\n		float fDet = dot( vSigmaX, R1 );\n		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n		return normalize( abs( fDet ) * surf_norm - vGrad );\n	}\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n	uniform sampler2D normalMap;\n	uniform vec2 normalScale;\n	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n		vec3 q0 = dFdx( eye_pos.xyz );\n		vec3 q1 = dFdy( eye_pos.xyz );\n		vec2 st0 = dFdx( vUv.st );\n		vec2 st1 = dFdy( vUv.st );\n		vec3 S = normalize(  q0 * st1.t - q1 * st0.t );\n		vec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n		vec3 N = normalize( surf_norm );\n		vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n		mapN.xy = normalScale * mapN.xy;\n		mat3 tsn = mat3( S, T, N );\n		return normalize( tsn * mapN );\n	}\n#endif",
specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n	uniform sampler2D specularMap;\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n	vec4 texelSpecular = texture2D( specularMap, vUv );\n	specularStrength = texelSpecular.r;\n#else\n	specularStrength = 1.0;\n#endif",lights_lambert_pars_vertex:"uniform vec3 ambient;\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\n	uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\n	uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_HEMI_LIGHTS > 0\n	uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\n	uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\n	uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\n	uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n	uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n	uniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#endif\n#if MAX_SPOT_LIGHTS > 0\n	uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\n	uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\n	uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n#endif\n#ifdef WRAP_AROUND\n	uniform vec3 wrapRGB;\n#endif",lights_lambert_vertex:"vLightFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n	vLightBack = vec3( 0.0 );\n#endif\ntransformedNormal = normalize( transformedNormal );\n#if MAX_DIR_LIGHTS > 0\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\n	vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\n	vec3 dirVector = normalize( lDirection.xyz );\n	float dotProduct = dot( transformedNormal, dirVector );\n	vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );\n	#ifdef DOUBLE_SIDED\n		vec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n		#ifdef WRAP_AROUND\n			vec3 directionalLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n		#endif\n	#endif\n	#ifdef WRAP_AROUND\n		vec3 directionalLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\n		directionalLightWeighting = mix( directionalLightWeighting, directionalLightWeightingHalf, wrapRGB );\n		#ifdef DOUBLE_SIDED\n			directionalLightWeightingBack = mix( directionalLightWeightingBack, directionalLightWeightingHalfBack, wrapRGB );\n		#endif\n	#endif\n	vLightFront += directionalLightColor[ i ] * directionalLightWeighting;\n	#ifdef DOUBLE_SIDED\n		vLightBack += directionalLightColor[ i ] * directionalLightWeightingBack;\n	#endif\n}\n#endif\n#if MAX_POINT_LIGHTS > 0\n	for( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n		vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\n		vec3 lVector = lPosition.xyz - mvPosition.xyz;\n		float lDistance = 1.0;\n		if ( pointLightDistance[ i ] > 0.0 )\n			lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\n		lVector = normalize( lVector );\n		float dotProduct = dot( transformedNormal, lVector );\n		vec3 pointLightWeighting = vec3( max( dotProduct, 0.0 ) );\n		#ifdef DOUBLE_SIDED\n			vec3 pointLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n			#ifdef WRAP_AROUND\n				vec3 pointLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n			#endif\n		#endif\n		#ifdef WRAP_AROUND\n			vec3 pointLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\n			pointLightWeighting = mix( pointLightWeighting, pointLightWeightingHalf, wrapRGB );\n			#ifdef DOUBLE_SIDED\n				pointLightWeightingBack = mix( pointLightWeightingBack, pointLightWeightingHalfBack, wrapRGB );\n			#endif\n		#endif\n		vLightFront += pointLightColor[ i ] * pointLightWeighting * lDistance;\n		#ifdef DOUBLE_SIDED\n			vLightBack += pointLightColor[ i ] * pointLightWeightingBack * lDistance;\n		#endif\n	}\n#endif\n#if MAX_SPOT_LIGHTS > 0\n	for( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n		vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\n		vec3 lVector = lPosition.xyz - mvPosition.xyz;\n		float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - worldPosition.xyz ) );\n		if ( spotEffect > spotLightAngleCos[ i ] ) {\n			spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );\n			float lDistance = 1.0;\n			if ( spotLightDistance[ i ] > 0.0 )\n				lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\n			lVector = normalize( lVector );\n			float dotProduct = dot( transformedNormal, lVector );\n			vec3 spotLightWeighting = vec3( max( dotProduct, 0.0 ) );\n			#ifdef DOUBLE_SIDED\n				vec3 spotLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n				#ifdef WRAP_AROUND\n					vec3 spotLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n				#endif\n			#endif\n			#ifdef WRAP_AROUND\n				vec3 spotLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\n				spotLightWeighting = mix( spotLightWeighting, spotLightWeightingHalf, wrapRGB );\n				#ifdef DOUBLE_SIDED\n					spotLightWeightingBack = mix( spotLightWeightingBack, spotLightWeightingHalfBack, wrapRGB );\n				#endif\n			#endif\n			vLightFront += spotLightColor[ i ] * spotLightWeighting * lDistance * spotEffect;\n			#ifdef DOUBLE_SIDED\n				vLightBack += spotLightColor[ i ] * spotLightWeightingBack * lDistance * spotEffect;\n			#endif\n		}\n	}\n#endif\n#if MAX_HEMI_LIGHTS > 0\n	for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\n		vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );\n		vec3 lVector = normalize( lDirection.xyz );\n		float dotProduct = dot( transformedNormal, lVector );\n		float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\n		float hemiDiffuseWeightBack = -0.5 * dotProduct + 0.5;\n		vLightFront += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n		#ifdef DOUBLE_SIDED\n			vLightBack += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeightBack );\n		#endif\n	}\n#endif\nvLightFront = vLightFront * diffuse + ambient * ambientLightColor + emissive;\n#ifdef DOUBLE_SIDED\n	vLightBack = vLightBack * diffuse + ambient * ambientLightColor + emissive;\n#endif",lights_phong_pars_vertex:"#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\n	varying vec3 vWorldPosition;\n#endif",lights_phong_vertex:"#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\n	vWorldPosition = worldPosition.xyz;\n#endif",lights_phong_pars_fragment:"uniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\n	uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\n	uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_HEMI_LIGHTS > 0\n	uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\n	uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\n	uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\n	uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n	uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n	uniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#endif\n#if MAX_SPOT_LIGHTS > 0\n	uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\n	uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\n	uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n#endif\n#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\n	varying vec3 vWorldPosition;\n#endif\n#ifdef WRAP_AROUND\n	uniform vec3 wrapRGB;\n#endif\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;",lights_phong_fragment:"vec3 normal = normalize( vNormal );\nvec3 viewPosition = normalize( vViewPosition );\n#ifdef DOUBLE_SIDED\n	normal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n#endif\n#ifdef USE_NORMALMAP\n	normal = perturbNormal2Arb( -vViewPosition, normal );\n#elif defined( USE_BUMPMAP )\n	normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif\n#if MAX_POINT_LIGHTS > 0\n	vec3 pointDiffuse  = vec3( 0.0 );\n	vec3 pointSpecular = vec3( 0.0 );\n	for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n		vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\n		vec3 lVector = lPosition.xyz + vViewPosition.xyz;\n		float lDistance = 1.0;\n		if ( pointLightDistance[ i ] > 0.0 )\n			lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\n		lVector = normalize( lVector );\n		float dotProduct = dot( normal, lVector );\n		#ifdef WRAP_AROUND\n			float pointDiffuseWeightFull = max( dotProduct, 0.0 );\n			float pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n			vec3 pointDiffuseWeight = mix( vec3( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );\n		#else\n			float pointDiffuseWeight = max( dotProduct, 0.0 );\n		#endif\n		pointDiffuse  += diffuse * pointLightColor[ i ] * pointDiffuseWeight * lDistance;\n		vec3 pointHalfVector = normalize( lVector + viewPosition );\n		float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\n		float pointSpecularWeight = specularStrength * max( pow( pointDotNormalHalf, shininess ), 0.0 );\n		float specularNormalization = ( shininess + 2.0001 ) / 8.0;\n		vec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, pointHalfVector ), 0.0 ), 5.0 );\n		pointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance * specularNormalization;\n	}\n#endif\n#if MAX_SPOT_LIGHTS > 0\n	vec3 spotDiffuse  = vec3( 0.0 );\n	vec3 spotSpecular = vec3( 0.0 );\n	for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n		vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\n		vec3 lVector = lPosition.xyz + vViewPosition.xyz;\n		float lDistance = 1.0;\n		if ( spotLightDistance[ i ] > 0.0 )\n			lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\n		lVector = normalize( lVector );\n		float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );\n		if ( spotEffect > spotLightAngleCos[ i ] ) {\n			spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );\n			float dotProduct = dot( normal, lVector );\n			#ifdef WRAP_AROUND\n				float spotDiffuseWeightFull = max( dotProduct, 0.0 );\n				float spotDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n				vec3 spotDiffuseWeight = mix( vec3( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );\n			#else\n				float spotDiffuseWeight = max( dotProduct, 0.0 );\n			#endif\n			spotDiffuse += diffuse * spotLightColor[ i ] * spotDiffuseWeight * lDistance * spotEffect;\n			vec3 spotHalfVector = normalize( lVector + viewPosition );\n			float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );\n			float spotSpecularWeight = specularStrength * max( pow( spotDotNormalHalf, shininess ), 0.0 );\n			float specularNormalization = ( shininess + 2.0001 ) / 8.0;\n			vec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, spotHalfVector ), 0.0 ), 5.0 );\n			spotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * specularNormalization * spotEffect;\n		}\n	}\n#endif\n#if MAX_DIR_LIGHTS > 0\n	vec3 dirDiffuse  = vec3( 0.0 );\n	vec3 dirSpecular = vec3( 0.0 );\n	for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\n		vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\n		vec3 dirVector = normalize( lDirection.xyz );\n		float dotProduct = dot( normal, dirVector );\n		#ifdef WRAP_AROUND\n			float dirDiffuseWeightFull = max( dotProduct, 0.0 );\n			float dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n			vec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );\n		#else\n			float dirDiffuseWeight = max( dotProduct, 0.0 );\n		#endif\n		dirDiffuse  += diffuse * directionalLightColor[ i ] * dirDiffuseWeight;\n		vec3 dirHalfVector = normalize( dirVector + viewPosition );\n		float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\n		float dirSpecularWeight = specularStrength * max( pow( dirDotNormalHalf, shininess ), 0.0 );\n		float specularNormalization = ( shininess + 2.0001 ) / 8.0;\n		vec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( dirVector, dirHalfVector ), 0.0 ), 5.0 );\n		dirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\n	}\n#endif\n#if MAX_HEMI_LIGHTS > 0\n	vec3 hemiDiffuse  = vec3( 0.0 );\n	vec3 hemiSpecular = vec3( 0.0 );\n	for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\n		vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );\n		vec3 lVector = normalize( lDirection.xyz );\n		float dotProduct = dot( normal, lVector );\n		float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\n		vec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n		hemiDiffuse += diffuse * hemiColor;\n		vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );\n		float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;\n		float hemiSpecularWeightSky = specularStrength * max( pow( hemiDotNormalHalfSky, shininess ), 0.0 );\n		vec3 lVectorGround = -lVector;\n		vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );\n		float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;\n		float hemiSpecularWeightGround = specularStrength * max( pow( hemiDotNormalHalfGround, shininess ), 0.0 );\n		float dotProductGround = dot( normal, lVectorGround );\n		float specularNormalization = ( shininess + 2.0001 ) / 8.0;\n		vec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, hemiHalfVectorSky ), 0.0 ), 5.0 );\n		vec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 0.0 ), 5.0 );\n		hemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );\n	}\n#endif\nvec3 totalDiffuse = vec3( 0.0 );\nvec3 totalSpecular = vec3( 0.0 );\n#if MAX_DIR_LIGHTS > 0\n	totalDiffuse += dirDiffuse;\n	totalSpecular += dirSpecular;\n#endif\n#if MAX_HEMI_LIGHTS > 0\n	totalDiffuse += hemiDiffuse;\n	totalSpecular += hemiSpecular;\n#endif\n#if MAX_POINT_LIGHTS > 0\n	totalDiffuse += pointDiffuse;\n	totalSpecular += pointSpecular;\n#endif\n#if MAX_SPOT_LIGHTS > 0\n	totalDiffuse += spotDiffuse;\n	totalSpecular += spotSpecular;\n#endif\n#ifdef METAL\n	gl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient + totalSpecular );\n#else\n	gl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient ) + totalSpecular;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\n	varying vec3 vColor;\n#endif",color_fragment:"#ifdef USE_COLOR\n	gl_FragColor = gl_FragColor * vec4( vColor, 1.0 );\n#endif",color_pars_vertex:"#ifdef USE_COLOR\n	varying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n	#ifdef GAMMA_INPUT\n		vColor = color * color;\n	#else\n		vColor = color;\n	#endif\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n	#ifdef BONE_TEXTURE\n		uniform sampler2D boneTexture;\n		uniform int boneTextureWidth;\n		uniform int boneTextureHeight;\n		mat4 getBoneMatrix( const in float i ) {\n			float j = i * 4.0;\n			float x = mod( j, float( boneTextureWidth ) );\n			float y = floor( j / float( boneTextureWidth ) );\n			float dx = 1.0 / float( boneTextureWidth );\n			float dy = 1.0 / float( boneTextureHeight );\n			y = dy * ( y + 0.5 );\n			vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n			vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n			vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n			vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n			mat4 bone = mat4( v1, v2, v3, v4 );\n			return bone;\n		}\n	#else\n		uniform mat4 boneGlobalMatrices[ MAX_BONES ];\n		mat4 getBoneMatrix( const in float i ) {\n			mat4 bone = boneGlobalMatrices[ int(i) ];\n			return bone;\n		}\n	#endif\n#endif",skinbase_vertex:"#ifdef USE_SKINNING\n	mat4 boneMatX = getBoneMatrix( skinIndex.x );\n	mat4 boneMatY = getBoneMatrix( skinIndex.y );\n	mat4 boneMatZ = getBoneMatrix( skinIndex.z );\n	mat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n	#ifdef USE_MORPHTARGETS\n	vec4 skinVertex = vec4( morphed, 1.0 );\n	#else\n	vec4 skinVertex = vec4( position, 1.0 );\n	#endif\n	vec4 skinned  = boneMatX * skinVertex * skinWeight.x;\n	skinned      += boneMatY * skinVertex * skinWeight.y;\n	skinned      += boneMatZ * skinVertex * skinWeight.z;\n	skinned      += boneMatW * skinVertex * skinWeight.w;\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n	#ifndef USE_MORPHNORMALS\n	uniform float morphTargetInfluences[ 8 ];\n	#else\n	uniform float morphTargetInfluences[ 4 ];\n	#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n	vec3 morphed = vec3( 0.0 );\n	morphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n	morphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n	morphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n	morphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n	#ifndef USE_MORPHNORMALS\n	morphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n	morphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n	morphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n	morphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n	#endif\n	morphed += position;\n#endif",default_vertex:"vec4 mvPosition;\n#ifdef USE_SKINNING\n	mvPosition = modelViewMatrix * skinned;\n#endif\n#if !defined( USE_SKINNING ) && defined( USE_MORPHTARGETS )\n	mvPosition = modelViewMatrix * vec4( morphed, 1.0 );\n#endif\n#if !defined( USE_SKINNING ) && ! defined( USE_MORPHTARGETS )\n	mvPosition = modelViewMatrix * vec4( position, 1.0 );\n#endif\ngl_Position = projectionMatrix * mvPosition;",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n	vec3 morphedNormal = vec3( 0.0 );\n	morphedNormal +=  ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n	morphedNormal +=  ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n	morphedNormal +=  ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n	morphedNormal +=  ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n	morphedNormal += normal;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n	mat4 skinMatrix = skinWeight.x * boneMatX;\n	skinMatrix 	+= skinWeight.y * boneMatY;\n	skinMatrix 	+= skinWeight.z * boneMatZ;\n	skinMatrix 	+= skinWeight.w * boneMatW;\n	#ifdef USE_MORPHNORMALS\n	vec4 skinnedNormal = skinMatrix * vec4( morphedNormal, 0.0 );\n	#else\n	vec4 skinnedNormal = skinMatrix * vec4( normal, 0.0 );\n	#endif\n#endif",defaultnormal_vertex:"vec3 objectNormal;\n#ifdef USE_SKINNING\n	objectNormal = skinnedNormal.xyz;\n#endif\n#if !defined( USE_SKINNING ) && defined( USE_MORPHNORMALS )\n	objectNormal = morphedNormal;\n#endif\n#if !defined( USE_SKINNING ) && ! defined( USE_MORPHNORMALS )\n	objectNormal = normal;\n#endif\n#ifdef FLIP_SIDED\n	objectNormal = -objectNormal;\n#endif\nvec3 transformedNormal = normalMatrix * objectNormal;",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n	uniform sampler2D shadowMap[ MAX_SHADOWS ];\n	uniform vec2 shadowMapSize[ MAX_SHADOWS ];\n	uniform float shadowDarkness[ MAX_SHADOWS ];\n	uniform float shadowBias[ MAX_SHADOWS ];\n	varying vec4 vShadowCoord[ MAX_SHADOWS ];\n	float unpackDepth( const in vec4 rgba_depth ) {\n		const vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\n		float depth = dot( rgba_depth, bit_shift );\n		return depth;\n	}\n#endif",shadowmap_fragment:"#ifdef USE_SHADOWMAP\n	#ifdef SHADOWMAP_DEBUG\n		vec3 frustumColors[3];\n		frustumColors[0] = vec3( 1.0, 0.5, 0.0 );\n		frustumColors[1] = vec3( 0.0, 1.0, 0.8 );\n		frustumColors[2] = vec3( 0.0, 0.5, 1.0 );\n	#endif\n	#ifdef SHADOWMAP_CASCADE\n		int inFrustumCount = 0;\n	#endif\n	float fDepth;\n	vec3 shadowColor = vec3( 1.0 );\n	for( int i = 0; i < MAX_SHADOWS; i ++ ) {\n		vec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;\n		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n		bool inFrustum = all( inFrustumVec );\n		#ifdef SHADOWMAP_CASCADE\n			inFrustumCount += int( inFrustum );\n			bvec3 frustumTestVec = bvec3( inFrustum, inFrustumCount == 1, shadowCoord.z <= 1.0 );\n		#else\n			bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n		#endif\n		bool frustumTest = all( frustumTestVec );\n		if ( frustumTest ) {\n			shadowCoord.z += shadowBias[ i ];\n			#if defined( SHADOWMAP_TYPE_PCF )\n				float shadow = 0.0;\n				const float shadowDelta = 1.0 / 9.0;\n				float xPixelOffset = 1.0 / shadowMapSize[ i ].x;\n				float yPixelOffset = 1.0 / shadowMapSize[ i ].y;\n				float dx0 = -1.25 * xPixelOffset;\n				float dy0 = -1.25 * yPixelOffset;\n				float dx1 = 1.25 * xPixelOffset;\n				float dy1 = 1.25 * yPixelOffset;\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n				shadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\n			#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n				float shadow = 0.0;\n				float xPixelOffset = 1.0 / shadowMapSize[ i ].x;\n				float yPixelOffset = 1.0 / shadowMapSize[ i ].y;\n				float dx0 = -1.0 * xPixelOffset;\n				float dy0 = -1.0 * yPixelOffset;\n				float dx1 = 1.0 * xPixelOffset;\n				float dy1 = 1.0 * yPixelOffset;\n				mat3 shadowKernel;\n				mat3 depthKernel;\n				depthKernel[0][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\n				depthKernel[0][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\n				depthKernel[0][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\n				depthKernel[1][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\n				depthKernel[1][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\n				depthKernel[1][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\n				depthKernel[2][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\n				depthKernel[2][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\n				depthKernel[2][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\n				vec3 shadowZ = vec3( shadowCoord.z );\n				shadowKernel[0] = vec3(lessThan(depthKernel[0], shadowZ ));\n				shadowKernel[0] *= vec3(0.25);\n				shadowKernel[1] = vec3(lessThan(depthKernel[1], shadowZ ));\n				shadowKernel[1] *= vec3(0.25);\n				shadowKernel[2] = vec3(lessThan(depthKernel[2], shadowZ ));\n				shadowKernel[2] *= vec3(0.25);\n				vec2 fractionalCoord = 1.0 - fract( shadowCoord.xy * shadowMapSize[i].xy );\n				shadowKernel[0] = mix( shadowKernel[1], shadowKernel[0], fractionalCoord.x );\n				shadowKernel[1] = mix( shadowKernel[2], shadowKernel[1], fractionalCoord.x );\n				vec4 shadowValues;\n				shadowValues.x = mix( shadowKernel[0][1], shadowKernel[0][0], fractionalCoord.y );\n				shadowValues.y = mix( shadowKernel[0][2], shadowKernel[0][1], fractionalCoord.y );\n				shadowValues.z = mix( shadowKernel[1][1], shadowKernel[1][0], fractionalCoord.y );\n				shadowValues.w = mix( shadowKernel[1][2], shadowKernel[1][1], fractionalCoord.y );\n				shadow = dot( shadowValues, vec4( 1.0 ) );\n				shadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\n			#else\n				vec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );\n				float fDepth = unpackDepth( rgbaDepth );\n				if ( fDepth < shadowCoord.z )\n					shadowColor = shadowColor * vec3( 1.0 - shadowDarkness[ i ] );\n			#endif\n		}\n		#ifdef SHADOWMAP_DEBUG\n			#ifdef SHADOWMAP_CASCADE\n				if ( inFrustum && inFrustumCount == 1 ) gl_FragColor.xyz *= frustumColors[ i ];\n			#else\n				if ( inFrustum ) gl_FragColor.xyz *= frustumColors[ i ];\n			#endif\n		#endif\n	}\n	#ifdef GAMMA_OUTPUT\n		shadowColor *= shadowColor;\n	#endif\n	gl_FragColor.xyz = gl_FragColor.xyz * shadowColor;\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n	varying vec4 vShadowCoord[ MAX_SHADOWS ];\n	uniform mat4 shadowMatrix[ MAX_SHADOWS ];\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n	for( int i = 0; i < MAX_SHADOWS; i ++ ) {\n		vShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;\n	}\n#endif",alphatest_fragment:"#ifdef ALPHATEST\n	if ( gl_FragColor.a < ALPHATEST ) discard;\n#endif",linear_to_gamma_fragment:"#ifdef GAMMA_OUTPUT\n	gl_FragColor.xyz = sqrt( gl_FragColor.xyz );\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n	#ifdef USE_LOGDEPTHBUF_EXT\n		varying float vFragDepth;\n	#endif\n	uniform float logDepthBufFC;\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n	gl_Position.z = log2(max(1e-6, gl_Position.w + 1.0)) * logDepthBufFC;\n	#ifdef USE_LOGDEPTHBUF_EXT\n		vFragDepth = 1.0 + gl_Position.w;\n#else\n		gl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n	#endif\n#endif",logdepthbuf_pars_fragment:"#ifdef USE_LOGDEPTHBUF\n	uniform float logDepthBufFC;\n	#ifdef USE_LOGDEPTHBUF_EXT\n		#extension GL_EXT_frag_depth : enable\n		varying float vFragDepth;\n	#endif\n#endif",logdepthbuf_fragment:"#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\n	gl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n#endif"},THREE.UniformsUtils={merge:function(a){var b,c,d,e={};for(b=0;b<a.length;b++)for(c in d=this.clone(a[b]))e[c]=d[c];return e},clone:function(a){var b,c,d,e={};for(b in a)for(c in e[b]={},a[b])d=a[b][c],e[b][c]=d instanceof THREE.Color||d instanceof THREE.Vector2||d instanceof THREE.Vector3||d instanceof THREE.Vector4||d instanceof THREE.Matrix4||d instanceof THREE.Texture?d.clone():d instanceof Array?d.slice():d;return e}},THREE.UniformsLib={common:{diffuse:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new THREE.Vector4(0,0,1,1)},lightMap:{type:"t",value:null},specularMap:{type:"t",value:null},envMap:{type:"t",value:null},flipEnvMap:{type:"f",value:-1},useRefract:{type:"i",value:0},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:.98},combine:{type:"i",value:0},morphTargetInfluences:{type:"f",value:0}},bump:{bumpMap:{type:"t",value:null},bumpScale:{type:"f",value:1}},normalmap:{normalMap:{type:"t",value:null},normalScale:{type:"v2",value:new THREE.Vector2(1,1)}},fog:{fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new THREE.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},hemisphereLightDirection:{type:"fv",value:[]},hemisphereLightSkyColor:{type:"fv",value:[]},hemisphereLightGroundColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},spotLightColor:{type:"fv",value:[]},spotLightPosition:{type:"fv",value:[]},spotLightDirection:{type:"fv",value:[]},spotLightDistance:{type:"fv1",value:[]},spotLightAngleCos:{type:"fv1",value:[]},spotLightExponent:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:null},fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new THREE.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:[]},shadowMapSize:{type:"v2v",value:[]},shadowBias:{type:"fv1",value:[]},shadowDarkness:{type:"fv1",value:[]},shadowMatrix:{type:"m4v",value:[]}}},THREE.ShaderLib={basic:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,THREE.UniformsLib.shadowmap]),vertexShader:[THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.skinbase_vertex,"	#ifdef USE_ENVMAP",THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,"	#endif",THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.logdepthbuf_vertex,THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.specularmap_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {\n	gl_FragColor = vec4( diffuse, opacity );",THREE.ShaderChunk.logdepthbuf_fragment,THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.specularmap_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},lambert:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{ambient:{type:"c",value:new THREE.Color(16777215)},emissive:{type:"c",value:new THREE.Color(0)},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}}]),vertexShader:["#define LAMBERT\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n	varying vec3 vLightBack;\n#endif",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_lambert_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.logdepthbuf_vertex,THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.lights_lambert_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),
fragmentShader:["uniform float opacity;\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n	varying vec3 vLightBack;\n#endif",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.specularmap_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {\n	gl_FragColor = vec4( vec3( 1.0 ), opacity );",THREE.ShaderChunk.logdepthbuf_fragment,THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.specularmap_fragment,"	#ifdef DOUBLE_SIDED\n		if ( gl_FrontFacing )\n			gl_FragColor.xyz *= vLightFront;\n		else\n			gl_FragColor.xyz *= vLightBack;\n	#else\n		gl_FragColor.xyz *= vLightFront;\n	#endif",THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},phong:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.bump,THREE.UniformsLib.normalmap,THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{ambient:{type:"c",value:new THREE.Color(16777215)},emissive:{type:"c",value:new THREE.Color(0)},specular:{type:"c",value:new THREE.Color(1118481)},shininess:{type:"f",value:30},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}}]),vertexShader:["#define PHONG\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_phong_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,"	vNormal = normalize( transformedNormal );",THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.logdepthbuf_vertex,"	vViewPosition = -mvPosition.xyz;",THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.lights_phong_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;\nuniform vec3 ambient;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.lights_phong_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.bumpmap_pars_fragment,THREE.ShaderChunk.normalmap_pars_fragment,THREE.ShaderChunk.specularmap_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {\n	gl_FragColor = vec4( vec3( 1.0 ), opacity );",THREE.ShaderChunk.logdepthbuf_fragment,THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.specularmap_fragment,THREE.ShaderChunk.lights_phong_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},particle_basic:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.particle,THREE.UniformsLib.shadowmap]),vertexShader:["uniform float size;\nuniform float scale;",THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",THREE.ShaderChunk.color_vertex,"	vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n	#ifdef USE_SIZEATTENUATION\n		gl_PointSize = size * ( scale / length( mvPosition.xyz ) );\n	#else\n		gl_PointSize = size;\n	#endif\n	gl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk.logdepthbuf_vertex,THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 psColor;\nuniform float opacity;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_particle_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {\n	gl_FragColor = vec4( psColor, opacity );",THREE.ShaderChunk.logdepthbuf_fragment,THREE.ShaderChunk.map_particle_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},dashed:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,{scale:{type:"f",value:1},dashSize:{type:"f",value:1},totalSize:{type:"f",value:2}}]),vertexShader:["uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;",THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",THREE.ShaderChunk.color_vertex,"	vLineDistance = scale * lineDistance;\n	vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n	gl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {\n	if ( mod( vLineDistance, totalSize ) > dashSize ) {\n		discard;\n	}\n	gl_FragColor = vec4( diffuse, opacity );",THREE.ShaderChunk.logdepthbuf_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2e3},opacity:{type:"f",value:1}},vertexShader:[THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform float mNear;\nuniform float mFar;\nuniform float opacity;",THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {",THREE.ShaderChunk.logdepthbuf_fragment,"	#ifdef USE_LOGDEPTHBUF_EXT\n		float depth = gl_FragDepthEXT / gl_FragCoord.w;\n	#else\n		float depth = gl_FragCoord.z / gl_FragCoord.w;\n	#endif\n	float color = 1.0 - smoothstep( mNear, mFar, depth );\n	gl_FragColor = vec4( vec3( color ), opacity );\n}"].join("\n")},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:["varying vec3 vNormal;",THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {\n	vNormal = normalize( normalMatrix * normal );",THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;\nvarying vec3 vNormal;",THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {\n	gl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );",THREE.ShaderChunk.logdepthbuf_fragment,"}"].join("\n")},normalmap:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{enableAO:{type:"i",value:0},enableDiffuse:{type:"i",value:0},enableSpecular:{type:"i",value:0},enableReflection:{type:"i",value:0},enableDisplacement:{type:"i",value:0},tDisplacement:{type:"t",value:null},tDiffuse:{type:"t",value:null},tCube:{type:"t",value:null},tNormal:{type:"t",value:null},tSpecular:{type:"t",value:null},tAO:{type:"t",value:null},uNormalScale:{type:"v2",value:new THREE.Vector2(1,1)},uDisplacementBias:{type:"f",value:0},uDisplacementScale:{type:"f",value:1},diffuse:{type:"c",value:new THREE.Color(16777215)},specular:{type:"c",value:new THREE.Color(1118481)},ambient:{type:"c",value:new THREE.Color(16777215)},shininess:{type:"f",value:30},opacity:{type:"f",value:1},useRefract:{type:"i",value:0},refractionRatio:{type:"f",value:.98},reflectivity:{type:"f",value:.5},uOffset:{type:"v2",value:new THREE.Vector2(0,0)},uRepeat:{type:"v2",value:new THREE.Vector2(1,1)},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}}]),fragmentShader:["uniform vec3 ambient;\nuniform vec3 diffuse;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\nuniform bool enableDiffuse;\nuniform bool enableSpecular;\nuniform bool enableAO;\nuniform bool enableReflection;\nuniform sampler2D tDiffuse;\nuniform sampler2D tNormal;\nuniform sampler2D tSpecular;\nuniform sampler2D tAO;\nuniform samplerCube tCube;\nuniform vec2 uNormalScale;\nuniform bool useRefract;\nuniform float refractionRatio;\nuniform float reflectivity;\nvarying vec3 vTangent;\nvarying vec3 vBinormal;\nvarying vec3 vNormal;\nvarying vec2 vUv;\nuniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\n	uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\n	uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_HEMI_LIGHTS > 0\n	uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\n	uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\n	uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\n	uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n	uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n	uniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#endif\n#if MAX_SPOT_LIGHTS > 0\n	uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\n	uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\n	uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n#endif\n#ifdef WRAP_AROUND\n	uniform vec3 wrapRGB;\n#endif\nvarying vec3 vWorldPosition;\nvarying vec3 vViewPosition;",THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {",THREE.ShaderChunk.logdepthbuf_fragment,"	gl_FragColor = vec4( vec3( 1.0 ), opacity );\n	vec3 specularTex = vec3( 1.0 );\n	vec3 normalTex = texture2D( tNormal, vUv ).xyz * 2.0 - 1.0;\n	normalTex.xy *= uNormalScale;\n	normalTex = normalize( normalTex );\n	if( enableDiffuse ) {\n		#ifdef GAMMA_INPUT\n			vec4 texelColor = texture2D( tDiffuse, vUv );\n			texelColor.xyz *= texelColor.xyz;\n			gl_FragColor = gl_FragColor * texelColor;\n		#else\n			gl_FragColor = gl_FragColor * texture2D( tDiffuse, vUv );\n		#endif\n	}\n	if( enableAO ) {\n		#ifdef GAMMA_INPUT\n			vec4 aoColor = texture2D( tAO, vUv );\n			aoColor.xyz *= aoColor.xyz;\n			gl_FragColor.xyz = gl_FragColor.xyz * aoColor.xyz;\n		#else\n			gl_FragColor.xyz = gl_FragColor.xyz * texture2D( tAO, vUv ).xyz;\n		#endif\n	}\n	if( enableSpecular )\n		specularTex = texture2D( tSpecular, vUv ).xyz;\n	mat3 tsb = mat3( normalize( vTangent ), normalize( vBinormal ), normalize( vNormal ) );\n	vec3 finalNormal = tsb * normalTex;\n	#ifdef FLIP_SIDED\n		finalNormal = -finalNormal;\n	#endif\n	vec3 normal = normalize( finalNormal );\n	vec3 viewPosition = normalize( vViewPosition );\n	#if MAX_POINT_LIGHTS > 0\n		vec3 pointDiffuse = vec3( 0.0 );\n		vec3 pointSpecular = vec3( 0.0 );\n		for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n			vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\n			vec3 pointVector = lPosition.xyz + vViewPosition.xyz;\n			float pointDistance = 1.0;\n			if ( pointLightDistance[ i ] > 0.0 )\n				pointDistance = 1.0 - min( ( length( pointVector ) / pointLightDistance[ i ] ), 1.0 );\n			pointVector = normalize( pointVector );\n			#ifdef WRAP_AROUND\n				float pointDiffuseWeightFull = max( dot( normal, pointVector ), 0.0 );\n				float pointDiffuseWeightHalf = max( 0.5 * dot( normal, pointVector ) + 0.5, 0.0 );\n				vec3 pointDiffuseWeight = mix( vec3( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );\n			#else\n				float pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );\n			#endif\n			pointDiffuse += pointDistance * pointLightColor[ i ] * diffuse * pointDiffuseWeight;\n			vec3 pointHalfVector = normalize( pointVector + viewPosition );\n			float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\n			float pointSpecularWeight = specularTex.r * max( pow( pointDotNormalHalf, shininess ), 0.0 );\n			float specularNormalization = ( shininess + 2.0001 ) / 8.0;\n			vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( pointVector, pointHalfVector ), 5.0 );\n			pointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * pointDistance * specularNormalization;\n		}\n	#endif\n	#if MAX_SPOT_LIGHTS > 0\n		vec3 spotDiffuse = vec3( 0.0 );\n		vec3 spotSpecular = vec3( 0.0 );\n		for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n			vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\n			vec3 spotVector = lPosition.xyz + vViewPosition.xyz;\n			float spotDistance = 1.0;\n			if ( spotLightDistance[ i ] > 0.0 )\n				spotDistance = 1.0 - min( ( length( spotVector ) / spotLightDistance[ i ] ), 1.0 );\n			spotVector = normalize( spotVector );\n			float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );\n			if ( spotEffect > spotLightAngleCos[ i ] ) {\n				spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );\n				#ifdef WRAP_AROUND\n					float spotDiffuseWeightFull = max( dot( normal, spotVector ), 0.0 );\n					float spotDiffuseWeightHalf = max( 0.5 * dot( normal, spotVector ) + 0.5, 0.0 );\n					vec3 spotDiffuseWeight = mix( vec3( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );\n				#else\n					float spotDiffuseWeight = max( dot( normal, spotVector ), 0.0 );\n				#endif\n				spotDiffuse += spotDistance * spotLightColor[ i ] * diffuse * spotDiffuseWeight * spotEffect;\n				vec3 spotHalfVector = normalize( spotVector + viewPosition );\n				float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );\n				float spotSpecularWeight = specularTex.r * max( pow( spotDotNormalHalf, shininess ), 0.0 );\n				float specularNormalization = ( shininess + 2.0001 ) / 8.0;\n				vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( spotVector, spotHalfVector ), 5.0 );\n				spotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * spotDistance * specularNormalization * spotEffect;\n			}\n		}\n	#endif\n	#if MAX_DIR_LIGHTS > 0\n		vec3 dirDiffuse = vec3( 0.0 );\n		vec3 dirSpecular = vec3( 0.0 );\n		for( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {\n			vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\n			vec3 dirVector = normalize( lDirection.xyz );\n			#ifdef WRAP_AROUND\n				float directionalLightWeightingFull = max( dot( normal, dirVector ), 0.0 );\n				float directionalLightWeightingHalf = max( 0.5 * dot( normal, dirVector ) + 0.5, 0.0 );\n				vec3 dirDiffuseWeight = mix( vec3( directionalLightWeightingFull ), vec3( directionalLightWeightingHalf ), wrapRGB );\n			#else\n				float dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );\n			#endif\n			dirDiffuse += directionalLightColor[ i ] * diffuse * dirDiffuseWeight;\n			vec3 dirHalfVector = normalize( dirVector + viewPosition );\n			float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\n			float dirSpecularWeight = specularTex.r * max( pow( dirDotNormalHalf, shininess ), 0.0 );\n			float specularNormalization = ( shininess + 2.0001 ) / 8.0;\n			vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );\n			dirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\n		}\n	#endif\n	#if MAX_HEMI_LIGHTS > 0\n		vec3 hemiDiffuse  = vec3( 0.0 );\n		vec3 hemiSpecular = vec3( 0.0 );\n		for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\n			vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );\n			vec3 lVector = normalize( lDirection.xyz );\n			float dotProduct = dot( normal, lVector );\n			float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\n			vec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n			hemiDiffuse += diffuse * hemiColor;\n			vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );\n			float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;\n			float hemiSpecularWeightSky = specularTex.r * max( pow( hemiDotNormalHalfSky, shininess ), 0.0 );\n			vec3 lVectorGround = -lVector;\n			vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );\n			float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;\n			float hemiSpecularWeightGround = specularTex.r * max( pow( hemiDotNormalHalfGround, shininess ), 0.0 );\n			float dotProductGround = dot( normal, lVectorGround );\n			float specularNormalization = ( shininess + 2.0001 ) / 8.0;\n			vec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, hemiHalfVectorSky ), 5.0 );\n			vec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 5.0 );\n			hemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );\n		}\n	#endif\n	vec3 totalDiffuse = vec3( 0.0 );\n	vec3 totalSpecular = vec3( 0.0 );\n	#if MAX_DIR_LIGHTS > 0\n		totalDiffuse += dirDiffuse;\n		totalSpecular += dirSpecular;\n	#endif\n	#if MAX_HEMI_LIGHTS > 0\n		totalDiffuse += hemiDiffuse;\n		totalSpecular += hemiSpecular;\n	#endif\n	#if MAX_POINT_LIGHTS > 0\n		totalDiffuse += pointDiffuse;\n		totalSpecular += pointSpecular;\n	#endif\n	#if MAX_SPOT_LIGHTS > 0\n		totalDiffuse += spotDiffuse;\n		totalSpecular += spotSpecular;\n	#endif\n	#ifdef METAL\n		gl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * ambient + totalSpecular );\n	#else\n		gl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * ambient ) + totalSpecular;\n	#endif\n	if ( enableReflection ) {\n		vec3 vReflect;\n		vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n		if ( useRefract ) {\n			vReflect = refract( cameraToVertex, normal, refractionRatio );\n		} else {\n			vReflect = reflect( cameraToVertex, normal );\n		}\n		vec4 cubeColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );\n		#ifdef GAMMA_INPUT\n			cubeColor.xyz *= cubeColor.xyz;\n		#endif\n		gl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularTex.r * reflectivity );\n	}",THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["attribute vec4 tangent;\nuniform vec2 uOffset;\nuniform vec2 uRepeat;\nuniform bool enableDisplacement;\n#ifdef VERTEX_TEXTURES\n	uniform sampler2D tDisplacement;\n	uniform float uDisplacementScale;\n	uniform float uDisplacementBias;\n#endif\nvarying vec3 vTangent;\nvarying vec3 vBinormal;\nvarying vec3 vNormal;\nvarying vec2 vUv;\nvarying vec3 vWorldPosition;\nvarying vec3 vViewPosition;",THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.skinnormal_vertex,"	#ifdef USE_SKINNING\n		vNormal = normalize( normalMatrix * skinnedNormal.xyz );\n		vec4 skinnedTangent = skinMatrix * vec4( tangent.xyz, 0.0 );\n		vTangent = normalize( normalMatrix * skinnedTangent.xyz );\n	#else\n		vNormal = normalize( normalMatrix * normal );\n		vTangent = normalize( normalMatrix * tangent.xyz );\n	#endif\n	vBinormal = normalize( cross( vNormal, vTangent ) * tangent.w );\n	vUv = uv * uRepeat + uOffset;\n	vec3 displacedPosition;\n	#ifdef VERTEX_TEXTURES\n		if ( enableDisplacement ) {\n			vec3 dv = texture2D( tDisplacement, uv ).xyz;\n			float df = uDisplacementScale * dv.x + uDisplacementBias;\n			displacedPosition = position + normalize( normal ) * df;\n		} else {\n			#ifdef USE_SKINNING\n				vec4 skinVertex = vec4( position, 1.0 );\n				vec4 skinned  = boneMatX * skinVertex * skinWeight.x;\n				skinned 	  += boneMatY * skinVertex * skinWeight.y;\n				skinned 	  += boneMatZ * skinVertex * skinWeight.z;\n				skinned 	  += boneMatW * skinVertex * skinWeight.w;\n				displacedPosition  = skinned.xyz;\n			#else\n				displacedPosition = position;\n			#endif\n		}\n	#else\n		#ifdef USE_SKINNING\n			vec4 skinVertex = vec4( position, 1.0 );\n			vec4 skinned  = boneMatX * skinVertex * skinWeight.x;\n			skinned 	  += boneMatY * skinVertex * skinWeight.y;\n			skinned 	  += boneMatZ * skinVertex * skinWeight.z;\n			skinned 	  += boneMatW * skinVertex * skinWeight.w;\n			displacedPosition  = skinned.xyz;\n		#else\n			displacedPosition = position;\n		#endif\n	#endif\n	vec4 mvPosition = modelViewMatrix * vec4( displacedPosition, 1.0 );\n	vec4 worldPosition = modelMatrix * vec4( displacedPosition, 1.0 );\n	gl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk.logdepthbuf_vertex,"	vWorldPosition = worldPosition.xyz;\n	vViewPosition = -mvPosition.xyz;\n	#ifdef USE_SHADOWMAP\n		for( int i = 0; i < MAX_SHADOWS; i ++ ) {\n			vShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;\n		}\n	#endif\n}"].join("\n")},cube:{uniforms:{tCube:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:["varying vec3 vWorldPosition;",THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {\n	vec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n	vWorldPosition = worldPosition.xyz;\n	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform samplerCube tCube;\nuniform float tFlip;\nvarying vec3 vWorldPosition;",THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {\n	gl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );",THREE.ShaderChunk.logdepthbuf_fragment,"}"].join("\n")},depthRGBA:{uniforms:{},vertexShader:[THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:[THREE.ShaderChunk.logdepthbuf_pars_fragment,"vec4 pack_depth( const in float depth ) {\n	const vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );\n	const vec4 bit_mask  = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );\n	vec4 res = mod( depth * bit_shift * vec4( 255 ), vec4( 256 ) ) / vec4( 255 );\n	res -= res.xxyz * bit_mask;\n	return res;\n}\nvoid main() {",THREE.ShaderChunk.logdepthbuf_fragment,"	#ifdef USE_LOGDEPTHBUF_EXT\n		gl_FragData[ 0 ] = pack_depth( gl_FragDepthEXT );\n	#else\n		gl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );\n	#endif\n}"].join("\n")}},THREE.WebGLRenderer=function(a){function b(a,b){var c=a.vertices.length,d=b.material;if(d.attributes){void 0===a.__webglCustomAttributesList&&(a.__webglCustomAttributesList=[]);for(var e in d.attributes){var f=d.attributes[e];if(!f.__webglInitialized||f.createUniqueBuffers){f.__webglInitialized=!0;var g=1;"v2"===f.type?g=2:"v3"===f.type?g=3:"v4"===f.type?g=4:"c"===f.type&&(g=3),f.size=g,f.array=new Float32Array(c*g),f.buffer=S.createBuffer(),f.buffer.belongsToAttribute=e,f.needsUpdate=!0}a.__webglCustomAttributesList.push(f)}}}function c(a,b){var c=b.geometry,g=a.faces3,h=3*g.length,i=1*g.length,j=3*g.length,g=d(b,a),k=f(g),l=e(g),m=g.vertexColors?g.vertexColors:!1;if(a.__vertexArray=new Float32Array(3*h),l&&(a.__normalArray=new Float32Array(3*h)),c.hasTangents&&(a.__tangentArray=new Float32Array(4*h)),m&&(a.__colorArray=new Float32Array(3*h)),k&&(0<c.faceVertexUvs.length&&(a.__uvArray=new Float32Array(2*h)),1<c.faceVertexUvs.length&&(a.__uv2Array=new Float32Array(2*h))),b.geometry.skinWeights.length&&b.geometry.skinIndices.length&&(a.__skinIndexArray=new Float32Array(4*h),a.__skinWeightArray=new Float32Array(4*h)),c=null!==X&&i>21845?Uint32Array:Uint16Array,a.__typeArray=c,a.__faceArray=new c(3*i),a.__lineArray=new c(2*j),a.numMorphTargets)for(a.__morphTargetsArrays=[],c=0,k=a.numMorphTargets;k>c;c++)a.__morphTargetsArrays.push(new Float32Array(3*h));if(a.numMorphNormals)for(a.__morphNormalsArrays=[],c=0,k=a.numMorphNormals;k>c;c++)a.__morphNormalsArrays.push(new Float32Array(3*h));if(a.__webglFaceCount=3*i,a.__webglLineCount=2*j,g.attributes){void 0===a.__webglCustomAttributesList&&(a.__webglCustomAttributesList=[]);for(var n in g.attributes){var o,i=g.attributes[n],j={};for(o in i)j[o]=i[o];j.__webglInitialized&&!j.createUniqueBuffers||(j.__webglInitialized=!0,c=1,"v2"===j.type?c=2:"v3"===j.type?c=3:"v4"===j.type?c=4:"c"===j.type&&(c=3),j.size=c,j.array=new Float32Array(h*c),j.buffer=S.createBuffer(),j.buffer.belongsToAttribute=n,i.needsUpdate=!0,j.__original=i),a.__webglCustomAttributesList.push(j)}}a.__inittedArrays=!0}function d(a,b){return a.material instanceof THREE.MeshFaceMaterial?a.material.materials[b.materialIndex]:a.material}function e(a){return a instanceof THREE.MeshBasicMaterial&&!a.envMap||a instanceof THREE.MeshDepthMaterial?!1:a&&void 0!==a.shading&&a.shading===THREE.SmoothShading?THREE.SmoothShading:THREE.FlatShading}function f(a){return!!(a.map||a.lightMap||a.bumpMap||a.normalMap||a.specularMap||a instanceof THREE.ShaderMaterial)}function g(a,b,c,d){for(var e in b){var f=b[e],g=c[e];if(f>=0)if(g){var h=g.itemSize;S.bindBuffer(S.ARRAY_BUFFER,g.buffer),i(f),S.vertexAttribPointer(f,h,S.FLOAT,!1,0,d*h*4)}else a.defaultAttributeValues&&(2===a.defaultAttributeValues[e].length?S.vertexAttrib2fv(f,a.defaultAttributeValues[e]):3===a.defaultAttributeValues[e].length&&S.vertexAttrib3fv(f,a.defaultAttributeValues[e]))}j()}function h(){for(var a=0,b=wa.length;b>a;a++)wa[a]=0}function i(a){wa[a]=1,0===xa[a]&&(S.enableVertexAttribArray(a),xa[a]=1)}function j(){for(var a=0,b=xa.length;b>a;a++)xa[a]!==wa[a]&&(S.disableVertexAttribArray(a),xa[a]=0)}function k(a,b){return a.z!==b.z?b.z-a.z:a.id-b.id}function l(a,b){return b[0]-a[0]}function m(a,b,c){if(a.length)for(var d=0,e=a.length;e>d;d++)ca=$=null,aa=ba=fa=ea=la=ka=ga=-1,Da=!0,a[d].render(b,c,ua,va),ca=$=null,aa=ba=fa=ea=la=ka=ga=-1,Da=!0}function n(a,b,c,d,e,f,g,h){var i,j,k,l;b?(j=a.length-1,l=b=-1):(j=0,b=a.length,l=1);for(var m=j;m!==b;m+=l)if(i=a[m],i.render){if(j=i.object,k=i.buffer,h)i=h;else{if(i=i[c],!i)continue;g&&Y.setBlending(i.blending,i.blendEquation,i.blendSrc,i.blendDst),Y.setDepthTest(i.depthTest),Y.setDepthWrite(i.depthWrite),B(i.polygonOffset,i.polygonOffsetFactor,i.polygonOffsetUnits)}Y.setMaterialFaces(i),k instanceof THREE.BufferGeometry?Y.renderBufferDirect(d,e,f,i,k,j):Y.renderBuffer(d,e,f,i,k,j)}}function o(a,b,c,d,e,f,g){for(var h,i,j=0,k=a.length;k>j;j++)if(h=a[j],i=h.object,i.visible){if(g)h=g;else{if(h=h[b],!h)continue;f&&Y.setBlending(h.blending,h.blendEquation,h.blendSrc,h.blendDst),Y.setDepthTest(h.depthTest),Y.setDepthWrite(h.depthWrite),B(h.polygonOffset,h.polygonOffsetFactor,h.polygonOffsetUnits)}Y.renderImmediateObject(c,d,e,h,i)}}function p(a,d){var e,f,g;if(void 0===a.__webglInit&&(a.__webglInit=!0,a._modelViewMatrix=new THREE.Matrix4,a._normalMatrix=new THREE.Matrix3,f=a.geometry,void 0!==f&&void 0===f.__webglInit))if(f.__webglInit=!0,f.addEventListener("dispose",Ra),f instanceof THREE.BufferGeometry)for(g in f.attributes){var h="index"===g?S.ELEMENT_ARRAY_BUFFER:S.ARRAY_BUFFER,i=f.attributes[g];i.buffer=S.createBuffer(),S.bindBuffer(h,i.buffer),S.bufferData(h,i.array,S.STATIC_DRAW)}else if(a instanceof THREE.Mesh){for(e in g=a.material,void 0===f.geometryGroups&&f.makeGroups(g instanceof THREE.MeshFaceMaterial,X?4294967296:65535),f.geometryGroups)if(g=f.geometryGroups[e],!g.__webglVertexBuffer){h=g,h.__webglVertexBuffer=S.createBuffer(),h.__webglNormalBuffer=S.createBuffer(),h.__webglTangentBuffer=S.createBuffer(),h.__webglColorBuffer=S.createBuffer(),h.__webglUVBuffer=S.createBuffer(),h.__webglUV2Buffer=S.createBuffer(),h.__webglSkinIndicesBuffer=S.createBuffer(),h.__webglSkinWeightsBuffer=S.createBuffer(),h.__webglFaceBuffer=S.createBuffer(),h.__webglLineBuffer=S.createBuffer();var j=i=void 0;if(h.numMorphTargets)for(h.__webglMorphTargetsBuffers=[],i=0,j=h.numMorphTargets;j>i;i++)h.__webglMorphTargetsBuffers.push(S.createBuffer());if(h.numMorphNormals)for(h.__webglMorphNormalsBuffers=[],i=0,j=h.numMorphNormals;j>i;i++)h.__webglMorphNormalsBuffers.push(S.createBuffer());Y.info.memory.geometries++,c(g,a),f.verticesNeedUpdate=!0,f.morphTargetsNeedUpdate=!0,f.elementsNeedUpdate=!0,f.uvsNeedUpdate=!0,f.normalsNeedUpdate=!0,f.tangentsNeedUpdate=!0,f.colorsNeedUpdate=!0}}else a instanceof THREE.Line?f.__webglVertexBuffer||(g=f,g.__webglVertexBuffer=S.createBuffer(),g.__webglColorBuffer=S.createBuffer(),g.__webglLineDistanceBuffer=S.createBuffer(),Y.info.memory.geometries++,g=f,h=g.vertices.length,g.__vertexArray=new Float32Array(3*h),g.__colorArray=new Float32Array(3*h),g.__lineDistanceArray=new Float32Array(1*h),g.__webglLineCount=h,b(g,a),f.verticesNeedUpdate=!0,f.colorsNeedUpdate=!0,f.lineDistancesNeedUpdate=!0):a instanceof THREE.ParticleSystem&&!f.__webglVertexBuffer&&(g=f,g.__webglVertexBuffer=S.createBuffer(),g.__webglColorBuffer=S.createBuffer(),Y.info.memory.geometries++,g=f,h=g.vertices.length,g.__vertexArray=new Float32Array(3*h),g.__colorArray=new Float32Array(3*h),g.__sortArray=[],g.__webglParticleCount=h,b(g,a),f.verticesNeedUpdate=!0,f.colorsNeedUpdate=!0);if(void 0===a.__webglActive){if(a instanceof THREE.Mesh){if(f=a.geometry,f instanceof THREE.BufferGeometry)q(d.__webglObjects,f,a);else if(f instanceof THREE.Geometry)for(e in f.geometryGroups)g=f.geometryGroups[e],q(d.__webglObjects,g,a)}else a instanceof THREE.Line||a instanceof THREE.ParticleSystem?(f=a.geometry,q(d.__webglObjects,f,a)):a instanceof THREE.ImmediateRenderObject||a.immediateRenderCallback?d.__webglObjectsImmediate.push({id:null,object:a,opaque:null,transparent:null,z:0}):a instanceof THREE.Sprite?d.__webglSprites.push(a):a instanceof THREE.LensFlare&&d.__webglFlares.push(a);a.__webglActive=!0}}function q(a,b,c){a.push({id:null,buffer:b,object:c,opaque:null,transparent:null,z:0})}function r(a){for(var b in a.attributes)if(a.attributes[b].needsUpdate)return!0;return!1}function s(a){for(var b in a.attributes)a.attributes[b].needsUpdate=!1}function t(a,b){a instanceof THREE.Mesh||a instanceof THREE.ParticleSystem||a instanceof THREE.Line?u(b.__webglObjects,a):a instanceof THREE.Sprite?v(b.__webglSprites,a):a instanceof THREE.LensFlare?v(b.__webglFlares,a):(a instanceof THREE.ImmediateRenderObject||a.immediateRenderCallback)&&u(b.__webglObjectsImmediate,a),delete a.__webglActive}function u(a,b){for(var c=a.length-1;c>=0;c--)a[c].object===b&&a.splice(c,1)}function v(a,b){for(var c=a.length-1;c>=0;c--)a[c]===b&&a.splice(c,1)}function w(a,b,c,d,e){da=0,d.needsUpdate&&(d.program&&Wa(d),Y.initMaterial(d,b,c,e),d.needsUpdate=!1),d.morphTargets&&!e.__webglMorphTargetInfluences&&(e.__webglMorphTargetInfluences=new Float32Array(Y.maxMorphTargets));var f=!1,g=d.program,h=g.uniforms,i=d.uniforms;if(g.id!==$&&(S.useProgram(g.program),$=g.id,f=!0),d.id!==aa&&(aa=d.id,f=!0),(f||a!==ca)&&(S.uniformMatrix4fv(h.projectionMatrix,!1,a.projectionMatrix.elements),P&&S.uniform1f(h.logDepthBufFC,2/(Math.log(a.far+1)/Math.LN2)),a!==ca&&(ca=a)),d.skinning)if(Ka&&e.skeleton.useVertexTexture){if(null!==h.boneTexture){var j=x();S.uniform1i(h.boneTexture,j),Y.setTexture(e.skeleton.boneTexture,j)}null!==h.boneTextureWidth&&S.uniform1i(h.boneTextureWidth,e.skeleton.boneTextureWidth),null!==h.boneTextureHeight&&S.uniform1i(h.boneTextureHeight,e.skeleton.boneTextureHeight);
}else null!==h.boneGlobalMatrices&&S.uniformMatrix4fv(h.boneGlobalMatrices,!1,e.skeleton.boneMatrices);if(f){if(c&&d.fog&&(i.fogColor.value=c.color,c instanceof THREE.Fog?(i.fogNear.value=c.near,i.fogFar.value=c.far):c instanceof THREE.FogExp2&&(i.fogDensity.value=c.density)),d instanceof THREE.MeshPhongMaterial||d instanceof THREE.MeshLambertMaterial||d.lights){if(Da){var k,l,m,n,o=j=0,p=0,q=Ea,r=q.directional.colors,s=q.directional.positions,t=q.point.colors,u=q.point.positions,v=q.point.distances,w=q.spot.colors,A=q.spot.positions,B=q.spot.distances,D=q.spot.directions,E=q.spot.anglesCos,H=q.spot.exponents,I=q.hemi.skyColors,J=q.hemi.groundColors,K=q.hemi.positions,L=0,M=0,N=0,O=0,Q=0,R=0,T=0,U=0,V=k=0;for(c=n=V=0,f=b.length;f>c;c++)k=b[c],k.onlyShadow||(l=k.color,m=k.intensity,n=k.distance,k instanceof THREE.AmbientLight?k.visible&&(Y.gammaInput?(j+=l.r*l.r,o+=l.g*l.g,p+=l.b*l.b):(j+=l.r,o+=l.g,p+=l.b)):k instanceof THREE.DirectionalLight?(Q+=1,k.visible&&(Ca.setFromMatrixPosition(k.matrixWorld),Ba.setFromMatrixPosition(k.target.matrixWorld),Ca.sub(Ba),Ca.normalize(),0!==Ca.x||0!==Ca.y||0!==Ca.z)&&(k=3*L,s[k]=Ca.x,s[k+1]=Ca.y,s[k+2]=Ca.z,Y.gammaInput?y(r,k,l,m*m):z(r,k,l,m),L+=1)):k instanceof THREE.PointLight?(R+=1,k.visible&&(V=3*M,Y.gammaInput?y(t,V,l,m*m):z(t,V,l,m),Ba.setFromMatrixPosition(k.matrixWorld),u[V]=Ba.x,u[V+1]=Ba.y,u[V+2]=Ba.z,v[M]=n,M+=1)):k instanceof THREE.SpotLight?(T+=1,k.visible&&(V=3*N,Y.gammaInput?y(w,V,l,m*m):z(w,V,l,m),Ba.setFromMatrixPosition(k.matrixWorld),A[V]=Ba.x,A[V+1]=Ba.y,A[V+2]=Ba.z,B[N]=n,Ca.copy(Ba),Ba.setFromMatrixPosition(k.target.matrixWorld),Ca.sub(Ba),Ca.normalize(),D[V]=Ca.x,D[V+1]=Ca.y,D[V+2]=Ca.z,E[N]=Math.cos(k.angle),H[N]=k.exponent,N+=1)):k instanceof THREE.HemisphereLight&&(U+=1,k.visible&&(Ca.setFromMatrixPosition(k.matrixWorld),Ca.normalize(),0!==Ca.x||0!==Ca.y||0!==Ca.z))&&(n=3*O,K[n]=Ca.x,K[n+1]=Ca.y,K[n+2]=Ca.z,l=k.color,k=k.groundColor,Y.gammaInput?(m*=m,y(I,n,l,m),y(J,n,k,m)):(z(I,n,l,m),z(J,n,k,m)),O+=1));for(c=3*L,f=Math.max(r.length,3*Q);f>c;c++)r[c]=0;for(c=3*M,f=Math.max(t.length,3*R);f>c;c++)t[c]=0;for(c=3*N,f=Math.max(w.length,3*T);f>c;c++)w[c]=0;for(c=3*O,f=Math.max(I.length,3*U);f>c;c++)I[c]=0;for(c=3*O,f=Math.max(J.length,3*U);f>c;c++)J[c]=0;q.directional.length=L,q.point.length=M,q.spot.length=N,q.hemi.length=O,q.ambient[0]=j,q.ambient[1]=o,q.ambient[2]=p,Da=!1}c=Ea,i.ambientLightColor.value=c.ambient,i.directionalLightColor.value=c.directional.colors,i.directionalLightDirection.value=c.directional.positions,i.pointLightColor.value=c.point.colors,i.pointLightPosition.value=c.point.positions,i.pointLightDistance.value=c.point.distances,i.spotLightColor.value=c.spot.colors,i.spotLightPosition.value=c.spot.positions,i.spotLightDistance.value=c.spot.distances,i.spotLightDirection.value=c.spot.directions,i.spotLightAngleCos.value=c.spot.anglesCos,i.spotLightExponent.value=c.spot.exponents,i.hemisphereLightSkyColor.value=c.hemi.skyColors,i.hemisphereLightGroundColor.value=c.hemi.groundColors,i.hemisphereLightDirection.value=c.hemi.positions}if(d instanceof THREE.MeshBasicMaterial||d instanceof THREE.MeshLambertMaterial||d instanceof THREE.MeshPhongMaterial){i.opacity.value=d.opacity,Y.gammaInput?i.diffuse.value.copyGammaToLinear(d.color):i.diffuse.value=d.color,i.map.value=d.map,i.lightMap.value=d.lightMap,i.specularMap.value=d.specularMap,d.bumpMap&&(i.bumpMap.value=d.bumpMap,i.bumpScale.value=d.bumpScale),d.normalMap&&(i.normalMap.value=d.normalMap,i.normalScale.value.copy(d.normalScale));var W;d.map?W=d.map:d.specularMap?W=d.specularMap:d.normalMap?W=d.normalMap:d.bumpMap&&(W=d.bumpMap),void 0!==W&&(c=W.offset,W=W.repeat,i.offsetRepeat.value.set(c.x,c.y,W.x,W.y)),i.envMap.value=d.envMap,i.flipEnvMap.value=d.envMap instanceof THREE.WebGLRenderTargetCube?1:-1,i.reflectivity.value=d.reflectivity,i.refractionRatio.value=d.refractionRatio,i.combine.value=d.combine,i.useRefract.value=d.envMap&&d.envMap.mapping instanceof THREE.CubeRefractionMapping}if(d instanceof THREE.LineBasicMaterial?(i.diffuse.value=d.color,i.opacity.value=d.opacity):d instanceof THREE.LineDashedMaterial?(i.diffuse.value=d.color,i.opacity.value=d.opacity,i.dashSize.value=d.dashSize,i.totalSize.value=d.dashSize+d.gapSize,i.scale.value=d.scale):d instanceof THREE.ParticleSystemMaterial?(i.psColor.value=d.color,i.opacity.value=d.opacity,i.size.value=d.size,i.scale.value=G.height/2,i.map.value=d.map):d instanceof THREE.MeshPhongMaterial?(i.shininess.value=d.shininess,Y.gammaInput?(i.ambient.value.copyGammaToLinear(d.ambient),i.emissive.value.copyGammaToLinear(d.emissive),i.specular.value.copyGammaToLinear(d.specular)):(i.ambient.value=d.ambient,i.emissive.value=d.emissive,i.specular.value=d.specular),d.wrapAround&&i.wrapRGB.value.copy(d.wrapRGB)):d instanceof THREE.MeshLambertMaterial?(Y.gammaInput?(i.ambient.value.copyGammaToLinear(d.ambient),i.emissive.value.copyGammaToLinear(d.emissive)):(i.ambient.value=d.ambient,i.emissive.value=d.emissive),d.wrapAround&&i.wrapRGB.value.copy(d.wrapRGB)):d instanceof THREE.MeshDepthMaterial?(i.mNear.value=a.near,i.mFar.value=a.far,i.opacity.value=d.opacity):d instanceof THREE.MeshNormalMaterial&&(i.opacity.value=d.opacity),e.receiveShadow&&!d._shadowPass&&i.shadowMatrix)for(c=W=0,f=b.length;f>c;c++)j=b[c],j.castShadow&&(j instanceof THREE.SpotLight||j instanceof THREE.DirectionalLight&&!j.shadowCascade)&&(i.shadowMap.value[W]=j.shadowMap,i.shadowMapSize.value[W]=j.shadowMapSize,i.shadowMatrix.value[W]=j.shadowMatrix,i.shadowDarkness.value[W]=j.shadowDarkness,i.shadowBias.value[W]=j.shadowBias,W++);for(b=d.uniformsList,i=0,W=b.length;W>i;i++)if(f=g.uniforms[b[i][1]])if(c=b[i][0],o=c.type,j=c.value,"i"===o)S.uniform1i(f,j);else if("f"===o)S.uniform1f(f,j);else if("v2"===o)S.uniform2f(f,j.x,j.y);else if("v3"===o)S.uniform3f(f,j.x,j.y,j.z);else if("v4"===o)S.uniform4f(f,j.x,j.y,j.z,j.w);else if("c"===o)S.uniform3f(f,j.r,j.g,j.b);else if("iv1"===o)S.uniform1iv(f,j);else if("iv"===o)S.uniform3iv(f,j);else if("fv1"===o)S.uniform1fv(f,j);else if("fv"===o)S.uniform3fv(f,j);else if("v2v"===o){for(void 0===c._array&&(c._array=new Float32Array(2*j.length)),o=0,p=j.length;p>o;o++)q=2*o,c._array[q]=j[o].x,c._array[q+1]=j[o].y;S.uniform2fv(f,c._array)}else if("v3v"===o){for(void 0===c._array&&(c._array=new Float32Array(3*j.length)),o=0,p=j.length;p>o;o++)q=3*o,c._array[q]=j[o].x,c._array[q+1]=j[o].y,c._array[q+2]=j[o].z;S.uniform3fv(f,c._array)}else if("v4v"===o){for(void 0===c._array&&(c._array=new Float32Array(4*j.length)),o=0,p=j.length;p>o;o++)q=4*o,c._array[q]=j[o].x,c._array[q+1]=j[o].y,c._array[q+2]=j[o].z,c._array[q+3]=j[o].w;S.uniform4fv(f,c._array)}else if("m3"===o)S.uniformMatrix3fv(f,!1,j.elements);else if("m3v"===o){for(void 0===c._array&&(c._array=new Float32Array(9*j.length)),o=0,p=j.length;p>o;o++)j[o].flattenToArrayOffset(c._array,9*o);S.uniformMatrix3fv(f,!1,c._array)}else if("m4"===o)S.uniformMatrix4fv(f,!1,j.elements);else if("m4v"===o){for(void 0===c._array&&(c._array=new Float32Array(16*j.length)),o=0,p=j.length;p>o;o++)j[o].flattenToArrayOffset(c._array,16*o);S.uniformMatrix4fv(f,!1,c._array)}else if("t"===o){if(q=j,j=x(),S.uniform1i(f,j),q)if(q.image instanceof Array&&6===q.image.length){if(c=q,f=j,6===c.image.length)if(c.needsUpdate){for(c.image.__webglTextureCube||(c.addEventListener("dispose",Sa),c.image.__webglTextureCube=S.createTexture(),Y.info.memory.textures++),S.activeTexture(S.TEXTURE0+f),S.bindTexture(S.TEXTURE_CUBE_MAP,c.image.__webglTextureCube),S.pixelStorei(S.UNPACK_FLIP_Y_WEBGL,c.flipY),f=c instanceof THREE.CompressedTexture,j=[],o=0;6>o;o++)Y.autoScaleCubemaps&&!f?(p=j,q=o,r=c.image[o],t=Ha,r.width<=t&&r.height<=t||(u=Math.max(r.width,r.height),s=Math.floor(r.width*t/u),t=Math.floor(r.height*t/u),u=document.createElement("canvas"),u.width=s,u.height=t,u.getContext("2d").drawImage(r,0,0,r.width,r.height,0,0,s,t),r=u),p[q]=r):j[o]=c.image[o];for(o=j[0],p=THREE.Math.isPowerOfTwo(o.width)&&THREE.Math.isPowerOfTwo(o.height),q=F(c.format),r=F(c.type),C(S.TEXTURE_CUBE_MAP,c,p),o=0;6>o;o++)if(f)for(t=j[o].mipmaps,u=0,v=t.length;v>u;u++)s=t[u],c.format!==THREE.RGBAFormat?S.compressedTexImage2D(S.TEXTURE_CUBE_MAP_POSITIVE_X+o,u,q,s.width,s.height,0,s.data):S.texImage2D(S.TEXTURE_CUBE_MAP_POSITIVE_X+o,u,q,s.width,s.height,0,q,r,s.data);else S.texImage2D(S.TEXTURE_CUBE_MAP_POSITIVE_X+o,0,q,q,r,j[o]);c.generateMipmaps&&p&&S.generateMipmap(S.TEXTURE_CUBE_MAP),c.needsUpdate=!1,c.onUpdate&&c.onUpdate()}else S.activeTexture(S.TEXTURE0+f),S.bindTexture(S.TEXTURE_CUBE_MAP,c.image.__webglTextureCube)}else q instanceof THREE.WebGLRenderTargetCube?(c=q,S.activeTexture(S.TEXTURE0+j),S.bindTexture(S.TEXTURE_CUBE_MAP,c.__webglTexture)):Y.setTexture(q,j)}else if("tv"===o){for(void 0===c._array&&(c._array=[]),o=0,p=c.value.length;p>o;o++)c._array[o]=x();for(S.uniform1iv(f,c._array),o=0,p=c.value.length;p>o;o++)q=c.value[o],j=c._array[o],q&&Y.setTexture(q,j)}else console.warn("THREE.WebGLRenderer: Unknown uniform type: "+o);(d instanceof THREE.ShaderMaterial||d instanceof THREE.MeshPhongMaterial||d.envMap)&&null!==h.cameraPosition&&(Ba.setFromMatrixPosition(a.matrixWorld),S.uniform3f(h.cameraPosition,Ba.x,Ba.y,Ba.z)),(d instanceof THREE.MeshPhongMaterial||d instanceof THREE.MeshLambertMaterial||d instanceof THREE.ShaderMaterial||d.skinning)&&null!==h.viewMatrix&&S.uniformMatrix4fv(h.viewMatrix,!1,a.matrixWorldInverse.elements)}return S.uniformMatrix4fv(h.modelViewMatrix,!1,e._modelViewMatrix.elements),h.normalMatrix&&S.uniformMatrix3fv(h.normalMatrix,!1,e._normalMatrix.elements),null!==h.modelMatrix&&S.uniformMatrix4fv(h.modelMatrix,!1,e.matrixWorld.elements),g}function x(){var a=da;return a>=Fa&&console.warn("WebGLRenderer: trying to use "+a+" texture units while this GPU supports only "+Fa),da+=1,a}function y(a,b,c,d){a[b]=c.r*c.r*d,a[b+1]=c.g*c.g*d,a[b+2]=c.b*c.b*d}function z(a,b,c,d){a[b]=c.r*d,a[b+1]=c.g*d,a[b+2]=c.b*d}function A(a){a!==pa&&(S.lineWidth(a),pa=a)}function B(a,b,c){ma!==a&&(a?S.enable(S.POLYGON_OFFSET_FILL):S.disable(S.POLYGON_OFFSET_FILL),ma=a),!a||na===b&&oa===c||(S.polygonOffset(b,c),na=b,oa=c)}function C(a,b,c){c?(S.texParameteri(a,S.TEXTURE_WRAP_S,F(b.wrapS)),S.texParameteri(a,S.TEXTURE_WRAP_T,F(b.wrapT)),S.texParameteri(a,S.TEXTURE_MAG_FILTER,F(b.magFilter)),S.texParameteri(a,S.TEXTURE_MIN_FILTER,F(b.minFilter))):(S.texParameteri(a,S.TEXTURE_WRAP_S,S.CLAMP_TO_EDGE),S.texParameteri(a,S.TEXTURE_WRAP_T,S.CLAMP_TO_EDGE),S.texParameteri(a,S.TEXTURE_MAG_FILTER,E(b.magFilter)),S.texParameteri(a,S.TEXTURE_MIN_FILTER,E(b.minFilter))),V&&b.type!==THREE.FloatType&&(1<b.anisotropy||b.__oldAnisotropy)&&(S.texParameterf(a,V.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(b.anisotropy,Ia)),b.__oldAnisotropy=b.anisotropy)}function D(a,b){S.bindRenderbuffer(S.RENDERBUFFER,a),b.depthBuffer&&!b.stencilBuffer?(S.renderbufferStorage(S.RENDERBUFFER,S.DEPTH_COMPONENT16,b.width,b.height),S.framebufferRenderbuffer(S.FRAMEBUFFER,S.DEPTH_ATTACHMENT,S.RENDERBUFFER,a)):b.depthBuffer&&b.stencilBuffer?(S.renderbufferStorage(S.RENDERBUFFER,S.DEPTH_STENCIL,b.width,b.height),S.framebufferRenderbuffer(S.FRAMEBUFFER,S.DEPTH_STENCIL_ATTACHMENT,S.RENDERBUFFER,a)):S.renderbufferStorage(S.RENDERBUFFER,S.RGBA4,b.width,b.height)}function E(a){return a===THREE.NearestFilter||a===THREE.NearestMipMapNearestFilter||a===THREE.NearestMipMapLinearFilter?S.NEAREST:S.LINEAR}function F(a){if(a===THREE.RepeatWrapping)return S.REPEAT;if(a===THREE.ClampToEdgeWrapping)return S.CLAMP_TO_EDGE;if(a===THREE.MirroredRepeatWrapping)return S.MIRRORED_REPEAT;if(a===THREE.NearestFilter)return S.NEAREST;if(a===THREE.NearestMipMapNearestFilter)return S.NEAREST_MIPMAP_NEAREST;if(a===THREE.NearestMipMapLinearFilter)return S.NEAREST_MIPMAP_LINEAR;if(a===THREE.LinearFilter)return S.LINEAR;if(a===THREE.LinearMipMapNearestFilter)return S.LINEAR_MIPMAP_NEAREST;if(a===THREE.LinearMipMapLinearFilter)return S.LINEAR_MIPMAP_LINEAR;if(a===THREE.UnsignedByteType)return S.UNSIGNED_BYTE;if(a===THREE.UnsignedShort4444Type)return S.UNSIGNED_SHORT_4_4_4_4;if(a===THREE.UnsignedShort5551Type)return S.UNSIGNED_SHORT_5_5_5_1;if(a===THREE.UnsignedShort565Type)return S.UNSIGNED_SHORT_5_6_5;if(a===THREE.ByteType)return S.BYTE;if(a===THREE.ShortType)return S.SHORT;if(a===THREE.UnsignedShortType)return S.UNSIGNED_SHORT;if(a===THREE.IntType)return S.INT;if(a===THREE.UnsignedIntType)return S.UNSIGNED_INT;if(a===THREE.FloatType)return S.FLOAT;if(a===THREE.AlphaFormat)return S.ALPHA;if(a===THREE.RGBFormat)return S.RGB;if(a===THREE.RGBAFormat)return S.RGBA;if(a===THREE.LuminanceFormat)return S.LUMINANCE;if(a===THREE.LuminanceAlphaFormat)return S.LUMINANCE_ALPHA;if(a===THREE.AddEquation)return S.FUNC_ADD;if(a===THREE.SubtractEquation)return S.FUNC_SUBTRACT;if(a===THREE.ReverseSubtractEquation)return S.FUNC_REVERSE_SUBTRACT;if(a===THREE.ZeroFactor)return S.ZERO;if(a===THREE.OneFactor)return S.ONE;if(a===THREE.SrcColorFactor)return S.SRC_COLOR;if(a===THREE.OneMinusSrcColorFactor)return S.ONE_MINUS_SRC_COLOR;if(a===THREE.SrcAlphaFactor)return S.SRC_ALPHA;if(a===THREE.OneMinusSrcAlphaFactor)return S.ONE_MINUS_SRC_ALPHA;if(a===THREE.DstAlphaFactor)return S.DST_ALPHA;if(a===THREE.OneMinusDstAlphaFactor)return S.ONE_MINUS_DST_ALPHA;if(a===THREE.DstColorFactor)return S.DST_COLOR;if(a===THREE.OneMinusDstColorFactor)return S.ONE_MINUS_DST_COLOR;if(a===THREE.SrcAlphaSaturateFactor)return S.SRC_ALPHA_SATURATE;if(void 0!==W){if(a===THREE.RGB_S3TC_DXT1_Format)return W.COMPRESSED_RGB_S3TC_DXT1_EXT;if(a===THREE.RGBA_S3TC_DXT1_Format)return W.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(a===THREE.RGBA_S3TC_DXT3_Format)return W.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(a===THREE.RGBA_S3TC_DXT5_Format)return W.COMPRESSED_RGBA_S3TC_DXT5_EXT}return 0}console.log("THREE.WebGLRenderer",THREE.REVISION),a=a||{};var G=void 0!==a.canvas?a.canvas:document.createElement("canvas"),H=void 0!==a.context?a.context:null,I=void 0!==a.precision?a.precision:"highp",J=void 0!==a.alpha?a.alpha:!1,K=void 0!==a.depth?a.depth:!0,L=void 0!==a.stencil?a.stencil:!0,M=void 0!==a.antialias?a.antialias:!1,N=void 0!==a.premultipliedAlpha?a.premultipliedAlpha:!0,O=void 0!==a.preserveDrawingBuffer?a.preserveDrawingBuffer:!1,P=void 0!==a.logarithmicDepthBuffer?a.logarithmicDepthBuffer:!1,Q=new THREE.Color(0),R=0;this.domElement=G,this.context=null,this.devicePixelRatio=void 0!==a.devicePixelRatio?a.devicePixelRatio:void 0!==self.devicePixelRatio?self.devicePixelRatio:1,this.autoUpdateObjects=this.sortObjects=this.autoClearStencil=this.autoClearDepth=this.autoClearColor=this.autoClear=!0,this.shadowMapEnabled=this.gammaOutput=this.gammaInput=!1,this.shadowMapAutoUpdate=!0,this.shadowMapType=THREE.PCFShadowMap,this.shadowMapCullFace=THREE.CullFaceFront,this.shadowMapCascade=this.shadowMapDebug=!1,this.maxMorphTargets=8,this.maxMorphNormals=4,this.autoScaleCubemaps=!0,this.renderPluginsPre=[],this.renderPluginsPost=[],this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}};var S,T,U,V,W,X,Y=this,Z=[],$=null,_=null,aa=-1,ba=null,ca=null,da=0,ea=-1,fa=-1,ga=-1,ha=-1,ia=-1,ja=-1,ka=-1,la=-1,ma=null,na=null,oa=null,pa=null,qa=0,ra=0,sa=G.width,ta=G.height,ua=0,va=0,wa=new Uint8Array(16),xa=new Uint8Array(16),ya=new THREE.Frustum,za=new THREE.Matrix4,Aa=new THREE.Matrix4,Ba=new THREE.Vector3,Ca=new THREE.Vector3,Da=!0,Ea={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[]},spot:{length:0,colors:[],positions:[],distances:[],directions:[],anglesCos:[],exponents:[]},hemi:{length:0,skyColors:[],groundColors:[],positions:[]}};!function(){try{var a={alpha:J,depth:K,stencil:L,antialias:M,premultipliedAlpha:N,preserveDrawingBuffer:O};if(S=H||G.getContext("webgl",a)||G.getContext("experimental-webgl",a),null===S)throw"Error creating WebGL context."}catch(b){console.error(b)}T=S.getExtension("OES_texture_float"),S.getExtension("OES_texture_float_linear"),U=S.getExtension("OES_standard_derivatives"),V=S.getExtension("EXT_texture_filter_anisotropic")||S.getExtension("MOZ_EXT_texture_filter_anisotropic")||S.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),W=S.getExtension("WEBGL_compressed_texture_s3tc")||S.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||S.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),X=S.getExtension("OES_element_index_uint"),null===T&&console.log("THREE.WebGLRenderer: Float textures not supported."),null===U&&console.log("THREE.WebGLRenderer: Standard derivatives not supported."),null===V&&console.log("THREE.WebGLRenderer: Anisotropic texture filtering not supported."),null===W&&console.log("THREE.WebGLRenderer: S3TC compressed textures not supported."),null===X&&console.log("THREE.WebGLRenderer: elementindex as unsigned integer not supported."),void 0===S.getShaderPrecisionFormat&&(S.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}}),P&&S.getExtension("EXT_frag_depth")}(),S.clearColor(0,0,0,1),S.clearDepth(1),S.clearStencil(0),S.enable(S.DEPTH_TEST),S.depthFunc(S.LEQUAL),S.frontFace(S.CCW),S.cullFace(S.BACK),S.enable(S.CULL_FACE),S.enable(S.BLEND),S.blendEquation(S.FUNC_ADD),S.blendFunc(S.SRC_ALPHA,S.ONE_MINUS_SRC_ALPHA),S.viewport(qa,ra,sa,ta),S.clearColor(Q.r,Q.g,Q.b,R),this.context=S;var Fa=S.getParameter(S.MAX_TEXTURE_IMAGE_UNITS),Ga=S.getParameter(S.MAX_VERTEX_TEXTURE_IMAGE_UNITS);S.getParameter(S.MAX_TEXTURE_SIZE);var Ha=S.getParameter(S.MAX_CUBE_MAP_TEXTURE_SIZE),Ia=V?S.getParameter(V.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,Ja=Ga>0,Ka=Ja&&T;W&&S.getParameter(S.COMPRESSED_TEXTURE_FORMATS);var La=S.getShaderPrecisionFormat(S.VERTEX_SHADER,S.HIGH_FLOAT),Ma=S.getShaderPrecisionFormat(S.VERTEX_SHADER,S.MEDIUM_FLOAT);S.getShaderPrecisionFormat(S.VERTEX_SHADER,S.LOW_FLOAT);var Na=S.getShaderPrecisionFormat(S.FRAGMENT_SHADER,S.HIGH_FLOAT),Oa=S.getShaderPrecisionFormat(S.FRAGMENT_SHADER,S.MEDIUM_FLOAT);S.getShaderPrecisionFormat(S.FRAGMENT_SHADER,S.LOW_FLOAT);var Pa=0<La.precision&&0<Na.precision,Qa=0<Ma.precision&&0<Oa.precision;"highp"!==I||Pa||(Qa?(I="mediump",console.warn("WebGLRenderer: highp not supported, using mediump")):(I="lowp",console.warn("WebGLRenderer: highp and mediump not supported, using lowp"))),"mediump"!==I||Qa||(I="lowp",console.warn("WebGLRenderer: mediump not supported, using lowp")),this.getContext=function(){return S},this.supportsVertexTextures=function(){return Ja},this.supportsFloatTextures=function(){return T},this.supportsStandardDerivatives=function(){return U},this.supportsCompressedTextureS3TC=function(){return W},this.getMaxAnisotropy=function(){return Ia},this.getPrecision=function(){return I},this.setSize=function(a,b,c){G.width=a*this.devicePixelRatio,G.height=b*this.devicePixelRatio,!1!==c&&(G.style.width=a+"px",G.style.height=b+"px"),this.setViewport(0,0,a,b)},this.setViewport=function(a,b,c,d){qa=a*this.devicePixelRatio,ra=b*this.devicePixelRatio,sa=c*this.devicePixelRatio,ta=d*this.devicePixelRatio,S.viewport(qa,ra,sa,ta)},this.setScissor=function(a,b,c,d){S.scissor(a*this.devicePixelRatio,b*this.devicePixelRatio,c*this.devicePixelRatio,d*this.devicePixelRatio)},this.enableScissorTest=function(a){a?S.enable(S.SCISSOR_TEST):S.disable(S.SCISSOR_TEST)},this.setClearColor=function(a,b){Q.set(a),R=void 0!==b?b:1,S.clearColor(Q.r,Q.g,Q.b,R)},this.setClearColorHex=function(a,b){console.warn("DEPRECATED: .setClearColorHex() is being removed. Use .setClearColor() instead."),this.setClearColor(a,b)},this.getClearColor=function(){return Q},this.getClearAlpha=function(){return R},this.clear=function(a,b,c){var d=0;(void 0===a||a)&&(d|=S.COLOR_BUFFER_BIT),(void 0===b||b)&&(d|=S.DEPTH_BUFFER_BIT),(void 0===c||c)&&(d|=S.STENCIL_BUFFER_BIT),S.clear(d)},this.clearColor=function(){S.clear(S.COLOR_BUFFER_BIT)},this.clearDepth=function(){S.clear(S.DEPTH_BUFFER_BIT)},this.clearStencil=function(){S.clear(S.STENCIL_BUFFER_BIT)},this.clearTarget=function(a,b,c,d){this.setRenderTarget(a),this.clear(b,c,d)},this.addPostPlugin=function(a){a.init(this),this.renderPluginsPost.push(a)},this.addPrePlugin=function(a){a.init(this),this.renderPluginsPre.push(a)},this.updateShadowMap=function(a,b){$=null,aa=ba=la=ka=ga=-1,Da=!0,fa=ea=-1,this.shadowMapPlugin.update(a,b)};var Ra=function(a){if(a=a.target,a.removeEventListener("dispose",Ra),a.__webglInit=void 0,a instanceof THREE.BufferGeometry){var b,c=a.attributes;for(b in c)void 0!==c[b].buffer&&S.deleteBuffer(c[b].buffer);Y.info.memory.geometries--}else if(void 0!==a.geometryGroups)for(c in a.geometryGroups){if(b=a.geometryGroups[c],void 0!==b.numMorphTargets)for(var d=0,e=b.numMorphTargets;e>d;d++)S.deleteBuffer(b.__webglMorphTargetsBuffers[d]);if(void 0!==b.numMorphNormals)for(d=0,e=b.numMorphNormals;e>d;d++)S.deleteBuffer(b.__webglMorphNormalsBuffers[d]);Va(b)}else Va(a)},Sa=function(a){a=a.target,a.removeEventListener("dispose",Sa),a.image&&a.image.__webglTextureCube?S.deleteTexture(a.image.__webglTextureCube):a.__webglInit&&(a.__webglInit=!1,S.deleteTexture(a.__webglTexture)),Y.info.memory.textures--},Ta=function(a){if(a=a.target,a.removeEventListener("dispose",Ta),a&&a.__webglTexture)if(S.deleteTexture(a.__webglTexture),a instanceof THREE.WebGLRenderTargetCube)for(var b=0;6>b;b++)S.deleteFramebuffer(a.__webglFramebuffer[b]),S.deleteRenderbuffer(a.__webglRenderbuffer[b]);else S.deleteFramebuffer(a.__webglFramebuffer),S.deleteRenderbuffer(a.__webglRenderbuffer);Y.info.memory.textures--},Ua=function(a){a=a.target,a.removeEventListener("dispose",Ua),Wa(a)},Va=function(a){if(void 0!==a.__webglVertexBuffer&&S.deleteBuffer(a.__webglVertexBuffer),void 0!==a.__webglNormalBuffer&&S.deleteBuffer(a.__webglNormalBuffer),void 0!==a.__webglTangentBuffer&&S.deleteBuffer(a.__webglTangentBuffer),void 0!==a.__webglColorBuffer&&S.deleteBuffer(a.__webglColorBuffer),void 0!==a.__webglUVBuffer&&S.deleteBuffer(a.__webglUVBuffer),void 0!==a.__webglUV2Buffer&&S.deleteBuffer(a.__webglUV2Buffer),void 0!==a.__webglSkinIndicesBuffer&&S.deleteBuffer(a.__webglSkinIndicesBuffer),void 0!==a.__webglSkinWeightsBuffer&&S.deleteBuffer(a.__webglSkinWeightsBuffer),void 0!==a.__webglFaceBuffer&&S.deleteBuffer(a.__webglFaceBuffer),void 0!==a.__webglLineBuffer&&S.deleteBuffer(a.__webglLineBuffer),void 0!==a.__webglLineDistanceBuffer&&S.deleteBuffer(a.__webglLineDistanceBuffer),void 0!==a.__webglCustomAttributesList)for(var b in a.__webglCustomAttributesList)S.deleteBuffer(a.__webglCustomAttributesList[b].buffer);Y.info.memory.geometries--},Wa=function(a){var b=a.program;if(void 0!==b){a.program=void 0;var c,d,e=!1;for(a=0,c=Z.length;c>a;a++)if(d=Z[a],d.program===b){d.usedTimes--,0===d.usedTimes&&(e=!0);break}if(!0===e){for(e=[],a=0,c=Z.length;c>a;a++)d=Z[a],d.program!==b&&e.push(d);Z=e,S.deleteProgram(b),Y.info.memory.programs--}}};this.renderBufferImmediate=function(a,b,c){if(h(),a.hasPositions&&!a.__webglVertexBuffer&&(a.__webglVertexBuffer=S.createBuffer()),a.hasNormals&&!a.__webglNormalBuffer&&(a.__webglNormalBuffer=S.createBuffer()),a.hasUvs&&!a.__webglUvBuffer&&(a.__webglUvBuffer=S.createBuffer()),a.hasColors&&!a.__webglColorBuffer&&(a.__webglColorBuffer=S.createBuffer()),a.hasPositions&&(S.bindBuffer(S.ARRAY_BUFFER,a.__webglVertexBuffer),S.bufferData(S.ARRAY_BUFFER,a.positionArray,S.DYNAMIC_DRAW),i(b.attributes.position),S.vertexAttribPointer(b.attributes.position,3,S.FLOAT,!1,0,0)),a.hasNormals){if(S.bindBuffer(S.ARRAY_BUFFER,a.__webglNormalBuffer),c.shading===THREE.FlatShading){var d,e,f,g,k,l,m,n,o,p,q,r=3*a.count;for(q=0;r>q;q+=9)p=a.normalArray,d=p[q],e=p[q+1],f=p[q+2],g=p[q+3],l=p[q+4],n=p[q+5],k=p[q+6],m=p[q+7],o=p[q+8],d=(d+g+k)/3,e=(e+l+m)/3,f=(f+n+o)/3,p[q]=d,p[q+1]=e,p[q+2]=f,p[q+3]=d,p[q+4]=e,p[q+5]=f,p[q+6]=d,p[q+7]=e,p[q+8]=f}S.bufferData(S.ARRAY_BUFFER,a.normalArray,S.DYNAMIC_DRAW),i(b.attributes.normal),S.vertexAttribPointer(b.attributes.normal,3,S.FLOAT,!1,0,0)}a.hasUvs&&c.map&&(S.bindBuffer(S.ARRAY_BUFFER,a.__webglUvBuffer),S.bufferData(S.ARRAY_BUFFER,a.uvArray,S.DYNAMIC_DRAW),i(b.attributes.uv),S.vertexAttribPointer(b.attributes.uv,2,S.FLOAT,!1,0,0)),a.hasColors&&c.vertexColors!==THREE.NoColors&&(S.bindBuffer(S.ARRAY_BUFFER,a.__webglColorBuffer),S.bufferData(S.ARRAY_BUFFER,a.colorArray,S.DYNAMIC_DRAW),i(b.attributes.color),S.vertexAttribPointer(b.attributes.color,3,S.FLOAT,!1,0,0)),j(),S.drawArrays(S.TRIANGLES,0,a.count),a.count=0},this.renderBufferDirect=function(a,b,c,d,e,f){if(!1!==d.visible){var i=w(a,b,c,d,f);if(a=i.attributes,b=e.attributes,c=!1,i=16777215*e.id+2*i.id+(d.wireframe?1:0),i!==ba&&(ba=i,c=!0),c&&h(),f instanceof THREE.Mesh)if(f=b.index){var j;if(f.array instanceof Uint32Array?(i=S.UNSIGNED_INT,j=4):(i=S.UNSIGNED_SHORT,j=2),e=e.offsets,0===e.length)c&&(g(d,a,b,0),S.bindBuffer(S.ELEMENT_ARRAY_BUFFER,f.buffer)),S.drawElements(S.TRIANGLES,f.array.length,i,0),Y.info.render.calls++,Y.info.render.vertices+=f.array.length,Y.info.render.faces+=f.array.length/3;else{c=!0;for(var k=0,l=e.length;l>k;k++){var m=e[k].index;c&&(g(d,a,b,m),S.bindBuffer(S.ELEMENT_ARRAY_BUFFER,f.buffer)),S.drawElements(S.TRIANGLES,e[k].count,i,e[k].start*j),Y.info.render.calls++,Y.info.render.vertices+=e[k].count,Y.info.render.faces+=e[k].count/3}}}else c&&g(d,a,b,0),d=e.attributes.position,S.drawArrays(S.TRIANGLES,0,d.array.length/3),Y.info.render.calls++,Y.info.render.vertices+=d.array.length/3,Y.info.render.faces+=d.array.length/9;else if(f instanceof THREE.ParticleSystem)c&&g(d,a,b,0),d=b.position,S.drawArrays(S.POINTS,0,d.array.length/3),Y.info.render.calls++,Y.info.render.points+=d.array.length/3;else if(f instanceof THREE.Line)if(i=f.type===THREE.LineStrip?S.LINE_STRIP:S.LINES,A(d.linewidth),f=b.index)if(f.array instanceof Uint32Array?(i=S.UNSIGNED_INT,j=4):(i=S.UNSIGNED_SHORT,j=2),e=e.offsets,0===e.length)c&&(g(d,a,b,0),S.bindBuffer(S.ELEMENT_ARRAY_BUFFER,f.buffer)),S.drawElements(S.LINES,f.array.length,i,0),Y.info.render.calls++,Y.info.render.vertices+=f.array.length;else for(1<e.length&&(c=!0),k=0,l=e.length;l>k;k++)m=e[k].index,c&&(g(d,a,b,m),S.bindBuffer(S.ELEMENT_ARRAY_BUFFER,f.buffer)),S.drawElements(S.LINES,e[k].count,i,e[k].start*j),Y.info.render.calls++,Y.info.render.vertices+=e[k].count;else c&&g(d,a,b,0),d=b.position,S.drawArrays(i,0,d.array.length/3),Y.info.render.calls++,Y.info.render.points+=d.array.length/3}},this.renderBuffer=function(a,b,c,d,e,f){if(!1!==d.visible){var g,k;if(c=w(a,b,c,d,f),b=c.attributes,a=!1,c=16777215*e.id+2*c.id+(d.wireframe?1:0),c!==ba&&(ba=c,a=!0),a&&h(),!d.morphTargets&&0<=b.position)a&&(S.bindBuffer(S.ARRAY_BUFFER,e.__webglVertexBuffer),i(b.position),S.vertexAttribPointer(b.position,3,S.FLOAT,!1,0,0));else if(f.morphTargetBase){if(c=d.program.attributes,-1!==f.morphTargetBase&&0<=c.position?(S.bindBuffer(S.ARRAY_BUFFER,e.__webglMorphTargetsBuffers[f.morphTargetBase]),i(c.position),S.vertexAttribPointer(c.position,3,S.FLOAT,!1,0,0)):0<=c.position&&(S.bindBuffer(S.ARRAY_BUFFER,e.__webglVertexBuffer),i(c.position),S.vertexAttribPointer(c.position,3,S.FLOAT,!1,0,0)),f.morphTargetForcedOrder.length){var m=0;for(k=f.morphTargetForcedOrder,g=f.morphTargetInfluences;m<d.numSupportedMorphTargets&&m<k.length;)0<=c["morphTarget"+m]&&(S.bindBuffer(S.ARRAY_BUFFER,e.__webglMorphTargetsBuffers[k[m]]),i(c["morphTarget"+m]),S.vertexAttribPointer(c["morphTarget"+m],3,S.FLOAT,!1,0,0)),0<=c["morphNormal"+m]&&d.morphNormals&&(S.bindBuffer(S.ARRAY_BUFFER,e.__webglMorphNormalsBuffers[k[m]]),i(c["morphNormal"+m]),S.vertexAttribPointer(c["morphNormal"+m],3,S.FLOAT,!1,0,0)),f.__webglMorphTargetInfluences[m]=g[k[m]],m++}else{k=[],g=f.morphTargetInfluences;var n,o=g.length;for(n=0;o>n;n++)m=g[n],m>0&&k.push([m,n]);for(k.length>d.numSupportedMorphTargets?(k.sort(l),k.length=d.numSupportedMorphTargets):k.length>d.numSupportedMorphNormals?k.sort(l):0===k.length&&k.push([0,0]),m=0;m<d.numSupportedMorphTargets;)k[m]?(n=k[m][1],0<=c["morphTarget"+m]&&(S.bindBuffer(S.ARRAY_BUFFER,e.__webglMorphTargetsBuffers[n]),i(c["morphTarget"+m]),S.vertexAttribPointer(c["morphTarget"+m],3,S.FLOAT,!1,0,0)),0<=c["morphNormal"+m]&&d.morphNormals&&(S.bindBuffer(S.ARRAY_BUFFER,e.__webglMorphNormalsBuffers[n]),i(c["morphNormal"+m]),S.vertexAttribPointer(c["morphNormal"+m],3,S.FLOAT,!1,0,0)),f.__webglMorphTargetInfluences[m]=g[n]):f.__webglMorphTargetInfluences[m]=0,m++}null!==d.program.uniforms.morphTargetInfluences&&S.uniform1fv(d.program.uniforms.morphTargetInfluences,f.__webglMorphTargetInfluences)}if(a){if(e.__webglCustomAttributesList)for(g=0,k=e.__webglCustomAttributesList.length;k>g;g++)c=e.__webglCustomAttributesList[g],0<=b[c.buffer.belongsToAttribute]&&(S.bindBuffer(S.ARRAY_BUFFER,c.buffer),i(b[c.buffer.belongsToAttribute]),S.vertexAttribPointer(b[c.buffer.belongsToAttribute],c.size,S.FLOAT,!1,0,0));0<=b.color&&(0<f.geometry.colors.length||0<f.geometry.faces.length?(S.bindBuffer(S.ARRAY_BUFFER,e.__webglColorBuffer),i(b.color),S.vertexAttribPointer(b.color,3,S.FLOAT,!1,0,0)):d.defaultAttributeValues&&S.vertexAttrib3fv(b.color,d.defaultAttributeValues.color)),0<=b.normal&&(S.bindBuffer(S.ARRAY_BUFFER,e.__webglNormalBuffer),i(b.normal),S.vertexAttribPointer(b.normal,3,S.FLOAT,!1,0,0)),0<=b.tangent&&(S.bindBuffer(S.ARRAY_BUFFER,e.__webglTangentBuffer),i(b.tangent),S.vertexAttribPointer(b.tangent,4,S.FLOAT,!1,0,0)),0<=b.uv&&(f.geometry.faceVertexUvs[0]?(S.bindBuffer(S.ARRAY_BUFFER,e.__webglUVBuffer),i(b.uv),S.vertexAttribPointer(b.uv,2,S.FLOAT,!1,0,0)):d.defaultAttributeValues&&S.vertexAttrib2fv(b.uv,d.defaultAttributeValues.uv)),0<=b.uv2&&(f.geometry.faceVertexUvs[1]?(S.bindBuffer(S.ARRAY_BUFFER,e.__webglUV2Buffer),i(b.uv2),S.vertexAttribPointer(b.uv2,2,S.FLOAT,!1,0,0)):d.defaultAttributeValues&&S.vertexAttrib2fv(b.uv2,d.defaultAttributeValues.uv2)),d.skinning&&0<=b.skinIndex&&0<=b.skinWeight&&(S.bindBuffer(S.ARRAY_BUFFER,e.__webglSkinIndicesBuffer),i(b.skinIndex),S.vertexAttribPointer(b.skinIndex,4,S.FLOAT,!1,0,0),S.bindBuffer(S.ARRAY_BUFFER,e.__webglSkinWeightsBuffer),i(b.skinWeight),S.vertexAttribPointer(b.skinWeight,4,S.FLOAT,!1,0,0)),0<=b.lineDistance&&(S.bindBuffer(S.ARRAY_BUFFER,e.__webglLineDistanceBuffer),i(b.lineDistance),S.vertexAttribPointer(b.lineDistance,1,S.FLOAT,!1,0,0))}j(),f instanceof THREE.Mesh?(f=e.__typeArray===Uint32Array?S.UNSIGNED_INT:S.UNSIGNED_SHORT,d.wireframe?(A(d.wireframeLinewidth),a&&S.bindBuffer(S.ELEMENT_ARRAY_BUFFER,e.__webglLineBuffer),S.drawElements(S.LINES,e.__webglLineCount,f,0)):(a&&S.bindBuffer(S.ELEMENT_ARRAY_BUFFER,e.__webglFaceBuffer),S.drawElements(S.TRIANGLES,e.__webglFaceCount,f,0)),Y.info.render.calls++,Y.info.render.vertices+=e.__webglFaceCount,Y.info.render.faces+=e.__webglFaceCount/3):f instanceof THREE.Line?(f=f.type===THREE.LineStrip?S.LINE_STRIP:S.LINES,A(d.linewidth),S.drawArrays(f,0,e.__webglLineCount),Y.info.render.calls++):f instanceof THREE.ParticleSystem&&(S.drawArrays(S.POINTS,0,e.__webglParticleCount),Y.info.render.calls++,Y.info.render.points+=e.__webglParticleCount)}},this.render=function(a,b,c,d){if(!1==b instanceof THREE.Camera)console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");else{var e,f,g,h,i=a.__lights,j=a.fog;for(aa=-1,Da=!0,!0===a.autoUpdate&&a.updateMatrixWorld(),void 0===b.parent&&b.updateMatrixWorld(),b.matrixWorldInverse.getInverse(b.matrixWorld),za.multiplyMatrices(b.projectionMatrix,b.matrixWorldInverse),ya.setFromMatrix(za),this.autoUpdateObjects&&this.initWebGLObjects(a),m(this.renderPluginsPre,a,b),Y.info.render.calls=0,Y.info.render.vertices=0,Y.info.render.faces=0,Y.info.render.points=0,this.setRenderTarget(c),(this.autoClear||d)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil),h=a.__webglObjects,d=0,e=h.length;e>d;d++)if(f=h[d],g=f.object,f.id=d,f.render=!1,g.visible&&(!(g instanceof THREE.Mesh||g instanceof THREE.ParticleSystem)||!g.frustumCulled||ya.intersectsObject(g))){var l=g;l._modelViewMatrix.multiplyMatrices(b.matrixWorldInverse,l.matrixWorld),l._normalMatrix.getNormalMatrix(l._modelViewMatrix);var l=f,p=l.object,q=l.buffer,r=p.geometry,p=p.material;p instanceof THREE.MeshFaceMaterial?(p=p.materials[r instanceof THREE.BufferGeometry?0:q.materialIndex],p.transparent?(l.transparent=p,l.opaque=null):(l.opaque=p,l.transparent=null)):p&&(p.transparent?(l.transparent=p,
l.opaque=null):(l.opaque=p,l.transparent=null)),f.render=!0,!0===this.sortObjects&&(null!==g.renderDepth?f.z=g.renderDepth:(Ba.setFromMatrixPosition(g.matrixWorld),Ba.applyProjection(za),f.z=Ba.z))}for(this.sortObjects&&h.sort(k),h=a.__webglObjectsImmediate,d=0,e=h.length;e>d;d++)f=h[d],g=f.object,g.visible&&(g._modelViewMatrix.multiplyMatrices(b.matrixWorldInverse,g.matrixWorld),g._normalMatrix.getNormalMatrix(g._modelViewMatrix),g=f.object.material,g.transparent?(f.transparent=g,f.opaque=null):(f.opaque=g,f.transparent=null));a.overrideMaterial?(d=a.overrideMaterial,this.setBlending(d.blending,d.blendEquation,d.blendSrc,d.blendDst),this.setDepthTest(d.depthTest),this.setDepthWrite(d.depthWrite),B(d.polygonOffset,d.polygonOffsetFactor,d.polygonOffsetUnits),n(a.__webglObjects,!1,"",b,i,j,!0,d),o(a.__webglObjectsImmediate,"",b,i,j,!1,d)):(d=null,this.setBlending(THREE.NoBlending),n(a.__webglObjects,!0,"opaque",b,i,j,!1,d),o(a.__webglObjectsImmediate,"opaque",b,i,j,!1,d),n(a.__webglObjects,!1,"transparent",b,i,j,!0,d),o(a.__webglObjectsImmediate,"transparent",b,i,j,!0,d)),m(this.renderPluginsPost,a,b),c&&c.generateMipmaps&&c.minFilter!==THREE.NearestFilter&&c.minFilter!==THREE.LinearFilter&&(c instanceof THREE.WebGLRenderTargetCube?(S.bindTexture(S.TEXTURE_CUBE_MAP,c.__webglTexture),S.generateMipmap(S.TEXTURE_CUBE_MAP),S.bindTexture(S.TEXTURE_CUBE_MAP,null)):(S.bindTexture(S.TEXTURE_2D,c.__webglTexture),S.generateMipmap(S.TEXTURE_2D),S.bindTexture(S.TEXTURE_2D,null))),this.setDepthTest(!0),this.setDepthWrite(!0)}},this.renderImmediateObject=function(a,b,c,d,e){var f=w(a,b,c,d,e);ba=-1,Y.setMaterialFaces(d),e.immediateRenderCallback?e.immediateRenderCallback(f,S,ya):e.render(function(a){Y.renderBufferImmediate(a,f,d)})},this.initWebGLObjects=function(a){for(a.__webglObjects||(a.__webglObjects=[],a.__webglObjectsImmediate=[],a.__webglSprites=[],a.__webglFlares=[]);a.__objectsAdded.length;)p(a.__objectsAdded[0],a),a.__objectsAdded.splice(0,1);for(;a.__objectsRemoved.length;)t(a.__objectsRemoved[0],a),a.__objectsRemoved.splice(0,1);for(var b=0,g=a.__webglObjects.length;g>b;b++){var h=a.__webglObjects[b].object;void 0===h.__webglInit&&(void 0!==h.__webglActive&&t(h,a),p(h,a));var i=h,j=i.geometry,k=void 0,m=void 0,n=void 0;if(j instanceof THREE.BufferGeometry){var o=S.DYNAMIC_DRAW,q=j.attributes,u=void 0,v=void 0;for(u in q)v=q[u],v.needsUpdate&&("index"===u?(S.bindBuffer(S.ELEMENT_ARRAY_BUFFER,v.buffer),S.bufferData(S.ELEMENT_ARRAY_BUFFER,v.array,o)):(S.bindBuffer(S.ARRAY_BUFFER,v.buffer),S.bufferData(S.ARRAY_BUFFER,v.array,o)),v.needsUpdate=!1)}else if(i instanceof THREE.Mesh){for(var w=0,x=j.geometryGroupsList.length;x>w;w++)if(k=j.geometryGroupsList[w],n=d(i,k),j.buffersNeedUpdate&&c(k,i),m=n.attributes&&r(n),j.verticesNeedUpdate||j.morphTargetsNeedUpdate||j.elementsNeedUpdate||j.uvsNeedUpdate||j.normalsNeedUpdate||j.colorsNeedUpdate||j.tangentsNeedUpdate||m){var y=k,z=i,A=S.DYNAMIC_DRAW,B=!j.dynamic,C=n;if(y.__inittedArrays){var D=e(C),E=C.vertexColors?C.vertexColors:!1,F=f(C),G=D===THREE.SmoothShading,H=void 0,I=void 0,J=void 0,K=void 0,L=void 0,M=void 0,N=void 0,O=void 0,P=void 0,Q=void 0,R=void 0,T=void 0,U=void 0,V=void 0,W=void 0,X=void 0,Y=void 0,Z=void 0,$=void 0,_=void 0,aa=void 0,ba=void 0,ca=void 0,da=void 0,ea=void 0,fa=void 0,ga=void 0,ha=void 0,ia=void 0,ja=void 0,ka=void 0,la=void 0,ma=void 0,na=void 0,oa=void 0,pa=void 0,qa=void 0,ra=void 0,sa=void 0,ta=void 0,ua=0,va=0,wa=0,xa=0,ya=0,Ca=0,Da=0,Ea=0,Fa=0,Ga=0,Ha=0,Ia=0,Ja=void 0,Ka=y.__vertexArray,La=y.__uvArray,Ma=y.__uv2Array,Na=y.__normalArray,Oa=y.__tangentArray,Pa=y.__colorArray,Qa=y.__skinIndexArray,Ra=y.__skinWeightArray,Sa=y.__morphTargetsArrays,Ta=y.__morphNormalsArrays,Ua=y.__webglCustomAttributesList,Va=void 0,Wa=y.__faceArray,Xa=y.__lineArray,Ya=z.geometry,Za=Ya.elementsNeedUpdate,$a=Ya.uvsNeedUpdate,_a=Ya.normalsNeedUpdate,ab=Ya.tangentsNeedUpdate,bb=Ya.colorsNeedUpdate,cb=Ya.morphTargetsNeedUpdate,db=Ya.vertices,eb=y.faces3,fb=Ya.faces,gb=Ya.faceVertexUvs[0],hb=Ya.faceVertexUvs[1],ib=Ya.skinIndices,jb=Ya.skinWeights,kb=Ya.morphTargets,lb=Ya.morphNormals;if(Ya.verticesNeedUpdate){for(H=0,I=eb.length;I>H;H++)K=fb[eb[H]],T=db[K.a],U=db[K.b],V=db[K.c],Ka[va]=T.x,Ka[va+1]=T.y,Ka[va+2]=T.z,Ka[va+3]=U.x,Ka[va+4]=U.y,Ka[va+5]=U.z,Ka[va+6]=V.x,Ka[va+7]=V.y,Ka[va+8]=V.z,va+=9;S.bindBuffer(S.ARRAY_BUFFER,y.__webglVertexBuffer),S.bufferData(S.ARRAY_BUFFER,Ka,A)}if(cb)for(oa=0,pa=kb.length;pa>oa;oa++){for(H=Ha=0,I=eb.length;I>H;H++)sa=eb[H],K=fb[sa],T=kb[oa].vertices[K.a],U=kb[oa].vertices[K.b],V=kb[oa].vertices[K.c],qa=Sa[oa],qa[Ha]=T.x,qa[Ha+1]=T.y,qa[Ha+2]=T.z,qa[Ha+3]=U.x,qa[Ha+4]=U.y,qa[Ha+5]=U.z,qa[Ha+6]=V.x,qa[Ha+7]=V.y,qa[Ha+8]=V.z,C.morphNormals&&(G?(ta=lb[oa].vertexNormals[sa],Z=ta.a,$=ta.b,_=ta.c):_=$=Z=lb[oa].faceNormals[sa],ra=Ta[oa],ra[Ha]=Z.x,ra[Ha+1]=Z.y,ra[Ha+2]=Z.z,ra[Ha+3]=$.x,ra[Ha+4]=$.y,ra[Ha+5]=$.z,ra[Ha+6]=_.x,ra[Ha+7]=_.y,ra[Ha+8]=_.z),Ha+=9;S.bindBuffer(S.ARRAY_BUFFER,y.__webglMorphTargetsBuffers[oa]),S.bufferData(S.ARRAY_BUFFER,Sa[oa],A),C.morphNormals&&(S.bindBuffer(S.ARRAY_BUFFER,y.__webglMorphNormalsBuffers[oa]),S.bufferData(S.ARRAY_BUFFER,Ta[oa],A))}if(jb.length){for(H=0,I=eb.length;I>H;H++)K=fb[eb[H]],da=jb[K.a],ea=jb[K.b],fa=jb[K.c],Ra[Ga]=da.x,Ra[Ga+1]=da.y,Ra[Ga+2]=da.z,Ra[Ga+3]=da.w,Ra[Ga+4]=ea.x,Ra[Ga+5]=ea.y,Ra[Ga+6]=ea.z,Ra[Ga+7]=ea.w,Ra[Ga+8]=fa.x,Ra[Ga+9]=fa.y,Ra[Ga+10]=fa.z,Ra[Ga+11]=fa.w,ga=ib[K.a],ha=ib[K.b],ia=ib[K.c],Qa[Ga]=ga.x,Qa[Ga+1]=ga.y,Qa[Ga+2]=ga.z,Qa[Ga+3]=ga.w,Qa[Ga+4]=ha.x,Qa[Ga+5]=ha.y,Qa[Ga+6]=ha.z,Qa[Ga+7]=ha.w,Qa[Ga+8]=ia.x,Qa[Ga+9]=ia.y,Qa[Ga+10]=ia.z,Qa[Ga+11]=ia.w,Ga+=12;Ga>0&&(S.bindBuffer(S.ARRAY_BUFFER,y.__webglSkinIndicesBuffer),S.bufferData(S.ARRAY_BUFFER,Qa,A),S.bindBuffer(S.ARRAY_BUFFER,y.__webglSkinWeightsBuffer),S.bufferData(S.ARRAY_BUFFER,Ra,A))}if(bb&&E){for(H=0,I=eb.length;I>H;H++)K=fb[eb[H]],N=K.vertexColors,O=K.color,3===N.length&&E===THREE.VertexColors?(aa=N[0],ba=N[1],ca=N[2]):ca=ba=aa=O,Pa[Fa]=aa.r,Pa[Fa+1]=aa.g,Pa[Fa+2]=aa.b,Pa[Fa+3]=ba.r,Pa[Fa+4]=ba.g,Pa[Fa+5]=ba.b,Pa[Fa+6]=ca.r,Pa[Fa+7]=ca.g,Pa[Fa+8]=ca.b,Fa+=9;Fa>0&&(S.bindBuffer(S.ARRAY_BUFFER,y.__webglColorBuffer),S.bufferData(S.ARRAY_BUFFER,Pa,A))}if(ab&&Ya.hasTangents){for(H=0,I=eb.length;I>H;H++)K=fb[eb[H]],P=K.vertexTangents,W=P[0],X=P[1],Y=P[2],Oa[Da]=W.x,Oa[Da+1]=W.y,Oa[Da+2]=W.z,Oa[Da+3]=W.w,Oa[Da+4]=X.x,Oa[Da+5]=X.y,Oa[Da+6]=X.z,Oa[Da+7]=X.w,Oa[Da+8]=Y.x,Oa[Da+9]=Y.y,Oa[Da+10]=Y.z,Oa[Da+11]=Y.w,Da+=12;S.bindBuffer(S.ARRAY_BUFFER,y.__webglTangentBuffer),S.bufferData(S.ARRAY_BUFFER,Oa,A)}if(_a&&D){for(H=0,I=eb.length;I>H;H++)if(K=fb[eb[H]],L=K.vertexNormals,M=K.normal,3===L.length&&G)for(ja=0;3>ja;ja++)la=L[ja],Na[Ca]=la.x,Na[Ca+1]=la.y,Na[Ca+2]=la.z,Ca+=3;else for(ja=0;3>ja;ja++)Na[Ca]=M.x,Na[Ca+1]=M.y,Na[Ca+2]=M.z,Ca+=3;S.bindBuffer(S.ARRAY_BUFFER,y.__webglNormalBuffer),S.bufferData(S.ARRAY_BUFFER,Na,A)}if($a&&gb&&F){for(H=0,I=eb.length;I>H;H++)if(J=eb[H],Q=gb[J],void 0!==Q)for(ja=0;3>ja;ja++)ma=Q[ja],La[wa]=ma.x,La[wa+1]=ma.y,wa+=2;wa>0&&(S.bindBuffer(S.ARRAY_BUFFER,y.__webglUVBuffer),S.bufferData(S.ARRAY_BUFFER,La,A))}if($a&&hb&&F){for(H=0,I=eb.length;I>H;H++)if(J=eb[H],R=hb[J],void 0!==R)for(ja=0;3>ja;ja++)na=R[ja],Ma[xa]=na.x,Ma[xa+1]=na.y,xa+=2;xa>0&&(S.bindBuffer(S.ARRAY_BUFFER,y.__webglUV2Buffer),S.bufferData(S.ARRAY_BUFFER,Ma,A))}if(Za){for(H=0,I=eb.length;I>H;H++)Wa[ya]=ua,Wa[ya+1]=ua+1,Wa[ya+2]=ua+2,ya+=3,Xa[Ea]=ua,Xa[Ea+1]=ua+1,Xa[Ea+2]=ua,Xa[Ea+3]=ua+2,Xa[Ea+4]=ua+1,Xa[Ea+5]=ua+2,Ea+=6,ua+=3;S.bindBuffer(S.ELEMENT_ARRAY_BUFFER,y.__webglFaceBuffer),S.bufferData(S.ELEMENT_ARRAY_BUFFER,Wa,A),S.bindBuffer(S.ELEMENT_ARRAY_BUFFER,y.__webglLineBuffer),S.bufferData(S.ELEMENT_ARRAY_BUFFER,Xa,A)}if(Ua)for(ja=0,ka=Ua.length;ka>ja;ja++)if(Va=Ua[ja],Va.__original.needsUpdate){if(Ia=0,1===Va.size){if(void 0===Va.boundTo||"vertices"===Va.boundTo)for(H=0,I=eb.length;I>H;H++)K=fb[eb[H]],Va.array[Ia]=Va.value[K.a],Va.array[Ia+1]=Va.value[K.b],Va.array[Ia+2]=Va.value[K.c],Ia+=3;else if("faces"===Va.boundTo)for(H=0,I=eb.length;I>H;H++)Ja=Va.value[eb[H]],Va.array[Ia]=Ja,Va.array[Ia+1]=Ja,Va.array[Ia+2]=Ja,Ia+=3}else if(2===Va.size){if(void 0===Va.boundTo||"vertices"===Va.boundTo)for(H=0,I=eb.length;I>H;H++)K=fb[eb[H]],T=Va.value[K.a],U=Va.value[K.b],V=Va.value[K.c],Va.array[Ia]=T.x,Va.array[Ia+1]=T.y,Va.array[Ia+2]=U.x,Va.array[Ia+3]=U.y,Va.array[Ia+4]=V.x,Va.array[Ia+5]=V.y,Ia+=6;else if("faces"===Va.boundTo)for(H=0,I=eb.length;I>H;H++)V=U=T=Ja=Va.value[eb[H]],Va.array[Ia]=T.x,Va.array[Ia+1]=T.y,Va.array[Ia+2]=U.x,Va.array[Ia+3]=U.y,Va.array[Ia+4]=V.x,Va.array[Ia+5]=V.y,Ia+=6}else if(3===Va.size){var mb;if(mb="c"===Va.type?["r","g","b"]:["x","y","z"],void 0===Va.boundTo||"vertices"===Va.boundTo)for(H=0,I=eb.length;I>H;H++)K=fb[eb[H]],T=Va.value[K.a],U=Va.value[K.b],V=Va.value[K.c],Va.array[Ia]=T[mb[0]],Va.array[Ia+1]=T[mb[1]],Va.array[Ia+2]=T[mb[2]],Va.array[Ia+3]=U[mb[0]],Va.array[Ia+4]=U[mb[1]],Va.array[Ia+5]=U[mb[2]],Va.array[Ia+6]=V[mb[0]],Va.array[Ia+7]=V[mb[1]],Va.array[Ia+8]=V[mb[2]],Ia+=9;else if("faces"===Va.boundTo)for(H=0,I=eb.length;I>H;H++)V=U=T=Ja=Va.value[eb[H]],Va.array[Ia]=T[mb[0]],Va.array[Ia+1]=T[mb[1]],Va.array[Ia+2]=T[mb[2]],Va.array[Ia+3]=U[mb[0]],Va.array[Ia+4]=U[mb[1]],Va.array[Ia+5]=U[mb[2]],Va.array[Ia+6]=V[mb[0]],Va.array[Ia+7]=V[mb[1]],Va.array[Ia+8]=V[mb[2]],Ia+=9;else if("faceVertices"===Va.boundTo)for(H=0,I=eb.length;I>H;H++)Ja=Va.value[eb[H]],T=Ja[0],U=Ja[1],V=Ja[2],Va.array[Ia]=T[mb[0]],Va.array[Ia+1]=T[mb[1]],Va.array[Ia+2]=T[mb[2]],Va.array[Ia+3]=U[mb[0]],Va.array[Ia+4]=U[mb[1]],Va.array[Ia+5]=U[mb[2]],Va.array[Ia+6]=V[mb[0]],Va.array[Ia+7]=V[mb[1]],Va.array[Ia+8]=V[mb[2]],Ia+=9}else if(4===Va.size)if(void 0===Va.boundTo||"vertices"===Va.boundTo)for(H=0,I=eb.length;I>H;H++)K=fb[eb[H]],T=Va.value[K.a],U=Va.value[K.b],V=Va.value[K.c],Va.array[Ia]=T.x,Va.array[Ia+1]=T.y,Va.array[Ia+2]=T.z,Va.array[Ia+3]=T.w,Va.array[Ia+4]=U.x,Va.array[Ia+5]=U.y,Va.array[Ia+6]=U.z,Va.array[Ia+7]=U.w,Va.array[Ia+8]=V.x,Va.array[Ia+9]=V.y,Va.array[Ia+10]=V.z,Va.array[Ia+11]=V.w,Ia+=12;else if("faces"===Va.boundTo)for(H=0,I=eb.length;I>H;H++)V=U=T=Ja=Va.value[eb[H]],Va.array[Ia]=T.x,Va.array[Ia+1]=T.y,Va.array[Ia+2]=T.z,Va.array[Ia+3]=T.w,Va.array[Ia+4]=U.x,Va.array[Ia+5]=U.y,Va.array[Ia+6]=U.z,Va.array[Ia+7]=U.w,Va.array[Ia+8]=V.x,Va.array[Ia+9]=V.y,Va.array[Ia+10]=V.z,Va.array[Ia+11]=V.w,Ia+=12;else if("faceVertices"===Va.boundTo)for(H=0,I=eb.length;I>H;H++)Ja=Va.value[eb[H]],T=Ja[0],U=Ja[1],V=Ja[2],Va.array[Ia]=T.x,Va.array[Ia+1]=T.y,Va.array[Ia+2]=T.z,Va.array[Ia+3]=T.w,Va.array[Ia+4]=U.x,Va.array[Ia+5]=U.y,Va.array[Ia+6]=U.z,Va.array[Ia+7]=U.w,Va.array[Ia+8]=V.x,Va.array[Ia+9]=V.y,Va.array[Ia+10]=V.z,Va.array[Ia+11]=V.w,Ia+=12;S.bindBuffer(S.ARRAY_BUFFER,Va.buffer),S.bufferData(S.ARRAY_BUFFER,Va.array,A)}B&&(delete y.__inittedArrays,delete y.__colorArray,delete y.__normalArray,delete y.__tangentArray,delete y.__uvArray,delete y.__uv2Array,delete y.__faceArray,delete y.__vertexArray,delete y.__lineArray,delete y.__skinIndexArray,delete y.__skinWeightArray)}}j.verticesNeedUpdate=!1,j.morphTargetsNeedUpdate=!1,j.elementsNeedUpdate=!1,j.uvsNeedUpdate=!1,j.normalsNeedUpdate=!1,j.colorsNeedUpdate=!1,j.tangentsNeedUpdate=!1,j.buffersNeedUpdate=!1,n.attributes&&s(n)}else if(i instanceof THREE.Line){if(n=d(i,j),m=n.attributes&&r(n),j.verticesNeedUpdate||j.colorsNeedUpdate||j.lineDistancesNeedUpdate||m){var nb=j,ob=S.DYNAMIC_DRAW,pb=void 0,qb=void 0,rb=void 0,sb=void 0,tb=void 0,ub=void 0,vb=nb.vertices,wb=nb.colors,xb=nb.lineDistances,yb=vb.length,zb=wb.length,Ab=xb.length,Bb=nb.__vertexArray,Cb=nb.__colorArray,Db=nb.__lineDistanceArray,Eb=nb.colorsNeedUpdate,Fb=nb.lineDistancesNeedUpdate,Gb=nb.__webglCustomAttributesList,Hb=void 0,Ib=void 0,Jb=void 0,Kb=void 0,Lb=void 0,Mb=void 0;if(nb.verticesNeedUpdate){for(pb=0;yb>pb;pb++)sb=vb[pb],tb=3*pb,Bb[tb]=sb.x,Bb[tb+1]=sb.y,Bb[tb+2]=sb.z;S.bindBuffer(S.ARRAY_BUFFER,nb.__webglVertexBuffer),S.bufferData(S.ARRAY_BUFFER,Bb,ob)}if(Eb){for(qb=0;zb>qb;qb++)ub=wb[qb],tb=3*qb,Cb[tb]=ub.r,Cb[tb+1]=ub.g,Cb[tb+2]=ub.b;S.bindBuffer(S.ARRAY_BUFFER,nb.__webglColorBuffer),S.bufferData(S.ARRAY_BUFFER,Cb,ob)}if(Fb){for(rb=0;Ab>rb;rb++)Db[rb]=xb[rb];S.bindBuffer(S.ARRAY_BUFFER,nb.__webglLineDistanceBuffer),S.bufferData(S.ARRAY_BUFFER,Db,ob)}if(Gb)for(Hb=0,Ib=Gb.length;Ib>Hb;Hb++)if(Mb=Gb[Hb],Mb.needsUpdate&&(void 0===Mb.boundTo||"vertices"===Mb.boundTo)){if(tb=0,Kb=Mb.value.length,1===Mb.size)for(Jb=0;Kb>Jb;Jb++)Mb.array[Jb]=Mb.value[Jb];else if(2===Mb.size)for(Jb=0;Kb>Jb;Jb++)Lb=Mb.value[Jb],Mb.array[tb]=Lb.x,Mb.array[tb+1]=Lb.y,tb+=2;else if(3===Mb.size)if("c"===Mb.type)for(Jb=0;Kb>Jb;Jb++)Lb=Mb.value[Jb],Mb.array[tb]=Lb.r,Mb.array[tb+1]=Lb.g,Mb.array[tb+2]=Lb.b,tb+=3;else for(Jb=0;Kb>Jb;Jb++)Lb=Mb.value[Jb],Mb.array[tb]=Lb.x,Mb.array[tb+1]=Lb.y,Mb.array[tb+2]=Lb.z,tb+=3;else if(4===Mb.size)for(Jb=0;Kb>Jb;Jb++)Lb=Mb.value[Jb],Mb.array[tb]=Lb.x,Mb.array[tb+1]=Lb.y,Mb.array[tb+2]=Lb.z,Mb.array[tb+3]=Lb.w,tb+=4;S.bindBuffer(S.ARRAY_BUFFER,Mb.buffer),S.bufferData(S.ARRAY_BUFFER,Mb.array,ob)}}j.verticesNeedUpdate=!1,j.colorsNeedUpdate=!1,j.lineDistancesNeedUpdate=!1,n.attributes&&s(n)}else if(i instanceof THREE.ParticleSystem){if(n=d(i,j),m=n.attributes&&r(n),j.verticesNeedUpdate||j.colorsNeedUpdate||i.sortParticles||m){var Nb=j,Ob=S.DYNAMIC_DRAW,Pb=i,Qb=void 0,Rb=void 0,Sb=void 0,Tb=void 0,Ub=void 0,Vb=void 0,Wb=Nb.vertices,Xb=Wb.length,Yb=Nb.colors,Zb=Yb.length,$b=Nb.__vertexArray,_b=Nb.__colorArray,ac=Nb.__sortArray,bc=Nb.verticesNeedUpdate,cc=Nb.colorsNeedUpdate,dc=Nb.__webglCustomAttributesList,ec=void 0,fc=void 0,gc=void 0,hc=void 0,ic=void 0,jc=void 0;if(Pb.sortParticles){for(Aa.copy(za),Aa.multiply(Pb.matrixWorld),Qb=0;Xb>Qb;Qb++)Sb=Wb[Qb],Ba.copy(Sb),Ba.applyProjection(Aa),ac[Qb]=[Ba.z,Qb];for(ac.sort(l),Qb=0;Xb>Qb;Qb++)Sb=Wb[ac[Qb][1]],Tb=3*Qb,$b[Tb]=Sb.x,$b[Tb+1]=Sb.y,$b[Tb+2]=Sb.z;for(Rb=0;Zb>Rb;Rb++)Tb=3*Rb,Vb=Yb[ac[Rb][1]],_b[Tb]=Vb.r,_b[Tb+1]=Vb.g,_b[Tb+2]=Vb.b;if(dc)for(ec=0,fc=dc.length;fc>ec;ec++)if(jc=dc[ec],void 0===jc.boundTo||"vertices"===jc.boundTo)if(Tb=0,hc=jc.value.length,1===jc.size)for(gc=0;hc>gc;gc++)Ub=ac[gc][1],jc.array[gc]=jc.value[Ub];else if(2===jc.size)for(gc=0;hc>gc;gc++)Ub=ac[gc][1],ic=jc.value[Ub],jc.array[Tb]=ic.x,jc.array[Tb+1]=ic.y,Tb+=2;else if(3===jc.size)if("c"===jc.type)for(gc=0;hc>gc;gc++)Ub=ac[gc][1],ic=jc.value[Ub],jc.array[Tb]=ic.r,jc.array[Tb+1]=ic.g,jc.array[Tb+2]=ic.b,Tb+=3;else for(gc=0;hc>gc;gc++)Ub=ac[gc][1],ic=jc.value[Ub],jc.array[Tb]=ic.x,jc.array[Tb+1]=ic.y,jc.array[Tb+2]=ic.z,Tb+=3;else if(4===jc.size)for(gc=0;hc>gc;gc++)Ub=ac[gc][1],ic=jc.value[Ub],jc.array[Tb]=ic.x,jc.array[Tb+1]=ic.y,jc.array[Tb+2]=ic.z,jc.array[Tb+3]=ic.w,Tb+=4}else{if(bc)for(Qb=0;Xb>Qb;Qb++)Sb=Wb[Qb],Tb=3*Qb,$b[Tb]=Sb.x,$b[Tb+1]=Sb.y,$b[Tb+2]=Sb.z;if(cc)for(Rb=0;Zb>Rb;Rb++)Vb=Yb[Rb],Tb=3*Rb,_b[Tb]=Vb.r,_b[Tb+1]=Vb.g,_b[Tb+2]=Vb.b;if(dc)for(ec=0,fc=dc.length;fc>ec;ec++)if(jc=dc[ec],jc.needsUpdate&&(void 0===jc.boundTo||"vertices"===jc.boundTo))if(hc=jc.value.length,Tb=0,1===jc.size)for(gc=0;hc>gc;gc++)jc.array[gc]=jc.value[gc];else if(2===jc.size)for(gc=0;hc>gc;gc++)ic=jc.value[gc],jc.array[Tb]=ic.x,jc.array[Tb+1]=ic.y,Tb+=2;else if(3===jc.size)if("c"===jc.type)for(gc=0;hc>gc;gc++)ic=jc.value[gc],jc.array[Tb]=ic.r,jc.array[Tb+1]=ic.g,jc.array[Tb+2]=ic.b,Tb+=3;else for(gc=0;hc>gc;gc++)ic=jc.value[gc],jc.array[Tb]=ic.x,jc.array[Tb+1]=ic.y,jc.array[Tb+2]=ic.z,Tb+=3;else if(4===jc.size)for(gc=0;hc>gc;gc++)ic=jc.value[gc],jc.array[Tb]=ic.x,jc.array[Tb+1]=ic.y,jc.array[Tb+2]=ic.z,jc.array[Tb+3]=ic.w,Tb+=4}if((bc||Pb.sortParticles)&&(S.bindBuffer(S.ARRAY_BUFFER,Nb.__webglVertexBuffer),S.bufferData(S.ARRAY_BUFFER,$b,Ob)),(cc||Pb.sortParticles)&&(S.bindBuffer(S.ARRAY_BUFFER,Nb.__webglColorBuffer),S.bufferData(S.ARRAY_BUFFER,_b,Ob)),dc)for(ec=0,fc=dc.length;fc>ec;ec++)jc=dc[ec],(jc.needsUpdate||Pb.sortParticles)&&(S.bindBuffer(S.ARRAY_BUFFER,jc.buffer),S.bufferData(S.ARRAY_BUFFER,jc.array,Ob))}j.verticesNeedUpdate=!1,j.colorsNeedUpdate=!1,n.attributes&&s(n)}}},this.initMaterial=function(a,b,c,d){var e,f,g,h;a.addEventListener("dispose",Ua);var i,j,k,l;a instanceof THREE.MeshDepthMaterial?l="depth":a instanceof THREE.MeshNormalMaterial?l="normal":a instanceof THREE.MeshBasicMaterial?l="basic":a instanceof THREE.MeshLambertMaterial?l="lambert":a instanceof THREE.MeshPhongMaterial?l="phong":a instanceof THREE.LineBasicMaterial?l="basic":a instanceof THREE.LineDashedMaterial?l="dashed":a instanceof THREE.ParticleSystemMaterial&&(l="particle_basic"),l&&(e=THREE.ShaderLib[l],a.uniforms=THREE.UniformsUtils.clone(e.uniforms),a.vertexShader=e.vertexShader,a.fragmentShader=e.fragmentShader),k=h=g=f=e=0;for(var m=b.length;m>k;k++){var n=b[k];n.onlyShadow||!1===n.visible||(n instanceof THREE.DirectionalLight&&e++,n instanceof THREE.PointLight&&f++,n instanceof THREE.SpotLight&&g++,n instanceof THREE.HemisphereLight&&h++)}for(m=k=0,n=b.length;n>m;m++){var o=b[m];o.castShadow&&(o instanceof THREE.SpotLight&&k++,o instanceof THREE.DirectionalLight&&!o.shadowCascade&&k++)}b=k,Ka&&d&&d.skeleton&&d.skeleton.useVertexTexture?k=1024:(k=S.getParameter(S.MAX_VERTEX_UNIFORM_VECTORS),k=Math.floor((k-20)/4),void 0!==d&&d instanceof THREE.SkinnedMesh&&(k=Math.min(d.skeleton.bones.length,k),k<d.skeleton.bones.length&&console.warn("WebGLRenderer: too many bones - "+d.skeleton.bones.length+", this GPU supports just "+k+" (try OpenGL instead of ANGLE)"))),c={precision:I,supportsVertexTextures:Ja,map:!!a.map,envMap:!!a.envMap,lightMap:!!a.lightMap,bumpMap:!!a.bumpMap,normalMap:!!a.normalMap,specularMap:!!a.specularMap,vertexColors:a.vertexColors,fog:c,useFog:a.fog,fogExp:c instanceof THREE.FogExp2,sizeAttenuation:a.sizeAttenuation,logarithmicDepthBuffer:P,skinning:a.skinning,maxBones:k,useVertexTexture:Ka&&d&&d.skeleton&&d.skeleton.useVertexTexture,morphTargets:a.morphTargets,morphNormals:a.morphNormals,maxMorphTargets:this.maxMorphTargets,maxMorphNormals:this.maxMorphNormals,maxDirLights:e,maxPointLights:f,maxSpotLights:g,maxHemiLights:h,maxShadows:b,shadowMapEnabled:this.shadowMapEnabled&&d.receiveShadow&&b>0,shadowMapType:this.shadowMapType,shadowMapDebug:this.shadowMapDebug,shadowMapCascade:this.shadowMapCascade,alphaTest:a.alphaTest,metal:a.metal,wrapAround:a.wrapAround,doubleSided:a.side===THREE.DoubleSide,flipSided:a.side===THREE.BackSide},d=[],l?d.push(l):(d.push(a.fragmentShader),d.push(a.vertexShader));for(var p in a.defines)d.push(p),d.push(a.defines[p]);for(j in c)d.push(j),d.push(c[j]);l=d.join();var q;for(j=0,p=Z.length;p>j;j++)if(d=Z[j],d.code===l){q=d,q.usedTimes++;break}if(void 0===q&&(q=new THREE.WebGLProgram(this,l,a,c),Z.push(q),Y.info.memory.programs=Z.length),a.program=q,q=a.program.attributes,a.morphTargets)for(a.numSupportedMorphTargets=0,p="morphTarget",j=0;j<this.maxMorphTargets;j++)l=p+j,0<=q[l]&&a.numSupportedMorphTargets++;if(a.morphNormals)for(a.numSupportedMorphNormals=0,p="morphNormal",j=0;j<this.maxMorphNormals;j++)l=p+j,0<=q[l]&&a.numSupportedMorphNormals++;a.uniformsList=[];for(i in a.uniforms)a.uniformsList.push([a.uniforms[i],i])},this.setFaceCulling=function(a,b){a===THREE.CullFaceNone?S.disable(S.CULL_FACE):(b===THREE.FrontFaceDirectionCW?S.frontFace(S.CW):S.frontFace(S.CCW),a===THREE.CullFaceBack?S.cullFace(S.BACK):a===THREE.CullFaceFront?S.cullFace(S.FRONT):S.cullFace(S.FRONT_AND_BACK),S.enable(S.CULL_FACE))},this.setMaterialFaces=function(a){var b=a.side===THREE.DoubleSide;a=a.side===THREE.BackSide,ea!==b&&(b?S.disable(S.CULL_FACE):S.enable(S.CULL_FACE),ea=b),fa!==a&&(a?S.frontFace(S.CW):S.frontFace(S.CCW),fa=a)},this.setDepthTest=function(a){ka!==a&&(a?S.enable(S.DEPTH_TEST):S.disable(S.DEPTH_TEST),ka=a)},this.setDepthWrite=function(a){la!==a&&(S.depthMask(a),la=a)},this.setBlending=function(a,b,c,d){a!==ga&&(a===THREE.NoBlending?S.disable(S.BLEND):a===THREE.AdditiveBlending?(S.enable(S.BLEND),S.blendEquation(S.FUNC_ADD),S.blendFunc(S.SRC_ALPHA,S.ONE)):a===THREE.SubtractiveBlending?(S.enable(S.BLEND),S.blendEquation(S.FUNC_ADD),S.blendFunc(S.ZERO,S.ONE_MINUS_SRC_COLOR)):a===THREE.MultiplyBlending?(S.enable(S.BLEND),S.blendEquation(S.FUNC_ADD),S.blendFunc(S.ZERO,S.SRC_COLOR)):a===THREE.CustomBlending?S.enable(S.BLEND):(S.enable(S.BLEND),S.blendEquationSeparate(S.FUNC_ADD,S.FUNC_ADD),S.blendFuncSeparate(S.SRC_ALPHA,S.ONE_MINUS_SRC_ALPHA,S.ONE,S.ONE_MINUS_SRC_ALPHA)),ga=a),a===THREE.CustomBlending?(b!==ha&&(S.blendEquation(F(b)),ha=b),(c!==ia||d!==ja)&&(S.blendFunc(F(c),F(d)),ia=c,ja=d)):ja=ia=ha=null},this.setTexture=function(a,b){if(a.needsUpdate){a.__webglInit||(a.__webglInit=!0,a.addEventListener("dispose",Sa),a.__webglTexture=S.createTexture(),Y.info.memory.textures++),S.activeTexture(S.TEXTURE0+b),S.bindTexture(S.TEXTURE_2D,a.__webglTexture),S.pixelStorei(S.UNPACK_FLIP_Y_WEBGL,a.flipY),S.pixelStorei(S.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a.premultiplyAlpha),S.pixelStorei(S.UNPACK_ALIGNMENT,a.unpackAlignment);var c=a.image,d=THREE.Math.isPowerOfTwo(c.width)&&THREE.Math.isPowerOfTwo(c.height),e=F(a.format),f=F(a.type);C(S.TEXTURE_2D,a,d);var g=a.mipmaps;if(a instanceof THREE.DataTexture)if(0<g.length&&d){for(var h=0,i=g.length;i>h;h++)c=g[h],S.texImage2D(S.TEXTURE_2D,h,e,c.width,c.height,0,e,f,c.data);a.generateMipmaps=!1}else S.texImage2D(S.TEXTURE_2D,0,e,c.width,c.height,0,e,f,c.data);else if(a instanceof THREE.CompressedTexture)for(h=0,i=g.length;i>h;h++)c=g[h],a.format!==THREE.RGBAFormat?S.compressedTexImage2D(S.TEXTURE_2D,h,e,c.width,c.height,0,c.data):S.texImage2D(S.TEXTURE_2D,h,e,c.width,c.height,0,e,f,c.data);else if(0<g.length&&d){for(h=0,i=g.length;i>h;h++)c=g[h],S.texImage2D(S.TEXTURE_2D,h,e,e,f,c);a.generateMipmaps=!1}else S.texImage2D(S.TEXTURE_2D,0,e,e,f,a.image);a.generateMipmaps&&d&&S.generateMipmap(S.TEXTURE_2D),a.needsUpdate=!1,a.onUpdate&&a.onUpdate()}else S.activeTexture(S.TEXTURE0+b),S.bindTexture(S.TEXTURE_2D,a.__webglTexture)},this.setRenderTarget=function(a){var b=a instanceof THREE.WebGLRenderTargetCube;if(a&&!a.__webglFramebuffer){void 0===a.depthBuffer&&(a.depthBuffer=!0),void 0===a.stencilBuffer&&(a.stencilBuffer=!0),a.addEventListener("dispose",Ta),a.__webglTexture=S.createTexture(),Y.info.memory.textures++;var c=THREE.Math.isPowerOfTwo(a.width)&&THREE.Math.isPowerOfTwo(a.height),d=F(a.format),e=F(a.type);if(b){a.__webglFramebuffer=[],a.__webglRenderbuffer=[],S.bindTexture(S.TEXTURE_CUBE_MAP,a.__webglTexture),C(S.TEXTURE_CUBE_MAP,a,c);for(var f=0;6>f;f++){a.__webglFramebuffer[f]=S.createFramebuffer(),a.__webglRenderbuffer[f]=S.createRenderbuffer(),S.texImage2D(S.TEXTURE_CUBE_MAP_POSITIVE_X+f,0,d,a.width,a.height,0,d,e,null);var g=a,h=S.TEXTURE_CUBE_MAP_POSITIVE_X+f;S.bindFramebuffer(S.FRAMEBUFFER,a.__webglFramebuffer[f]),S.framebufferTexture2D(S.FRAMEBUFFER,S.COLOR_ATTACHMENT0,h,g.__webglTexture,0),D(a.__webglRenderbuffer[f],a)}c&&S.generateMipmap(S.TEXTURE_CUBE_MAP)}else a.__webglFramebuffer=S.createFramebuffer(),a.__webglRenderbuffer=a.shareDepthFrom?a.shareDepthFrom.__webglRenderbuffer:S.createRenderbuffer(),S.bindTexture(S.TEXTURE_2D,a.__webglTexture),C(S.TEXTURE_2D,a,c),S.texImage2D(S.TEXTURE_2D,0,d,a.width,a.height,0,d,e,null),d=S.TEXTURE_2D,S.bindFramebuffer(S.FRAMEBUFFER,a.__webglFramebuffer),S.framebufferTexture2D(S.FRAMEBUFFER,S.COLOR_ATTACHMENT0,d,a.__webglTexture,0),a.shareDepthFrom?a.depthBuffer&&!a.stencilBuffer?S.framebufferRenderbuffer(S.FRAMEBUFFER,S.DEPTH_ATTACHMENT,S.RENDERBUFFER,a.__webglRenderbuffer):a.depthBuffer&&a.stencilBuffer&&S.framebufferRenderbuffer(S.FRAMEBUFFER,S.DEPTH_STENCIL_ATTACHMENT,S.RENDERBUFFER,a.__webglRenderbuffer):D(a.__webglRenderbuffer,a),c&&S.generateMipmap(S.TEXTURE_2D);b?S.bindTexture(S.TEXTURE_CUBE_MAP,null):S.bindTexture(S.TEXTURE_2D,null),S.bindRenderbuffer(S.RENDERBUFFER,null),S.bindFramebuffer(S.FRAMEBUFFER,null)}a?(b=b?a.__webglFramebuffer[a.activeCubeFace]:a.__webglFramebuffer,c=a.width,a=a.height,e=d=0):(b=null,c=sa,a=ta,d=qa,e=ra),b!==_&&(S.bindFramebuffer(S.FRAMEBUFFER,b),S.viewport(d,e,c,a),_=b),ua=c,va=a},this.shadowMapPlugin=new THREE.ShadowMapPlugin,this.addPrePlugin(this.shadowMapPlugin),this.addPostPlugin(new THREE.SpritePlugin),this.addPostPlugin(new THREE.LensFlarePlugin)},THREE.WebGLRenderTarget=function(a,b,c){this.width=a,this.height=b,c=c||{},this.wrapS=void 0!==c.wrapS?c.wrapS:THREE.ClampToEdgeWrapping,this.wrapT=void 0!==c.wrapT?c.wrapT:THREE.ClampToEdgeWrapping,this.magFilter=void 0!==c.magFilter?c.magFilter:THREE.LinearFilter,this.minFilter=void 0!==c.minFilter?c.minFilter:THREE.LinearMipMapLinearFilter,this.anisotropy=void 0!==c.anisotropy?c.anisotropy:1,this.offset=new THREE.Vector2(0,0),this.repeat=new THREE.Vector2(1,1),this.format=void 0!==c.format?c.format:THREE.RGBAFormat,this.type=void 0!==c.type?c.type:THREE.UnsignedByteType,this.depthBuffer=void 0!==c.depthBuffer?c.depthBuffer:!0,this.stencilBuffer=void 0!==c.stencilBuffer?c.stencilBuffer:!0,this.generateMipmaps=!0,this.shareDepthFrom=null},THREE.WebGLRenderTarget.prototype={constructor:THREE.WebGLRenderTarget,setSize:function(a,b){this.width=a,this.height=b},clone:function(){var a=new THREE.WebGLRenderTarget(this.width,this.height);return a.wrapS=this.wrapS,a.wrapT=this.wrapT,a.magFilter=this.magFilter,a.minFilter=this.minFilter,a.anisotropy=this.anisotropy,a.offset.copy(this.offset),a.repeat.copy(this.repeat),a.format=this.format,a.type=this.type,a.depthBuffer=this.depthBuffer,a.stencilBuffer=this.stencilBuffer,a.generateMipmaps=this.generateMipmaps,a.shareDepthFrom=this.shareDepthFrom,a},dispose:function(){this.dispatchEvent({type:"dispose"})}},THREE.EventDispatcher.prototype.apply(THREE.WebGLRenderTarget.prototype),THREE.WebGLRenderTargetCube=function(a,b,c){THREE.WebGLRenderTarget.call(this,a,b,c),this.activeCubeFace=0},THREE.WebGLRenderTargetCube.prototype=Object.create(THREE.WebGLRenderTarget.prototype),THREE.WebGLProgram=function(){var a=0;return function(b,c,d,e){var f=b.context,g=d.fragmentShader,h=d.vertexShader,i=d.uniforms,j=d.attributes,k=d.defines,l=d.index0AttributeName;void 0===l&&!0===e.morphTargets&&(l="position");var m="SHADOWMAP_TYPE_BASIC";e.shadowMapType===THREE.PCFShadowMap?m="SHADOWMAP_TYPE_PCF":e.shadowMapType===THREE.PCFSoftShadowMap&&(m="SHADOWMAP_TYPE_PCF_SOFT");var n,o;n=[];for(var p in k)o=k[p],!1!==o&&(o="#define "+p+" "+o,n.push(o));n=n.join("\n"),k=f.createProgram(),d instanceof THREE.RawShaderMaterial?b=d="":(d=["precision "+e.precision+" float;","precision "+e.precision+" int;",n,e.supportsVertexTextures?"#define VERTEX_TEXTURES":"",b.gammaInput?"#define GAMMA_INPUT":"",b.gammaOutput?"#define GAMMA_OUTPUT":"","#define MAX_DIR_LIGHTS "+e.maxDirLights,"#define MAX_POINT_LIGHTS "+e.maxPointLights,"#define MAX_SPOT_LIGHTS "+e.maxSpotLights,"#define MAX_HEMI_LIGHTS "+e.maxHemiLights,"#define MAX_SHADOWS "+e.maxShadows,"#define MAX_BONES "+e.maxBones,e.map?"#define USE_MAP":"",e.envMap?"#define USE_ENVMAP":"",e.lightMap?"#define USE_LIGHTMAP":"",e.bumpMap?"#define USE_BUMPMAP":"",e.normalMap?"#define USE_NORMALMAP":"",e.specularMap?"#define USE_SPECULARMAP":"",e.vertexColors?"#define USE_COLOR":"",e.skinning?"#define USE_SKINNING":"",e.useVertexTexture?"#define BONE_TEXTURE":"",e.morphTargets?"#define USE_MORPHTARGETS":"",e.morphNormals?"#define USE_MORPHNORMALS":"",e.wrapAround?"#define WRAP_AROUND":"",e.doubleSided?"#define DOUBLE_SIDED":"",e.flipSided?"#define FLIP_SIDED":"",e.shadowMapEnabled?"#define USE_SHADOWMAP":"",e.shadowMapEnabled?"#define "+m:"",e.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",e.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",e.sizeAttenuation?"#define USE_SIZEATTENUATION":"",e.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 modelMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\nuniform vec3 cameraPosition;\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv;\nattribute vec2 uv2;\n#ifdef USE_COLOR\n	attribute vec3 color;\n#endif\n#ifdef USE_MORPHTARGETS\n	attribute vec3 morphTarget0;\n	attribute vec3 morphTarget1;\n	attribute vec3 morphTarget2;\n	attribute vec3 morphTarget3;\n	#ifdef USE_MORPHNORMALS\n		attribute vec3 morphNormal0;\n		attribute vec3 morphNormal1;\n		attribute vec3 morphNormal2;\n		attribute vec3 morphNormal3;\n	#else\n		attribute vec3 morphTarget4;\n		attribute vec3 morphTarget5;\n		attribute vec3 morphTarget6;\n		attribute vec3 morphTarget7;\n	#endif\n#endif\n#ifdef USE_SKINNING\n	attribute vec4 skinIndex;\n	attribute vec4 skinWeight;\n#endif\n"].join("\n"),b=["precision "+e.precision+" float;","precision "+e.precision+" int;",e.bumpMap||e.normalMap?"#extension GL_OES_standard_derivatives : enable":"",n,"#define MAX_DIR_LIGHTS "+e.maxDirLights,"#define MAX_POINT_LIGHTS "+e.maxPointLights,"#define MAX_SPOT_LIGHTS "+e.maxSpotLights,"#define MAX_HEMI_LIGHTS "+e.maxHemiLights,"#define MAX_SHADOWS "+e.maxShadows,e.alphaTest?"#define ALPHATEST "+e.alphaTest:"",b.gammaInput?"#define GAMMA_INPUT":"",b.gammaOutput?"#define GAMMA_OUTPUT":"",e.useFog&&e.fog?"#define USE_FOG":"",e.useFog&&e.fogExp?"#define FOG_EXP2":"",e.map?"#define USE_MAP":"",e.envMap?"#define USE_ENVMAP":"",e.lightMap?"#define USE_LIGHTMAP":"",e.bumpMap?"#define USE_BUMPMAP":"",e.normalMap?"#define USE_NORMALMAP":"",e.specularMap?"#define USE_SPECULARMAP":"",e.vertexColors?"#define USE_COLOR":"",e.metal?"#define METAL":"",e.wrapAround?"#define WRAP_AROUND":"",e.doubleSided?"#define DOUBLE_SIDED":"",e.flipSided?"#define FLIP_SIDED":"",e.shadowMapEnabled?"#define USE_SHADOWMAP":"",e.shadowMapEnabled?"#define "+m:"",e.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",e.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",e.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 viewMatrix;\nuniform vec3 cameraPosition;\n"].join("\n")),h=new THREE.WebGLShader(f,f.VERTEX_SHADER,d+h),g=new THREE.WebGLShader(f,f.FRAGMENT_SHADER,b+g),f.attachShader(k,h),f.attachShader(k,g),void 0!==l&&f.bindAttribLocation(k,0,l),f.linkProgram(k),!1===f.getProgramParameter(k,f.LINK_STATUS)&&(console.error("Could not initialise shader"),console.error("gl.VALIDATE_STATUS",f.getProgramParameter(k,f.VALIDATE_STATUS)),console.error("gl.getError()",f.getError())),""!==f.getProgramInfoLog(k)&&console.error("gl.getProgramInfoLog()",f.getProgramInfoLog(k)),f.deleteShader(h),f.deleteShader(g),l="viewMatrix modelViewMatrix projectionMatrix normalMatrix modelMatrix cameraPosition morphTargetInfluences".split(" "),e.useVertexTexture?(l.push("boneTexture"),l.push("boneTextureWidth"),l.push("boneTextureHeight")):l.push("boneGlobalMatrices"),e.logarithmicDepthBuffer&&l.push("logDepthBufFC");for(var q in i)l.push(q);for(i=l,q={},l=0,b=i.length;b>l;l++)m=i[l],q[m]=f.getUniformLocation(k,m);for(this.uniforms=q,l="position normal uv uv2 tangent color skinIndex skinWeight lineDistance".split(" "),i=0;i<e.maxMorphTargets;i++)l.push("morphTarget"+i);for(i=0;i<e.maxMorphNormals;i++)l.push("morphNormal"+i);for(var r in j)l.push(r);for(e=l,j={},r=0,i=e.length;i>r;r++)q=e[r],j[q]=f.getAttribLocation(k,q);return this.attributes=j,this.id=a++,this.code=c,this.usedTimes=1,this.program=k,this.vertexShader=h,this.fragmentShader=g,this}}(),THREE.WebGLShader=function(){var a=function(a){a=a.split("\n");for(var b=0;b<a.length;b++)a[b]=b+1+": "+a[b];return a.join("\n")};return function(b,c,d){return c=b.createShader(c),b.shaderSource(c,d),b.compileShader(c),!1===b.getShaderParameter(c,b.COMPILE_STATUS)&&console.error("THREE.WebGLShader: Shader couldn't compile."),""!==b.getShaderInfoLog(c)&&(console.error("THREE.WebGLShader:","gl.getShaderInfoLog()",b.getShaderInfoLog(c)),console.error(a(d))),c}}(),THREE.RenderableVertex=function(){this.position=new THREE.Vector3,this.positionWorld=new THREE.Vector3,this.positionScreen=new THREE.Vector4,this.visible=!0},THREE.RenderableVertex.prototype.copy=function(a){this.positionWorld.copy(a.positionWorld),this.positionScreen.copy(a.positionScreen)},THREE.RenderableFace=function(){this.id=0,this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.v3=new THREE.RenderableVertex,this.normalModel=new THREE.Vector3,this.vertexNormalsModel=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],this.vertexNormalsLength=0,this.material=this.color=null,
this.uvs=[new THREE.Vector2,new THREE.Vector2,new THREE.Vector2],this.z=0},THREE.RenderableObject=function(){this.id=0,this.object=null,this.z=0},THREE.RenderableSprite=function(){this.id=0,this.object=null,this.rotation=this.z=this.y=this.x=0,this.scale=new THREE.Vector2,this.material=null},THREE.RenderableLine=function(){this.id=0,this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.vertexColors=[new THREE.Color,new THREE.Color],this.material=null,this.z=0},THREE.GeometryUtils={merge:function(a,b,c){console.warn("DEPRECATED: GeometryUtils's .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead.");var d;b instanceof THREE.Mesh&&(b.matrixAutoUpdate&&b.updateMatrix(),d=b.matrix,b=b.geometry),a.merge(b,d,c)},randomPointInTriangle:function(){var a=new THREE.Vector3;return function(b,c,d){var e=new THREE.Vector3,f=THREE.Math.random16(),g=THREE.Math.random16();f+g>1&&(f=1-f,g=1-g);var h=1-f-g;return e.copy(b),e.multiplyScalar(f),a.copy(c),a.multiplyScalar(g),e.add(a),a.copy(d),a.multiplyScalar(h),e.add(a),e}}(),randomPointInFace:function(a,b,c){return THREE.GeometryUtils.randomPointInTriangle(b.vertices[a.a],b.vertices[a.b],b.vertices[a.c])},randomPointsInGeometry:function(a,b){function c(a){function b(c,d){if(c>d)return c;var e=c+Math.floor((d-c)/2);return m[e]>a?b(c,e-1):m[e]<a?b(e+1,d):e}return b(0,m.length-1)}var d,e,f,g,h,i=a.faces,j=a.vertices,k=i.length,l=0,m=[];for(e=0;k>e;e++)d=i[e],f=j[d.a],g=j[d.b],h=j[d.c],d._area=THREE.GeometryUtils.triangleArea(f,g,h),l+=d._area,m[e]=l;for(d=[],e=0;b>e;e++)j=THREE.Math.random16()*l,j=c(j),d[e]=THREE.GeometryUtils.randomPointInFace(i[j],a,!0);return d},triangleArea:function(){var a=new THREE.Vector3,b=new THREE.Vector3;return function(c,d,e){return a.subVectors(d,c),b.subVectors(e,c),a.cross(b),.5*a.length()}}(),center:function(a){a.computeBoundingBox();var b=a.boundingBox,c=new THREE.Vector3;return c.addVectors(b.min,b.max),c.multiplyScalar(-.5),a.applyMatrix((new THREE.Matrix4).makeTranslation(c.x,c.y,c.z)),a.computeBoundingBox(),c}},THREE.ImageUtils={crossOrigin:void 0,loadTexture:function(a,b,c,d){var e=new THREE.ImageLoader;e.crossOrigin=this.crossOrigin;var f=new THREE.Texture(void 0,b);return b=e.load(a,function(){f.needsUpdate=!0,c&&c(f)},void 0,function(a){d&&d(a)}),f.image=b,f.sourceFile=a,f},loadCompressedTexture:function(a,b,c,d){var e=new THREE.CompressedTexture;e.mapping=b;var f=new XMLHttpRequest;return f.onload=function(){var a=THREE.ImageUtils.parseDDS(f.response,!0);e.format=a.format,e.mipmaps=a.mipmaps,e.image.width=a.width,e.image.height=a.height,e.generateMipmaps=!1,e.needsUpdate=!0,c&&c(e)},f.onerror=d,f.open("GET",a,!0),f.responseType="arraybuffer",f.send(null),e},loadTextureCube:function(a,b,c,d){var e=[];e.loadCount=0,d=new THREE.ImageLoader,d.crossOrigin=this.crossOrigin;var f=new THREE.Texture;f.image=e,void 0!==b&&(f.mapping=b),f.flipY=!1,b=0;for(var g=a.length;g>b;++b){var h=d.load(a[b],function(){e.loadCount+=1,6===e.loadCount&&(f.needsUpdate=!0,c&&c(f))});e[b]=h}return f},loadCompressedTextureCube:function(a,b,c,d){var e=[];e.loadCount=0;var f=new THREE.CompressedTexture;if(f.image=e,void 0!==b&&(f.mapping=b),f.flipY=!1,f.generateMipmaps=!1,b=function(a,b){return function(){var d=THREE.ImageUtils.parseDDS(a.response,!0);b.format=d.format,b.mipmaps=d.mipmaps,b.width=d.width,b.height=d.height,e.loadCount+=1,6===e.loadCount&&(f.format=d.format,f.needsUpdate=!0,c&&c(f))}},a instanceof Array)for(var g=0,h=a.length;h>g;++g){var i={};e[g]=i;var j=new XMLHttpRequest;j.onload=b(j,i),j.onerror=d,i=a[g],j.open("GET",i,!0),j.responseType="arraybuffer",j.send(null)}else j=new XMLHttpRequest,j.onload=function(){var a=THREE.ImageUtils.parseDDS(j.response,!0);if(a.isCubemap){for(var b=a.mipmaps.length/a.mipmapCount,d=0;b>d;d++){e[d]={mipmaps:[]};for(var g=0;g<a.mipmapCount;g++)e[d].mipmaps.push(a.mipmaps[d*a.mipmapCount+g]),e[d].format=a.format,e[d].width=a.width,e[d].height=a.height}f.format=a.format,f.needsUpdate=!0,c&&c(f)}},j.onerror=d,j.open("GET",a,!0),j.responseType="arraybuffer",j.send(null);return f},loadDDSTexture:function(a,b,c,d){var e=[];e.loadCount=0;var f=new THREE.CompressedTexture;f.image=e,void 0!==b&&(f.mapping=b),f.flipY=!1,f.generateMipmaps=!1;var g=new XMLHttpRequest;return g.onload=function(){var a=THREE.ImageUtils.parseDDS(g.response,!0);if(a.isCubemap)for(var b=a.mipmaps.length/a.mipmapCount,d=0;b>d;d++){e[d]={mipmaps:[]};for(var h=0;h<a.mipmapCount;h++)e[d].mipmaps.push(a.mipmaps[d*a.mipmapCount+h]),e[d].format=a.format,e[d].width=a.width,e[d].height=a.height}else f.image.width=a.width,f.image.height=a.height,f.mipmaps=a.mipmaps;f.format=a.format,f.needsUpdate=!0,c&&c(f)},g.onerror=d,g.open("GET",a,!0),g.responseType="arraybuffer",g.send(null),f},parseDDS:function(a,b){function c(a){return a.charCodeAt(0)+(a.charCodeAt(1)<<8)+(a.charCodeAt(2)<<16)+(a.charCodeAt(3)<<24)}function d(a,b,c,d){var e=c*d*4;a=new Uint8Array(a,b,e);for(var e=new Uint8Array(e),f=b=0,g=0;d>g;g++)for(var h=0;c>h;h++){var i=a[f];f++;var j=a[f];f++;var k=a[f];f++;var l=a[f];f++,e[b]=k,b++,e[b]=j,b++,e[b]=i,b++,e[b]=l,b++}return e}var e={mipmaps:[],width:0,height:0,format:null,mipmapCount:1},f=c("DXT1"),g=c("DXT3"),h=c("DXT5"),i=new Int32Array(a,0,31);if(542327876!==i[0])return console.error("ImageUtils.parseDDS(): Invalid magic number in DDS header"),e;if(4&!i[20])return console.error("ImageUtils.parseDDS(): Unsupported format, must contain a FourCC code"),e;var j=i[21],k=!1;switch(j){case f:f=8,e.format=THREE.RGB_S3TC_DXT1_Format;break;case g:f=16,e.format=THREE.RGBA_S3TC_DXT3_Format;break;case h:f=16,e.format=THREE.RGBA_S3TC_DXT5_Format;break;default:if(!(32==i[22]&&16711680&i[23]&&65280&i[24]&&255&i[25]&&4278190080&i[26]))return console.error("ImageUtils.parseDDS(): Unsupported FourCC code: ",String.fromCharCode(255&j,j>>8&255,j>>16&255,j>>24&255)),e;k=!0,f=64,e.format=THREE.RGBAFormat}e.mipmapCount=1,131072&i[2]&&!1!==b&&(e.mipmapCount=Math.max(1,i[7])),e.isCubemap=!!(512&i[28]),e.width=i[4],e.height=i[3];for(var i=i[1]+4,g=e.width,h=e.height,j=e.isCubemap?6:1,l=0;j>l;l++){for(var m=0;m<e.mipmapCount;m++){if(k)var n=d(a,i,g,h),o=n.length;else o=Math.max(4,g)/4*Math.max(4,h)/4*f,n=new Uint8Array(a,i,o);e.mipmaps.push({data:n,width:g,height:h}),i+=o,g=Math.max(.5*g,1),h=Math.max(.5*h,1)}g=e.width,h=e.height}return e},getNormalMap:function(a,b){var c=function(a){var b=Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2]);return[a[0]/b,a[1]/b,a[2]/b]};b|=1;var d=a.width,e=a.height,f=document.createElement("canvas");f.width=d,f.height=e;var g=f.getContext("2d");g.drawImage(a,0,0);for(var h=g.getImageData(0,0,d,e).data,i=g.createImageData(d,e),j=i.data,k=0;d>k;k++)for(var l=0;e>l;l++){var m=0>l-1?0:l-1,n=l+1>e-1?e-1:l+1,o=0>k-1?0:k-1,p=k+1>d-1?d-1:k+1,q=[],r=[0,0,h[4*(l*d+k)]/255*b];for(q.push([-1,0,h[4*(l*d+o)]/255*b]),q.push([-1,-1,h[4*(m*d+o)]/255*b]),q.push([0,-1,h[4*(m*d+k)]/255*b]),q.push([1,-1,h[4*(m*d+p)]/255*b]),q.push([1,0,h[4*(l*d+p)]/255*b]),q.push([1,1,h[4*(n*d+p)]/255*b]),q.push([0,1,h[4*(n*d+k)]/255*b]),q.push([-1,1,h[4*(n*d+o)]/255*b]),m=[],o=q.length,n=0;o>n;n++){var p=q[n],s=q[(n+1)%o],p=[p[0]-r[0],p[1]-r[1],p[2]-r[2]],s=[s[0]-r[0],s[1]-r[1],s[2]-r[2]];m.push(c([p[1]*s[2]-p[2]*s[1],p[2]*s[0]-p[0]*s[2],p[0]*s[1]-p[1]*s[0]]))}for(q=[0,0,0],n=0;n<m.length;n++)q[0]+=m[n][0],q[1]+=m[n][1],q[2]+=m[n][2];q[0]/=m.length,q[1]/=m.length,q[2]/=m.length,r=4*(l*d+k),j[r]=(q[0]+1)/2*255|0,j[r+1]=(q[1]+1)/2*255|0,j[r+2]=255*q[2]|0,j[r+3]=255}return g.putImageData(i,0,0),f},generateDataTexture:function(a,b,c){var d=a*b,e=new Uint8Array(3*d),f=Math.floor(255*c.r),g=Math.floor(255*c.g);c=Math.floor(255*c.b);for(var h=0;d>h;h++)e[3*h]=f,e[3*h+1]=g,e[3*h+2]=c;return a=new THREE.DataTexture(e,a,b,THREE.RGBFormat),a.needsUpdate=!0,a}},THREE.SceneUtils={createMultiMaterialObject:function(a,b){for(var c=new THREE.Object3D,d=0,e=b.length;e>d;d++)c.add(new THREE.Mesh(a,b[d]));return c},detach:function(a,b,c){a.applyMatrix(b.matrixWorld),b.remove(a),c.add(a)},attach:function(a,b,c){var d=new THREE.Matrix4;d.getInverse(c.matrixWorld),a.applyMatrix(d),b.remove(a),c.add(a)}},THREE.FontUtils={faces:{},face:"helvetiker",weight:"normal",style:"normal",size:150,divisions:10,getFace:function(){return this.faces[this.face][this.weight][this.style]},loadFace:function(a){var b=a.familyName.toLowerCase();return this.faces[b]=this.faces[b]||{},this.faces[b][a.cssFontWeight]=this.faces[b][a.cssFontWeight]||{},this.faces[b][a.cssFontWeight][a.cssFontStyle]=a,this.faces[b][a.cssFontWeight][a.cssFontStyle]=a},drawText:function(a){var b=this.getFace(),c=this.size/b.resolution,d=0,e=String(a).split(""),f=e.length,g=[];for(a=0;f>a;a++){var h=new THREE.Path,h=this.extractGlyphPoints(e[a],b,c,d,h),d=d+h.offset;g.push(h.path)}return{paths:g,offset:d/2}},extractGlyphPoints:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q=[],r=b.glyphs[a]||b.glyphs["?"];if(r){if(r.o)for(b=r._cachedOutline||(r._cachedOutline=r.o.split(" ")),i=b.length,a=0;i>a;)switch(h=b[a++]){case"m":h=b[a++]*c+d,j=b[a++]*c,e.moveTo(h,j);break;case"l":h=b[a++]*c+d,j=b[a++]*c,e.lineTo(h,j);break;case"q":if(h=b[a++]*c+d,j=b[a++]*c,m=b[a++]*c+d,n=b[a++]*c,e.quadraticCurveTo(m,n,h,j),f=q[q.length-1])for(k=f.x,l=f.y,f=1,g=this.divisions;g>=f;f++){var s=f/g;THREE.Shape.Utils.b2(s,k,m,h),THREE.Shape.Utils.b2(s,l,n,j)}break;case"b":if(h=b[a++]*c+d,j=b[a++]*c,m=b[a++]*c+d,n=b[a++]*-c,o=b[a++]*c+d,p=b[a++]*-c,e.bezierCurveTo(h,j,m,n,o,p),f=q[q.length-1])for(k=f.x,l=f.y,f=1,g=this.divisions;g>=f;f++)s=f/g,THREE.Shape.Utils.b3(s,k,m,o,h),THREE.Shape.Utils.b3(s,l,n,p,j)}return{offset:r.ha*c,path:e}}}},THREE.FontUtils.generateShapes=function(a,b){b=b||{};var c=void 0!==b.curveSegments?b.curveSegments:4,d=void 0!==b.font?b.font:"helvetiker",e=void 0!==b.weight?b.weight:"normal",f=void 0!==b.style?b.style:"normal";for(THREE.FontUtils.size=void 0!==b.size?b.size:100,THREE.FontUtils.divisions=c,THREE.FontUtils.face=d,THREE.FontUtils.weight=e,THREE.FontUtils.style=f,c=THREE.FontUtils.drawText(a).paths,d=[],e=0,f=c.length;f>e;e++)Array.prototype.push.apply(d,c[e].toShapes());return d},function(a){var b=function(a){for(var b=a.length,c=0,d=b-1,e=0;b>e;d=e++)c+=a[d].x*a[e].y-a[e].x*a[d].y;return.5*c};return a.Triangulate=function(a,c){var d=a.length;if(3>d)return null;var e,f,g,h=[],i=[],j=[];if(0<b(a))for(f=0;d>f;f++)i[f]=f;else for(f=0;d>f;f++)i[f]=d-1-f;var k=2*d;for(f=d-1;d>2;){if(0>=k--){console.log("Warning, unable to triangulate polygon!");break}e=f,e>=d&&(e=0),f=e+1,f>=d&&(f=0),g=f+1,g>=d&&(g=0);var l;a:{var m=l=void 0,n=void 0,o=void 0,p=void 0,q=void 0,r=void 0,s=void 0,t=void 0,m=a[i[e]].x,n=a[i[e]].y,o=a[i[f]].x,p=a[i[f]].y,q=a[i[g]].x,r=a[i[g]].y;if(1e-10>(o-m)*(r-n)-(p-n)*(q-m))l=!1;else{var u=void 0,v=void 0,w=void 0,x=void 0,y=void 0,z=void 0,A=void 0,B=void 0,C=void 0,D=void 0,C=B=A=t=s=void 0,u=q-o,v=r-p,w=m-q,x=n-r,y=o-m,z=p-n;for(l=0;d>l;l++)if(s=a[i[l]].x,t=a[i[l]].y,!(s===m&&t===n||s===o&&t===p||s===q&&t===r)&&(A=s-m,B=t-n,C=s-o,D=t-p,s-=q,t-=r,C=u*D-v*C,A=y*B-z*A,B=w*t-x*s,C>=-1e-10&&B>=-1e-10&&A>=-1e-10)){l=!1;break a}l=!0}}if(l){for(h.push([a[i[e]],a[i[f]],a[i[g]]]),j.push([i[e],i[f],i[g]]),e=f,g=f+1;d>g;e++,g++)i[e]=i[g];d--,k=2*d}}return c?j:h},a.Triangulate.area=b,a}(THREE.FontUtils),self._typeface_js={faces:THREE.FontUtils.faces,loadFace:THREE.FontUtils.loadFace},THREE.typeface_js=self._typeface_js,THREE.Curve=function(){},THREE.Curve.prototype.getPoint=function(a){return console.log("Warning, getPoint() not implemented!"),null},THREE.Curve.prototype.getPointAt=function(a){return a=this.getUtoTmapping(a),this.getPoint(a)},THREE.Curve.prototype.getPoints=function(a){a||(a=5);var b,c=[];for(b=0;a>=b;b++)c.push(this.getPoint(b/a));return c},THREE.Curve.prototype.getSpacedPoints=function(a){a||(a=5);var b,c=[];for(b=0;a>=b;b++)c.push(this.getPointAt(b/a));return c},THREE.Curve.prototype.getLength=function(){var a=this.getLengths();return a[a.length-1]},THREE.Curve.prototype.getLengths=function(a){if(a||(a=this.__arcLengthDivisions?this.__arcLengthDivisions:200),this.cacheArcLengths&&this.cacheArcLengths.length==a+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var b,c,d=[],e=this.getPoint(0),f=0;for(d.push(0),c=1;a>=c;c++)b=this.getPoint(c/a),f+=b.distanceTo(e),d.push(f),e=b;return this.cacheArcLengths=d},THREE.Curve.prototype.updateArcLengths=function(){this.needsUpdate=!0,this.getLengths()},THREE.Curve.prototype.getUtoTmapping=function(a,b){var c,d=this.getLengths(),e=0,f=d.length;c=b?b:a*d[f-1];for(var g,h=0,i=f-1;i>=h;)if(e=Math.floor(h+(i-h)/2),g=d[e]-c,0>g)h=e+1;else{if(!(g>0)){i=e;break}i=e-1}return e=i,d[e]==c?e/(f-1):(h=d[e],d=(e+(c-h)/(d[e+1]-h))/(f-1))},THREE.Curve.prototype.getTangent=function(a){var b=a-1e-4;return a+=1e-4,0>b&&(b=0),a>1&&(a=1),b=this.getPoint(b),this.getPoint(a).clone().sub(b).normalize()},THREE.Curve.prototype.getTangentAt=function(a){return a=this.getUtoTmapping(a),this.getTangent(a)},THREE.Curve.Utils={tangentQuadraticBezier:function(a,b,c,d){return 2*(1-a)*(c-b)+2*a*(d-c)},tangentCubicBezier:function(a,b,c,d,e){return-3*b*(1-a)*(1-a)+3*c*(1-a)*(1-a)-6*a*c*(1-a)+6*a*d*(1-a)-3*a*a*d+3*a*a*e},tangentSpline:function(a,b,c,d,e){return 6*a*a-6*a+(3*a*a-4*a+1)+(-6*a*a+6*a)+(3*a*a-2*a)},interpolate:function(a,b,c,d,e){a=.5*(c-a),d=.5*(d-b);var f=e*e;return(2*b-2*c+a+d)*e*f+(-3*b+3*c-2*a-d)*f+a*e+b}},THREE.Curve.create=function(a,b){return a.prototype=Object.create(THREE.Curve.prototype),a.prototype.getPoint=b,a},THREE.CurvePath=function(){this.curves=[],this.bends=[],this.autoClose=!1},THREE.CurvePath.prototype=Object.create(THREE.Curve.prototype),THREE.CurvePath.prototype.add=function(a){this.curves.push(a)},THREE.CurvePath.prototype.checkConnection=function(){},THREE.CurvePath.prototype.closePath=function(){var a=this.curves[0].getPoint(0),b=this.curves[this.curves.length-1].getPoint(1);a.equals(b)||this.curves.push(new THREE.LineCurve(b,a))},THREE.CurvePath.prototype.getPoint=function(a){var b=a*this.getLength(),c=this.getCurveLengths();for(a=0;a<c.length;){if(c[a]>=b)return b=c[a]-b,a=this.curves[a],b=1-b/a.getLength(),a.getPointAt(b);a++}return null},THREE.CurvePath.prototype.getLength=function(){var a=this.getCurveLengths();return a[a.length-1]},THREE.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length)return this.cacheLengths;var a,b=[],c=0,d=this.curves.length;for(a=0;d>a;a++)c+=this.curves[a].getLength(),b.push(c);return this.cacheLengths=b},THREE.CurvePath.prototype.getBoundingBox=function(){var a,b,c,d,e,f,g=this.getPoints();a=b=Number.NEGATIVE_INFINITY,d=e=Number.POSITIVE_INFINITY;var h,i,j,k,l=g[0]instanceof THREE.Vector3;for(k=l?new THREE.Vector3:new THREE.Vector2,i=0,j=g.length;j>i;i++)h=g[i],h.x>a?a=h.x:h.x<d&&(d=h.x),h.y>b?b=h.y:h.y<e&&(e=h.y),l&&(h.z>c?c=h.z:h.z<f&&(f=h.z)),k.add(h);return g={minX:d,minY:e,maxX:a,maxY:b},l&&(g.maxZ=c,g.minZ=f),g},THREE.CurvePath.prototype.createPointsGeometry=function(a){return a=this.getPoints(a,!0),this.createGeometry(a)},THREE.CurvePath.prototype.createSpacedPointsGeometry=function(a){return a=this.getSpacedPoints(a,!0),this.createGeometry(a)},THREE.CurvePath.prototype.createGeometry=function(a){for(var b=new THREE.Geometry,c=0;c<a.length;c++)b.vertices.push(new THREE.Vector3(a[c].x,a[c].y,a[c].z||0));return b},THREE.CurvePath.prototype.addWrapPath=function(a){this.bends.push(a)},THREE.CurvePath.prototype.getTransformedPoints=function(a,b){var c,d,e=this.getPoints(a);for(b||(b=this.bends),c=0,d=b.length;d>c;c++)e=this.getWrapPoints(e,b[c]);return e},THREE.CurvePath.prototype.getTransformedSpacedPoints=function(a,b){var c,d,e=this.getSpacedPoints(a);for(b||(b=this.bends),c=0,d=b.length;d>c;c++)e=this.getWrapPoints(e,b[c]);return e},THREE.CurvePath.prototype.getWrapPoints=function(a,b){var c,d,e,f,g,h,i=this.getBoundingBox();for(c=0,d=a.length;d>c;c++)e=a[c],f=e.x,g=e.y,h=f/i.maxX,h=b.getUtoTmapping(h,f),f=b.getPoint(h),h=b.getTangent(h),h.set(-h.y,h.x).multiplyScalar(g),e.x=f.x+h.x,e.y=f.y+h.y;return a},THREE.Gyroscope=function(){THREE.Object3D.call(this)},THREE.Gyroscope.prototype=Object.create(THREE.Object3D.prototype),THREE.Gyroscope.prototype.updateMatrixWorld=function(a){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||a)&&(this.parent?(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorld.decompose(this.translationWorld,this.quaternionWorld,this.scaleWorld),this.matrix.decompose(this.translationObject,this.quaternionObject,this.scaleObject),this.matrixWorld.compose(this.translationWorld,this.quaternionObject,this.scaleWorld)):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,a=!0);for(var b=0,c=this.children.length;c>b;b++)this.children[b].updateMatrixWorld(a)},THREE.Gyroscope.prototype.translationWorld=new THREE.Vector3,THREE.Gyroscope.prototype.translationObject=new THREE.Vector3,THREE.Gyroscope.prototype.quaternionWorld=new THREE.Quaternion,THREE.Gyroscope.prototype.quaternionObject=new THREE.Quaternion,THREE.Gyroscope.prototype.scaleWorld=new THREE.Vector3,THREE.Gyroscope.prototype.scaleObject=new THREE.Vector3,THREE.Path=function(a){THREE.CurvePath.call(this),this.actions=[],a&&this.fromPoints(a)},THREE.Path.prototype=Object.create(THREE.CurvePath.prototype),THREE.PathActions={MOVE_TO:"moveTo",LINE_TO:"lineTo",QUADRATIC_CURVE_TO:"quadraticCurveTo",BEZIER_CURVE_TO:"bezierCurveTo",CSPLINE_THRU:"splineThru",ARC:"arc",ELLIPSE:"ellipse"},THREE.Path.prototype.fromPoints=function(a){this.moveTo(a[0].x,a[0].y);for(var b=1,c=a.length;c>b;b++)this.lineTo(a[b].x,a[b].y)},THREE.Path.prototype.moveTo=function(a,b){var c=Array.prototype.slice.call(arguments);this.actions.push({action:THREE.PathActions.MOVE_TO,args:c})},THREE.Path.prototype.lineTo=function(a,b){var c=Array.prototype.slice.call(arguments),d=this.actions[this.actions.length-1].args,d=new THREE.LineCurve(new THREE.Vector2(d[d.length-2],d[d.length-1]),new THREE.Vector2(a,b));this.curves.push(d),this.actions.push({action:THREE.PathActions.LINE_TO,args:c})},THREE.Path.prototype.quadraticCurveTo=function(a,b,c,d){var e=Array.prototype.slice.call(arguments),f=this.actions[this.actions.length-1].args,f=new THREE.QuadraticBezierCurve(new THREE.Vector2(f[f.length-2],f[f.length-1]),new THREE.Vector2(a,b),new THREE.Vector2(c,d));this.curves.push(f),this.actions.push({action:THREE.PathActions.QUADRATIC_CURVE_TO,args:e})},THREE.Path.prototype.bezierCurveTo=function(a,b,c,d,e,f){var g=Array.prototype.slice.call(arguments),h=this.actions[this.actions.length-1].args,h=new THREE.CubicBezierCurve(new THREE.Vector2(h[h.length-2],h[h.length-1]),new THREE.Vector2(a,b),new THREE.Vector2(c,d),new THREE.Vector2(e,f));this.curves.push(h),this.actions.push({action:THREE.PathActions.BEZIER_CURVE_TO,args:g})},THREE.Path.prototype.splineThru=function(a){var b=Array.prototype.slice.call(arguments),c=this.actions[this.actions.length-1].args,c=[new THREE.Vector2(c[c.length-2],c[c.length-1])];Array.prototype.push.apply(c,a),c=new THREE.SplineCurve(c),this.curves.push(c),this.actions.push({action:THREE.PathActions.CSPLINE_THRU,args:b})},THREE.Path.prototype.arc=function(a,b,c,d,e,f){var g=this.actions[this.actions.length-1].args;this.absarc(a+g[g.length-2],b+g[g.length-1],c,d,e,f)},THREE.Path.prototype.absarc=function(a,b,c,d,e,f){this.absellipse(a,b,c,c,d,e,f)},THREE.Path.prototype.ellipse=function(a,b,c,d,e,f,g){var h=this.actions[this.actions.length-1].args;this.absellipse(a+h[h.length-2],b+h[h.length-1],c,d,e,f,g)},THREE.Path.prototype.absellipse=function(a,b,c,d,e,f,g){var h=Array.prototype.slice.call(arguments),i=new THREE.EllipseCurve(a,b,c,d,e,f,g);this.curves.push(i),i=i.getPoint(1),h.push(i.x),h.push(i.y),this.actions.push({action:THREE.PathActions.ELLIPSE,args:h})},THREE.Path.prototype.getSpacedPoints=function(a,b){a||(a=40);for(var c=[],d=0;a>d;d++)c.push(this.getPoint(d/a));return c},THREE.Path.prototype.getPoints=function(a,b){if(this.useSpacedPoints)return console.log("tata"),this.getSpacedPoints(a,b);a=a||12;var c,d,e,f,g,h,i,j,k,l,m,n,o,p=[];for(c=0,d=this.actions.length;d>c;c++)switch(e=this.actions[c],f=e.action,e=e.args,f){case THREE.PathActions.MOVE_TO:p.push(new THREE.Vector2(e[0],e[1]));break;case THREE.PathActions.LINE_TO:p.push(new THREE.Vector2(e[0],e[1]));break;case THREE.PathActions.QUADRATIC_CURVE_TO:for(g=e[2],h=e[3],k=e[0],l=e[1],0<p.length?(f=p[p.length-1],m=f.x,n=f.y):(f=this.actions[c-1].args,m=f[f.length-2],n=f[f.length-1]),e=1;a>=e;e++)o=e/a,f=THREE.Shape.Utils.b2(o,m,k,g),o=THREE.Shape.Utils.b2(o,n,l,h),p.push(new THREE.Vector2(f,o));break;case THREE.PathActions.BEZIER_CURVE_TO:for(g=e[4],h=e[5],k=e[0],l=e[1],i=e[2],j=e[3],0<p.length?(f=p[p.length-1],m=f.x,n=f.y):(f=this.actions[c-1].args,m=f[f.length-2],n=f[f.length-1]),e=1;a>=e;e++)o=e/a,f=THREE.Shape.Utils.b3(o,m,k,i,g),o=THREE.Shape.Utils.b3(o,n,l,j,h),p.push(new THREE.Vector2(f,o));break;case THREE.PathActions.CSPLINE_THRU:for(f=this.actions[c-1].args,o=[new THREE.Vector2(f[f.length-2],f[f.length-1])],f=a*e[0].length,o=o.concat(e[0]),o=new THREE.SplineCurve(o),e=1;f>=e;e++)p.push(o.getPointAt(e/f));break;case THREE.PathActions.ARC:for(g=e[0],h=e[1],l=e[2],i=e[3],f=e[4],k=!!e[5],m=f-i,n=2*a,e=1;n>=e;e++)o=e/n,k||(o=1-o),o=i+o*m,f=g+l*Math.cos(o),o=h+l*Math.sin(o),p.push(new THREE.Vector2(f,o));break;case THREE.PathActions.ELLIPSE:for(g=e[0],h=e[1],l=e[2],j=e[3],i=e[4],f=e[5],k=!!e[6],m=f-i,n=2*a,e=1;n>=e;e++)o=e/n,k||(o=1-o),o=i+o*m,f=g+l*Math.cos(o),o=h+j*Math.sin(o),p.push(new THREE.Vector2(f,o))}return c=p[p.length-1],1e-10>Math.abs(c.x-p[0].x)&&1e-10>Math.abs(c.y-p[0].y)&&p.splice(p.length-1,1),b&&p.push(p[0]),p},THREE.Path.prototype.toShapes=function(a,b){function c(a){for(var b=[],c=0,d=a.length;d>c;c++){var e=a[c],f=new THREE.Shape;f.actions=e.actions,f.curves=e.curves,b.push(f)}return b}function d(a,b){for(var c=b.length,d=!1,e=c-1,f=0;c>f;e=f++){var g=b[e],h=b[f],i=h.x-g.x,j=h.y-g.y;if(1e-10<Math.abs(j)){if(0>j&&(g=b[f],i=-i,h=b[e],j=-j),!(a.y<g.y||a.y>h.y))if(a.y==g.y){if(a.x==g.x)return!0}else{if(e=j*(a.x-g.x)-i*(a.y-g.y),0==e)return!0;0>e||(d=!d)}}else if(a.y==g.y&&(h.x<=a.x&&a.x<=g.x||g.x<=a.x&&a.x<=h.x))return!0}return d}var e=function(a){var b,c,d,e,f=[],g=new THREE.Path;for(b=0,c=a.length;c>b;b++)d=a[b],e=d.args,d=d.action,d==THREE.PathActions.MOVE_TO&&0!=g.actions.length&&(f.push(g),g=new THREE.Path),g[d].apply(g,e);return 0!=g.actions.length&&f.push(g),f}(this.actions);if(0==e.length)return[];if(!0===b)return c(e);var f,g,h,i=[];if(1==e.length)return g=e[0],h=new THREE.Shape,h.actions=g.actions,h.curves=g.curves,i.push(h),i;var j=!THREE.Shape.Utils.isClockWise(e[0].getPoints()),j=a?!j:j;h=[];var k,l=[],m=[],n=0;l[n]=void 0,m[n]=[];var o,p;for(o=0,p=e.length;p>o;o++)g=e[o],k=g.getPoints(),f=THREE.Shape.Utils.isClockWise(k),(f=a?!f:f)?(!j&&l[n]&&n++,l[n]={s:new THREE.Shape,p:k},l[n].s.actions=g.actions,l[n].s.curves=g.curves,j&&n++,m[n]=[]):m[n].push({h:g,p:k[0]});if(!l[0])return c(e);if(1<l.length){for(o=!1,p=[],g=0,e=l.length;e>g;g++)h[g]=[];for(g=0,e=l.length;e>g;g++)for(f=m[g],j=0;j<f.length;j++){n=f[j],k=!0;for(var q=0;q<l.length;q++)d(n.p,l[q].p)&&(g!=q&&p.push({froms:g,tos:q,hole:j}),k?(k=!1,h[q].push(n)):o=!0);k&&h[g].push(n)}0<p.length&&(o||(m=h))}for(o=0,p=l.length;p>o;o++)for(h=l[o].s,i.push(h),g=m[o],e=0,f=g.length;f>e;e++)h.holes.push(g[e].h);return i},THREE.Shape=function(){THREE.Path.apply(this,arguments),this.holes=[]},THREE.Shape.prototype=Object.create(THREE.Path.prototype),THREE.Shape.prototype.extrude=function(a){return new THREE.ExtrudeGeometry(this,a)},THREE.Shape.prototype.makeGeometry=function(a){return new THREE.ShapeGeometry(this,a)},THREE.Shape.prototype.getPointsHoles=function(a){var b,c=this.holes.length,d=[];for(b=0;c>b;b++)d[b]=this.holes[b].getTransformedPoints(a,this.bends);return d},THREE.Shape.prototype.getSpacedPointsHoles=function(a){var b,c=this.holes.length,d=[];for(b=0;c>b;b++)d[b]=this.holes[b].getTransformedSpacedPoints(a,this.bends);return d},THREE.Shape.prototype.extractAllPoints=function(a){return{shape:this.getTransformedPoints(a),holes:this.getPointsHoles(a)}},THREE.Shape.prototype.extractPoints=function(a){return this.useSpacedPoints?this.extractAllSpacedPoints(a):this.extractAllPoints(a)},THREE.Shape.prototype.extractAllSpacedPoints=function(a){return{shape:this.getTransformedSpacedPoints(a),holes:this.getSpacedPointsHoles(a)}},THREE.Shape.Utils={triangulateShape:function(a,b){function c(a,b,c){return a.x!=b.x?a.x<b.x?a.x<=c.x&&c.x<=b.x:b.x<=c.x&&c.x<=a.x:a.y<b.y?a.y<=c.y&&c.y<=b.y:b.y<=c.y&&c.y<=a.y}function d(a,b,d,e,f){var g=b.x-a.x,h=b.y-a.y,i=e.x-d.x,j=e.y-d.y,k=a.x-d.x,l=a.y-d.y,m=h*i-g*j,n=h*k-g*l;if(1e-10<Math.abs(m)){if(m>0){if(0>n||n>m)return[];if(i=j*k-i*l,0>i||i>m)return[]}else{if(n>0||m>n)return[];if(i=j*k-i*l,i>0||m>i)return[]}return 0==i?!f||0!=n&&n!=m?[a]:[]:i==m?!f||0!=n&&n!=m?[b]:[]:0==n?[d]:n==m?[e]:(f=i/m,[{x:a.x+f*g,y:a.y+f*h}])}return 0!=n||j*k!=i*l?[]:(h=0==g&&0==h,i=0==i&&0==j,h&&i?a.x!=d.x||a.y!=d.y?[]:[a]:h?c(d,e,a)?[a]:[]:i?c(a,b,d)?[d]:[]:(0!=g?(a.x<b.x?(g=a,i=a.x,h=b,a=b.x):(g=b,i=b.x,h=a,a=a.x),d.x<e.x?(b=d,m=d.x,j=e,d=e.x):(b=e,m=e.x,j=d,d=d.x)):(a.y<b.y?(g=a,i=a.y,h=b,a=b.y):(g=b,i=b.y,h=a,a=a.y),d.y<e.y?(b=d,m=d.y,j=e,d=e.y):(b=e,m=e.y,j=d,d=d.y)),m>=i?m>a?[]:a==m?f?[]:[b]:d>=a?[b,h]:[b,j]:i>d?[]:i==d?f?[]:[g]:d>=a?[g,h]:[g,j]))}function e(a,b,c,d){var e=b.x-a.x,f=b.y-a.y;b=c.x-a.x,c=c.y-a.y;var g=d.x-a.x;return d=d.y-a.y,a=e*c-f*b,e=e*d-f*g,1e-10<Math.abs(a)?(b=g*c-d*b,a>0?e>=0&&b>=0:e>=0||b>=0):e>0}var f,g,h,i,j,k={};for(h=a.concat(),f=0,g=b.length;g>f;f++)Array.prototype.push.apply(h,b[f]);for(f=0,g=h.length;g>f;f++)j=h[f].x+":"+h[f].y,void 0!==k[j]&&console.log("Duplicate point",j),k[j]=f;f=function(a,b){function c(a,b){var c=q.length-1,d=a-1;0>d&&(d=c);var f=a+1;return f>c&&(f=0),(c=e(q[a],q[d],q[f],h[b]))?(c=h.length-1,d=b-1,0>d&&(d=c),f=b+1,f>c&&(f=0),!!(c=e(h[b],h[d],h[f],q[a]))):!1}function f(a,b){var c,e;for(c=0;c<q.length;c++)if(e=c+1,e%=q.length,e=d(a,b,q[c],q[e],!0),0<e.length)return!0;return!1}function g(a,c){var e,f,g,h;for(e=0;e<r.length;e++)for(f=b[r[e]],g=0;g<f.length;g++)if(h=g+1,h%=f.length,h=d(a,c,f[g],f[h],!0),0<h.length)return!0;return!1}var h,i,j,k,l,m,n,o,p,q=a.concat(),r=[],s=[],t=0;for(i=b.length;i>t;t++)r.push(t);n=0;for(var u=2*r.length;0<r.length;){if(u--,0>u){console.log("Infinite Loop! Holes left:"+r.length+", Probably Hole outside Shape!");break}for(j=n;j<q.length;j++){for(k=q[j],i=-1,t=0;t<r.length;t++)if(l=r[t],m=k.x+":"+k.y+":"+l,void 0===s[m]){for(h=b[l],o=0;o<h.length;o++)if(l=h[o],c(j,o)&&!f(k,l)&&!g(k,l)){i=o,r.splice(t,1),n=q.slice(0,j+1),l=q.slice(j),o=h.slice(i),p=h.slice(0,i+1),q=n.concat(o).concat(p).concat(l),n=j;break}if(i>=0)break;s[m]=!0}if(i>=0)break}}return q}(a,b);var l=THREE.FontUtils.Triangulate(f,!1);for(f=0,g=l.length;g>f;f++)for(i=l[f],h=0;3>h;h++)j=i[h].x+":"+i[h].y,j=k[j],void 0!==j&&(i[h]=j);return l.concat()},isClockWise:function(a){return 0>THREE.FontUtils.Triangulate.area(a)},b2p0:function(a,b){var c=1-a;return c*c*b},b2p1:function(a,b){return 2*(1-a)*a*b},b2p2:function(a,b){return a*a*b},b2:function(a,b,c,d){return this.b2p0(a,b)+this.b2p1(a,c)+this.b2p2(a,d)},b3p0:function(a,b){var c=1-a;return c*c*c*b},b3p1:function(a,b){var c=1-a;return 3*c*c*a*b},b3p2:function(a,b){return 3*(1-a)*a*a*b},b3p3:function(a,b){return a*a*a*b},b3:function(a,b,c,d,e){return this.b3p0(a,b)+this.b3p1(a,c)+this.b3p2(a,d)+this.b3p3(a,e)}},THREE.LineCurve=function(a,b){this.v1=a,this.v2=b},THREE.LineCurve.prototype=Object.create(THREE.Curve.prototype),THREE.LineCurve.prototype.getPoint=function(a){var b=this.v2.clone().sub(this.v1);return b.multiplyScalar(a).add(this.v1),b},THREE.LineCurve.prototype.getPointAt=function(a){return this.getPoint(a)},THREE.LineCurve.prototype.getTangent=function(a){return this.v2.clone().sub(this.v1).normalize()},THREE.QuadraticBezierCurve=function(a,b,c){this.v0=a,this.v1=b,this.v2=c},THREE.QuadraticBezierCurve.prototype=Object.create(THREE.Curve.prototype),THREE.QuadraticBezierCurve.prototype.getPoint=function(a){var b;return b=THREE.Shape.Utils.b2(a,this.v0.x,this.v1.x,this.v2.x),a=THREE.Shape.Utils.b2(a,this.v0.y,this.v1.y,this.v2.y),new THREE.Vector2(b,a)},THREE.QuadraticBezierCurve.prototype.getTangent=function(a){var b;return b=THREE.Curve.Utils.tangentQuadraticBezier(a,this.v0.x,this.v1.x,this.v2.x),a=THREE.Curve.Utils.tangentQuadraticBezier(a,this.v0.y,this.v1.y,this.v2.y),b=new THREE.Vector2(b,a),b.normalize(),b},THREE.CubicBezierCurve=function(a,b,c,d){this.v0=a,this.v1=b,this.v2=c,this.v3=d},THREE.CubicBezierCurve.prototype=Object.create(THREE.Curve.prototype),THREE.CubicBezierCurve.prototype.getPoint=function(a){var b;return b=THREE.Shape.Utils.b3(a,this.v0.x,this.v1.x,this.v2.x,this.v3.x),a=THREE.Shape.Utils.b3(a,this.v0.y,this.v1.y,this.v2.y,this.v3.y),new THREE.Vector2(b,a)},THREE.CubicBezierCurve.prototype.getTangent=function(a){var b;return b=THREE.Curve.Utils.tangentCubicBezier(a,this.v0.x,this.v1.x,this.v2.x,this.v3.x),a=THREE.Curve.Utils.tangentCubicBezier(a,this.v0.y,this.v1.y,this.v2.y,this.v3.y),b=new THREE.Vector2(b,a),b.normalize(),b},THREE.SplineCurve=function(a){this.points=void 0==a?[]:a},THREE.SplineCurve.prototype=Object.create(THREE.Curve.prototype),THREE.SplineCurve.prototype.getPoint=function(a){var b,c=new THREE.Vector2,d=[],e=this.points;return b=(e.length-1)*a,a=Math.floor(b),b-=a,d[0]=0==a?a:a-1,d[1]=a,d[2]=a>e.length-2?e.length-1:a+1,d[3]=a>e.length-3?e.length-1:a+2,c.x=THREE.Curve.Utils.interpolate(e[d[0]].x,e[d[1]].x,e[d[2]].x,e[d[3]].x,b),c.y=THREE.Curve.Utils.interpolate(e[d[0]].y,e[d[1]].y,e[d[2]].y,e[d[3]].y,b),c},THREE.EllipseCurve=function(a,b,c,d,e,f,g){this.aX=a,this.aY=b,this.xRadius=c,this.yRadius=d,this.aStartAngle=e,this.aEndAngle=f,this.aClockwise=g},THREE.EllipseCurve.prototype=Object.create(THREE.Curve.prototype),THREE.EllipseCurve.prototype.getPoint=function(a){var b;return b=this.aEndAngle-this.aStartAngle,0>b&&(b+=2*Math.PI),b>2*Math.PI&&(b-=2*Math.PI),b=!0===this.aClockwise?this.aEndAngle+(1-a)*(2*Math.PI-b):this.aStartAngle+a*b,a=this.aX+this.xRadius*Math.cos(b),b=this.aY+this.yRadius*Math.sin(b),new THREE.Vector2(a,b)},THREE.ArcCurve=function(a,b,c,d,e,f){THREE.EllipseCurve.call(this,a,b,c,c,d,e,f)},THREE.ArcCurve.prototype=Object.create(THREE.EllipseCurve.prototype),THREE.LineCurve3=THREE.Curve.create(function(a,b){this.v1=a,this.v2=b},function(a){var b=new THREE.Vector3;return b.subVectors(this.v2,this.v1),b.multiplyScalar(a),b.add(this.v1),b}),THREE.QuadraticBezierCurve3=THREE.Curve.create(function(a,b,c){this.v0=a,this.v1=b,this.v2=c},function(a){var b,c;return b=THREE.Shape.Utils.b2(a,this.v0.x,this.v1.x,this.v2.x),c=THREE.Shape.Utils.b2(a,this.v0.y,this.v1.y,this.v2.y),a=THREE.Shape.Utils.b2(a,this.v0.z,this.v1.z,this.v2.z),new THREE.Vector3(b,c,a)}),THREE.CubicBezierCurve3=THREE.Curve.create(function(a,b,c,d){this.v0=a,this.v1=b,this.v2=c,this.v3=d},function(a){var b,c;return b=THREE.Shape.Utils.b3(a,this.v0.x,this.v1.x,this.v2.x,this.v3.x),c=THREE.Shape.Utils.b3(a,this.v0.y,this.v1.y,this.v2.y,this.v3.y),a=THREE.Shape.Utils.b3(a,this.v0.z,this.v1.z,this.v2.z,this.v3.z),new THREE.Vector3(b,c,a)}),THREE.SplineCurve3=THREE.Curve.create(function(a){this.points=void 0==a?[]:a},function(a){var b,c=new THREE.Vector3,d=[],e=this.points;a*=e.length-1,b=Math.floor(a),a-=b,d[0]=0==b?b:b-1,d[1]=b,d[2]=b>e.length-2?e.length-1:b+1,d[3]=b>e.length-3?e.length-1:b+2,b=e[d[0]];var f=e[d[1]],g=e[d[2]],d=e[d[3]];return c.x=THREE.Curve.Utils.interpolate(b.x,f.x,g.x,d.x,a),c.y=THREE.Curve.Utils.interpolate(b.y,f.y,g.y,d.y,a),c.z=THREE.Curve.Utils.interpolate(b.z,f.z,g.z,d.z,a),c}),THREE.ClosedSplineCurve3=THREE.Curve.create(function(a){this.points=void 0==a?[]:a},function(a){var b,c=new THREE.Vector3,d=[],e=this.points;return b=(e.length-0)*a,a=Math.floor(b),b-=a,a+=a>0?0:(Math.floor(Math.abs(a)/e.length)+1)*e.length,d[0]=(a-1)%e.length,d[1]=a%e.length,d[2]=(a+1)%e.length,d[3]=(a+2)%e.length,c.x=THREE.Curve.Utils.interpolate(e[d[0]].x,e[d[1]].x,e[d[2]].x,e[d[3]].x,b),c.y=THREE.Curve.Utils.interpolate(e[d[0]].y,e[d[1]].y,e[d[2]].y,e[d[3]].y,b),
c.z=THREE.Curve.Utils.interpolate(e[d[0]].z,e[d[1]].z,e[d[2]].z,e[d[3]].z,b),c}),THREE.AnimationHandler=function(){var a=[],b={},c={update:function(b){for(var c=0;c<a.length;c++)a[c].update(b)},addToUpdate:function(b){-1===a.indexOf(b)&&a.push(b)},removeFromUpdate:function(b){b=a.indexOf(b),-1!==b&&a.splice(b,1)},add:function(a){if(void 0!==b[a.name]&&console.log("THREE.AnimationHandler.add: Warning! "+a.name+" already exists in library. Overwriting."),b[a.name]=a,!0!==a.initialized){for(var c=0;c<a.hierarchy.length;c++){for(var d=0;d<a.hierarchy[c].keys.length;d++)if(0>a.hierarchy[c].keys[d].time&&(a.hierarchy[c].keys[d].time=0),void 0!==a.hierarchy[c].keys[d].rot&&!(a.hierarchy[c].keys[d].rot instanceof THREE.Quaternion)){var e=a.hierarchy[c].keys[d].rot;a.hierarchy[c].keys[d].rot=(new THREE.Quaternion).fromArray(e)}if(a.hierarchy[c].keys.length&&void 0!==a.hierarchy[c].keys[0].morphTargets){for(e={},d=0;d<a.hierarchy[c].keys.length;d++)for(var f=0;f<a.hierarchy[c].keys[d].morphTargets.length;f++){var g=a.hierarchy[c].keys[d].morphTargets[f];e[g]=-1}for(a.hierarchy[c].usedMorphTargets=e,d=0;d<a.hierarchy[c].keys.length;d++){var h={};for(g in e){for(f=0;f<a.hierarchy[c].keys[d].morphTargets.length;f++)if(a.hierarchy[c].keys[d].morphTargets[f]===g){h[g]=a.hierarchy[c].keys[d].morphTargetsInfluences[f];break}f===a.hierarchy[c].keys[d].morphTargets.length&&(h[g]=0)}a.hierarchy[c].keys[d].morphTargetsInfluences=h}}for(d=1;d<a.hierarchy[c].keys.length;d++)a.hierarchy[c].keys[d].time===a.hierarchy[c].keys[d-1].time&&(a.hierarchy[c].keys.splice(d,1),d--);for(d=0;d<a.hierarchy[c].keys.length;d++)a.hierarchy[c].keys[d].index=d}a.initialized=!0}},remove:function(a){void 0===b[a]&&console.log("THREE.AnimationHandler.add: Warning! "+a+" doesn't exists in library. Doing nothing."),b[a]=void 0},get:function(a){return"string"==typeof a?b[a]?b[a]:null:void 0},parse:function(a){var b=[];if(a instanceof THREE.SkinnedMesh)for(var c=0;c<a.skeleton.bones.length;c++)b.push(a.skeleton.bones[c]);else d(a,b);return b}},d=function(a,b){b.push(a);for(var c=0;c<a.children.length;c++)d(a.children[c],b)};return c.LINEAR=0,c.CATMULLROM=1,c.CATMULLROM_FORWARD=2,c}(),THREE.Animation=function(a,b){this.root=a,this.data=THREE.AnimationHandler.get(b),this.hierarchy=THREE.AnimationHandler.parse(a),this.currentTime=0,this.timeScale=1,this.isPlaying=!1,this.loop=this.isPaused=!0,this.weight=0,this.interpolationType=THREE.AnimationHandler.LINEAR},THREE.Animation.prototype.keyTypes=["pos","rot","scl"],THREE.Animation.prototype.play=function(a,b){this.currentTime=void 0!==a?a:0,this.weight=void 0!==b?b:1,this.isPlaying=!0,this.isPaused=!1,this.reset(),THREE.AnimationHandler.addToUpdate(this)},THREE.Animation.prototype.pause=function(){!0===this.isPaused?THREE.AnimationHandler.addToUpdate(this):THREE.AnimationHandler.removeFromUpdate(this),this.isPaused=!this.isPaused},THREE.Animation.prototype.stop=function(){this.isPaused=this.isPlaying=!1,THREE.AnimationHandler.removeFromUpdate(this)},THREE.Animation.prototype.reset=function(){for(var a=0,b=this.hierarchy.length;b>a;a++){var c=this.hierarchy[a];c.matrixAutoUpdate=!0,void 0===c.animationCache&&(c.animationCache={}),void 0===c.animationCache[this.data.name]&&(c.animationCache[this.data.name]={},c.animationCache[this.data.name].prevKey={pos:0,rot:0,scl:0},c.animationCache[this.data.name].nextKey={pos:0,rot:0,scl:0},c.animationCache[this.data.name].originalMatrix=c instanceof THREE.Bone?c.skinMatrix:c.matrix);for(var c=c.animationCache[this.data.name],d=0;3>d;d++){for(var e=this.keyTypes[d],f=this.data.hierarchy[a].keys[0],g=this.getNextKeyWith(e,a,1);g.time<this.currentTime&&g.index>f.index;)f=g,g=this.getNextKeyWith(e,a,g.index+1);c.prevKey[e]=f,c.nextKey[e]=g}}},THREE.Animation.prototype.update=function(){var a=[],b=new THREE.Vector3,c=new THREE.Vector3,d=new THREE.Quaternion,e=function(a,b){var c,d,e,g,h,i,j=[],k=[];return c=(a.length-1)*b,d=Math.floor(c),c-=d,j[0]=0===d?d:d-1,j[1]=d,j[2]=d>a.length-2?d:d+1,j[3]=d>a.length-3?d:d+2,d=a[j[0]],g=a[j[1]],h=a[j[2]],i=a[j[3]],j=c*c,e=c*j,k[0]=f(d[0],g[0],h[0],i[0],c,j,e),k[1]=f(d[1],g[1],h[1],i[1],c,j,e),k[2]=f(d[2],g[2],h[2],i[2],c,j,e),k},f=function(a,b,c,d,e,f,g){return a=.5*(c-a),d=.5*(d-b),(2*(b-c)+a+d)*g+(-3*(b-c)-2*a-d)*f+a*e+b};return function(f){if(!1!==this.isPlaying&&(this.currentTime+=f*this.timeScale,0!==this.weight)){var g;if(f=this.data.length,!0===this.loop&&this.currentTime>f)this.currentTime%=f,this.reset();else if(!1===this.loop&&this.currentTime>f)return void this.stop();f=0;for(var h=this.hierarchy.length;h>f;f++)for(var i=this.hierarchy[f],j=i.animationCache[this.data.name],k=0;3>k;k++){g=this.keyTypes[k];var l=j.prevKey[g],m=j.nextKey[g];if(m.time<=this.currentTime){for(l=this.data.hierarchy[f].keys[0],m=this.getNextKeyWith(g,f,1);m.time<this.currentTime&&m.index>l.index;)l=m,m=this.getNextKeyWith(g,f,m.index+1);j.prevKey[g]=l,j.nextKey[g]=m}i.matrixAutoUpdate=!0,i.matrixWorldNeedsUpdate=!0;var n=(this.currentTime-l.time)/(m.time-l.time),o=l[g],p=m[g];0>n&&(n=0),n>1&&(n=1),"pos"===g?(g=i.position,this.interpolationType===THREE.AnimationHandler.LINEAR?(c.x=o[0]+(p[0]-o[0])*n,c.y=o[1]+(p[1]-o[1])*n,c.z=o[2]+(p[2]-o[2])*n,i instanceof THREE.Bone&&(l=this.weight/(this.weight+i.accumulatedPosWeight),g.lerp(c,l),i.accumulatedPosWeight+=this.weight)):this.interpolationType!==THREE.AnimationHandler.CATMULLROM&&this.interpolationType!==THREE.AnimationHandler.CATMULLROM_FORWARD||(a[0]=this.getPrevKeyWith("pos",f,l.index-1).pos,a[1]=o,a[2]=p,a[3]=this.getNextKeyWith("pos",f,m.index+1).pos,n=.33*n+.33,m=e(a,n),i instanceof THREE.Bone?(l=this.weight/(this.weight+i.accumulatedPosWeight),i.accumulatedPosWeight+=this.weight):l=1,g.x+=(m[0]-g.x)*l,g.y+=(m[1]-g.y)*l,g.z+=(m[2]-g.z)*l,this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD&&(n=e(a,1.01*n),b.set(n[0],n[1],n[2]),b.sub(g),b.y=0,b.normalize(),g=Math.atan2(b.x,b.z),i.rotation.set(0,g,0)))):"rot"===g?(THREE.Quaternion.slerp(o,p,d,n),i instanceof THREE.Bone?0===i.accumulatedRotWeight?(i.quaternion.copy(d),i.accumulatedRotWeight=this.weight):(l=this.weight/(this.weight+i.accumulatedRotWeight),THREE.Quaternion.slerp(i.quaternion,d,i.quaternion,l),i.accumulatedRotWeight+=this.weight):i.quaternion.copy(d)):"scl"===g&&(g=i.scale,c.x=o[0]+(p[0]-o[0])*n,c.y=o[1]+(p[1]-o[1])*n,c.z=o[2]+(p[2]-o[2])*n,i instanceof THREE.Bone&&(l=this.weight/(this.weight+i.accumulatedSclWeight),g.lerp(c,l),i.accumulatedSclWeight+=this.weight))}return!0}}}(),THREE.Animation.prototype.getNextKeyWith=function(a,b,c){var d=this.data.hierarchy[b].keys;for(c=this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD?c<d.length-1?c:d.length-1:c%d.length;c<d.length;c++)if(void 0!==d[c][a])return d[c];return this.data.hierarchy[b].keys[0]},THREE.Animation.prototype.getPrevKeyWith=function(a,b,c){var d=this.data.hierarchy[b].keys;for(c=this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD?c>0?c:0:c>=0?c:c+d.length;c>=0;c--)if(void 0!==d[c][a])return d[c];return this.data.hierarchy[b].keys[d.length-1]},THREE.KeyFrameAnimation=function(a,b){this.root=a,this.data=THREE.AnimationHandler.get(b),this.hierarchy=THREE.AnimationHandler.parse(a),this.currentTime=0,this.timeScale=.001,this.isPlaying=!1,this.loop=this.isPaused=!0;for(var c=0,d=this.hierarchy.length;d>c;c++){var e=this.data.hierarchy[c].sids,f=this.hierarchy[c];if(this.data.hierarchy[c].keys.length&&e){for(var g=0;g<e.length;g++){var h=e[g],i=this.getNextKeyWith(h,c,0);i&&i.apply(h)}f.matrixAutoUpdate=!1,this.data.hierarchy[c].node.updateMatrix(),f.matrixWorldNeedsUpdate=!0}}},THREE.KeyFrameAnimation.prototype.play=function(a){if(this.currentTime=void 0!==a?a:0,!1===this.isPlaying){this.isPlaying=!0;var b,c,d=this.hierarchy.length;for(a=0;d>a;a++)b=this.hierarchy[a],c=this.data.hierarchy[a],void 0===c.animationCache&&(c.animationCache={},c.animationCache.prevKey=null,c.animationCache.nextKey=null,c.animationCache.originalMatrix=b instanceof THREE.Bone?b.skinMatrix:b.matrix),b=this.data.hierarchy[a].keys,b.length&&(c.animationCache.prevKey=b[0],c.animationCache.nextKey=b[1],this.startTime=Math.min(b[0].time,this.startTime),this.endTime=Math.max(b[b.length-1].time,this.endTime));this.update(0)}this.isPaused=!1,THREE.AnimationHandler.addToUpdate(this)},THREE.KeyFrameAnimation.prototype.pause=function(){this.isPaused?THREE.AnimationHandler.addToUpdate(this):THREE.AnimationHandler.removeFromUpdate(this),this.isPaused=!this.isPaused},THREE.KeyFrameAnimation.prototype.stop=function(){this.isPaused=this.isPlaying=!1,THREE.AnimationHandler.removeFromUpdate(this);for(var a=0;a<this.data.hierarchy.length;a++){var b=this.hierarchy[a],c=this.data.hierarchy[a];if(void 0!==c.animationCache){var d=c.animationCache.originalMatrix;b instanceof THREE.Bone?(d.copy(b.skinMatrix),b.skinMatrix=d):(d.copy(b.matrix),b.matrix=d),delete c.animationCache}}},THREE.KeyFrameAnimation.prototype.update=function(a){if(!1!==this.isPlaying){this.currentTime+=a*this.timeScale,a=this.data.length,!0===this.loop&&this.currentTime>a&&(this.currentTime%=a),this.currentTime=Math.min(this.currentTime,a),a=0;for(var b=this.hierarchy.length;b>a;a++){var c=this.hierarchy[a],d=this.data.hierarchy[a],e=d.keys,d=d.animationCache;if(e.length){var f=d.prevKey,g=d.nextKey;if(g.time<=this.currentTime){for(;g.time<this.currentTime&&g.index>f.index;)f=g,g=e[f.index+1];d.prevKey=f,d.nextKey=g}g.time>=this.currentTime?f.interpolate(g,this.currentTime):f.interpolate(g,g.time),this.data.hierarchy[a].node.updateMatrix(),c.matrixWorldNeedsUpdate=!0}}}},THREE.KeyFrameAnimation.prototype.getNextKeyWith=function(a,b,c){for(b=this.data.hierarchy[b].keys,c%=b.length;c<b.length;c++)if(b[c].hasTarget(a))return b[c];return b[0]},THREE.KeyFrameAnimation.prototype.getPrevKeyWith=function(a,b,c){for(b=this.data.hierarchy[b].keys,c=c>=0?c:c+b.length;c>=0;c--)if(b[c].hasTarget(a))return b[c];return b[b.length-1]},THREE.MorphAnimation=function(a){this.mesh=a,this.frames=a.morphTargetInfluences.length,this.currentTime=0,this.duration=1e3,this.loop=!0,this.isPlaying=!1},THREE.MorphAnimation.prototype={play:function(){this.isPlaying=!0},pause:function(){this.isPlaying=!1},update:function(){var a=0,b=0;return function(c){if(!1!==this.isPlaying){this.currentTime+=c,!0===this.loop&&this.currentTime>this.duration&&(this.currentTime%=this.duration),this.currentTime=Math.min(this.currentTime,this.duration),c=this.duration/this.frames;var d=Math.floor(this.currentTime/c);d!=b&&(this.mesh.morphTargetInfluences[a]=0,this.mesh.morphTargetInfluences[b]=1,this.mesh.morphTargetInfluences[d]=0,a=b,b=d),this.mesh.morphTargetInfluences[d]=this.currentTime%c/c,this.mesh.morphTargetInfluences[a]=1-this.mesh.morphTargetInfluences[d]}}}()},THREE.CubeCamera=function(a,b,c){THREE.Object3D.call(this);var d=new THREE.PerspectiveCamera(90,1,a,b);d.up.set(0,-1,0),d.lookAt(new THREE.Vector3(1,0,0)),this.add(d);var e=new THREE.PerspectiveCamera(90,1,a,b);e.up.set(0,-1,0),e.lookAt(new THREE.Vector3(-1,0,0)),this.add(e);var f=new THREE.PerspectiveCamera(90,1,a,b);f.up.set(0,0,1),f.lookAt(new THREE.Vector3(0,1,0)),this.add(f);var g=new THREE.PerspectiveCamera(90,1,a,b);g.up.set(0,0,-1),g.lookAt(new THREE.Vector3(0,-1,0)),this.add(g);var h=new THREE.PerspectiveCamera(90,1,a,b);h.up.set(0,-1,0),h.lookAt(new THREE.Vector3(0,0,1)),this.add(h);var i=new THREE.PerspectiveCamera(90,1,a,b);i.up.set(0,-1,0),i.lookAt(new THREE.Vector3(0,0,-1)),this.add(i),this.renderTarget=new THREE.WebGLRenderTargetCube(c,c,{format:THREE.RGBFormat,magFilter:THREE.LinearFilter,minFilter:THREE.LinearFilter}),this.updateCubeMap=function(a,b){var c=this.renderTarget,j=c.generateMipmaps;c.generateMipmaps=!1,c.activeCubeFace=0,a.render(b,d,c),c.activeCubeFace=1,a.render(b,e,c),c.activeCubeFace=2,a.render(b,f,c),c.activeCubeFace=3,a.render(b,g,c),c.activeCubeFace=4,a.render(b,h,c),c.generateMipmaps=j,c.activeCubeFace=5,a.render(b,i,c)}},THREE.CubeCamera.prototype=Object.create(THREE.Object3D.prototype),THREE.CombinedCamera=function(a,b,c,d,e,f,g){THREE.Camera.call(this),this.fov=c,this.left=-a/2,this.right=a/2,this.top=b/2,this.bottom=-b/2,this.cameraO=new THREE.OrthographicCamera(a/-2,a/2,b/2,b/-2,f,g),this.cameraP=new THREE.PerspectiveCamera(c,a/b,d,e),this.zoom=1,this.toPerspective()},THREE.CombinedCamera.prototype=Object.create(THREE.Camera.prototype),THREE.CombinedCamera.prototype.toPerspective=function(){this.near=this.cameraP.near,this.far=this.cameraP.far,this.cameraP.fov=this.fov/this.zoom,this.cameraP.updateProjectionMatrix(),this.projectionMatrix=this.cameraP.projectionMatrix,this.inPerspectiveMode=!0,this.inOrthographicMode=!1},THREE.CombinedCamera.prototype.toOrthographic=function(){var a=this.cameraP.aspect,b=(this.cameraP.near+this.cameraP.far)/2,b=Math.tan(this.fov/2)*b,a=2*b*a/2,b=b/this.zoom,a=a/this.zoom;this.cameraO.left=-a,this.cameraO.right=a,this.cameraO.top=b,this.cameraO.bottom=-b,this.cameraO.updateProjectionMatrix(),this.near=this.cameraO.near,this.far=this.cameraO.far,this.projectionMatrix=this.cameraO.projectionMatrix,this.inPerspectiveMode=!1,this.inOrthographicMode=!0},THREE.CombinedCamera.prototype.setSize=function(a,b){this.cameraP.aspect=a/b,this.left=-a/2,this.right=a/2,this.top=b/2,this.bottom=-b/2},THREE.CombinedCamera.prototype.setFov=function(a){this.fov=a,this.inPerspectiveMode?this.toPerspective():this.toOrthographic()},THREE.CombinedCamera.prototype.updateProjectionMatrix=function(){this.inPerspectiveMode?this.toPerspective():(this.toPerspective(),this.toOrthographic())},THREE.CombinedCamera.prototype.setLens=function(a,b){void 0===b&&(b=24);var c=2*THREE.Math.radToDeg(Math.atan(b/(2*a)));return this.setFov(c),c},THREE.CombinedCamera.prototype.setZoom=function(a){this.zoom=a,this.inPerspectiveMode?this.toPerspective():this.toOrthographic()},THREE.CombinedCamera.prototype.toFrontView=function(){this.rotation.x=0,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toBackView=function(){this.rotation.x=0,this.rotation.y=Math.PI,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toLeftView=function(){this.rotation.x=0,this.rotation.y=-Math.PI/2,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toRightView=function(){this.rotation.x=0,this.rotation.y=Math.PI/2,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toTopView=function(){this.rotation.x=-Math.PI/2,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toBottomView=function(){this.rotation.x=Math.PI/2,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.BoxGeometry=function(a,b,c,d,e,f){function g(a,b,c,d,e,f,g,i){var j,k=h.widthSegments,l=h.heightSegments,m=e/2,n=f/2,o=h.vertices.length;"x"===a&&"y"===b||"y"===a&&"x"===b?j="z":"x"===a&&"z"===b||"z"===a&&"x"===b?(j="y",l=h.depthSegments):("z"===a&&"y"===b||"y"===a&&"z"===b)&&(j="x",k=h.depthSegments);var p=k+1,q=l+1,r=e/k,s=f/l,t=new THREE.Vector3;for(t[j]=g>0?1:-1,e=0;q>e;e++)for(f=0;p>f;f++){var u=new THREE.Vector3;u[a]=(f*r-m)*c,u[b]=(e*s-n)*d,u[j]=g,h.vertices.push(u)}for(e=0;l>e;e++)for(f=0;k>f;f++)n=f+p*e,a=f+p*(e+1),b=f+1+p*(e+1),c=f+1+p*e,d=new THREE.Vector2(f/k,1-e/l),g=new THREE.Vector2(f/k,1-(e+1)/l),j=new THREE.Vector2((f+1)/k,1-(e+1)/l),m=new THREE.Vector2((f+1)/k,1-e/l),n=new THREE.Face3(n+o,a+o,c+o),n.normal.copy(t),n.vertexNormals.push(t.clone(),t.clone(),t.clone()),n.materialIndex=i,h.faces.push(n),h.faceVertexUvs[0].push([d,g,m]),n=new THREE.Face3(a+o,b+o,c+o),n.normal.copy(t),n.vertexNormals.push(t.clone(),t.clone(),t.clone()),n.materialIndex=i,h.faces.push(n),h.faceVertexUvs[0].push([g.clone(),j,m.clone()])}THREE.Geometry.call(this),this.parameters={width:a,height:b,depth:c,widthSegments:d,heightSegments:e,depthSegments:f},this.widthSegments=d||1,this.heightSegments=e||1,this.depthSegments=f||1;var h=this;d=a/2,e=b/2,f=c/2,g("z","y",-1,-1,c,b,d,0),g("z","y",1,-1,c,b,-d,1),g("x","z",1,1,a,c,e,2),g("x","z",1,-1,a,c,-e,3),g("x","y",1,-1,a,b,f,4),g("x","y",-1,-1,a,b,-f,5),this.mergeVertices()},THREE.BoxGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.CircleGeometry=function(a,b,c,d){THREE.Geometry.call(this),this.parameters={radius:a,segments:b,thetaStart:c,thetaLength:d},a=a||50,b=void 0!==b?Math.max(3,b):8,c=void 0!==c?c:0,d=void 0!==d?d:2*Math.PI;var e,f=[];e=new THREE.Vector3;var g=new THREE.Vector2(.5,.5);for(this.vertices.push(e),f.push(g),e=0;b>=e;e++){var h=new THREE.Vector3,i=c+e/b*d;h.x=a*Math.cos(i),h.y=a*Math.sin(i),this.vertices.push(h),f.push(new THREE.Vector2((h.x/a+1)/2,(h.y/a+1)/2))}for(c=new THREE.Vector3(0,0,1),e=1;b>=e;e++)this.faces.push(new THREE.Face3(e,e+1,0,[c.clone(),c.clone(),c.clone()])),this.faceVertexUvs[0].push([f[e].clone(),f[e+1].clone(),g.clone()]);this.computeFaceNormals(),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,a)},THREE.CircleGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.CubeGeometry=function(a,b,c,d,e,f){return console.warn("DEPRECATED: THREE.CubeGeometry is deprecated. Use THREE.BoxGeometry instead."),new THREE.BoxGeometry(a,b,c,d,e,f)},THREE.CylinderGeometry=function(a,b,c,d,e,f){THREE.Geometry.call(this),this.parameters={radiusTop:a,radiusBottom:b,height:c,radialSegments:d,heightSegments:e,openEnded:f},a=void 0!==a?a:20,b=void 0!==b?b:20,c=void 0!==c?c:100,d=d||8,e=e||1,f=void 0!==f?f:!1;var g,h,i=c/2,j=[],k=[];for(h=0;e>=h;h++){var l=[],m=[],n=h/e,o=n*(b-a)+a;for(g=0;d>=g;g++){var p=g/d,q=new THREE.Vector3;q.x=o*Math.sin(p*Math.PI*2),q.y=-n*c+i,q.z=o*Math.cos(p*Math.PI*2),this.vertices.push(q),l.push(this.vertices.length-1),m.push(new THREE.Vector2(p,1-n))}j.push(l),k.push(m)}for(c=(b-a)/c,g=0;d>g;g++)for(0!==a?(l=this.vertices[j[0][g]].clone(),m=this.vertices[j[0][g+1]].clone()):(l=this.vertices[j[1][g]].clone(),m=this.vertices[j[1][g+1]].clone()),l.setY(Math.sqrt(l.x*l.x+l.z*l.z)*c).normalize(),m.setY(Math.sqrt(m.x*m.x+m.z*m.z)*c).normalize(),h=0;e>h;h++){var n=j[h][g],o=j[h+1][g],p=j[h+1][g+1],q=j[h][g+1],r=l.clone(),s=l.clone(),t=m.clone(),u=m.clone(),v=k[h][g].clone(),w=k[h+1][g].clone(),x=k[h+1][g+1].clone(),y=k[h][g+1].clone();this.faces.push(new THREE.Face3(n,o,q,[r,s,u])),this.faceVertexUvs[0].push([v,w,y]),this.faces.push(new THREE.Face3(o,p,q,[s.clone(),t,u.clone()])),this.faceVertexUvs[0].push([w.clone(),x,y.clone()])}if(!1===f&&a>0)for(this.vertices.push(new THREE.Vector3(0,i,0)),g=0;d>g;g++)n=j[0][g],o=j[0][g+1],p=this.vertices.length-1,r=new THREE.Vector3(0,1,0),s=new THREE.Vector3(0,1,0),t=new THREE.Vector3(0,1,0),v=k[0][g].clone(),w=k[0][g+1].clone(),x=new THREE.Vector2(w.x,0),this.faces.push(new THREE.Face3(n,o,p,[r,s,t])),this.faceVertexUvs[0].push([v,w,x]);if(!1===f&&b>0)for(this.vertices.push(new THREE.Vector3(0,-i,0)),g=0;d>g;g++)n=j[h][g+1],o=j[h][g],p=this.vertices.length-1,r=new THREE.Vector3(0,-1,0),s=new THREE.Vector3(0,-1,0),t=new THREE.Vector3(0,-1,0),v=k[h][g+1].clone(),w=k[h][g].clone(),x=new THREE.Vector2(w.x,1),this.faces.push(new THREE.Face3(n,o,p,[r,s,t])),this.faceVertexUvs[0].push([v,w,x]);this.computeFaceNormals()},THREE.CylinderGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.ExtrudeGeometry=function(a,b){"undefined"!=typeof a&&(THREE.Geometry.call(this),a=a instanceof Array?a:[a],this.shapebb=a[a.length-1].getBoundingBox(),this.addShapeList(a,b),this.computeFaceNormals())},THREE.ExtrudeGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.ExtrudeGeometry.prototype.addShapeList=function(a,b){for(var c=a.length,d=0;c>d;d++)this.addShape(a[d],b)},THREE.ExtrudeGeometry.prototype.addShape=function(a,b){function c(a,b,c){return b||console.log("die"),b.clone().multiplyScalar(c).add(a)}function d(a,b,c){var d=THREE.Math.sign,e=1,e=a.x-b.x,f=a.y-b.y,g=c.x-a.x,h=c.y-a.y,i=e*e+f*f;if(1e-10<Math.abs(e*h-f*g)){var j=Math.sqrt(i),d=Math.sqrt(g*g+h*h),i=b.x-f/j;if(b=b.y+e/j,g=((c.x-h/d-i)*h-(c.y+g/d-b)*g)/(e*h-f*g),c=i+e*g-a.x,a=b+f*g-a.y,e=c*c+a*a,2>=e)return new THREE.Vector2(c,a);e=Math.sqrt(e/2)}else a=!1,e>1e-10?g>1e-10&&(a=!0):-1e-10>e?-1e-10>g&&(a=!0):d(f)==d(h)&&(a=!0),a?(c=-f,a=e,e=Math.sqrt(i)):(c=e,a=f,e=Math.sqrt(i/2));return new THREE.Vector2(c/e,a/e)}function e(c,d){var e,f;for(O=c.length;0<=--O;){e=O,f=O-1,0>f&&(f=c.length-1);for(var g=0,h=s+2*p,g=0;h>g;g++){var i=M*g,j=M*(g+1),k=d+e+i,i=d+f+i,l=d+f+j,j=d+e+j,m=c,n=g,o=h,q=e,r=f,k=k+C,i=i+C,l=l+C,j=j+C;B.faces.push(new THREE.Face3(k,i,j,null,null,w)),B.faces.push(new THREE.Face3(i,l,j,null,null,w)),k=x.generateSideWallUV(B,a,m,b,k,i,l,j,n,o,q,r),B.faceVertexUvs[0].push([k[0],k[1],k[3]]),B.faceVertexUvs[0].push([k[1],k[2],k[3]])}}}function f(a,b,c){B.vertices.push(new THREE.Vector3(a,b,c))}function g(c,d,e,f){c+=C,d+=C,e+=C,B.faces.push(new THREE.Face3(c,d,e,null,null,v)),c=f?x.generateBottomUV(B,a,b,c,d,e):x.generateTopUV(B,a,b,c,d,e),B.faceVertexUvs[0].push(c)}var h,i,j,k,l,m=void 0!==b.amount?b.amount:100,n=void 0!==b.bevelThickness?b.bevelThickness:6,o=void 0!==b.bevelSize?b.bevelSize:n-2,p=void 0!==b.bevelSegments?b.bevelSegments:3,q=void 0!==b.bevelEnabled?b.bevelEnabled:!0,r=void 0!==b.curveSegments?b.curveSegments:12,s=void 0!==b.steps?b.steps:1,t=b.extrudePath,u=!1,v=b.material,w=b.extrudeMaterial,x=void 0!==b.UVGenerator?b.UVGenerator:THREE.ExtrudeGeometry.WorldUVGenerator;t&&(h=t.getSpacedPoints(s),u=!0,q=!1,i=void 0!==b.frames?b.frames:new THREE.TubeGeometry.FrenetFrames(t,s,!1),j=new THREE.Vector3,k=new THREE.Vector3,l=new THREE.Vector3),q||(o=n=p=0);var y,z,A,B=this,C=this.vertices.length,t=a.extractPoints(r),r=t.shape,D=t.holes;if(t=!THREE.Shape.Utils.isClockWise(r)){for(r=r.reverse(),z=0,A=D.length;A>z;z++)y=D[z],THREE.Shape.Utils.isClockWise(y)&&(D[z]=y.reverse());t=!1}var E=THREE.Shape.Utils.triangulateShape(r,D),F=r;for(z=0,A=D.length;A>z;z++)y=D[z],r=r.concat(y);var G,H,I,J,K,L,M=r.length,N=E.length,t=[],O=0;for(I=F.length,G=I-1,H=O+1;I>O;O++,G++,H++)G===I&&(G=0),H===I&&(H=0),t[O]=d(F[O],F[G],F[H]);var P,Q=[],R=t.concat();for(z=0,A=D.length;A>z;z++){for(y=D[z],P=[],O=0,I=y.length,G=I-1,H=O+1;I>O;O++,G++,H++)G===I&&(G=0),H===I&&(H=0),P[O]=d(y[O],y[G],y[H]);Q.push(P),R=R.concat(P)}for(G=0;p>G;G++){for(I=G/p,J=n*(1-I),H=o*Math.sin(I*Math.PI/2),O=0,I=F.length;I>O;O++)K=c(F[O],t[O],H),f(K.x,K.y,-J);for(z=0,A=D.length;A>z;z++)for(y=D[z],P=Q[z],O=0,I=y.length;I>O;O++)K=c(y[O],P[O],H),f(K.x,K.y,-J)}for(H=o,O=0;M>O;O++)K=q?c(r[O],R[O],H):r[O],u?(k.copy(i.normals[0]).multiplyScalar(K.x),j.copy(i.binormals[0]).multiplyScalar(K.y),l.copy(h[0]).add(k).add(j),f(l.x,l.y,l.z)):f(K.x,K.y,0);for(I=1;s>=I;I++)for(O=0;M>O;O++)K=q?c(r[O],R[O],H):r[O],u?(k.copy(i.normals[I]).multiplyScalar(K.x),j.copy(i.binormals[I]).multiplyScalar(K.y),l.copy(h[I]).add(k).add(j),f(l.x,l.y,l.z)):f(K.x,K.y,m/s*I);for(G=p-1;G>=0;G--){for(I=G/p,J=n*(1-I),H=o*Math.sin(I*Math.PI/2),O=0,I=F.length;I>O;O++)K=c(F[O],t[O],H),f(K.x,K.y,m+J);for(z=0,A=D.length;A>z;z++)for(y=D[z],P=Q[z],O=0,I=y.length;I>O;O++)K=c(y[O],P[O],H),u?f(K.x,K.y+h[s-1].y,h[s-1].x+J):f(K.x,K.y,m+J)}!function(){if(q){var a;for(a=0*M,O=0;N>O;O++)L=E[O],g(L[2]+a,L[1]+a,L[0]+a,!0);for(a=s+2*p,a*=M,O=0;N>O;O++)L=E[O],g(L[0]+a,L[1]+a,L[2]+a,!1)}else{for(O=0;N>O;O++)L=E[O],g(L[2],L[1],L[0],!0);for(O=0;N>O;O++)L=E[O],g(L[0]+M*s,L[1]+M*s,L[2]+M*s,!1)}}(),function(){var a=0;for(e(F,a),a+=F.length,z=0,A=D.length;A>z;z++)y=D[z],e(y,a),a+=y.length}()},THREE.ExtrudeGeometry.WorldUVGenerator={generateTopUV:function(a,b,c,d,e,f){return b=a.vertices[e].x,e=a.vertices[e].y,c=a.vertices[f].x,f=a.vertices[f].y,[new THREE.Vector2(a.vertices[d].x,a.vertices[d].y),new THREE.Vector2(b,e),new THREE.Vector2(c,f)]},generateBottomUV:function(a,b,c,d,e,f){return this.generateTopUV(a,b,c,d,e,f)},generateSideWallUV:function(a,b,c,d,e,f,g,h,i,j,k,l){b=a.vertices[e].x,c=a.vertices[e].y,e=a.vertices[e].z,d=a.vertices[f].x,i=a.vertices[f].y,f=a.vertices[f].z,j=a.vertices[g].x,k=a.vertices[g].y,g=a.vertices[g].z,l=a.vertices[h].x;var m=a.vertices[h].y;return a=a.vertices[h].z,.01>Math.abs(c-i)?[new THREE.Vector2(b,1-e),new THREE.Vector2(d,1-f),new THREE.Vector2(j,1-g),new THREE.Vector2(l,1-a)]:[new THREE.Vector2(c,1-e),new THREE.Vector2(i,1-f),new THREE.Vector2(k,1-g),new THREE.Vector2(m,1-a)]}},THREE.ExtrudeGeometry.__v1=new THREE.Vector2,THREE.ExtrudeGeometry.__v2=new THREE.Vector2,THREE.ExtrudeGeometry.__v3=new THREE.Vector2,THREE.ExtrudeGeometry.__v4=new THREE.Vector2,THREE.ExtrudeGeometry.__v5=new THREE.Vector2,THREE.ExtrudeGeometry.__v6=new THREE.Vector2,THREE.ShapeGeometry=function(a,b){THREE.Geometry.call(this),!1==a instanceof Array&&(a=[a]),this.shapebb=a[a.length-1].getBoundingBox(),this.addShapeList(a,b),this.computeFaceNormals()},THREE.ShapeGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.ShapeGeometry.prototype.addShapeList=function(a,b){for(var c=0,d=a.length;d>c;c++)this.addShape(a[c],b);return this},THREE.ShapeGeometry.prototype.addShape=function(a,b){void 0===b&&(b={});var c,d,e,f=b.material,g=void 0===b.UVGenerator?THREE.ExtrudeGeometry.WorldUVGenerator:b.UVGenerator,h=this.vertices.length;c=a.extractPoints(void 0!==b.curveSegments?b.curveSegments:12);var i=c.shape,j=c.holes;if(!THREE.Shape.Utils.isClockWise(i))for(i=i.reverse(),c=0,d=j.length;d>c;c++)e=j[c],THREE.Shape.Utils.isClockWise(e)&&(j[c]=e.reverse());var k=THREE.Shape.Utils.triangulateShape(i,j);for(c=0,d=j.length;d>c;c++)e=j[c],i=i.concat(e);for(j=i.length,d=k.length,c=0;j>c;c++)e=i[c],this.vertices.push(new THREE.Vector3(e.x,e.y,0));for(c=0;d>c;c++)j=k[c],i=j[0]+h,e=j[1]+h,j=j[2]+h,this.faces.push(new THREE.Face3(i,e,j,null,null,f)),this.faceVertexUvs[0].push(g.generateBottomUV(this,a,b,i,e,j))},THREE.LatheGeometry=function(a,b,c,d){THREE.Geometry.call(this),b=b||12,c=c||0,d=d||2*Math.PI;for(var e=1/(a.length-1),f=1/b,g=0,h=b;h>=g;g++)for(var i=c+g*f*d,j=Math.cos(i),k=Math.sin(i),i=0,l=a.length;l>i;i++){var m=a[i],n=new THREE.Vector3;n.x=j*m.x-k*m.y,n.y=k*m.x+j*m.y,n.z=m.z,this.vertices.push(n)}for(c=a.length,g=0,h=b;h>g;g++)for(i=0,l=a.length-1;l>i;i++){b=k=i+c*g,d=k+c;var j=k+1+c,k=k+1,m=g*f,n=i*e,o=m+f,p=n+e;this.faces.push(new THREE.Face3(b,d,k)),this.faceVertexUvs[0].push([new THREE.Vector2(m,n),new THREE.Vector2(o,n),new THREE.Vector2(m,p)]),this.faces.push(new THREE.Face3(d,j,k)),this.faceVertexUvs[0].push([new THREE.Vector2(o,n),new THREE.Vector2(o,p),new THREE.Vector2(m,p)])}this.mergeVertices(),this.computeFaceNormals(),this.computeVertexNormals()},THREE.LatheGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.PlaneGeometry=function(a,b,c,d){THREE.Geometry.call(this),this.parameters={width:a,height:b,widthSegments:c,heightSegments:d};var e=a/2,f=b/2;c=c||1,d=d||1;var g=c+1,h=d+1,i=a/c,j=b/d,k=new THREE.Vector3(0,0,1);for(a=0;h>a;a++){var l=a*j-f;for(b=0;g>b;b++)this.vertices.push(new THREE.Vector3(b*i-e,-l,0))}for(a=0;d>a;a++)for(b=0;c>b;b++){var m=b+g*a,e=b+g*(a+1),f=b+1+g*(a+1),h=b+1+g*a,i=new THREE.Vector2(b/c,1-a/d),j=new THREE.Vector2(b/c,1-(a+1)/d),l=new THREE.Vector2((b+1)/c,1-(a+1)/d),n=new THREE.Vector2((b+1)/c,1-a/d),m=new THREE.Face3(m,e,h);m.normal.copy(k),m.vertexNormals.push(k.clone(),k.clone(),k.clone()),this.faces.push(m),this.faceVertexUvs[0].push([i,j,n]),m=new THREE.Face3(e,f,h),m.normal.copy(k),m.vertexNormals.push(k.clone(),k.clone(),k.clone()),this.faces.push(m),this.faceVertexUvs[0].push([j.clone(),l,n.clone()])}},THREE.PlaneGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.RingGeometry=function(a,b,c,d,e,f){THREE.Geometry.call(this),a=a||0,b=b||50,e=void 0!==e?e:0,f=void 0!==f?f:2*Math.PI,c=void 0!==c?Math.max(3,c):8,d=void 0!==d?Math.max(3,d):8;var g,h=[],i=a,j=(b-a)/d;for(a=0;d>=a;a++){for(g=0;c>=g;g++){var k=new THREE.Vector3,l=e+g/c*f;k.x=i*Math.cos(l),k.y=i*Math.sin(l),this.vertices.push(k),h.push(new THREE.Vector2((k.x/b+1)/2,(k.y/b+1)/2))}i+=j}for(b=new THREE.Vector3(0,0,1),a=0;d>a;a++)for(e=a*c,g=0;c>=g;g++)l=g+e,f=l+a,j=l+c+a,k=l+c+1+a,this.faces.push(new THREE.Face3(f,j,k,[b.clone(),b.clone(),b.clone()])),this.faceVertexUvs[0].push([h[f].clone(),h[j].clone(),h[k].clone()]),f=l+a,j=l+c+1+a,k=l+1+a,this.faces.push(new THREE.Face3(f,j,k,[b.clone(),b.clone(),b.clone()])),this.faceVertexUvs[0].push([h[f].clone(),h[j].clone(),h[k].clone()]);this.computeFaceNormals(),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,i)},THREE.RingGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.SphereGeometry=function(a,b,c,d,e,f,g){THREE.Geometry.call(this),this.parameters={radius:a,widthSegments:b,heightSegments:c,phiStart:d,phiLength:e,thetaStart:f,thetaLength:g},a=a||50,b=Math.max(3,Math.floor(b)||8),c=Math.max(2,Math.floor(c)||6),d=void 0!==d?d:0,e=void 0!==e?e:2*Math.PI,f=void 0!==f?f:0,g=void 0!==g?g:Math.PI;var h,i,j=[],k=[];for(i=0;c>=i;i++){var l=[],m=[];for(h=0;b>=h;h++){var n=h/b,o=i/c,p=new THREE.Vector3;p.x=-a*Math.cos(d+n*e)*Math.sin(f+o*g),p.y=a*Math.cos(f+o*g),p.z=a*Math.sin(d+n*e)*Math.sin(f+o*g),this.vertices.push(p),l.push(this.vertices.length-1),m.push(new THREE.Vector2(n,1-o))}j.push(l),k.push(m)}for(i=0;c>i;i++)for(h=0;b>h;h++){d=j[i][h+1],e=j[i][h],f=j[i+1][h],g=j[i+1][h+1];var l=this.vertices[d].clone().normalize(),m=this.vertices[e].clone().normalize(),n=this.vertices[f].clone().normalize(),o=this.vertices[g].clone().normalize(),p=k[i][h+1].clone(),q=k[i][h].clone(),r=k[i+1][h].clone(),s=k[i+1][h+1].clone();Math.abs(this.vertices[d].y)===a?(p.x=(p.x+q.x)/2,this.faces.push(new THREE.Face3(d,f,g,[l,n,o])),this.faceVertexUvs[0].push([p,r,s])):Math.abs(this.vertices[f].y)===a?(r.x=(r.x+s.x)/2,this.faces.push(new THREE.Face3(d,e,f,[l,m,n])),this.faceVertexUvs[0].push([p,q,r])):(this.faces.push(new THREE.Face3(d,e,g,[l,m,o])),this.faceVertexUvs[0].push([p,q,s]),this.faces.push(new THREE.Face3(e,f,g,[m.clone(),n,o.clone()])),this.faceVertexUvs[0].push([q.clone(),r,s.clone()]))}this.computeFaceNormals(),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,a)},THREE.SphereGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.TextGeometry=function(a,b){b=b||{};var c=THREE.FontUtils.generateShapes(a,b);b.amount=void 0!==b.height?b.height:50,void 0===b.bevelThickness&&(b.bevelThickness=10),void 0===b.bevelSize&&(b.bevelSize=8),void 0===b.bevelEnabled&&(b.bevelEnabled=!1),THREE.ExtrudeGeometry.call(this,c,b)},THREE.TextGeometry.prototype=Object.create(THREE.ExtrudeGeometry.prototype),THREE.TorusGeometry=function(a,b,c,d,e){THREE.Geometry.call(this),this.parameters={radius:a,tube:b,radialSegments:c,tubularSegments:d,arc:e},a=a||100,b=b||40,c=c||8,d=d||6,e=e||2*Math.PI;for(var f=new THREE.Vector3,g=[],h=[],i=0;c>=i;i++)for(var j=0;d>=j;j++){var k=j/d*e,l=i/c*Math.PI*2;f.x=a*Math.cos(k),f.y=a*Math.sin(k);var m=new THREE.Vector3;m.x=(a+b*Math.cos(l))*Math.cos(k),m.y=(a+b*Math.cos(l))*Math.sin(k),m.z=b*Math.sin(l),this.vertices.push(m),g.push(new THREE.Vector2(j/d,i/c)),h.push(m.clone().sub(f).normalize())}for(i=1;c>=i;i++)for(j=1;d>=j;j++)a=(d+1)*i+j-1,b=(d+1)*(i-1)+j-1,e=(d+1)*(i-1)+j,f=(d+1)*i+j,k=new THREE.Face3(a,b,f,[h[a].clone(),h[b].clone(),h[f].clone()]),this.faces.push(k),this.faceVertexUvs[0].push([g[a].clone(),g[b].clone(),g[f].clone()]),k=new THREE.Face3(b,e,f,[h[b].clone(),h[e].clone(),h[f].clone()]),this.faces.push(k),this.faceVertexUvs[0].push([g[b].clone(),g[e].clone(),g[f].clone()]);this.computeFaceNormals()},THREE.TorusGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.TorusKnotGeometry=function(a,b,c,d,e,f,g){function h(a,b,c,d,e){var f=Math.cos(a),g=Math.sin(a);return a*=b/c,b=Math.cos(a),f*=d*(2+b)*.5,g=d*(2+b)*g*.5,d=e*d*Math.sin(a)*.5,new THREE.Vector3(f,g,d)}THREE.Geometry.call(this),this.parameters={radius:a,tube:b,radialSegments:c,tubularSegments:d,p:e,q:f,heightScale:g},a=a||100,b=b||40,c=c||64,d=d||8,e=e||2,f=f||3,g=g||1;for(var i=Array(c),j=new THREE.Vector3,k=new THREE.Vector3,l=new THREE.Vector3,m=0;c>m;++m){i[m]=Array(d);var n=m/c*2*e*Math.PI,o=h(n,f,e,a,g),n=h(n+.01,f,e,a,g);for(j.subVectors(n,o),k.addVectors(n,o),l.crossVectors(j,k),k.crossVectors(l,j),
l.normalize(),k.normalize(),n=0;d>n;++n){var p=n/d*2*Math.PI,q=-b*Math.cos(p),p=b*Math.sin(p),r=new THREE.Vector3;r.x=o.x+q*k.x+p*l.x,r.y=o.y+q*k.y+p*l.y,r.z=o.z+q*k.z+p*l.z,i[m][n]=this.vertices.push(r)-1}}for(m=0;c>m;++m)for(n=0;d>n;++n)e=(m+1)%c,f=(n+1)%d,a=i[m][n],b=i[e][n],e=i[e][f],f=i[m][f],g=new THREE.Vector2(m/c,n/d),j=new THREE.Vector2((m+1)/c,n/d),k=new THREE.Vector2((m+1)/c,(n+1)/d),l=new THREE.Vector2(m/c,(n+1)/d),this.faces.push(new THREE.Face3(a,b,f)),this.faceVertexUvs[0].push([g,j,l]),this.faces.push(new THREE.Face3(b,e,f)),this.faceVertexUvs[0].push([j.clone(),k,l.clone()]);this.computeFaceNormals(),this.computeVertexNormals()},THREE.TorusKnotGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.TubeGeometry=function(a,b,c,d,e){THREE.Geometry.call(this),this.parameters={path:a,segments:b,radius:c,radialSegments:d,closed:e},b=b||64,c=c||1,d=d||8,e=e||!1;var f,g,h,i,j,k,l,m,n,o=[],p=b+1,q=new THREE.Vector3;for(l=new THREE.TubeGeometry.FrenetFrames(a,b,e),m=l.normals,n=l.binormals,this.tangents=l.tangents,this.normals=m,this.binormals=n,l=0;p>l;l++)for(o[l]=[],h=l/(p-1),k=a.getPointAt(h),f=m[l],g=n[l],h=0;d>h;h++)i=h/d*2*Math.PI,j=-c*Math.cos(i),i=c*Math.sin(i),q.copy(k),q.x+=j*f.x+i*g.x,q.y+=j*f.y+i*g.y,q.z+=j*f.z+i*g.z,o[l][h]=this.vertices.push(new THREE.Vector3(q.x,q.y,q.z))-1;for(l=0;b>l;l++)for(h=0;d>h;h++)p=e?(l+1)%b:l+1,q=(h+1)%d,a=o[l][h],c=o[p][h],p=o[p][q],q=o[l][q],m=new THREE.Vector2(l/b,h/d),n=new THREE.Vector2((l+1)/b,h/d),f=new THREE.Vector2((l+1)/b,(h+1)/d),g=new THREE.Vector2(l/b,(h+1)/d),this.faces.push(new THREE.Face3(a,c,q)),this.faceVertexUvs[0].push([m,n,g]),this.faces.push(new THREE.Face3(c,p,q)),this.faceVertexUvs[0].push([n.clone(),f,g.clone()]);this.computeFaceNormals(),this.computeVertexNormals()},THREE.TubeGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.TubeGeometry.FrenetFrames=function(a,b,c){new THREE.Vector3;var d=new THREE.Vector3;new THREE.Vector3;var e=[],f=[],g=[],h=new THREE.Vector3,i=new THREE.Matrix4;b+=1;var j,k,l;for(this.tangents=e,this.normals=f,this.binormals=g,j=0;b>j;j++)k=j/(b-1),e[j]=a.getTangentAt(k),e[j].normalize();for(f[0]=new THREE.Vector3,g[0]=new THREE.Vector3,a=Number.MAX_VALUE,j=Math.abs(e[0].x),k=Math.abs(e[0].y),l=Math.abs(e[0].z),a>=j&&(a=j,d.set(1,0,0)),a>=k&&(a=k,d.set(0,1,0)),a>=l&&d.set(0,0,1),h.crossVectors(e[0],d).normalize(),f[0].crossVectors(e[0],h),g[0].crossVectors(e[0],f[0]),j=1;b>j;j++)f[j]=f[j-1].clone(),g[j]=g[j-1].clone(),h.crossVectors(e[j-1],e[j]),1e-4<h.length()&&(h.normalize(),d=Math.acos(THREE.Math.clamp(e[j-1].dot(e[j]),-1,1)),f[j].applyMatrix4(i.makeRotationAxis(h,d))),g[j].crossVectors(e[j],f[j]);if(c)for(d=Math.acos(THREE.Math.clamp(f[0].dot(f[b-1]),-1,1)),d/=b-1,0<e[0].dot(h.crossVectors(f[0],f[b-1]))&&(d=-d),j=1;b>j;j++)f[j].applyMatrix4(i.makeRotationAxis(e[j],d*j)),g[j].crossVectors(e[j],f[j])},THREE.PolyhedronGeometry=function(a,b,c,d){function e(a){var b=a.normalize().clone();b.index=i.vertices.push(b)-1;var c=Math.atan2(a.z,-a.x)/2/Math.PI+.5;return a=Math.atan2(-a.y,Math.sqrt(a.x*a.x+a.z*a.z))/Math.PI+.5,b.uv=new THREE.Vector2(c,1-a),b}function f(a,b,c){var d=new THREE.Face3(a.index,b.index,c.index,[a.clone(),b.clone(),c.clone()]);i.faces.push(d),q.copy(a).add(b).add(c).divideScalar(3),d=Math.atan2(q.z,-q.x),i.faceVertexUvs[0].push([h(a.uv,a,d),h(b.uv,b,d),h(c.uv,c,d)])}function g(a,b){var c=Math.pow(2,b);Math.pow(4,b);for(var d=e(i.vertices[a.a]),g=e(i.vertices[a.b]),h=e(i.vertices[a.c]),j=[],k=0;c>=k;k++){j[k]=[];for(var l=e(d.clone().lerp(h,k/c)),m=e(g.clone().lerp(h,k/c)),n=c-k,o=0;n>=o;o++)j[k][o]=0==o&&k==c?l:e(l.clone().lerp(m,o/n))}for(k=0;c>k;k++)for(o=0;2*(c-k)-1>o;o++)d=Math.floor(o/2),0==o%2?f(j[k][d+1],j[k+1][d],j[k][d]):f(j[k][d+1],j[k+1][d+1],j[k+1][d])}function h(a,b,c){return 0>c&&1===a.x&&(a=new THREE.Vector2(a.x-1,a.y)),0===b.x&&0===b.z&&(a=new THREE.Vector2(c/2/Math.PI+.5,a.y)),a.clone()}THREE.Geometry.call(this),c=c||1,d=d||0;for(var i=this,j=0,k=a.length;k>j;j+=3)e(new THREE.Vector3(a[j],a[j+1],a[j+2]));a=this.vertices;for(var l=[],m=j=0,k=b.length;k>j;j+=3,m++){var n=a[b[j]],o=a[b[j+1]],p=a[b[j+2]];l[m]=new THREE.Face3(n.index,o.index,p.index,[n.clone(),o.clone(),p.clone()])}for(var q=new THREE.Vector3,j=0,k=l.length;k>j;j++)g(l[j],d);for(j=0,k=this.faceVertexUvs[0].length;k>j;j++)b=this.faceVertexUvs[0][j],d=b[0].x,a=b[1].x,l=b[2].x,m=Math.max(d,Math.max(a,l)),n=Math.min(d,Math.min(a,l)),m>.9&&.1>n&&(.2>d&&(b[0].x+=1),.2>a&&(b[1].x+=1),.2>l&&(b[2].x+=1));for(j=0,k=this.vertices.length;k>j;j++)this.vertices[j].multiplyScalar(c);this.mergeVertices(),this.computeFaceNormals(),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,c)},THREE.PolyhedronGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.IcosahedronGeometry=function(a,b){this.parameters={radius:a,detail:b};var c=(1+Math.sqrt(5))/2;THREE.PolyhedronGeometry.call(this,[-1,c,0,1,c,0,-1,-c,0,1,-c,0,0,-1,c,0,1,c,0,-1,-c,0,1,-c,c,0,-1,c,0,1,-c,0,-1,-c,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],a,b)},THREE.IcosahedronGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.OctahedronGeometry=function(a,b){this.parameters={radius:a,detail:b},THREE.PolyhedronGeometry.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],a,b)},THREE.OctahedronGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.TetrahedronGeometry=function(a,b){THREE.PolyhedronGeometry.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],a,b)},THREE.TetrahedronGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.ParametricGeometry=function(a,b,c){THREE.Geometry.call(this);var d,e,f,g,h=this.vertices,i=this.faces,j=this.faceVertexUvs[0],k=b+1;for(d=0;c>=d;d++)for(g=d/c,e=0;b>=e;e++)f=e/b,f=a(f,g),h.push(f);var l,m,n,o;for(d=0;c>d;d++)for(e=0;b>e;e++)a=d*k+e,h=d*k+e+1,g=(d+1)*k+e+1,f=(d+1)*k+e,l=new THREE.Vector2(e/b,d/c),m=new THREE.Vector2((e+1)/b,d/c),n=new THREE.Vector2((e+1)/b,(d+1)/c),o=new THREE.Vector2(e/b,(d+1)/c),i.push(new THREE.Face3(a,h,f)),j.push([l,m,o]),i.push(new THREE.Face3(h,g,f)),j.push([m.clone(),n,o.clone()]);this.computeFaceNormals(),this.computeVertexNormals()},THREE.ParametricGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.AxisHelper=function(a){a=a||1;var b=new THREE.Geometry;b.vertices.push(new THREE.Vector3,new THREE.Vector3(a,0,0),new THREE.Vector3,new THREE.Vector3(0,a,0),new THREE.Vector3,new THREE.Vector3(0,0,a)),b.colors.push(new THREE.Color(16711680),new THREE.Color(16755200),new THREE.Color(65280),new THREE.Color(11206400),new THREE.Color(255),new THREE.Color(43775)),a=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors}),THREE.Line.call(this,b,a,THREE.LinePieces)},THREE.AxisHelper.prototype=Object.create(THREE.Line.prototype),THREE.ArrowHelper=function(a,b,c,d,e,f){THREE.Object3D.call(this),void 0===d&&(d=16776960),void 0===c&&(c=1),void 0===e&&(e=.2*c),void 0===f&&(f=.2*e),this.position=b,b=new THREE.Geometry,b.vertices.push(new THREE.Vector3(0,0,0)),b.vertices.push(new THREE.Vector3(0,1,0)),this.line=new THREE.Line(b,new THREE.LineBasicMaterial({color:d})),this.line.matrixAutoUpdate=!1,this.add(this.line),b=new THREE.CylinderGeometry(0,.5,1,5,1),b.applyMatrix((new THREE.Matrix4).makeTranslation(0,-.5,0)),this.cone=new THREE.Mesh(b,new THREE.MeshBasicMaterial({color:d})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(a),this.setLength(c,e,f)},THREE.ArrowHelper.prototype=Object.create(THREE.Object3D.prototype),THREE.ArrowHelper.prototype.setDirection=function(){var a,b=new THREE.Vector3;return function(c){.99999<c.y?this.quaternion.set(0,0,0,1):-.99999>c.y?this.quaternion.set(1,0,0,0):(b.set(c.z,0,-c.x).normalize(),a=Math.acos(c.y),this.quaternion.setFromAxisAngle(b,a))}}(),THREE.ArrowHelper.prototype.setLength=function(a,b,c){void 0===b&&(b=.2*a),void 0===c&&(c=.2*b),this.line.scale.set(1,a,1),this.line.updateMatrix(),this.cone.scale.set(c,b,c),this.cone.position.y=a,this.cone.updateMatrix()},THREE.ArrowHelper.prototype.setColor=function(a){this.line.material.color.set(a),this.cone.material.color.set(a)},THREE.BoxHelper=function(a){var b=[new THREE.Vector3(1,1,1),new THREE.Vector3(-1,1,1),new THREE.Vector3(-1,-1,1),new THREE.Vector3(1,-1,1),new THREE.Vector3(1,1,-1),new THREE.Vector3(-1,1,-1),new THREE.Vector3(-1,-1,-1),new THREE.Vector3(1,-1,-1)];this.vertices=b;var c=new THREE.Geometry;c.vertices.push(b[0],b[1],b[1],b[2],b[2],b[3],b[3],b[0],b[4],b[5],b[5],b[6],b[6],b[7],b[7],b[4],b[0],b[4],b[1],b[5],b[2],b[6],b[3],b[7]),THREE.Line.call(this,c,new THREE.LineBasicMaterial({color:16776960}),THREE.LinePieces),void 0!==a&&this.update(a)},THREE.BoxHelper.prototype=Object.create(THREE.Line.prototype),THREE.BoxHelper.prototype.update=function(a){var b=a.geometry;null===b.boundingBox&&b.computeBoundingBox();var c=b.boundingBox.min,b=b.boundingBox.max,d=this.vertices;d[0].set(b.x,b.y,b.z),d[1].set(c.x,b.y,b.z),d[2].set(c.x,c.y,b.z),d[3].set(b.x,c.y,b.z),d[4].set(b.x,b.y,c.z),d[5].set(c.x,b.y,c.z),d[6].set(c.x,c.y,c.z),d[7].set(b.x,c.y,c.z),this.geometry.computeBoundingSphere(),this.geometry.verticesNeedUpdate=!0,this.matrixAutoUpdate=!1,this.matrixWorld=a.matrixWorld},THREE.BoundingBoxHelper=function(a,b){var c=void 0!==b?b:8947848;this.object=a,this.box=new THREE.Box3,THREE.Mesh.call(this,new THREE.BoxGeometry(1,1,1),new THREE.MeshBasicMaterial({color:c,wireframe:!0}))},THREE.BoundingBoxHelper.prototype=Object.create(THREE.Mesh.prototype),THREE.BoundingBoxHelper.prototype.update=function(){this.box.setFromObject(this.object),this.box.size(this.scale),this.box.center(this.position)},THREE.CameraHelper=function(a){function b(a,b,d){c(a,d),c(b,d)}function c(a,b){d.vertices.push(new THREE.Vector3),d.colors.push(new THREE.Color(b)),void 0===f[a]&&(f[a]=[]),f[a].push(d.vertices.length-1)}var d=new THREE.Geometry,e=new THREE.LineBasicMaterial({color:16777215,vertexColors:THREE.FaceColors}),f={};b("n1","n2",16755200),b("n2","n4",16755200),b("n4","n3",16755200),b("n3","n1",16755200),b("f1","f2",16755200),b("f2","f4",16755200),b("f4","f3",16755200),b("f3","f1",16755200),b("n1","f1",16755200),b("n2","f2",16755200),b("n3","f3",16755200),b("n4","f4",16755200),b("p","n1",16711680),b("p","n2",16711680),b("p","n3",16711680),b("p","n4",16711680),b("u1","u2",43775),b("u2","u3",43775),b("u3","u1",43775),b("c","t",16777215),b("p","c",3355443),b("cn1","cn2",3355443),b("cn3","cn4",3355443),b("cf1","cf2",3355443),b("cf3","cf4",3355443),THREE.Line.call(this,d,e,THREE.LinePieces),this.camera=a,this.matrixWorld=a.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=f,this.update()},THREE.CameraHelper.prototype=Object.create(THREE.Line.prototype),THREE.CameraHelper.prototype.update=function(){var a=new THREE.Vector3,b=new THREE.Camera,c=new THREE.Projector;return function(){function d(d,f,g,h){if(a.set(f,g,h),c.unprojectVector(a,b),d=e.pointMap[d],void 0!==d)for(f=0,g=d.length;g>f;f++)e.geometry.vertices[d[f]].copy(a)}var e=this;b.projectionMatrix.copy(this.camera.projectionMatrix),d("c",0,0,-1),d("t",0,0,1),d("n1",-1,-1,-1),d("n2",1,-1,-1),d("n3",-1,1,-1),d("n4",1,1,-1),d("f1",-1,-1,1),d("f2",1,-1,1),d("f3",-1,1,1),d("f4",1,1,1),d("u1",.7,1.1,-1),d("u2",-.7,1.1,-1),d("u3",0,2,-1),d("cf1",-1,0,1),d("cf2",1,0,1),d("cf3",0,-1,1),d("cf4",0,1,1),d("cn1",-1,0,-1),d("cn2",1,0,-1),d("cn3",0,-1,-1),d("cn4",0,1,-1),this.geometry.verticesNeedUpdate=!0}}(),THREE.DirectionalLightHelper=function(a,b){THREE.Object3D.call(this),this.light=a,this.light.updateMatrixWorld(),this.matrixWorld=a.matrixWorld,this.matrixAutoUpdate=!1,b=b||1;var c=new THREE.Geometry;c.vertices.push(new THREE.Vector3(-b,b,0),new THREE.Vector3(b,b,0),new THREE.Vector3(b,-b,0),new THREE.Vector3(-b,-b,0),new THREE.Vector3(-b,b,0));var d=new THREE.LineBasicMaterial({fog:!1});d.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.lightPlane=new THREE.Line(c,d),this.add(this.lightPlane),c=new THREE.Geometry,c.vertices.push(new THREE.Vector3,new THREE.Vector3),d=new THREE.LineBasicMaterial({fog:!1}),d.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.targetLine=new THREE.Line(c,d),this.add(this.targetLine),this.update()},THREE.DirectionalLightHelper.prototype=Object.create(THREE.Object3D.prototype),THREE.DirectionalLightHelper.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},THREE.DirectionalLightHelper.prototype.update=function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Vector3;return function(){a.setFromMatrixPosition(this.light.matrixWorld),b.setFromMatrixPosition(this.light.target.matrixWorld),c.subVectors(b,a),this.lightPlane.lookAt(c),this.lightPlane.material.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.targetLine.geometry.vertices[1].copy(c),this.targetLine.geometry.verticesNeedUpdate=!0,this.targetLine.material.color.copy(this.lightPlane.material.color)}}(),THREE.EdgesHelper=function(a,b){var c=void 0!==b?b:16777215,d=[0,0],e={},f=function(a,b){return a-b},g=["a","b","c"],h=new THREE.BufferGeometry,i=a.geometry.clone();i.mergeVertices(),i.computeFaceNormals();for(var j=i.vertices,i=i.faces,k=0,l=0,m=i.length;m>l;l++)for(var n=i[l],o=0;3>o;o++){d[0]=n[g[o]],d[1]=n[g[(o+1)%3]],d.sort(f);var p=d.toString();void 0===e[p]?(e[p]={vert1:d[0],vert2:d[1],face1:l,face2:void 0},k++):e[p].face2=l}h.addAttribute("position",new THREE.Float32Attribute(2*k,3)),d=h.attributes.position.array,f=0;for(p in e)g=e[p],(void 0===g.face2||.9999>i[g.face1].normal.dot(i[g.face2].normal))&&(k=j[g.vert1],d[f++]=k.x,d[f++]=k.y,d[f++]=k.z,k=j[g.vert2],d[f++]=k.x,d[f++]=k.y,d[f++]=k.z);THREE.Line.call(this,h,new THREE.LineBasicMaterial({color:c}),THREE.LinePieces),this.matrixAutoUpdate=!1,this.matrixWorld=a.matrixWorld},THREE.EdgesHelper.prototype=Object.create(THREE.Line.prototype),THREE.FaceNormalsHelper=function(a,b,c,d){this.object=a,this.size=void 0!==b?b:1,a=void 0!==c?c:16776960,d=void 0!==d?d:1,b=new THREE.Geometry,c=0;for(var e=this.object.geometry.faces.length;e>c;c++)b.vertices.push(new THREE.Vector3,new THREE.Vector3);THREE.Line.call(this,b,new THREE.LineBasicMaterial({color:a,linewidth:d}),THREE.LinePieces),this.matrixAutoUpdate=!1,this.normalMatrix=new THREE.Matrix3,this.update()},THREE.FaceNormalsHelper.prototype=Object.create(THREE.Line.prototype),THREE.FaceNormalsHelper.prototype.update=function(){var a=this.geometry.vertices,b=this.object,c=b.geometry.vertices,d=b.geometry.faces,e=b.matrixWorld;b.updateMatrixWorld(!0),this.normalMatrix.getNormalMatrix(e);for(var f=b=0,g=d.length;g>b;b++,f+=2){var h=d[b];a[f].copy(c[h.a]).add(c[h.b]).add(c[h.c]).divideScalar(3).applyMatrix4(e),a[f+1].copy(h.normal).applyMatrix3(this.normalMatrix).normalize().multiplyScalar(this.size).add(a[f])}return this.geometry.verticesNeedUpdate=!0,this},THREE.GridHelper=function(a,b){var c=new THREE.Geometry,d=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors});this.color1=new THREE.Color(4473924),this.color2=new THREE.Color(8947848);for(var e=-a;a>=e;e+=b){c.vertices.push(new THREE.Vector3(-a,0,e),new THREE.Vector3(a,0,e),new THREE.Vector3(e,0,-a),new THREE.Vector3(e,0,a));var f=0===e?this.color1:this.color2;c.colors.push(f,f,f,f)}THREE.Line.call(this,c,d,THREE.LinePieces)},THREE.GridHelper.prototype=Object.create(THREE.Line.prototype),THREE.GridHelper.prototype.setColors=function(a,b){this.color1.set(a),this.color2.set(b),this.geometry.colorsNeedUpdate=!0},THREE.HemisphereLightHelper=function(a,b,c,d){for(THREE.Object3D.call(this),this.light=a,this.light.updateMatrixWorld(),this.matrixWorld=a.matrixWorld,this.matrixAutoUpdate=!1,this.colors=[new THREE.Color,new THREE.Color],a=new THREE.SphereGeometry(b,4,2),a.applyMatrix((new THREE.Matrix4).makeRotationX(-Math.PI/2)),b=0;8>b;b++)a.faces[b].color=this.colors[4>b?0:1];b=new THREE.MeshBasicMaterial({vertexColors:THREE.FaceColors,wireframe:!0}),this.lightSphere=new THREE.Mesh(a,b),this.add(this.lightSphere),this.update()},THREE.HemisphereLightHelper.prototype=Object.create(THREE.Object3D.prototype),THREE.HemisphereLightHelper.prototype.dispose=function(){this.lightSphere.geometry.dispose(),this.lightSphere.material.dispose()},THREE.HemisphereLightHelper.prototype.update=function(){var a=new THREE.Vector3;return function(){this.colors[0].copy(this.light.color).multiplyScalar(this.light.intensity),this.colors[1].copy(this.light.groundColor).multiplyScalar(this.light.intensity),this.lightSphere.lookAt(a.setFromMatrixPosition(this.light.matrixWorld).negate()),this.lightSphere.geometry.colorsNeedUpdate=!0}}(),THREE.PointLightHelper=function(a,b){this.light=a,this.light.updateMatrixWorld();var c=new THREE.SphereGeometry(b,4,2),d=new THREE.MeshBasicMaterial({wireframe:!0,fog:!1});d.color.copy(this.light.color).multiplyScalar(this.light.intensity),THREE.Mesh.call(this,c,d),this.matrixWorld=this.light.matrixWorld,this.matrixAutoUpdate=!1},THREE.PointLightHelper.prototype=Object.create(THREE.Mesh.prototype),THREE.PointLightHelper.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},THREE.PointLightHelper.prototype.update=function(){this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)},THREE.SkeletonHelper=function(a){for(var b=a.skeleton,c=new THREE.Geometry,d=0;d<b.bones.length;d++)b.bones[d].parent instanceof THREE.Bone&&(c.vertices.push(new THREE.Vector3),c.vertices.push(new THREE.Vector3),c.colors.push(new THREE.Color(0,0,1)),c.colors.push(new THREE.Color(0,1,0)));d=new THREE.LineBasicMaterial({vertexColors:!0,depthTest:!1,depthWrite:!1,transparent:!0}),THREE.Line.call(this,c,d,THREE.LinePieces),this.skeleton=b,this.matrixWorld=a.matrixWorld,this.matrixAutoUpdate=!1,this.update()},THREE.SkeletonHelper.prototype=Object.create(THREE.Line.prototype),THREE.SkeletonHelper.prototype.update=function(){for(var a=this.geometry,b=0,c=0;c<this.skeleton.bones.length;c++){var d=this.skeleton.bones[c];d.parent instanceof THREE.Bone&&(a.vertices[b].setFromMatrixPosition(d.skinMatrix),a.vertices[b+1].setFromMatrixPosition(d.parent.skinMatrix),b+=2)}a.verticesNeedUpdate=!0,a.computeBoundingSphere()},THREE.SpotLightHelper=function(a){THREE.Object3D.call(this),this.light=a,this.light.updateMatrixWorld(),this.matrixWorld=a.matrixWorld,this.matrixAutoUpdate=!1,a=new THREE.CylinderGeometry(0,1,1,8,1,!0),a.applyMatrix((new THREE.Matrix4).makeTranslation(0,-.5,0)),a.applyMatrix((new THREE.Matrix4).makeRotationX(-Math.PI/2));var b=new THREE.MeshBasicMaterial({wireframe:!0,fog:!1});this.cone=new THREE.Mesh(a,b),this.add(this.cone),this.update()},THREE.SpotLightHelper.prototype=Object.create(THREE.Object3D.prototype),THREE.SpotLightHelper.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},THREE.SpotLightHelper.prototype.update=function(){var a=new THREE.Vector3,b=new THREE.Vector3;return function(){var c=this.light.distance?this.light.distance:1e4,d=c*Math.tan(this.light.angle);this.cone.scale.set(d,d,c),a.setFromMatrixPosition(this.light.matrixWorld),b.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(b.sub(a)),this.cone.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)}}(),THREE.VertexNormalsHelper=function(a,b,c,d){this.object=a,this.size=void 0!==b?b:1,b=void 0!==c?c:16711680,d=void 0!==d?d:1,c=new THREE.Geometry,a=a.geometry.faces;for(var e=0,f=a.length;f>e;e++)for(var g=0,h=a[e].vertexNormals.length;h>g;g++)c.vertices.push(new THREE.Vector3),c.vertices.push(new THREE.Vector3);THREE.Line.call(this,c,new THREE.LineBasicMaterial({color:b,linewidth:d}),THREE.LinePieces),this.matrixAutoUpdate=!1,this.normalMatrix=new THREE.Matrix3,this.update()},THREE.VertexNormalsHelper.prototype=Object.create(THREE.Line.prototype),THREE.VertexNormalsHelper.prototype.update=function(a){var b=new THREE.Vector3;return function(a){a=["a","b","c","d"],this.object.updateMatrixWorld(!0),this.normalMatrix.getNormalMatrix(this.object.matrixWorld);for(var c=this.geometry.vertices,d=this.object.geometry.vertices,e=this.object.geometry.faces,f=this.object.matrixWorld,g=0,h=0,i=e.length;i>h;h++)for(var j=e[h],k=0,l=j.vertexNormals.length;l>k;k++){var m=j.vertexNormals[k];c[g].copy(d[j[a[k]]]).applyMatrix4(f),b.copy(m).applyMatrix3(this.normalMatrix).normalize().multiplyScalar(this.size),b.add(c[g]),g+=1,c[g].copy(b),g+=1}return this.geometry.verticesNeedUpdate=!0,this}}(),THREE.VertexTangentsHelper=function(a,b,c,d){this.object=a,this.size=void 0!==b?b:1,b=void 0!==c?c:255,d=void 0!==d?d:1,c=new THREE.Geometry,a=a.geometry.faces;for(var e=0,f=a.length;f>e;e++)for(var g=0,h=a[e].vertexTangents.length;h>g;g++)c.vertices.push(new THREE.Vector3),c.vertices.push(new THREE.Vector3);THREE.Line.call(this,c,new THREE.LineBasicMaterial({color:b,linewidth:d}),THREE.LinePieces),this.matrixAutoUpdate=!1,this.update()},THREE.VertexTangentsHelper.prototype=Object.create(THREE.Line.prototype),THREE.VertexTangentsHelper.prototype.update=function(a){var b=new THREE.Vector3;return function(a){a=["a","b","c","d"],this.object.updateMatrixWorld(!0);for(var c=this.geometry.vertices,d=this.object.geometry.vertices,e=this.object.geometry.faces,f=this.object.matrixWorld,g=0,h=0,i=e.length;i>h;h++)for(var j=e[h],k=0,l=j.vertexTangents.length;l>k;k++){var m=j.vertexTangents[k];c[g].copy(d[j[a[k]]]).applyMatrix4(f),b.copy(m).transformDirection(f).multiplyScalar(this.size),b.add(c[g]),g+=1,c[g].copy(b),g+=1}return this.geometry.verticesNeedUpdate=!0,this}}(),THREE.WireframeHelper=function(a,b){var c=void 0!==b?b:16777215,d=[0,0],e={},f=function(a,b){return a-b},g=["a","b","c"],h=new THREE.BufferGeometry;if(a.geometry instanceof THREE.Geometry){for(var i=a.geometry.vertices,j=a.geometry.faces,k=0,l=new Uint32Array(6*j.length),m=0,n=j.length;n>m;m++)for(var o=j[m],p=0;3>p;p++){d[0]=o[g[p]],d[1]=o[g[(p+1)%3]],d.sort(f);var q=d.toString();void 0===e[q]&&(l[2*k]=d[0],l[2*k+1]=d[1],e[q]=!0,k++)}for(h.addAttribute("position",new THREE.Float32Attribute(2*k,3)),d=h.attributes.position.array,m=0,n=k;n>m;m++)for(p=0;2>p;p++)k=i[l[2*m+p]],g=6*m+3*p,d[g+0]=k.x,d[g+1]=k.y,d[g+2]=k.z}else if(a.geometry instanceof THREE.BufferGeometry&&void 0!==a.geometry.attributes.index){for(var i=a.geometry.attributes.position.array,n=a.geometry.attributes.index.array,j=a.geometry.offsets,k=0,l=new Uint32Array(2*n.length),o=0,r=j.length;r>o;++o)for(var p=j[o].start,q=j[o].count,g=j[o].index,m=p,s=p+q;s>m;m+=3)for(p=0;3>p;p++)d[0]=g+n[m+p],d[1]=g+n[m+(p+1)%3],d.sort(f),q=d.toString(),void 0===e[q]&&(l[2*k]=d[0],l[2*k+1]=d[1],e[q]=!0,k++);for(h.addAttribute("position",new THREE.Float32Attribute(2*k,3)),d=h.attributes.position.array,m=0,n=k;n>m;m++)for(p=0;2>p;p++)g=6*m+3*p,k=3*l[2*m+p],d[g+0]=i[k],d[g+1]=i[k+1],d[g+2]=i[k+2]}else if(a.geometry instanceof THREE.BufferGeometry)for(i=a.geometry.attributes.position.array,k=i.length/3,l=k/3,h.addAttribute("position",new THREE.Float32Attribute(2*k,3)),d=h.attributes.position.array,m=0,n=l;n>m;m++)for(p=0;3>p;p++)g=18*m+6*p,l=9*m+3*p,d[g+0]=i[l],d[g+1]=i[l+1],d[g+2]=i[l+2],k=9*m+(p+1)%3*3,d[g+3]=i[k],d[g+4]=i[k+1],d[g+5]=i[k+2];THREE.Line.call(this,h,new THREE.LineBasicMaterial({color:c}),THREE.LinePieces),this.matrixAutoUpdate=!1,this.matrixWorld=a.matrixWorld},THREE.WireframeHelper.prototype=Object.create(THREE.Line.prototype),THREE.ImmediateRenderObject=function(){THREE.Object3D.call(this),this.render=function(a){}},THREE.ImmediateRenderObject.prototype=Object.create(THREE.Object3D.prototype),THREE.LensFlare=function(a,b,c,d,e){THREE.Object3D.call(this),this.lensFlares=[],this.positionScreen=new THREE.Vector3,this.customUpdateCallback=void 0,void 0!==a&&this.add(a,b,c,d,e)},THREE.LensFlare.prototype=Object.create(THREE.Object3D.prototype),THREE.LensFlare.prototype.add=function(a,b,c,d,e,f){void 0===b&&(b=-1),void 0===c&&(c=0),void 0===f&&(f=1),void 0===e&&(e=new THREE.Color(16777215)),void 0===d&&(d=THREE.NormalBlending),c=Math.min(c,Math.max(0,c)),this.lensFlares.push({texture:a,size:b,distance:c,x:0,y:0,z:0,scale:1,rotation:1,opacity:f,color:e,blending:d})},THREE.LensFlare.prototype.updateLensFlares=function(){var a,b,c=this.lensFlares.length,d=2*-this.positionScreen.x,e=2*-this.positionScreen.y;for(a=0;c>a;a++)b=this.lensFlares[a],b.x=this.positionScreen.x+d*b.distance,b.y=this.positionScreen.y+e*b.distance,b.wantedRotation=b.x*Math.PI*.25,b.rotation+=.25*(b.wantedRotation-b.rotation)},THREE.MorphBlendMesh=function(a,b){THREE.Mesh.call(this,a,b),this.animationsMap={},this.animationsList=[];var c=this.geometry.morphTargets.length;this.createAnimation("__default",0,c-1,c/1),this.setAnimationWeight("__default",1)},THREE.MorphBlendMesh.prototype=Object.create(THREE.Mesh.prototype),THREE.MorphBlendMesh.prototype.createAnimation=function(a,b,c,d){b={startFrame:b,endFrame:c,length:c-b+1,fps:d,duration:(c-b)/d,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1},this.animationsMap[a]=b,this.animationsList.push(b)},THREE.MorphBlendMesh.prototype.autoCreateAnimations=function(a){for(var b,c=/([a-z]+)(\d+)/,d={},e=this.geometry,f=0,g=e.morphTargets.length;g>f;f++){var h=e.morphTargets[f].name.match(c);if(h&&1<h.length){var i=h[1];d[i]||(d[i]={start:1/0,end:-(1/0)}),h=d[i],f<h.start&&(h.start=f),f>h.end&&(h.end=f),b||(b=i)}}for(i in d)h=d[i],this.createAnimation(i,h.start,h.end,a);this.firstAnimation=b},THREE.MorphBlendMesh.prototype.setAnimationDirectionForward=function(a){(a=this.animationsMap[a])&&(a.direction=1,a.directionBackwards=!1)},THREE.MorphBlendMesh.prototype.setAnimationDirectionBackward=function(a){(a=this.animationsMap[a])&&(a.direction=-1,a.directionBackwards=!0)},THREE.MorphBlendMesh.prototype.setAnimationFPS=function(a,b){var c=this.animationsMap[a];c&&(c.fps=b,c.duration=(c.end-c.start)/c.fps)},THREE.MorphBlendMesh.prototype.setAnimationDuration=function(a,b){var c=this.animationsMap[a];c&&(c.duration=b,c.fps=(c.end-c.start)/c.duration)},THREE.MorphBlendMesh.prototype.setAnimationWeight=function(a,b){var c=this.animationsMap[a];c&&(c.weight=b)},THREE.MorphBlendMesh.prototype.setAnimationTime=function(a,b){var c=this.animationsMap[a];c&&(c.time=b)},THREE.MorphBlendMesh.prototype.getAnimationTime=function(a){var b=0;return(a=this.animationsMap[a])&&(b=a.time),b},THREE.MorphBlendMesh.prototype.getAnimationDuration=function(a){var b=-1;return(a=this.animationsMap[a])&&(b=a.duration),b},THREE.MorphBlendMesh.prototype.playAnimation=function(a){var b=this.animationsMap[a];b?(b.time=0,b.active=!0):console.warn("animation["+a+"] undefined")},THREE.MorphBlendMesh.prototype.stopAnimation=function(a){(a=this.animationsMap[a])&&(a.active=!1)},THREE.MorphBlendMesh.prototype.update=function(a){for(var b=0,c=this.animationsList.length;c>b;b++){var d=this.animationsList[b];if(d.active){var e=d.duration/d.length;d.time+=d.direction*a,d.mirroredLoop?(d.time>d.duration||0>d.time)&&(d.direction*=-1,d.time>d.duration&&(d.time=d.duration,d.directionBackwards=!0),0>d.time&&(d.time=0,d.directionBackwards=!1)):(d.time%=d.duration,0>d.time&&(d.time+=d.duration));var f=d.startFrame+THREE.Math.clamp(Math.floor(d.time/e),0,d.length-1),g=d.weight;f!==d.currentFrame&&(this.morphTargetInfluences[d.lastFrame]=0,this.morphTargetInfluences[d.currentFrame]=1*g,this.morphTargetInfluences[f]=0,d.lastFrame=d.currentFrame,d.currentFrame=f),e=d.time%e/e,d.directionBackwards&&(e=1-e),this.morphTargetInfluences[d.currentFrame]=e*g,this.morphTargetInfluences[d.lastFrame]=(1-e)*g}}},THREE.LensFlarePlugin=function(){function a(a,c){var d=b.createProgram(),e=b.createShader(b.FRAGMENT_SHADER),f=b.createShader(b.VERTEX_SHADER),g="precision "+c+" float;\n";return b.shaderSource(e,g+a.fragmentShader),b.shaderSource(f,g+a.vertexShader),b.compileShader(e),b.compileShader(f),b.attachShader(d,e),b.attachShader(d,f),b.linkProgram(d),d}var b,c,d,e,f,g,h,i,j,k,l,m,n;this.init=function(o){b=o.context,c=o,d=o.getPrecision(),e=new Float32Array(16),f=new Uint16Array(6),o=0,e[o++]=-1,e[o++]=-1,e[o++]=0,e[o++]=0,e[o++]=1,e[o++]=-1,e[o++]=1,e[o++]=0,e[o++]=1,e[o++]=1,e[o++]=1,e[o++]=1,e[o++]=-1,e[o++]=1,e[o++]=0,e[o++]=1,o=0,f[o++]=0,f[o++]=1,f[o++]=2,f[o++]=0,f[o++]=2,f[o++]=3,g=b.createBuffer(),h=b.createBuffer(),b.bindBuffer(b.ARRAY_BUFFER,g),b.bufferData(b.ARRAY_BUFFER,e,b.STATIC_DRAW),b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,h),b.bufferData(b.ELEMENT_ARRAY_BUFFER,f,b.STATIC_DRAW),i=b.createTexture(),j=b.createTexture(),b.bindTexture(b.TEXTURE_2D,i),b.texImage2D(b.TEXTURE_2D,0,b.RGB,16,16,0,b.RGB,b.UNSIGNED_BYTE,null),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.NEAREST),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.NEAREST),b.bindTexture(b.TEXTURE_2D,j),b.texImage2D(b.TEXTURE_2D,0,b.RGBA,16,16,0,b.RGBA,b.UNSIGNED_BYTE,null),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.NEAREST),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.NEAREST),0>=b.getParameter(b.MAX_VERTEX_TEXTURE_IMAGE_UNITS)?(k=!1,l=a(THREE.ShaderFlares.lensFlare,d)):(k=!0,l=a(THREE.ShaderFlares.lensFlareVertexTexture,d)),m={},n={},m.vertex=b.getAttribLocation(l,"position"),m.uv=b.getAttribLocation(l,"uv"),n.renderType=b.getUniformLocation(l,"renderType"),n.map=b.getUniformLocation(l,"map"),n.occlusionMap=b.getUniformLocation(l,"occlusionMap"),n.opacity=b.getUniformLocation(l,"opacity"),n.color=b.getUniformLocation(l,"color"),n.scale=b.getUniformLocation(l,"scale"),n.rotation=b.getUniformLocation(l,"rotation"),n.screenPosition=b.getUniformLocation(l,"screenPosition")},this.render=function(a,d,e,f){a=a.__webglFlares;var o=a.length;if(o){var p=new THREE.Vector3,q=f/e,r=.5*e,s=.5*f,t=16/f,u=new THREE.Vector2(t*q,t),v=new THREE.Vector3(1,1,0),w=new THREE.Vector2(1,1),x=n,t=m;b.useProgram(l),b.enableVertexAttribArray(m.vertex),b.enableVertexAttribArray(m.uv),b.uniform1i(x.occlusionMap,0),b.uniform1i(x.map,1),b.bindBuffer(b.ARRAY_BUFFER,g),b.vertexAttribPointer(t.vertex,2,b.FLOAT,!1,16,0),b.vertexAttribPointer(t.uv,2,b.FLOAT,!1,16,8),b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,h),b.disable(b.CULL_FACE),b.depthMask(!1);var y,z,A,B,C;for(y=0;o>y;y++)if(t=16/f,u.set(t*q,t),B=a[y],p.set(B.matrixWorld.elements[12],B.matrixWorld.elements[13],B.matrixWorld.elements[14]),p.applyMatrix4(d.matrixWorldInverse),p.applyProjection(d.projectionMatrix),v.copy(p),w.x=v.x*r+r,w.y=v.y*s+s,k||0<w.x&&w.x<e&&0<w.y&&w.y<f)for(b.activeTexture(b.TEXTURE1),b.bindTexture(b.TEXTURE_2D,i),b.copyTexImage2D(b.TEXTURE_2D,0,b.RGB,w.x-8,w.y-8,16,16,0),b.uniform1i(x.renderType,0),b.uniform2f(x.scale,u.x,u.y),b.uniform3f(x.screenPosition,v.x,v.y,v.z),b.disable(b.BLEND),b.enable(b.DEPTH_TEST),b.drawElements(b.TRIANGLES,6,b.UNSIGNED_SHORT,0),b.activeTexture(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,j),b.copyTexImage2D(b.TEXTURE_2D,0,b.RGBA,w.x-8,w.y-8,16,16,0),b.uniform1i(x.renderType,1),b.disable(b.DEPTH_TEST),b.activeTexture(b.TEXTURE1),b.bindTexture(b.TEXTURE_2D,i),b.drawElements(b.TRIANGLES,6,b.UNSIGNED_SHORT,0),B.positionScreen.copy(v),B.customUpdateCallback?B.customUpdateCallback(B):B.updateLensFlares(),b.uniform1i(x.renderType,2),b.enable(b.BLEND),z=0,A=B.lensFlares.length;A>z;z++)C=B.lensFlares[z],.001<C.opacity&&.001<C.scale&&(v.x=C.x,v.y=C.y,v.z=C.z,t=C.size*C.scale/f,u.x=t*q,u.y=t,b.uniform3f(x.screenPosition,v.x,v.y,v.z),b.uniform2f(x.scale,u.x,u.y),b.uniform1f(x.rotation,C.rotation),b.uniform1f(x.opacity,C.opacity),b.uniform3f(x.color,C.color.r,C.color.g,C.color.b),c.setBlending(C.blending,C.blendEquation,C.blendSrc,C.blendDst),c.setTexture(C.texture,1),b.drawElements(b.TRIANGLES,6,b.UNSIGNED_SHORT,0));b.enable(b.CULL_FACE),b.enable(b.DEPTH_TEST),b.depthMask(!0)}}},THREE.ShadowMapPlugin=function(){var a,b,c,d,e,f,g=new THREE.Frustum,h=new THREE.Matrix4,i=new THREE.Vector3,j=new THREE.Vector3,k=new THREE.Vector3;
this.init=function(g){a=g.context,b=g,g=THREE.ShaderLib.depthRGBA;var h=THREE.UniformsUtils.clone(g.uniforms);c=new THREE.ShaderMaterial({fragmentShader:g.fragmentShader,vertexShader:g.vertexShader,uniforms:h}),d=new THREE.ShaderMaterial({fragmentShader:g.fragmentShader,vertexShader:g.vertexShader,uniforms:h,morphTargets:!0}),e=new THREE.ShaderMaterial({fragmentShader:g.fragmentShader,vertexShader:g.vertexShader,uniforms:h,skinning:!0}),f=new THREE.ShaderMaterial({fragmentShader:g.fragmentShader,vertexShader:g.vertexShader,uniforms:h,morphTargets:!0,skinning:!0}),c._shadowPass=!0,d._shadowPass=!0,e._shadowPass=!0,f._shadowPass=!0},this.render=function(a,c){b.shadowMapEnabled&&b.shadowMapAutoUpdate&&this.update(a,c)},this.update=function(l,m){var n,o,p,q,r,s,t,u,v,w=[];for(q=0,a.clearColor(1,1,1,1),a.disable(a.BLEND),a.enable(a.CULL_FACE),a.frontFace(a.CCW),b.shadowMapCullFace===THREE.CullFaceFront?a.cullFace(a.FRONT):a.cullFace(a.BACK),b.setDepthTest(!0),n=0,o=l.__lights.length;o>n;n++)if(p=l.__lights[n],p.castShadow)if(p instanceof THREE.DirectionalLight&&p.shadowCascade)for(r=0;r<p.shadowCascadeCount;r++){var x;if(p.shadowCascadeArray[r])x=p.shadowCascadeArray[r];else{v=p,t=r,x=new THREE.DirectionalLight,x.isVirtual=!0,x.onlyShadow=!0,x.castShadow=!0,x.shadowCameraNear=v.shadowCameraNear,x.shadowCameraFar=v.shadowCameraFar,x.shadowCameraLeft=v.shadowCameraLeft,x.shadowCameraRight=v.shadowCameraRight,x.shadowCameraBottom=v.shadowCameraBottom,x.shadowCameraTop=v.shadowCameraTop,x.shadowCameraVisible=v.shadowCameraVisible,x.shadowDarkness=v.shadowDarkness,x.shadowBias=v.shadowCascadeBias[t],x.shadowMapWidth=v.shadowCascadeWidth[t],x.shadowMapHeight=v.shadowCascadeHeight[t],x.pointsWorld=[],x.pointsFrustum=[];var y=x.pointsWorld;for(s=x.pointsFrustum,u=0;8>u;u++)y[u]=new THREE.Vector3,s[u]=new THREE.Vector3;y=v.shadowCascadeNearZ[t],v=v.shadowCascadeFarZ[t],s[0].set(-1,-1,y),s[1].set(1,-1,y),s[2].set(-1,1,y),s[3].set(1,1,y),s[4].set(-1,-1,v),s[5].set(1,-1,v),s[6].set(-1,1,v),s[7].set(1,1,v),x.originalCamera=m,s=new THREE.Gyroscope,s.position.copy(p.shadowCascadeOffset),s.add(x),s.add(x.target),m.add(s),p.shadowCascadeArray[r]=x,console.log("Created virtualLight",x)}t=p,y=r,v=t.shadowCascadeArray[y],v.position.copy(t.position),v.target.position.copy(t.target.position),v.lookAt(v.target),v.shadowCameraVisible=t.shadowCameraVisible,v.shadowDarkness=t.shadowDarkness,v.shadowBias=t.shadowCascadeBias[y],s=t.shadowCascadeNearZ[y],t=t.shadowCascadeFarZ[y],v=v.pointsFrustum,v[0].z=s,v[1].z=s,v[2].z=s,v[3].z=s,v[4].z=t,v[5].z=t,v[6].z=t,v[7].z=t,w[q]=x,q++}else w[q]=p,q++;for(n=0,o=w.length;o>n;n++){if(p=w[n],p.shadowMap||(r=THREE.LinearFilter,b.shadowMapType===THREE.PCFSoftShadowMap&&(r=THREE.NearestFilter),p.shadowMap=new THREE.WebGLRenderTarget(p.shadowMapWidth,p.shadowMapHeight,{minFilter:r,magFilter:r,format:THREE.RGBAFormat}),p.shadowMapSize=new THREE.Vector2(p.shadowMapWidth,p.shadowMapHeight),p.shadowMatrix=new THREE.Matrix4),!p.shadowCamera){if(p instanceof THREE.SpotLight)p.shadowCamera=new THREE.PerspectiveCamera(p.shadowCameraFov,p.shadowMapWidth/p.shadowMapHeight,p.shadowCameraNear,p.shadowCameraFar);else{if(!(p instanceof THREE.DirectionalLight)){console.error("Unsupported light type for shadow");continue}p.shadowCamera=new THREE.OrthographicCamera(p.shadowCameraLeft,p.shadowCameraRight,p.shadowCameraTop,p.shadowCameraBottom,p.shadowCameraNear,p.shadowCameraFar)}l.add(p.shadowCamera),!0===l.autoUpdate&&l.updateMatrixWorld()}if(p.shadowCameraVisible&&!p.cameraHelper&&(p.cameraHelper=new THREE.CameraHelper(p.shadowCamera),p.shadowCamera.add(p.cameraHelper)),p.isVirtual&&x.originalCamera==m){for(r=m,q=p.shadowCamera,s=p.pointsFrustum,v=p.pointsWorld,i.set(1/0,1/0,1/0),j.set(-(1/0),-(1/0),-(1/0)),t=0;8>t;t++)y=v[t],y.copy(s[t]),THREE.ShadowMapPlugin.__projector.unprojectVector(y,r),y.applyMatrix4(q.matrixWorldInverse),y.x<i.x&&(i.x=y.x),y.x>j.x&&(j.x=y.x),y.y<i.y&&(i.y=y.y),y.y>j.y&&(j.y=y.y),y.z<i.z&&(i.z=y.z),y.z>j.z&&(j.z=y.z);q.left=i.x,q.right=j.x,q.top=j.y,q.bottom=i.y,q.updateProjectionMatrix()}for(q=p.shadowMap,s=p.shadowMatrix,r=p.shadowCamera,r.position.setFromMatrixPosition(p.matrixWorld),k.setFromMatrixPosition(p.target.matrixWorld),r.lookAt(k),r.updateMatrixWorld(),r.matrixWorldInverse.getInverse(r.matrixWorld),p.cameraHelper&&(p.cameraHelper.visible=p.shadowCameraVisible),p.shadowCameraVisible&&p.cameraHelper.update(),s.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),s.multiply(r.projectionMatrix),s.multiply(r.matrixWorldInverse),h.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),g.setFromMatrix(h),b.setRenderTarget(q),b.clear(),v=l.__webglObjects,p=0,q=v.length;q>p;p++)t=v[p],s=t.object,t.render=!1,!s.visible||!s.castShadow||(s instanceof THREE.Mesh||s instanceof THREE.ParticleSystem)&&s.frustumCulled&&!g.intersectsObject(s)||(s._modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,s.matrixWorld),t.render=!0);var z;for(p=0,q=v.length;q>p;p++)t=v[p],t.render&&(s=t.object,t=t.buffer,y=s.material instanceof THREE.MeshFaceMaterial?s.material.materials[0]:s.material,u=void 0!==s.geometry.morphTargets&&0<s.geometry.morphTargets.length&&y.morphTargets,z=s instanceof THREE.SkinnedMesh&&y.skinning,u=s.customDepthMaterial?s.customDepthMaterial:z?u?f:e:u?d:c,b.setMaterialFaces(y),t instanceof THREE.BufferGeometry?b.renderBufferDirect(r,l.__lights,null,u,t,s):b.renderBuffer(r,l.__lights,null,u,t,s));for(v=l.__webglObjectsImmediate,p=0,q=v.length;q>p;p++)t=v[p],s=t.object,s.visible&&s.castShadow&&(s._modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,s.matrixWorld),b.renderImmediateObject(r,l.__lights,null,c,s))}n=b.getClearColor(),o=b.getClearAlpha(),a.clearColor(n.r,n.g,n.b,o),a.enable(a.BLEND),b.shadowMapCullFace===THREE.CullFaceFront&&a.cullFace(a.BACK)}},THREE.ShadowMapPlugin.__projector=new THREE.Projector,THREE.SpritePlugin=function(){function a(a,b){return a.z!==b.z?b.z-a.z:b.id-a.id}var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z;this.init=function(a){s=a.context,t=a,v=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1]),w=new Uint16Array([0,1,2,0,2,3]),x=s.createBuffer(),y=s.createBuffer(),s.bindBuffer(s.ARRAY_BUFFER,x),s.bufferData(s.ARRAY_BUFFER,v,s.STATIC_DRAW),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,y),s.bufferData(s.ELEMENT_ARRAY_BUFFER,w,s.STATIC_DRAW),a=s.createProgram();var A=s.createShader(s.VERTEX_SHADER),B=s.createShader(s.FRAGMENT_SHADER);s.shaderSource(A,["precision "+t.getPrecision()+" float;","uniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform float rotation;\nuniform vec2 scale;\nuniform vec2 uvOffset;\nuniform vec2 uvScale;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvoid main() {\nvUV = uvOffset + uv * uvScale;\nvec2 alignedPosition = position * scale;\nvec2 rotatedPosition;\nrotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\nrotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\nvec4 finalPosition;\nfinalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\nfinalPosition.xy += rotatedPosition;\nfinalPosition = projectionMatrix * finalPosition;\ngl_Position = finalPosition;\n}"].join("\n")),s.shaderSource(B,["precision "+t.getPrecision()+" float;","uniform vec3 color;\nuniform sampler2D map;\nuniform float opacity;\nuniform int fogType;\nuniform vec3 fogColor;\nuniform float fogDensity;\nuniform float fogNear;\nuniform float fogFar;\nuniform float alphaTest;\nvarying vec2 vUV;\nvoid main() {\nvec4 texture = texture2D( map, vUV );\nif ( texture.a < alphaTest ) discard;\ngl_FragColor = vec4( color * texture.xyz, texture.a * opacity );\nif ( fogType > 0 ) {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat fogFactor = 0.0;\nif ( fogType == 1 ) {\nfogFactor = smoothstep( fogNear, fogFar, depth );\n} else {\nconst float LOG2 = 1.442695;\nfloat fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n}\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n}\n}"].join("\n")),s.compileShader(A),s.compileShader(B),s.attachShader(a,A),s.attachShader(a,B),s.linkProgram(a),z=a,q=s.getAttribLocation(z,"position"),r=s.getAttribLocation(z,"uv"),b=s.getUniformLocation(z,"uvOffset"),c=s.getUniformLocation(z,"uvScale"),d=s.getUniformLocation(z,"rotation"),e=s.getUniformLocation(z,"scale"),f=s.getUniformLocation(z,"color"),g=s.getUniformLocation(z,"map"),h=s.getUniformLocation(z,"opacity"),i=s.getUniformLocation(z,"modelViewMatrix"),j=s.getUniformLocation(z,"projectionMatrix"),k=s.getUniformLocation(z,"fogType"),l=s.getUniformLocation(z,"fogDensity"),m=s.getUniformLocation(z,"fogNear"),n=s.getUniformLocation(z,"fogFar"),o=s.getUniformLocation(z,"fogColor"),p=s.getUniformLocation(z,"alphaTest"),a=document.createElement("canvas"),a.width=8,a.height=8,A=a.getContext("2d"),A.fillStyle="#ffffff",A.fillRect(0,0,a.width,a.height),u=new THREE.Texture(a),u.needsUpdate=!0},this.render=function(v,w,A,B){if(A=v.__webglSprites,B=A.length){s.useProgram(z),s.enableVertexAttribArray(q),s.enableVertexAttribArray(r),s.disable(s.CULL_FACE),s.enable(s.BLEND),s.bindBuffer(s.ARRAY_BUFFER,x),s.vertexAttribPointer(q,2,s.FLOAT,!1,16,0),s.vertexAttribPointer(r,2,s.FLOAT,!1,16,8),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,y),s.uniformMatrix4fv(j,!1,w.projectionMatrix.elements),s.activeTexture(s.TEXTURE0),s.uniform1i(g,0);var C=0,D=0,E=v.fog;E?(s.uniform3f(o,E.color.r,E.color.g,E.color.b),E instanceof THREE.Fog?(s.uniform1f(m,E.near),s.uniform1f(n,E.far),s.uniform1i(k,1),D=C=1):E instanceof THREE.FogExp2&&(s.uniform1f(l,E.density),s.uniform1i(k,2),D=C=2)):(s.uniform1i(k,0),D=C=0);for(var F,G=[],E=0;B>E;E++)F=A[E],!1!==F.visible&&(F._modelViewMatrix.multiplyMatrices(w.matrixWorldInverse,F.matrixWorld),F.z=-F._modelViewMatrix.elements[14]);for(A.sort(a),E=0;B>E;E++)F=A[E],!1!==F.visible&&(w=F.material,s.uniform1f(p,w.alphaTest),s.uniformMatrix4fv(i,!1,F._modelViewMatrix.elements),G[0]=F.scale.x,G[1]=F.scale.y,F=v.fog&&w.fog?D:0,C!==F&&(s.uniform1i(k,F),C=F),null!==w.map?(s.uniform2f(b,w.map.offset.x,w.map.offset.y),s.uniform2f(c,w.map.repeat.x,w.map.repeat.y)):(s.uniform2f(b,0,0),s.uniform2f(c,1,1)),s.uniform1f(h,w.opacity),s.uniform3f(f,w.color.r,w.color.g,w.color.b),s.uniform1f(d,w.rotation),s.uniform2fv(e,G),t.setBlending(w.blending,w.blendEquation,w.blendSrc,w.blendDst),t.setDepthTest(w.depthTest),t.setDepthWrite(w.depthWrite),w.map&&w.map.image&&w.map.image.width?t.setTexture(w.map,0):t.setTexture(u,0),s.drawElements(s.TRIANGLES,6,s.UNSIGNED_SHORT,0));s.enable(s.CULL_FACE)}}},THREE.DepthPassPlugin=function(){this.enabled=!1,this.renderTarget=null;var a,b,c,d,e,f,g=new THREE.Frustum,h=new THREE.Matrix4;this.init=function(g){a=g.context,b=g,g=THREE.ShaderLib.depthRGBA;var h=THREE.UniformsUtils.clone(g.uniforms);c=new THREE.ShaderMaterial({fragmentShader:g.fragmentShader,vertexShader:g.vertexShader,uniforms:h}),d=new THREE.ShaderMaterial({fragmentShader:g.fragmentShader,vertexShader:g.vertexShader,uniforms:h,morphTargets:!0}),e=new THREE.ShaderMaterial({fragmentShader:g.fragmentShader,vertexShader:g.vertexShader,uniforms:h,skinning:!0}),f=new THREE.ShaderMaterial({fragmentShader:g.fragmentShader,vertexShader:g.vertexShader,uniforms:h,morphTargets:!0,skinning:!0}),c._shadowPass=!0,d._shadowPass=!0,e._shadowPass=!0,f._shadowPass=!0},this.render=function(a,b){this.enabled&&this.update(a,b)},this.update=function(i,j){var k,l,m,n,o,p;for(a.clearColor(1,1,1,1),a.disable(a.BLEND),b.setDepthTest(!0),!0===i.autoUpdate&&i.updateMatrixWorld(),j.matrixWorldInverse.getInverse(j.matrixWorld),h.multiplyMatrices(j.projectionMatrix,j.matrixWorldInverse),g.setFromMatrix(h),b.setRenderTarget(this.renderTarget),b.clear(),p=i.__webglObjects,k=0,l=p.length;l>k;k++)m=p[k],o=m.object,m.render=!1,!o.visible||(o instanceof THREE.Mesh||o instanceof THREE.ParticleSystem)&&o.frustumCulled&&!g.intersectsObject(o)||(o._modelViewMatrix.multiplyMatrices(j.matrixWorldInverse,o.matrixWorld),m.render=!0);var q;for(k=0,l=p.length;l>k;k++)m=p[k],m.render&&(o=m.object,m=m.buffer,o instanceof THREE.ParticleSystem&&!o.customDepthMaterial||((q=o.material instanceof THREE.MeshFaceMaterial?o.material.materials[0]:o.material)&&b.setMaterialFaces(o.material),n=void 0!==o.geometry.morphTargets&&0<o.geometry.morphTargets.length&&q.morphTargets,q=o instanceof THREE.SkinnedMesh&&q.skinning,n=o.customDepthMaterial?o.customDepthMaterial:q?n?f:e:n?d:c,m instanceof THREE.BufferGeometry?b.renderBufferDirect(j,i.__lights,null,n,m,o):b.renderBuffer(j,i.__lights,null,n,m,o)));for(p=i.__webglObjectsImmediate,k=0,l=p.length;l>k;k++)m=p[k],o=m.object,o.visible&&(o._modelViewMatrix.multiplyMatrices(j.matrixWorldInverse,o.matrixWorld),b.renderImmediateObject(j,i.__lights,null,c,o));k=b.getClearColor(),l=b.getClearAlpha(),a.clearColor(k.r,k.g,k.b,l),a.enable(a.BLEND)}},THREE.ShaderFlares={lensFlareVertexTexture:{vertexShader:"uniform lowp int renderType;\nuniform vec3 screenPosition;\nuniform vec2 scale;\nuniform float rotation;\nuniform sampler2D occlusionMap;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nvUV = uv;\nvec2 pos = position;\nif( renderType == 2 ) {\nvec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );\nvVisibility =        visibility.r / 9.0;\nvVisibility *= 1.0 - visibility.g / 9.0;\nvVisibility *=       visibility.b / 9.0;\nvVisibility *= 1.0 - visibility.a / 9.0;\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",fragmentShader:"uniform lowp int renderType;\nuniform sampler2D map;\nuniform float opacity;\nuniform vec3 color;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nif( renderType == 0 ) {\ngl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );\n} else if( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nvec4 texture = texture2D( map, vUV );\ntexture.a *= opacity * vVisibility;\ngl_FragColor = texture;\ngl_FragColor.rgb *= color;\n}\n}"},lensFlare:{vertexShader:"uniform lowp int renderType;\nuniform vec3 screenPosition;\nuniform vec2 scale;\nuniform float rotation;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvoid main() {\nvUV = uv;\nvec2 pos = position;\nif( renderType == 2 ) {\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",fragmentShader:"precision mediump float;\nuniform lowp int renderType;\nuniform sampler2D map;\nuniform sampler2D occlusionMap;\nuniform float opacity;\nuniform vec3 color;\nvarying vec2 vUV;\nvoid main() {\nif( renderType == 0 ) {\ngl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );\n} else if( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nfloat visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a;\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a;\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a;\nvisibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;\nvisibility = ( 1.0 - visibility / 4.0 );\nvec4 texture = texture2D( map, vUV );\ntexture.a *= opacity * visibility;\ngl_FragColor = texture;\ngl_FragColor.rgb *= color;\n}\n}"}},window.THREE=THREE,Dropzone.options.phenixDropzone={success:function(a,b){console.log(b);var c=jQuery.parseJSON(b);if(c.file_name){var d=$("#run_app"),e=$("<input/>").attr("type","hidden").attr("name","file_name").val(c.file_name);d.append(e),$("#run_app_button").unbind("click"),$("#run_app_button").click(function(a){return a.preventDefault(),run_app(),!0})}if(c.space_group&&$("#space_group").val(c.space_group),c.unit_cell&&$("#unit_cell").val(c.unit_cell),c.d_min&&$("#d_min").val(c.d_min),c.d_max&&$("#d_max").val(c.d_max),c.data_labels){var f=$("#data_labels");f.empty();for(var g=0;g<c.data_labels.length;g++)f.append($("<option/>").val(c.data_labels[g]).text(c.data_labels[g]))}}};var xtal=function(a){return a}(xtal||{});xtal.cif=function(a){function b(a){return k.test(a)?Number(a):a}function c(a){return a.trim().toLowerCase()}function d(a,b){this.buffer=a||"",this.sep=b||"\n",this.i=0,this.j=this.buffer.indexOf(this.sep,this.i),this.end=this.buffer.lastIndexOf(this.sep)}function e(){this.blocks={}}function f(a){this.name=c(a),this.data={}}function g(a){this.gen=new d(""),this.block_callback=a||function(a){},this.block=null,this.loop=null,this.loop_i=0,this.step=this.step_init}var h=/^\s*(data)?(loop)?(_[\.\w]+)?(save_)?/,i=/^\s*([^\s]+)\s+(.*)/,j=/data_(\w+)/,k=/^[+-]?(\d+)?(\.\d+)?$/,l=/\s/;return d.prototype.add=function(a){this.buffer=this.remainder()+a,this.i=0,this.j=this.buffer.indexOf(this.sep,this.i),this.end=this.buffer.lastIndexOf(this.sep)},d.prototype.next=function(){if(-1==this.j)return null;var a=this.buffer.substring(this.i,this.j);return this.i=this.j+1,this.j=this.buffer.indexOf(this.sep,this.i),a},d.prototype.remainder=function(){return this.buffer.substring(this.i,this.end)},e.prototype.add_block=function(a){this.blocks[a.name]=a},e.prototype.get_block=function(a){return this.blocks[c(a)]},e.prototype.first_block=function(a){return this.blocks[Object.keys(this.blocks)[0]]},e.prototype.load=function(a,b){function c(a){e.parse_chunk(this.response),b(d)}var d=this,e=new g(function(a){d.add_block(a)}),f=new XMLHttpRequest;f.open("GET",a,!0),f.onload=c,f.send()},e.prototype.parse=function(a){var b=this,c=new g(function(a){b.add_block(a)});c.parse_chunk(a)},f.prototype.get=function(a){return this.data[a]},f.prototype.loop_dict=function(a){var b=[],c=[],d=[];for(var e in this.data)e.split(".")[0]==a&&(b.push(e),c.push(e.split(".")[1]));for(var f=this.data[b[0]].length,e=0;f>e;e++){for(var g={},h=0;h<b.length;h++)g[c[h]]=this.data[b[h]][e];d.push(g)}return d},f.prototype.loop_list=function(a){return{}},f.prototype.set=function(a,b){this.data[c(a)]=b},f.prototype.append=function(a,b){this.data[a].push(b)},f.prototype.append_row=function(a,b){if(a.length==b.length)for(var c=0;c<a.length;c++)this.data[a[c]].push(b[c])},f.prototype.add_loop_key=function(a){this.data[a]=[]},f.prototype.groups=function(){var a={};for(var b in this.data)b=b.split(".")[0],a[b]=!0;return Object.keys(a)},f.prototype.group_keys=function(a){return this.keys_filter(a+".")},f.prototype.keys_filter=function(a){return this.keys().filter(function(b){return 0===b.lastIndexOf(a,0)})},f.prototype.keys=function(){return Object.keys(this.data)},g.prototype.parse_chunk=function(a){this.gen.add(a);for(var b=this.gen.next();null!=b;)"#"!=b[0]&&(this.step=this.step(b)),b=this.gen.next()},g.prototype.step_init=function(a){var b=h.exec(a);return b[1]?this.step_block(a):b[2]?this.step_loop(a):b[3]?this.step_tag(a):this.step_init},g.prototype.step_block=function(a){var b=j.exec(a)[1];return this.block=new f(b),this.block_callback(this.block),this.step_init},g.prototype.step_loop=function(a){return this.loop=[],this.loop_i=0,this.step_loop_keys},g.prototype.step_loop_keys=function(a){var b=h.exec(a);if(b[3]){var d=c(b[3]);return this.loop.push(d),this.block.add_loop_key(d),this.step_loop_keys}return this.step_loop_append(a)},g.prototype.step_loop_append=function(a){var b=h.exec(a);if(b[1]||b[2]||b[3]||b[4])return this.step_init(a);for(var c=this.parse_values(a),d=this.loop.length,e=0;e<c.length;e++)this.block.append(this.loop[this.loop_i%d],c[e]),this.loop_i+=1;return this.step_loop_append},g.prototype.step_tag=function(a){var b=i.exec(a);if(!b[0])return this.step_init(a);var c=b[1],d=this.parse_values(b[2]);return this.block.set(c,d[0]),this.step_init},g.prototype.step_save=function(a){var b=h.exec(a);return b[4]?this.step_init:this.step_save},g.prototype.parse_values=function(a){var c=[],d=null,e=0,f=a.length;if(";"==a[0])return[this.parse_value_text(a.substring(1,f))];for(;f-1>e;)if(d=a[e],l.test(d))e++;else if("#"==d)e=f;else if('"'==d||"'"==d)n=a.indexOf(d+" ",e+1),n<1&&(n=f),c.push(b(a.substring(e+1,n))),e=n+1;else{n=a.indexOf(" ",e+1),n<1&&(n=f);var g=b(a.substring(e,n));c.push(g),e=n}return c},g.prototype.parse_value_text=function(a){for(var b="";null!=a&&(b+=a,a=this.gen.next(),";"!=a););return b},{Parser:g,Block:f,Reader:e}}(xtal);var xtal=function(a){return a}(xtal||{});xtal.cifexplorer=function(a){function b(a,b){this.element=a,this.element_ul=null,this.options=b||{}}return b.prototype.load=function(a){var b=this,c=new xtal.cif.Reader;c.load(a,function(a){b.load_cb(a)})},b.prototype.load_cb=function(a){this.element.empty(),this.element_ul=$("<ul />").appendTo(this.element);this.draw_blocks(a.blocks)},b.prototype.draw_blocks=function(a){var b={};for(var c in a)a[c].groups().map(function(a){b[a]=!0});b=Object.keys(b).sort();var d=this;b.map(function(b){d.draw_group(a,b)}),this.element.tabs().addClass("ui-tabs-vertical ui-helper-clearfix")},b.prototype.draw_group=function(a,b){var c=b.replace(".","_"),d=$("<li />");$("<a />",{href:"#"+c,text:b}).appendTo(d);this.element_ul.append(d);var e=$("<div />",{id:c}).appendTo(this.element);$("<h1>").text(b).appendTo(e);var f={};for(var g in a)a[g].group_keys(b).map(function(a){f[a]=!0});f=Object.keys(f).sort(),this.draw_items(a,f,e)},b.prototype.loopy=function(a,b){var c=[];for(var d in a){var e={},f=a[d];b.map(function(a){var b=f.get(a);$.isArray(b)?e[a]=b:e[a]=[b]}),c[d]=e}return c},b.prototype.draw_items=function(a,b,c){var d=this.loopy(a,b),e=[],f=[];for(var g in d)e.push(g),f.push(d[g]);console.log(e,f);var h=$("<table />").addClass("xtal-cif-table").appendTo(c),i=$("<thead />").wrap("<tr />").appendTo(h);$("<th />").text("Row").appendTo(i),$("<th />").text("Key").appendTo(i),e.map(function(a){$("<th />").text(g).appendTo(i)});var j=f.map(function(a){return a[b[0]].length}),j=Math.max.apply(null,j),k=!1,l=j;j>10&&(l=10,k=!0),console.log(j);for(var m=0;l>m;m++){var n=$("<tbody />").appendTo(h);for(var o in b){var p=$("<tr />").appendTo(n);0==o&&$("<td />").text(m+1).attr("rowspan",b.length).addClass("xtal-cif-tablegroup").appendTo(p),$("<td />").text(b[o].split(".")[1]).appendTo(p),f.map(function(a){$("<td />").text(a[b[o]][m]).appendTo(p)})}}k&&$("<tbody><tr><td /><td>Displaying 10 of "+j+" rows. Click here to view complete table.</td></tr></tbody>").appendTo(h)},{CIFExplorer:b}}(xtal);var xtal=function(a){return a}(xtal||{});xtal.display=function(a){return{}}(xtal),Bonds=function(a,b,c){var d=b.color_scheme,e=b.hydrogens;null==c&&(c="trace+ligands"==b.render_style);var f=b.carbon_color,g="ellipsoids"!=b.render_style,h=[],i=[],j=a.atoms();if(!e&&a.has_hydrogens)for(var k=0;k<j.length;k++)"H"!=j[k].element&&i.push(j[k]);else i=j;!d||"element"==d||c?h=color_by_element(i,f,e):"bfactor"==d?h=color_by_bfactor(i,e):"rainbow"==d?h=color_by_index(i,e):console.log("Color style: "+d);var l=null;c&&(l=a.extract_ligands());for(var m=0,n=new THREE.Geometry,k=0;k<j.length;k++){var o=j[k],p=a.connectivity[k],q=h[m];("H"!=o.element||e)&&(m++,c&&!l[k]||(0==p.length&&g?draw_isolated_atom(o,n,q):draw_bonded_atom(n,q,a,p,o,e,c,l)))}var r=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors,linewidth:3});THREE.Line.call(this,n,r,THREE.LinePieces)},Bonds.prototype=Object.create(THREE.Line.prototype),Highlights=function(a,b){for(var c=new THREE.Geometry,d=new THREE.Color(8454112),e=0;e<b.length;e++){var f=b[e],g=a.atoms()[f],h=a.connectivity[f];0==h.length?draw_isolated_atom(g,c,d):draw_bonded_atom(c,d,a,h,g,!0)}var i=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors,linewidth:8});THREE.Line.call(this,c,i,THREE.LinePieces)},Highlights.prototype=Object.create(THREE.Line.prototype),Trace=function(a,b){for(var c=b.color_scheme,d=b.carbon_color,e=a.extract_trace(),f=[],g=[],h=0;h<e.length;h++)for(var i=0;i<e[h].length;i++)g.push(e[h][i]);c&&"element"!=c?"bfactor"==c?f=color_by_bfactor(g,!1):"rainbow"==c?f=color_by_index(g,!1):console.log("Color style: "+c):f=color_by_element(g,d,!1);for(var j=0,k=new THREE.Geometry,h=0;h<e.length;h++)for(var i=0;i<e[h].length-1;i++){var l=e[h][i],m=e[h][i+1],n=f[j];j++,k.vertices.push(new THREE.Vector3(l.xyz[0],l.xyz[1],l.xyz[2]),new THREE.Vector3(m.xyz[0],m.xyz[1],m.xyz[2])),k.colors.push(n,n)}var o=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors,linewidth:3});THREE.Line.call(this,k,o,THREE.LinePieces)},Trace.prototype=Object.create(THREE.Line.prototype),Ribbon=function(a,b){var c=color_by_index(a.atoms()),d=new THREE.Geometry;b.draw_ribbon(d,c);var e=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors,linewidth:1});THREE.Line.call(this,d,e,THREE.LinePieces)},Ribbon.prototype=Object.create(THREE.Line.prototype),Ellipsoids=function(a,b){var c=b.color_scheme,d=b.carbon_color,e=b.hydrogens,f=!0,g=[],h=[],i=a.atoms();if(!e&&a.has_hydrogens)for(var j=0;j<i.length;j++)"H"!=i[j].element&&h.push(i[j]);else h=i;c&&"element"!=c?"bfactor"==c?g=color_by_bfactor(h,e):"rainbow"==c?g=color_by_index(h,e):console.log("Color style: "+c):g=color_by_element(h,d,e);var k,l=new THREE.Geometry;f?(k=new THREE.MeshPhongMaterial({vertexColors:!0}),k.side=THREE.DoubleSide):k=new THREE.MeshBasicMaterial({vertexColors:!0,wireframe:!0});for(var m=new THREE.SphereGeometry(1,10,8),j=0;j<h.length;j++){var n=h[j];if(null!=n.uij){for(var o=g[j],p=n.ellipsoid_to_sphere_transform(),q=new THREE.Matrix4(p[0],p[4],p[8],p[12],p[1],p[5],p[9],p[13],p[2],p[6],p[10],p[14],p[3],p[7],p[11],p[15]),r=0;r<m.faces.length;r++)m.faces[r].color=o;l.merge(m,q,j)}}var s;s=k;new THREE.Mesh(l,s);THREE.Mesh.call(this,l,k)},Ellipsoids.prototype=Object.create(THREE.Mesh.prototype),Axis=function(a,b,c,d){a=a||1,d=d||2;for(var e=new THREE.Geometry,f=[[-1,0,0],[1,0,0],[0,-1,0],[0,1,0],[0,0,-1],[0,0,1]],g=b[0],h=b[1],i=b[2],j=[new THREE.Color(16736352),new THREE.Color(6356832),new THREE.Color(24831)],k=new THREE.Color(10551136),l=0;6>l;l+=2){var m=g+f[l][0]*a,n=h+f[l][1]*a,o=i+f[l][2]*a,p=g+f[l+1][0]*a,q=h+f[l+1][1]*a,r=i+f[l+1][2]*a;if(e.vertices.push(new THREE.Vector3(g,h,i),new THREE.Vector3(m,n,o),new THREE.Vector3(g,h,i),new THREE.Vector3(p,q,r)),c)e.colors.push(j[l/2]),e.colors.push(j[l/2]),e.colors.push(j[l/2]),e.colors.push(j[l/2]);else for(var s=0;4>s;s++)e.colors.push(k)}var t=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors,linewidth:d});THREE.Line.call(this,e,t,THREE.LinePieces)},Axis.prototype=Object.create(THREE.Line.prototype),UnitCellBox.prototype=Object.create(THREE.Line.prototype);var xtal=function(a){function b(a,b,f,g,h,i){if(this.a=a,this.b=b,this.c=f,this.alpha=g,this.beta=h,this.gamma=i,this.params=[a,b,f,g,h,i],0>=a||0>=b||0>=f||0>=g||0>=h||0>=i)throw Error("Zero or negative unit cell parameter(s).");this.cos_ang=[Math.cos(j(g)),Math.cos(j(h)),Math.cos(j(i))],this.sin_ang=[Math.sin(j(g)),Math.sin(j(h)),Math.sin(j(i))],this.r_cos_ang=[];for(var k=0;3>k;k++){if(denom=this.sin_ang[(k+1)%3]*this.sin_ang[(k+2)%3],0==denom)throw Error("Zero denominator");this.r_cos_ang.push((this.cos_ang[(k+1)%3]*this.cos_ang[(k+2)%3]-this.cos_ang[k])/denom)}var l=Math.sqrt(1-this.r_cos_ang[0]*this.r_cos_ang[0]);this.orth=[this.params[0],this.cos_ang[2]*this.params[1],this.cos_ang[1]*this.params[2],0,this.sin_ang[2]*this.params[1],-this.sin_ang[1]*this.r_cos_ang[0]*this.params[2],0,0,this.sin_ang[1]*this.params[2]*l],this.frac=[1/this.a,-this.cos_ang[2]/(this.sin_ang[2]*this.params[0]),-(this.cos_ang[2]*this.sin_ang[1]*this.r_cos_ang[0]+this.cos_ang[1]*this.sin_ang[2])/(this.sin_ang[1]*l*this.sin_ang[2]*this.params[0]),0,1/(this.sin_ang[2]*this.params[1]),this.r_cos_ang[0]/(l*this.sin_ang[2]*this.params[1]),0,0,1/(this.sin_ang[1]*l*this.params[2])],this.fractionalize=c,this.orthogonalize=d,this.as_str=e}function c(a){var b=a[0],c=a[1],d=a[2];return[this.frac[0]*b+this.frac[1]*c+this.frac[2]*d,this.frac[4]*c+this.frac[5]*d,this.frac[8]*d]}function d(a){var b=a[0],c=a[1],d=a[2];return[this.orth[0]*b+this.orth[1]*c+this.orth[2]*d,this.orth[4]*c+this.orth[5]*d,this.orth[8]*d]}function e(){return"a="+this.a+" b="+this.b+" c="+this.c+" alpha="+this.alpha+" beta="+this.beta+" gamma="+this.gamma}function f(a,b,c){this.n_real=a,this.n_grid=b,this.origin=c,this.size=this.n_real[0]*this.n_real[1]*this.n_real[2],this.values=new Float32Array(this.size),this.grid2index=function(a,b,c){var d=(a+this.origin[0])%this.n_real[0],e=(b+this.origin[1])%this.n_real[1],f=(c+this.origin[2])%this.n_real[2];return 0>d&&(d+=this.n_real[0]),0>e&&(e+=this.n_real[1]),0>f&&(f+=this.n_real[2]),(d*this.n_real[1]+e)*this.n_real[2]+f},this.grid2frac=function(a,b,c){return[a/this.n_grid[0],b/this.n_grid[1],c/this.n_grid[2]]},this.frac2grid=function(a,b,c){return[Math.floor(a*this.n_grid[0]),Math.floor(b*this.n_grid[1]),Math.floor(c*this.n_grid[2])]},this.set_grid_value=function(a,b,c,d){if(idx=this.grid2index(a,b,c),idx>=this.size)throw Error("Array overflow with indices "+a+","+b+","+c);this.values[idx]=d},this.get_grid_value=function(a,b,c,d){if(idx=this.grid2index(a,b,c),idx>=this.size)throw Error("Array overflow with indices "+a+","+b+","+c);return this.values[idx]},this.sigma_scale=function(){for(var a=average(this.values),b=0;b<this.size;b++)this.values[b]=(this.values[b]-a.mean)/a.deviation}}function g(){this.n_real=null,this.origin=null,this.unit_cell=null,this.data=null,this.from_ccp4=function(a){console.log("Map data size: "+a.length),this.mode=a[3],this.n_grid=[a[7],a[8],a[9]];var c=new ArrayBuffer(24),d=new Int32Array(c),e=new Float32Array(c);d[0]=a[10],d[1]=a[11],d[2]=a[12],d[3]=a[13],d[4]=a[14],d[5]=a[15],this.unit_cell=new b(e[0],e[1],e[2],e[3],e[4],e[5]),this.min=a[19],this.max=a[20],this.mean=a[21],this.sg_number=a[22],this.lskflg=a[24],n_crs=[a[0],a[1],a[2]];var g=[a[16]-1,a[17]-1,a[18]-1],h=[a[4],a[5],a[6]];this.origin=[h[g[0]],h[g[1]],h[g[2]]],this.n_real=[n_crs[g[0]],n_crs[g[1]],n_crs[g[2]]],this.data=new f(this.n_real,this.n_grid,this.origin);var i=[0,0,0],j=256,k=(n_crs[0]*n_crs[1],new ArrayBuffer(4)),l=new Int32Array(k),m=new Float32Array(k);for(i[2]=0;i[2]<n_crs[2];i[2]++)for(i[1]=0;i[1]<n_crs[1];i[1]++)for(i[0]=0;i[0]<n_crs[0];i[0]++){var n=i[g[0]]+this.origin[0],o=i[g[1]]+this.origin[1],p=i[g[2]]+this.origin[2];l[0]=a[j++],this.data.set_grid_value(n,o,p,m[0])}if(j!=a.length)throw Error("Index does not match data length: "+j+" vs. "+a.length)},this.from_dsn6=function(a,c){for(var d=new ArrayBuffer(512),e=new Uint8Array(d),g=new Int16Array(d),h=0;512>h;h++)e[h]=a[h];if(100!=g[18])for(var h=0;256>h;h++)e[2*h]=a[2*h+1],e[2*h+1]=a[2*h];if(100!=g[18])throw Error("Endian swap failed");this.origin=[g[0],g[1],g[2]],this.n_real=[g[3],g[4],g[5]],this.n_grid=[g[6],g[7],g[8]];var i=g[17];this.unit_cell=new b(g[9]/i,g[10]/i,g[11]/i,g[12]/i,g[13]/i,g[14]/i),this.data=new f(this.n_real,this.n_grid,this.origin);for(var j=g[15]/100,k=g[16],l=512,m=[Math.ceil(this.n_real[0]/8),Math.ceil(this.n_real[1]/8),Math.ceil(this.n_real[2]/8)],n=0;n<m[2];n++)for(var o=0;o<m[1];o++)for(var p=0;p<m[0];p++){for(var q=new Uint8Array(512),h=0;256>h;h++)q[2*h]=a[l+2*h+1],q[2*h+1]=a[l+2*h];l+=512;for(var r=0,s=0;8>s;s++)for(var t=0;8>t;t++)for(var u=0;8>u;u++){var v=8*p+u,w=8*o+t,x=8*n+s;if(v<this.n_real[0]&&w<this.n_real[1]&&x<this.n_real[2]){var h=v+this.origin[0],y=w+this.origin[1],z=x+this.origin[2],A=(q[r]-k)/j;this.data.set_grid_value(h,y,z,A)}r+=1}}c||this.data.sigma_scale()},this.show=function(){console.log("map origin: "+this.origin),console.log("map size: "+this.n_real),console.log("unit cell grid: "+this.n_grid),console.log(this.unit_cell.as_str())},this.points_and_values=function(a,b){
return new h(this.unit_cell,this.data,a,b)}}function h(a,b,c,d){c||(c=[0,0,0]),d||(d=5);var e=[c[0]-d,c[1]-d,c[2]-d],f=[c[0]+d,c[1]+d,c[2]+d],g=a.fractionalize(e),h=a.fractionalize(f),i=b.frac2grid(g[0],g[1],g[2]),j=b.frac2grid(h[0],h[1],h[2]);this.points=[],this.values=[];var k=j[0]-i[0]+1,l=j[1]-i[1]+1,m=j[2]-i[2]+1;this.size=[k,l,m];for(var n=i[2];n<=j[2];n++)for(var o=i[1];o<=j[1];o++)for(var p=i[0];p<=j[0];p++){if(site_frac=b.grid2frac(p,o,n),site_cart=a.orthogonalize(site_frac),!site_cart)throw Error("Site undefined for "+p+","+o+","+n);if(this.points.push(new THREE.Vector3(site_cart[0],site_cart[1],site_cart[2])),map_value=b.get_grid_value(p,o,n),null==map_value)throw Error("oops: "+map_value+" ("+p+","+o+","+n+")");this.values.push(b.get_grid_value(p,o,n))}}function j(a){return a*Math.PI/180}function k(a,b){return Math.sqrt(Math.pow(b[0]-a[0],2)+Math.pow(b[1]-a[1],2)+Math.pow(b[2]-a[2],2))}function l(a,b){return[a[0]+(b[0]-a[0])/2,a[1]+(b[1]-a[1])/2,a[2]+(b[2]-a[2])/2]}function m(a){var b,c,d,e,f,g,h,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F=3,G=[a[0],a[3],a[1],a[4],a[5],a[2]],H=[1,0,0,0,1,0,0,0,1],I=[0,0,0],J=1e-10,K=0;for(v=0,j=0,i=0;i<F;i++)for(k=0;k<=i;k++)k!=i&&(v+=G[j]*G[j]),++j;if(v=Math.sqrt(2*v),w=J*v/F,K>w&&(w=K),v>0)for(C=v;C>w;)for(C/=F,h=1;h;)for(h=0,n=0;n!=F-1;){for(q=n*(n+1)/2,o=n+q,r=n+1,c=F*n;r!=F;){if(t=r*(r+1)/2,p=n+t,G[p]*G[p]>C*C){h=1,s=r+t,D=.5*(G[o]-G[s]);var L=Math.sqrt(G[p]*G[p]+D*D);if(0==L)throw Error("denominator is zero");for(E=-G[p]/L,0>D&&(E=-E),A=E/Math.sqrt(2*(1+Math.sqrt(1-E*E))),0>D&&(E=-E),A=E/Math.sqrt(2*(1+Math.sqrt(1-E*E))),B=A*A,x=Math.sqrt(1-B),y=x*x,z=A*x,f=F*r,i=0;i<F;i++)j=i*(i+1)/2,i!=n&&i!=r&&(e=i<r?i+t:r+j,b=i<n?i+q:n+j,D=G[b]*x-G[e]*A,G[e]=G[b]*A+G[e]*x,G[b]=D),d=c+i,g=f+i,D=H[d]*x-H[g]*A,H[g]=H[d]*A+H[g]*x,H[d]=D;D=2*G[p]*z,E=G[o]*y+G[s]*B-D,D=G[o]*B+G[s]*y+D,G[p]=(G[o]-G[s])*z+G[p]*(y-B),G[o]=E,G[s]=D}r++}n++}for(l=0,i=0;i<F-1;i++){for(e=i,m=l,u=G[l],n=0,k=0;F>k;k++)k>i&&G[n]>u&&(e=k,m=n,u=G[n]),n+=k+2;if(e!=i)for(G[m]=G[l],G[l]=u,n=F*i,r=F*e,k=0;F>k;k++)u=H[n],H[n++]=H[r],H[r++]=u;l+=i+2}for(k=0,l=0;F>k;k++)I[k]=G[l],l+=k+2;this.vectors=H,this.values=I}function n(a,b){for(var c=new m(a),d=c.vectors,e=[d[0],d[1],d[2]],f=[d[3],d[4],d[5]],g=[e[1]*f[2]-f[1]*e[2],e[2]*f[0]-f[2]*e[0],e[0]*f[1]-f[0]*e[1]],h=0;3>h;h++)e[h]*=Math.sqrt(c.values[0]),f[h]*=Math.sqrt(c.values[1]),g[h]*=Math.sqrt(c.values[2]);var i=new Array(16);return i[0]=e[0],i[4]=f[0],i[8]=g[0],i[12]=b[0],i[1]=e[1],i[5]=f[1],i[9]=g[1],i[13]=b[1],i[2]=e[2],i[6]=f[2],i[10]=g[2],i[14]=b[2],i[3]=0,i[7]=0,i[11]=0,i[15]=1,i}return average=function(a){for(var b,c={mean:0,variance:0,deviation:0},d=a.length,e=0,f=d;f--;e+=a[f]);for(b=c.mean=e/d,f=d,e=0;f--;e+=Math.pow(a[f]-b,2));return c.deviation=Math.sqrt(c.variance=e/d),c},{UnitCell:b,Map:g,midpoint:l,distance:k,deg2rad:j,ellipsoid_to_sphere_transform:n}}(xtal||{}),xtal=function(a){return a}(xtal||{});xtal.loggraph=function(a){function b(a,b,c,d){this.graph_id=c;var e=$(a);if(null==e)throw Error("Can't find element "+a);if(null==b)throw Error("No tables!");if(0==b.length)throw Error("Empty tables");if(this.tables=b,this.tableSelect=null,this.plotSelect=null,e.empty(),!d){var f=$("<div/>").attr("class","controls").attr("id","loggraphControls");this.tableSelect=$("<select/>").attr("id","tableSelect").attr("class","wide"),this.plotSelect=$("<select/>").attr("id","plotSelect").attr("class","wide"),f.append($("<div/>").attr("class","control-block").append($("<div/>").attr("class","control-item").html("<b>Table name:</b>"),$("<div/>").attr("class","control-item").append(this.tableSelect))),f.append($("<div/>").attr("class","control-block").append($("<div/>").attr("class","control-item").html("<b>Plot name:</b>"),$("<div/>").attr("class","control-item").append(this.plotSelect))),e.append(f),this.tableSelect.empty(),this.plotSelect.empty();for(var g=0;g<this.tables.length;g++){var h=this.tables[g];this.tableSelect.append($("<option/>").val(g).text(h.title))}var i=this;this.tableSelect.change(function(){var a=parseInt($(i.tableSelect).val());i.selectTable(a)}),this.plotSelect.change(function(){var a=parseInt($(i.plotSelect).val());i.selectPlot(a)})}this.plot=$("<div/>").attr("class","loggraph-display").attr("id","graph"+this.graph_id),e.append(this.plot),this.selectTable=function(a){this.tables[a];this.plotSelect&&this.setPlots(a),this.selectPlot(0)},this.setPlots=function(a){this.plotSelect.empty();for(var b=this.tables[a],c=0;c<b.graph_names.length;c++)this.plotSelect.append($("<option/>").val(c).text(b.graph_names[c]));this.plotSelect.width(this.plotSelect.parent().width())},this.selectPlot=function(a){this.plot.empty();var b=null;b=this.tableSelect?parseInt($(this.tableSelect).val()):0;var c=this.tables[b],e=c.data,f={top:20,right:20,bottom:30,left:50},h=800-f.left-f.right,i=600-f.top-f.bottom,j=c.graph_columns[a],k=c.graph_names[a],l=d3.scale.linear().range([0,h]),m=d3.scale.linear().range([i,0]),n=d3.scale.category10(),o=d3.svg.axis().scale(l).orient("bottom"),p=d3.svg.axis().scale(m).orient("left"),q=c.data[j[0]];l.domain(d3.extent(q));var r="";if(c.graph_labels?r=c.graph_labels[g]:2==j.length&&(r=c.column_labels[j[1]]),!this.plot)throw Error("Plot not initialized");d||this.plot.append($("<p/>").attr("class","plotTitle").text(k)),select_tag="#graph"+this.graph_id;var s=d3.select(select_tag).append("svg").attr("width",h+f.left+f.right).attr("height",i+f.top+f.bottom).append("g").attr("transform","translate("+f.left+","+f.top+")");s.append("g").attr("class","x axis").attr("transform","translate(0,"+i+")").call(o),s.append("g").attr("class","y axis").call(p).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text(r);for(var t=[],u=[],v=1;v<j.length;v++){t.push(v);for(var w=e[j[v]],x=0;x<w.length;x++)u.push(w[x])}n.domain(t),m.domain([d3.min(u),d3.max(u)]);for(var y=d3.svg.line().interpolate("linear").x(function(a){return l(a.xval)}).y(function(a){return m(a.yval)}),z=[],x=0;x<e[j[0]].length;x++)z.push(x);for(var A=n.domain().map(function(a){return{id:a,values:z.map(function(b){return{xval:e[j[0]][b],yval:e[j[a]][b]}})}}),B=0,C=0,D=i,v=1;v<j.length;v++)y_end=m(e[j[v]][z.length-1]),C=Math.max(y_end,C),D=Math.min(y_end,D);60>D&&(B=Math.min(i-D,i-100));for(var v=1;v<j.length;v++){console.log("drawing line");var E=s.selectAll(".column").data(A).enter().append("g").attr("class","graph_series");E.append("path").attr("class","line").attr("d",function(a){return y(a.values)}).style("stroke",function(a){return n(a.id)});var F=s.selectAll(".legend").data(n.domain()).enter().append("g").attr("class","legend").attr("transform",function(a,b){return"translate(0,"+(B+20*b)+")"});F.append("rect").attr("x",h-18).attr("width",12).attr("height",2).style("fill",n),F.append("text").attr("x",h-24).attr("y",0).attr("dy",".35em").style("text-anchor","end").text(function(a){return c.column_labels[j[a]]})}},this.selectTable(0)}return{Loggraph:b}}(xtal);var xtal=function(a){return a}(xtal||{});xtal.marchingcubes=function(a){function b(a,b,e,f){var g=new Array(12),h=new THREE.Geometry,i=0,j=e[0],k=e[1],l=e[2];if(0>=j||0>=k||0>=l)throw Error("Grid dimensions are zero along at least one edge");var m=j*k,n=m*l;if(b.length!=n||a.length!=n)throw Error("Array size mismatch: "+b.length+", "+a.length+" versus "+n);for(var o=new Float32Array(8),p=0,q=0;l-1>q;q++)for(var r=0;k-1>r;r++)for(var s=0;j-1>s;s++){for(var t=[],u=0,v=0;8>v;++v){var w=c[v],x=s+w[0]+e[0]*(r+w[1]+e[1]*(q+w[2])),y=b[x];o[v]=y,t.push(a[x]),u|=f>y?1<<v:0}p++;var z=edgeTable[u];if(0!==z){for(var A=.5,v=0;12>v;++v)if(0!==(z&1<<v)){var B=d[v];A=(f-o[B[0]])/(o[B[1]]-o[B[0]]),g[v]=t[B[0]].clone().lerp(t[B[1]],A)}var v=0;for(u<<=4;-1!=triTable[u+v];){var C=triTable[u+v],D=triTable[u+v+1],E=triTable[u+v+2];h.vertices.push(g[C].clone()),h.vertices.push(g[D].clone()),h.vertices.push(g[E].clone());var F=new THREE.Face3(i,i+1,i+2);h.faces.push(F),h.faceVertexUvs[0].push([new THREE.Vector2(0,0),new THREE.Vector2(0,1),new THREE.Vector2(1,1)]),i+=3,v+=3}}}return h.computeFaceNormals(),h.computeVertexNormals(),h}edgeTable=new Int32Array([0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0]),triTable=new Int32Array([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,9,8,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,2,10,0,2,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,8,3,2,10,8,10,9,8,-1,-1,-1,-1,-1,-1,-1,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,8,11,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,11,2,1,9,11,9,8,11,-1,-1,-1,-1,-1,-1,-1,3,10,1,11,10,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,10,1,0,8,10,8,11,10,-1,-1,-1,-1,-1,-1,-1,3,9,0,3,11,9,11,10,9,-1,-1,-1,-1,-1,-1,-1,9,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,7,3,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,1,9,4,7,1,7,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,4,7,3,0,4,1,2,10,-1,-1,-1,-1,-1,-1,-1,9,2,10,9,0,2,8,4,7,-1,-1,-1,-1,-1,-1,-1,2,10,9,2,9,7,2,7,3,7,9,4,-1,-1,-1,-1,8,4,7,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,4,7,11,2,4,2,0,4,-1,-1,-1,-1,-1,-1,-1,9,0,1,8,4,7,2,3,11,-1,-1,-1,-1,-1,-1,-1,4,7,11,9,4,11,9,11,2,9,2,1,-1,-1,-1,-1,3,10,1,3,11,10,7,8,4,-1,-1,-1,-1,-1,-1,-1,1,11,10,1,4,11,1,0,4,7,11,4,-1,-1,-1,-1,4,7,8,9,0,11,9,11,10,11,0,3,-1,-1,-1,-1,4,7,11,4,11,9,9,11,10,-1,-1,-1,-1,-1,-1,-1,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,5,4,1,5,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,5,4,8,3,5,3,1,5,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,10,4,9,5,-1,-1,-1,-1,-1,-1,-1,5,2,10,5,4,2,4,0,2,-1,-1,-1,-1,-1,-1,-1,2,10,5,3,2,5,3,5,4,3,4,8,-1,-1,-1,-1,9,5,4,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,0,8,11,4,9,5,-1,-1,-1,-1,-1,-1,-1,0,5,4,0,1,5,2,3,11,-1,-1,-1,-1,-1,-1,-1,2,1,5,2,5,8,2,8,11,4,8,5,-1,-1,-1,-1,10,3,11,10,1,3,9,5,4,-1,-1,-1,-1,-1,-1,-1,4,9,5,0,8,1,8,10,1,8,11,10,-1,-1,-1,-1,5,4,0,5,0,11,5,11,10,11,0,3,-1,-1,-1,-1,5,4,8,5,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,9,7,8,5,7,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,3,0,9,5,3,5,7,3,-1,-1,-1,-1,-1,-1,-1,0,7,8,0,1,7,1,5,7,-1,-1,-1,-1,-1,-1,-1,1,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,7,8,9,5,7,10,1,2,-1,-1,-1,-1,-1,-1,-1,10,1,2,9,5,0,5,3,0,5,7,3,-1,-1,-1,-1,8,0,2,8,2,5,8,5,7,10,5,2,-1,-1,-1,-1,2,10,5,2,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,7,9,5,7,8,9,3,11,2,-1,-1,-1,-1,-1,-1,-1,9,5,7,9,7,2,9,2,0,2,7,11,-1,-1,-1,-1,2,3,11,0,1,8,1,7,8,1,5,7,-1,-1,-1,-1,11,2,1,11,1,7,7,1,5,-1,-1,-1,-1,-1,-1,-1,9,5,8,8,5,7,10,1,3,10,3,11,-1,-1,-1,-1,5,7,0,5,0,9,7,11,0,1,0,10,11,10,0,-1,11,10,0,11,0,3,10,5,0,8,0,7,5,7,0,-1,11,10,5,7,11,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,0,1,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,1,9,8,5,10,6,-1,-1,-1,-1,-1,-1,-1,1,6,5,2,6,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,6,5,1,2,6,3,0,8,-1,-1,-1,-1,-1,-1,-1,9,6,5,9,0,6,0,2,6,-1,-1,-1,-1,-1,-1,-1,5,9,8,5,8,2,5,2,6,3,2,8,-1,-1,-1,-1,2,3,11,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,0,8,11,2,0,10,6,5,-1,-1,-1,-1,-1,-1,-1,0,1,9,2,3,11,5,10,6,-1,-1,-1,-1,-1,-1,-1,5,10,6,1,9,2,9,11,2,9,8,11,-1,-1,-1,-1,6,3,11,6,5,3,5,1,3,-1,-1,-1,-1,-1,-1,-1,0,8,11,0,11,5,0,5,1,5,11,6,-1,-1,-1,-1,3,11,6,0,3,6,0,6,5,0,5,9,-1,-1,-1,-1,6,5,9,6,9,11,11,9,8,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,4,7,3,6,5,10,-1,-1,-1,-1,-1,-1,-1,1,9,0,5,10,6,8,4,7,-1,-1,-1,-1,-1,-1,-1,10,6,5,1,9,7,1,7,3,7,9,4,-1,-1,-1,-1,6,1,2,6,5,1,4,7,8,-1,-1,-1,-1,-1,-1,-1,1,2,5,5,2,6,3,0,4,3,4,7,-1,-1,-1,-1,8,4,7,9,0,5,0,6,5,0,2,6,-1,-1,-1,-1,7,3,9,7,9,4,3,2,9,5,9,6,2,6,9,-1,3,11,2,7,8,4,10,6,5,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,2,4,2,0,2,7,11,-1,-1,-1,-1,0,1,9,4,7,8,2,3,11,5,10,6,-1,-1,-1,-1,9,2,1,9,11,2,9,4,11,7,11,4,5,10,6,-1,8,4,7,3,11,5,3,5,1,5,11,6,-1,-1,-1,-1,5,1,11,5,11,6,1,0,11,7,11,4,0,4,11,-1,0,5,9,0,6,5,0,3,6,11,6,3,8,4,7,-1,6,5,9,6,9,11,4,7,9,7,11,9,-1,-1,-1,-1,10,4,9,6,4,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,10,6,4,9,10,0,8,3,-1,-1,-1,-1,-1,-1,-1,10,0,1,10,6,0,6,4,0,-1,-1,-1,-1,-1,-1,-1,8,3,1,8,1,6,8,6,4,6,1,10,-1,-1,-1,-1,1,4,9,1,2,4,2,6,4,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,9,2,4,9,2,6,4,-1,-1,-1,-1,0,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,8,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,10,4,9,10,6,4,11,2,3,-1,-1,-1,-1,-1,-1,-1,0,8,2,2,8,11,4,9,10,4,10,6,-1,-1,-1,-1,3,11,2,0,1,6,0,6,4,6,1,10,-1,-1,-1,-1,6,4,1,6,1,10,4,8,1,2,1,11,8,11,1,-1,9,6,4,9,3,6,9,1,3,11,6,3,-1,-1,-1,-1,8,11,1,8,1,0,11,6,1,9,1,4,6,4,1,-1,3,11,6,3,6,0,0,6,4,-1,-1,-1,-1,-1,-1,-1,6,4,8,11,6,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,10,6,7,8,10,8,9,10,-1,-1,-1,-1,-1,-1,-1,0,7,3,0,10,7,0,9,10,6,7,10,-1,-1,-1,-1,10,6,7,1,10,7,1,7,8,1,8,0,-1,-1,-1,-1,10,6,7,10,7,1,1,7,3,-1,-1,-1,-1,-1,-1,-1,1,2,6,1,6,8,1,8,9,8,6,7,-1,-1,-1,-1,2,6,9,2,9,1,6,7,9,0,9,3,7,3,9,-1,7,8,0,7,0,6,6,0,2,-1,-1,-1,-1,-1,-1,-1,7,3,2,6,7,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,11,10,6,8,10,8,9,8,6,7,-1,-1,-1,-1,2,0,7,2,7,11,0,9,7,6,7,10,9,10,7,-1,1,8,0,1,7,8,1,10,7,6,7,10,2,3,11,-1,11,2,1,11,1,7,10,6,1,6,7,1,-1,-1,-1,-1,8,9,6,8,6,7,9,1,6,11,6,3,1,3,6,-1,0,9,1,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,0,7,0,6,3,11,0,11,6,0,-1,-1,-1,-1,7,11,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,1,9,8,3,1,11,7,6,-1,-1,-1,-1,-1,-1,-1,10,1,2,6,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,8,6,11,7,-1,-1,-1,-1,-1,-1,-1,2,9,0,2,10,9,6,11,7,-1,-1,-1,-1,-1,-1,-1,6,11,7,2,10,3,10,8,3,10,9,8,-1,-1,-1,-1,7,2,3,6,2,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,0,8,7,6,0,6,2,0,-1,-1,-1,-1,-1,-1,-1,2,7,6,2,3,7,0,1,9,-1,-1,-1,-1,-1,-1,-1,1,6,2,1,8,6,1,9,8,8,7,6,-1,-1,-1,-1,10,7,6,10,1,7,1,3,7,-1,-1,-1,-1,-1,-1,-1,10,7,6,1,7,10,1,8,7,1,0,8,-1,-1,-1,-1,0,3,7,0,7,10,0,10,9,6,10,7,-1,-1,-1,-1,7,6,10,7,10,8,8,10,9,-1,-1,-1,-1,-1,-1,-1,6,8,4,11,8,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,6,11,3,0,6,0,4,6,-1,-1,-1,-1,-1,-1,-1,8,6,11,8,4,6,9,0,1,-1,-1,-1,-1,-1,-1,-1,9,4,6,9,6,3,9,3,1,11,3,6,-1,-1,-1,-1,6,8,4,6,11,8,2,10,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,11,0,6,11,0,4,6,-1,-1,-1,-1,4,11,8,4,6,11,0,2,9,2,10,9,-1,-1,-1,-1,10,9,3,10,3,2,9,4,3,11,3,6,4,6,3,-1,8,2,3,8,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,0,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,4,2,4,6,4,3,8,-1,-1,-1,-1,1,9,4,1,4,2,2,4,6,-1,-1,-1,-1,-1,-1,-1,8,1,3,8,6,1,8,4,6,6,10,1,-1,-1,-1,-1,10,1,0,10,0,6,6,0,4,-1,-1,-1,-1,-1,-1,-1,4,6,3,4,3,8,6,10,3,0,3,9,10,9,3,-1,10,9,4,6,10,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,5,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,5,11,7,6,-1,-1,-1,-1,-1,-1,-1,5,0,1,5,4,0,7,6,11,-1,-1,-1,-1,-1,-1,-1,11,7,6,8,3,4,3,5,4,3,1,5,-1,-1,-1,-1,9,5,4,10,1,2,7,6,11,-1,-1,-1,-1,-1,-1,-1,6,11,7,1,2,10,0,8,3,4,9,5,-1,-1,-1,-1,7,6,11,5,4,10,4,2,10,4,0,2,-1,-1,-1,-1,3,4,8,3,5,4,3,2,5,10,5,2,11,7,6,-1,7,2,3,7,6,2,5,4,9,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,6,0,6,2,6,8,7,-1,-1,-1,-1,3,6,2,3,7,6,1,5,0,5,4,0,-1,-1,-1,-1,6,2,8,6,8,7,2,1,8,4,8,5,1,5,8,-1,9,5,4,10,1,6,1,7,6,1,3,7,-1,-1,-1,-1,1,6,10,1,7,6,1,0,7,8,7,0,9,5,4,-1,4,0,10,4,10,5,0,3,10,6,10,7,3,7,10,-1,7,6,10,7,10,8,5,4,10,4,8,10,-1,-1,-1,-1,6,9,5,6,11,9,11,8,9,-1,-1,-1,-1,-1,-1,-1,3,6,11,0,6,3,0,5,6,0,9,5,-1,-1,-1,-1,0,11,8,0,5,11,0,1,5,5,6,11,-1,-1,-1,-1,6,11,3,6,3,5,5,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,11,9,11,8,11,5,6,-1,-1,-1,-1,0,11,3,0,6,11,0,9,6,5,6,9,1,2,10,-1,11,8,5,11,5,6,8,0,5,10,5,2,0,2,5,-1,6,11,3,6,3,5,2,10,3,10,5,3,-1,-1,-1,-1,5,8,9,5,2,8,5,6,2,3,8,2,-1,-1,-1,-1,9,5,6,9,6,0,0,6,2,-1,-1,-1,-1,-1,-1,-1,1,5,8,1,8,0,5,6,8,3,8,2,6,2,8,-1,1,5,6,2,1,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,6,1,6,10,3,8,6,5,6,9,8,9,6,-1,10,1,0,10,0,6,9,5,0,5,6,0,-1,-1,-1,-1,0,3,8,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,7,5,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,11,7,5,8,3,0,-1,-1,-1,-1,-1,-1,-1,5,11,7,5,10,11,1,9,0,-1,-1,-1,-1,-1,-1,-1,10,7,5,10,11,7,9,8,1,8,3,1,-1,-1,-1,-1,11,1,2,11,7,1,7,5,1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,7,1,7,5,7,2,11,-1,-1,-1,-1,9,7,5,9,2,7,9,0,2,2,11,7,-1,-1,-1,-1,7,5,2,7,2,11,5,9,2,3,2,8,9,8,2,-1,2,5,10,2,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,8,2,0,8,5,2,8,7,5,10,2,5,-1,-1,-1,-1,9,0,1,5,10,3,5,3,7,3,10,2,-1,-1,-1,-1,9,8,2,9,2,1,8,7,2,10,2,5,7,5,2,-1,1,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,7,0,7,1,1,7,5,-1,-1,-1,-1,-1,-1,-1,9,0,3,9,3,5,5,3,7,-1,-1,-1,-1,-1,-1,-1,9,8,7,5,9,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,8,4,5,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,5,0,4,5,11,0,5,10,11,11,3,0,-1,-1,-1,-1,0,1,9,8,4,10,8,10,11,10,4,5,-1,-1,-1,-1,10,11,4,10,4,5,11,3,4,9,4,1,3,1,4,-1,2,5,1,2,8,5,2,11,8,4,5,8,-1,-1,-1,-1,0,4,11,0,11,3,4,5,11,2,11,1,5,1,11,-1,0,2,5,0,5,9,2,11,5,4,5,8,11,8,5,-1,9,4,5,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,5,10,3,5,2,3,4,5,3,8,4,-1,-1,-1,-1,5,10,2,5,2,4,4,2,0,-1,-1,-1,-1,-1,-1,-1,3,10,2,3,5,10,3,8,5,4,5,8,0,1,9,-1,5,10,2,5,2,4,1,9,2,9,4,2,-1,-1,-1,-1,8,4,5,8,5,3,3,5,1,-1,-1,-1,-1,-1,-1,-1,0,4,5,1,0,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,4,5,8,5,3,9,0,5,0,3,5,-1,-1,-1,-1,9,4,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,11,7,4,9,11,9,10,11,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,7,9,11,7,9,10,11,-1,-1,-1,-1,1,10,11,1,11,4,1,4,0,7,4,11,-1,-1,-1,-1,3,1,4,3,4,8,1,10,4,7,4,11,10,11,4,-1,4,11,7,9,11,4,9,2,11,9,1,2,-1,-1,-1,-1,9,7,4,9,11,7,9,1,11,2,11,1,0,8,3,-1,11,7,4,11,4,2,2,4,0,-1,-1,-1,-1,-1,-1,-1,11,7,4,11,4,2,8,3,4,3,2,4,-1,-1,-1,-1,2,9,10,2,7,9,2,3,7,7,4,9,-1,-1,-1,-1,9,10,7,9,7,4,10,2,7,8,7,0,2,0,7,-1,3,7,10,3,10,2,7,4,10,1,10,0,4,0,10,-1,1,10,2,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,7,1,3,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,0,8,1,8,7,1,-1,-1,-1,-1,4,0,3,7,4,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,8,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,11,9,10,-1,-1,-1,-1,-1,-1,-1,0,1,10,0,10,8,8,10,11,-1,-1,-1,-1,-1,-1,-1,3,1,10,11,3,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,11,1,11,9,9,11,8,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,1,2,9,2,11,9,-1,-1,-1,-1,0,2,11,8,0,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,2,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,10,8,9,-1,-1,-1,-1,-1,-1,-1,9,10,2,0,9,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,0,1,8,1,10,8,-1,-1,-1,-1,1,10,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,8,9,1,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]);var c=[[0,0,0],[1,0,0],[1,1,0],[0,1,0],[0,0,1],[1,0,1],[1,1,1],[0,1,1]],d=[[0,1],[1,2],[2,3],[3,0],[4,5],[5,6],[6,7],[7,4],[0,4],[1,5],[2,6],[3,7]];return{isosurface:b}}(xtal);var xtal=function(a){return a}(xtal||{});xtal.model=function(a){function b(a){this._atoms=[],this._chains=null,this.chain_indices=[],this.unit_cell=null,this.space_group=null,this.has_hydrogens=!1,this.ligand_flags=null,this.connectivity=null,this.atom_lookup=null,this.source=null,this.from_mmcif=function(a){this.source="mmcif";for(var b=0,d=null,f=a.loop_dict("_atom_site"),g=0;g<f.length;g++){var h=new c;h.from_mmcif(f[g]),h.i_seq=g,this._atoms.push(h),h.chain!=d&&b++,this.chain_indices.push(b),d=h.chain}if(0==this._atoms.length)throw Error("No atom records found.");var i=[a.get("_cell.length_a"),a.get("_cell.length_b"),a.get("_cell.length_c"),a.get("_cell.angle_alpha"),a.get("_cell.angle_beta"),a.get("_cell.angle_gamma")];this.process_unit_cell_params(i),this.space_group=a.get("_symmetry.space_group_name_H-M"),this.connectivity=e(this._atoms)},this.from_cif=function(a){this.source="cif";var b=[a.get("_cell_length_a"),a.get("_cell_length_b"),a.get("_cell_length_c"),a.get("_cell_angle_alpha"),a.get("_cell_angle_beta"),a.get("_cell_angle_gamma")];if(!this.process_unit_cell_params(b))throw Error("Can't extract unit cell - required for small molecules.");this.space_group=a.get("_symmetry_space_group_name_H-M");for(var d=a.get("_atom_site_label"),f=a.get("_atom_site_type_symbol"),g=a.get("_atom_site_fract_x"),h=a.get("_atom_site_fract_y"),i=a.get("_atom_site_fract_z"),j=a.get("_atom_site_U_iso_or_equiv"),k=a.get("_atom_site_occupancy"),l=0;l<d.length;l++){var n=new c;n.i_seq=l,n.name=d[l],n.element=f[l],n._u_iso=j[l],n.b=j[l]*j[l]*m,n.occ=k[l],n.xyz=this.unit_cell.orthogonalize((g[l],h[l],i[l])),this._atoms.push(n)}if(0==this._atoms.length)throw Error("No atom records found.");this.connectivity=e(this._atoms)},this.from_monlib=function(a){this.source="monlib";for(var b=0,d=null,g=a.loop_dict("_chem_comp_atom"),h=0;h<g.length;h++){var i=new c;i.from_monlib(g[h]),i.i_seq=h,this._atoms.push(i),i.chain!=d&&b++,this.chain_indices.push(b),d=i.chain}if(0==this._atoms.length)throw Error("No atom records found.");this.connectivity=e(this._atoms),this.atom_lookup=f(this._atoms)},this.from_pdb=function(a){this.source="pdb",console.log("from_pdb");for(var b=a.split("\n"),d=0,f=null,g=0,h=null,i=0;i<b.length;i++){line=b[i];var j=line.substring(0,6);if("ATOM  "==j||"HETATM"==j){var k=new c;k.from_pdb_line(line),k.i_seq=g++,this._atoms.push(k),this.has_hydrogens||"H"!=k.element||(this.has_hydrogens=!0),k.chain!=f&&d++,this.chain_indices.push(d),f=k.chain,h=k}else if("ANISOU"==j)h.set_uij_from_anisou(line);else if("CRYST1"==j){var l=parseFloat(line.substring(6,15)),m=parseFloat(line.substring(15,24)),n=parseFloat(line.substring(24,33)),o=parseFloat(line.substring(33,40)),p=parseFloat(line.substring(40,47)),q=parseFloat(line.substring(47,54));line.substring(55,66);this.unit_cell=new xtal.UnitCell(l,m,n,o,p,q)}else"TER"==j.substring(0,3)&&d++}if(0==this._atoms.length)throw Error("No atom records found.");this.connectivity=e(this._atoms)},this.process_unit_cell_params=function(a){for(var b=[],c=0;6>c&&a[c];c++)b.push(parseInt(a[c]));return 6==b.length?(this.unit_cell=new xtal.UnitCell(b[0],b[1],b[2],b[3],b[4],b[5]),!0):!1},this.atoms=function(){return this._atoms},this.residues=function(){return[]},this.chains=function(){if(null==this._chains){this._chains=[];for(var a=null,b=null,c=0;c<this._atoms.length;c++){var d=this.chain_indices[c];d!=a&&(null!=b&&this._chains.push(new l(b)),b=[]),b.push(this._atoms[c]),a=d}this._chains.push(new l(b))}return this._chains},this.extract_trace=function(){return g(this)},this.extract_ligands=function(){if(null==this.ligand_flags){this.ligand_flags=[];for(var a=0;a<this._atoms.length;a++){var b=this._atoms[a];!b.is_water()&&s.indexOf(b.resname)<0&&t.indexOf(b.resname)<0?this.ligand_flags.push(!0):this.ligand_flags.push(!1)}}return this.ligand_flags},this.select_atom_names=function(a){var b=[];console.log(a,a.length);for(var c=0;c<a.length;c++)console.log(a[c]),b.push(this.atom_lookup[a[c]]);return b},this.selection=function(a){for(var b=[],c=new i(a),d=0;d<this._atoms.length;d++)c.is_in_selection(this._atoms[d])&&(console.log("A"),b.push(d));return console.log(b.length),b},this.extract_interesting_residues=function(){return h(this)},this.update_atoms=function(a){return this._atoms=a.atoms(),this.chain_indices=a.chain_indices,this.connectivity=a.connectivity,this.has_hydrogens=a.has_hydrogens,this.ligand_flags=null,this},this.get_center_and_size=function(){for(var a=0,b=0,c=0,d=this._atoms.length,e=-99999,f=99999,g=-99999,h=99999,i=-99999,j=99999,k=0;d>k;k++){var l=this._atoms[k].xyz[0],m=this._atoms[k].xyz[1],n=this._atoms[k].xyz[2];a+=l,b+=m,c+=n,f>l&&(f=l),l>e&&(e=l),h>m&&(h=m),m>e&&(g=m),j>n&&(j=n),n>i&&(i=n)}var o=Math.abs(e-f),p=Math.abs(g-h),q=Math.abs(i-j);return[[a/d,b/d,c/d],Math.max(o,p,q)]}}function c(a){this.hetero=!1,this.name="",this.altloc="",this.resname="",this.chain="",this.resseq="",this.xyz=[0,0,0],this.occ=1,this.b=0,this._u_iso=null,this.uij=null,this._sphere_transform=null,this.element="",this.charge=0,this.i_seq=null,this.from_mmcif=function(a){"HETATM"==a.group_pdb&&(this.hetero=!0),this.name=a.label_atom_id,this.altloc=a.label_alt_id,"."==this.altloc&&(this.altloc=""),this.resname=a.label_comp_id,this.chain=a.label_asym_id,this.resseq=a.label_entity_id,this.icode=a.label_seq_id;var b=a.cartn_x,c=a.cartn_y,d=a.cartn_z;this.xyz=[b,c,d],this.occ=a.occupancy,this.b=a.b_iso_or_equiv,this.element=a.type_symbol,this.charge=a.pdbx_formal_charge},this.from_monlib=function(a){var b=a.x,c=a.y,d=a.z;this.name=a.atom_id,this.xyz=[b,c,d],this.element=a.type_symbol,this.charge=a.partial_charge},this.from_pdb_line=function(a){if(a.length<66)throw Error("ATOM or HETATM record is too short: "+a);var b=a.substring(0,6);if("HETATM"==b)this.hetero=!0;else if("ATOM  "!=b)throw Error("Wrong record type: "+b);this.name=a.substring(12,16).trim(),this.altloc=a.substring(16,17).trim(),this.resname=a.substring(17,20).trim(),this.chain=a.substring(20,22).trim(),this.resseq=a.substring(22,26),this._resseq_as_int=null,this.icode=a.substring(26,27).trim();var c=parseFloat(a.substring(30,38)),d=parseFloat(a.substring(38,46)),e=parseFloat(a.substring(46,54));this.xyz=[c,d,e],this.occ=parseFloat(a.substring(54,60)),this.b=parseFloat(a.substring(60,66)),a.length>=78&&(this.element=a.substring(76,78).trim().toUpperCase()),a.length>=80&&(this.charge=a.substring(78,80).trim())},this.set_uij_from_anisou=function(a){var b=line.substring(0,6);if("ANISOU"!=b)throw Error("Wrong record type: "+b);var c=a.substring(12,16).trim(),d=a.substring(16,17).trim(),e=a.substring(17,20).trim(),f=a.substring(20,22).trim(),g=a.substring(22,26),h=a.substring(26,27).trim();if(c!=this.name||d!=this.altloc||e!=this.resname||f!=this.chain||g!=this.resseq||h!=this.icode)throw Error("Mismatch to ATOM record: "+a);this.uij=[parseInt(a.substring(28,35))*q,parseInt(a.substring(35,42))*q,parseInt(a.substring(42,49))*q,parseInt(a.substring(49,56))*q,parseInt(a.substring(56,63))*q,parseInt(a.substring(63,70))*q]},this.resseq_as_int=function(){return null==this._resseq_as_int&&(this._resseq_as_int=parseInt(this.resseq)),this._resseq_as_int},this.resid=function(){return this.resseq+this.icode},this.b_as_u=function(){return null==this._u_iso&&(this._u_iso=Math.sqrt(this.b/m)),this._u_iso},this.distance=function(a){return xtal.distance(this.xyz,a.xyz)},this.midpoint=function(a){return xtal.midpoint(this.xyz,a.xyz)},this.is_hydrogen=function(){return"H"==this.element||"D"==this.element},this.is_s_or_p=function(){return"S"==this.element||"P"==this.element},this.is_ion=function(){return this.element==this.resname},this.is_water=function(){return"HOH"==this.resname},this.as_vec3=function(){return(new THREE.Vector3).fromArray(this.xyz)},this.is_same_residue=function(a,b){return a.resseq==this.resseq&&a.icode==this.icode&&a.chain==this.chain&&a.resname==this.resname&&(b||a.altloc==this.altloc)},this.is_same_conformer=function(a){return""==this.altloc||""==a.altloc||this.altloc==a.altloc},this.is_main_conformer=function(){return""==this.altloc||"A"==this.altloc},this.is_bonded_to=function(a){if(!this.is_same_conformer(a))return!1;if("H"==this.element&&"H"==a.element)return!1;var b=this.distance(a);if("H"==this.element||"H"==a.element){if(o>=b)return!0}else{if(n>=b)return!0;if(p>b&&(this.is_s_or_p()||a.is_s_or_p()))return!0}return!1},this.ellipsoid_to_sphere_transform=function(){return null==this._sphere_transform&&(this._sphere_transform=xtal.ellipsoid_to_sphere_transform(this.uij,this.xyz)),this._sphere_transform}}function d(a,b){b=b||3;for(var c=[],d=[],e=[],f=0;f<a.length;f++)c.push(a[f].xyz[0]),d.push(a[f].xyz[1]),e.push(a[f].xyz[2]);this.box_length=b;var g=.001;this.xmin=Math.min.apply(null,c)-g,this.xmax=Math.max.apply(null,c)+g,this.ymin=Math.min.apply(null,d)-g,this.ymax=Math.max.apply(null,d)+g,this.zmin=Math.min.apply(null,e)-g,this.zmax=Math.max.apply(null,e)+g,console.log("xrange: "+this.xmin+" - "+this.xmax),console.log("yrange: "+this.ymin+" - "+this.ymax),console.log("zrange: "+this.zmin+" - "+this.zmax),this.boxes=[],this.atom_lookup=[];this.xmin,this.ymin,this.zmin;this.xdim=Math.ceil((this.xmax-this.xmin)/b),this.ydim=Math.ceil((this.ymax-this.ymin)/b),this.zdim=Math.ceil((this.zmax-this.zmin)/b),console.log("Dimensions: "+this.xdim+"x"+this.ydim+"x"+this.zdim),this.xydim=this.xdim*this.ydim;for(var h=this.xydim*this.zdim,f=0;h>f;f++)this.boxes.push([]);this.get_box_index=function(a){var c=Math.floor((a[0]-this.xmin)/b),d=Math.floor((a[1]-this.ymin)/b),e=Math.floor((a[2]-this.zmin)/b),f=e*this.xydim+d*this.xdim+c;return f};for(var f=0;f<a.length;f++){var i=this.get_box_index(a[f].xyz);if(i>=this.boxes.length||0>i)throw Error("Box ID "+i+" is out of bounds (nboxes = "+this.boxes.length+")");this.boxes[i].push(f),this.atom_lookup.push(i)}this.get_box_grid_coords=function(a){var b=Math.max(a%this.xydim,0),c=Math.max(b%this.xdim,0),d=Math.floor(b/this.xdim),e=Math.floor(a/this.xydim);return[c,d,e]},this.get_nearby_atoms=function(a){var b=[],c=this.atom_lookup[a],d=this.get_box_grid_coords(c),e=d[2]*this.xydim+d[1]*this.xdim+d[0];if(e!=c)throw Error(e);for(var f=!1,g=d[0]-1;g<=d[0]+1;g++)if(!(0>g||g>=this.xdim))for(var h=d[1]-1;h<=d[1]+1;h++)if(!(0>h||h>=this.ydim))for(var i=d[2]-1;i<=d[2]+1;i++)if(!(0>i||i>=this.zdim)){var j=i*this.xydim+h*this.xdim+g;if(j>=this.boxes.length||0>j)throw Error("Box ID "+j+" is out of bounds (nboxes = "+this.boxes.length+")");for(var k=0;k<this.boxes[j].length;k++)other_id=this.boxes[j][k],other_id!=a?b.push(other_id):f=!0}if(!f)throw Error("Atom "+a+" not found (box_id = "+c+", uvw = "+d+")");return b}}function e(a){for(var b=[],c=new d(a),e=0;e<a.length;e++)b.push([]);for(var e=0;e<a.length;e++)for(var f=c.get_nearby_atoms(e),g=0;g<f.length;g++){var h=f[g];a[e].is_bonded_to(a[h])&&(b[e].push(h),b[h].push(e))}return b}function f(a){for(var b=[],c=0;c<a.length;c++){var d=a[c].name;if(b[d])throw Error("Duplicate atom "+d);b[d]=c}return b}function g(a){for(var b=[],c=[],d=null,e=null,f=0;f<a.atoms().length;f++){var g=a.atoms()[f],h=a.chain_indices[f],i=!1;if((""==g.altloc||"A"==g.altloc)&&("CA"==g.name&&"C"==g.element||"P"==g.name)){if(null!=e&&d==h){var j=g.distance(a.atoms()[e]);"CA"==g.name&&5.5>=j||"P"==g.name&&7.5>j?(c.push(g),d=h,e=f):i=!0}else i=!0;i&&(c=[g],b.push(c),d=h,e=f)}}for(var k=[],f=0;f<b.length;f++)b[f].length>2&&k.push(b[f]);return k}function h(a){for(var b=[],c=null,d=null,e=0;e<a.atoms().length;e++){var f=a.atoms()[e];"HOH"!=f.resname&&s.indexOf(f.resname)<0&&t.indexOf(f.resname)<0&&(d&&f.is_same_residue(d,!0)?c.push(f):(c=[f],b.push(c)),d=f)}for(var g=[],e=0;e<b.length;e++){if(0==b[e].length)throw Error("Empty atom list");var f=b[e][0],h="ligand";1==b[e].length&&r.indexOf(f.resname)>=0&&(h="ion");for(var i=sprintf("%3s %2s %4d%1s",f.resname,f.chain,f.resseq,f.icode),j=0,k=0,l=0,m=0;m<b[e].length;m++){var f=b[e][m];j+=f.xyz[0],k+=f.xyz[1],l+=f.xyz[2]}var n=j/b[e].length,o=k/b[e].length,p=l/b[e].length;g.push([h+": "+i,[n,o,p]])}return g}function i(a){this.selection_str=a,this.chains=null,this.resnames=null,this.resseqs=null,this.atom_names=null;var b=a.split(" ");if(0==b.length)throw Error("Empty selection string");for(var c=0;c<b.length;c++){var d=b[c].split("="),e=d[0],f=d[1].split(",");
if(0==f.length)throw Error("Misformed selection '"+b[c]+"'");if("chain"==e){null==this.chains&&(this.chains=[]);for(var g=0;g<f.length;g++)j(f[g],"chain ID",2),this.chains.push(f[g])}else if("resnam"==e.substring(0,6)){null==this.resnames&&(this.resnames=[]);for(var g=0;g<f.length;g++)j(f[g],"residue name",3),this.resnames.push(f[g])}else if("resi"==e||"resseq"==e){null==this.resseqs&&(this.resseqs=[]);for(var g=0;g<f.length;g++){var h=f[g].split("-");if(1==h.length){j(f[g],"residue number",4);var i=[parseInt(f[g]),parseInt(f[g])];this.resseqs.push(i)}else{if(2!=h.length)throw Error("Invalid residue range '"+f[g]+"'");var i=[parseInt(h[0]),parseInt(h[1])];this.resseqs.push(i)}}}else{if("name"!=e)throw Error("Unrecognized selector token '"+e+"'");null==this.atom_names&&(this.atom_names=[]);for(var g=0;g<f.length;g++)j(f[g],"atom name",4),this.atom_names.push(f[g])}}this.is_in_selection=function(a){var b=null==this.chains,c=null==this.resnames,d=null==this.resseqs,e=null==this.atom_names;if(null!=this.chains){for(var f=0;f<this.chains.length;f++)if(a.chain==this.chains[f]){b=!0;break}if(!b)return!1}if(null!=this.resnames){for(var f=0;f<this.resnames.length;f++)if(a.resname==this.resnames[f]){c=!0;break}if(!c)return!1}if(null!=this.resseqs){for(var f=0;f<this.resseqs.length;f++){var g=this.resseqs[f];if(g[0]<=a.resseq_as_int()<=g[1]){d=!0;break}}if(!d)return!1}if(null!=this.atom_names){for(var f=0;f<this.atom_names.length;f++)if(a.name==this.atom_names[f]){e=!0;break}if(!e)return!1}return!0}}function j(a,b,c){if(!(c>=(a>0)))throw Error("Bad "+b+" '"+sel_fields+"'")}function k(){this._atoms=[],this.n_atoms=function(){return this._atoms.length},this.atoms=function(){return this._atoms},this.append_atom=function(a){this._atoms.push(a)},this.get_atom=function(a,b){for(var c=0;c<this._atoms.length;c++){var d=this._atoms[c];if(d.name==a&&(d.altloc==b||null==b&&d.is_main_conformer()))return d}return null}}function l(a){this._residues=[],this.id=a[0].chain;for(var b=null,c=null,d=0;d<a.length;d++){var e=a[d],f=e.resid();f!=c?(b=new k,this._residues.push(b),b.append_atom(e),c=f):b.append_atom(e)}this.residues=function(){return this._residues},this.atoms=function(){for(var a=[],b=0;b<this._residues.length;b++)a.push(this._residues[b].atoms());return a}}var m=25.13272*3.14159,n=1.99,o=1.3,p=2.2,q=1e-4,r=["H","HE","LI","BE","B","C","N","O","F","NE","NA","MG","AL","SI","P","S","CL","AR","K","CA","SC","TI","V","CR","MN","FE","CO","NI","CU","ZN","GA","GE","AS","SE","BR","KR","RB","SR","Y","ZR","NB","MO","TC","RU","RH","PD","AG","CD","IN","SN","SB","TE","I","XE","CS","BA","LA","CE","PR","ND","PM","SM","EU","GD","TB","DY","HO","ER","TM","YB","LU","HF","TA","W","RE","OS","IR","PT","AU","HG","TL","PB","BI","PO","AT","RN","FR","RA","AC","TH","PA","U","NP","PU","AM","CM","BK","CF","ES","FM","MD","NO","LR","RF","DB","SG","BH","HS","MT","DS","RG"],s=["ALA","ARG","ASN","ASP","CYS","GLN","GLU","GLY","HIS","ILE","LEU","LYS","MET","MSE","PHE","PRO","SER","THR","TRP","TYR","VAL","UNK"],t=["DA","DC","DG","DT","A","C","G","U","rA","rC","rG","rU","Ar","Cr","Gr","Ur"];return{Model:b,Atom:c,Cubicles:d}}(xtal);var space_group_table={lookup:{"F m 2 m":42," P 2 -2a":28,"P m 2 m":25," C 2x":5," C 2y":5,"P m 2 a":28,"P n n m":58," P 2 -2n":34,"I 2 1 1":5," P 2bc 2 -1bc":59,"P 21/c 1 1":14,"P c m a":55," B -2 2":38," P -2bc -2c":29,"-P 3* 2":166," I -4 -2c":120,"I 41 c d":110,"-P 4c 2c":132,"P c m m":51,"P n n b":52,"B m 1 1":8," P 2 -2c":27," F -4 2 3":216," P 2 -2b":28,"A 21 a m":36," P -2ab":7,"C c c a":68," B -2a 2":39,"P n n n":48,"C c c m":66,"-I 2c 2":74,"B m m m":65,"F 2 d d":43,' R 3 2"':155," P 2ac 2ac -1ac":59,"B b a 2":41,"-P 4a 2b":125," A 2y":5,"B 2 1 1":5," P 4 -2c":103," I 4bw 2bw -1bw":141," P 6c -2":185,"P n n 2":34,"B b 2 b":37,"B b a b":68," P 4 -2n":104,"P -3":147,"P -1":2," I -2c 2":46," P 6 -2":183,"P -6":174,"C c c 2":37,"P -4":81," F 4d 2 3":210,"-P 2x":10,"-P 2y":10,"-P 2b":13,"-P 2c":11,"C m 2 a":39,"-P 2a":13," I 4 -2":107,"-B 2a 2":67,"I 41 m d":109,"I 41 3 2":214,"-P 2n":14,"C m 2 m":38,"B 2 m m":38,"P 21 c a":29,"P b n m":62," P 4 2 3 -1n":222," P 4w 2c":91,"P b n b":56,"P 21 c n":33,"-C 2 2":65," I 4bd 2c 3":214,"I c m m":74,"P n m m":59,"P n m n":58," P -2 -2bc":31,"P 43 21 2":96," B -2b 2":40,"P n m b":53,"P m -3 n":223,"-P 2 2b":51,"-P 2 2c":49,"-P 2yn":14,"P 1 21/m 1":11,"I -4":82,"-P 2a 2ab":57,"A 1 m 1":8,"-P 2 2n":58,"-P 2ya":13,"-P 2yb":11,"-P 2yc":13,"R 3":146,"P 21 m n":31,"A c a a":68,"A c a m":64," P -6c 2":188,"P 21 m a":26,"I 4/m m m":139,"P 63/m m c":194,"P 21 2 2":17,"P c m b":57," C 2 -2":35," I -2 -2":44," P -2ab 2ab":31,"-F 2uv 2vw 3":203,"P 42/m n m":136,"P n a m":62," P 4 2":89," P 62 2 (0 0 4)":180,"-P 2n 2b":52,"-I 2 2":71,"C 1 m 1":8," P 4 2 3":207,"P 1 a 1":7," P 2ac 2ab":19,"-P 2a 2bc":52,"I 41/a c d":142," P -2bc -2bc":30,"P 1 21/c 1":14,"-I 2b 2b":72,"-I 2b 2c":73,"P 2/b 1 1":13," P 4n -2n":102,"R -3 c":167," B -2ab 2":41,"I 2/m 1 1":12," B 2 2b":20,"C m m m":65,"-P 2bc":14,"F 4 3 2":209,"-P 2ab 2bc":48,"P -6 2 m":189,"I m m 2":44,"-P 4c 2":131,"-F 4a 2 3":226,"P 43 3 2":212,"B 2 c m":39,"-P 3 2c":163," B -2xb":9,"-I 4 2c":140,"B 2 c b":41,"P c 21 b":29," P 2 2 -1ac":50," P -6 2":187,"F d -3 m":227," I -2b -2b":45,"-B 2xb":15,"P c 21 n":33,"P 42/m m c":131," F -2d 2":43,"I 4/m":87,"P 1 1 2/n":13,"P b 2 b":27,"P 42 21 2":94,"P 1 1 2/m":10,"P 1 1 2/b":13,"P b 2 n":30,"P 1 1 2/a":13,"B m m 2":38,"-P 4ac 2b":133,"-P 2b 2a":57,"C c c b":68,"-P 2b 2c":54,"-P 2b 2b":49,"-P 2b 2n":52,"-P 2n 2ac":62,"I c m a":72,"P 32 2 1":154,"P 65 2 2":179,"-P 4ac 2a":137,"P 42/m":84,"P m c 21":26," I 2 -2":44,"A 21 2 2":20,"C m 1 1":8,"P c 1 1":7," P -2 -2b":26," A 2 -2ab":41,"C 1 2/m 1":12,"-P 2c 2a":59,"-P 4 2":123,"-P 2ac 2ab 3":205,"P -6 2 c":190,"F 2 3":196,"B m m b":63," P 2 2 -1bc":50,' R 3 -2"c':161,"P 2 n n":34," I 2b 2c 3":199,"-P 2ac 2ab":61,"-P 2ac 2ac":55,"P 2 n a":30,"P 4 m m":99," C -2xc":9," F 2 2 -1d":70,"F -4 3 m":216,"A c 2 m":39," P 2 2 3 -1n":201," P 2 -2bc":30," P 2c -2ac":29," B -2":8,"-B 2ab 2":64,"I 1 1 2":5,"C 2/c 1 1":15," I -2y":8,"P b m b":49," P 4c 2":93,"F 2 m m":42,"-C 2c 2":63," P -2 -2":25,"-A 2":12," P 4n -1n":86," P 65 2 (0 0 1)":179,"-P 4a 2bc":126,"-F 2 2":69,"P 31 1 2":151,"I m a m":74,"-C 2a 2c":68,"P b m 2":28,"-P 2ac 2n":62,"-P 2ac 2a":57,"-P 2ac 2b":60,"-P 2ac 2c":54," R 3":146," I 4 -2c":108,"B 2/b 1 1":15," P 2 2b":17,"-F 4vw 2vw 3":227," P -2a 2a":26," C 2c -2c":36," I 2b 2c":24,"P 2 m b":28,"I 1 1 m":8,"I m 2 m":44,"I m 2 a":46," P -2n -2ac":33,"-P 4a 2a":129,"I 1 1 b":9,"P 2 m m":25,"-P 2 2bc":53,"I 1 1 a":9," A -2a 2":37,"P b m a":57,"B 2/n 1 1":15,"-I 2 2 3":204," I -2yc":9,"F 41 3 2":210," I -2ya":9,"-P 4bc":86,"-P 2ab 2ac":56,"P b m m":51,"P b m n":53,"I m a 2":46,"P c m 21":26," P -2 2":25,"-C 2c 2c":63,"-I 4ad":88,"A 1 2/n 1":15,'-R 3 2"c':167,"P 42 3 2":208,"-B 2x":12," P -2ya":7," P -2yc":7,"A 1 2 1":5,"I 1 2/m 1":12," P -2b 2":28," F -4a 2 3":219,"I 4 c m":108,"I 41/a m d":141," P -2n 2a":33,"-B 2b":15,"P 41 21 2":92," I -4":82," P 4":75,"I 4 2 2":97,"P 2 21 2":17," P 1":1," P 2":3," P 3":143,"P c m n":62,"P 43 2 2":95,"-C 2a 2a":67,"I b a 2":45,"C 2/m 1 1":12,"-I 4 2 3":229,"P 1 2/c 1":13,"P 42/n b c":133,"-A 2yab":15,"P 3":143,"-P 2c 2":51,"P 1":1,"P 6":168,"-P 2bc 2":55,"P 4":75," P 4abw 2nw":92,"I 1 2/a 1":15,"P 1 1 2":3,"-I 2ya":15,"-I 2yc":15,"-B 2 2":65,"P 4/m c c":124,"-P 4n 2 3":223,"F d -3":203," A -2 2":35,"P -4 21 c":114,"P 63":173,"-C 2ac 2":64,"P 6/m c c":192,"P -3 c 1":165," P 4n 2 -1n":134," P 4ab -1ab":85,"P 41 3 2":213,"P m -3":200,"-P 2 2ac":53,"I b a m":72,"P -4 2 m":111,"I c a b":73,"P b n a":60," F 2 -2d":43,"P -4 2 c":112," I 2 2 3":197," P 2c":4," C -2a 2":39,"I 2 2 2":23,"-P 2ab":13,"-P 2ac":14,"P c n b":60,"-P 2bc 2ab":56," P 4n 2n -1n":137,"P c n a":50,"B m a m":67,"P 6 2 2":177," P 4n 2ab -1n":138," P 32 2 (0 0 2)":153,"P 4/n c c":130," P -2ab -2":31," F -2 -2":42," P 2y":3," P 2x":3,"B b 1 1":9,"B 2 m b":40," P 2ac 2ab 3":198," I -2c -2c":46,"-P 2yab":14,"-P 2yac":13," I 2":5," P -4 2ab":113,"A 21 m a":36," P -2ac 2":30,'-P 3 2"':164,"C 1 2/c 1":15," I -4 -2":119,"P 4/m n c":128,"P m c b":55," B 2 2":21,"A c 2 a":41," P 2c 2":17,"P n n a":52," P -4 -2ab":117,"-A 2ab 2ab":64,"P 42/n m c":137,"P 63 c m":185,"P n a a":56,"P n a b":60,"A c m m":67,"P m -3 m":221,' P 32 2"':154,"-B 2ab 2b":68,"P m 1 1":6,"P n a n":52,"-P 2n 2a":62,"P 63 m c":186,"-P 2n 2c":60,"B m a 2":39,"A 1 1 2/n":15,"A 1 1 2/m":12,"P c n 2":30," I 4 2":97,"A 1 1 2/a":15," P 4n 2c -1n":133,"-P 3* 2n":167,"-P 2n 2n":58,"-I 2a":15,"-I 2b":15,"-P 2 2a":51,"B m 2 m":35," P -2a":7,"P m c m":51," I -2b 2":46," P -2b":7," I -2x":8," P 2c -2ab":33," P -2y":6," P -2x":6,"P 1 m 1":6,"F d 2 d":43," I -2a":9," I -2b":9," P -2ac -2n":33,"-I 2y":12,"-I 2x":12,"P m c n":62," F 2 2 3":196," P -2 2ac":31,"B b m b":66,"-A 2 2ab":64," I 4bw -2c":110,'-R 3 2"':166,"P b c b":54,"P 42 b c":106,"B b m m":63," B 2 -2ab":41,"P 2 c m":28,"F m m 2":42,"P 2 c b":32,"P m m 2":25,"P b n n":52,"P b c n":60,"B b c m":64,"P 21 n b":33," P 4c -2":105," P 4n 2 3 -1n":224,"P 21 n m":31,"B b c b":68," A 2a 2a":20,"P n m a":62,"I a -3 d":230," A -2yab":9,"-P 2c 2ac":57," P 3* -2":160," P 2xa":4," I -4 2 3":217," C -2yc":9,"P 1 1 21/m":11,"P 1 1 21/n":14,"B n 1 1":9,"F m m m":69," I 4 2 3":211,"P 1 1 21/a":14," P 2 -2ac":30," P 2 -2ab":32,"B b m 2":40,"I 2/b 1 1":15," A -2a -2a":40,"P 63/m":176,"-A 2a 2a":63,"-A 2a 2b":68,"P b 1 1":7,"-P 2xn":14,"P m n b":62,"C 2 c b":41,"-P 2xc":13,"-P 2xb":13,"-P 2xa":11,"P 42/m c m":132,"-B 2xab":15,"P 4 2 2":89,"C 2 m m":38,"-P 4 2 3":221,"C 2 m b":39,"I m m m":71," P 2bc 2":18,"-I 2b 2c 3":206," P 2 2 -1n":48,"P c 2 a":32,"P a -3":205,"I m m a":74,"P c 2 m":28,"P m m m":47,"-P 2ab 2ab":53,"I 2/c 1 1":15,"P 21 a b":29,"I -4 3 m":217," P 4acd 2ab 3":212,"I 41/a":88,"P 21 a m":26,"-P 2ybc":14,"-P 4bc 2bc 3":224,"C 1 2 1":5,"P 4/m m m":123,"R 3 m":160,"P 1 1 21":4,"P 42 n m":102,"P m n m":59,"P 21/m 1 1":11,"A b a a":68,"-P 2a 2a":51,"-P 2a 2b":54,"-P 2a 2c":50," P 2bc -2bc":31,"P c c 2":27,"-B 2 2ab":64," P 65":170,"I b m 2":46," C -2 2":38," P 61":169,"P -3 1 m":162," I 4bw 2aw -1bw":142," P 3* -2n":161,"P 1 c 1":7,"-F 4ud 2vw 3":228,"P 2 2 21":17," I -2 2":44," P -2 2a":26,"P 2 2 2":16,"-I 4bd 2c":142," P 2yb":4,"P 4/n m m":129," B 2x":5," P 4c -2ab":106,"F m -3 c":226,"P c c n":56,"P c c m":49,"-P 3*":148," B 2":5,"B 2 21 2":20,"A b a 2":41,"-R 3":148,"C m c a":64," B -2b -2b":37,"P c c b":54,"P 21/b 1 1":14,"-F 2 2 3":202,"-P 4a":85," P -2ac -2ac":32,"-P 4c":84,"P 1 21 1":4,"R -3":148," I -4 2":121,"I m 1 1":8,"P n 21 a":33,"P 42 2 2":93,"-P 2bc 2b":54,"P n 21 m":31,"-B 2 2a":67,"-B 2 2b":63,"P 4/n":85,"I -4 2 d":122,"C c 2 m":40,"I m m b":74,"-F 4 2 3":225,"P 6 c c":184,"P 62 2 2":180," A -2":8,"C c 2 a":41,"-P 2a 2ac":54,"I 1 a 1":9,"-C 2ac 2ac":64," F 4 2 3":209,"-I 2b 2":74," P -4n 2 3":218,"I 4 m m":107,"-P 4 2c":124," F 4d 2 3 -1ad":228,"R 3 2":155,"-P 2c 2n":62,"C m m 2":35,"C 1 c 1":9,"-P 2c 2b":57,"-P 2c 2c":51," P -4 -2c":116,"-B 2":12,"A 2 a a":37," C -2yac":9,"P 42/n n m":134,"P n -3 n":222,"P 2 1 1":3,"P 3 c 1":158,"P n -3 m":224,"-A 2 2":65,"-P 2 2":47,"-P 2ac 2":53,"I 41":80,"P m n a":53,"P 64":172,"P 65":170,"P 62":171,"C m m a":67,"C m m b":67,"P 61":169,"-P 2xbc":13,"-C 2xc":15," P -4 2n":114,"P 42 m c":105,"C 2 c m":40," P -2b -2":26,"P 1 n 1":7,"P -4 m 2":115,"P m n n":58,"R 3 c":161,"P 1 21/n 1":14," P -2xb":7,"P 42/n":86,"I 2 m b":46,"A 1 1 2":5,"-P 2ab 2bc 3":201," P -4 2 3":215,"I 2 m m":44,"I 2 3":197,"-C 2a 2":67,"P 3 1 2":149,"-A 2a 2":66,"-P 2ab 2n":52,"-P 4ac 2bc":134,"I b c a":73," P -2c 2":28,"C m c 21":36," P 4n 2 3":208," P 3 2":149,"-P 2ab 2c":52,"-P 2ab 2b":50,"-P 2ab 2a":59," P -2yac":7,"A m m 2":38,"P 42/n c m":138,"I m c b":72,' P 31 2"':152,"I c 2 a":45,"I -4 2 m":121,"I c 2 m":46," P 2 2 3":195," P 61 2 (0 0 5)":178,"I m c m":74,"P m m n":59," C -2xac":9," P -2xc":7,"I 41 2 2":98,"P 63/m c m":193," P -2a -2a":28," P 6":168,"P 3 1 m":157," P -4 2c":112,"P 4/m b m":127,"A 1 1 a":9,"A 1 1 n":9,"A 1 1 m":8,"I b 1 1":9,"P 3 1 c":159,"P b 21 a":29,"B 2/m 1 1":12,"-B 2b 2b":66,"C c m m":63," P 4bd 2ab 3":213,"P b 21 m":26," C -2 -2":38," P 4c -2c":101,"-P 2a 2":49," A 2 2 -1ab":68," B 2 2 -1ab":68,"A m m a":63,"-C 2 2c":66,"A m m m":65,' R 3 -2"':160,"P 61 2 2":178," P 3*":146,"P 2/c 1 1":13,"F d -3 c":228," C -2ac 2":41,"-I 2c 2c":74," C 2c 2":20," C -2x":8," C -2y":8,"P c n n":52,"P 4 n c":104,"-I 2a 2":72,"P 2 3":195," P 31":144," P 32":145,"-P 2xac":14,"-P 2xab":14,"P -4 b 2":117,"I m -3":204,"-I 2":12,"P 1 2/a 1":13,"-I 4":87,"-B 2ab":15,"P m a 2":28,"P 21/n 1 1":14," P -2ab 2":30,"C c m 21":36," P 2ac 2ac":18,"-P 2n 2bc":52," P 4 2 -1n":126," B -2ab":9,"F m -3":202,"P 4/n b m":125,"P -3 m 1":164,"B 2 2 2":21," P 2 2ab -1ab":59,"-P 2n 2":58," P 31 2 (0 0 4)":151,"-P 2c 2bc":59,"C n 1 1":9,"I c 1 1":9,"R -3 m":166,"P m a b":57,"P m a a":49,"F d d 2":43,"-I 2xc":15,"-P 6":175," C -2c -2c":40," I 4bw -2":109,"P m a n":53,"P m a m":51,"I 1 2/c 1":15," B 2 -2":38,"-I 2a 2a":74,"-I 2a 2b":73," P -4 -2":115,"P 2/n 1 1":13,"P 21 3":198,"-P 4a 2bc 3":222," P 64":172," F 4d 2 3 -1d":227,"-A 2ab":15,"-P 6c 2c":194,"-A 2a":15," P -2ab -2ab":30," A -2ab -2ab":41,"P 4 b m":100,"P -4 3 m":215,"-A 2y":12," A 2 -2a":40," A 2 -2b":39," P 4ab 2n -1ab":130,"P -4 3 n":218," I 2 -2a":46,"A 1 2/a 1":15,"P 4 c c":103," I 2 -2b":46,"P -6 m 2":187,"I 4/m c m":140,"A 2 m m":35,"I m -3 m":229,"I b m m":74,"-I 4bd 2":141,"P 1 2/n 1":13,"I 21 3":199," F -2 2":42,"I 2 c b":45," A -2 -2":38," P -6 -2":189,"P b c m":57," P 62":171,"C 1 2/n 1":15,"P 31":144," P -2b 2a":29,"P 32":145,"P c a 21":29,"-B 2b 2":63,"I 4":79,"-P 2b 2bc":50,"-P 2bc 2bc":53,"-P 4n 2n":136," P 3* 2":155," A -2ya":9," I -4 2bw":122,"-P 2 2 3":200,"C 2 1 1":5," P -4 -2n":118,"P 21 2 21":18,"-C 2y":12,"-C 2x":12,"I 1 m 1":8," C 2 2":21," P 2 2":16,"P 42/m b c":135,"-F 2uv 2vw":70," C -2c 2":40,"P n 2 n":34," P -6c -2c":190,"P 1 21/a 1":14,"P n 2 b":30," P 2ac -2":31,"-P 4a 2ac":130,"-P 2bc 2c":57,"P n 1 1":7,"-P 2bc 2a":62,"A m a m":63,"P 42 c m":101," B -2b":9,"-P 4 2n":128,"A m a a":66,"-P 2bc 2n":60,"-I 4bd 2c 3":230,"P m 21 n":31," B -2x":8,"-P 4c 2ab":135,' P 3 -2"c':158,"P m 21 b":26,"P 1 1 21/b":14,"-B 2b 2ab":68,"I a -3":206,"P b n 21":33,"F -4 3 c":219,"P m m b":51," P -2a -2ab":29," B -2b -2":36," P 2a 2a":17,"P b a m":55,"P b a n":50,"-C 2yc":15,"P 21 1 1":4,"C c m b":64,"F m -3 m":225,"P b a a":54,"P b a b":54,"P m m a":51," C 2c -2":36," A 2 2":21," I 4bw -1bw":88," I -2a -2a":46,"C 2 2 2":21,"I -4 m 2":119,"P 4/m":83,"P 21 21 21":19,"A m a 2":40,"P 4 3 2":207," P 4 2 -1ab":125,"-P 2a 2n":60,' P 3 2"':150,"I -4 c 2":120," I 4bw 2bw":98,"P m c a":57,"P b a 2":32," A -2b -2b":39," F 2 2":22,"-P 6 2":191," P -2c -2c":28,"-I 2 2a":74," A -2 2a":36," P -2xbc":7," A 2":5," P 6c -2c":186," P 4cw 2c":95,"P 63 2 2":182," P 6 2":177,"-P 2b 2ac":60,"-P 2b 2ab":54,"B 1 1 m":8,"B 1 1 n":9,"A b m m":67,"I 4 3 2":211,"-A 2ab 2b":68,"A b m a":64," P -6":174," P 4cw":78,"B 1 1 b":9,"A m 2 a":40,"P n m 21":31," B -2 -2":35," P 4n 2n":94," P -2bc 2a":33,"B b 21 m":36," A -2a 2a":36,"A m 2 m":38," P 4 -2":99," A 2 -2":38," B -2xab":9,"P 4/n n c":126,"P 64 2 2":181," P 2 2 -1ab":50," P -2ac 2a":29,"P n a 21":33,"C c 1 1":9,"P 32 1 2":153,"A b m 2":39,' P 3 -2"':156,"B 1 1 2":5,"A 1 n 1":9," I -4bd 2c 3":220," I 2x":5," I 2y":5,"P 1 2/m 1":10,"-P 2ab 2":53,"P 6/m m m":191,"P -4 21 m":113,"P 6/m":175,"P -6 c 2":188,"P 2 a n":30,"-P 2n 2ab":60,"-A 2 2a":63,"-A 2 2b":67,"-P 3 2":162," F 2 2 3 -1d":203,"-P 4 2ab":127,"P 2 a a":27,"-P 6 2c":192,"P c a m":57,"P c a n":60,"-C 2yac":15,"-I 2 2c":72,"-I 2 2b":74,"P c a a":54," P -2n -2n":34,"P c a b":61,"I 1 1 2/b":15,"I 1 1 2/a":15," I -2":8," C -2ac -2ac":41,"P 3 2 1":150,"P b c 21":29," P 4c":77," P 3 -2":157,"I 1 c 1":9,"I 1 1 2/m":12,"B m a b":64,"-I 4 2":139,"I 21 21 21":24," P 3 -2c":159," P 4w":76," P -2bc 2":32," F -2d -2d":43,"P b c a":61,"C 2 2 21":20,"P 31 2 1":152,"-P 2 2ab":55,"P 4 21 2":90,"P c n m":53,"P 21 21 2":18,"-P 2bc 2ac":61,"-P 2c 2ab":62," P -2n 2":34,"P 41 2 2":91," P 4nw 2abw":96," P 4ab 2ab":90," P 4ab 2ab -1ab":129,"F d d d":70,"B 1 1 2/m":12,"B 1 1 2/n":15,"P -4 n 2":118,"B 1 1 2/b":15,"P 1 1 n":7,"P 1 1 m":6,'-P 3 2"c':165," P -4 2":111," I 4bw":80,"-P 4ac 2ac":138," P 64 2 (0 0 2)":181," I -2xc":9," I -2xb":9,"P 1 1 b":7,"P 1 1 a":7," P 4 -2ab":100,"P -4 c 2":116," F 2 -2":42,"-C 2xac":15,"C m c m":63,"-P 6c":176,"-A 2b 2b":67," B -2 -2b":36,"C 2/n 1 1":15,"I 1 2 1":5,"A 1 2/m 1":12,"P 2 21 21":18,"I -4 3 d":220,"B m c m":67," P 6 -2c":184," P -2a 2":27," P -2b -2b":27," C -2a -2a":39," P 2 -2":25," P 6c 2c":182,"-I 2xb":15," P 2c -2n":33,"I 2 c m":46,"F 2 2 2":22,"P c c a":54,"P 2/m 1 1":10,"-A 2ya":15,"-P 2":10,"-P 1":2," I 2 -2c":45," P 2c -2c":26," P 2c -2b":29," I -2a 2":45,"-P 4":83,"P n c 2":30,"C 1 n 1":9," A -2y":8,"P -3 1 c":163,"-P 2ac 2bc":56," P 6c":173,"A 1 a 1":9," C 2 -2c":37," A -2ab":9,"A 2 2 2":21," A -2a":9," P -2":6," C 2 2 -1ac":68,"-C 2a 2ac":68," P -4":81," I 4":79,"-P 2b 2":51,"P 6 m m":183," P 2c -2":26,"-P 6c 2":193,"P 3 m 1":156,"-P 3":147,"B m 21 b":36,"P 1 2 1":3," P 2 2ab":18,"P m n 21":31," I 2 2":23,"P n c b":50,"P n c a":60," B 2 -2b":40," B 2 -2a":39,"P n -3":201,"P 41":76,"P 42":77,"P 43":78,"P n c n":52,"P n c m":53},groups:[{symbol:"P 1",operators:["x,y,z"],number:1},{symbol:"P -1",operators:["x,y,z"],number:2},{symbol:"P 1 2 1",operators:["x,y,z","-x,y,-z"],number:3},{symbol:"P 1 21 1",operators:["x,y,z","-x,y+1/2,-z"],number:4},{symbol:"C 1 2 1",operators:["x,y,z","-x,y,-z"],number:5},{symbol:"P 1 m 1",operators:["x,y,z","x,-y,z"],number:6},{symbol:"P 1 c 1",operators:["x,y,z","x,-y,z+1/2"],number:7},{symbol:"C 1 m 1",operators:["x,y,z","x,-y,z"],number:8},{symbol:"C 1 c 1",operators:["x,y,z","x,-y,z+1/2"],number:9},{symbol:"P 1 2/m 1",operators:["x,y,z","-x,y,-z"],number:10},{symbol:"P 1 21/m 1",operators:["x,y,z","-x,y+1/2,-z"],number:11},{symbol:"C 1 2/m 1",operators:["x,y,z","-x,y,-z"],number:12},{symbol:"P 1 2/c 1",operators:["x,y,z","-x,y,-z+1/2"],number:13},{symbol:"P 1 21/c 1",operators:["x,y,z","-x,y+1/2,-z+1/2"],number:14},{symbol:"C 1 2/c 1",operators:["x,y,z","-x,y,-z+1/2"],number:15},{symbol:"P 2 2 2",operators:["x,y,z","x,-y,-z","-x,y,-z","-x,-y,z"],number:16},{symbol:"P 2 2 21",operators:["x,y,z","x,-y,-z","-x,y,-z+1/2","-x,-y,z+1/2"],number:17},{symbol:"P 21 21 2",operators:["x,y,z","x+1/2,-y+1/2,-z","-x+1/2,y+1/2,-z","-x,-y,z"],number:18},{symbol:"P 21 21 21",operators:["x,y,z","x+1/2,-y+1/2,-z","-x,y+1/2,-z+1/2","-x+1/2,-y,z+1/2"],number:19},{symbol:"C 2 2 21",operators:["x,y,z","x,-y,-z","-x,y,-z+1/2","-x,-y,z+1/2"],number:20},{symbol:"C 2 2 2",operators:["x,y,z","x,-y,-z","-x,y,-z","-x,-y,z"],number:21},{symbol:"F 2 2 2",operators:["x,y,z","x,-y,-z","-x,y,-z","-x,-y,z"],number:22},{symbol:"I 2 2 2",operators:["x,y,z","x,-y,-z","-x,y,-z","-x,-y,z"],number:23},{symbol:"I 21 21 21",operators:["x,y,z","x,-y,-z+1/2","-x+1/2,y,-z","-x,-y+1/2,z"],number:24},{symbol:"P m m 2",operators:["x,y,z","-x,-y,z","-x,y,z","x,-y,z"],number:25},{symbol:"P m c 21",operators:["x,y,z","-x,-y,z+1/2","-x,y,z","x,-y,z+1/2"],number:26},{symbol:"P c c 2",operators:["x,y,z","-x,-y,z","-x,y,z+1/2","x,-y,z+1/2"],number:27},{symbol:"P m a 2",operators:["x,y,z","-x,-y,z","-x+1/2,y,z","x+1/2,-y,z"],number:28},{symbol:"P c a 21",operators:["x,y,z","-x,-y,z+1/2","-x+1/2,y,z+1/2","x+1/2,-y,z"],number:29},{symbol:"P n c 2",operators:["x,y,z","-x,-y,z","-x,y+1/2,z+1/2","x,-y+1/2,z+1/2"],number:30},{symbol:"P m n 21",operators:["x,y,z","-x+1/2,-y,z+1/2","-x,y,z","x+1/2,-y,z+1/2"],number:31},{symbol:"P b a 2",operators:["x,y,z","-x,-y,z","-x+1/2,y+1/2,z","x+1/2,-y+1/2,z"],number:32},{symbol:"P n a 21",operators:["x,y,z","-x,-y,z+1/2","-x+1/2,y+1/2,z+1/2","x+1/2,-y+1/2,z"],number:33},{symbol:"P n n 2",operators:["x,y,z","-x,-y,z","-x+1/2,y+1/2,z+1/2","x+1/2,-y+1/2,z+1/2"],number:34},{symbol:"C m m 2",operators:["x,y,z","-x,-y,z","-x,y,z","x,-y,z"],number:35},{symbol:"C m c 21",operators:["x,y,z","-x,-y,z+1/2","-x,y,z","x,-y,z+1/2"],number:36},{symbol:"C c c 2",operators:["x,y,z","-x,-y,z","-x,y,z+1/2","x,-y,z+1/2"],number:37},{symbol:"A m m 2",operators:["x,y,z","-x,-y,z","-x,y,z","x,-y,z"],number:38},{symbol:"A b m 2",operators:["x,y,z","-x,-y,z","-x,y+1/2,z","x,-y+1/2,z"],number:39},{symbol:"A m a 2",operators:["x,y,z","-x,-y,z","-x+1/2,y,z","x+1/2,-y,z"],number:40},{symbol:"A b a 2",operators:["x,y,z","-x,-y,z","-x+1/2,y+1/2,z","x+1/2,-y+1/2,z"],number:41},{symbol:"F m m 2",operators:["x,y,z","-x,-y,z","-x,y,z","x,-y,z"],number:42},{symbol:"F d d 2",operators:["x,y,z","-x,-y,z","-x+1/4,y+1/4,z+1/4","x+1/4,-y+1/4,z+1/4"],number:43},{symbol:"I m m 2",operators:["x,y,z","-x,-y,z","-x,y,z","x,-y,z"],number:44},{symbol:"I b a 2",operators:["x,y,z","-x,-y,z","-x,y,z+1/2","x,-y,z+1/2"],number:45},{symbol:"I m a 2",operators:["x,y,z","-x,-y,z","-x+1/2,y,z","x+1/2,-y,z"],number:46},{symbol:"P m m m",operators:["x,y,z","x,-y,-z","-x,y,-z","-x,-y,z"],number:47},{symbol:"P n n n :2",operators:["x,y,z","x,-y+1/2,-z+1/2","-x+1/2,y,-z+1/2","-x+1/2,-y+1/2,z"],number:48},{symbol:"P c c m",operators:["x,y,z","x,-y,-z+1/2","-x,y,-z+1/2","-x,-y,z"],number:49},{symbol:"P b a n :2",operators:["x,y,z","x,-y+1/2,-z","-x+1/2,y,-z","-x+1/2,-y+1/2,z"],number:50},{symbol:"P m m a",operators:["x,y,z","x+1/2,-y,-z","-x,y,-z","-x+1/2,-y,z"],number:51},{symbol:"P n n a",operators:["x,y,z","x,-y+1/2,-z+1/2","-x+1/2,y+1/2,-z+1/2","-x+1/2,-y,z"],number:52},{symbol:"P m n a",operators:["x,y,z","x,-y,-z","-x+1/2,y,-z+1/2","-x+1/2,-y,z+1/2"],number:53},{symbol:"P c c a",operators:["x,y,z","x+1/2,-y,-z+1/2","-x,y,-z+1/2","-x+1/2,-y,z"],number:54},{symbol:"P b a m",operators:["x,y,z","x+1/2,-y+1/2,-z","-x+1/2,y+1/2,-z","-x,-y,z"],number:55},{symbol:"P c c n",operators:["x,y,z","x+1/2,-y,-z+1/2","-x,y+1/2,-z+1/2","-x+1/2,-y+1/2,z"],number:56},{symbol:"P b c m",operators:["x,y,z","x,-y+1/2,-z","-x,y+1/2,-z+1/2","-x,-y,z+1/2"],number:57},{symbol:"P n n m",operators:["x,y,z","x+1/2,-y+1/2,-z+1/2","-x+1/2,y+1/2,-z+1/2","-x,-y,z"],number:58},{symbol:"P m m n :2",operators:["x,y,z","x+1/2,-y,-z","-x,y+1/2,-z","-x+1/2,-y+1/2,z"],number:59},{symbol:"P b c n",operators:["x,y,z","x+1/2,-y+1/2,-z","-x,y,-z+1/2","-x+1/2,-y+1/2,z+1/2"],number:60},{symbol:"P b c a",operators:["x,y,z","x+1/2,-y+1/2,-z","-x,y+1/2,-z+1/2","-x+1/2,-y,z+1/2"],number:61},{symbol:"P n m a",operators:["x,y,z","x+1/2,-y+1/2,-z+1/2","-x,y+1/2,-z","-x+1/2,-y,z+1/2"],number:62},{symbol:"C m c m",operators:["x,y,z","x,-y,-z","-x,y,-z+1/2","-x,-y,z+1/2"],number:63},{symbol:"C m c a",operators:["x,y,z","x,-y,-z","-x+1/2,y,-z+1/2","-x+1/2,-y,z+1/2"],number:64},{symbol:"C m m m",operators:["x,y,z","x,-y,-z","-x,y,-z","-x,-y,z"],number:65},{symbol:"C c c m",operators:["x,y,z","x,-y,-z+1/2","-x,y,-z+1/2","-x,-y,z"],number:66},{symbol:"C m m a",operators:["x,y,z","x,-y,-z","-x+1/2,y,-z","-x+1/2,-y,z"],number:67},{symbol:"C c c a :2",operators:["x,y,z","x+1/2,-y,-z+1/2","-x,y,-z+1/2","-x+1/2,-y,z"],number:68},{symbol:"F m m m",operators:["x,y,z","x,-y,-z","-x,y,-z","-x,-y,z"],number:69},{symbol:"F d d d :2",operators:["x,y,z","x,-y+1/4,-z+1/4","-x+1/4,y,-z+1/4","-x+1/4,-y+1/4,z"],number:70},{symbol:"I m m m",operators:["x,y,z","x,-y,-z","-x,y,-z","-x,-y,z"],number:71},{symbol:"I b a m",operators:["x,y,z","x,-y,-z+1/2","-x,y,-z+1/2","-x,-y,z"],number:72},{symbol:"I b c a",operators:["x,y,z","x,-y,-z+1/2","-x+1/2,y,-z","-x,-y+1/2,z"],number:73},{symbol:"I m m a",operators:["x,y,z","x,-y,-z","-x,y+1/2,-z","-x,-y+1/2,z"],number:74},{symbol:"P 4",operators:["x,y,z","-y,x,z","y,-x,z","-x,-y,z"],number:75},{symbol:"P 41",operators:["x,y,z","-y,x,z+1/4","y,-x,z+3/4","-x,-y,z+1/2"],number:76},{symbol:"P 42",operators:["x,y,z","-y,x,z+1/2","y,-x,z+1/2","-x,-y,z"],number:77},{symbol:"P 43",operators:["x,y,z","-y,x,z+3/4","y,-x,z+1/4","-x,-y,z+1/2"],number:78},{symbol:"I 4",operators:["x,y,z","-y,x,z","y,-x,z","-x,-y,z"],number:79},{symbol:"I 41",operators:["x,y,z","-y+1/2,x,z+3/4","y+1/2,-x,z+3/4","-x,-y,z"],number:80},{symbol:"P -4",operators:["x,y,z","y,-x,-z","-y,x,-z","-x,-y,z"],number:81},{symbol:"I -4",operators:["x,y,z","y,-x,-z","-y,x,-z","-x,-y,z"],number:82},{symbol:"P 4/m",operators:["x,y,z","-y,x,z","y,-x,z","-x,-y,z"],number:83},{symbol:"P 42/m",operators:["x,y,z","-y,x,z+1/2","y,-x,z+1/2","-x,-y,z"],number:84},{symbol:"P 4/n :2",operators:["x,y,z","-y+1/2,x,z","y,-x+1/2,z","-x+1/2,-y+1/2,z"],number:85},{symbol:"P 42/n :2",operators:["x,y,z","-y,x+1/2,z+1/2","y+1/2,-x,z+1/2","-x+1/2,-y+1/2,z"],number:86},{symbol:"I 4/m",operators:["x,y,z","-y,x,z","y,-x,z","-x,-y,z"],number:87},{symbol:"I 41/a :2",operators:["x,y,z","-y+1/4,x+3/4,z+3/4","y+1/4,-x+1/4,z+1/4","-x,-y+1/2,z"],number:88},{symbol:"P 4 2 2",operators:["x,y,z","-y,x,z","y,-x,z","x,-y,-z","-x,y,-z","-x,-y,z","y,x,-z","-y,-x,-z"],number:89},{symbol:"P 4 21 2",operators:["x,y,z","-y+1/2,x+1/2,z","y+1/2,-x+1/2,z","x+1/2,-y+1/2,-z","-x+1/2,y+1/2,-z","-x,-y,z","y,x,-z","-y,-x,-z"],number:90},{symbol:"P 41 2 2",operators:["x,y,z","-y,x,z+1/4","y,-x,z+3/4","x,-y,-z+1/2","-x,y,-z","-x,-y,z+1/2","y,x,-z+3/4","-y,-x,-z+1/4"],number:91},{symbol:"P 41 21 2",operators:["x,y,z","-y+1/2,x+1/2,z+1/4","y+1/2,-x+1/2,z+3/4","x+1/2,-y+1/2,-z+3/4","-x+1/2,y+1/2,-z+1/4","-x,-y,z+1/2","y,x,-z","-y,-x,-z+1/2"],number:92},{symbol:"P 42 2 2",operators:["x,y,z","-y,x,z+1/2","y,-x,z+1/2","x,-y,-z","-x,y,-z","-x,-y,z","y,x,-z+1/2","-y,-x,-z+1/2"],number:93},{symbol:"P 42 21 2",operators:["x,y,z","-y+1/2,x+1/2,z+1/2","y+1/2,-x+1/2,z+1/2","x+1/2,-y+1/2,-z+1/2","-x+1/2,y+1/2,-z+1/2","-x,-y,z","y,x,-z","-y,-x,-z"],number:94},{symbol:"P 43 2 2",operators:["x,y,z","-y,x,z+3/4","y,-x,z+1/4","x,-y,-z+1/2","-x,y,-z","-x,-y,z+1/2","y,x,-z+1/4","-y,-x,-z+3/4"],number:95},{symbol:"P 43 21 2",operators:["x,y,z","-y+1/2,x+1/2,z+3/4","y+1/2,-x+1/2,z+1/4","x+1/2,-y+1/2,-z+1/4","-x+1/2,y+1/2,-z+3/4","-x,-y,z+1/2","y,x,-z","-y,-x,-z+1/2"],number:96},{symbol:"I 4 2 2",operators:["x,y,z","-y,x,z","y,-x,z","x,-y,-z","-x,y,-z","-x,-y,z","y,x,-z","-y,-x,-z"],number:97},{symbol:"I 41 2 2",operators:["x,y,z","-y+1/2,x,z+3/4","y+1/2,-x,z+3/4","x+1/2,-y,-z+3/4","-x+1/2,y,-z+3/4","-x,-y,z","y,x,-z","-y,-x,-z"],number:98},{symbol:"P 4 m m",operators:["x,y,z","-y,x,z","y,-x,z","-x,-y,z","-x,y,z","x,-y,z","-y,-x,z","y,x,z"],number:99},{symbol:"P 4 b m",operators:["x,y,z","-y,x,z","y,-x,z","-x,-y,z","-x+1/2,y+1/2,z","x+1/2,-y+1/2,z","-y+1/2,-x+1/2,z","y+1/2,x+1/2,z"],number:100},{symbol:"P 42 c m",operators:["x,y,z","-y,x,z+1/2","y,-x,z+1/2","-x,-y,z","-x,y,z+1/2","x,-y,z+1/2","-y,-x,z","y,x,z"],number:101},{symbol:"P 42 n m",operators:["x,y,z","-y+1/2,x+1/2,z+1/2","y+1/2,-x+1/2,z+1/2","-x,-y,z","-x+1/2,y+1/2,z+1/2","x+1/2,-y+1/2,z+1/2","-y,-x,z","y,x,z"],number:102},{symbol:"P 4 c c",operators:["x,y,z","-y,x,z","y,-x,z","-x,-y,z","-x,y,z+1/2","x,-y,z+1/2","-y,-x,z+1/2","y,x,z+1/2"],number:103},{symbol:"P 4 n c",operators:["x,y,z","-y,x,z","y,-x,z","-x,-y,z","-x+1/2,y+1/2,z+1/2","x+1/2,-y+1/2,z+1/2","-y+1/2,-x+1/2,z+1/2","y+1/2,x+1/2,z+1/2"],number:104},{symbol:"P 42 m c",operators:["x,y,z","-y,x,z+1/2","y,-x,z+1/2","-x,-y,z","-x,y,z","x,-y,z","-y,-x,z+1/2","y,x,z+1/2"],number:105},{symbol:"P 42 b c",operators:["x,y,z","-y,x,z+1/2","y,-x,z+1/2","-x,-y,z","-x+1/2,y+1/2,z","x+1/2,-y+1/2,z","-y+1/2,-x+1/2,z+1/2","y+1/2,x+1/2,z+1/2"],number:106},{symbol:"I 4 m m",operators:["x,y,z","-y,x,z","y,-x,z","-x,-y,z","-x,y,z","x,-y,z","-y,-x,z","y,x,z"],number:107},{symbol:"I 4 c m",operators:["x,y,z","-y,x,z","y,-x,z","-x,-y,z","-x,y,z+1/2","x,-y,z+1/2","-y,-x,z+1/2","y,x,z+1/2"],number:108},{symbol:"I 41 m d",operators:["x,y,z","-y+1/2,x,z+3/4","y+1/2,-x,z+3/4","-x,-y,z","-x,y,z","x,-y,z","-y+1/2,-x,z+3/4","y+1/2,x,z+3/4"],number:109},{symbol:"I 41 c d",operators:["x,y,z","-y+1/2,x,z+3/4","y+1/2,-x,z+3/4","-x,-y,z","-x,y,z+1/2","x,-y,z+1/2","-y+1/2,-x,z+1/4","y+1/2,x,z+1/4"],number:110},{symbol:"P -4 2 m",operators:["x,y,z","y,-x,-z","-y,x,-z","x,-y,-z","-x,y,-z","-x,-y,z","-y,-x,z","y,x,z"],number:111},{symbol:"P -4 2 c",operators:["x,y,z","y,-x,-z","-y,x,-z","x,-y,-z+1/2","-x,y,-z+1/2","-x,-y,z","-y,-x,z+1/2","y,x,z+1/2"],number:112},{symbol:"P -4 21 m",operators:["x,y,z","y,-x,-z","-y,x,-z","x+1/2,-y+1/2,-z","-x+1/2,y+1/2,-z","-x,-y,z","-y+1/2,-x+1/2,z","y+1/2,x+1/2,z"],number:113},{symbol:"P -4 21 c",operators:["x,y,z","y,-x,-z","-y,x,-z","x+1/2,-y+1/2,-z+1/2","-x+1/2,y+1/2,-z+1/2","-x,-y,z","-y+1/2,-x+1/2,z+1/2","y+1/2,x+1/2,z+1/2"],number:114},{symbol:"P -4 m 2",operators:["x,y,z","y,-x,-z","-y,x,-z","-x,-y,z","y,x,-z","-y,-x,-z","-x,y,z","x,-y,z"],number:115},{symbol:"P -4 c 2",operators:["x,y,z","y,-x,-z","-y,x,-z","-x,-y,z","y,x,-z+1/2","-y,-x,-z+1/2","-x,y,z+1/2","x,-y,z+1/2"],number:116},{symbol:"P -4 b 2",operators:["x,y,z","y,-x,-z","-y,x,-z","-x,-y,z","y+1/2,x+1/2,-z","-y+1/2,-x+1/2,-z","-x+1/2,y+1/2,z","x+1/2,-y+1/2,z"],number:117},{symbol:"P -4 n 2",operators:["x,y,z","y,-x,-z","-y,x,-z","-x,-y,z","y+1/2,x+1/2,-z+1/2","-y+1/2,-x+1/2,-z+1/2","-x+1/2,y+1/2,z+1/2","x+1/2,-y+1/2,z+1/2"],number:118},{symbol:"I -4 m 2",operators:["x,y,z","y,-x,-z","-y,x,-z","-x,-y,z","y,x,-z","-y,-x,-z","-x,y,z","x,-y,z"],number:119},{symbol:"I -4 c 2",operators:["x,y,z","y,-x,-z","-y,x,-z","-x,-y,z","y,x,-z+1/2","-y,-x,-z+1/2","-x,y,z+1/2","x,-y,z+1/2"],number:120},{symbol:"I -4 2 m",operators:["x,y,z","y,-x,-z","-y,x,-z","x,-y,-z","-x,y,-z","-x,-y,z","-y,-x,z","y,x,z"],number:121},{symbol:"I -4 2 d",operators:["x,y,z","y,-x,-z","-y,x,-z","x+1/2,-y,-z+3/4","-x+1/2,y,-z+3/4","-x,-y,z","-y+1/2,-x,z+3/4","y+1/2,x,z+3/4"],number:122},{symbol:"P 4/m m m",operators:["x,y,z","-y,x,z","y,-x,z","x,-y,-z","-x,y,-z","-x,-y,z","y,x,-z","-y,-x,-z"],number:123},{symbol:"P 4/m c c",operators:["x,y,z","-y,x,z","y,-x,z","x,-y,-z+1/2","-x,y,-z+1/2","-x,-y,z","y,x,-z+1/2","-y,-x,-z+1/2"],number:124},{symbol:"P 4/n b m :2",operators:["x,y,z","-y+1/2,x,z","y,-x+1/2,z","x,-y+1/2,-z","-x+1/2,y,-z","-x+1/2,-y+1/2,z","y,x,-z","-y+1/2,-x+1/2,-z"],number:125},{symbol:"P 4/n n c :2",operators:["x,y,z","-y+1/2,x,z","y,-x+1/2,z","x,-y+1/2,-z+1/2","-x+1/2,y,-z+1/2","-x+1/2,-y+1/2,z","y,x,-z+1/2","-y+1/2,-x+1/2,-z+1/2"],number:126},{symbol:"P 4/m b m",operators:["x,y,z","-y,x,z","y,-x,z","x+1/2,-y+1/2,-z","-x+1/2,y+1/2,-z","-x,-y,z","y+1/2,x+1/2,-z","-y+1/2,-x+1/2,-z"],number:127},{symbol:"P 4/m n c",operators:["x,y,z","-y,x,z","y,-x,z","x+1/2,-y+1/2,-z+1/2","-x+1/2,y+1/2,-z+1/2","-x,-y,z","y+1/2,x+1/2,-z+1/2","-y+1/2,-x+1/2,-z+1/2"],number:128},{symbol:"P 4/n m m :2",operators:["x,y,z","-y+1/2,x,z","y,-x+1/2,z","x+1/2,-y,-z","-x,y+1/2,-z","-x+1/2,-y+1/2,z","y+1/2,x+1/2,-z","-y,-x,-z"],number:129},{symbol:"P 4/n c c :2",operators:["x,y,z","-y+1/2,x,z","y,-x+1/2,z","x+1/2,-y,-z+1/2","-x,y+1/2,-z+1/2","-x+1/2,-y+1/2,z","y+1/2,x+1/2,-z+1/2","-y,-x,-z+1/2"],number:130},{symbol:"P 42/m m c",operators:["x,y,z","-y,x,z+1/2","y,-x,z+1/2","x,-y,-z","-x,y,-z","-x,-y,z","y,x,-z+1/2","-y,-x,-z+1/2"],number:131},{symbol:"P 42/m c m",operators:["x,y,z","-y,x,z+1/2","y,-x,z+1/2","x,-y,-z+1/2","-x,y,-z+1/2","-x,-y,z","y,x,-z","-y,-x,-z"],number:132},{symbol:"P 42/n b c :2",operators:["x,y,z","-y+1/2,x,z+1/2","y,-x+1/2,z+1/2","x,-y+1/2,-z","-x+1/2,y,-z","-x+1/2,-y+1/2,z","y,x,-z+1/2","-y+1/2,-x+1/2,-z+1/2"],number:133},{symbol:"P 42/n n m :2",operators:["x,y,z","-y+1/2,x,z+1/2","y,-x+1/2,z+1/2","x,-y+1/2,-z+1/2","-x+1/2,y,-z+1/2","-x+1/2,-y+1/2,z","y,x,-z","-y+1/2,-x+1/2,-z"],number:134},{symbol:"P 42/m b c",operators:["x,y,z","-y,x,z+1/2","y,-x,z+1/2","x+1/2,-y+1/2,-z","-x+1/2,y+1/2,-z","-x,-y,z","y+1/2,x+1/2,-z+1/2","-y+1/2,-x+1/2,-z+1/2"],number:135},{symbol:"P 42/m n m",operators:["x,y,z","-y+1/2,x+1/2,z+1/2","y+1/2,-x+1/2,z+1/2","x+1/2,-y+1/2,-z+1/2","-x+1/2,y+1/2,-z+1/2","-x,-y,z","y,x,-z","-y,-x,-z"],number:136},{symbol:"P 42/n m c :2",operators:["x,y,z","-y+1/2,x,z+1/2","y,-x+1/2,z+1/2","x+1/2,-y,-z","-x,y+1/2,-z","-x+1/2,-y+1/2,z","y+1/2,x+1/2,-z+1/2","-y,-x,-z+1/2"],number:137},{symbol:"P 42/n c m :2",operators:["x,y,z","-y+1/2,x,z+1/2","y,-x+1/2,z+1/2","x+1/2,-y,-z+1/2","-x,y+1/2,-z+1/2","-x+1/2,-y+1/2,z","y+1/2,x+1/2,-z","-y,-x,-z"],
number:138},{symbol:"I 4/m m m",operators:["x,y,z","-y,x,z","y,-x,z","x,-y,-z","-x,y,-z","-x,-y,z","y,x,-z","-y,-x,-z"],number:139},{symbol:"I 4/m c m",operators:["x,y,z","-y,x,z","y,-x,z","x,-y,-z+1/2","-x,y,-z+1/2","-x,-y,z","y,x,-z+1/2","-y,-x,-z+1/2"],number:140},{symbol:"I 41/a m d :2",operators:["x,y,z","-y+1/4,x+3/4,z+1/4","y+1/4,-x+1/4,z+3/4","x,-y,-z","-x,y+1/2,-z","-x,-y+1/2,z","y+1/4,x+3/4,-z+1/4","-y+1/4,-x+1/4,-z+3/4"],number:141},{symbol:"I 41/a c d :2",operators:["x,y,z","-y+1/4,x+3/4,z+1/4","y+1/4,-x+1/4,z+3/4","x,-y,-z+1/2","-x+1/2,y,-z","-x,-y+1/2,z","y+1/4,x+3/4,-z+3/4","-y+1/4,-x+1/4,-z+1/4"],number:142},{symbol:"P 3",operators:["x,y,z","-y,x-y,z","-x+y,-x,z"],number:143},{symbol:"P 31",operators:["x,y,z","-y,x-y,z+1/3","-x+y,-x,z+2/3"],number:144},{symbol:"P 32",operators:["x,y,z","-y,x-y,z+2/3","-x+y,-x,z+1/3"],number:145},{symbol:"R 3 :H",operators:["x,y,z","-y,x-y,z","-x+y,-x,z"],number:146},{symbol:"P -3",operators:["x,y,z","-y,x-y,z","-x+y,-x,z"],number:147},{symbol:"R -3 :H",operators:["x,y,z","-y,x-y,z","-x+y,-x,z"],number:148},{symbol:"P 3 1 2",operators:["x,y,z","-y,x-y,z","-x+y,-x,z","-y,-x,-z","-x+y,y,-z","x,x-y,-z"],number:149},{symbol:"P 3 2 1",operators:["x,y,z","-y,x-y,z","-x+y,-x,z","x-y,-y,-z","-x,-x+y,-z","y,x,-z"],number:150},{symbol:"P 31 1 2",operators:["x,y,z","-y,x-y,z+1/3","-x+y,-x,z+2/3","-y,-x,-z+2/3","-x+y,y,-z+1/3","x,x-y,-z"],number:151},{symbol:"P 31 2 1",operators:["x,y,z","-y,x-y,z+1/3","-x+y,-x,z+2/3","x-y,-y,-z+2/3","-x,-x+y,-z+1/3","y,x,-z"],number:152},{symbol:"P 32 1 2",operators:["x,y,z","-y,x-y,z+2/3","-x+y,-x,z+1/3","-y,-x,-z+1/3","-x+y,y,-z+2/3","x,x-y,-z"],number:153},{symbol:"P 32 2 1",operators:["x,y,z","-y,x-y,z+2/3","-x+y,-x,z+1/3","x-y,-y,-z+1/3","-x,-x+y,-z+2/3","y,x,-z"],number:154},{symbol:"R 3 2 :H",operators:["x,y,z","-y,x-y,z","-x+y,-x,z","x-y,-y,-z","-x,-x+y,-z","y,x,-z"],number:155},{symbol:"P 3 m 1",operators:["x,y,z","-y,x-y,z","-x+y,-x,z","-x+y,y,z","x,x-y,z","-y,-x,z"],number:156},{symbol:"P 3 1 m",operators:["x,y,z","-y,x-y,z","-x+y,-x,z","y,x,z","x-y,-y,z","-x,-x+y,z"],number:157},{symbol:"P 3 c 1",operators:["x,y,z","-y,x-y,z","-x+y,-x,z","-x+y,y,z+1/2","x,x-y,z+1/2","-y,-x,z+1/2"],number:158},{symbol:"P 3 1 c",operators:["x,y,z","-y,x-y,z","-x+y,-x,z","y,x,z+1/2","x-y,-y,z+1/2","-x,-x+y,z+1/2"],number:159},{symbol:"R 3 m :H",operators:["x,y,z","-y,x-y,z","-x+y,-x,z","-x+y,y,z","x,x-y,z","-y,-x,z"],number:160},{symbol:"R 3 c :H",operators:["x,y,z","-y,x-y,z","-x+y,-x,z","-x+y,y,z+1/2","x,x-y,z+1/2","-y,-x,z+1/2"],number:161},{symbol:"P -3 1 m",operators:["x,y,z","-y,x-y,z","-x+y,-x,z","-y,-x,-z","-x+y,y,-z","x,x-y,-z"],number:162},{symbol:"P -3 1 c",operators:["x,y,z","-y,x-y,z","-x+y,-x,z","-y,-x,-z+1/2","-x+y,y,-z+1/2","x,x-y,-z+1/2"],number:163},{symbol:"P -3 m 1",operators:["x,y,z","-y,x-y,z","-x+y,-x,z","x-y,-y,-z","-x,-x+y,-z","y,x,-z"],number:164},{symbol:"P -3 c 1",operators:["x,y,z","-y,x-y,z","-x+y,-x,z","x-y,-y,-z+1/2","-x,-x+y,-z+1/2","y,x,-z+1/2"],number:165},{symbol:"R -3 m :H",operators:["x,y,z","-y,x-y,z","-x+y,-x,z","x-y,-y,-z","-x,-x+y,-z","y,x,-z"],number:166},{symbol:"R -3 c :H",operators:["x,y,z","-y,x-y,z","-x+y,-x,z","x-y,-y,-z+1/2","-x,-x+y,-z+1/2","y,x,-z+1/2"],number:167},{symbol:"P 6",operators:["x,y,z","x-y,x,z","y,-x+y,z","-y,x-y,z","-x+y,-x,z","-x,-y,z"],number:168},{symbol:"P 61",operators:["x,y,z","x-y,x,z+1/6","y,-x+y,z+5/6","-y,x-y,z+1/3","-x+y,-x,z+2/3","-x,-y,z+1/2"],number:169},{symbol:"P 65",operators:["x,y,z","x-y,x,z+5/6","y,-x+y,z+1/6","-y,x-y,z+2/3","-x+y,-x,z+1/3","-x,-y,z+1/2"],number:170},{symbol:"P 62",operators:["x,y,z","x-y,x,z+1/3","y,-x+y,z+2/3","-y,x-y,z+2/3","-x+y,-x,z+1/3","-x,-y,z"],number:171},{symbol:"P 64",operators:["x,y,z","x-y,x,z+2/3","y,-x+y,z+1/3","-y,x-y,z+1/3","-x+y,-x,z+2/3","-x,-y,z"],number:172},{symbol:"P 63",operators:["x,y,z","x-y,x,z+1/2","y,-x+y,z+1/2","-y,x-y,z","-x+y,-x,z","-x,-y,z+1/2"],number:173},{symbol:"P -6",operators:["x,y,z","-x+y,-x,-z","-y,x-y,-z","-y,x-y,z","-x+y,-x,z","x,y,-z"],number:174},{symbol:"P 6/m",operators:["x,y,z","x-y,x,z","y,-x+y,z","-y,x-y,z","-x+y,-x,z","-x,-y,z"],number:175},{symbol:"P 63/m",operators:["x,y,z","x-y,x,z+1/2","y,-x+y,z+1/2","-y,x-y,z","-x+y,-x,z","-x,-y,z+1/2"],number:176},{symbol:"P 6 2 2",operators:["x,y,z","x-y,x,z","y,-x+y,z","-y,x-y,z","-x+y,-x,z","x-y,-y,-z","-x,-x+y,-z","-x,-y,z","y,x,-z","-y,-x,-z","-x+y,y,-z","x,x-y,-z"],number:177},{symbol:"P 61 2 2",operators:["x,y,z","x-y,x,z+1/6","y,-x+y,z+5/6","-y,x-y,z+1/3","-x+y,-x,z+2/3","x-y,-y,-z","-x,-x+y,-z+2/3","-x,-y,z+1/2","y,x,-z+1/3","-y,-x,-z+5/6","-x+y,y,-z+1/2","x,x-y,-z+1/6"],number:178},{symbol:"P 65 2 2",operators:["x,y,z","x-y,x,z+5/6","y,-x+y,z+1/6","-y,x-y,z+2/3","-x+y,-x,z+1/3","x-y,-y,-z","-x,-x+y,-z+1/3","-x,-y,z+1/2","y,x,-z+2/3","-y,-x,-z+1/6","-x+y,y,-z+1/2","x,x-y,-z+5/6"],number:179},{symbol:"P 62 2 2",operators:["x,y,z","x-y,x,z+1/3","y,-x+y,z+2/3","-y,x-y,z+2/3","-x+y,-x,z+1/3","x-y,-y,-z","-x,-x+y,-z+1/3","-x,-y,z","y,x,-z+2/3","-y,-x,-z+2/3","-x+y,y,-z","x,x-y,-z+1/3"],number:180},{symbol:"P 64 2 2",operators:["x,y,z","x-y,x,z+2/3","y,-x+y,z+1/3","-y,x-y,z+1/3","-x+y,-x,z+2/3","x-y,-y,-z","-x,-x+y,-z+2/3","-x,-y,z","y,x,-z+1/3","-y,-x,-z+1/3","-x+y,y,-z","x,x-y,-z+2/3"],number:181},{symbol:"P 63 2 2",operators:["x,y,z","x-y,x,z+1/2","y,-x+y,z+1/2","-y,x-y,z","-x+y,-x,z","x-y,-y,-z","-x,-x+y,-z","-x,-y,z+1/2","y,x,-z","-y,-x,-z+1/2","-x+y,y,-z+1/2","x,x-y,-z+1/2"],number:182},{symbol:"P 6 m m",operators:["x,y,z","x-y,x,z","y,-x+y,z","-y,x-y,z","-x+y,-x,z","-x,-y,z","-x+y,y,z","x,x-y,z","-y,-x,z","y,x,z","x-y,-y,z","-x,-x+y,z"],number:183},{symbol:"P 6 c c",operators:["x,y,z","x-y,x,z","y,-x+y,z","-y,x-y,z","-x+y,-x,z","-x,-y,z","-x+y,y,z+1/2","x,x-y,z+1/2","-y,-x,z+1/2","y,x,z+1/2","x-y,-y,z+1/2","-x,-x+y,z+1/2"],number:184},{symbol:"P 63 c m",operators:["x,y,z","x-y,x,z+1/2","y,-x+y,z+1/2","-y,x-y,z","-x+y,-x,z","-x,-y,z+1/2","-x+y,y,z+1/2","x,x-y,z+1/2","-y,-x,z+1/2","y,x,z","x-y,-y,z","-x,-x+y,z"],number:185},{symbol:"P 63 m c",operators:["x,y,z","x-y,x,z+1/2","y,-x+y,z+1/2","-y,x-y,z","-x+y,-x,z","-x,-y,z+1/2","-x+y,y,z","x,x-y,z","-y,-x,z","y,x,z+1/2","x-y,-y,z+1/2","-x,-x+y,z+1/2"],number:186},{symbol:"P -6 m 2",operators:["x,y,z","-x+y,-x,-z","-y,x-y,-z","-y,x-y,z","-x+y,-x,z","-y,-x,-z","-x+y,y,-z","x,x-y,-z","-x+y,y,z","x,x-y,z","x,y,-z","-y,-x,z"],number:187},{symbol:"P -6 c 2",operators:["x,y,z","-x+y,-x,-z+1/2","-y,x-y,-z+1/2","-y,x-y,z","-x+y,-x,z","-y,-x,-z","-x+y,y,-z","x,x-y,-z","-x+y,y,z+1/2","x,x-y,z+1/2","x,y,-z+1/2","-y,-x,z+1/2"],number:188},{symbol:"P -6 2 m",operators:["x,y,z","-x+y,-x,-z","-y,x-y,-z","-y,x-y,z","-x+y,-x,z","x-y,-y,-z","-x,-x+y,-z","y,x,-z","x,y,-z","y,x,z","x-y,-y,z","-x,-x+y,z"],number:189},{symbol:"P -6 2 c",operators:["x,y,z","-x+y,-x,-z+1/2","-y,x-y,-z+1/2","-y,x-y,z","-x+y,-x,z","x-y,-y,-z","-x,-x+y,-z","y,x,-z","x,y,-z+1/2","y,x,z+1/2","x-y,-y,z+1/2","-x,-x+y,z+1/2"],number:190},{symbol:"P 6/m m m",operators:["x,y,z","x-y,x,z","y,-x+y,z","-y,x-y,z","-x+y,-x,z","x-y,-y,-z","-x,-x+y,-z","-x,-y,z","y,x,-z","-y,-x,-z","-x+y,y,-z","x,x-y,-z"],number:191},{symbol:"P 6/m c c",operators:["x,y,z","x-y,x,z","y,-x+y,z","-y,x-y,z","-x+y,-x,z","x-y,-y,-z+1/2","-x,-x+y,-z+1/2","-x,-y,z","y,x,-z+1/2","-y,-x,-z+1/2","-x+y,y,-z+1/2","x,x-y,-z+1/2"],number:192},{symbol:"P 63/m c m",operators:["x,y,z","x-y,x,z+1/2","y,-x+y,z+1/2","-y,x-y,z","-x+y,-x,z","x-y,-y,-z+1/2","-x,-x+y,-z+1/2","-x,-y,z+1/2","y,x,-z+1/2","-y,-x,-z","-x+y,y,-z","x,x-y,-z"],number:193},{symbol:"P 63/m m c",operators:["x,y,z","x-y,x,z+1/2","y,-x+y,z+1/2","-y,x-y,z","-x+y,-x,z","x-y,-y,-z","-x,-x+y,-z","-x,-y,z+1/2","y,x,-z","-y,-x,-z+1/2","-x+y,y,-z+1/2","x,x-y,-z+1/2"],number:194},{symbol:"P 2 3",operators:["x,y,z","z,x,y","y,z,x","-y,-z,x","z,-x,-y","-y,z,-x","-z,-x,y","-z,x,-y","y,-z,-x","x,-y,-z","-x,y,-z","-x,-y,z"],number:195},{symbol:"F 2 3",operators:["x,y,z","z,x,y","y,z,x","-y,-z,x","z,-x,-y","-y,z,-x","-z,-x,y","-z,x,-y","y,-z,-x","x,-y,-z","-x,y,-z","-x,-y,z"],number:196},{symbol:"I 2 3",operators:["x,y,z","z,x,y","y,z,x","-y,-z,x","z,-x,-y","-y,z,-x","-z,-x,y","-z,x,-y","y,-z,-x","x,-y,-z","-x,y,-z","-x,-y,z"],number:197},{symbol:"P 21 3",operators:["x,y,z","z,x,y","y,z,x","-y+1/2,-z,x+1/2","z+1/2,-x+1/2,-y","-y,z+1/2,-x+1/2","-z+1/2,-x,y+1/2","-z,x+1/2,-y+1/2","y+1/2,-z+1/2,-x","x+1/2,-y+1/2,-z","-x,y+1/2,-z+1/2","-x+1/2,-y,z+1/2"],number:198},{symbol:"I 21 3",operators:["x,y,z","z,x,y","y,z,x","-y,-z+1/2,x","z,-x,-y+1/2","-y+1/2,z,-x","-z,-x+1/2,y","-z+1/2,x,-y","y,-z,-x+1/2","x,-y,-z+1/2","-x+1/2,y,-z","-x,-y+1/2,z"],number:199},{symbol:"P m -3",operators:["x,y,z","z,x,y","y,z,x","-y,-z,x","z,-x,-y","-y,z,-x","-z,-x,y","-z,x,-y","y,-z,-x","x,-y,-z","-x,y,-z","-x,-y,z"],number:200},{symbol:"P n -3 :2",operators:["x,y,z","z,x,y","y,z,x","-y+1/2,-z+1/2,x","z,-x+1/2,-y+1/2","-y+1/2,z,-x+1/2","-z+1/2,-x+1/2,y","-z+1/2,x,-y+1/2","y,-z+1/2,-x+1/2","x,-y+1/2,-z+1/2","-x+1/2,y,-z+1/2","-x+1/2,-y+1/2,z"],number:201},{symbol:"F m -3",operators:["x,y,z","z,x,y","y,z,x","-y,-z,x","z,-x,-y","-y,z,-x","-z,-x,y","-z,x,-y","y,-z,-x","x,-y,-z","-x,y,-z","-x,-y,z"],number:202},{symbol:"F d -3 :2",operators:["x,y,z","z,x,y","y,z,x","-y+1/4,-z+1/4,x","z,-x+1/4,-y+1/4","-y+1/4,z,-x+1/4","-z+1/4,-x+1/4,y","-z+1/4,x,-y+1/4","y,-z+1/4,-x+1/4","x,-y+1/4,-z+1/4","-x+1/4,y,-z+1/4","-x+1/4,-y+1/4,z"],number:203},{symbol:"I m -3",operators:["x,y,z","z,x,y","y,z,x","-y,-z,x","z,-x,-y","-y,z,-x","-z,-x,y","-z,x,-y","y,-z,-x","x,-y,-z","-x,y,-z","-x,-y,z"],number:204},{symbol:"P a -3",operators:["x,y,z","z,x,y","y,z,x","-y+1/2,-z,x+1/2","z+1/2,-x+1/2,-y","-y,z+1/2,-x+1/2","-z+1/2,-x,y+1/2","-z,x+1/2,-y+1/2","y+1/2,-z+1/2,-x","x+1/2,-y+1/2,-z","-x,y+1/2,-z+1/2","-x+1/2,-y,z+1/2"],number:205},{symbol:"I a -3",operators:["x,y,z","z,x,y","y,z,x","-y,-z+1/2,x","z,-x,-y+1/2","-y+1/2,z,-x","-z,-x+1/2,y","-z+1/2,x,-y","y,-z,-x+1/2","x,-y,-z+1/2","-x+1/2,y,-z","-x,-y+1/2,z"],number:206},{symbol:"P 4 3 2",operators:["x,y,z","x,-z,y","x,z,-y","z,y,-x","-z,y,x","-y,x,z","y,-x,z","z,x,y","y,z,x","-y,-z,x","z,-x,-y","-y,z,-x","-z,-x,y","-z,x,-y","y,-z,-x","x,-y,-z","-x,y,-z","-x,-y,z","y,x,-z","-y,-x,-z","z,-y,x","-z,-y,-x","-x,z,y","-x,-z,-y"],number:207},{symbol:"P 42 3 2",operators:["x,y,z","x+1/2,-z+1/2,y+1/2","x+1/2,z+1/2,-y+1/2","z+1/2,y+1/2,-x+1/2","-z+1/2,y+1/2,x+1/2","-y+1/2,x+1/2,z+1/2","y+1/2,-x+1/2,z+1/2","z,x,y","y,z,x","-y,-z,x","z,-x,-y","-y,z,-x","-z,-x,y","-z,x,-y","y,-z,-x","x,-y,-z","-x,y,-z","-x,-y,z","y+1/2,x+1/2,-z+1/2","-y+1/2,-x+1/2,-z+1/2","z+1/2,-y+1/2,x+1/2","-z+1/2,-y+1/2,-x+1/2","-x+1/2,z+1/2,y+1/2","-x+1/2,-z+1/2,-y+1/2"],number:208},{symbol:"F 4 3 2",operators:["x,y,z","x,-z,y","x,z,-y","z,y,-x","-z,y,x","-y,x,z","y,-x,z","z,x,y","y,z,x","-y,-z,x","z,-x,-y","-y,z,-x","-z,-x,y","-z,x,-y","y,-z,-x","x,-y,-z","-x,y,-z","-x,-y,z","y,x,-z","-y,-x,-z","z,-y,x","-z,-y,-x","-x,z,y","-x,-z,-y"],number:209},{symbol:"F 41 3 2",operators:["x,y,z","x+1/4,-z+1/4,y+1/4","x+1/4,z+1/4,-y+1/4","z+1/4,y+1/4,-x+1/4","-z+1/4,y+1/4,x+1/4","-y+1/4,x+1/4,z+1/4","y+1/4,-x+1/4,z+1/4","z,x,y","y,z,x","-y,-z,x","z,-x,-y","-y,z,-x","-z,-x,y","-z,x,-y","y,-z,-x","x,-y,-z","-x,y,-z","-x,-y,z","y+1/4,x+1/4,-z+1/4","-y+1/4,-x+1/4,-z+1/4","z+1/4,-y+1/4,x+1/4","-z+1/4,-y+1/4,-x+1/4","-x+1/4,z+1/4,y+1/4","-x+1/4,-z+1/4,-y+1/4"],number:210},{symbol:"I 4 3 2",operators:["x,y,z","x,-z,y","x,z,-y","z,y,-x","-z,y,x","-y,x,z","y,-x,z","z,x,y","y,z,x","-y,-z,x","z,-x,-y","-y,z,-x","-z,-x,y","-z,x,-y","y,-z,-x","x,-y,-z","-x,y,-z","-x,-y,z","y,x,-z","-y,-x,-z","z,-y,x","-z,-y,-x","-x,z,y","-x,-z,-y"],number:211},{symbol:"P 43 3 2",operators:["x,y,z","x+3/4,-z+3/4,y+1/4","x+1/4,z+3/4,-y+3/4","z+1/4,y+3/4,-x+3/4","-z+3/4,y+1/4,x+3/4","-y+3/4,x+1/4,z+3/4","y+3/4,-x+3/4,z+1/4","z,x,y","y,z,x","-y+1/2,-z,x+1/2","z+1/2,-x+1/2,-y","-y,z+1/2,-x+1/2","-z+1/2,-x,y+1/2","-z,x+1/2,-y+1/2","y+1/2,-z+1/2,-x","x+1/2,-y+1/2,-z","-x,y+1/2,-z+1/2","-x+1/2,-y,z+1/2","y+1/4,x+3/4,-z+3/4","-y+1/4,-x+1/4,-z+1/4","z+3/4,-y+3/4,x+1/4","-z+1/4,-y+1/4,-x+1/4","-x+3/4,z+1/4,y+3/4","-x+1/4,-z+1/4,-y+1/4"],number:212},{symbol:"P 41 3 2",operators:["x,y,z","x+1/4,-z+1/4,y+3/4","x+3/4,z+1/4,-y+1/4","z+3/4,y+1/4,-x+1/4","-z+1/4,y+3/4,x+1/4","-y+1/4,x+3/4,z+1/4","y+1/4,-x+1/4,z+3/4","z,x,y","y,z,x","-y+1/2,-z,x+1/2","z+1/2,-x+1/2,-y","-y,z+1/2,-x+1/2","-z+1/2,-x,y+1/2","-z,x+1/2,-y+1/2","y+1/2,-z+1/2,-x","x+1/2,-y+1/2,-z","-x,y+1/2,-z+1/2","-x+1/2,-y,z+1/2","y+3/4,x+1/4,-z+1/4","-y+3/4,-x+3/4,-z+3/4","z+1/4,-y+1/4,x+3/4","-z+3/4,-y+3/4,-x+3/4","-x+1/4,z+3/4,y+1/4","-x+3/4,-z+3/4,-y+3/4"],number:213},{symbol:"I 41 3 2",operators:["x,y,z","x+1/4,-z+1/4,y+3/4","x+1/4,z+3/4,-y+3/4","z+1/4,y+3/4,-x+3/4","-z+1/4,y+3/4,x+1/4","-y+1/4,x+3/4,z+1/4","y+1/4,-x+1/4,z+3/4","z,x,y","y,z,x","-y,-z+1/2,x","z,-x,-y+1/2","-y+1/2,z,-x","-z,-x+1/2,y","-z+1/2,x,-y","y,-z,-x+1/2","x,-y,-z+1/2","-x+1/2,y,-z","-x,-y+1/2,z","y+1/4,x+3/4,-z+3/4","-y+1/4,-x+1/4,-z+1/4","z+1/4,-y+1/4,x+3/4","-z+1/4,-y+1/4,-x+1/4","-x+1/4,z+3/4,y+1/4","-x+1/4,-z+1/4,-y+1/4"],number:214},{symbol:"P -4 3 m",operators:["x,y,z","-x,z,-y","-x,-z,y","-z,-y,x","z,-y,-x","y,-x,-z","-y,x,-z","z,x,y","y,z,x","-y,-z,x","z,-x,-y","-y,z,-x","-z,-x,y","-z,x,-y","y,-z,-x","x,-y,-z","-x,y,-z","-x,-y,z","-y,-x,z","y,x,z","-z,y,-x","z,y,x","x,-z,-y","x,z,y"],number:215},{symbol:"F -4 3 m",operators:["x,y,z","-x,z,-y","-x,-z,y","-z,-y,x","z,-y,-x","y,-x,-z","-y,x,-z","z,x,y","y,z,x","-y,-z,x","z,-x,-y","-y,z,-x","-z,-x,y","-z,x,-y","y,-z,-x","x,-y,-z","-x,y,-z","-x,-y,z","-y,-x,z","y,x,z","-z,y,-x","z,y,x","x,-z,-y","x,z,y"],number:216},{symbol:"I -4 3 m",operators:["x,y,z","-x,z,-y","-x,-z,y","-z,-y,x","z,-y,-x","y,-x,-z","-y,x,-z","z,x,y","y,z,x","-y,-z,x","z,-x,-y","-y,z,-x","-z,-x,y","-z,x,-y","y,-z,-x","x,-y,-z","-x,y,-z","-x,-y,z","-y,-x,z","y,x,z","-z,y,-x","z,y,x","x,-z,-y","x,z,y"],number:217},{symbol:"P -4 3 n",operators:["x,y,z","-x+1/2,z+1/2,-y+1/2","-x+1/2,-z+1/2,y+1/2","-z+1/2,-y+1/2,x+1/2","z+1/2,-y+1/2,-x+1/2","y+1/2,-x+1/2,-z+1/2","-y+1/2,x+1/2,-z+1/2","z,x,y","y,z,x","-y,-z,x","z,-x,-y","-y,z,-x","-z,-x,y","-z,x,-y","y,-z,-x","x,-y,-z","-x,y,-z","-x,-y,z","-y+1/2,-x+1/2,z+1/2","y+1/2,x+1/2,z+1/2","-z+1/2,y+1/2,-x+1/2","z+1/2,y+1/2,x+1/2","x+1/2,-z+1/2,-y+1/2","x+1/2,z+1/2,y+1/2"],number:218},{symbol:"F -4 3 c",operators:["x,y,z","-x+1/2,z,-y","-x+1/2,-z,y","-z+1/2,-y,x","z+1/2,-y,-x","y+1/2,-x,-z","-y+1/2,x,-z","z,x,y","y,z,x","-y,-z,x","z,-x,-y","-y,z,-x","-z,-x,y","-z,x,-y","y,-z,-x","x,-y,-z","-x,y,-z","-x,-y,z","-y+1/2,-x,z","y+1/2,x,z","-z+1/2,y,-x","z+1/2,y,x","x+1/2,-z,-y","x+1/2,z,y"],number:219},{symbol:"I -4 3 d",operators:["x,y,z","-x+1/4,z+1/4,-y+3/4","-x+1/4,-z+3/4,y+3/4","-z+1/4,-y+3/4,x+3/4","z+1/4,-y+3/4,-x+1/4","y+1/4,-x+3/4,-z+1/4","-y+1/4,x+1/4,-z+3/4","z,x,y","y,z,x","-y,-z+1/2,x","z,-x,-y+1/2","-y+1/2,z,-x","-z,-x+1/2,y","-z+1/2,x,-y","y,-z,-x+1/2","x,-y,-z+1/2","-x+1/2,y,-z","-x,-y+1/2,z","-y+1/4,-x+3/4,z+3/4","y+1/4,x+1/4,z+1/4","-z+1/4,y+1/4,-x+3/4","z+1/4,y+1/4,x+1/4","x+1/4,-z+3/4,-y+1/4","x+1/4,z+1/4,y+1/4"],number:220},{symbol:"P m -3 m",operators:["x,y,z","x,-z,y","x,z,-y","z,y,-x","-z,y,x","-y,x,z","y,-x,z","z,x,y","y,z,x","-y,-z,x","z,-x,-y","-y,z,-x","-z,-x,y","-z,x,-y","y,-z,-x","x,-y,-z","-x,y,-z","-x,-y,z","y,x,-z","-y,-x,-z","z,-y,x","-z,-y,-x","-x,z,y","-x,-z,-y"],number:221},{symbol:"P n -3 n :2",operators:["x,y,z","x,-z+1/2,y","x,z,-y+1/2","z,y,-x+1/2","-z+1/2,y,x","-y+1/2,x,z","y,-x+1/2,z","z,x,y","y,z,x","-y+1/2,-z+1/2,x","z,-x+1/2,-y+1/2","-y+1/2,z,-x+1/2","-z+1/2,-x+1/2,y","-z+1/2,x,-y+1/2","y,-z+1/2,-x+1/2","x,-y+1/2,-z+1/2","-x+1/2,y,-z+1/2","-x+1/2,-y+1/2,z","y,x,-z+1/2","-y+1/2,-x+1/2,-z+1/2","z,-y+1/2,x","-z+1/2,-y+1/2,-x+1/2","-x+1/2,z,y","-x+1/2,-z+1/2,-y+1/2"],number:222},{symbol:"P m -3 n",operators:["x,y,z","x+1/2,-z+1/2,y+1/2","x+1/2,z+1/2,-y+1/2","z+1/2,y+1/2,-x+1/2","-z+1/2,y+1/2,x+1/2","-y+1/2,x+1/2,z+1/2","y+1/2,-x+1/2,z+1/2","z,x,y","y,z,x","-y,-z,x","z,-x,-y","-y,z,-x","-z,-x,y","-z,x,-y","y,-z,-x","x,-y,-z","-x,y,-z","-x,-y,z","y+1/2,x+1/2,-z+1/2","-y+1/2,-x+1/2,-z+1/2","z+1/2,-y+1/2,x+1/2","-z+1/2,-y+1/2,-x+1/2","-x+1/2,z+1/2,y+1/2","-x+1/2,-z+1/2,-y+1/2"],number:223},{symbol:"P n -3 m :2",operators:["x,y,z","x+1/2,-z,y+1/2","x+1/2,z+1/2,-y","z+1/2,y+1/2,-x","-z,y+1/2,x+1/2","-y,x+1/2,z+1/2","y+1/2,-x,z+1/2","z,x,y","y,z,x","-y+1/2,-z+1/2,x","z,-x+1/2,-y+1/2","-y+1/2,z,-x+1/2","-z+1/2,-x+1/2,y","-z+1/2,x,-y+1/2","y,-z+1/2,-x+1/2","x,-y+1/2,-z+1/2","-x+1/2,y,-z+1/2","-x+1/2,-y+1/2,z","y+1/2,x+1/2,-z","-y,-x,-z","z+1/2,-y,x+1/2","-z,-y,-x","-x,z+1/2,y+1/2","-x,-z,-y"],number:224},{symbol:"F m -3 m",operators:["x,y,z","x,-z,y","x,z,-y","z,y,-x","-z,y,x","-y,x,z","y,-x,z","z,x,y","y,z,x","-y,-z,x","z,-x,-y","-y,z,-x","-z,-x,y","-z,x,-y","y,-z,-x","x,-y,-z","-x,y,-z","-x,-y,z","y,x,-z","-y,-x,-z","z,-y,x","-z,-y,-x","-x,z,y","-x,-z,-y"],number:225},{symbol:"F m -3 c",operators:["x,y,z","x+1/2,-z,y","x+1/2,z,-y","z+1/2,y,-x","-z+1/2,y,x","-y+1/2,x,z","y+1/2,-x,z","z,x,y","y,z,x","-y,-z,x","z,-x,-y","-y,z,-x","-z,-x,y","-z,x,-y","y,-z,-x","x,-y,-z","-x,y,-z","-x,-y,z","y+1/2,x,-z","-y+1/2,-x,-z","z+1/2,-y,x","-z+1/2,-y,-x","-x+1/2,z,y","-x+1/2,-z,-y"],number:226},{symbol:"F d -3 m :2",operators:["x,y,z","x+1/4,-z,y+1/4","x+1/4,z+1/4,-y","z+1/4,y+1/4,-x","-z,y+1/4,x+1/4","-y,x+1/4,z+1/4","y+1/4,-x,z+1/4","z,x,y","y,z,x","-y+1/4,-z+1/4,x","z,-x+1/4,-y+1/4","-y+1/4,z,-x+1/4","-z+1/4,-x+1/4,y","-z+1/4,x,-y+1/4","y,-z+1/4,-x+1/4","x,-y+1/4,-z+1/4","-x+1/4,y,-z+1/4","-x+1/4,-y+1/4,z","y+1/4,x+1/4,-z","-y,-x,-z","z+1/4,-y,x+1/4","-z,-y,-x","-x,z+1/4,y+1/4","-x,-z,-y"],number:227},{symbol:"F d -3 c :2",operators:["x,y,z","x+1/4,-z,y+3/4","x+1/4,z+3/4,-y","z+1/4,y+3/4,-x","-z,y+1/4,x+3/4","-y,x+1/4,z+3/4","y+1/4,-x,z+3/4","z,x,y","y,z,x","-y+1/4,-z+1/4,x","z,-x+1/4,-y+1/4","-y+1/4,z,-x+1/4","-z+1/4,-x+1/4,y","-z+1/4,x,-y+1/4","y,-z+1/4,-x+1/4","x,-y+1/4,-z+1/4","-x+1/4,y,-z+1/4","-x+1/4,-y+1/4,z","y+1/4,x+3/4,-z","-y+1/2,-x,-z","z+1/4,-y,x+3/4","-z+1/2,-y,-x","-x,z+1/4,y+3/4","-x+1/2,-z,-y"],number:228},{symbol:"I m -3 m",operators:["x,y,z","x,-z,y","x,z,-y","z,y,-x","-z,y,x","-y,x,z","y,-x,z","z,x,y","y,z,x","-y,-z,x","z,-x,-y","-y,z,-x","-z,-x,y","-z,x,-y","y,-z,-x","x,-y,-z","-x,y,-z","-x,-y,z","y,x,-z","-y,-x,-z","z,-y,x","-z,-y,-x","-x,z,y","-x,-z,-y"],number:229},{symbol:"I a -3 d",operators:["x,y,z","x+1/4,-z+1/4,y+3/4","x+1/4,z+3/4,-y+3/4","z+1/4,y+3/4,-x+3/4","-z+1/4,y+3/4,x+1/4","-y+1/4,x+3/4,z+1/4","y+1/4,-x+1/4,z+3/4","z,x,y","y,z,x","-y,-z+1/2,x","z,-x,-y+1/2","-y+1/2,z,-x","-z,-x+1/2,y","-z+1/2,x,-y","y,-z,-x+1/2","x,-y,-z+1/2","-x+1/2,y,-z","-x,-y+1/2,z","y+1/4,x+3/4,-z+3/4","-y+1/4,-x+1/4,-z+1/4","z+1/4,-y+1/4,x+3/4","-z+1/4,-y+1/4,-x+1/4","-x+1/4,z+3/4,y+1/4","-x+1/4,-z+1/4,-y+1/4"],number:230}]};THREE.TrackballControls=function(a,b){function c(a){l.enabled!==!1&&(window.removeEventListener("keydown",c),p=o,o===m.NONE&&(a.keyCode!==l.keys[m.ROTATE]||l.noRotate?a.keyCode!==l.keys[m.ZOOM]||l.noZoom?a.keyCode!==l.keys[m.PAN]||l.noPan||(o=m.PAN):o=m.ZOOM:o=m.ROTATE))}function d(a){l.enabled!==!1&&(o=p,window.addEventListener("keydown",c,!1))}function e(a){l.enabled!==!1&&(a.preventDefault(),a.stopPropagation(),o===m.NONE&&(o=a.button),o!==m.ROTATE||l.noRotate?o!==m.ZOOM||l.noZoom?o!==m.PAN||l.noPan||(l.getMouseOnScreen(a.pageX,a.pageY,x),y.copy(x)):(l.getMouseOnScreen(a.pageX,a.pageY,t),u.copy(t)):(l.getMouseProjectionOnBall(a.pageX,a.pageY,r),s.copy(r)),document.addEventListener("mousemove",f,!1),document.addEventListener("mouseup",g,!1),l.dispatchEvent(A))}function f(a){l.enabled!==!1&&(a.preventDefault(),a.stopPropagation(),o!==m.ROTATE||l.noRotate?o!==m.ZOOM||l.noZoom?o!==m.PAN||l.noPan||l.getMouseOnScreen(a.pageX,a.pageY,y):l.getMouseOnScreen(a.pageX,a.pageY,u):l.getMouseProjectionOnBall(a.pageX,a.pageY,s))}function g(a){l.enabled!==!1&&(a.preventDefault(),a.stopPropagation(),o=m.NONE,document.removeEventListener("mousemove",f),document.removeEventListener("mouseup",g),l.dispatchEvent(B))}function h(a){if(l.enabled!==!1){a.preventDefault(),a.stopPropagation();var b=0;a.wheelDelta?b=a.wheelDelta/40:a.detail&&(b=-a.detail/3),t.y+=.01*b,l.dispatchEvent(A),l.dispatchEvent(B)}}function i(a){if(l.enabled!==!1){switch(a.touches.length){case 1:o=m.TOUCH_ROTATE,s.copy(l.getMouseProjectionOnBall(a.touches[0].pageX,a.touches[0].pageY,r));break;case 2:o=m.TOUCH_ZOOM;var b=a.touches[0].pageX-a.touches[1].pageX,c=a.touches[0].pageY-a.touches[1].pageY;w=v=Math.sqrt(b*b+c*c);break;case 3:o=m.TOUCH_PAN,y.copy(l.getMouseOnScreen(a.touches[0].pageX,a.touches[0].pageY,x));break;default:o=m.NONE}l.dispatchEvent(A)}}function j(a){if(l.enabled!==!1)switch(a.preventDefault(),a.stopPropagation(),a.touches.length){case 1:l.getMouseProjectionOnBall(a.touches[0].pageX,a.touches[0].pageY,s);break;case 2:var b=a.touches[0].pageX-a.touches[1].pageX,c=a.touches[0].pageY-a.touches[1].pageY;w=Math.sqrt(b*b+c*c);break;case 3:l.getMouseOnScreen(a.touches[0].pageX,a.touches[0].pageY,y);break;default:o=m.NONE}}function k(a){if(l.enabled!==!1){switch(a.touches.length){case 1:r.copy(l.getMouseProjectionOnBall(a.touches[0].pageX,a.touches[0].pageY,s));break;case 2:v=w=0;break;case 3:x.copy(l.getMouseOnScreen(a.touches[0].pageX,a.touches[0].pageY,y))}o=m.NONE,l.dispatchEvent(B)}}var l=this,m={NONE:-1,ROTATE:0,ZOOM:2,PAN:1,TOUCH_ROTATE:3,TOUCH_ZOOM:4,TOUCH_PAN:5};this.object=a,this.domElement=void 0!==b?b:document,this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.noRoll=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.keys=[18,17,16],this.target=new THREE.Vector3;var n=new THREE.Vector3,o=m.NONE,p=m.NONE,q=new THREE.Vector3,r=new THREE.Vector3,s=new THREE.Vector3,t=new THREE.Vector2,u=new THREE.Vector2,v=0,w=0,x=new THREE.Vector2,y=new THREE.Vector2;this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone();var z={type:"change"},A={type:"start"},B={type:"end"};this.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{this.screen=this.domElement.getBoundingClientRect();var a=this.domElement.ownerDocument.documentElement;this.screen.left+=window.pageXOffset-a.clientLeft,this.screen.top+=window.pageYOffset-a.clientTop}},this.handleEvent=function(a){"function"==typeof this[a.type]&&this[a.type](a)},this.getMouseOnScreen=function(a,b,c){return c.set((a-l.screen.left)/l.screen.width,(b-l.screen.top)/l.screen.height)},this.getMouseProjectionOnBall=function(){var a=new THREE.Vector3,b=new THREE.Vector3;return function(c,d,e){b.set((c-.5*l.screen.width-l.screen.left)/(.5*l.screen.width),(.5*l.screen.height+l.screen.top-d)/(.5*l.screen.height),0);var f=b.length();return l.noRoll?f<Math.SQRT1_2?b.z=Math.sqrt(1-f*f):b.z=.5/f:f>1?b.normalize():b.z=Math.sqrt(1-f*f),q.copy(l.object.position).sub(l.target),e.copy(l.object.up).setLength(b.y),e.add(a.copy(l.object.up).cross(q).setLength(b.x)),e.add(q.setLength(b.z)),e}}(),this.rotateCamera=function(){var a=new THREE.Vector3,b=new THREE.Quaternion;return function(){var c=Math.acos(r.dot(s)/r.length()/s.length());c&&(a.crossVectors(r,s).normalize(),c*=l.rotateSpeed,b.setFromAxisAngle(a,-c),q.applyQuaternion(b),l.object.up.applyQuaternion(b),s.applyQuaternion(b),l.staticMoving?r.copy(s):(b.setFromAxisAngle(a,c*(l.dynamicDampingFactor-1)),r.applyQuaternion(b)))}}(),this.zoomCamera=function(){if(o===m.TOUCH_ZOOM){var a=v/w;v=w,q.multiplyScalar(a)}else{var a=1+(u.y-t.y)*l.zoomSpeed;1!==a&&a>0&&(q.multiplyScalar(a),l.staticMoving?t.copy(u):t.y+=(u.y-t.y)*this.dynamicDampingFactor)}},this.panCamera=function(){var a=new THREE.Vector2,b=new THREE.Vector3,c=new THREE.Vector3;return function(){a.copy(y).sub(x),a.lengthSq()&&(a.multiplyScalar(q.length()*l.panSpeed),c.copy(q).cross(l.object.up).setLength(a.x),c.add(b.copy(l.object.up).setLength(a.y)),l.object.position.add(c),l.target.add(c),l.staticMoving?x.copy(y):x.add(a.subVectors(y,x).multiplyScalar(l.dynamicDampingFactor)))}}(),this.checkDistances=function(){l.noZoom&&l.noPan||(q.lengthSq()>l.maxDistance*l.maxDistance&&l.object.position.addVectors(l.target,q.setLength(l.maxDistance)),q.lengthSq()<l.minDistance*l.minDistance&&l.object.position.addVectors(l.target,q.setLength(l.minDistance)))},this.update=function(){q.subVectors(l.object.position,l.target),l.noRotate||l.rotateCamera(),l.noZoom||l.zoomCamera(),l.noPan||l.panCamera(),l.object.position.addVectors(l.target,q),l.checkDistances(),l.object.lookAt(l.target),n.distanceToSquared(l.object.position)>0&&(l.dispatchEvent(z),n.copy(l.object.position))},this.reset=function(){o=m.NONE,p=m.NONE,l.target.copy(l.target0),l.object.position.copy(l.position0),l.object.up.copy(l.up0),q.subVectors(l.object.position,l.target),l.object.lookAt(l.target),l.dispatchEvent(z),n.copy(l.object.position)},this.domElement.addEventListener("contextmenu",function(a){a.preventDefault()},!1),this.domElement.addEventListener("mousedown",e,!1),this.domElement.addEventListener("mousewheel",h,!1),this.domElement.addEventListener("DOMMouseScroll",h,!1),this.domElement.addEventListener("touchstart",i,!1),this.domElement.addEventListener("touchend",k,!1),this.domElement.addEventListener("touchmove",j,!1),window.addEventListener("keydown",c,!1),window.addEventListener("keyup",d,!1),this.handleResize()},THREE.TrackballControls.prototype=Object.create(THREE.EventDispatcher.prototype);var xtal=function(a){return a}(xtal||{});xtal.viewer=function(a){return{}}(xtal);var orthographic=!1,xtal=function(a){return a}(xtal||{});xtal.viewer=function(a){return{}}(xtal),Exi.prototype.appendDataAdapterParameters=function(a){if(a||(a={}),EXI.credentialManager.getCredentials()[0]&&!EXI.credentialManager.getCredentials()[0].isValid())return void(location.hash="/welcome");var b=EXI.credentialManager.getConnections();return b.length>0&&(a.url=b[0].url,a.token=b[0].token,a.proposal=b[0].proposal),a},Exi.prototype.getDataAdapter=function(a){var b=new DataAdapterFactory(this.appendDataAdapterParameters(a));return b},Exi.prototype.setAnonymousMenu=function(){this.mainMenu=this.anonymousMenu,Ext.getCmp("mainMenu").removeAll(),Ext.getCmp("mainMenu").add(EXI.mainMenu.getPanel())},Exi.prototype.setUserMenu=function(){this.mainMenu=this.userMenu,Ext.getCmp("mainMenu").removeAll(),Ext.getCmp("mainMenu").add(EXI.mainMenu.getPanel())},Exi.prototype.loadSelected=function(a){},Exi.prototype.addMainPanel=function(a){this.keepTabs||Ext.getCmp("main_panel").removeAll(),Ext.getCmp("main_panel").add(a.getPanel()),Ext.getCmp("main_panel").setActiveTab(Ext.getCmp("main_panel").items.length-1)},Exi.prototype.getSelectedDataCollections=function(){for(var a=[],b=0;b<this.experimentListView.length;b++)a=a.concat(this.experimentListView[b].getSelected());return a},Exi.prototype.addNavigationPanel=function(a){Ext.getCmp("navigation").add(a.getPanel()),null!=Ext.getCmp("navigation")&&(Ext.getCmp("navigation").expand(),this.showNavigationPanel())},Exi.prototype.hideNavigationPanel=function(a){null!=Ext.getCmp("navigation")&&Ext.getCmp("navigation").hide()},Exi.prototype.showNavigationPanel=function(a){null!=Ext.getCmp("navigation")&&Ext.getCmp("navigation").show()},Exi.prototype.clearNavigationPanel=function(){Ext.getCmp("navigation").removeAll()},Exi.prototype.clearMainPanel=function(){Ext.getCmp("main_panel").removeAll()},Exi.prototype.setLoadingNavigationPanel=function(a){Ext.getCmp("navigation").setLoading(a)},Exi.prototype.setLoadingMainPanel=function(a){Ext.getCmp("main_panel").setLoading(a)},Exi.prototype.setError=function(a){this.mainStatusBar.showError(a)},Exi.prototype.setLoading=function(a){null==a||1==a?this.mainStatusBar.showBusy():this.mainStatusBar.showReady()},Exi.prototype.getHeader=function(a){return'<img class="titleImage" src="images/logo_EMBL.png"><span class="title">Extended ISPyB</span>'},Exi.prototype.show=function(){var a=this;Ext.application({name:"ExiSAXS",launch:function(){Ext.create("Ext.container.Viewport",{layout:"border",items:[{region:"north",xtype:"component",padding:10,height:75,html:a.getHeader(),cls:a.headerCssClass},{region:"north",cls:"toolbarPanel",id:"mainMenu",xtype:"panel",width:400,items:a.mainMenu.getPanel()},{xtype:"panel",id:"navigation",region:"west",width:250,split:!1,title:"Browse by",cls:"navigation",collapsible:!0,collapsed:!0},{region:"center",id:"main_panel",xtype:"tabpanel",cls:"navigation",plain:!0,items:[]},{region:"south",xtype:"panel",cls:"statusBar",bbar:a.mainStatusBar.getBar()}],listeners:{afterrender:function(b,c){a.mainMenu.populateCredentialsMenu(),a.onAfterRender.notify(),0==a.credentialManager.getCredentials()?a.setAnonymousMenu():(a.setUserMenu(),a.mainMenu.populateCredentialsMenu())}}})}})},MainStatusBar.prototype.getBar=function(){return this.statusBar=Ext.create("Ext.ux.StatusBar",{id:"main-status-bar",text:"Ready",iconCls:"accept",busyIconCls:"busy",busyText:this.busyText,cls:"statusBar",statusAlign:"right"}),this.statusBar},MainStatusBar.prototype.showBusy=function(a){null==a&&(a="Connecting to servers..."),this.statusBar.busyText=a,this.statusBar.showBusy()},MainStatusBar.prototype.showError=function(a){this.statusBar.clearStatus(),this.statusBar.setStatus({text:a,iconCls:"error"})},MainStatusBar.prototype.showReady=function(){this.statusBar.clearStatus(),this.statusBar.setStatus({text:"Ready",iconCls:"accept"})},ProposalManager.prototype.get=function(a){var b=this;if(null==localStorage.getItem("proposals")||a){var c=function(a,c){localStorage.setItem("proposals",JSON.stringify(c)),b.onActiveProposalChanged.notify()};EXI.getDataAdapter({async:!0,onSuccess:c}).proposal.proposal.getProposalsInfo()}return JSON.parse(localStorage.getItem("proposals"))},ProposalManager.prototype.clear=function(){localStorage.removeItem("proposals")},ProposalManager.prototype.getSessions=function(){if(null==localStorage.getItem("sessions")){var a=function(a,b){localStorage.setItem("sessions",JSON.stringify(b))};EXI.getDataAdapter({async:!1,onSuccess:a}).proposal.session.getSessions()}return JSON.parse(localStorage.getItem("sessions"))},ProposalManager.prototype.getFutureSessions=function(){for(var a=this.getSessions(),b=moment(),c=[],d=0;d<a.length;d++)b.diff(a[d].BLSession_startDate)<0&&c.push(a[d]);return c},ProposalManager.prototype.getBufferColors=function(){return["#ffffcc","#c7e9b4","#7fcdbb","#41b6c4","#2c7fb8","#253494"]},ProposalManager.prototype.getLabcontacts=function(){return this.get()[0].labcontacts},ProposalManager.prototype.getLabcontactById=function(a){return _.find(this.getLabcontacts(),function(b){return b.labContactId==a})},ProposalManager.prototype.getPlateTypeById=function(a){return _.find(this.getPlateTypes(),function(b){return b.plateTypeId==a})},ProposalManager.prototype.getPlateTypes=function(){return this.get()[0].plateTypes},ProposalManager.prototype.getPlateByFlavour=function(a){return[this.getPlateTypes()[0],this.getPlateTypes()[2],this.getPlateTypes()[3]]},ProposalManager.prototype.getBufferById=function(a){for(var b=this.get(),c=function(b){return b.bufferId==a},d=0;d<b.length;d++){var e=_.find(b[d].buffers,c);if(null!=e)return e}},ProposalManager.prototype.getMacromoleculeById=function(a){for(var b=this.get(),c=function(b){return b.macromoleculeId==a},d=0;d<b.length;d++){var e=_.find(b[d].macromolecules,c);if(null!=e)return e}return null},ProposalManager.prototype.getMacromoleculeByAcronym=function(a){for(var b=this.get(),c=function(b){return b.acronym==a},d=0;d<b.length;d++){var e=_.find(b[d].macromolecules,c);if(null!=e)return e}return null},ProposalManager.prototype.getStockSolutionById=function(a){for(var b=this.get(),c=function(b){return b.stockSolutionId==a},d=0;d<b.length;d++){var e=_.find(b[d].stockSolutions,c);if(null!=e)return e}},ProposalManager.prototype.getBuffers=function(){for(var a=this.get(),b=[],c=0;c<a.length;c++)b=b.concat(a[c].buffers);return b},ProposalManager.prototype.getMacromolecules=function(){for(var a=this.get(),b=[],c=0;c<a.length;c++)b=b.concat(a[c].macromolecules);
return b},ProposalManager.prototype.getProposals=function(){for(var a=this.get(),b=[],c=0;c<a.length;c++)a[c].proposal[0].proposal=a[c].proposal[0].code+a[c].proposal[0].number,b=b.concat(a[c].proposal);return b},ProposalManager.prototype.getProposalById=function(a){for(var b=this.get(),c=[],d=0;d<b.length;d++)if(b[d].proposal[0].proposalId==a)return b[d].proposal[0];return c},ProposalManager.prototype.getStockSolutions=function(){return this.get()[0].stockSolutions},ProposalManager.prototype.getProteins=function(){return this.get()[0].proteins},ProposalManager.prototype.getCrystals=function(){return this.get()[0].crystals},ProposalManager.prototype.getProteinByAcronym=function(a){return _.filter(this.getProteins(),function(b){return b.acronym==a})},ProposalManager.prototype.getCrystalsByAcronym=function(a){return _.filter(this.getCrystals(),function(b){return null==b.proteinVO?!1:b.proteinVO.acronym==a})},ProposalManager.prototype.getStockSolutionsBySpecimen=function(a,b){var c=_.filter(this.getStockSolutions(),function(b){return b.macromoleculeId==a});return _.filter(c,function(a){return a.bufferId==b})},ProposalManager.prototype.getUnpackedStockSolutions=function(){for(var a=this.getStockSolutions(),b=[],c=0;c<a.length;c++)null==a[c].boxId&&b.push(a[c]);return b},ProposalManager.prototype.getStockSolutionsByDewarId=function(a){return _.filter(this.getStockSolutions(),function(b){return b.boxId==a})},ExiGenericController.prototype.setPageBackground=function(){},ExiGenericController.prototype.notFound=function(){},MainView.prototype.getContainer=function(){return this.container},MainView.prototype.getPanel=function(){return this.container=Ext.create("Ext.container.Container",{xtype:"container",items:[]}),this.panel=Ext.create("Ext.panel.Panel",{autoScroll:!0,title:this.title,closable:this.closable,icon:this.icon,bodyStyle:this.bodyStyle,items:[this.getContainer()]}),this.panel},AuthenticationManager.prototype.login=function(a,b,c){var d=this,e=function(b,e){d.onSuccess.notify({user:a,roles:e.roles,token:e.token,url:c})},f=function(a,b){EXI.setError("Permission denied"),BUI.showError("Your credentials are invalid")};EXI.getDataAdapter({onSuccess:e,onError:f,url:c,username:a}).proposal.authentication.authenticate(a,b,c)},ExiController.prototype.loadNavigationPanel=function(a){EXI.clearNavigationPanel(),EXI.setLoadingNavigationPanel(!0);var b=function(b,c){EXI.addNavigationPanel(a),a.load(c),EXI.setLoadingNavigationPanel(!1)},c=function(a,b){EXI.setLoadingNavigationPanel(!1)};return EXI.getDataAdapter({onSuccess:b,onError:c})},ExiController.prototype.init=function(){function a(){}function b(){}Path.map("#/").to(function(){location.hash="/welcome"}).enter(a),Path.map("#/login").to(function(){EXI.credentialManager.logout(),EXI.authenticationForm.show()}).enter(a),Path.map("#/welcome").to(function(){EXI.credentialManager.logout(),EXI.authenticationForm.show()}).enter(a),Path.map("#/welcome/user/:user/main").to(function(){var a=this.params.user,b=new ManagerWelcomeMainView;EXI.addMainPanel(b),EXI.hideNavigationPanel(),b.load(a)}).enter(a),Path.map("#/welcome/manager/:user/main").to(function(){var a=this.params.user,b=new ManagerWelcomeMainView;EXI.addMainPanel(b),EXI.hideNavigationPanel(),b.load(a)}).enter(a),Path.map("#/welcome/manager/:user/date/:start/:end/main").to(function(){var a=this.params.user,b=new ManagerWelcomeMainView;EXI.addMainPanel(b),EXI.hideNavigationPanel(),b.loadSessionsByDate(a,this.params.start,this.params.end)}).enter(a),Path.map("#/logout").to(function(){EXI.credentialManager.logout(),EXI.hideNavigationPanel(),EXI.proposalManager.clear()}).enter(a),Path.root("#/"),Path.rescue(b)},ExiGenericController.prototype.setPageBackground=function(){},ExiGenericController.prototype.notFound=function(){},LabContactExiController.prototype.loadNavigationPanel=ExiController.prototype.loadNavigationPanel,LabContactExiController.prototype.setPageBackground=function(){},LabContactExiController.prototype.notFound=function(){},LabContactExiController.prototype.init=function(){function a(a){return b.loadNavigationPanel(a)}var b=this,c=null,d=null;Path.map("#/proposal/addresses/nav").to(function(){EXI.clearNavigationPanel(),EXI.setLoadingNavigationPanel(!0),c=new AddressListView,c.onSelect.attach(function(a,b){location.hash="/proposal/address/"+b[0].labContactId+"/main"}),EXI.addNavigationPanel(c),d=a(c),d.proposal.labcontacts.getLabContacts(),EXI.addMainPanel(new AddressWelcomeMainView)}).enter(this.setPageBackground),Path.map("#/proposal/address/:lacontactId/main").to(function(){var a=new AddressMainView;EXI.addMainPanel(a),a.load(this.params.lacontactId)}).enter(this.setPageBackground)},OfflineExiController.prototype.setPageBackground=function(){},OfflineExiController.prototype.notFound=function(){},OfflineExiController.prototype.init=function(){function a(){b.notFound()}var b=this;Path.map("#/tool/dimple/main").to(function(){var a=new DimpleMainView;EXI.addMainPanel(a),a.load()}).enter(this.setPageBackground),Path.map("#/tool/dimple/datacollection/:dataCollectionId/main").to(function(){var a=new DimpleDCMainView;EXI.addMainPanel(a),a.load(this.params.dataCollectionId)}).enter(this.setPageBackground),Path.map("#/tool/reprocess/datacollection/:dataCollectionId/:startImage/:endImage/main").to(function(){var a=new ReprocessMainView;EXI.addMainPanel(a),a.load(this.params.dataCollectionId,this.params.startImage,this.params.endImage)}).enter(this.setPageBackground),Path.map("#/tool/crysol/main").to(function(){var a=new CrysolMainView;EXI.addMainPanel(a),a.load()}).enter(this.setPageBackground),Path.map("#/tool/subtraction/main").to(function(){var a=new SubtractionMainView;EXI.addMainPanel(a),a.load()}).enter(this.setPageBackground),Path.map("#/tool/list").to(function(){var a=null,b=new RunListView;b.onSelect.attach(function(b,c){var d=c[0].internalId,e=a.internalId;"Dimple"==c[0].tool?location.hash="/project/"+e+"/dimple/"+d+"/main":location.hash="/project/"+e+"/run/"+d+"/main"}),EXI.clearNavigationPanel(),EXI.setLoadingNavigationPanel(!0);var c=function(c,d){a=d[0],EXI.addNavigationPanel(b),b.load(d[0].runs.reverse()),EXI.setLoadingNavigationPanel(!1)},d=function(a,b){EXI.setLoadingNavigationPanel(!1)};EXI.getDataAdapter({onSuccess:c,onError:d}).exi.offline.getProject()}).enter(this.setPageBackground),Path.map("#/project/:projectId/run/:runId/main").to(function(){var a=this.params.projectId,b=this.params.runId,c=function(a,c){for(var d=0;d<c.length;d++)if(c[d].internalId==b){var e=new RunMainView;EXI.addMainPanel(e),e.load(c[d])}},d=function(a){BUI.showError("There was an error")};EXI.getDataAdapter({onSuccess:c,onError:d}).exi.offline.getRuns(a)}).enter(this.setPageBackground),Path.map("#/project/:projectId/dimple/:runId/main").to(function(){var a=this.params.projectId,b=this.params.runId,c=function(a,c){for(var d=0;d<c.length;d++)if(c[d].internalId==b){var e=new DimpleRunMainView;EXI.addMainPanel(e),e.load(c[d])}},d=function(a){BUI.showError("There was an error")};EXI.getDataAdapter({onSuccess:c,onError:d}).exi.offline.getRuns(a)}).enter(this.setPageBackground),Path.rescue(a)},ProposalExiController.prototype.loadNavigationPanel=ExiController.prototype.loadNavigationPanel,ProposalExiController.prototype.setPageBackground=function(){},ProposalExiController.prototype.notFound=function(){},ProposalExiController.prototype.init=function(){function a(a){return b.loadNavigationPanel(a)}var b=this,c=null,d=null;Path.map("#/proposal/session/nav").to(function(){c=new SessionListView,c.onSelect.attach(function(a,b){"SAXS"==EXI.credentialManager.getTechniqueByBeamline(b[0].beamlineName)?location.hash="/session/nav/"+b[0].sessionId+"/session":location.hash="/mx/datacollection/session/"+b[0].sessionId+"/main"}),d=a(c),d.proposal.session.getSessions()}).enter(this.setPageBackground),Path.map("#/proposal/address/:lacontactId/main").to(function(){var a=new AddressMainView;EXI.addMainPanel(a),a.load(this.params.lacontactId)}).enter(this.setPageBackground),Path.map("#/puck/:containerId/main").to(function(){var a=new PuckMainView;EXI.addMainPanel(a),a.load(this.params.containerId)}).enter(this.setPageBackground)},SessionController.prototype.setPageBackground=ExiGenericController.prototype.setPageBackground,SessionController.prototype.notFound=ExiGenericController.prototype.notFound,SessionController.prototype.init=function(){Path.map("#/session/nav").to(function(){EXI.clearNavigationPanel(),EXI.hideNavigationPanel();var a=new SessionMainView({title:"Sessions"});EXI.addMainPanel(a);var b=function(b,c){a.load(EXI.proposalManager.getSessions()),EXI.setLoadingMainPanel(!1)};EXI.setLoadingMainPanel(),EXI.getDataAdapter({onSuccess:b}).proposal.session.getSessions()}).enter(this.setPageBackground),Path.rescue(this.notFound)},ShippingExiController.prototype.loadNavigationPanel=ExiController.prototype.loadNavigationPanel,ShippingExiController.prototype.setPageBackground=function(){},ShippingExiController.prototype.notFound=function(){},ShippingExiController.prototype.loadShipmentsNavigationPanel=function(a){EXI.clearNavigationPanel(),EXI.setLoadingMainPanel(!0);var b=function(b,c){c=BUI.groupBy(c,function(a){return a.Shipping_shippingId});for(var d=[],e=0;e<c.length;e++)d.push(c[e][0]);d.sort(function(a,b){return b.Shipping_shippingId-a.Shipping_shippingId}),EXI.addNavigationPanel(a),a.load(d),EXI.setLoadingMainPanel(!1)},c=function(a,b){EXI.setLoadingNavigationPanel(!1)};return EXI.getDataAdapter({onSuccess:b,onError:c})},ShippingExiController.prototype.init=function(){function a(){var a=new ShippingListView;a.onSelect.attach(function(a,b){location.hash="/shipping/"+b[0].Shipping_shippingId+"/main"}),c=b.loadShipmentsNavigationPanel(a),c.proposal.shipping.getShippings()}var b=this,c=null;Path.map("#/proposal/shipping/nav?nomain").to(function(){a()}),Path.map("#/proposal/shipping/nav").to(function(){a(),EXI.addMainPanel(new ShippingWelcomeMainView)}),Path.map("#/shipping/:shippingId/main").to(function(){var a=new ShippingMainViewTest;EXI.addMainPanel(a),a.load(this.params.shippingId)}).enter(this.setPageBackground),Path.map("#/shipping/main").to(function(){var a=new ShippingMainViewTest;EXI.addMainPanel(a),a.load()}).enter(this.setPageBackground),Path.map("#/shipping/edv").to(function(){var a=new ElectronDensityViewer;EXI.addMainPanel(a)}).enter(this.setPageBackground)},BootstrapGrid.prototype.getPanel=function(){var a=this;return this.panel=Ext.create("Ext.panel.Panel",{width:this.width,autoScroll:!0,autoHeight:!0,maxHeight:this.height,title:this.data.header,items:[{html:this.getHTML()}]}),this.panel.on("boxready",function(){a.setClickListeners()}),this.panel},BootstrapGrid.prototype.setClickListeners=function(){var a=this;$("#bootstrap-table-"+this.id).unbind("click").on("click",".clickable-row",function(b){$(this).addClass("active-step").siblings().removeClass("active-step"),a.rowSelected.notify(b.target.innerText)})},BootstrapGrid.prototype.selectRowByValue=function(a){var b=this.data.values.indexOf(a);b>=0&&($("#row-"+b+"-"+this.id).addClass("active-step").siblings().removeClass("active-step"),this.rowSelected.notify($("#row-"+b+"-"+this.id)[0].innerText))},BootstrapGrid.prototype.deselectAll=function(){$("#bootstrap-table-"+this.id).find(".clickable-row").removeClass("active-step")},BootstrapGrid.prototype.getHTML=function(){var a="";return dust.render(this.template,this.data,function(b,c){a=c}),"<div id='bootstrap-grid-"+this.id+"'>"+a+"</div>"},BootstrapGrid.prototype.load=function(a){this.data=a,this.data.id=this.id,$("#bootstrap-grid"+this.id).length&&(this.panel.setTitle(a.header),$("#bootstrap-grid"+this.id).html(this.getHTML()),this.setClickListeners())},MainMenu.prototype.getMenuItems=function(){return[]},MainMenu.prototype.getHomeItem=function(){return{text:this._convertToHTMLWhiteSpan("Home"),cls:"ExiSAXSMenuToolBar",icon:"../images/icon/rsz_ic_home_black_24dp.png",handler:function(){if(null!=EXI.credentialManager.getCredentials())if(EXI.credentialManager.getCredentials().length>0){var a=EXI.credentialManager.getCredentials()[0].username,b=EXI.credentialManager.getCredentialByUserName(EXI.credentialManager.getCredentials()[0].username);b.isManager()?location.hash="/welcome/manager/"+a+"/main":location.hash="/welcome/user/"+a+"/main"}else BUI.showError("You should sign up");else BUI.showError("You should sign up")}}},MainMenu.prototype.getShipmentItem=function(){function a(a,b){"Shipments"==a.text&&(location.hash="/proposal/shipping/nav"),"Manage shipping addresses"==a.text&&(location.hash="/proposal/addresses/nav"),"Shipment List"==a.text&&(location.hash="/proposal/shipping/nav")}function b(){function a(a,b){"Stock Solutions"==a.text&&(location.hash="/saxs/stocksolution/nav")}return Ext.create("Ext.menu.Menu",{items:[{text:"Stock Solutions",icon:"../images/icon/testtube.png",handler:a}]})}return{text:this._convertToHTMLWhiteSpan("Shipment"),cls:"ExiSAXSMenuToolBar",disabled:!1,menu:Ext.create("Ext.menu.Menu",{items:[{text:"BioSAXS",icon:"../images/icon/macromolecule.png",menu:b()},{text:"Manage shipping addresses",icon:"../images/icon/contacts.png",handler:a},{text:"Shipments",icon:"../images/icon/shipping.png",handler:a}]})}},MainMenu.prototype.getHelpMenu=function(){function a(a,b){"ISPyB Web services API Map"==a.text&&window.open("/exi/documentation/ispyb-api-ws/print.html"),"Job list"==a.text&&(location.hash="/tool/list")}return Ext.create("Ext.menu.Menu",{items:[{text:"Developer",checked:!1,group:"theme",menu:{items:[{text:"ISPyB Web services API Map",handler:a},{text:"How to retrieve data from ISPyB?",handler:a},{text:"EXI Router",handler:a},{text:"EXI List Views Objects",handler:a},{text:"EXI Main View Objects",handler:a}]}},"-",{text:"About",checked:!1,group:"theme",handler:a}]})},MainMenu.prototype.getAddCredentialMenu=function(){return null!=EXI.credentialManager.getCredentials()&&EXI.credentialManager.getCredentials().length>0?{icon:"../images/icon/rsz_1ic_input_black_24dp.png",height:30,text:"Add",handler:function(){window.location.href="#/login"}}:void 0},MainMenu.prototype.populateCredentialsMenu=function(){this.credentialsMenu.removeAll();var a="";if(null!=EXI.credentialManager.getCredentials())for(var b=0;b<EXI.credentialManager.getCredentials().length;b++)if(a=EXI.credentialManager.getCredentials()[b].username,EXI.credentialManager.getCredentials()[b].activeProposals.length>0)for(var c=0;c<EXI.credentialManager.getCredentials()[b].activeProposals.length;c++)a=EXI.credentialManager.getCredentials()[b].activeProposals[c]+"@"+EXI.credentialManager.getCredentials()[b].username,this.credentialsMenu.add({text:a,icon:"../images/icon/rsz_esrflogo80.gif",disabled:!0});else this.credentialsMenu.add({text:a,icon:"../images/icon/rsz_esrflogo80.gif",disabled:!0});EXI.credentialManager.getCredentials().length>0?(Ext.getCmp(this.loginButtonId).setText("<span style='color:white'>Log out <span style='font-weight:bold;'>"+a+" </span> </span>"),Ext.getCmp(this.loginButtonId).setIcon("../images/rsz_logout.png")):(Ext.getCmp(this.loginButtonId).setText("<span style='color:white'>Sign In</span>"),Ext.getCmp(this.loginButtonId).setIcon("../images/rsz_login.png"))},MainMenu.prototype._convertToHTMLWhiteSpan=function(a){return'<span style="color:white">'+a+"</span>"},MainMenu.prototype.isLoggedIn=function(){return EXI.credentialManager.getCredentials().length>0},MainMenu.prototype.getLoginButton=function(){var a="../images/rsz_login.png",b=this._convertToHTMLWhiteSpan("Sign In");return EXI.credentialManager.getCredentials().length>0&&(a="../images/rsz_logout.png",b=this._convertToHTMLWhiteSpan("log out")),{xtype:"splitbutton",id:this.loginButtonId,text:b,cls:"button_log_out",icon:a,menu:this.credentialsMenu,handler:function(){0==EXI.credentialManager.getCredentials().length?location.hash="/login":location.hash="/logout"}}},MainMenu.prototype.getPanel=function(){var a=this;this.credentialsMenu=new Ext.menu.Menu({id:a.id+"menu",items:[a.getAddCredentialMenu()]});var b=this.getMenuItems();return b.push("->"),b.push(this.getLoginButton()),this.tb=Ext.create("Ext.toolbar.Toolbar",{cls:this.cssClass,items:b}),this.tb},ListView.prototype.getSorters=function(){return{}},ListView.prototype.getFilter=function(a){return null},ListView.prototype.load=function(a){this.data=a,null!=this.formatData?this.store.loadData(this.formatData(a)):this.store.loadData(a)},ListView.prototype.getColumns=function(){var a=this;return[{text:this.title,flex:1,dataIndex:"shippingId",renderer:function(b,c,d){return a.getRow(d)}}]},ListView.prototype.getFields=function(){return[]},ListView.prototype.getPanel=function(){var a=this;return this.store=Ext.create("Ext.data.Store",{fields:this.getFields(),data:[],sorters:this.sorters,proxy:{type:"memory",reader:{type:"json"}}}),this.panel=Ext.create("Ext.grid.Panel",{store:this.store,layout:"fit",columns:this.getColumns(),width:this.width,height:this.height,multiSelect:!0,dockedItems:[{xtype:"toolbar",dock:"bottom",cls:"x-toolbar",height:42,items:[{xtype:"textfield",name:"searchField",hideLabel:!0,width:200,hidden:null==a.getFilter(),emptyText:"Search...",listeners:{change:function(b,c){var d=b.getValue();""!=d?a.store.filter(a.getFilter(d)):(a.store.clearFilter(!0),a.load(a.data))}}}]}],viewConfig:{emptyText:"No items to display",enableTextSelection:!0,preserveScrollOnRefresh:!0,stripeRows:!0}}),this.panel.on("selectionchange",function(b,c){var d=[];for(var e in c)d.push(c[e].data);a.onSelect.notify(d)}),this.panel},AddressListView.prototype.getPanel=ListView.prototype.getPanel,AddressListView.prototype.load=ListView.prototype.load,AddressListView.prototype.getFields=ListView.prototype.getFields,AddressListView.prototype.getColumns=ListView.prototype.getColumns,AddressListView.prototype.getFilter=function(a){return[{property:"cardName",value:a,anyMatch:!0}]},AddressListView.prototype.getRow=function(a){var b="";return dust.render("address.listview",a.data,function(a,c){b=c}),b},RunListView.prototype.getPanel=ListView.prototype.getPanel,RunListView.prototype.load=ListView.prototype.load,RunListView.prototype.getFilter=function(a){return[{property:"name",value:a,anyMatch:!0}]},RunListView.prototype.formatStatus=function(a){return"FINISHED"==a?"<span style='color:green;font-weight:bold;'>"+a+"</span>":"<span style='color:orange;font-weight:bold;'>"+a+"</span>"},RunListView.prototype.formatJobs=function(a){for(var b="<table>",c=0;c<a.length;c++)b=b+"<tr><td>"+a[c].name+"</td></tr>";return b+"</table>"},RunListView.prototype.getRow=function(a){var b="<table class='listView'>";return b=b+"<tr><td>Name:</td><td>"+a.data.name+"</td></tr>",b=b+"<tr><td>Status:</td><td>"+this.formatStatus(a.data.status)+"</td></tr>",b=b+"<tr><td>Jobs:</td><td>"+this.formatJobs(a.data.jobs)+"</td></tr>",b=b+"<tr><td>Date:</td><td>"+a.data.creationDate+"</td></tr>",b+"</table>"},RunListView.prototype.getColumns=function(){var a=this;return[{text:"Jobs",flex:1,dataIndex:"sessionId",renderer:function(b,c,d){return a.getRow(d)}}]},RunListView.prototype.getFields=function(){return["name","status","creationDate","jobs"]},SessionListView.prototype.getPanel=ListView.prototype.getPanel,SessionListView.prototype.load=ListView.prototype.load,SessionListView.prototype.getFilter=function(a){return[{property:"beamlineName",value:a,anyMatch:!0}]},SessionListView.prototype.formatData=function(a){for(var b=0;b<a.length;b++)a[b].day=moment(a[b].BLSession_startDate).format("Do"),a[b].year=moment(a[b].BLSession_startDate).format("YYYY"),a[b].month=moment(a[b].BLSession_startDate).format("MMM");return a},SessionListView.prototype.getRow=function(a){var b="";return dust.render("session.listview",a.data,function(a,c){b+=c}),b},SessionListView.prototype.getColumns=function(){var a=this;return[{text:"Session",flex:1,dataIndex:"sessionId",renderer:function(b,c,d){return a.getRow(d)}}]},SessionListView.prototype.getFields=function(){return["date"]},ShippingListView.prototype.getPanel=ListView.prototype.getPanel,ShippingListView.prototype.load=ListView.prototype.load,ShippingListView.prototype.getFilter=ListView.prototype.getFilter,ShippingListView.prototype.getFields=ListView.prototype.getFields,ShippingListView.prototype.getColumns=ListView.prototype.getColumns,ShippingListView.prototype.getRow=function(a){var b="";return dust.render("shipping.listview",a.data,function(a,c){b=c}),b},WorkSpaceListView.prototype.loadProjects=function(a){null!=a&&this.projectStore.loadData(a),this.loadRuns()},WorkSpaceListView.prototype.loadRuns=function(){var a=this,b=new ExiDataAdapter;b.onSuccess.attach(function(b,c){a.runStore.loadData(c.reverse()),a.runGrid.setLoading(!1)}),this.runGrid.setLoading(),this.projectId=exiSAXS.localExtorage.userManager.getActiveProject().internalId,b.getRuns(exiSAXS.localExtorage.userManager.getActiveProject().internalId)},WorkSpaceListView.prototype.setSelectedItems=function(a){for(var b=0;b<a.length;b++)delete a[b].id;this.selection.loadData(a),this.projectGrid.collapse()},WorkSpaceListView.prototype.getSelectionPanel=function(){function a(a,b){if(null!=a&&null!=b){if(.3>a/b)return"<span style='color:red;'>"+a+"/"+b+"</span>";if(.7>a/b)return"<span style='color:orange;'>"+a+"/"+b+"</span>"}return a+"/"+b}function b(a){"yes"==a&&exiSAXS.localExtorage.selectedSubtractionsManager.remove(record.data)}return this.selection=Ext.create("Ext.data.Store",{fields:["subtractionId","scattering","macromoleculeAcronym","concentration","framesMerge","framesCount","exposureTemperature"]}),this.selectionGrid=Ext.create("Ext.grid.Panel",{store:this.selection,title:"Selection",emptyText:"No selection",tbar:this.selectionMenu.getPanel(),columns:[{text:"",dataIndex:"scattering",renderer:function(a,b,c){return"<img src="+(new DataAdapter).getImage(c.data.subtractionId,"scattering")+'   height="70" width="70" >'}},{text:"",dataIndex:"macromoleculeAcronym",flex:.8,renderer:function(b,c,d){return d.data.macromoleculeAcronym+"<br />"+BUI.formatValuesUnits(d.data.concentration,"mg/ml",7,2)+"<br />"+d.data.exposureTemperature+"<span class='key_subgrid'> C</span><br />"+a(d.data.framesMerge,d.data.framesCount)}},{text:"",id:"remove",dataIndex:"scattering",width:50,renderer:function(a){return'<br /><img style="cursor: pointer; height:30px;width:30px;" src="images/icon/ic_highlight_remove_black_24dp.png" />'}}],width:200,listeners:{cellclick:function(a,c,d,e,f,g,h,i){2==d&&Ext.Msg.show({title:"Discard subtraction?",msg:"Your are discarding a selected subtraction. You may re-add it afterwards. Would you like to discard it?",buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,fn:b,height:150})}}}),this.selectionGrid},WorkSpaceListView.prototype.getProjectPanel=function(){return this.projectStore=Ext.create("Ext.data.Store",{fields:["name"]}),this.projectGrid=Ext.create("Ext.grid.Panel",{store:this.projectStore,title:"Projects",emptyText:"No projects",columns:[{text:"Name",dataIndex:"name",flex:1,renderer:function(a,b,c){var d="<span class='projectName'>"+c.data.name+"</span><br/><span class='projectDescription'>"+c.data.description+"</span>";return null!=c.data.subtractions&&(d=d+"<br />"+c.data.subtractions.length+" datasets selected"),d}}],height:200}),this.projectGrid},WorkSpaceListView.prototype.getRunPanel=function(){var a=this;return this.runStore=Ext.create("Ext.data.Store",{fields:["name"]}),this.runGrid=Ext.create("Ext.grid.Panel",{store:this.runStore,title:"Run",emptyText:"No Runs",minHeight:600,dockedItems:[{xtype:"toolbar",dock:"bottom",ui:"footer",items:[{xtype:"component",flex:1},{xtype:"button",text:"Refresh",handler:function(b,c,d){a.loadRuns()}}]}],columns:[{text:"Name",dataIndex:"name",flex:1,renderer:function(a,b,c){var d=c.data.jobs,e="<table>";if(e=e+"<tr ><td  class='nameRun'>"+c.data.name+"</td></tr>",e=e+"<tr ><td  class='statusRun'>"+c.data.status+"</td></tr>",e=e+"<tr ><td  class='dateRun'>"+c.data.creationDate+"</td></tr>",null!=d)for(var f=0;f<d.length;f++)e=e+"<tr ><td class='jobRow'>"+d[f].name+"</td><td>"+d[f].status+"</td></tr>";return e+"</table>"}}],height:200}),this.runGrid.on("select",function(b,c,d,e){location.hash="/project/"+a.projectId+"/run/"+c.data.internalId+"/main"}),this.runGrid},WorkSpaceListView.prototype.getPanel=function(){var a=this;return this.panel=Ext.create("Ext.panel.Panel",{layout:"fit",autoScroll:!0,defaults:{bodyStyle:"padding:15px"},items:[a.getSelectionPanel(),a.getProjectPanel(),a.getRunPanel()]}),this.panel},Credential.prototype.isManager=function(){return this._checkRole("manager")},Credential.prototype.isLocalContact=function(){return this._checkRole("localcontact")},Credential.prototype._checkRole=function(a){return-1!=JSON.stringify(this.roles).toLowerCase().indexOf(a)},Credential.prototype.isValid=function(){return this.timeToExpire()>0},Credential.prototype.timeToExpire=function(){return moment.duration(moment(this.tokenExpires).diff(moment())).asHours()},CredentialManager.prototype.addCredential=function(a,b,c,d,e,f){var g=moment().add(3,"hour"),h=new Credential(a,b,c,d,e,[],g,f);null==localStorage.getItem("credentials")&&localStorage.setItem("credentials","[]");var i=this.getCredentials();i.push(h),localStorage.setItem("credentials",JSON.stringify(i)),this.onLogin.notify(h)},CredentialManager.prototype.credentialToObject=function(a){return new Credential(a.username,a.roles,a.token,a.url,a.exiUrl,a.activeProposals,a.tokenExpires,a.properties)},CredentialManager.prototype.getCredentials=function(){var a=[];null!=JSON.parse(localStorage.getItem("credentials"))&&(a=JSON.parse(localStorage.getItem("credentials")));for(var b=0;b<a.length;b++)a[b]=this.credentialToObject(a[b]);return a},CredentialManager.prototype.getTechniqueByBeamline=function(a){for(var b=this.getConnections(),c=0;c<b.length;c++){if(-1!=JSON.stringify(b[c].beamlines.MX).toUpperCase().indexOf(a.toUpperCase()))return"MX";if(-1!=JSON.stringify(b[c].beamlines.SAXS).toUpperCase().indexOf(a.toUpperCase()))return"SAXS"}return"UNKNOW"},CredentialManager.prototype.getBeamlineNames=function(){for(var a=this.getConnections(),b=[],c=0;c<a.length;c++)b=_.concat(_.keys(_.keyBy(a[c].beamlines.SAXS,"name")),_.keys(_.keyBy(a[c].beamlines.MX,"name")));return b},CredentialManager.prototype.getBeamlines=function(){for(var a=this.getConnections(),b=[],c=0;c<a.length;c++)b=_.concat(a[c].beamlines.SAXS,a[c].beamlines.MX);return b},CredentialManager.prototype.getBeamlinesByTechnique=function(a){for(var b=this.getConnections(),c=[],d=0;d<b.length;d++)c=_.concat(b[d].beamlines[a]);return c},CredentialManager.prototype.getConnections=function(){for(var a=this.getCredentials(),b=[],c=0;c<a.length;c++)if(a[c].activeProposals.length>0)for(var d=0;d<a[c].activeProposals.length;d++)b.push({username:a[c].username,url:a[c].url,exiUrl:a[c].exiUrl,token:a[c].token,beamlines:a[c].properties.beamlines,proposal:a[c].activeProposals[d]});else b.push({username:a[c].username,url:a[c].url,exiUrl:a[c].exiUrl,token:a[c].token,beamlines:a[c].properties.beamlines,proposal:null});return b},CredentialManager.prototype.getCredentialByUserName=function(a){var b=_.filter(this.getCredentials(),{username:a});return b.length>0?b[0]:void 0},CredentialManager.prototype.logout=function(a,b,c,d){localStorage.removeItem("credentials"),this.onLogout.notify()},CredentialManager.prototype.setActiveProposal=function(a,b){for(var c=this.getCredentials(),d=0;d<c.length;d++)c[d].username.toLowerCase()==a.toLowerCase()&&(c[d].activeProposals=[b],localStorage.setItem("credentials",JSON.stringify(c)),localStorage.removeItem("sessions"),this.onActiveProposalChanged.notify())},MainView.prototype.getContainer=function(){return this.container},MainView.prototype.getPanel=function(){return this.container=Ext.create("Ext.container.Container",{xtype:"container",items:[]}),this.panel=Ext.create("Ext.panel.Panel",{autoScroll:!0,title:this.title,closable:this.closable,icon:this.icon,bodyStyle:this.bodyStyle,items:[this.getContainer()]}),this.panel},AddressMainView.prototype.getPanel=MainView.prototype.getPanel,AddressMainView.prototype.getContainer=function(){return Ext.create("Ext.container.Container",{layout:{type:"hbox"},margin:15,border:1,defaults:{labelWidth:80,flex:1},items:[this.addressForm.getPanel([])]})},AddressMainView.prototype.load=function(a){this.panel.setTitle("Address");var b=this,c=function(a,c){b.addressForm.load(c)};EXI.getDataAdapter({onSuccess:c}).proposal.labcontacts.getLabContactById(a)},ManagerWelcomeMainView.prototype.getPanel=MainView.prototype.getPanel,ManagerWelcomeMainView.prototype.activeProposal=function(a){EXI.mainStatusBar.showBusy("Loading proposal "+a),EXI.credentialManager.setActiveProposal(this.username,a),EXI.proposalManager.clear(),EXI.proposalManager.onActiveProposalChanged=new Event,EXI.proposalManager.onActiveProposalChanged.attach(function(){EXI.mainStatusBar.showReady(),console.log(EXI.proposalManager.get())}),EXI.proposalManager.get()},ManagerWelcomeMainView.prototype.getContainer=function(){return this.container=Ext.create("Ext.panel.Panel",{autoScroll:!0,margin:20,cls:"border-grid",tbar:this.getToolbar(),items:[this.sessionGrid.getPanel()]}),this.container},ManagerWelcomeMainView.prototype.displayProposals=function(a){var b=this;this.container.removeAll(),this.proposalGrid.onSelected.attach(function(a,c){function d(a,c){b.displaySessions(c,c.length+" sessions for proposal "+e),b.panel.setLoading(!1)}b.panel.setLoading(!0);var e=c.Proposal_proposalCode+c.Proposal_proposalNumber;EXI.getDataAdapter({onSuccess:d}).proposal.session.getSessionsByProposal(e),b.activeProposal(c.Proposal_proposalCode+c.Proposal_proposalNumber)}),this.container.insert(this.proposalGrid.getPanel()),this.proposalGrid.load(a)},ManagerWelcomeMainView.prototype.loadByDate=function(a,b,c){function d(a,c){e.displaySessions(c,c.length+" sessions scheduled on "+moment(b,"YYYYMMDD").format("MMMM Do YYYY")),e.panel.setLoading(!1)}var e=this;this.panel.setLoading(!0),c=moment(c,"YYYYMMDD").add(1,"days").format("YYYYMMDD"),this.isUser(a)?EXI.getDataAdapter({onSuccess:d}).proposal.session.getSessionsByProposalAndDate(b,c,a):EXI.getDataAdapter({onSuccess:d}).proposal.session.getSessionsByDate(b,c)},ManagerWelcomeMainView.prototype.filterSessions=function(a){a.length;return data=_.slice(a,0,500),_(a).forEach(function(a){a.ms=moment(a.BLSession_startDate,"MMM DD, YYYY h:mm:ss a").format("x")}),a=_.orderBy(a,["ms"],["desc"]),a.slice(0,300)},ManagerWelcomeMainView.prototype.displaySessions=function(a,b){var c=this;this.container.removeAll(),this.container.insert(this.sessionGrid.getPanel()),this.sessionGrid.onSelected.attach(function(a,b){EXI.proposalManager.clear(),c.activeProposal(b.proposalCode+b.proposalNumber)}),this.sessionGrid.load(this.filterSessions(a)),this.sessionGrid.panel.setTitle(b)},ManagerWelcomeMainView.prototype.getToolbar=function(){var a=this,b=Ext.create("Ext.menu.DatePicker",{handler:function(b,c){location.href="#/welcome/manager/"+a.username+"/date/"+Ext.Date.format(c,"Ymd")+"/"+Ext.Date.format(c,"Ymd")+"/main"}});return Ext.create("Ext.toolbar.Toolbar",{width:500,cls:"exi-top-bar",items:[{text:"Choose a Date",icon:"../images/icon/sessions.png",menu:b},{xtype:"textfield",name:"field1",width:300,emptyText:"enter search term (proposal or title)",listeners:{specialkey:function(b,c){if(c.getKey()==c.ENTER){var d=a.searchProposalByTerm(b.getValue());a.displayProposals(d)}}}}]})},ManagerWelcomeMainView.prototype.searchProposalByTerm=function(a){var b=[];if(null!=this.proposals)for(var c=0;c<this.proposals.length;c++){var d=this.proposals[c].Proposal_proposalCode+this.proposals[c].Proposal_proposalNumber,e=this.proposals[c].Proposal_title;null==e&&(e=""),(d.toUpperCase().match(a.toUpperCase())||e.toUpperCase().match(a.toUpperCase()))&&b.push(this.proposals[c])}return b},ManagerWelcomeMainView.prototype.loadProposals=function(a){var b=this,c=function(c,d){b.proposals=d,a&&a()};EXI.getDataAdapter({onSuccess:c}).proposal.proposal.getProposals()},ManagerWelcomeMainView.prototype.isUser=function(a){return!EXI.credentialManager.getCredentialByUserName(a).isManager()&&!EXI.credentialManager.getCredentialByUserName(a).isLocalContact();
},ManagerWelcomeMainView.prototype.load=function(a){if(this.username=a,this.isUser(a))this.loadSessionsByProposal(a),this.activeProposal(a);else{var b=moment().format("YYYYMMDD");this.loadSessionsByDate(a,b,b)}EXI.setLoadingMainPanel(!1)},ManagerWelcomeMainView.prototype.loadSessionsByProposal=function(a){function b(b,d){c.displaySessions(d,"Sessions for proposal "+a),c.panel.setLoading(!1)}this.username=a;var c=this;this.panel.setLoading(!0),EXI.getDataAdapter({onSuccess:b}).proposal.session.getSessionsByProposal(a)},ManagerWelcomeMainView.prototype.loadSessionsByDate=function(a,b,c){this.username=a,this.loadByDate(a,b,c),this.loadProposals()},ManagerWelcomeMainView.prototype.loadSessionsByTerm=function(a,b){this.username=a;var c=this,d=function(a,d){c.proposals=d,c.searchProposalByTerm(b)};EXI.getDataAdapter({onSuccess:d}).proposal.proposal.getProposals()},RunMainView.prototype.getPanel=MainView.prototype.getPanel,RunMainView.prototype.getOutputPanel=function(){return this.outputStore=Ext.create("Ext.data.Store",{fields:["name","value","type","targetId","tool","i"],groupField:"tool",sorters:[{property:"i",direction:"DESC"}]}),Ext.create("Ext.grid.Panel",{store:this.outputStore,cls:"border-grid",features:[{ftype:"grouping"}],columns:[{text:"Tool",dataIndex:"tool",flex:1,hidden:!0},{text:"id",dataIndex:"i",flex:1,hidden:!0},{text:"Name",dataIndex:"name",flex:1},{text:"value",dataIndex:"value",flex:1},{text:"type",dataIndex:"type",flex:1},{text:"target",dataIndex:"targetId",flex:1,hidden:!0},{text:"",dataIndex:"targetId",flex:1,renderer:function(a,b,c){var d=EXI.credentialManager.getConnections()[0].exiUrl+"/file/"+c.data.targetId+"/download";return"<div><a style='color:blue;' href='"+d+"'>Download</a></div>"}}]})},RunMainView.prototype.getGeneralContainerList=function(a){var b="<ul class='generalContainerRunList'>";return b=b+"<li>Name: "+a.name+"</li>",b=b+"<li>Status: "+a.status+"</li>",b=b+"<li>"+a.creationDate+"</li>"},RunMainView.prototype.getGeneralContainer=function(a){return{xtype:"panel",title:"General",margin:10,border:1,style:{borderColor:"gray",borderStyle:"solid",borderWidth:"1px"},items:[{html:this.getGeneralContainerList(a),margin:"10 0 0 50"}]}},RunMainView.prototype.getMainPanel=function(){},RunMainView.prototype.getTabs=function(){return Ext.createWidget("tabpanel",{plain:!0,margin:"20 0 0 0",items:[this.getMainPanel(),{tabConfig:{title:"Output Files"},items:[{xtype:"container",layout:"fit",height:700,padding:20,cls:"border-grid",items:[this.getOutputPanel()]}]}]})},RunMainView.prototype.getContainer=function(){return Ext.create("Ext.container.Container",{layout:{type:"anchor"},defaults:{anchor:"100%",hideEmptyLabel:!1},margin:5,bodyStyle:{"background-color":"#E6E6E6"},items:[this.getTabs()]})},RunMainView.prototype.loadMain=function(a){},RunMainView.prototype.load=function(a){if(null!=a){this.panel.setTitle(a.name);for(var b=[],c=0;c<a.jobs.length;c++)for(var d=0;d<a.jobs[c].output.length;d++)a.jobs[c].output[d].tool=a.jobs[c].name+" "+a.jobs[c].version,a.jobs[c].output[d].i=c,b.push(a.jobs[c].output[d]);this.outputStore.loadData(b)}this.loadMain(a)},DimpleRunMainView.prototype.getPanel=RunMainView.prototype.getPanel,DimpleRunMainView.prototype.getOutputPanel=RunMainView.prototype.getOutputPanel,DimpleRunMainView.prototype.getTabs=RunMainView.prototype.getTabs,DimpleRunMainView.prototype.getContainer=RunMainView.prototype.getContainer,DimpleRunMainView.prototype.load=RunMainView.prototype.load,DimpleRunMainView.prototype.getFilesGrid=function(){var a=this;this.filesStore=Ext.create("Ext.data.Store",{fields:["name","targetId"]});var b=Ext.create("Ext.selection.RowModel",{allowDeselect:!0,listeners:{selectionchange:function(b,c){console.log(c[0].data);var d=function(b,c){document.getElementById(a.id+"display").innerHTML="<textarea rows='100' cols='100'> "+c+"</textarea>"};-1==c[0].data.name.indexOf(".mtz")?EXI.getDataAdapter({onSuccess:d}).exi.offline.getFileContent(c[0].data.targetId):d(this,"No text available")}}});return Ext.create("Ext.grid.Panel",{title:"Files",store:this.filesStore,selModel:b,cls:"border-grid",height:400,columns:[{text:"Name",dataIndex:"name",flex:1}]})},DimpleRunMainView.prototype.getMainPanel=function(){var a=Ext.create("Ext.data.Store",{fields:["key","value"]});return this.generalGrid=Ext.create("Ext.grid.Panel",{title:"General",store:a,layout:"fit",columns:[{text:"Name",dataIndex:"name"},{text:"Seniority",dataIndex:"seniority"}],flex:1}),{tabConfig:{title:"Dimple"},items:[{xtype:"container",height:700,cls:"border-grid",items:[{xtype:"container",layout:"hbox",items:[{xtype:"container",layout:"fit",flex:.4,margin:5,items:[this.getFilesGrid(),{html:"<br />"},{html:'<div id="'+this.id+'blobs";><div>'}]},{xtype:"container",layout:"fit",flex:.6,margin:5,height:400,cls:"border-grid",items:[{html:'<div id="'+this.id+'display";><div>'}]}]},{xtype:"container",margin:5,height:210,layout:"fit",flex:1,items:[{html:'<div style="height:200px"  id="'+this.id+'snapshots";><div>'}]}]}]}},DimpleRunMainView.prototype.loadBlobs=function(a){var b=[],c=0;for(c=0;c<a.output.length;c++)"blob"==a.output[c].type&&b.push(a.output[c]);var d=(document.createElement("div"),document.createElement("table")),e=document.createElement("tr");for(c=0;c<b.length;c++){var f=document.createElement("td"),g=document.createElement("img");g.setAttribute("src",EXI.getDataAdapter().exi.offline.getFileImage(b[c].targetId)),g.setAttribute("height","180px"),g.setAttribute("width","180px"),g.setAttribute("hspace","10"),g.setAttribute("onclick","window.open(this.src)"),f.appendChild(g),e.appendChild(f)}d.appendChild(e),document.getElementById(this.id+"snapshots").innerHTML=d.innerHTML},DimpleRunMainView.prototype.loadFiles=function(a){for(var b=[],c=0;c<a.output.length;c++)"blob"!=a.output[c].type&&b.push(a.output[c]);this.filesStore.loadData(b)},DimpleRunMainView.prototype.loadMain=function(a){if(console.log(a),null!=a&&null!=a.jobs&&a.jobs.length>0)for(var b=0;b<a.jobs.length;b++)this.loadBlobs(a.jobs[b]),this.loadFiles(a.jobs[b])},SessionMainView.prototype.getPanel=MainView.prototype.getPanel,SessionMainView.prototype.getContainer=function(){return _this=this,this.subpanel=Ext.create("Ext.container.Container",{layout:"fit",border:0,items:[]}),this.panel=Ext.create("Ext.container.Container",{layout:"hbox",margin:10,items:[{html:'<div style="height:600px" id="'+this.id+'"></div>',height:600,border:0,width:600},this.subpanel],listeners:{afterrender:function(){_this.showCalendar([])}}}),this.panel},SessionMainView.prototype.showCalendar=function(a){function b(a){c.loadByDate(moment(new Date(a.startDate)).format("YYYYMMDD"))}var c=this;$("#"+c.id).empty(),$("#"+this.id).calendar({enableContextMenu:!0,enableRangeSelection:!0,selectRange:function(a){b({startDate:a.startDate,endDate:a.endDate})},mouseOnDay:function(a){if(a.events.length>0){var b="";for(var c in a.events)b+="<div class='event-tooltip-content'><div class='event-name' style='color:"+a.events[c].color+"'>"+a.events[c].name+"</div><div class='event-location'>"+a.events[c].location+"</div></div>";$(a.element).popover({trigger:"manual",container:"body",html:!0,content:b}),$(a.element).popover("show")}},mouseOutDay:function(a){a.events.length>0&&$(a.element).popover("hide")},dayContextMenu:function(a){$(a.element).popover("hide")},dataSource:a})},SessionMainView.prototype.getBadge=function(a,b){return b&&0!=b?"<span>"+a+'  <span class="badge">'+b+"</span></span><br />":""},SessionMainView.prototype.getLocation=function(a){var b=this.getBadge("Collect",a.dataCollectionGroupCount);return b+=this.getBadge("Images",a.imagesCount),b+=this.getBadge("XRF",a.xrfSpectrumCount),b+=this.getBadge("Energy",a.energyScanCount),b+this.getBadge("Sample",a.sampleCount)},SessionMainView.prototype.load=function(a){for(var b=[],c=0;c<a.length;c++)b.push({id:a[c].sessionId,name:a[c].Proposal_proposalCode+a[c].Proposal_ProposalNumber+"( "+a[c].beamLineName+" )",location:this.getLocation(a[c]),startDate:new Date(a[c].BLSession_startDate),endDate:new Date(a[c].BLSession_endDate)});this.showCalendar(b),this.subpanel.insert(this.sessionGrid.getPanel());var d=this;if($("#"+this.id+"_header")&&EXI.proposalManager.getProposals().length>0){var e=EXI.proposalManager.getProposals()[0];e.sessionCount=a.length,dust.render("welcomemainviewproposalheader",e,function(a,b){$("#"+d.id+"_header").html(b),d.panel.insert(0,{html:b,border:0,margin:"10 0 0 10",width:600})})}},SessionMainView.prototype.loadByDate=function(a){function b(a,b){c.sessionGrid.load(b),c.panel.setLoading(!1)}var c=this;this.panel.setLoading(!0);var d=EXI.credentialManager.getCredentials()[0].activeProposals[0],e=moment(a,"YYYYMMDD").format("YYYYMMDD");EXI.getDataAdapter({onSuccess:b}).proposal.session.getSessionsByProposalAndDate(a,e,d)},CaseForm.prototype.fillStores=function(){var a=this;this.panel.setLoading("Loading Labcontacts from database");var b=BUI.getProposal();b.onDataRetrieved.attach(function(b,c){a.labContactForSendingStore.loadData(c,!1),a.labContactForReturnStore.loadData(c,!1),a.panel.setLoading(!1)}),b.getLabContactsByProposalId()},CaseForm.prototype.refresh=function(a){this.setDewar(a)},CaseForm.prototype.getDewar=function(){return this.dewar.code=Ext.getCmp(this.id+"dewar_code").getValue(),this.dewar.comments=Ext.getCmp(this.id+"dewar_comments").getValue(),this.dewar.transportValue=Ext.getCmp(this.id+"dewar_transportValue").getValue(),this.dewar.storageLocation=this.storageLocationComboBox.getValue(),this.dewar},CaseForm.prototype.setDewar=function(a){this.dewar=a,null==this.dewar&&(this.dewar={},this.dewar.code="",this.dewar.transportValue="",this.dewar.storageLocation="",this.dewar.comments=""),Ext.getCmp(this.id+"dewar_code").setValue(this.dewar.code),Ext.getCmp(this.id+"dewar_comments").setValue(this.dewar.comments),Ext.getCmp(this.id+"dewar_transportValue").setValue(this.dewar.transportValue),this.storageLocationComboBox.setValue(this.dewar.storageLocation)},CaseForm.prototype.getStorageLocationCombo=function(){return this.storageLocationComboBox=BIOSAXS_COMBOMANAGER.getComboStorageTemperature(),this.storageLocationComboBox},CaseForm.prototype.getPanel=function(a){return this.panel=Ext.create("Ext.form.Panel",{width:this.width-10,padding:10,height:320,items:[{xtype:"container",margin:"2 2 2 2",collapsible:!1,defaultType:"textfield",layout:"anchor",items:[{xtype:"container",layout:"vbox",items:[{xtype:"requiredtextfield",fieldLabel:"Name",allowBlank:!1,name:"code",id:this.id+"dewar_code",labelWidth:200,width:500}]},this.getStorageLocationCombo(),{xtype:"numberfield",width:500,labelWidth:200,margin:"10 0 0 0",fieldLabel:"Transport Value",id:this.id+"dewar_transportValue"},{xtype:"textareafield",name:"comments",fieldLabel:"Comments",labelWidth:200,width:500,margin:"10 0 0 0",height:100,id:this.id+"dewar_comments"}]}]}),this.refresh(a),this.panel},ContainerSpreadSheet.prototype.getPanel=function(){var a=this;return this.panel=Ext.create("Ext.panel.Panel",{layout:"vbox",height:this.height+50,items:[{html:'<div  style="overflow: auto;overflow-y: hidden; border:1px solid gray;background-color:white;height:500px;width:'+(a.width-20)+'px"; id="'+this.id+'_samples"; ></div>',margin:"20 0 20 10",height:this.height,width:this.width,autoScroll:!0,resizable:!0}]}),this.panel},ContainerSpreadSheet.prototype.getSamplesData=function(a){function b(a,b){for(var c=0;c<a.length;c++)if(a[c].location==Number(b))return a[c]}function c(a){return a?a:""}var d=a.sampleVOs,e=[];d.sort(function(a,b){return Number(a.location)-Number(b.location)});for(var f=0;f<a.capacity;f++){var g=b(d,f+1);if(null!=g){var h=g.crystalVO,i=h.proteinVO,j=g.diffractionPlanVO;null==j&&(j={}),e.push([f+1,i.acronym,g.name,h.spaceGroup,j.experimentKind,g.code,c(j.observedResolution),j.requiredResolution,j.preferredBeamDiameter,j.numberOfPositions,j.radiationSensitivity,j.requiredMultiplicity,j.requiredCompleteness,h.cellA,h.cellB,h.cellC,h.cellAlpha,h.cellBeta,h.cellGamma,g.smiles,g.comments])}else e.push([f+1])}return e},ContainerSpreadSheet.prototype.getSpaceGroups=function(){return["P1","P2","P21","C2","P222","P2221","P21212","P212121","C222","C2221","F222","I222","I212121","P4","P41","P42","P43","P422","P4212","P4122","P41212","P4222","P42212","P4322","P43212","I4","I41","I422","I4122","P3","P31","P32","P31","P321","P3112","P3121","P3212","P3221","P6","P61","P65","P62","P64","P63","P622","P6122","P6522","P6222","P6422","P6322","R3","R32","P23","P213","P432","P4232","P4332","P4132","F23","F432","F4132","I23","I213","I432","I4132","UNKNOWN"]},ContainerSpreadSheet.prototype.getAcronyms=function(){for(var a=EXI.proposalManager.getProteins(),b=[],c=0;c<a.length;c++)b.push(a[c].acronym);return b},ContainerSpreadSheet.prototype.getHeader=function(){return[{text:"#",id:"position",column:{width:20}},{text:"Protein <br />Acronym",id:"Protein Acronym",column:{width:60,type:"dropdown",source:this.getAcronyms()}},{text:"Sample<br /> Name",id:"Sample Name",column:{width:120}},{text:"Space<br /> Group",id:"Space Group",column:{width:90,type:"dropdown",source:this.getSpaceGroups()}},{text:"Exp.<br /> Type",id:"Experiment Type",column:{width:80,type:"dropdown",source:["Default","MXPressE","MXPressO","MXPressI","MXPressE_SAD","MXScore","MXPressM"]}},{text:"Pin <br />BarCode",id:"Pin BarCode",column:{width:45}},{text:"Pre-observed <br />resolution",id:"Pre-observed resolution",column:{width:45}},{text:"Needed<br /> resolution",id:"Needed resolution",column:{width:45}},{text:"Pref. <br />Diameter",id:"Pref. Diameter",column:{width:45}},{text:"Number Of<br /> positions",id:"Number Of positions",column:{width:45}},{text:"Radiation<br /> Sensitivity",id:"Radiation Sensitivity",column:{width:60}},{text:"Required<br /> multiplicity",id:"Required multiplicity",column:{width:60}},{text:"Required<br /> Completeness",id:"Required Completeness",column:{width:60}},{text:"A",id:"Unit cell A",column:{width:40}},{text:"B",id:"Unit cell B",column:{width:40}},{text:"C",id:"Unit cell C",column:{width:40}},{text:"&#945;",id:"Unit cell Alpha",column:{width:40}},{text:"&#946;",id:"Unit cell Beta",column:{width:40}},{text:"&#947;",id:"Unit cell Gamma",column:{width:40}},{text:"Smiles",id:"Required Completeness",column:{width:45}},{text:"Comments",id:"Comments",column:{width:45}}]},ContainerSpreadSheet.prototype.getHeaderWidth=function(){for(var a=this.getHeader(),b=[],c=0;c<a.length;c++)b.push(a[c].column["with"]);return b},ContainerSpreadSheet.prototype.getHeaderId=function(){for(var a=this.getHeader(),b=[],c=0;c<a.length;c++)b.push(a[c].id);return b},ContainerSpreadSheet.prototype.getHeaderText=function(){for(var a=this.getHeader(),b=[],c=0;c<a.length;c++)b.push(a[c].text);return b},ContainerSpreadSheet.prototype.getColumns=function(){for(var a=[],b=0;b<this.getHeader().length;b++)a.push(this.getHeader()[b].column);return a},ContainerSpreadSheet.prototype.getPuck=function(){function a(a){return _.filter(a,function(a){return a.location==c[e].location})}for(var b=JSON.parse(JSON.stringify(this.puck)),c=this.parseTableData(),d=[],e=0;e<c.length;e++){var f={},g=a(b.sampleVOs);g.length>0&&(f=g[0]),f.name=c[e]["Sample Name"],f.smiles=c[e].Smiles,f.location=c[e].location,f.comments=c[e].Comments;var h=[];null==f.crystalVO?(f.crystalVO={},h=EXI.proposalManager.getProteinByAcronym(c[e]["Protein Acronym"]),null!=h&&(f.crystalVO.proteinVO=h[0])):(h=EXI.proposalManager.getProteinByAcronym(c[e]["Protein Acronym"]),null!=h&&(f.crystalVO.proteinVO=h[0])),f.crystalVO.spaceGroup=c[e]["Space Group"],f.crystalVO.cellA=Number(c[e]["Unit cell A"]),f.crystalVO.cellB=Number(c[e]["Unit cell B"]),f.crystalVO.cellC=Number(c[e]["Unit cell C"]),f.crystalVO.cellAlpha=Number(c[e]["Unit cell Alpha"]),f.crystalVO.cellBeta=Number(c[e]["Unit cell Beta"]),f.crystalVO.cellGamma=Number(c[e]["Unit cell Gamma"]),f.diffractionPlanVO={},f.diffractionPlanVO.radiationSensitivity=Number(c[e]["Radiation Sensitivity"]),f.diffractionPlanVO.requiredCompleteness=Number(c[e]["Required Completeness"]),f.diffractionPlanVO.requiredMultiplicity=Number(c[e]["Required multiplicity"]),f.diffractionPlanVO.requiredResolution=Number(c[e]["Needed resolution"]),f.diffractionPlanVO.observedResolution=Number(c[e]["Pre-observed resolution"]),f.diffractionPlanVO.preferredBeamDiameter=Number(c[e]["Pref. Diameter"]),f.diffractionPlanVO.numberOfPositions=Number(c[e]["Number Of positions"]),f.diffractionPlanVO.experimentKind=c[e]["Experiment Type"],d.push(f)}return b.sampleVOs=d,b},ContainerSpreadSheet.prototype.parseTableData=function(){for(var a=[],b=this.spreadSheet.getData(),c=0;c<b.length;c++){var d={};d.location=c+1;for(var e=0;e<b[c].length;e++){var f=this.getHeaderId()[e],g=b[c][e];d[f]=g}d["Protein Acronym"]&&d["Protein Acronym"].length>0&&a.push(d)}for(var h=[],i=0;i<a.length;i++)null!=a[i]["Protein Acronym"]&&h.push(a[i]);return h},ContainerSpreadSheet.prototype.load=function(a){function b(a,b,c,d,e,f,g){return Handsontable.renderers.TextRenderer.apply(this,arguments),a.getDataAtRow(c)[1]?void(2==d&&(f&&""!=f||(b.className="custom-row-text-required"))):void(b.style.background="#EEE")}this.puck=a;var c=document.getElementById(this.id+"_samples");Handsontable.renderers.registerRenderer("ValueRenderer",b);this.spreadSheet=new Handsontable(c,{beforeChange:function(a,b){lastChange=a},data:this.getSamplesData(a),height:this.height,width:this.width,manualColumnResize:!0,colWidths:this.getHeaderWidth(),colHeaders:this.getHeaderText(),stretchH:"last",columns:this.getColumns()})},ParcelGrid.prototype._getTopButtons=function(){var a=this;return[Ext.create("Ext.Action",{icon:"../images/icon/add.png",text:"Add New Parcel",disabled:!1,handler:function(b,c){a.edit()}})]},ParcelGrid.prototype.load=function(a){function b(a,b){c.panel.setLoading(),b.sessionId=b.firstExperimentId,b.shippingId=c.shipment.shippingId;var d=function(a,b){c.panel.setLoading(!1)};EXI.getDataAdapter({onSuccess:d}).proposal.dewar.saveDewar(c.shipment.shippingId,b)}var c=this;this.shipment=a,this.dewars=a.dewarVOs,this.parcelForms=[],this.panel.removeAll(),this.dewars.sort(function(a,b){return a.dewarId-b.dewarId});for(var d in this.dewars){var e=new ParcelPanel({height:275,width:this.width-40});this.panel.insert(e.getPanel()),e.load(this.dewars[d]),e.onSavedClick.attach(b),this.parcelForms.push(e)}},ParcelGrid.prototype.edit=function(a){var b=this,c=new CaseForm,d=Ext.create("Ext.window.Window",{title:"Parcel",height:450,width:600,modal:!0,layout:"fit",items:[c.getPanel(a)],listeners:{afterrender:function(a,c){null!=b.puck&&b.render(b.puck)}},buttons:[{text:"Save",handler:function(){new DataAdapter;b.panel.setLoading();var a=c.getDewar(),e=function(a,c){b.load(c),b.panel.setLoading(!1),d.close()};a.sessionId=a.firstExperimentId,a.shippingId=b.shipment.shippingId,EXI.getDataAdapter({onSuccess:e}).proposal.dewar.saveDewar(b.shipment.shippingId,a)}},{text:"Cancel",handler:function(){d.close()}}]});d.show()},ParcelGrid.prototype.getPanel=function(){var a=this;return this.panel=Ext.create("Ext.panel.Panel",{cls:"border-grid",width:this.width,autoScroll:!0,autoHeight:!0,maxHeight:this.height}),this.panel.addDocked({height:45,xtype:"toolbar",items:a._getTopButtons(),cls:"exi-top-bar"}),this.panel},PuckForm.prototype.load=function(a,b){this.puck=a,null!=a&&(Ext.getCmp(this.id+"puck_name").setValue(this.puck.code),this.capacityCombo.setValue(this.puck.capacity),Ext.getCmp(this.id+"puck_beamline").setValue(this.puck.beamlineLocation),Ext.getCmp(this.id+"puck_sampleChangerLocation").setValue(this.puck.sampleChangerLocation),Ext.getCmp(this.id+"puck_status").setValue(this.puck.containerStatus)),this.containerSpreadSheet.load(a)},PuckForm.prototype.getToolBar=function(){var a=this;return[{text:"Remove",width:100,height:30,cls:"btn-red",handler:function(){function b(b){"yes"==b&&a.removePuck()}Ext.MessageBox.show({title:"Remove",msg:"Removing a puck from this parcel will remove also its content. <br />Are you sure you want to continue?",buttons:Ext.MessageBox.YESNO,fn:b,animateTarget:"mb4",icon:Ext.MessageBox.QUESTION})}},"->",{text:"Save",width:100,height:30,handler:function(){a.save()}}]},PuckForm.prototype.removePuck=function(){var a=this;this.panel.setLoading();var b=function(b,d){a.panel.setLoading(!1),a.onRemoved.notify(c)},c=this.puck.containerId;EXI.getDataAdapter({onSuccess:b}).proposal.shipping.removeContainerById(c,c,c)},PuckForm.prototype.save=function(){var a=this;this.panel.setLoading("Saving Puck");var b=this.containerSpreadSheet.getPuck();b.code=Ext.getCmp(a.id+"puck_name").getValue(),b.capacity=a.capacityCombo.getValue();var c=function(b,c){a.panel.setLoading(!1),EXI.setError(c.responseText)},d=function(b,c){a.panel.setLoading(!1),a.load(c),a.onSaved.notify(c)};EXI.getDataAdapter({onSuccess:d,onError:c}).proposal.shipping.saveContainer(this.puck.containerId,this.puck.containerId,this.puck.containerId,b)},PuckForm.prototype.containerTypeChanged=function(a){this.puck.capacity=a;var b=this.containerSpreadSheet.spreadSheet.getData();if(b.length<a)for(var c=b.length;a>=c;c++)b.push([c]);else b=b.slice(0,a);this.containerSpreadSheet.spreadSheet.loadData(b)},PuckForm.prototype.getPanel=function(){var a=this,b=BIOSAXS_COMBOMANAGER.getComboPuckType({margin:"10 0 10 5",labelWidth:100,width:250});return b.on("select",function(b,c){var d=c[0].data.value;a.containerTypeChanged(d)}),this.capacityCombo=b,this.panel=Ext.create("Ext.panel.Panel",{buttons:this.getToolBar(),items:[{xtype:"container",margin:"5 0 2 5",layout:"hbox",items:[{xtype:"container",margin:"12 0 2 0",layout:"vbox",items:[{xtype:"requiredtextfield",id:this.id+"puck_name",fieldLabel:"Name",name:"name",width:250,margin:"0 0 0 5",labelWidth:100},this.capacityCombo,{xtype:"textfield",id:this.id+"puck_beamline",fieldLabel:"Beamline",width:250,disabled:!0,margin:"0 0 0 5",labelWidth:100},{xtype:"textfield",id:this.id+"puck_sampleChangerLocation",fieldLabel:"#Sample Changer",width:250,disabled:!0,margin:"0 0 0 5",labelWidth:100},{xtype:"textfield",id:this.id+"puck_status",fieldLabel:"Status",width:250,disabled:!0,margin:"0 0 0 5",labelWidth:100}]}]},this.containerSpreadSheet.getPanel()]}),this.panel},ShipmentForm.prototype.fillStores=function(){this.panel.setLoading("Loading Labcontacts from database");var a=EXI.proposalManager.getLabcontacts();this.labContactForSendingStore.loadData(a,!1),a.sort(function(a,b){return a.cardName<b.cardName?-1:a.cardName>b.cardName?1:0}),$.extend(a,[{cardName:"Same as for shipping to beamline",labContactId:-1},{cardName:"No return requested",labContactId:0}]),this.labContactForReturnStore.loadData(a,!1),this.labContactsReturnCombo.setValue(-1),this.panel.setLoading(!1),null!=this.shipment&&this.setShipment(this.shipment)},ShipmentForm.prototype.draw=function(a){this.getPanel().render(a)},ShipmentForm.prototype.load=function(a){this.shipment=a;var b=this;if(Ext.getCmp(b.id+"shippingName").setValue(a.shippingName),Ext.getCmp(b.id+"comments").setValue(a.comments),null!=a.sendingLabContactVO&&this.labContactsSendingCombo.setValue(a.sendingLabContactVO.labContactId),null==a.returnLabContactVO?this.labContactsReturnCombo.setValue(0):a.returnLabContactVO.labContactId==a.sendingLabContactVO.labContactId?this.labContactsReturnCombo.setValue(-1):this.labContactsReturnCombo.setValue(a.returnLabContactVO.labContactId),null!=a.sessions&&a.sessions.length>0){var c=a.sessions[0];this.sessionComboBox.setValue(c.sessionId)}},ShipmentForm.prototype._saveShipment=function(){var a=this,b=null;null!=this.shipment&&(b=this.shipment.shippingId);var c=this.labContactsSendingCombo.getValue(),d=this.labContactsReturnCombo.getValue();if(null==c)return void BUI.showError("User contact information for shipping to beamline is mandatory");0==this.labContactsReturnCombo.getValue()&&(d=0),-1==this.labContactsReturnCombo.getValue()&&(d=-1);var e=EXI.proposalManager.getLabcontactById(c),f={shippingId:b,name:Ext.getCmp(a.id+"shippingName").getValue(),status:"Not set",sendingLabContactId:c,returnLabContactId:d,returnCourier:d,courierAccount:e.courierAccount,billingReference:e.billingReference,dewarAvgCustomsValue:e.dewarAvgCustomsValue,dewarAvgTransportValue:e.dewarAvgTransportValue,comments:Ext.getCmp(a.id+"comments").getValue(),sessionId:this.sessionComboBox.getValue()},g=function(b,c){location.hash="#/shipping/"+c.shippingId+"/main",a.panel.setLoading(!1),a.onSaved.notify(c)};return""==f.name?void BUI.showError("Name field is mandatory"):null==f.sendingLabContactId?void BUI.showError("Lab contact for sending field is mandatory"):(this.panel.setLoading(),void EXI.getDataAdapter({onSuccess:g}).proposal.shipping.saveShipment(f))},ShipmentForm.prototype.getPanel=function(){var a=this,b='<span style="color:red;font-weight:bold" data-qtip="Required">*</span>',c=[];return a.creationMode?c.push({text:"Create",scope:this,handler:function(){a._saveShipment()}}):c.push({text:"Save",scope:this,handler:function(){a._saveShipment()}}),this.labContactForSendingStore=Ext.create("Ext.data.Store",{fields:["cardName","labContactId"],sorters:"cardName"}),this.labContactForReturnStore=Ext.create("Ext.data.Store",{fields:["cardName","labContactId"]}),this.labContactsSendingCombo=Ext.create("Ext.form.ComboBox",{id:a.id+"shipmentform_sendingLabContactId",fieldLabel:"Shipping Card to ESRF",afterLabelTextTpl:b,store:this.labContactForSendingStore,queryMode:"local",labelWidth:200,width:600,margin:"10 0 0 10",displayField:"cardName",valueField:"labContactId"}),this.labContactsReturnCombo=Ext.create("Ext.form.ComboBox",{id:a.id+"returnLabContactId",fieldLabel:"Shipping Card to HOME",afterLabelTextTpl:b,store:this.labContactForReturnStore,queryMode:"local",margin:"10 0 0 10",labelWidth:200,width:600,displayField:"cardName",valueField:"labContactId"}),this.sessionComboBox=BIOSAXS_COMBOMANAGER.getComboSessions(EXI.proposalManager.getSessions(),{margin:"10 0 0 10",width:400,labelWidth:200}),null==this.panel&&(this.panel=Ext.create("Ext.form.Panel",{layout:"hbox",width:this.width,margin:10,bodyPadding:5,cls:"border-grid",buttons:c,items:[{xtype:"container",layout:"vbox",items:[{xtype:"requiredtextfield",fieldLabel:"Name",allowBlank:!1,labelWidth:200,width:400,margin:"10 20 0 10",name:"shippingName",id:a.id+"shippingName",value:""},this.sessionComboBox]},{xtype:"textareafield",name:"comments",id:a.id+"comments",fieldLabel:"Comments",value:"",labelWidth:200,margin:"10 20 0 10",width:500},{xtype:"container",layout:"vbox",items:[this.labContactsSendingCombo,this.labContactsReturnCombo]}]})),this.fillStores(),this.panel},ShippingMainView.prototype.getPanel=function(){return this.panel=Ext.create("Ext.panel.Panel",{layout:{type:"vbox",align:"center"},cls:"border-grid",items:[this.shipmentForm.getPanel(),this.parcelGrid.getPanel()]}),this.panel},ShippingMainView.prototype.load=function(a){var b=this;if(this.shippingId=a,null==a&&Ext.getCmp(this.id+"grid").disable(!0),this.panel.setTitle("Shipment"),null!=a){this.panel.setLoading();var c=function(a,c){b.shipmentForm.load(c),b.parcelGrid.load(c),b.panel.setLoading(!1)};EXI.getDataAdapter({onSuccess:c}).proposal.shipping.getShipment(a)}},ShippingMainViewTest.prototype.getPanel=function(){return this.panel=Ext.create("Ext.panel.Panel",{layout:{type:"vbox",align:"center"},cls:"border-grid",items:[this.shipmentForm.getPanel(),this.parcelGrid.getPanel()]}),this.panel},ShippingMainViewTest.prototype.load=function(a){var b=this;if(this.shippingId=a,null==a&&Ext.getCmp(this.id+"grid").disable(!0),this.panel.setTitle("Shipment"),null!=a){this.panel.setLoading();var c=function(a,c){b.shipmentForm.load(c),b.parcelGrid.load(c),b.panel.setLoading(!1)};EXI.getDataAdapter({onSuccess:c}).proposal.shipping.getShipment(a)}},WelcomeMainView.prototype.getPanel=MainView.prototype.getPanel,WelcomeMainView.prototype.getContainer=function(){return{layout:{type:"fit"},items:[{html:"<iframe style='width:900px;height:900px;' frameBorder='0' src='../html/welcome.html'></iframe>",margin:"50 0 0 50"}]}},WelcomeMainView.prototype.load=function(){},AuthenticationForm.prototype.show=function(){this.window=Ext.create("Ext.window.Window",{title:"Login",height:250,closable:!1,width:450,modal:!0,layout:"fit",items:[this.getPanel()]}),this.window.show()},AuthenticationForm.prototype.getAuthenticationForm=function(){if(ExtISPyB.sites&&ExtISPyB.sites.length>1){var a=Ext.create("Ext.data.Store",{fields:["name","url","exiUrl"],data:ExtISPyB.sites});return{xtype:"container",layout:"vbox",items:[{xtype:"textfield",fieldLabel:"User",name:"user",margin:"10 0 0 10",allowBlank:!1},{xtype:"textfield",fieldLabel:"Password",margin:"10 0 0 10",name:"password",allowBlank:!1,inputType:"password"},{xtype:"combo",fieldLabel:"Choose site",name:"site",store:a,allowBlank:!1,valueField:"url",displayField:"name",margin:"10 0 0 10"}]}}return{xtype:"container",layout:"vbox",items:[{xtype:"textfield",fieldLabel:"User",name:"user",margin:"30 0 0 10",allowBlank:!1},{xtype:"textfield",fieldLabel:"Password",margin:"10 0 0 10",name:"password",allowBlank:!1,inputType:"password"}]}},AuthenticationForm.prototype.getIconForm=function(){return this.singleSite?{xtype:"image",src:this.site.icon,width:75,height:75,margin:"30 0 0 10"}:void 0},AuthenticationForm.prototype.getPanel=function(){var a=this;return ExtISPyB.sites&&1==ExtISPyB.sites.length&&(this.singleSite=!0,this.siteURL=ExtISPyB.sites[0].url,this.site=ExtISPyB.sites[0],this.icon=ExtISPyB.sites[0].icon),Ext.create("Ext.form.Panel",{bodyPadding:5,width:370,layout:"vbox",defaults:{anchor:"90%"},defaultType:"textfield",items:[{xtype:"container",layout:"hbox",items:[this.getIconForm(),this.getAuthenticationForm()]}],buttons:[{text:"Login",formBind:!0,disabled:!0,handler:function(){var b=this.up("form").getForm(),c=null;a.singleSite||(a.siteURL=b.getFieldValues().site);for(var d=0;d<ExtISPyB.sites.length;d++)ExtISPyB.sites[d].url==a.siteURL&&(c=ExtISPyB.sites[d]);a.onAuthenticate.notify({user:b.getFieldValues().user,password:b.getFieldValues().password,site:a.siteURL,exiUrl:c.exiUrl,properties:c})}}]})},CurvePlotter.prototype.getPanel=function(){return this.plotPanel=Ext.create("Ext.container.Container",{layout:{type:"hbox"},flex:.7,margin:this.margin,items:[{html:'<div id="'+this.targetId+'"></div>',id:this.id}]}),this.plotPanel.on("afterrender",function(){}),this.plotPanel.on("resize",function(){}),this.plotPanel},CurvePlotter.prototype.getPointCount=function(){return this.dygraph.rawData_.length},CurvePlotter.prototype.getColors=function(){return this.dygraph.getColors()},CurvePlotter.prototype.getLabels=function(){return this.dygraph.getLabels()},CurvePlotter.prototype.render=function(a){var b=this;null!=document.getElementById(this.targetId)&&(document.getElementById(this.targetId).innerHTML="",this.width=this.plotPanel.getWidth(),this.height=this.plotPanel.getHeight(),document.getElementById(this.targetId).setAttribute("style","border: 1px solid #000000; height:"+(this.plotPanel.getHeight()-1)+"px;width:"+(this.plotPanel.getWidth()-2)+"px;"),Ext.getCmp(this.id).setHeight(this.plotPanel.getHeight()),Ext.getCmp(this.id).setWidth(this.plotPanel.getWidth()),this.dygraph=new Dygraph(document.getElementById(this.targetId),a,{title:this.title,titleHeight:20,legend:this.legend,labelsSeparateLines:!0,errorBars:!0,connectSeparatedPoints:!0,pointClickCallback:function(a,c){b.onPointClickCallback.notify(c.name)}}),this.dygraph.ready(function(){b.onRendered.notify()}))},CurvePlotter.prototype.loadMerge=function(a,b,c,d){this.render(EXI.getDataAdapter().saxs.hplc.getFramesMergeURL(a,b,c,d))},CurvePlotter.prototype.loadHPLCFrame=function(a,b){this.render(EXI.getDataAdapter().saxs.hplc.getHPLCFramesScatteringURL(a,b))},CurvePlotter.prototype.loadUrl=function(a){this.render(a)},CurvePlotter.prototype.load=function(a){this.render(EXI.getDataAdapter().saxs.frame.getFramesURL(a.frame,a.average,a.subtracted,a.sampleaverage,a.bufferaverage))},AutoProcIntegrationCurvePlotter.prototype.getPointCount=CurvePlotter.prototype.getPointCount,AutoProcIntegrationCurvePlotter.prototype.getLabels=CurvePlotter.prototype.getLabels,AutoProcIntegrationCurvePlotter.prototype.toCSV=function(a,b){
for(var c=a.toString()+"\n",d=0;d<b.length;d++){for(var e=0;e<b[d].length;e++)c=c+b[d][e]+",";c=c.substring(0,c.length-1),c+="\n"}return c},AutoProcIntegrationCurvePlotter.prototype.render=function(a,b){var c=this,d=new Dygraph(document.getElementById(this.targetId),this.toCSV(a,b),{title:this.title,titleHeight:20,legend:"always",height:this.height-100,hideOverlayOnMouseOut:!0,labelsSeparateLines:!0,labelsDiv:c.targetId+"_legend",labelsDivStyles:" { 'fontSize': 6 } ",axisLabelWidth:20,connectSeparatedPoints:!0,pointClickCallback:function(a,b){c.onPointClickCallback.notify(b.name)},axes:{x:{pixelsPerXLabel:30,axisLabelFormatter:function(a,b,d){return c.xLabels[a]}}}});d.ready(function(){})},AutoProcIntegrationCurvePlotter.prototype.loadUrl=function(a){$.ajax({url:a,context:this}).done(function(a){var b=0,c=this;if(c.xLabels=[],!a)return void EXI.setError("CSV is empty");var d=a.split("\n");if(d){if(!d[0])return void EXI.setError("No labels on csv");this.data.labels=d[0].split(",");var e=function(a){return a&&""!=a?parseFloat(a):""},f=function(a){var d=[],f=a.split(",");f=_.map(f,e),d.push(b),c.xLabels.push(f[0]);for(var g=1;g<f.length;g++)g%2!=0&&d.push(f[g]);return b+=1,d};d=d.reverse(),this.data.data=_.map(_.slice(d,1,d.length-1),f);try{this.render(this.data.labels,this.data.data)}catch(g){EXI.setError(g.message)}}})},AutoProcIntegrationCurvePlotter.prototype.getHTML=function(){return'<div  id="'+this.targetId+'"></div><div  style="height:20px" id="'+this.targetId+'_legend"></div>'},AutoProcIntegrationCurvePlotter.prototype.getPanel=function(){return this.plotPanel=Ext.create("Ext.panel.Panel",{layout:{type:"fit"},height:this.height,margin:this.margin,items:[{html:this.getHTML(),id:this.id,style:{border:"1px solid black"},height:this.height,border:1}]}),this.plotPanel},ParcelPanel.prototype.addHeaderPanel=function(){var a="No information";dust.render("parcel.header.shipping.template",this.dewar,function(b,c){a=c}),this.panel.add(0,{xtype:"container",border:1,padding:1,items:{xtype:"container",layout:"hbox",items:_.concat(this._getTopButtons(),{html:a,margin:12})}})},ParcelPanel.prototype.render=function(){var a=this,b=this.dewar;if(this.panel.removeAll(),this.addHeaderPanel(),null!=b&&null!=b.containerVOs){var c=Ext.create("Ext.panel.Panel",{layout:"hbox",cls:"border-grid",margin:"0 0 0 6px",width:this.width-15,height:this.pucksPanelHeight+20,autoScroll:!0,items:[]});this.panel.add(c),b.containerVOs.sort(function(a,b){return a.containerId-b.containerId});for(var d={},e=[],f=0;f<b.containerVOs.length;f++){var g=b.containerVOs[f],h=new PuckParcelPanel({height:this.pucksPanelHeight,containerId:g.containerId,capacity:g.capacity,code:g.code});h.onPuckRemoved.attach(function(b,c){_.remove(a.dewar.containerVOs,{containerId:c}),a.load(a.dewar)}),h.onPuckSaved.attach(function(b,c){_.remove(a.dewar.containerVOs,{containerId:c.containerId}),a.dewar.containerVOs.push(c),a.load(a.dewar)}),d[g.containerId]=h,e.push(g.containerId),c.insert(h.getPanel())}if(!_.isEmpty(d)){var i=function(a,b){if(b){for(var c={},e=0;e<b.length;e++){var f=b[e];c[f.Container_containerId]?c[f.Container_containerId].push(f):c[f.Container_containerId]=[f]}_.each(c,function(a,b){d[b].load(a)})}};EXI.getDataAdapter({onSuccess:i}).mx.sample.getSamplesByContainerId(e)}}},ParcelPanel.prototype.load=function(a){this.dewar=a;try{this.render()}catch(b){console.log(b)}},ParcelPanel.prototype.addPuckToDewar=function(){var a=this,b=function(b,c){a.dewar.containerVOs.push(c),a.load(a.dewar)};EXI.getDataAdapter({onSuccess:b}).proposal.shipping.addPuck(this.dewar.dewarId,this.dewar.dewarId)},ParcelPanel.prototype.showCaseForm=function(){var a=this,b=new CaseForm,c=Ext.create("Ext.window.Window",{title:"Parcel",height:450,width:600,modal:!0,layout:"fit",items:[b.getPanel(a.dewar)],listeners:{afterrender:function(b,c){null!=a.puck&&a.render(a.puck)}},buttons:[{text:"Save",handler:function(){a.onSavedClick.notify(b.getDewar()),a.render(),c.close()}},{text:"Cancel",handler:function(){c.close()}}]});c.show()},ParcelPanel.prototype._getTopButtons=function(){var a=this,b=[];return b.push(Ext.create("Ext.Button",{icon:"../images/icon/edit.png",text:"Edit",cls:"x-btn x-unselectable x-box-item x-toolbar-item x-btn-default-toolbar-small x-icon-text-left x-btn-icon-text-left x-btn-default-toolbar-small-icon-text-left",margin:5,disabled:!1,handler:function(b,c){a.showCaseForm()}})),b.push(Ext.create("Ext.Button",{icon:"../images/print.png",text:"Print Labels",cls:"x-btn x-unselectable x-box-item x-toolbar-item x-btn-default-toolbar-small x-icon-text-left x-btn-icon-text-left x-btn-default-toolbar-small-icon-text-left",margin:5,disabled:!1,handler:function(b,c){var d=a.dewar.dewarId,e=EXI.getDataAdapter().proposal.shipping.getDewarLabelURL(d,d);location.href=e}})),b.push(Ext.create("Ext.Button",{icon:"../images/icon/add.png",text:"Add puck",cls:"x-btn x-unselectable x-box-item x-toolbar-item x-btn-default-toolbar-small x-icon-text-left x-btn-icon-text-left x-btn-default-toolbar-small-icon-text-left",margin:5,disabled:!1,handler:function(b,c){a.addPuckToDewar()}})),b},ParcelPanel.prototype.getPanel=function(){return this.panel=Ext.create("Ext.panel.Panel",{cls:"border-grid",margin:10,height:this.height,width:this.width,autoScroll:!0,items:[]}),this.panel},ProposalGrid.prototype.load=function(a){this.data=a,this.store.loadData(a,!1)},ProposalGrid.prototype.getFilter=function(a){return[{property:"Proposal_proposalNumber",value:a,anyMacth:!0}]},ProposalGrid.prototype.filter=function(a){},ProposalGrid.prototype._getTbar=function(){var a=this,b=[];return b.push({xtype:"textfield",name:"field1",emptyText:"search by number",hidden:this.isHidden,listeners:{change:function(b,c){var d=b.getValue();""!=d?a.store.filter(a.getFilter(b.getValue())):(a.store.clearFilter(!0),a.load(a.data))}}}),b},ProposalGrid.prototype.getPanel=function(){var a=this;return this.store=Ext.create("Ext.data.Store",{fields:["Proposal_proposalId","Proposal_title","Proposal_proposalCode","Proposal_proposalNumber","Proposal_proposalType"]}),this.store.sort(["Proposal_proposalCode","Proposal_proposalNumber"]),this.panel=Ext.create("Ext.grid.Panel",{title:"Proposals",store:this.store,tbar:this._getTbar(),layout:"fit",cls:"border-grid",height:this.height,margin:this.margin,emptyText:"No proposals",columns:[{text:"Proposal",dataIndex:"Proposal_code",width:125,renderer:function(a,b,c){return"<a href='#'>"+c.data.Proposal_proposalCode+c.data.Proposal_proposalNumber+"</a>"}},{text:"Code",dataIndex:"Proposal_number",width:75,hidden:!0},{text:"Number",dataIndex:"number",width:75,hidden:!0},{text:"Title",dataIndex:"Proposal_title",flex:1}],flex:1,viewConfig:{stripeRows:!0,listeners:{cellclick:function(b,c,d,e,f,g,h,i){a.onSelected.notify(e.data)}}}}),this.tbar&&this.panel.addDocked({xtype:"toolbar",cls:"toolBarGrid",height:48,items:this._getTbar()}),this.panel},PuckParcelPanel.prototype.getPanel=function(){return this.puck=new PuckWidgetContainer(this.data),this.puckPanel=Ext.create("Ext.panel.Panel",{width:this.width,height:2*this.data.mainRadius+5,items:[this.puck.getPanel()]}),this.panel=Ext.create("Ext.panel.Panel",{width:this.width,height:this.height,items:[{html:this.getCodeHeader(),margin:5,x:this.data.xMargin},this.puckPanel,this.getButtons()]}),this.panel},PuckParcelPanel.prototype.load=function(a){this.puck=new PuckWidgetContainer(this.data),this.puckPanel.removeAll(),this.puckPanel.add(this.puck.getPanel()),this.puck.loadSamples(a),this.containerId=this.puck.puckWidget.containerId},PuckParcelPanel.prototype.getCodeHeader=function(){var a={info:[{text:"Code:",value:this.code}]},b="";return dust.render("info.grid.template",a,function(a,c){b=c}),b},PuckParcelPanel.prototype.getButtons=function(){var a=this;return this.buttons=Ext.create("Ext.panel.Panel",{layout:{type:"hbox",align:"middle",pack:"center"},width:this.width,items:[{xtype:"button",margin:5,icon:"../images/icon/edit.png",handler:function(b,c){var d=new PuckForm({width:Ext.getBody().getWidth()-150});d.onRemoved.attach(function(b,c){a.onPuckRemoved.notify(c),e.close()}),d.onSaved.attach(function(b,c){a.onPuckSaved.notify(c),e.close()});var e=Ext.create("Ext.window.Window",{title:"Edit Puck",height:700,width:Ext.getBody().getWidth()-100,modal:!0,resizable:!0,layout:"fit",items:d.getPanel()}).show();if(null!=a.containerId){var f=function(a,b){d.load(b)};EXI.getDataAdapter({onSuccess:f}).proposal.shipping.getContainerById(a.containerId,a.containerId,a.containerId)}}},{xtype:"button",margin:5,cls:"btn-remove",icon:"../images/icon/ic_highlight_remove_black_24dp.png",handler:function(){function b(b){"yes"==b&&a.removePuck()}Ext.MessageBox.show({title:"Remove",msg:"Removing a puck from this parcel will remove also its content. <br />Are you sure you want to continue?",buttons:Ext.MessageBox.YESNO,fn:b,animateTarget:"mb4",icon:Ext.MessageBox.QUESTION})}}]}),this.buttons},PuckParcelPanel.prototype.removePuck=function(){var a=this;this.panel.setLoading();var b=function(b,c){a.panel.setLoading(!1),a.onPuckRemoved.notify(a.containerId)},c=this.containerId;EXI.getDataAdapter({onSuccess:b}).proposal.shipping.removeContainerById(c,c,c)},SessionGrid.prototype.load=function(a){this.sessions=a,this.store.loadData(a,!1)},SessionGrid.prototype.filterByBeamline=function(a){if(a)if(a.length>0){for(var b=[],c=0;c<a.length;c++)b=_.concat(b,_.filter(this.sessions,{beamLineName:a[c]}));this.store.loadData(b,!1)}else this.store.loadData(this.sessions,!1)},SessionGrid.prototype.getToolbar=function(a){for(var b=this,c=[],d=function(a,c,d){c?b.beamlineFilter.push(a.boxLabel):b.beamlineFilter=_.remove(b.beamlineFilter,a.boxLabel),b.filterByBeamline(b.beamlineFilter)},e=0;e<EXI.credentialManager.getBeamlines().length;e++)c.push({xtype:"checkbox",boxLabel:EXI.credentialManager.getBeamlines()[e].name,name:EXI.credentialManager.getBeamlines()[e].name,handler:d});return Ext.create("Ext.toolbar.Toolbar",{items:c})},SessionGrid.prototype.getPanel=function(){var a=this;return this.store=Ext.create("Ext.data.Store",{fields:["Proposal_ProposalNumber","beamLineName","beamLineOperator","Proposal_title","Person_emailAddress","Person_familyName","Person_givenName","nbShifts","comments"],emptyText:"No sessions",data:[]}),this.panel=Ext.create("Ext.grid.Panel",{title:this.title,store:this.store,tbar:this.getToolbar(),icon:"../images/icon/sessions.png",cls:"border-grid",minHeight:300,width:this.width,height:this.height,margin:this.margin,layout:this.layout,columns:[{text:"",dataIndex:"BLSession_startDate",flex:1,hidden:!0,renderer:function(a,b,c){var d="";return c.data.BLSession_startDate&&(c.data.start=moment(c.data.BLSession_startDate,"MMMM Do YYYY, h:mm:ss a").format("MMMM Do YYYY"),c.data.day=moment(c.data.BLSession_startDate,"MMMM Do YYYY, h:mm:ss a").format("Do"),c.data.month=moment(c.data.BLSession_startDate,"MMMM Do YYYY, h:mm:ss a").format("MMMM"),c.data.year=moment(c.data.BLSession_startDate,"MMMM Do YYYY, h:mm:ss a").format("YYYY")),dust.render("session.grid",c.data,function(a,b){d+=b}),d}},{text:"Start",dataIndex:"BLSession_startDate",flex:2,hidden:!1,renderer:function(a,b,c){var d="#";return d="SAXS"==EXI.credentialManager.getTechniqueByBeamline(c.data.beamLineName)?"#/session/nav/"+c.data.sessionId+"/session":"#/mx/datacollection/session/"+c.data.sessionId+"/main",c.data.BLSession_startDate?"<a href='"+d+"'>"+moment(c.data.BLSession_startDate,"MMMM Do YYYY, h:mm:ss a").format("MMMM Do YYYY")+"</a>":void 0}},{text:"Beamline",dataIndex:"beamLineName",width:125,hidden:!1,renderer:function(a,b,c){var d="#";return d="SAXS"==EXI.credentialManager.getTechniqueByBeamline(c.data.beamLineName)?"#/session/nav/"+c.data.sessionId+"/session":"#/mx/datacollection/session/"+c.data.sessionId+"/main","<a href='"+d+"'>"+c.data.beamLineName+"</a>"}},{text:"Proposal",dataIndex:"Proposal_ProposalNumber",flex:1,hidden:!1,renderer:function(a,b,c){var d=c.data.Proposal_proposalCode+c.data.Proposal_ProposalNumber;return"<a href='#/session/nav' data-toggle='tooltip' title='Open proposal "+d+"'>"+d+"</a>"}},{text:"Shifts",dataIndex:"nbShifts",hidden:this.isHiddenNumberOfShifts,flex:1},{text:"Local Contact",dataIndex:"beamLineOperator",width:200,hidden:this.isHiddenLocalContact,flex:1},{text:"Title",dataIndex:"Proposal_title",width:200,hidden:this.isHiddenTitle,flex:4},{text:"PI",dataIndex:"Proposal_title",width:200,hidden:this.isHiddenPI,renderer:function(a,b,c){return c.data.Person_familyName+", "+c.data.Person_givenName}},{text:"e-mail",dataIndex:"Person_emailAddress",width:200,hidden:!0,flex:1},{text:"Data Collections",dataIndex:"Person_emailAddress",width:200,renderer:function(a,b,c){function d(a,b){return b&&0!=b?'<tr><td><span style="margin-left:10px;margin-top:2px;background-color:#207a7a;" class="badge">'+b+'</span></td><td style="padding-left:10px;">'+a+"</td></tr>":""}function e(a){var b="<table>";return b=b+=d("Energy",a.data.energyScanCount),b+=d("XRF",a.data.xrfSpectrumCount),b+=d("Samples",a.data.sampleCount),b+=d("Test",a.data.testDataCollectionGroupCount),b+=d("Collects",a.data.dataCollectionGroupCount),b+=d("Calibration",a.data.calibrationCount),b+=d("Sample Changer",a.data.sampleChangerCount),b+=d("HPLC",a.data.hplcCount),b+"</table>"}return e(c)}},{text:"End",dataIndex:"BLSession_endDate",hidden:!0,flex:1,renderer:function(a,b,c){return c.data.BLSession_endDate}},{text:"Comments",dataIndex:"comments",hidden:!1,flex:3,renderer:function(a,b,c){return c.data.comments?"<div style='width:50px; wordWrap: break-word;'>"+c.data.comments+"</div>":void 0}}],viewConfig:{stripeRows:!0,getRowClass:function(a,b,c,d){}},listeners:{cellclick:function(b,c,d,e,f,g,h,i){a.onSelected.notify({proposalCode:e.data.Proposal_proposalCode,proposalNumber:e.data.Proposal_ProposalNumber})}}}),this.panel},SAXSExiController.prototype.loadNavigationPanel=ExiController.prototype.loadNavigationPanel,SAXSExiController.prototype.routeNavigation=function(){function a(a){return b.loadNavigationPanel(a)}var b=this;Path.map("#/saxs/:navigation/nav").to(function(){var b=null;if("buffer"==this.params.navigation&&(EXI.clearNavigationPanel(),EXI.setLoadingNavigationPanel(!0),b=new BufferListView,b.onSelect.attach(function(a,b){location.hash="/buffer/"+b[0].bufferId+"/main"}),EXI.addNavigationPanel(b),b.load(EXI.proposalManager.getBuffers()),EXI.setLoadingNavigationPanel(!1),EXI.addMainPanel(new BufferWelcomeMainView)),"stocksolution"==this.params.navigation&&(EXI.clearNavigationPanel(),EXI.setLoadingNavigationPanel(!0),b=new StockSolutionListView,b.onSelect.attach(function(a,b){location.hash="/stocksolution/"+b[0].stockSolutionId+"/main"}),EXI.addNavigationPanel(b),b.load(EXI.proposalManager.getStockSolutions()),EXI.setLoadingNavigationPanel(!1),EXI.addMainPanel(new StockSolutionWelcomeMainView)),"macromolecule"==this.params.navigation&&(EXI.clearNavigationPanel(),EXI.setLoadingNavigationPanel(!0),b=new MacromoleculeListView,b.onSelect.attach(function(a,b){location.hash="/macromolecule/"+b[0].macromoleculeId+"/main"}),EXI.addNavigationPanel(b),b.load(EXI.proposalManager.getMacromolecules()),EXI.setLoadingNavigationPanel(!1),EXI.addMainPanel(new MacromoleculeWelcomeMainView)),"template"==this.params.navigation){EXI.clearNavigationPanel(),EXI.setLoadingNavigationPanel(!0),b=new TemplateListView,b.onSelect.attach(function(a,b){location.hash="/experiment/templateId/"+b[0].experimentId+"/main"});var c=a(b);c.saxs.experiment.getByExperimentByKey("experimentType","TEMPLATE"),EXI.addMainPanel(new ExperimentWelcomeMainView)}}).enter(this.setPageBackground)},SAXSExiController.prototype.setPageBackground=function(){},SAXSExiController.prototype.notFound=function(){},SAXSExiController.prototype.routeExperiment=function(){Path.map("#/experiment/experimentId/:experimentId/main").to(function(){var a=new ExperimentMainView;EXI.addMainPanel(a),a.load(this.params.experimentId),a.onSelect.attach(function(a,b){EXI.localExtorage.selectedSubtractionsManager.append(b)}),a.onDeselect.attach(function(a,b){EXI.localExtorage.selectedSubtractionsManager.remove(b)})}).enter(this.setPageBackground),Path.map("#/experiment/hplc/:experimentId/main").to(function(){var a=new HPLCMainView;EXI.addMainPanel(a),a.load(this.params.experimentId),a.onSelect.attach(function(a,b){EXI.localExtorage.selectedSubtractionsManager.append(b)}),a.onDeselect.attach(function(a,b){EXI.localExtorage.selectedSubtractionsManager.remove(b)})}).enter(this.setPageBackground),Path.map("#/experiment/:key/:value/main").to(function(){alert("!"),EXI.setLoadingMainPanel();var a=function(a,b){if(EXI.setLoadingMainPanel(!1),null!=b&&b.length>0){var c=null;"STATIC"==b[0].experimentType&&(c=new ExperimentMainView),"HPLC"==b[0].experimentType&&(c=new HPLCMainView),"TEMPLATE"==b[0].experimentType&&(c=new TemplateMainView),EXI.addMainPanel(c),c.load(b),c.onSelect.attach(function(a,b){EXI.localExtorage.selectedSubtractionsManager.append(b)}),c.onDeselect.attach(function(a,b){EXI.localExtorage.selectedSubtractionsManager.remove(b)})}};"experimentId"==this.params.key||"templateId"==this.params.key?EXI.getDataAdapter({onSuccess:a}).saxs.experiment.getByExperimentId([this.params.value]):EXI.getDataAdapter({onSuccess:a}).saxs.experiment.getByExperimentByKey(this.params.key,this.params.value)}).enter(this.setPageBackground)},SAXSExiController.prototype.routeDataCollection=function(){Path.map("#/datacollection/macromoleculeAcronym/:value/main").to(function(){EXI.setLoadingMainPanel("Searching "+this.params.value+"...");var a=function(a,b){if(null!=b)if(b.length>0){var c=new DataCollectionMainView;EXI.addMainPanel(c),c.load(b),c.onSelect.attach(function(a,b){EXI.localExtorage.selectedSubtractionsManager.append(b)}),c.onDeselect.attach(function(a,b){EXI.localExtorage.selectedSubtractionsManager.remove(b)});var d=new DataCollectionListView;d.onSelect.attach(function(a,b){c.filter(b[0].macromoleculeId,b[0].bufferAcronym)}),EXI.addNavigationPanel(d),d.load(b),EXI.setLoadingNavigationPanel(!1)}else BUI.showWarning("No macromolecule has been found");else BUI.showWarning("No data to display");EXI.setLoadingMainPanel(!1)};EXI.getDataAdapter({onSuccess:a}).saxs.dataCollection.getDataCollectionsByKey(this.params.key,this.params.value)}).enter(this.setPageBackground),Path.map("#/saxs/datacollection/:key/:value/main").to(function(){EXI.setLoadingMainPanel();var a=function(a,b){var c=new DataCollectionMainView;EXI.addMainPanel(c),c.load(b),EXI.setLoadingMainPanel(!1),c.onSelect.attach(function(a,b){EXI.localExtorage.selectedSubtractionsManager.append(b)}),c.onDeselect.attach(function(a,b){EXI.localExtorage.selectedSubtractionsManager.remove(b)})};EXI.getDataAdapter({onSuccess:a}).saxs.dataCollection.getDataCollectionsByKey(this.params.key,this.params.value)}).enter(this.setPageBackground),Path.map("#/saxs/datacollection/:key/:value/primaryviewer").to(function(){var a=function(a,b){var c=new PrimaryDataMainView;EXI.addMainPanel(c),c.load(b)};EXI.getDataAdapter({onSuccess:a}).saxs.dataCollection.getDataCollectionsByKey(this.params.key,this.params.value)}).enter(this.setPageBackground),Path.map("#/saxs/datacollection/:key/:value/merge").to(function(){var a=function(a,b){var c=new MergeMainView;EXI.addMainPanel(c),c.load(b)};EXI.getDataAdapter({onSuccess:a}).saxs.dataCollection.getDataCollectionsByKey(this.params.key,this.params.value)}).enter(this.setPageBackground)},SAXSExiController.prototype.routePrepare=function(){Path.map("#/buffer/:bufferId/main").to(function(){var a=new BufferMainView;EXI.addMainPanel(a),a.load(this.params.bufferId)}).enter(this.setPageBackground),Path.map("#/buffer/add").to(function(){var a=new BufferMainView;EXI.addMainPanel(a)}).enter(this.setPageBackground),Path.map("#/macromolecule/:macromoleculeId/main").to(function(){var a=new MacromoleculeMainView;EXI.addMainPanel(a),a.load(this.params.macromoleculeId)}).enter(this.setPageBackground),Path.map("#/macromolecule/add").to(function(){var a=new MacromoleculeMainView;EXI.addMainPanel(a)}).enter(this.setPageBackground),Path.map("#/stocksolution/:stocksolutionId/main").to(function(){var a=new StockSolutionMainView;EXI.addMainPanel(a),a.load(this.params.stocksolutionId)}).enter(this.setPageBackground),Path.map("#/stocksolution/add").to(function(){var a=new StockSolutionMainView;EXI.addMainPanel(a),a.load()}).enter(this.setPageBackground),Path.map("#/prepare/stocksolution/main").to(function(){var a=new StockSolutionMainView;EXI.addMainPanel(a),a.load()}).enter(this.setPageBackground),Path.map("#/prepare/templates/main").to(function(){var a=new ExperimentDesignerMainView;EXI.addMainPanel(a),a.load()}).enter(this.setPageBackground),Path.map("#/prepare/shipmentpreparation").to(function(){var a=new ShipmentPreparationMainView;EXI.addMainPanel(a),a.load()}).enter(this.setPageBackground),Path.map("#/prepare/designer").to(function(){var a=new DesignerMainView;EXI.addMainPanel(a),a.load()}).enter(this.setPageBackground)},SAXSExiController.prototype.init=function(){function a(){b.notFound()}var b=this;this.routeNavigation(),this.routeExperiment(),this.routeDataCollection(),this.routePrepare(),Path.map("#/session/nav/:sessionId/session").to(function(){EXI.clearNavigationPanel();var a=new SessionSaxsListView;a.onSelect.attach(function(a,b){"HPLC"==b[0].experimentType&&(location.hash="/experiment/hplc/"+b[0].experimentId+"/main"),"STATIC"!=b[0].experimentType&&"CALIBRATION"!=b[0].experimentType||(location.hash="/experiment/experimentId/"+b[0].experimentId+"/main"),"TEMPLATE"==b[0].experimentType&&(location.hash="/experiment/templateId/"+b[0].experimentId+"/main")});var b=function(b,c){EXI.addNavigationPanel(a),a.load(c),EXI.setLoadingMainPanel(!1)};EXI.getDataAdapter({onSuccess:b}).saxs.experiment.getExperimentsBySessionId(this.params.sessionId)}).enter(this.setPageBackground),Path.map("#/project/:projectId/run/:runId/main").to(function(){var a=this.params.projectId,b=this.params.runId,c=function(a,c){for(var d=0;d<c.length;d++)if(c[d].internalId==b){var e=new RunMainView;EXI.addMainPanel(e),e.load(c[d])}},d=function(a,b){};EXI.getDataAdapter({onSuccess:c,onError:d}).exi.offline.getRuns(a)}).enter(this.setPageBackground),Path.rescue(a)},ExiSAXS.prototype.loadSelected=Exi.prototype.loadSelected,ExiSAXS.prototype.addMainPanel=Exi.prototype.addMainPanel,ExiSAXS.prototype.getSelectedDataCollections=Exi.prototype.getSelectedDataCollections,ExiSAXS.prototype.addNavigationPanel=Exi.prototype.addNavigationPanel,ExiSAXS.prototype.clearNavigationPanel=Exi.prototype.clearNavigationPanel,ExiSAXS.prototype.clearMainPanel=Exi.prototype.clearMainPanel,ExiSAXS.prototype.setLoadingNavigationPanel=Exi.prototype.setLoadingNavigationPanel,ExiSAXS.prototype.setError=Exi.prototype.setError,ExiSAXS.prototype.setLoading=Exi.prototype.setLoading,ExiSAXS.prototype.setLoadingMainPanel=Exi.prototype.setLoadingMainPanel,ExiSAXS.prototype.show=Exi.prototype.show,ExiSAXS.prototype.setAnonymousMenu=Exi.prototype.setAnonymousMenu,ExiSAXS.prototype.setUserMenu=Exi.prototype.setUserMenu,ExiSAXS.prototype.appendDataAdapterParameters=Exi.prototype.appendDataAdapterParameters,ExiSAXS.prototype.hideNavigationPanel=Exi.prototype.hideNavigationPanel,ExiSAXS.prototype.showNavigationPanel=Exi.prototype.showNavigationPanel,ExiSAXS.prototype.getHeader=function(){var a="",b={version:ExtISPyB.version,release_date:ExtISPyB.release_date};return dust.render("saxsheader",b,function(b,c){a=c}),a},ExiSAXS.prototype.getDataAdapter=function(a){return new SaxsDataAdapterFactory(this.appendDataAdapterParameters(a))},SAXSMainMenu.prototype.populateCredentialsMenu=MainMenu.prototype.populateCredentialsMenu,SAXSMainMenu.prototype.init=MainMenu.prototype.init,SAXSMainMenu.prototype.getPanel=MainMenu.prototype.getPanel,SAXSMainMenu.prototype._convertToHTMLWhiteSpan=MainMenu.prototype._convertToHTMLWhiteSpan,SAXSMainMenu.prototype.getAddCredentialMenu=MainMenu.prototype.getAddCredentialMenu,SAXSMainMenu.prototype.getLoginButton=MainMenu.prototype.getLoginButton,SAXSMainMenu.prototype.setText=MainMenu.prototype.setText,SAXSMainMenu.prototype.getHelpMenu=MainMenu.prototype.getHelpMenu,SAXSMainMenu.prototype.getHomeItem=MainMenu.prototype.getHomeItem,SAXSMainMenu.prototype.getShipmentItem=MainMenu.prototype.getShipmentItem,SAXSMainMenu.prototype.getMenuItems=function(){return[this.getHomeItem(),this.getShipmentItem(),{text:this._convertToHTMLWhiteSpan("Prepare Experiment"),cls:"ExiSAXSMenuToolBar",hidden:this.isHidden,menu:this.getPreparationMenu()},{text:this._convertToHTMLWhiteSpan("Data Explorer"),cls:"ExiSAXSMenuToolBar",hidden:this.isHidden,menu:this.getDataExplorerMenu()},{text:this._convertToHTMLWhiteSpan("Help"),cls:"ExiSAXSMenuToolBar",menu:this.getHelpMenu()},"->",{xtype:"textfield",name:"field1",emptyText:"search macromolecule",hidden:this.isHidden,listeners:{specialkey:function(a,b){b.getKey()==b.ENTER&&(location.hash="/datacollection/macromoleculeAcronym/"+a.getValue()+"/main")}}}]},SAXSMainMenu.prototype.getPreparationMenu=function(){function a(a,b){"Macromolecules"==a.text&&(location.hash="/saxs/macromolecule/nav"),"Buffers"==a.text&&(location.hash="/saxs/buffer/nav"),"Sample Tracking"==a.text&&(location.hash="/saxs/shipping/nav"),"My Experiments"==a.text&&(location.hash="/saxs/template/nav")}return Ext.create("Ext.menu.Menu",{items:[{text:"Macromolecules",icon:"../images/icon/macromolecule.png",handler:a},{text:"Buffers",icon:"../images/icon/buffer.jpg",handler:a},"-",{text:"My Experiments",icon:"../images/icon/edit.png",handler:a}]})},SAXSMainMenu.prototype.getDataReductionMenu=function(){function a(a,c){"Sessions"==a.text&&b.onSessionClicked.notify(),"Subtraction"==a.text&&(location.hash="/tool/subtraction/main"),"Experiments"==a.text&&b.onExperimentClicked.notify()}var b=this;return Ext.create("Ext.menu.Menu",{items:[{text:'<span class="menuCategoryItem">SEC</span>'},"-",{text:"Background Test"},{text:"Baseline Checker"},{text:"Frame Merge"},"-",{text:'<span class="menuCategoryItem">INDIVIDUAL CONCENTRATION</span>'},"-",{text:"Subtraction",checked:!1,group:"theme",checkHandler:a},{text:"Average"},"-",{text:'<span class="menuCategoryItem">COMBINING</span>'},"-",{text:"Merging tool"}]})},SAXSMainMenu.prototype.getDataExplorerMenu=function(){function a(a,b){"Calendar"==a.text&&(location.hash="/session/nav"),"Experiments"==a.text&&(location.hash="/experiment/nav")}return Ext.create("Ext.menu.Menu",{items:[{text:"Calendar",icon:"../images/icon/sessions.png",handler:a}]})},SAXSMainMenu.prototype.getOnlineDataAnalisysMenu=function(){function a(a,b){"Structure Validation"==a.text&&(location.hash="/tool/crysol/main"),"Job list"==a.text&&(location.hash="/tool/list")}return Ext.create("Ext.menu.Menu",{items:[{text:"Structure Validation",checked:!1,group:"theme",handler:a},"-",{text:"Job list",checked:!1,group:"theme",handler:a}]})},BufferListView.prototype.getPanel=ListView.prototype.getPanel,BufferListView.prototype.load=ListView.prototype.load,BufferListView.prototype.getRow=function(a){var b="<table class='listView'>";return b=b+"<tr><td>Acronym:</td><td style='color:#207a7a;font-weight:bold;'>"+a.data.acronym+"</td></tr>",b=b+"<tr><td>name:</td><td>"+a.data.name+"</td></tr>",b+"</table>"},BufferListView.prototype.getFilter=function(a){return[{property:"acronym",value:a,anyMacth:!0}]},BufferListView.prototype.getColumns=function(){var a=this;return[{text:"Buffers",flex:1,dataIndex:"bufferId",renderer:function(b,c,d){return a.getRow(d)}}]},BufferListView.prototype.getFields=function(){return["acronym","name"]},DataCollectionListView.prototype.getPanel=ListView.prototype.getPanel,DataCollectionListView.prototype.load=ListView.prototype.load,DataCollectionListView.prototype.getRow=function(a){var b="<table class='listView'>";return b=b+"<tr><td>Macromolecule:</td><td >"+a.data.macromoleculeAcronym+"</td></tr>",b=b+"<tr><td>Buffer:</td><td style='color:#207a7a;font-weight:bold;'>"+a.data.bufferAcronym+"</td></tr>",b=b+"<tr><td>Count:</td><td>"+a.data.dataCollections+"</td></tr>",b+"</table>"},DataCollectionListView.prototype.getFilter=function(a){return[{property:"bufferAcronym",value:a,anyMacth:!0}]},DataCollectionListView.prototype.getColumns=function(){var a=this;return[{text:"Data Collections",flex:1,dataIndex:"bufferAcronym",renderer:function(b,c,d){return a.getRow(d)}}]},DataCollectionListView.prototype.getFields=function(){return["macromoleculeAcronym","bufferAcronym","macromoleculeId","dataCollections"]},DataCollectionListView.prototype.formatData=function(a){a=BUI.groupBy(a,function(a){return[a.bufferAcronym]});for(var b=[],c=0;c<a.length;c++){var d=a[c];b.push({macromoleculeAcronym:d[0].macromoleculeAcronym,macromoleculeId:d[0].macromoleculeId,bufferAcronym:d[0].bufferAcronym,dataCollections:d.length})}return b},MacromoleculeListView.prototype.getPanel=ListView.prototype.getPanel,MacromoleculeListView.prototype.load=ListView.prototype.load,MacromoleculeListView.prototype.getRow=function(a){var b="<table class='listView'>";return b=b+"<tr><td>Acronym:</td><td style='color:#207a7a;font-weight:bold;'>"+a.data.acronym+"</td></tr>",b=b+"<tr><td>name:</td><td>"+a.data.name+"</td></tr>",b+"</table>"},MacromoleculeListView.prototype.getFilter=function(a){return[{property:"acronym",value:a,anyMacth:!0}]},MacromoleculeListView.prototype.getColumns=function(){var a=this;return[{text:"Macromolecule",flex:1,dataIndex:"macromoleculeId",renderer:function(b,c,d){return a.getRow(d)}}]},MacromoleculeListView.prototype.getFields=function(){return["acronym","name","comments"]},SessionSaxsListView.prototype.getPanel=ListView.prototype.getPanel,SessionSaxsListView.prototype.load=ListView.prototype.load,SessionSaxsListView.prototype.parseStatistics=function(a,b){if(b&&a)try{return a/b*100}catch(c){return 0}return 0},SessionSaxsListView.prototype.getRow=function(a){var b="";return a.data.measured=this.parseStatistics(a.data.measurementDoneCount,a.data.measurementCount),a.data.averaged=this.parseStatistics(a.data.measurementAveragedCount,a.data.measurementCount),a.data.subtracted=this.parseStatistics(a.data.dataCollectionDoneCount,a.data.dataCollectionCount),dust.render("sessionsaxslistview.template",a.data,function(a,c){b=c}),b},SessionSaxsListView.prototype.getFilter=function(a){return[{property:"name",value:a,anyMacth:!0}]},SessionSaxsListView.prototype.getColumns=function(){var a=this;return[{text:"Experiment",flex:1,dataIndex:"sessionId",renderer:function(b,c,d){return a.getRow(d)}}]},SessionSaxsListView.prototype.getFields=function(){return["creationDate","name","experimentType"]},StockSolutionListView.prototype.getPanel=ListView.prototype.getPanel,StockSolutionListView.prototype.load=ListView.prototype.load,StockSolutionListView.prototype.getFilter=ListView.prototype.getFilter,StockSolutionListView.prototype.getFields=ListView.prototype.getFields,StockSolutionListView.prototype.getColumns=ListView.prototype.getColumns,StockSolutionListView.prototype.getRow=function(a){var b="";return EXI.proposalManager.getBufferById(a.data.bufferId)&&(a.data.bufferAcronym=EXI.proposalManager.getBufferById(a.data.bufferId).acronym),EXI.proposalManager.getMacromoleculeById(a.data.macromoleculeId)&&(a.data.macromoleculeAcronym=EXI.proposalManager.getMacromoleculeById(a.data.macromoleculeId).acronym),dust.render("stocksolution.listview",a.data,function(a,c){b=c}),b},TemplateListView.prototype.getPanel=ListView.prototype.getPanel,TemplateListView.prototype.load=ListView.prototype.load,TemplateListView.prototype.getRow=function(a){var b="black",c="<table class='listView' style='color:"+b+";'>";return c=c+"<tr style='font-weight: bold;font-size:14px; color:#207a7a;'><td colspan='4'>"+a.data.name+"</td></tr>",c=c+"<tr><td style='font-weight:bold;' colspan='4'>"+a.data.comments+"</td></tr>",c=c+"<tr ><td colspan='4'>"+a.data.creationDate+"</td></tr>",c+"</table>"},TemplateListView.prototype.getFilter=function(a){return[{property:"name",value:a,anyMatch:!0}]},TemplateListView.prototype.getColumns=function(){var a=this;return[{text:"Experiment",flex:1,dataIndex:"sessionId",renderer:function(b,c,d){return a.getRow(d)}}]},TemplateListView.prototype.getFields=function(){
return[{name:"creationDate",type:"string"},{name:"name",type:"string"},{name:"experimentType",type:"string"}]},BufferMainView.prototype.getPanel=MainView.prototype.getPanel,BufferMainView.prototype.getContainer=function(){return Ext.create("Ext.container.Container",{layout:{type:"hbox"},margin:15,border:1,defaults:{labelWidth:80,flex:1},items:[this.bufferForm.getPanel([])]})},BufferMainView.prototype.load=function(a){this.panel.setTitle("Buffer"),this.bufferForm.load(EXI.proposalManager.getBufferById(a))},BufferWelcomeMainView.prototype.getPanel=MainView.prototype.getPanel,BufferWelcomeMainView.prototype.getContainer=MainView.prototype.getContainer,BufferWelcomeMainView.prototype.getOptions=function(){var a="<ul><li>Define beforehand an experiment</li>";return a+="<li>Send your samples by courier</li>",a+"</ul>"},BufferWelcomeMainView.prototype.getContainer=function(){return Ext.createWidget("panel",{plain:!0,margin:"20",layout:"fit",items:[{tabConfig:{title:"Welcome"},items:[{xtype:"container",layout:"fit",padding:10,margin:0,cls:"border-grid",items:[{html:'<div class="landing-title" ><h2>Buffers on ISPyB</h2></div>',margin:"0 0 0 20"},{html:'<div class="landing-text">A buffer is the matched solution which in a sample is suspended</div><br/>',margin:"0 0 0 40"},{html:'<div class="landing-text">You should define a macromolecule on ISPyB if you want:</div>',margin:"0 0 0 40"},{html:this.getOptions(),margin:"0 0 0 40"},{html:'<br/><div class="landing-text">If your macromolecule is not in the list showed on the left you can create a new one</div><br/>',margin:"0 0 0 20"},{xtype:"container",layout:"hbox",cls:"option-bar-menu",items:[{xtype:"button",cls:"square-option",maxWidth:200,minWidth:200,margin:"0 0 0 150",height:100,text:'<div class="square-option-text"; >Add a new buffer</div>',icon:"../images/icon/add.png",iconAlign:"top",handler:function(){location.hash="/buffer/add"}}]}]}]}]})},BufferWelcomeMainView.prototype.load=function(){},DataCollectionMainView.prototype.getPanel=MainView.prototype.getPanel,DataCollectionMainView.prototype.getContainer=MainView.prototype.getContainer,DataCollectionMainView.prototype.filter=function(a,b){this.grid.key={},this.grid.store.filter([{property:"bufferAcronym",value:b,anyMacth:!0}])},DataCollectionMainView.prototype.load=function(a){var b=this;this.grid.onSelectionChange.attach(function(a,c){b.onSelectionChange.notify(c)}),this.grid.onSelect.attach(function(a,c){b.onSelect.notify(c)}),this.grid.onDeselect.attach(function(a,c){b.onDeselect.notify(c)}),this.container.insert(0,this.grid.getPanel()),this.grid.panel.setLoading(),this.grid.store.loadData(a),this.grid.panel.setLoading(!1)},DesignerMainView.prototype.getPanel=MainView.prototype.getPanel,DesignerMainView.prototype.getContainer=function(){return Ext.create("Ext.container.Container",{layout:{type:"hbox"},margin:15,border:1,defaults:{labelWidth:80,flex:1},items:[this.wizardWidget.getPanel(new MeasurementCreatorStepWizardForm(EXI.proposalManager.getMacromolecules(),EXI.proposalManager.getBuffers()))]})},DesignerMainView.prototype.load=function(a){this.panel.setTitle("Experiment Designer")},ExperimentDesignerMainView.prototype.getPanel=MainView.prototype.getPanel,ExperimentDesignerMainView.prototype.getContainer=function(){return Ext.create("Ext.container.Container",{layout:{type:"hbox"},margin:30,bodyStyle:{"background-color":"#E6E6E6"},border:1,style:{borderColor:"#000000",borderStyle:"solid",borderWidth:"1px"},defaults:{labelWidth:80,xtype:"datefield",flex:1},items:[this.templateGrid.getPanel([])]})},ExperimentDesignerMainView.prototype.load=function(){var a=this;this.panel.setLoading();var b=new ProposalUpdater;this.templateGrid.grid.setLoading(),b.onSuccess.attach(function(b,c){a.panel.setLoading(!1);var d=new DataAdapter;d.onSuccess.attach(function(b,c){a.templateGrid.store.loadData(c),a.templateGrid.grid.setLoading(!1)}),d.getByExperimentByKey("experimentType","TEMPLATE")}),b.get(),this.panel.setTitle("Experiment Designer")},ExperimentMainView.prototype.getPanel=MainView.prototype.getPanel,ExperimentMainView.prototype.getSelected=function(){for(var a=[],b=0;b<this.queueGridList.length;b++)a=this.queueGridList[b].getSelected().concat(a);return a},ExperimentMainView.prototype.getTabs=function(){return Ext.createWidget("tabpanel",{plain:!0,margin:"20 0 0 0",activeTab:2,items:[{tabConfig:{title:"Sample Plate Setup"},items:[{xtype:"container",layout:"vbox",height:700,padding:20,style:{borderColor:"gray",borderStyle:"solid",borderWidth:"1px","background-color":"white"},items:[this.specimenWidget.getPanel()]}]},{tabConfig:{title:"Measurements"},items:[{xtype:"container",layout:"fit",height:700,padding:20,style:{borderColor:"gray",borderStyle:"solid",borderWidth:"1px","background-color":"white"},items:[this.measurementGrid.getPanel()]}]},{tabConfig:{title:"Online Data Analysis"},items:[{xtype:"container",layout:"fit",height:700,padding:20,style:{borderColor:"gray",borderStyle:"solid",borderWidth:"1px","background-color":"white"},items:[this.queueGrid.getPanel()]}]}]})},ExperimentMainView.prototype.getContainer=function(){return Ext.create("Ext.container.Container",{layout:{type:"anchor"},defaults:{anchor:"100%",hideEmptyLabel:!1},margin:30,bodyStyle:{"background-color":"#E6E6E6"},items:[this.experimentHeaderForm.getPanel(),this.getTabs()]})},ExperimentMainView.prototype.load=function(a){var b=this;b.panel.setLoading(),b.queueGrid.panel.setLoading();var c=function(c,d){b.experiment=new Experiment(d[0]),b.experimentHeaderForm.load(b.experiment),b.measurementGrid.loadExperiment(b.experiment),b.specimenWidget.refresh(b.experiment),b.panel.setTitle(d[0].name),b.panel.setLoading(!1);var e=function(a,c){b.queueGrid.load(c),b.queueGrid.panel.setLoading(!1)};EXI.getDataAdapter({onSuccess:e}).saxs.dataCollection.getDataCollectionsByExperimentId(a)};EXI.getDataAdapter({onSuccess:c}).saxs.experiment.getExperimentById(a)},ExperimentWelcomeMainView.prototype.getPanel=MainView.prototype.getPanel,ExperimentWelcomeMainView.prototype.getContainer=MainView.prototype.getContainer,ExperimentWelcomeMainView.prototype.getContainer=function(){return Ext.createWidget("panel",{plain:!0,margin:"10",layout:"fit",items:[{tabConfig:{title:"Welcome"},items:[{xtype:"container",layout:"fit",padding:20,margin:0,cls:"border-grid",items:[{html:'<div class="landing-title" ><h2>Designing your experiment on ISPyB</h2></div>'},{html:'<div class="landing-text">A experiment is a set of measurements of samples.</div><br/>',margin:"0 0 0 20"},{xtype:"container",layout:"hbox",cls:"option-bar-menu",items:[{xtype:"button",cls:"square-option",maxWidth:200,minWidth:200,margin:"0 0 0 150",height:100,text:'<div class="square-option-text"; >Create a new Experiment</div>',icon:"../images/icon/add.png",iconAlign:"top",handler:function(){location.hash="/prepare/designer"}}]}]}]}]})},ExperimentWelcomeMainView.prototype.load=function(){},HPLCMainView.prototype.getPanel=MainView.prototype.getPanel,HPLCMainView.prototype.getHeader=function(a,b){return"<span class='item'>"+a+"</span><span class='item_description'>"+b+"</span>"},HPLCMainView.prototype.getPlotContainer=function(){return{xtype:"container",cls:"defaultGridPanel",border:0,defaults:{height:450},items:[this.hplcGraph.getPanel(),this.plotter.getPanel()]}},HPLCMainView.prototype.getContainer=function(){return{xtype:"container",items:[this.grid.getPanel(),this.getPlotContainer()]}},HPLCMainView.prototype.getSelected=function(){for(var a=[],b=0;b<this.queueGridList.length;b++)a=this.queueGridList[b].getSelected().concat(a);return a},HPLCMainView.prototype.loadHPLCGraph=function(a){var b=this,c=function(a,c){c=JSON.parse(c);for(var d=[],e=0;e<c.I0.length;e++)d.push(0);c=[{param:"I0",data:c.I0,std:c.I0_Stdev,color:"#0066CC",label:"I0"},{param:"sum_I",label:"sum_I",color:"#00FF00",data:c.sum_I,std:d},{param:"Rg",label:"Rg",color:"#21610B",data:c.Rg,std:c.Rg_Stdev},{param:"Mass",data:c.mass,std:c.mass_Stdev,color:"#FF9900",label:"Mass"},{param:"Vc",data:c.Vc,std:c.Vc_Stdev,color:"#990099",label:"Vc"},{param:"Qr",data:c.Qr,std:c.Qr_Stdev,color:"#FF0066",label:"Qr"},{param:"quality",label:"quality",color:"#FF00FF",data:c.quality,std:d}],b.hplcGraph.loadData(c)};EXI.getDataAdapter({onSuccess:c}).saxs.hplc.getHPLCOverviewByExperimentId(a)},HPLCMainView.prototype.load=function(a){var b=this;this.experimentId=a,this.grid.panel.setLoading();var c=function(a,c){b.grid.load(c),b.grid.panel.setLoading(!1)};EXI.getDataAdapter({onSuccess:c}).saxs.dataCollection.getDataCollectionsByExperimentId(a),this.loadHPLCGraph(a)},MacromoleculeMainView.prototype.getPanel=MainView.prototype.getPanel,MacromoleculeMainView.prototype.getHeader=function(a,b){return"<span class='item'>"+a+"</span><span class='item_description'>"+b+"</span>"},MacromoleculeMainView.prototype.getSelected=function(){for(var a=[],b=0;b<this.queueGridList.length;b++)a=this.queueGridList[b].getSelected().concat(a);return a},MacromoleculeMainView.prototype.getTabs=function(){return Ext.createWidget("tabpanel",{plain:!0,items:[{tabConfig:{title:"General"},items:[{xtype:"container",layout:"fit",height:600,padding:0,items:[this.macromoleculeForm.getPanel()]}]},{tabConfig:{title:"Advanced"},items:[{xtype:"container",layout:"fit",height:500,padding:0,items:[this.rigidBodyModelingForm.getPanel()]}]}]})},MacromoleculeMainView.prototype.getContainer=function(){return Ext.create("Ext.container.Container",{layout:{type:"anchor"},defaults:{anchor:"100%",hideEmptyLabel:!1},margin:30,bodyStyle:{"background-color":"#E6E6E6"},items:[this.getTabs()]})},MacromoleculeMainView.prototype.load=function(a){this.panel.setLoading();var b=EXI.proposalManager.getMacromoleculeById(a);this.panel.setTitle(b.acronym),this.macromoleculeForm.load(b),this.rigidBodyModelingForm.load(b),this.panel.setLoading(!1)},MacromoleculeWelcomeMainView.prototype.getPanel=MainView.prototype.getPanel,MacromoleculeWelcomeMainView.prototype.getContainer=MainView.prototype.getContainer,MacromoleculeWelcomeMainView.prototype.getOptions=function(){var a="<ul><li>Define beforehand an experiment</li>";return a+="<li>Send your samples by courier</li>",a+="<li>Online data analysis to run apriori data analysis (PDB information will be required on the advanced tab in the macromolecule view)</li>",a+"</ul>"},MacromoleculeWelcomeMainView.prototype.getContainer=function(){return Ext.createWidget("panel",{plain:!0,margin:"10",layout:"fit",items:[{tabConfig:{title:"Welcome"},items:[{xtype:"container",layout:"fit",padding:20,margin:0,cls:"border-grid",items:[{html:'<div class="landing-title" ><h2>Macromolecules on ISPyB</h2></div>'},{html:'<div class="landing-text">A macromolecule is a biological contruct for investigation.</div><br/>',margin:"0 0 0 20"},{html:'<div class="landing-text">You should define a macromolecule on ISPyB if you want:</div>',margin:"0 0 0 20"},{html:this.getOptions(),margin:"0 0 0 40"},{html:'<br/><div class="landing-text">If your macromolecule is not in the list showed on the left you can create a new one</div><br/>',margin:"0 0 0 20"},{xtype:"container",layout:"hbox",cls:"option-bar-menu",items:[{xtype:"button",cls:"square-option",maxWidth:200,minWidth:200,margin:"0 0 0 150",height:100,text:'<div class="square-option-text"; >Add a new macromolecule</div>',icon:"../images/icon/add.png",iconAlign:"top",handler:function(){location.hash="/macromolecule/add"}}]}]}]}]})},MacromoleculeWelcomeMainView.prototype.load=function(){},MergeMainView.prototype.getPanel=MainView.prototype.getPanel,MergeMainView.prototype.getContainer=MainView.prototype.getContainer,MergeMainView.prototype.populateForm=function(a,b){for(var c=0;c<this.frames.length;c++)this.editorPanel.add(this.getCurveContainer(this.frames[c].subtractionId,this.frames[c].fileName,0,5,this.frames[c].scale,a,b))},MergeMainView.prototype.getSelected=function(){for(var a=[],b=0;b<this.queueGridList.length;b++)a=this.queueGridList[b].getSelected().concat(a);return a},MergeMainView.prototype.getCurveContainer=function(a,b,c,d,e,f,g){var h=this;return Ext.create("Ext.Panel",{width:380,layout:"vbox",border:1,style:{borderStyle:"solid",borderWidth:"1px"},margin:"10 0 0 5",items:[{xtype:"container",margin:"0 0 0 0",layout:"hbox",items:[{xtype:"container",layout:"vbox",items:[{html:'<span style="font-size:12px;color:'+g[b]+';">'+b+"</span>",margin:"10 0 0 10"},{xtype:"sliderfield",margin:"10 0 0 2",hideLabel:!0,width:275,minValue:0,subtractionId:a,id:"slider"+a,maxValue:f,increment:1,values:[0,f],listeners:{changecomplete:function(a,b,c,d){for(var e=a.getValues(),f=0;f<h.frames.length;f++)h.frames[f].subtractionId==a.subtractionId&&(h.frames[f].from=h.plotter.dygraph.getValue(e[0]-1,0),h.frames[f].to=h.plotter.dygraph.getValue(e[1]-1,0));h.updateCurve()}}}]},{xtype:"container",layout:"vbox",items:[{xtype:"container",layout:"hbox",items:[{xtype:"button",text:"<",width:30,margin:"2 0 0 10",subtractionId:a,handler:function(a){var b="slider"+a.subtractionId;Ext.getCmp(b).setValue(0,Ext.getCmp(b).getValues()[0]-1);for(var c=Ext.getCmp(b).getValues(),d=0;d<h.frames.length;d++)h.frames[d].subtractionId==a.subtractionId&&(h.frames[d].from=h.plotter.dygraph.getValue(c[0]-1,0));h.updateCurve()}},{xtype:"button",text:">",width:30,margin:"2 0 0 5",subtractionId:a,handler:function(a){var b="slider"+a.subtractionId;Ext.getCmp(b).setValue(1,Ext.getCmp(b).getValues()[1]+1);for(var c=Ext.getCmp(b).getValues(),d=0;d<h.frames.length;d++)h.frames[d].subtractionId==a.subtractionId&&(h.frames[d].to=h.plotter.dygraph.getValue(c[1]-1,0));h.updateCurve()}}]},{xtype:"container",layout:"hbox",margin:"2 0 2 0",items:[{xtype:"button",text:"+",margin:"0 0 0 10",width:30,subtractionId:a,handler:function(a){for(var b=0;b<h.frames.length;b++)console.log(a.subtractionId),h.frames[b].subtractionId==a.subtractionId&&(h.frames[b].scale=h.frames[b].scale+.1);h.updateCurve()}},{xtype:"button",text:"-",width:30,margin:"0 0 0 5",subtractionId:a,handler:function(a){for(var b=0;b<h.frames.length;b++)h.frames[b].subtractionId==a.subtractionId&&(h.frames[b].scale=h.frames[b].scale-.1);h.updateCurve()}}]}]}]}]})},MergeMainView.prototype.getSubtractionEditor=function(){var a=this;return this.editorPanel=Ext.create("Ext.Panel",{border:1,height:600,width:400,layout:"vbox",scrollable:!0,style:{borderColor:"#000000",borderStyle:"solid",borderWidth:"1px"},items:[],bbar:[{text:"Download",xtype:"button",handler:function(b){var c=a.getParams();window.open((new DataAdapter).getMergeURL(c.subtractionIds.toString(),c.from.toString(),c.to.toString(),c.scale.toString()))}}]}),this.editorPanel},MergeMainView.prototype.getParams=function(){for(var a=[],b=[],c=[],d=[],e=0;e<this.frames.length;e++){var f=this.frames[e];null!=f.from?a.push(f.from):a.push(""),null!=f.to?b.push(f.to):b.push(""),null!=f.scale?c.push(f.scale):c.push(""),null!=f.subtractionId?d.push(f.subtractionId):d.push("")}return{from:a,to:b,scale:c,subtractionIds:d}},MergeMainView.prototype.updateCurve=function(){this.xAxisRange=this.plotter.dygraph.xAxisRange(),this.yAxisRange=this.plotter.dygraph.yAxisRange();var a=this.getParams();this.plotter.loadMerge(a.subtractionIds.toString(),a.from.toString(),a.to.toString(),a.scale.toString()),this.plotter.dygraph.updateOptions({dateWindow:this.xAxisRange,valueRange:this.yAxisRange})},MergeMainView.prototype.getSlavePanel=function(){return{xtype:"container",layout:"hbox",cls:"defaultGridPanel",border:0,defaults:{xtype:"container",height:600},items:[this.getSubtractionEditor(),this.plotter.getPanel()]}},MergeMainView.prototype.load=function(a){var b=new QueueGrid({maxHeight:300});this.panel.setTitle("Merge Tool"),this.container.insert(0,b.getPanel()),this.container.insert(1,this.getSlavePanel()),b.load(a),b.panel.setLoading(!1);var c=[],d=[],e=[];this.frames=[];for(var f=0;f<a.length;f++)c.push(a[f].dataCollectionId),null==e[a[f].subtractionId]&&(d.push(a[f].subtractionId),this.frames.push({fileName:a[f].substractedFilePath.substr(a[f].substractedFilePath.lastIndexOf("/")+1),subtractionId:a[f].subtractionId,scale:1}),e[a[f].subtractionId]=!0);this.plotter.load({subtracted:d})},PrimaryDataMainView.prototype.getPanel=MainView.prototype.getPanel,PrimaryDataMainView.prototype.getSlavePanel=function(){return{xtype:"container",layout:"hbox",cls:"defaultGridPanel",margin:5,border:0,defaults:{height:600},items:[{xtype:"panel",layout:{type:"accordion",titleCollapse:!1,animate:!0,activeOnTop:!0},flex:.3,border:1,style:{borderColor:"#000000",borderStyle:"solid",borderWidth:"1px"},items:[this.frameSelectorGrid.getPanel()]},this.plotter.getPanel()]}},PrimaryDataMainView.prototype.getContainer=function(){return Ext.createWidget("tabpanel",{plain:!0,height:900,margin:"10 0 0 0",items:[{tabConfig:{title:"Primary Data Reduction"},items:[{xtype:"container",layout:"fit",height:850,padding:20,style:{borderColor:"gray",borderStyle:"solid",borderWidth:"1px","background-color":"white"},items:[{xtype:"container",items:[this.grid.getPanel(),this.getSlavePanel()]}]}]},{tabConfig:{title:"Abinitio Modeling"},items:[{xtype:"container",layout:"fit",height:850,padding:20,style:{borderColor:"gray",borderStyle:"solid",borderWidth:"1px","background-color":"white"},items:[{xtype:"container",items:[this.abinitioForm.getPanel()]}]}]}]})},PrimaryDataMainView.prototype.load=function(a){var b=this;this.panel.setTitle(" Data Collection"),this.grid.panel.setLoading();for(var c=function(a,c){if(b.grid.load(c),b.grid.panel.setLoading(!1),b.frameSelectorGrid.load(c),c[0].subtractionId){var d=function(a,c){b.abinitioForm.load(c)};EXI.getDataAdapter({onSuccess:d}).saxs.subtraction.getSubtractionsBySubtractionIdList([c[0].subtractionId])}},d=[],e=0;e<a.length;e++)d.push(a[e].dataCollectionId);EXI.getDataAdapter({onSuccess:c}).saxs.dataCollection.getDataCollectionsByDataCollectionId(d)},ShippingMainView.prototype.getPanel=MainView.prototype.getPanel,ShippingMainView.prototype.getContainer=function(){return this.tabPanel=Ext.createWidget("tabpanel",{margin:10,defaults:{anchor:"100%"},items:[{tabConfig:{title:"Delivery Details"},items:[this.shipmentForm.getPanel()]},{tabConfig:{id:this.id+"grid",title:"Parcels",icon:"../images/icon/shipping.png"},items:[this.caseGrid.getPanel()]}]}),this.tabPanel},ShippingMainView.prototype.load=function(a){this.shippingId=a,null==a&&Ext.getCmp(this.id+"grid").disable(!0),this.panel.setTitle("Shipment");var b=this;if(null!=a){this.panel.setLoading();var c=function(a,c){b.shipmentForm.load(c),b.caseGrid.load(c),b.panel.setLoading(!1)};EXI.getDataAdapter({onSuccess:c}).proposal.shipping.getShipment(a)}},ShippingWelcomeMainView.prototype.getPanel=MainView.prototype.getPanel,ShippingWelcomeMainView.prototype.getContainer=MainView.prototype.getContainer,ShippingWelcomeMainView.prototype.getContainer=function(){return Ext.createWidget("panel",{plain:!0,margin:"10",layout:"fit",items:[{tabConfig:{title:"Welcome"},items:[{xtype:"container",layout:"fit",padding:20,margin:0,cls:"border-grid",items:[{html:'<div class="landing-title" ><h2>Shipments</h2></div>'},{html:'<div class="landing-text"> A Shipment consists of a set of Dewars which is sent from your home lab to the synchrotron via a courier company. Each dry shipping Dewar within the shipment is identified by a label (barcode or sticker). The dewars(s) contains a set of Containers (Pucks or canes). Containers (typically Pucks), contain Samples. A Sample (Sample Holder) contains the Crystal</div><br/>',margin:"0 0 0 20"},{html:'<br/><div class="landing-text">Do you want to ship your samples to the beamline?</div><br/>',margin:"0 0 0 20"},{xtype:"container",layout:"hbox",cls:"option-bar-menu",items:[{xtype:"button",cls:"square-option",maxWidth:200,minWidth:200,margin:"0 0 0 150",height:100,text:'<div class="square-option-text"; >Create a new Shipment</div>',icon:"../images/icon/add.png",iconAlign:"top",handler:function(){location.hash="/shipping/main"}}]}]}]}]})},ShippingWelcomeMainView.prototype.load=function(){},StockSolutionMainView.prototype.getPanel=MainView.prototype.getPanel,StockSolutionMainView.prototype.getContainer=function(){return Ext.create("Ext.container.Container",{layout:{type:"anchor"},defaults:{anchor:"100%",hideEmptyLabel:!1},margin:30,bodyStyle:{"background-color":"#E6E6E6"},items:[this.stockSolutionForm.getPanel([])]})},StockSolutionMainView.prototype.load=function(a){this.stockSolutionId=a,this.stockSolutionForm.load(EXI.proposalManager.getStockSolutionById(a)),this.panel.setTitle("Stock Solutions")},StockSolutionWelcomeMainView.prototype.getPanel=MainView.prototype.getPanel,StockSolutionWelcomeMainView.prototype.getContainer=MainView.prototype.getContainer,StockSolutionWelcomeMainView.prototype.getOptions=function(){var a="<ul><li>Define beforehand an experiment</li>";return a+="<li>Send your samples by courier</li>",a+"</ul>"},StockSolutionWelcomeMainView.prototype.getContainer=function(){return Ext.createWidget("panel",{plain:!0,margin:"20",layout:"fit",items:[{tabConfig:{title:"Welcome"},items:[{xtype:"container",layout:"fit",padding:10,margin:0,cls:"border-grid",items:[{html:'<div class="landing-title" ><h2>Stock Solutions on ISPyB</h2></div>',margin:"0 0 0 20"},{html:'<div class="landing-text">A buffer is the matched solution which in a sample is suspended</div><br/>',margin:"0 0 0 40"},{html:'<div class="landing-text">You should define a macromolecule on ISPyB if you want:</div>',margin:"0 0 0 40"},{html:this.getOptions(),margin:"0 0 0 40"},{html:'<br/><div class="landing-text">If your macromolecule is not in the list showed on the left you can create a new one</div><br/>',margin:"0 0 0 20"},{xtype:"container",layout:"hbox",cls:"option-bar-menu",items:[{xtype:"button",cls:"square-option",maxWidth:200,minWidth:200,margin:"0 0 0 150",height:100,text:'<div class="square-option-text"; >Add a new Stock Solution</div>',icon:"../images/icon/add.png",iconAlign:"top",handler:function(){location.hash="/stocksolution/add"}}]}]}]}]})},StockSolutionWelcomeMainView.prototype.load=function(){},TemplateMainView.prototype.getPanel=MainView.prototype.getPanel,TemplateMainView.prototype.getHeader=function(a,b){return"<span class='item'>"+a+"</span><span class='item_description'>"+b+"</span>"},TemplateMainView.prototype.getSelected=function(){for(var a=[],b=0;b<this.queueGridList.length;b++)a=this.queueGridList[b].getSelected().concat(a);return a},TemplateMainView.prototype.getTabs=function(){return Ext.createWidget("tabpanel",{plain:!0,margin:"20 0 0 0",items:[{tabConfig:{title:"Measurements"},items:[{xtype:"container",layout:"fit",height:700,padding:20,style:{borderColor:"gray",borderStyle:"solid",borderWidth:"1px","background-color":"white"},items:[this.measurementGrid.getPanel()]}]},{tabConfig:{title:"Sample Plate Setup"},items:[{xtype:"container",layout:"vbox",height:700,padding:20,style:{borderColor:"gray",borderStyle:"solid",borderWidth:"1px","background-color":"white"},items:[this.specimenWidget.getPanel()]}]},{tabConfig:{title:"Sample Requirements"},items:[{xtype:"container",layout:"fit",height:700,padding:20,style:{borderColor:"gray",borderStyle:"solid",borderWidth:"1px","background-color":"white"},items:[this.volumePlanificator.getPanel()]}]}]})},TemplateMainView.prototype.getContainer=function(){return Ext.create("Ext.container.Container",{layout:{type:"anchor"},defaults:{anchor:"100%",hideEmptyLabel:!1},margin:30,bodyStyle:{"background-color":"#E6E6E6"},items:[this.experimentHeaderForm.getPanel(),this.getTabs()]})},TemplateMainView.prototype.load=function(a){var b=this;b.panel.setLoading();var c=function(a,c){b.experiment=new Experiment(c[0]),b.experimentHeaderForm.load(b.experiment),b.measurementGrid.loadExperiment(b.experiment),b.specimenWidget.refresh(b.experiment),b.volumePlanificator.load(b.experiment),b.panel.setLoading(!1)};EXI.getDataAdapter({onSuccess:c}).saxs.experiment.getExperimentById(a[0].experimentId),this.panel.setTitle("Template")},AbinitioForm.prototype._renderPDB=function(a){try{for(var b=[],c=0;c<a.length;c++)b.push({modelId:a[c],color:new THREE.Color(16737792),opacity:.8});this.viewer.refresh(b)}catch(d){console.log(d)}},AbinitioForm.prototype.getPanel=function(){return this.panel=Ext.create("Ext.panel.Panel",{width:this.width,cls:"border-grid",layout:"hbox",height:this.height,margin:5,border:1,defaultType:"textfield",items:[{xtype:"container",layout:"vbox",items:[this.abinitioGrid.getPanel()]},{xtype:"container",layout:"vbox",items:[{xtype:"container",layout:"fit",height:300,margin:"10 0 0 0",width:500,items:[this.curvePlotter.getPanel()]},this.viewer.getPanel()]}]}),this.panel},AbinitioForm.prototype.load=function(a){this.subtractions=a,this.abinitioGrid.refresh(a)},AbinitioGrid.prototype.refresh=function(a){this.store.loadData(this._prepareData(a))},AbinitioGrid.prototype._prepareData=function(a){for(var b=[],c=0;c<a.length;c++)for(var d=a[c],e=0;e<d.substractionToAbInitioModel3VOs.length;e++){var f=d.substractionToAbInitioModel3VOs[e].abinitiomodel3VO;if(null!=f.averagedModel&&(b.push(f.averagedModel),b[b.length-1].type="Reference"),null!=f.shapeDeterminationModel&&(b.push(f.shapeDeterminationModel),b[b.length-1].type="Refined"),null!=f.modelList3VO&&null!=f.modelList3VO.modeltolist3VOs)for(var g=0;g<f.modelList3VO.modeltolist3VOs.length;g++)b.push(f.modelList3VO.modeltolist3VOs[g].model3VO),b[b.length-1].type="Model"}return b},AbinitioGrid.prototype.getPanel=function(){var a=this,b=["modelId","type","chiSqrt","dmax","firFile","logFile","fitFile","pdbFile","rfactor","rg","volume"];Ext.define("AbinitioModel",{extend:"Ext.data.Model",fields:b}),this.store=Ext.create("Ext.data.Store",{model:"AbinitioModel",autoload:!0,groupField:"type"});var c=Ext.create("Ext.grid.feature.Grouping",{groupHeaderTpl:'{name} ({rows.length} model{[values.rows.length > 1 ? "s" : ""]})',startCollapsed:!1,collapsible:!0}),d=Ext.create("Ext.selection.RowModel",{allowDeselect:!0,listeners:{selectionchange:function(b,c){c.length>0&&a.onSelected.notify([c[0].data])}}});return this.grid=Ext.create("Ext.grid.Panel",{collapsible:!1,resizable:!0,selModel:d,features:[c],autoscroll:!0,multiSelect:!0,store:this.store,cls:"border-grid",height:this.height,width:this.width,margin:10,columns:[{text:"Type",dataindex:"type",hidden:!0,renderer:function(a,b,c){return c.data.type},flex:1},{text:"ModelId",dataindex:"modelId",hidden:!0,renderer:function(a,b,c){return c.data.modelId},flex:1},{text:"chiSqrt",dataindex:"chiSqrt",renderer:function(a,b,c){return null!=c.data.dmax?BUI.formatValuesUnits(c.data.chiSqrt,"",12,this.decimals):void 0},flex:1},{text:"Dmax",dataindex:"dmax",renderer:function(a,b,c){return null!=c.data.dmax?BUI.formatValuesUnits(c.data.dmax,"nm",12,this.decimals):void 0},flex:1},{text:"rFactor",dataindex:"rfactor",hidden:!0,renderer:function(a,b,c){return null!=c.data.rfactor?c.data.rfactor:void 0},flex:1},{text:"Rg",dataindex:"rg",renderer:function(a,b,c){return null!=c.data.rg?BUI.formatValuesUnits(c.data.rg,"nm",12,this.decimals):void 0},flex:1},{text:"Volume",dataindex:"volume",renderer:function(a,b,c){return null!=c.data.volume?BUI.formatValuesUnits(c.data.volume,"")+"<span style='font-size:8px;color:gray;'> nm<sub>3</sub></span>":void 0},flex:1},{text:"PDB",dataindex:"pdbFile",renderer:function(a,b,c){return null!=c.data.pdbFile?c.data.pdbFile.split("/")[c.data.pdbFile.split("/").length-1]:void 0},flex:1},{text:"Fir",dataindex:"firFile",renderer:function(a,b,c){return null!=c.data.firFile?c.data.firFile.split("/")[c.data.firFile.split("/").length-1]:void 0},flex:1},{text:"LOG",dataindex:"logFile",hidden:!0,renderer:function(a,b,c){return null!=c.data.logFile?c.data.logFile.split("/")[c.data.logFile.split("/").length-1]:void 0},flex:1}],viewConfig:{enableTextSelection:!0,preserveScrollOnRefresh:!0,stripeRows:!0,listeners:{}}}),this.grid},AddressForm.prototype.getAddress=function(){return null==this.address&&(this.address={}),this.address.billingReference=Ext.getCmp(this.id+"billingReference").getValue(),this.address.cardName=Ext.getCmp(this.id+"cardName").getValue(),this.address.courierAccount=Ext.getCmp(this.id+"courierAccount").getValue(),this.address.defaultCourrierCompany=Ext.getCmp(this.id+"courrierCompany").getValue(),this.address.dewarAvgCustomsValue=Ext.getCmp(this.id+"dewarAvgCustomsValue").getValue(),this.address.dewarAvgTransportValue=Ext.getCmp(this.id+"dewarAvgTransportValue").getValue(),null==this.address.personVO&&(this.address.personVO={}),this.address.personVO.emailAddress=Ext.getCmp(this.id+"emailAddress").getValue(),this.address.personVO.familyName=Ext.getCmp(this.id+"familyName").getValue(),this.address.personVO.givenName=Ext.getCmp(this.id+"name").getValue(),this.address.personVO.faxNumber=Ext.getCmp(this.id+"faxNumber").getValue(),this.address.personVO.phoneNumber=Ext.getCmp(this.id+"phoneNumber").getValue(),this.address},AddressForm.prototype._loadPerson=function(a,b,c,d,e){Ext.getCmp(this.id+"emailAddress").setValue(c),Ext.getCmp(this.id+"familyName").setValue(b),Ext.getCmp(this.id+"name").setValue(a),Ext.getCmp(this.id+"faxNumber").setValue(d),Ext.getCmp(this.id+"phoneNumber").setValue(e)},AddressForm.prototype.load=function(a){this.address=a,null!=a&&(Ext.getCmp(this.id+"cardName").setValue(a.cardName),Ext.getCmp(this.id+"courrierCompany").setValue(a.defaultCourrierCompany),Ext.getCmp(this.id+"dewarAvgCustomsValue").setValue(a.dewarAvgCustomsValue),Ext.getCmp(this.id+"dewarAvgTransportValue").setValue(a.dewarAvgTransportValue),Ext.getCmp(this.id+"courierAccount").setValue(a.courierAccount),Ext.getCmp(this.id+"billingReference").setValue(a.billingReference),null!=a.personVO&&this._loadPerson(a.personVO.givenName,a.personVO.familyName,a.personVO.emailAddress,a.personVO.faxNumber,a.personVO.phoneNumber))},AddressForm.prototype.getPersonPanel=function(){return this.personPanel=Ext.create("Ext.panel.Panel",{layout:"vbox",margin:"10",items:[{padding:10,xtype:"container",layout:"hbox",border:!1,items:[{xtype:"requiredtextfield",id:this.id+"name",fieldLabel:"Name",labelWidth:75,margin:"0 0 0 10",disabled:!0,width:200},{xtype:"requiredtextfield",id:this.id+"familyName",fieldLabel:"Surname",labelWidth:75,disabled:!0,margin:"0 0 0 10",width:200},{xtype:"requiredtextfield",id:this.id+"emailAddress",fieldLabel:"Email",labelWidth:75,margin:"0 0 0 10",width:300},{id:this.id+"phoneNumber",fieldLabel:"Phone",xtype:"textfield",labelWidth:75,margin:"0 0 0 10",width:220},{id:this.id+"faxNumber",fieldLabel:"Fax",xtype:"textfield",labelWidth:75,margin:"0 0 0 10",width:220}]},{padding:10,xtype:"container",layout:"hbox",border:!1,items:[{xtype:"requiredtextfield",id:this.id+"cardName",fieldLabel:"Card Name",name:"CardName",labelWidth:150,margin:"0 0 0 10",width:300},{xtype:"requiredtextfield",id:this.id+"courierAccount",fieldLabel:"Courier Account",margin:"0 0 0 30",labelWidth:150,width:300},{xtype:"requiredtextfield",id:this.id+"courrierCompany",fieldLabel:"Courier Company",margin:"0 0 0 30",labelWidth:150,width:300}]},{padding:10,xtype:"container",layout:"hbox",border:!1,items:[{id:this.id+"dewarAvgCustomsValue",fieldLabel:"Average Custom Value",xtype:"numberfield",margin:"0 0 0 10",minValue:0,maxValue:15,labelWidth:150,width:300},{id:this.id+"dewarAvgTransportValue",fieldLabel:"Average Transport Value",xtype:"numberfield",margin:"0 0 0 30",minValue:0,maxValue:15,labelWidth:150,width:300},{id:this.id+"billingReference",xtype:"textfield",fieldLabel:"Billing Reference",margin:"0 0 0 30",labelWidth:150,width:300}]}]}),this.personPanel},AddressForm.prototype.getPackagePanel=function(){return this.packagePanel=Ext.create("Ext.panel.Panel",{layout:"hbox",items:[{padding:10,xtype:"container",layout:"vbox",border:!1,items:[{xtype:"container",layout:"hbox",items:[]},{xtype:"container",layout:"hbox",margin:"10 0 0 0",items:[]}]}]}),this.packagePanel},AddressForm.prototype.getPanel=function(){return this.panel=Ext.create("Ext.panel.Panel",{hidden:this.isHidden,layout:"vbox",title:"Shipping Address Card",cls:"border-grid",buttons:this.getToolBar(),icon:"../images/icon/ic_email_black_24dp.png",items:[this.getPersonPanel()]}),this.panel},AddressForm.prototype.save=function(){
var a=this;a.panel.setLoading();var b=function(b){a.panel.setLoading(!1),EXI.getDataAdapter().proposal.proposal.update()};EXI.getDataAdapter({onSuccess:b}).proposal.labcontacts.saveLabContact(a.getAddress())},AddressForm.prototype.getToolBar=function(){var a=this;return[{text:"Save",hidden:a.isSaveButtonHidden,width:100,handler:function(){a.save()}}]},AprioriRigidBodyGrid.prototype._getColumns=function(){},AprioriRigidBodyGrid.prototype._getTopButtons=function(){var a=this,b=[];return b.push(Ext.create("Ext.Action",{icon:"../images/add.png",text:"Add",disabled:!1,handler:function(b,c){a.onAddButtonClicked.notify()}})),b},AprioriRigidBodyGrid.prototype.load=function(a){this.macromolecule=a,null!=a&&this.pdbStore.loadData(a.structure3VOs)},AprioriRigidBodyGrid.prototype._prepareData=function(){for(var a=[],b=0;b<this.features.length;b++)a.push(this.features[b]);return a},AprioriRigidBodyGrid.prototype._updateProposalInformation=function(){EXI.proposalManager.get(!0),this.load(EXI.proposalManager.getMacromoleculeById(this.macromolecule.macromoleculeId)),this.panel.setLoading(!1)},AprioriRigidBodyGrid.prototype._getPlugins=function(){var a=this,b=[];return b.push(Ext.create("Ext.grid.plugin.RowEditing",{clicksToEdit:1,listeners:{validateedit:function(b,c){var d=c.newValues.multiplicity,e=c.newValues.symmetry,f=c.record.data.macromoleculeId,g=c.record.data.structureId;a.panel.setLoading();var h=function(){a._updateProposalInformation()},i=function(b){BUI.showError("Ops, there was a problem"),a._updateProposalInformation()};a.panel.setLoading(),EXI.getDataAdapter({onSuccess:h,onError:i}).saxs.macromolecule.saveStructure(f,g,d,e)}}})),b},AprioriRigidBodyGrid.prototype.getPanel=function(){var a=this;return this.pdbStore=Ext.create("Ext.data.Store",{fields:["filePath","structureId","structureType","symmetry","structureId","name","multiplicity"],groupField:"structureType",sorters:{property:"structureId",direction:"DESC"}}),this.panel=Ext.create("Ext.grid.Panel",{margin:"15 10 0 10",height:this.height,store:this.pdbStore,plugins:a._getPlugins(),cls:"border-grid",tbar:[{text:"Add Modeling Option (PDB)",icon:"../images/icon/add.png",handler:function(){a.onUploadFile.notify("PDB","Upload PDB File")}}],columns:[{text:"structureId",flex:.2,hidden:!0,dataIndex:"structureId",sortable:!0},{text:"File",flex:1,dataIndex:"filePath",sortable:!0,hidden:!0},{text:"PDB",flex:.4,dataIndex:"name",sortable:!0},{text:"Symmetry",flex:.2,dataIndex:"symmetry",sortable:!0,editor:{xtype:"combobox",typeAhead:!0,triggerAction:"all",selectOnTab:!0,store:[["P1","P1"],["P2","P2"],["P3","P3"],["P4","P4"],["P5","P5"],["P6","P6"],["P32","P32"],["P42","P42"],["P52","P52"],["P62","P62"],["P222","P222"]]}},{text:"Multiplicity",flex:.2,dataIndex:"multiplicity",sortable:!0,editor:{xtype:"textfield"}},{text:"Subunit",flex:.2,dataIndex:"isSubunit",sortable:!0,hidden:!0},{text:"Type",flex:.2,dataIndex:"structureType",sortable:!0,hidden:!0},{xtype:"actioncolumn",flex:.1,text:"Remove",editor:{xtype:"textfield"},items:[{icon:"../images/icon/ic_delete_black_24dp.png",tooltip:"Remove",handler:function(b,c,d){function e(b){if("yes"==b){var c=function(){a._updateProposalInformation()},d=function(){BUI.showWarning("ISPyB could not remove this structure. Have it been already used?"),a._updateProposalInformation()};a.panel.setLoading(),EXI.getDataAdapter({onSuccess:c,onError:d}).saxs.macromolecule.removeStructure(h,g)}}var f=b.getStore().getAt(c),g=f.data.structureId,h=f.data.macromoleculeId;Ext.MessageBox.show({title:"Warning",fn:e,msg:"You are removing a PDB structure option. <br />Sure?",buttons:Ext.MessageBox.YESNO,icon:Ext.MessageBox.QUESTION})}}]}],listeners:{beforeedit:function(a,b,c){return"actioncolumn"!=b.column.xtype}}}),this.panel},AssemblyForm.prototype._getItems=function(){return[{xtype:"label",forId:"myFieldId",text:"List of previously defined macromolecules present in the assembly. This information will be used for additional cross-checks where possible",margin:"15 0 20 10",cls:"inline-help"},this.molarityGrid.getPanel()]},AssemblyForm.prototype._getButtons=function(){return[]},AssemblyForm.prototype.getPanel=function(){return this.panel=Ext.create("Ext.form.Panel",{width:this.width,height:this.height,margin:10,border:0,defaultType:"textfield",items:this._getItems(),buttons:this._getButtons()}),this.panel},AssemblyForm.prototype.refresh=function(a){this.macromolecule=a,this.molarityGrid.refresh(a)},AssemblyForm.prototype.input=function(){return{}},AssemblyForm.prototype.test=function(a){var b=new AssemblyForm,c=b.getPanel();c.render(a)},BufferForm.prototype.getBuffer=function(){return null==this.buffer&&(this.buffer={}),this.buffer.name=Ext.getCmp(this.id+"buffer_name").getValue(),this.buffer.acronym=Ext.getCmp(this.id+"buffer_acronym").getValue(),this.buffer.comments=Ext.getCmp(this.id+"buffer_comments").getValue(),this.buffer.ph=Ext.getCmp(this.id+"buffer_ph").getValue(),this.buffer.composition=Ext.getCmp(this.id+"buffer_composition").getValue(),this.buffer.proposalId=Ext.getCmp(this.id+"proposalIdCombo").getValue(),this.buffer},BufferForm.prototype.load=function(a){this.buffer=a,null!=a&&(Ext.getCmp(this.id+"buffer_name").setValue(this.buffer.name),Ext.getCmp(this.id+"buffer_acronym").setValue(this.buffer.acronym),Ext.getCmp(this.id+"buffer_comments").setValue(this.buffer.comments),Ext.getCmp(this.id+"buffer_ph").setValue(this.buffer.ph),Ext.getCmp(this.id+"buffer_composition").setValue(this.buffer.composition)),null!=this.buffer&&null!=this.buffer.proposalId&&(Ext.getCmp(this.id+"proposalIdCombo").setValue(this.buffer.proposalId),Ext.getCmp(this.id+"proposalIdCombo").disable())},BufferForm.prototype._getTopPanel=function(){return{xtype:"container",layout:"hbox",border:0,margin:"40 0 0 0",frame:!0,items:[{xtype:"container",layout:"hbox",items:[{xtype:"container",flex:1,border:!1,layout:"anchor",items:[{xtype:"requiredtextfield",id:this.id+"buffer_name",fieldLabel:"Name",name:"name",width:300},{xtype:"requiredtextfield",id:this.id+"buffer_acronym",fieldLabel:"Acronym",maskRe:/[a-zA-Z0-9]+/,name:"acronym",width:300}]}]},{xtype:"container",flex:1,layout:"anchor",defaultType:"textfield",margin:"0 0 0 10",items:[{id:this.id+"buffer_ph",fieldLabel:"pH",name:"ph",xtype:"numberfield",width:300,minValue:0,maxValue:15},{fieldLabel:"Composition",id:this.id+"buffer_composition",name:"composition",width:300}]}]}},BufferForm.prototype.getToolBar=function(){var a=this;return[{text:"Save",width:100,handler:function(){a.panel.setLoading();var b=function(b){a.panel.setLoading(!1),EXI.getDataAdapter().proposal.proposal.update()};EXI.getDataAdapter({onSuccess:b}).saxs.buffer.saveBuffer(a.getBuffer())}}]},BufferForm.prototype.getPanel=function(){var a=this;return this.panel=Ext.create("Ext.panel.Panel",{layout:"vbox",buttons:this.getToolBar(),cls:"border-grid",items:[{xtype:"container",margin:"10 0 0 20",layout:"vbox",items:[BIOSAXS_COMBOMANAGER.getComboProposal({id:a.id+"proposalIdCombo",labelWidth:100}),this._getTopPanel(),{id:this.id+"buffer_comments",xtype:"textareafield",name:"comments",fieldLabel:"Comments",width:600,height:80}]}]}),this.panel},BufferGrid.prototype._edit=function(a){function b(){return[{text:"Save",handler:function(){var a=function(a){var b=function(a,b){c.window.close(),c.onUpdated.notify(),c.panel.setLoading(!1)};c.panel.setLoading("Updading proposal information"),EXI.getDataAdapter({onSuccess:b}).proposal.proposal.update()};return""==c.bufferForm.getBuffer().name?void BUI.showWarning("Name field is mandatory"):""==c.bufferForm.getBuffer().acronym?void BUI.showWarning("Acronym field is mandatory"):""==c.bufferForm.getBuffer().proposalId||null==c.bufferForm.getBuffer().proposalId?void BUI.showWarning("Proposal field is mandatory"):void EXI.getDataAdapter({onSuccess:a}).saxs.buffer.saveBuffer(c.bufferForm.getBuffer())}},{text:"Cancel",handler:function(){c.window.close()}}]}var c=this;this.bufferForm=new BufferForm({height:400,width:700}),this.window=Ext.create("Ext.window.Window",{title:"Edit buffer",layout:"fit",items:this.bufferForm.getPanel(),buttons:b()}).show(),this.bufferForm.load(this.getBufferById(a))},BufferGrid.prototype.getBufferById=function(a){for(var b=0;b<this.buffers.length;b++)if(this.buffers[b].bufferId==a)return this.buffers[b];return{}},BufferGrid.prototype.load=function(a){this.buffers=a,this.proposalKey={},this.proposalColor={};for(var b=0;b<a.length;b++){var c=EXI.proposalManager.getProposalById(a[b].proposalId);a[b].proposal=c.code+c.number}this.store.loadData(a,!1)},BufferGrid.prototype._getTbar=function(){var a=this,b=[];return b.push(Ext.create("Ext.Action",{text:"Add",icon:"images/icon/add.png",disabled:!1,handler:function(b,c){a._edit()}})),b},BufferGrid.prototype.getPanel=function(){var a=this;this.store=Ext.create("Ext.data.Store",{fields:["proposal","bufferId","acronym","name","composition","comments","ph"]}),this.store.sort("acronym");var b="Ext.grid.Panel";return 1==this.searchBar&&(b="Ext.ux.LiveSearchGridPanel"),this.panel=Ext.create(b,{title:"Buffers",collapsible:this.collapsible,collapsed:this.collapsed,store:this.store,height:this.height,width:this.width,columns:[{text:"Proposal",dataIndex:"proposal",flex:1},{text:"Acronym",dataIndex:"acronym",flex:2},{text:"Name",dataIndex:"name",flex:2,hidden:!1},{text:"pH",dataIndex:"ph",flex:2},{text:"Composition",dataIndex:"composition",flex:2,hidden:!1},{text:"Comments",dataIndex:"comments",flex:4,hidden:!1},{xtype:"actioncolumn",width:40,text:"Edit",items:[{icon:"images/icon/edit.png",tooltip:"Edit",handler:function(b,c,d){var e=b.getStore().getAt(c);a._edit(e.get("bufferId"))}}]}],flex:1,viewConfig:{stripeRows:!0,listeners:{celldblclick:function(b,c,d,e,f,g,h,i){a._edit(e.data.bufferId)}}}}),this.tbar&&this.panel.addDocked({xtype:"toolbar",cls:"toolBarGrid",height:48,items:this._getTbar()}),this.panel},BufferGrid.prototype.input=function(){return(new MacromoleculeGrid).input()},BufferGrid.prototype.test=function(a){var b=new BufferGrid({width:800,height:350,collapsed:!1,tbar:!0});BIOSAXS.proposal=new Proposal(b.input().proposal);var c=b.getPanel(BIOSAXS.proposal.macromolecules);c.render(a)},CaseGrid.prototype._getHTMLTable=function(a){for(var b="<table style='font-size:14px;color:gray;'>",c=0;c<a.length;c++)b+="<tr>",b+="<td>",b+=a[c].key,b+="</td>",b+="<td style='font-weight:bold;color:black;'>",b+=a[c].value,b+="</td>",b+="</tr>";return b+"</table>"},CaseGrid.prototype._getHTMLButton=function(a,b){return'<input id="'+a+' "type="button" name="btn" style="font-size:9px;width:90px; height:40px" class="btn-component" value="'+b+'" >'},CaseGrid.prototype._getUnpackStockSolutionButton=function(a,b){return'<input id="'+a+'"type="button" name="stockSolution" style="font-size:9px;width:90px; height:40px" class="btn-component-remove" value="'+b+'" >'},CaseGrid.prototype._getRemoveContainerButton=function(a,b){return'<input id="'+a+'"type="button" name="puck" style="font-size:9px;width:90px; height:40px" class="btn-component-remove" value="'+b+'" >'},CaseGrid.prototype._getEditPuckButton=function(a,b,c){return'<input id="'+a+"_"+b+'"type="button" name="edit" style="font-size:9px;width:90px; height:40px" class="btn-component-puck-edit" value="'+c+'" >'},CaseGrid.prototype._getPrintParcelButton=function(a,b){return'<input id="'+a+' "type="button" name="printLabels" style="font-size:9px;width:90px; height:40px" class="btn-component-print-parcel" value="'+b+'" >'},CaseGrid.prototype._getEditParcelButton=function(a,b){return'<input id="'+a+' "type="button" name="editParcel" style="font-size:9px;width:90px; height:40px" class="btn-component-edit-parcel" value="'+b+'" >'},CaseGrid.prototype._getRemoveParcelButton=function(a,b){return'<input id="'+a+' "type="button" name="removeParcel" style="font-size:9px;width:90px; height:40px" class="btn-component-remove" value="'+b+'" >'},CaseGrid.prototype._getComponentRowHTML=function(a,b,c,d,e){var f="";return f+="<tr  class='tr-component'>",f+="<td>",f+=this._getEditPuckButton(b,Number(e),"Edit"),f+="</td>",f+="<td>",f+=b,f+="</td>",f+="<td>",f+=c,f+="</td>",f+="<td>",f+=d,f+="</td>","Stock Solution"==b&&(f+="<td>",f+=this._getUnpackStockSolutionButton(Number(e),"Unpack"),f+="</td>"),"Puck"==b&&(f+="<td>",f+=this._getRemoveContainerButton(Number(e),"Remove"),f+="</td>"),f+="</tr>"},CaseGrid.prototype._getComponentHTML=function(a,b){var c="";if(b.length>0){c="<table  class='table-component'><tr><th class='th-component'></th><th class='th-component'>Type</th><th class='th-component'>Code</th><th class='th-component'>Capacity</th><th></th></tr>";for(var d=0;d<b.length;d++){var e="../images/BasketView_24x24_01.png";"Puck"==b[d].type&&(c+=this._getComponentRowHTML(e,b[d].type,b[d].code,b[d].sampleCount+"/"+b[d].capacity,b[d].id)),"Stock Solution"==b[d].type&&(e="../images/SampleHolderView_24x24_01.png",c+=this._getComponentRowHTML(e,b[d].type,b[d].code,b[d].capacity,b[d].id))}c+="</table>"}else c+="<br /><br /><span class='parcel-empty-msg'>This parcel is empty</span>";return 0==b.length&&(c=this._getHTMLButton(a,"Add Solution")+this._getHTMLButton(a,"Add Puck")+c),b.length>0&&(c="Puck"==b[0].type?this._getHTMLButton(a,"Add Puck")+c:this._getHTMLButton(a,"Add Solution")+c),'<div  class="header-component-table" >Components</div><div  style="margin:0px 0px 0px 0px !important;width:610px;">'+c+"</div>"},CaseGrid.prototype._getParcelHTML=function(a){var b="<table  class='table-component'><tr><th class='th-component'>Code</th><th class='th-component'>Status</th><th class='th-component'>Store Location</th><th class='th-component'>Comments</th></tr>",c=a.Dewar_storageLocation,d=a.Dewar_code,e=a.Dewar_status,f=a.Dewar_comments;return null==d&&(d="<span style='color:orange'>Not set</span>"),null==e&&(e="<span style='color:orange'>Unknown</span>"),null==c&&(c="<span style='color:orange'>Not set</span>"),null==f&&(f=""),b=b+"<tr class='tr-component'><td>"+d+"</td><td>"+e+"</td><td>"+c+"</td><td>"+f+"</td></tr></table>",b=this._getEditParcelButton(a.Dewar_dewarId,"Edit")+this._getPrintParcelButton(a.Dewar_dewarId,"Print Labels")+this._getRemoveParcelButton(a.Dewar_dewarId,"Remove")+b,'<div  class="header-component-table" >Parcel</div><div  style="margin:0px 0px 0px 0px !important;width:610px;">'+b+"</div>"},CaseGrid.prototype._getColumns=function(){var a=this,b=[{header:"General",dataIndex:"type",name:"type",type:"string",flex:.5,renderer:function(b,c,d){var e=JSON.parse(d.data.serialized);return a._getParcelHTML(e[0])}},{header:"Content",dataIndex:"Dewar_comments",name:"type",type:"string",flex:.5,renderer:function(b,c,d){var e=JSON.parse(d.data.serialized),f=e[0].Dewar_dewarId,g=[];if(null!=e&&e.length>0)for(var h=0;h<e.length;h++)if("Puck"==e[h].Container_containerType){var i="";null!=e[h].Container_code&&(i=e[h].Container_code),g.push({type:e[h].Container_containerType,code:i,capacity:e[h].Container_capacity,sampleCount:e[h].sampleCount,id:e[h].Container_containerId})}var j=EXI.proposalManager.getStockSolutionsByDewarId(f);if(j)for(var h=0;h<j.length;h++)g.push({type:"Stock Solution",code:j[h].name,capacity:j[h].volume+"ml",sampleCount:"",id:j[h].stockSolutionId});return a._getComponentHTML(f,g)}}];return b},CaseGrid.prototype._getTopButtons=function(){var a=this,b=[];return b.push(Ext.create("Ext.Action",{icon:"../images/icon/add.png",text:"Add",disabled:!1,handler:function(b,c){a.edit()}})),b},CaseGrid.prototype.groupBy=function(a,b){var c={};return a.forEach(function(a){var d=JSON.stringify(b(a));c[d]=c[d]||[],c[d].push(a)}),Object.keys(c).map(function(a){return c[a]})},CaseGrid.prototype.load=function(a){function b(a,b){for(var d=c.groupBy(b,function(a){return[a.Dewar_dewarId]}),e=[],f=0;f<d.length;f++)e.push({serialized:JSON.stringify(d[f])});c.store.loadData(e)}var c=this;this.shipment=a,this.dewars=a.dewarVOs,this.dewars.length>0&&EXI.getDataAdapter({onSuccess:b}).proposal.shipping.getDewarsByShipmentId(a.shippingId)},CaseGrid.prototype.edit=function(a){var b=this,c=new CaseForm,d=Ext.create("Ext.window.Window",{title:"Parcel",height:360,width:600,modal:!0,layout:"fit",items:[c.getPanel(a)],buttons:[{text:"Save",handler:function(){new DataAdapter;b.panel.setLoading();var a=c.getDewar(),e=function(a,c){b.load(c),d.close(),b.panel.setLoading(!1)};a.sessionId=a.firstExperimentId,a.shippingId=b.shipment.shippingId,EXI.getDataAdapter({onSuccess:e}).proposal.dewar.saveDewar(b.shipment.shippingId,a)}},{text:"Cancel",handler:function(){d.close()}}]});d.show()},CaseGrid.prototype._getStoreFields=function(){return[{name:"serialized",type:"string"}]},CaseGrid.prototype.getDewarById=function(a){for(var b=this,c=0;c<b.dewars.length;c++)if(b.dewars[c].dewarId==a)return b.dewars[c]},CaseGrid.prototype.saveStockSolution=function(a){var b=this;this.panel.setLoading();var c=function(){var a=function(){b.panel.setLoading(!1),b.load(b.shipment)};EXI.getDataAdapter({onSuccess:a}).proposal.proposal.update()};EXI.getDataAdapter({onSuccess:c}).saxs.stockSolution.saveStockSolution(a)},CaseGrid.prototype.addPuckToDewar=function(a){var b=this;this.panel.setLoading();var c=function(){b.load(b.shipment),b.panel.setLoading(!1)};EXI.getDataAdapter({onSuccess:c}).proposal.shipping.addPuck(this.shipment.shippingId,Number(a))},CaseGrid.prototype.removePuck=function(a){var b=this;this.panel.setLoading();var c=function(a,c){b.load(b.shipment),b.panel.setLoading(!1)};EXI.getDataAdapter({onSuccess:c}).proposal.shipping.removeContainerById(b.shipment.shippingId,a,a)},CaseGrid.prototype.openStockSolutionWindow=function(a){var b=this,c=new StockSolutionGrid({btnAddVisible:!1,btnEditVisible:!1,btnRemoveVisible:!1,btnAddExisting:!1,isPackedVisible:!1,multiselect:!0}),d=Ext.create("Ext.window.Window",{height:400,width:700,items:[c.getPanel()],buttons:[{text:"Pack",handler:function(){d.close(),c.selectedStockSolutions[0].boxId=a,b.saveStockSolution(c.selectedStockSolutions[0])}},{text:"Cancel",handler:function(){d.close()}}]}).show();c.load(EXI.proposalManager.getUnpackedStockSolutions())},CaseGrid.prototype.getPanel=function(){var a=this;return this.store=Ext.create("Ext.data.Store",{fields:this._getStoreFields(),data:[],autoload:!0}),this.panel=Ext.create("Ext.grid.Panel",{style:{padding:15},cls:"border-grid",height:800,deferEmptyText:!1,emptyText:"No data",store:this.store,columns:this._getColumns(),disableSelection:!0,viewConfig:{stripeRows:!0,enableTextSelection:!0,preserveScrollOnRefresh:!0,stripeRows:!0,rowLines:!0,listeners:{celldblclick:function(b,c,d,e,f,g,h,i){a.edit(a.getDewarById(JSON.parse(e.data.serialized)[0].Dewar_dewarId))},cellclick:function(b,c,d,e,f,g,h,i){function j(b){"yes"==b&&a.removePuck(s)}if("printLabels"==h.target.name){var k=h.target.id.trim(),l=EXI.getDataAdapter().proposal.shipping.getDewarLabelURL(a.shipment.shippingId,k);return console.log(k),void(location.href=l)}if("removeParcel"==h.target.name)return void BUI.showWarning("Not implemented yet");if("editParcel"==h.target.name)return void a.edit(a.getDewarById(parseInt(h.target.id.trim())));if("edit"==h.target.name){if(-1!=h.target.id.indexOf("Stock Solution")){var m=h.target.id.split("_")[1];location.hash="/stocksolution/"+m+"/main"}if(-1!=h.target.id.indexOf("Puck")){var n=h.target.id.split("_")[1],o=new PuckForm({width:Ext.getBody().getWidth()-150});o.onSaved.attach(function(b,c){a.load(a.shipment),p.close()});var p=Ext.create("Ext.window.Window",{title:"Edit Puck",height:700,width:Ext.getBody().getWidth()-100,modal:!0,resizable:!0,layout:"fit",items:o.getPanel()}).show();if(null!=n){var q=function(a,b){o.load(b)};EXI.getDataAdapter({onSuccess:q}).proposal.shipping.getContainerById(n,n,n)}}}if("Add Solution"==h.target.defaultValue&&a.openStockSolutionWindow(h.target.id),"Add Puck"==h.target.defaultValue&&a.addPuckToDewar(h.target.id),"Unpack"==h.target.defaultValue&&"stockSolution"==h.target.name){var r=EXI.proposalManager.getStockSolutionById(h.target.id);r.boxId=null,a.saveStockSolution(r)}if("Remove"==h.target.defaultValue){var s=Number(h.target.id);"puck"==h.target.name&&Ext.MessageBox.show({title:"Save Changes?",msg:"Removing a puck from this parcel will remove also its content. <br />Are you sure you want to continue?",buttons:Ext.MessageBox.YESNOCANCEL,fn:j,animateTarget:"mb4",icon:Ext.MessageBox.QUESTION})}}}},selModel:{mode:"SINGLE"}}),this.panel.addDocked({height:45,xtype:"toolbar",items:a._getTopButtons(),cls:"exi-top-bar"}),this.panel},DataReductionForm.prototype._parseSelectedItemsToIds=function(a){var b=[];if(null!=a)for(var c=0;c<a.length;c++)b.push(a[c].id);return b},DataReductionForm.prototype.onSelectionChanged=function(a,b){null!=b&&("Frames"==a&&(this.selectedItems.frames=b,this.selectedItems.subtractions=[]),"Averages"==a&&(this.selectedItems.averages=b),"Subtractions"==a&&(this.selectedItems.frames=[],this.selectedItems.subtractions=b)),this.plotWidget.refresh(this._parseSelectedItemsToIds(this.selectedItems.frames),this._parseSelectedItemsToIds(this.selectedItems.subtractions))},DataReductionForm.prototype._getFramesExtPanel=function(a,b,c){var d=this,e=Ext.create("Ext.selection.RowModel",{allowDeselect:!0,mode:"MULTI",listeners:{selectionchange:function(a,c){for(var e=[],f=0;f<c.length;f++)e.push(c[f].data);d.onSelectionChanged(b,e)}}});return Ext.create("Ext.grid.Panel",{store:a,margin:10,height:c,width:200,selModel:e,columns:[{text:b,dataIndex:"fileName",flex:1}],viewConfig:{}})},DataReductionForm.prototype._getFramesPanel=function(){var a=["fileName","type","id"];this.framesStore=Ext.create("Ext.data.Store",{fields:a,sorters:"fileName"}),this.averagesStore=Ext.create("Ext.data.Store",{fields:a}),this.subtractionStore=Ext.create("Ext.data.Store",{fields:a});var b=this._getFramesExtPanel(this.framesStore,"Frames",375),c=(this._getFramesExtPanel(this.averagesStore,"Averages",125),this._getFramesExtPanel(this.subtractionStore,"Subtractions",75));return{xtype:"container",layout:"vbox",items:[b,c]}},DataReductionForm.prototype._getImageContainer=function(a,b){var c="<div id='"+this.id+"_"+a+"'>"+a+"</div>";return{xtype:"container",layout:"vbox",items:[{html:c,margin:"5 0 0 0",height:95,width:100},{xtype:"label",forId:"myFieldId",text:b,margin:"5 0 0 0",cls:"inline-help"}]}},DataReductionForm.prototype._getItems=function(){return[{xtype:"container",layout:"hbox",items:[this._getFramesPanel(),this.plotWidget.getPanel(),{xtype:"panel",width:110,frame:!0,margin:"10 5 5 5",border:0,layout:"vbox",items:[this._getImageContainer("scattering","Scattering"),this._getImageContainer("guinier","Guinier Region"),this._getImageContainer("kratky","Kratky Plot"),this._getImageContainer("gnom","P(r) distribution")]}]}]},DataReductionForm.prototype._getButtons=function(){return[]},DataReductionForm.prototype.getPanel=function(){var a=this;return this.panel=Ext.create("Ext.form.Panel",{width:this.width,height:this.height,border:0,items:this._getItems(),buttons:this._getButtons(),listeners:{afterrender:function(){a._populate()}}}),this.panel},DataReductionForm.prototype._populate=function(){},DataReductionForm.prototype.refresh=function(a){if(null!=a)for(var b=0;b<a.length;b++){var c=a[b],d=[{fileName:BUI.getFileName(c.bufferAverageFilePath),type:"bufferAvg",id:c.subtractionId},{fileName:BUI.getFileName(c.sampleAverageFilePath),type:"sampleAvg",id:c.subtractionId}];this.averagesStore.loadData(d,!0),this.subtractionStore.loadData([{fileName:BUI.getFileName(c.substractedFilePath),type:"SUBTRACTION",id:c.subtractionId}],!0);var e=[];if(null!=c.bufferOneDimensionalFiles&&null!=c.bufferOneDimensionalFiles.frametolist3VOs)for(var f=0;f<c.bufferOneDimensionalFiles.frametolist3VOs.length;f++){var g=c.bufferOneDimensionalFiles.frametolist3VOs[f];null!=g.frame3VO&&e.push({fileName:BUI.getFileName(g.frame3VO.filePath),type:"BUFFER",id:g.frame3VO.frameId})}if(null!=c.sampleOneDimensionalFiles&&null!=c.sampleOneDimensionalFiles.frametolist3VOs)for(var f=0;f<c.sampleOneDimensionalFiles.frametolist3VOs.length;f++){var g=c.sampleOneDimensionalFiles.frametolist3VOs[f];null!=g.frame3VO&&e.push({fileName:BUI.getFileName(g.frame3VO.filePath),type:"SAMPLE",id:g.frame3VO.frameId})}this.framesStore.loadData(e,!0),this._displayImage("scattering",c.subtractionId),this._displayImage("kratky",c.subtractionId),this._displayImage("guinier",c.subtractionId),this._displayImage("gnom",c.subtractionId)}},DataReductionForm.prototype._displayImage=function(a,b){var c=(new DataAdapter).getImage(b,a);console.log(c);var d="OnClick= window.open('"+c+"')";document.getElementById(this.id+"_"+a).innerHTML="<img src="+c+'   height="90" width="90" '+d+">"},DataReductionForm.prototype.input=function(){return{}},DataReductionForm.prototype.test=function(a){var b=new DataReductionForm,c=b.getPanel();c.render(a)},ExperimentGrid.prototype._getFilterTypes=function(){return[]},ExperimentGrid.prototype._prepareData=function(a){var b=[],c=0;a.sort(function(a,b){return b.experimentId-a.experimentId});for(var d=0;d<a.length;d++){var e=a[d];this.dates[moment(e.creationDate).format("YYYYMMDD")]=moment(e.creationDate).format("MMM Do YY"),null!=this.filtered&&e.experimentType!=this.filtered||!(c<this.limit||null==this.limit)||null!=this.sessionIdFilter&&null==this.date&&(null!=this.date||this.sessionIdFilter!=e.sessionId)||(b.push({experimentId:e.experimentId,status:e.status,dataAcquisitionFilePath:e.dataAcquisitionFilePath,type:e.experimentType,name:e.name,macromolecules_names:e.macromolecules,percentageAnalysed:{value:e.dataCollectionDoneCount/e.dataCollectionCount*100,text:e.dataCollectionDoneCount+" of "+e.dataCollectionCount},percentageCollected:{value:e.measurementDoneCount/e.measurementCount*100,text:e.measurementDoneCount+" of "+e.measurementCount},percentageMerged:{value:e.measurementAveragedCount/e.measurementCount*100,text:e.measurementAveragedCount+" of "+e.measurementCount},date:moment(e.creationDate).format("YYYYMMDD"),time:moment(e.creationDate).format("YYYYMMDDHHmmss"),creationDate:e.creationDate}),c++)}return b},ExperimentGrid.prototype.getPanel=function(a){return this.features=a,this._renderGrid(a)},ExperimentGrid.prototype.refresh=function(a){this.experiments=a;for(var b=[],c=0;c<a.length;c++)"TEMPLATE"!=a[c].experimentType&&b.push(a[c]);this.parsedData=this._prepareData(b);for(var d={},e=[],c=0;c<this.experiments.length;c++){var f=moment(this.experiments[c].creationDate).format("MMM Do YYYY");null==d[f]&&(e.push({date:f,value:moment(this.experiments[c].creationDate)}),d[f]=!0)}this.storeDate.loadData(e,!1),this.store.loadData(this.parsedData,!1),null!=this.date&&this._filterByDate(this.date)},ExperimentGrid.prototype._getTopButtons=function(){var a=this,b=[];return b.push(Ext.create("Ext.Action",{icon:"../images/calendar_icon.png",text:"Show Calendar",disabled:!1,handler:function(b,c){var d=Ext.create("Ext.window.Window",{title:"Calendar",width:600,height:600,modal:!0,closable:!0,layout:{type:"vbox",align:"stretch"},items:[{xtype:"label",html:"Click on a data acquisition to select:",margin:"5 5 5 5"},{html:'<div id="calendar" style="height:450px;overflow-y: scroll;"></div>',margin:"5 5 5 5"}]}).show(),e=new CalendarWidget({height:450}),f=a.limit;a.limit=null,a.sessionIdFilter=null,e.loadData(a._prepareData(a.experiments)),a.limit=f,e.draw("calendar"),e.onClick.attach(function(b,c){c=moment(c,"YYYY-MM-DD"),a._filterByDate(c),d.close()})}})),this.storeDate=Ext.create("Ext.data.ArrayStore",{fields:["date","value"],data:[]}),this.dateMenu=Ext.create("Ext.form.field.ComboBox",{hideLabel:!0,store:this.storeDate,displayField:"date",typeAhead:!0,queryMode:"local",margin:"0 0 0 30",triggerAction:"all",emptyText:"Select a date...",selectOnFocus:!0,width:135,listeners:{scope:this,select:function(b,c,d){a.limit=null,a._filterByDate(moment(c[0].raw.value,"YYYY-MM-DD"))}}}),b.push(this.dateMenu),b.push("->"),null!=a.filtered?b.push({html:"<span>Experiment Type: "+a.filtered+"</span>"}):b.push({html:"<span>Experiment Type: ALL</span>"}),b},ExperimentGrid.prototype._filterByDate=function(a){for(var b=[],c=0;c<this.experiments.length;c++){var d=this.experiments[c];if(null!=d.creationDate){var e=moment(d.creationDate);e.year()==a.year()&&e.month()==a.month()&&e.date()==a.date()&&b.push(d)}}var f=this._prepareData(b);this.store.loadData(f),this.date=a},ExperimentGrid.prototype._removeExperimentById=function(a){var b=this,c=new BiosaxsDataAdapter;c.onSuccess.attach(function(a,c){b.grid.setLoading(!1),document.getElementById(BIOSAXS.targetId).innerHTML="",BIOSAXS.start(BIOSAXS.targetId)}),this.grid.setLoading("Removing experiment "),c.removeExperimentById(a)},ExperimentGrid.prototype._renderGrid=function(){var a=this;this.store=Ext.create("Ext.data.Store",{fields:["name"],autoload:!0,data:[],remoteSort:!1,sorters:this.sorters});var b=Ext.create("Ext.grid.feature.Grouping",{groupHeaderTpl:Ext.create("Ext.XTemplate","<div style='background:#0ca3d2; color:white; float:left; margin:6px 8px 0 0; padding:5px 8px;'>{name:this.formatName}</div>",{formatName:function(b){return a.dates[b]}}),hideGroupedHeader:!0,startCollapsed:!1});this.features=[],this.grouping&&this.features.push(b),this.grid=Ext.create(this.gridType,{hideHeaders:this.hideHeaders,resizable:!0,title:this.title,width:this.width,minHeight:this.minHeight,height:this.height,features:this.features,store:this.store,columns:this._getColumns(),selModel:{mode:"SINGLE"},viewConfig:{stripeRows:!0,getRowClass:function(a,b,c,d){return"TEMPLATE"==a.raw.type?"template-color-row":"CALIBRATION"==a.raw.type&&"FINISHED"==a.raw.status?"blue-row":void 0},listeners:{itemdblclick:function(b,c,d,e){a._editExperiment(c.raw.experimentId)},cellclick:function(b,c,d,e,f,g,h,i){b.getGridColumns()[d].getId()==a.id+"GO"&&a._editExperiment(e.raw.experimentId),b.getGridColumns()[d].getId()==a.id+"REMOVE"&&a._removeExperimentById(e.raw.experimentId)}}}});var c=a._getTopButtons();return this.tbar&&(this.grid.addDocked({xtype:"toolbar",height:48,items:c}),this.grid.getSelectionModel().on({selectionchange:function(a,b){if(b.length)for(var d=0;d<c.length;d++)c[d].enable&&c[d].enable();else for(var d=0;d<c.length;d++)0==c[d].alwaysEnabled&&c[d].disable&&c[d].disable()}})),this.grid},ExperimentGrid.prototype._getColumns=function(){var a=this;return[{text:"experimentId",dataIndex:"experimentId",name:"experimentId",type:"string",hidden:!0},{xtype:"rownumberer",width:40},{text:"Name",dataIndex:"name",name:"name",type:"string",flex:1},{text:"Type",dataIndex:"type",name:"type",type:"string",flex:1,renderer:function(a){return"CALIBRATION"==a?"<span style='color:blue;'>"+a+"</span>":a}},{text:"Macromolecules",name:"macromolecules_names",dataIndex:"macromolecules_names",flex:1,renderer:function(a){return null!=a?" <span style='font-weight:bold'>"+a+"</span>":" <span style='font-style:italic;color:gray;'>Information not available</span>"}},{text:"Buffers",dataIndex:"buffer_names",name:"buffer_names",flex:1,hidden:!0,renderer:function(a){return"Buffer/s: <span style='font-weight:bold'>"+a+"</span>"}},{text:"Status",dataIndex:"status",name:"status",type:"string",flex:1,renderer:function(a,b,c){return"TEMPLATE"==c.raw.type?"READY":"ABORTED"==c.raw.status?"<span style='color:red;'>"+a+"</span>":"<span style='color:green;'>"+a+"</span>"}},{text:"Download",dataIndex:"creationDate",name:"creationDate",renderer:function(a,b,c){if(null!=c){if("HPLC"==c.raw.type)return;return BUI.getZipHTMLByExperimentId(c.raw.experimentId,c.raw.name)}},width:100},{header:"Measurements",dataIndex:"percentageCollected",name:"percentageCollected",type:"string",renderer:function(a,b,c){return"TEMPLATE"!=c.raw.type&&"HPLC"!=c.raw.type?"<table><tr><td>"+BUI.getProgessBar(c.raw.percentageCollected.value,c.raw.percentageCollected.text)+"</td></table>":void 0},width:100},{header:"Averaged",dataIndex:"percentageMerged",name:"percentageMerged",type:"string",renderer:function(a,b,c){return"TEMPLATE"!=c.raw.type&&"HPLC"!=c.raw.type?"<table><tr><td>"+BUI.getProgessBar(c.raw.percentageMerged.value,c.raw.percentageMerged.text)+"</td></table>":void 0},width:100},{header:"Subtractions",dataIndex:"percentageAnalysed",name:"percentageAnalysed",type:"string",renderer:function(a,b,c){
return"TEMPLATE"!=c.raw.type&&"HPLC"!=c.raw.type?"<table><tr><td>"+BUI.getProgessBar(c.raw.percentageAnalysed.value,c.raw.percentageAnalysed.text)+"</td></table>":void 0},width:100},{text:"time",dataIndex:"time",name:"time",hidden:!0,renderer:function(a){return a},width:100},{text:"Date",dataIndex:"date",name:"date",renderer:function(a){return a},width:100},{text:"Time",dataIndex:"creationDate",name:"creationDate",renderer:function(a){return moment(a).format(" HH:mm:ss")},width:100},{id:a.id+"GO",width:80,sortable:!1,renderer:function(a,b,c,d,e,f){return BUI.getGreenButton("GO")}}]},ExperimentGrid.prototype._editExperiment=function(a){null!=Ext.urlDecode(window.location.href).sessionId?location.href="viewProjectList.do?reqCode=display&experimentId="+a+"&sessionId="+Ext.urlDecode(window.location.href).sessionId:location.href="viewProjectList.do?reqCode=display&experimentId="+a},ExperimentGrid.prototype.input=function(){var a=DATADOC.getExperimentList_10();return{experiments:a,proposal:(new MeasurementGrid).input().proposal}},ExperimentGrid.prototype.test=function(a){var b=new ExperimentGrid({height:350,minHeight:350,width:1e3});BIOSAXS.proposal=new Proposal(b.input().proposal);var c=b.getPanel(b.input().experiments);b.refresh(b.input().experiments),c.render(a)},ExperimentHeaderForm.prototype.load=function(a){this.experiment=a,Ext.getCmp(this.id+"name").setValue(a.name),document.getElementById(this.id+"date").innerHTML="Created on "+a.creationDate,Ext.getCmp(this.id+"comments").setValue(a.json.comments)},ExperimentHeaderForm.prototype.getToolBar=function(){var a=this;return[{text:"Save",width:100,handler:function(){a.panel.setLoading();var b=function(b){a.panel.setLoading(!1)};EXI.getDataAdapter({onSuccess:b}).saxs.experiment.saveExperiment(a.experiment.experimentId,Ext.getCmp(a.id+"name").getValue(),Ext.getCmp(a.id+"comments").getValue())}},"->",Ext.create("Ext.button.Split",{text:"Download",menu:new Ext.menu.Menu({items:[{text:"For BsxCube on bm29",handler:function(){window.open(EXI.getDataAdapter().saxs.template.getTemplateSourceFile(a.experiment.experimentId,"bsxcube"))}},{text:"For Becquerel on p12",handler:function(){window.open(EXI.getDataAdapter().saxs.template.getTemplateSourceFile(a.experiment.experimentId,"becquerel"))}}]})})]},ExperimentHeaderForm.prototype.getPanel=function(){return this.panel=Ext.create("Ext.panel.Panel",{layout:"vbox",buttons:this.getToolBar(),cls:"border-grid",items:[{xtype:"container",margin:"10 0 0 20",layout:"hbox",items:[{xtype:"container",layout:"vbox",items:[{xtype:"textfield",fieldLabel:"Name",id:this.id+"name"},{margin:"0 0 0 100",html:"<div style='color:gray;' id='"+this.id+"date';></div>"}]},{xtype:"textarea",fieldLabel:"Comments",margin:"0 0 10 20",width:600,height:80,id:this.id+"comments"}]}]}),this.panel},FrameSelectorGrid.prototype.loadData=function(a,b){function c(a){function b(a){for(var b=0;b<e.measurements.length;b++)if(e.measurements[b].measurementId==a)return null!=e.measurements[b].macromoleculeId?e.measurements[b].macromoleculeAcronym+":  "+e.measurements[b].concentration+"mg/ml":""}var c="";a.measurementtodatacollection3VOs.sort(function(a,b){return a.dataCollectionOrder-b.dataCollectionOrder});for(var d=0;d<a.measurementtodatacollection3VOs.length;d++)c=c+" "+b(a.measurementtodatacollection3VOs[d].measurementId);return c}function d(a){function b(a){var b=[];if(a.frametolist3VOs)for(var c=0;c<a.frametolist3VOs.length;c++)b.push({text:a.frametolist3VOs[c].frame3VO.filePath,type:"Frame",frameId:a.frametolist3VOs[c].frame3VO.frameId,leaf:!0});return b}var c=[];if(null!=a&&null!=a.substraction3VOs&&(a.substraction3VOs.sort(function(a,b){return a.subtractionId-b.subtractionId}),a.substraction3VOs.length>0)){var d=a.substraction3VOs[a.substraction3VOs.length-1];c.push({text:d.substractedFilePath,subtractionId:d.subtractionId,type:"Subtraction",leaf:!0}),c.push({text:d.sampleAverageFilePath,subtractionId:d.subtractionId,type:"SampleAverage",leaf:!0}),c.push({text:d.bufferAverageFilePath,subtractionId:d.subtractionId,type:"BufferAverage",leaf:!0}),null!=d.sampleOneDimensionalFiles&&c.push({text:"Sample",leaf:!1,type:"Sample",children:b(d.sampleOneDimensionalFiles,"Sample")}),null!=d.bufferOneDimensionalFiles&&c.push({text:"Buffer",leaf:!1,type:"Buffer",children:b(d.bufferOneDimensionalFiles,"Buffer")})}return c}for(var e=this,f=[],g=0;g<b.length;g++)f.push({text:c(b[g]),leaf:!1,children:d(b[g])});e.treePanel.setRootNode({expanded:!0,children:f})},FrameSelectorGrid.prototype.load=function(a){var b=this;this.measurements=a,this.subtractionIds=[];var c=[];if(null!=this.measurements)for(var d=0;d<this.measurements.length;d++)null!=this.measurements[d].dataCollectionId&&(c.push(this.measurements[d].dataCollectionId),this.subtractionIds.push(this.measurements[d].subtractionId));this.subtractionIds=$.unique(this.subtractionIds);var e=function(a,c){null!=c&&b.loadData(b.measurements,c)};EXI.getDataAdapter({onSuccess:e}).saxs.dataCollection.getDataCollectionsByIdList(c)},FrameSelectorGrid.prototype.getPanel=function(){var a=this;this.store=Ext.create("Ext.data.TreeStore",{proxy:{type:"memory"},columns:[{xtype:"treecolumn",text:"Text",dataIndex:"text"}]});var b=Ext.create("Ext.selection.RowModel",{allowDeselect:!0,mode:"multi",listeners:{selectionchange:function(b,c){var d=[],e=[],f=[],g=[];if(null!=c){for(var h=0;h<c.length;h++)c[h].data.type&&("Frame"==c[h].data.type&&d.push(c[h].data.frameId),"SampleAverage"==c[h].data.type&&e.push(c[h].data.subtractionId),"BufferAverage"==c[h].data.type&&f.push(c[h].data.subtractionId),"Subtraction"==c[h].data.type&&g.push(c[h].data.subtractionId));a.onSelectionChange.notify({frame:d,average:[],sampleaverage:e,bufferaverage:f,subtracted:g})}}}});return this.treePanel=Ext.create("Ext.tree.Panel",{title:"Data Collections",selModel:b,store:this.store,rootVisible:!1,buttons:[{text:"Download",xtype:"button",handler:function(b){window.open(EXI.getDataAdapter().saxs.subtraction.getZip(a.subtractionIds.toString()))}}],columns:[{xtype:"treecolumn",dataIndex:"text",flex:1,renderer:function(a,b,c){return c.data.leaf&&-1!=c.data.text.lastIndexOf("/")?c.data.text.substr(c.data.text.lastIndexOf("/")+1):c.data.text}}]}),this.treePanel},GenericStepWizardForm.prototype.getForm=function(){alert("[getForm] Not implemented")},GenericStepWizardForm.prototype.getNextForm=function(){alert("[getNextForm] Not implemented")},GenericStepWizardForm.prototype.reload=function(){alert("[getNextForm] Not implemented")},HPLCGraph.prototype.getMenu=function(){function a(a,c){c?b.plots[a.param]=!0:delete b.plots[a.param],b.reloadData(this.hplcData)}for(var b=this,c=[],d=0;d<this.hplcData.length;d++)if(0!=this.hplcData[d].showOnMenu){var e=this.hplcData[d].param,f="style='padding:0 0px 0 5px;'";c.push({text:"<table><tr><td>"+BUI.getRectangleColorDIV(this.hplcData[d].color,10,10)+"</td><td "+f+"> "+this.hplcData[d].label+"</td></tr></table>",id:b.id+e,param:e,enableToggle:!0,scope:this,toggleHandler:a,pressed:null!=b.plots[e]})}return c.push("-"),c.push({text:"Scale",enableToggle:!0,scope:this,pressed:this.scaled,icon:"../images/icon_graph.png",toggleHandler:function(a,c){b.scaled=c,b.reloadData(this.hplcData)}}),c.push("->"),c.push({text:"Save",scope:this,icon:"images/icon/ic_get_app_black_24dp.png",handler:function(a,b){var c=document.createElement("img");c.style.display="block",c.style.width="200px",c.style.height="200px",c.setAttribute("src",Dygraph.Export.asCanvas(this.dygraphObject.dygraph).toDataURL()),window.open(Dygraph.Export.asCanvas(this.dygraphObject.dygraph).toDataURL(),"Image","")}}),c},HPLCGraph.prototype.scaledData=function(a){for(var b=0;b<a.length;b++){var c=this.getMaxAndMinValue(a[b]);a[b]=this.divideValuesByMax(a[b],c.max),this.ranges[a[b].label]=c}return a},HPLCGraph.prototype.divideValuesByMax=function(a,b){for(var c=0;c<a.data.length;c++)0!=b&&(a.data[c]=Number(a.data[c])/b,a.std[c]=Number(a.std[c])/b);return a},HPLCGraph.prototype.getMaxAndMinValue=function(a){for(var b=0,c=a.data[0],d=0;d<a.data.length;d++)Number(a.data[d])>b&&(b=Number(a.data[d])),Number(a.std[d])>b&&(b=Number(a.std[d])),Number(a.data[d])<c&&(c=Number(a.data[d]));return{max:Number(b),min:Number(c)}},HPLCGraph.prototype.getPoint=function(a,b){var c=parseFloat(a.data[b]),d=parseFloat(a.std[b]);return null==a.fdata?[c-d,c,c+d]:null!=a.fstd?[a.fstd(c-d),a.fdata(c),a.fstd(c+d)]:[a.fdata(c)-d,a.fdata(c),a.fdata(c)+d]},HPLCGraph.prototype.reloadData=function(a){this.panel.setLoading(!1),this.hplcData=a;var b=a;this.scaled&&(b=this.scaledData(JSON.parse(JSON.stringify(a))));for(var c={},d=[],e=0,f=0;f<b[0].data.length-1;f++){var g=[];for(e=0;e<b.length;e++)null!=this.plots?null!=this.plots[b[e].param]&&(g.push(this.getPoint(b[e],f)),c[b[e].param]=g.length-1):g.push([b[e].data[f]-b[e].std[f],b[e].data[f],b[e].data[f]+b[e].std[f]]);d.push([]);var h=f;for(null!=this.xParam&&(h=parseFloat(b[this.xParam].data[f])),d[d.length-1].push(h),e=0;e<b.length;e++)null!=this.plots?null!=this.plots[b[e].param]&&d[d.length-1].push(g[c[b[e].param]]):d[d.length-1].push(g[e])}var i=[],j=[""];for(e=0;e<b.length;e++)null!=this.plots?null!=this.plots[b[e].param]&&(i.push(b[e].color),j.push(b[e].label)):d[d.length-1].push(g[e]);this._renderDygraph(d,i,j)},HPLCGraph.prototype._renderDygraph=function(a,b,c){var d=this;Ext.getCmp(this.id).setWidth(this.panel.getWidth()),this.dygraphObject=new StdDevDyGraph(this.id,{width:this.panel.getWidth()-20,height:this.height-10,xlabel:this.xlabel,showRangeSelector:this.showRangeSelector,interactionModel:this.interactionModel,scaled:this.scaled}),this.dygraphObject.draw(a,b,c);var d=this;this.dygraphObject.onZoomX.attach(function(a,b){try{d.onZoomX.notify(b)}catch(c){}}),this.dygraphObject.onResetZoom.attach(function(a,b){try{d.onResetZoom.notify(b)}catch(c){}}),this.dygraphObject.dblclick.attach(function(a,b){try{d.dblclick.notify(b)}catch(c){}})},HPLCGraph.prototype.loadData=function(a){var b=this;this.reloadData(a),this.panel.addDocked({cls:"hplcMenu",xtype:"toolbar",items:this.getMenu()}),1==this.bbar&&this.panel.addDocked({border:1,xtype:"toolbar",dock:"bottom",cls:"hplcMenu",items:[{xtype:"numberfield",id:"main_field_start",fieldLabel:"Range from",width:200,labelWidth:100,value:0,minValue:0},{xtype:"numberfield",id:"main_field_end",fieldLabel:"to",width:130,labelWidth:30,value:0,minValue:0},{xtype:"button",text:"Go",handler:function(){var a=parseFloat(Ext.getCmp("main_field_start").getValue()),c=parseFloat(Ext.getCmp("main_field_end").getValue());if(0>a&&(a=0),0>c&&(c=0),a>c){var d=c;c=a,a=d}b.dygraphObject.dygraph.updateOptions({isZoomedIgnoreProgrammaticZoom:!0,dateWindow:[a,c]})}},"->",{xtype:"button",text:"Clear Selection",handler:function(){b.onClearSelection.notify()}}]})},HPLCGraph.prototype.getPanel=function(){return this.panel=Ext.create("Ext.panel.Panel",{padding:this.plotPanelPadding,items:[{html:"",id:this.id,flex:1,height:this.height}]}),this.panel.on("afterrender",function(a){document.getElementById(this.id).setAttribute("style","border: 1px solid #000000; height:"+(a.getHeight()-1)+"px;width:"+(a.getWidth()-50)+"px;")}),this.panel},HPLCGraph.prototype.input=function(){return DATADOC.getHPLCData()},HPLCGraph.prototype.getDataByFrameNumber=function(a){var b={};b.frameNumber=a;for(var c in this.hplcData)b[this.hplcData[c].label]=this.hplcData[c].data[a];return b},HPLCGraph.prototype.test=function(a){var b=new HPLCGraph({title:"I0",width:800,height:400,plots:{I0:!0,Rg:!0,Mass:!0},xlabel:"HPLC Frames",scaled:this.scaled,interactionModel:{dblclick:function(a,b,c){}}});b.getPanel().render(a),b.loadData(b.input())},MergesHPLCGraph.prototype.scaledData=HPLCGraph.prototype.scaledData,MergesHPLCGraph.prototype.divideValuesByMax=HPLCGraph.prototype.divideValuesByMax,MergesHPLCGraph.prototype.getMaxAndMinValue=HPLCGraph.prototype.getMaxAndMinValue,MergesHPLCGraph.prototype.getPoint=HPLCGraph.prototype.getPoint,MergesHPLCGraph.prototype.reloadData=HPLCGraph.prototype.reloadData,MergesHPLCGraph.prototype._renderDygraph=HPLCGraph.prototype._renderDygraph,MergesHPLCGraph.prototype.loadData=HPLCGraph.prototype.loadData,MergesHPLCGraph.prototype.getPanel=HPLCGraph.prototype.getPanel,MergesHPLCGraph.prototype.getDataByFrameNumber=HPLCGraph.prototype.getDataByFrameNumber,MergesHPLCGraph.prototype.setPeaks=function(a){this.peaks=a,this.peakKeys=[],this.colorPeak={};var b=1;for(var c in this.peaks)if(this.peaks.hasOwnProperty(c)){var d=this.peakColors[b%this.peakColors.length];b+=1,this.peakKeys.push(c),this.colorPeak[c]=d}this.peakKeys.sort()},MergesHPLCGraph.prototype.getMenu=function(){function a(a,c){c?b.plots[a.param]=!0:delete b.plots[a.param],b.reloadData(b.hplcData)}var b=this,c=[];if(null!=this.peaks){for(var d=[],e=0;e<this.peakKeys.length;e++){var f=this.colorPeak[this.peakKeys[e]];d.push({text:"<span style='color:"+f+"; font-weight:bold;'>Peak #"+e+" "+this.peakKeys[e].replace("- "," to #").replace(".0","").replace(".0","")+"</span>",peakid:this.peakKeys[e],checked:!1,checkHandler:function(b,c){var d=new Object;d.param=b.peakid,a(d,c)}})}var g=Ext.create("Ext.menu.Menu",{id:"mainMenu",style:{overflow:"visible"},items:d}),h=Ext.create("Ext.toolbar.Toolbar");h.add({text:"Peaks Avg.",menu:g}),c.push(h)}for(var e=0;e<this.hplcData.length;e++)if(0!=this.hplcData[e].showOnMenu){var i=this.hplcData[e].param,j="style='padding:0 0px 0 5px;'";c.push({text:"<table><tr><td>"+BUI.getRectangleColorDIV(this.hplcData[e].color,10,10)+"</td><td "+j+"> "+this.hplcData[e].label+"</td></tr></table>",id:b.id+i,param:i,enableToggle:!0,scope:this,margin:5,toggleHandler:a,pressed:null!=b.plots[i]})}return c.push("->"),c.push({text:"Save",scope:this,icon:"images/icon/ic_get_app_black_24dp.png",handler:function(a,b){var c=document.createElement("img");c.style.display="block",c.style.width="200px",c.style.height="200px",c.setAttribute("src",Dygraph.Export.asCanvas(this.dygraphObject.dygraph).toDataURL()),window.open(Dygraph.Export.asCanvas(this.dygraphObject.dygraph).toDataURL(),"Image","")}}),c},MergesHPLCGraph.prototype.input=function(){return DATADOC.getScatteringHPLCFrameData()},MergesHPLCGraph.prototype.test=function(a){var b=new MergesHPLCGraph({title:"Scattering",width:this.plotWidth,height:500,showRangeSelector:!1,xParam:0,xlabel:"scattering_I",plots:{scattering_I:!0,subtracted_I:!0,buffer_I:!0}});b.getPanel().render(a),b.loadData(b.input())},MacromoleculeForm.prototype._getFieldTextWithHelp=function(a,b,c,d){return Ext.create("Ext.container.Container",{items:[{xtype:a,fieldLabel:b,name:c,id:this.id+c},{xtype:"label",forId:"myFieldId",text:d,margin:"5 0 0 105",cls:"inline-help"}]})},MacromoleculeForm.prototype._getNumericWithHelp=function(a,b,c,d){return Ext.create("Ext.container.Container",{margin:"0 0 0 10",items:[{xtype:a,fieldLabel:b,name:c,id:this.id+c,decimalPrecision:6,width:220},{xtype:"label",forId:"myFieldId",text:d,margin:"5 0 0 10",cls:"inline-help"}]})},MacromoleculeForm.prototype._getButtons=function(){var a=this;return[{text:"Save",handler:function(){a._save()}}]},MacromoleculeForm.prototype._persist=function(a,b,c,d,e,f,g,h){var i=Ext.getCmp("proposalIdCombo").getValue();if(null==i)return void BUI.showError("Please select a proposal");if(null==a&&null!=EXI.proposalManager.getMacromoleculeByAcronym(b))return void BUI.showError("Duplicated acronym");null==a?(this.macromolecule={},this.macromolecule.macromoleculeId=null):this.macromolecule.macromoleculeId=a,this.macromolecule.acronym=b,this.macromolecule.name=c,this.macromolecule.molecularMass=d,this.macromolecule.extintionCoefficient=e,this.macromolecule.comments=f,this.macromolecule.symmetry=Ext.getCmp(this.id+"comboSym").getValue(),this.macromolecule.refractiveIndex=g,this.macromolecule.solventViscosity=h,this.macromolecule.proposalId=i;var j=this,k=function(a,b){var c=function(a,b){j.panel.setLoading(!1),j.onSave.notify(),j.onClose.notify()};j.panel.setLoading("Updading proposal information"),EXI.getDataAdapter({onSuccess:c}).proposal.proposal.update()};this.panel.setLoading("Saving Macromolecule"),EXI.getDataAdapter({onSuccess:k}).saxs.macromolecule.saveMacromolecule(this.macromolecule)},MacromoleculeForm.prototype._save=function(){var a=this._getField("acronym"),b=this._getField("name"),c=this._getField("molecularMass"),d=this._getField("extintionCoefficient"),e=this._getField("comments"),f=this._getField("refractiveIndex"),g=this._getField("solventViscosity");return""==b?void BUI.showError("Name field is mandatory"):""==a?void BUI.showError("Acroynm field is mandatory"):void(null!=this.macromolecule?null==this.macromolecule.macromoleculeId?this._persist(null,a,b,c,d,e,f,g):this._persist(this.macromolecule.macromoleculeId,a,b,c,d,e,f,g):this._persist(null,a,b,c,d,e,f,g))},MacromoleculeForm.prototype._getItems=function(){var a=Ext.create("Ext.data.Store",{fields:["s"],data:this._getSymmetries()});return this.symmetryComboBox=Ext.create("Ext.form.ComboBox",{fieldLabel:"Symmetry",store:a,id:this.id+"comboSym",queryMode:"local",displayField:"s",valueField:"s",value:"P1",margin:"0 0 0 30",width:220}),[BIOSAXS_COMBOMANAGER.getComboProposal({labelWidth:100}),this._getFieldTextWithHelp("requiredtextfield","Name","name","Long name. i.e: Bovine serum albumin"),this._getFieldTextWithHelp("requiredtextfield","Acronym","acronym","Acronym will be used in the files and analisys. i.e: BSA"),this._getFieldTextWithHelp("textfield","Mol. Mass (Da)","molecularMass","Atomic mass estimation measured in Da"),{xtype:"container",layout:"hbox",margin:"10 0 0 0",items:[this._getNumericWithHelp("numberfield","Extinction coef.","extintionCoefficient",""),this.symmetryComboBox]},{xtype:"container",layout:"hbox",margin:"5 0 0 0",items:[this._getNumericWithHelp("numberfield","Refractive Index","refractiveIndex","How radiation propagates through the medium"),this._getNumericWithHelp("numberfield","Solvent Viscosity","solventViscosity","")]},{id:this.id+"comments",xtype:"textareafield",name:"comments",margin:"35 0 0 10",fieldLabel:"Comments",width:this.width-100,height:100}]},MacromoleculeForm.prototype._getSymmetries=function(){return[{s:"P1"},{s:"P2"},{s:"P3"},{s:"P4"},{s:"P5"},{s:"P6"},{s:"P32"},{s:"P42"},{s:"P52"},{s:"P62"},{s:"P222"}]},MacromoleculeForm.prototype.getPanel=function(){return this.panel=Ext.create("Ext.panel.Panel",{layout:"hbox",buttons:this._getButtons(),cls:"border-grid",items:[{xtype:"container",margin:"20 0 0 20",layout:"vbox",items:this._getItems()}]}),this.panel},MacromoleculeForm.prototype._populateField=function(a,b){null!=b&&Ext.getCmp(this.id+a).setValue(b)},MacromoleculeForm.prototype._getField=function(a){return Ext.getCmp(this.id+a).getValue()},MacromoleculeForm.prototype.load=function(a){this.macromolecule=a,null!=a&&(this._populateField("name",a.name),this._populateField("acronym",a.acronym),this._populateField("extintionCoefficient",a.extintionCoefficient),this._populateField("molecularMass",a.molecularMass),this._populateField("comments",a.comments),this._populateField("refractiveIndex",a.refractiveIndex),this._populateField("solventViscosity",a.solventViscosity),null!=a.symmetry&&Ext.getCmp(this.id+"comboSym").setValue(a.symmetry),null!=this.macromolecule.proposalId&&(Ext.getCmp("proposalIdCombo").setValue(this.macromolecule.proposalId),Ext.getCmp("proposalIdCombo").disable()))},MacromoleculeForm.prototype.input=function(){return{}},MacromoleculeForm.prototype.test=function(a){var b=new MacromoleculeForm;b.onClose.attach(function(a){alert("Click on close")});var c=b.getPanel();c.render(a)},MacromoleculeGrid.prototype.edit=function(a){var b=this,c=new MacromoleculeWindow;c.onSave.attach(function(a){b.store.loadData(EXI.proposalManager.getMacromolecules())}),c.draw(a)},MacromoleculeGrid.prototype.getTbar=function(){var a=this,b=[];return b.push(Ext.create("Ext.Action",{icon:"images/icon/add.png",text:"Add",disabled:!1,handler:function(b,c){a.edit()}})),b.push("->"),b.push(Ext.create("Ext.Action",{icon:"images/icon/refresh.png",text:"Update From SMIS",tooltip:"Retrieve all the macromolecules of your proposal from SMIS database",disabled:!1,handler:function(b,c){a.grid.setLoading("Connecting to SMIS");var d=new BiosaxsDataAdapter;d.onSuccess.attach(function(b,c){BIOSAXS.proposal.setMacromolecules(c.macromolecules),a.refresh(BIOSAXS.proposal.macromolecules),a.grid.setLoading(!1)}),d.onError.attach(function(b,c){a.grid.setLoading(!1)}),d.updateDataBaseFromSMIS()}})),b},MacromoleculeGrid.prototype.deselectAll=function(){this.grid.getSelectionModel().deselectAll()},MacromoleculeGrid.prototype.selectById=function(a){this.grid.getSelectionModel().deselectAll();for(var b=0;b<this.grid.getStore().data.items.length;b++){var c=this.grid.getStore().data.items[b].raw;c.macromoleculeId==a&&this.grid.getSelectionModel().select(b)}},MacromoleculeGrid.prototype.load=function(a){this.store.loadData(a,!1)},MacromoleculeGrid.prototype.getColumns=function(){var a=this,b=[{text:"Acronym",dataIndex:"acronym",id:this.id+"acronym",flex:1,renderer:function(b,c,d,e,f,g){return null!=a.cssFontStyle?"<span style='"+a.cssFontStyle+"'>"+b+"</span>":b}},{text:"Name",dataIndex:"name",id:this.id+"name",flex:1,hidden:!1},{text:"Comments",dataIndex:"comments",id:this.id+"comments",flex:1,hidden:!1}];return this.btnEditVisible&&b.push({xtype:"actioncolumn",width:40,text:"Edit",items:[{icon:"images/icon/edit.png",tooltip:"Edit",handler:function(b,c,d){var e=b.getStore().getAt(c);a.edit(EXI.proposalManager.getMacromoleculeById(e.get("macromoleculeId")))}}]}),this.btnRemoveVisible&&b.push({id:a.id+"buttonRemoveMacromolecule",width:85,sortable:!1,renderer:function(b,c,d,e,f,g){return a.btnRemoveVisible?BUI.getRedButton("REMOVE"):null}}),b},MacromoleculeGrid.prototype._prepareData=function(a){return a},MacromoleculeGrid.prototype.getPanel=function(a){var b=this;this.store=Ext.create("Ext.data.Store",{fields:["macromoleculeId","name","acronym","comments"],data:b._prepareData(a)}),this.store.sort("acronym");var c="Ext.grid.Panel";1==this.searchBar&&(c="Ext.ux.LiveSearchGridPanel");var d=null;return this.multiselect&&(d=Ext.create("Ext.selection.CheckboxModel",{multiSelect:this.multiselect,listeners:{selectionchange:function(a,c){for(var d=[],e=0;e<c.length;e++)d.push(c[e].raw);b.onSelected.notify(d)}}})),this.grid=Ext.create(c,{id:this.id,title:"Macromolecules",collapsible:this.collapsible,collapsed:this.collapsed,store:this.store,height:this.height,maxHeight:this.maxHeight,selModel:d,allowDeselect:!0,columns:this.getColumns(),width:this.width,viewConfig:{stripeRows:!0,listeners:{celldblclick:function(a,c,d,e,f,g,h,i){b.edit(EXI.proposalManager.getMacromoleculeById(e.data.macromoleculeId))},cellclick:function(a,c,d,e,f,g,h,i){a.getGridColumns()[d].getId()==b.id+"buttonEditMacromolecule"&&b.edit(EXI.proposalManager.getMacromoleculeById(e.data.macromoleculeId)),a.getGridColumns()[d].getId()==b.id+"buttonRemoveMacromolecule"&&BUI.showBetaWarning()}}}}),this.tbar&&this.grid.addDocked({xtype:"toolbar",height:50,items:this.getTbar()}),this.grid},MacromoleculeGrid.prototype.input=function(){return{proposal:DATADOC.getProposal_10()}},MacromoleculeGrid.prototype.test=function(a){var b=new MacromoleculeGrid({width:800,height:350,collapsed:!1,tbar:!0});BIOSAXS.proposal=new Proposal(b.input().proposal);var c=b.getPanel(BIOSAXS.proposal.macromolecules);c.render(a)},MeasurementCreatorStepWizardForm.prototype.setData=function(a){this.data.measurementsSelected=a;for(var b={},c={},d=0;d<this.data.measurementsSelected.length;d++){var e=this.data.measurementsSelected[d];null==b[e.bufferId]&&(b[e.bufferId]={buffer:e.buffer_acronym,bufferId:e.bufferId,volume:0,concentration:0});var f=e.macromoleculeId+"_"+e.bufferId+"_"+e.concentration;null==c[f]&&(c[f]={macromolecule:e.acronym,macromoleculeId:e.macromoleculeId,buffer:e.buffer_acronym,bufferId:e.bufferId,volume:0,concentration:e.concentration}),b[e.bufferId].volume=Number(b[e.bufferId].volume)+2*e.volumeToLoad,c[f].volume=Number(c[f].volume)+e.volumeToLoad}},MeasurementCreatorStepWizardForm.prototype.getSingleMeasurementForm=function(){var a=BIOSAXS_COMBOMANAGER.getComboMacromoleculeByMacromolecules(this.macromolecules,{width:250,labelWidth:100}),b=BIOSAXS_COMBOMANAGER.getComboBuffers(this.buffers,{margin:"0 0 0 50",width:250,labelWidth:100}),c=Ext.create("Ext.Button",{width:200,height:25,margin:"0 0 20 300",text:"Add",scope:this,handler:function(){for(var c=Ext.getCmp(this.id+"quantity").getValue(),d=[],e=0;c>e;e++)d.push({acronym:EXI.proposalManager.getMacromoleculeById(a.getValue()).acronym,macromoleculeId:a.getValue(),bufferId:b.getValue(),buffer_acronym:EXI.proposalManager.getBufferById(b.getValue()).acronym,concentration:Ext.getCmp(this.id+"conc").getValue(),volumeToLoad:Ext.getCmp(this.id+"volume").getValue(),exposureTemperature:Ext.getCmp(this.id+"seu").getValue(),transmission:Ext.getCmp(this.id+"transmission").getValue(),waitTime:Ext.getCmp(this.id+"waitTime").getValue(),viscosity:Ext.getCmp(this.id+"viscosity").getValue(),flow:Ext.getCmp(this.id+"flow").getValue()});this.measurementGrid.store.loadData(d,!0),this.setData(JSON.parse(Ext.encode(Ext.pluck(this.measurementGrid.grid.getStore().data.items,"data"))))}});return Ext.create("Ext.panel.Panel",{padding:"0 0 0 0",margin:"0 10 0 0",height:240,width:1150,cls:"border-grid",items:[{xtype:"container",layout:"hbox",margin:"10 10 0 10",items:[a,b,{xtype:"numberfield",id:this.id+"quantity",fieldLabel:"Repeat",labelWidth:100,width:220,margin:"5 0 0 120",minValue:0,maxValue:300,value:1}]},{xtype:"container",layout:"hbox",margin:"10 10 0 10",items:[{xtype:"numberfield",id:this.id+"conc",fieldLabel:"Conc. (mg/ml)",labelWidth:100,width:220,margin:"5 0 0 0",minValue:0,maxValue:300,value:1},{xtype:"numberfield",id:this.id+"seu",fieldLabel:"Exposure. Temp.",labelWidth:100,width:220,margin:"5 0 0 80",value:4,minValue:4,maxValue:60}]},{xtype:"container",margin:"10 10 0 10",layout:"hbox",items:[{xtype:"numberfield",id:this.id+"volume",fieldLabel:"Vol. To Load (&#181l)",labelWidth:100,width:220,value:40,margin:"5 0 0 0",minValue:10,maxValue:300},{xtype:"numberfield",id:this.id+"transmission",fieldLabel:"Transmission (%)",labelWidth:100,width:220,margin:"5 0 0 80",value:100,minValue:0,maxValue:100}]},{xtype:"container",layout:"hbox",margin:"10 10 0 10",items:[{xtype:"numberfield",id:this.id+"waitTime",fieldLabel:"Wait Time",labelWidth:100,width:220,value:0,minValue:0,maxValue:100},{xtype:"combo",id:this.id+"viscosity",store:["low","medium","high"],fieldLabel:"SC Viscosity",value:"low",labelWidth:100,width:220,margin:"0 0 0 80"},{xtype:"checkbox",id:this.id+"flow",checked:!0,fieldLabel:"Flow",labelWidth:100,width:250,margin:"0 0 0 80"}]},{xtype:"container",layout:"hbox",margin:"10 0 0 0",items:[c]}]})},MeasurementCreatorStepWizardForm.prototype.getConcentrationMeasurementForm=function(){var a=BIOSAXS_COMBOMANAGER.getComboMacromoleculeByMacromolecules(this.macromolecules,{width:300,labelWidth:100}),b=BIOSAXS_COMBOMANAGER.getComboBuffers(this.buffers,{width:300,labelWidth:100}),c=Ext.create("Ext.Button",{width:200,height:25,margin:"0 0 20 300",text:"Add",scope:this,handler:function(){for(var c=a.getValue(),d=b.getValue(),e=Ext.getCmp(this.id+"_cs_conc").getValue(),f=Ext.getCmp(this.id+"_cs_volume").getValue(),g=Ext.getCmp(this.id+"_cs_transmission").getValue(),h=Ext.getCmp(this.id+"_cs_seu").getValue(),i=Ext.getCmp(this.id+"_cs_waitTime").getValue(),j=Ext.getCmp(this.id+"_cs_viscosity").getValue(),k=Ext.getCmp(this.id+"_cs_flow").getValue(),l=[],m=1;e>=m;m++)l.push({acronym:EXI.proposalManager.getMacromoleculeById(c).acronym,macromoleculeId:c,bufferId:d,buffer_acronym:EXI.proposalManager.getBufferById(d).acronym,concentration:m,volumeToLoad:f,exposureTemperature:h,transmission:g,waitTime:i,viscosity:j,flow:k});this.measurementGrid.store.loadData(l,!0),this.setData(JSON.parse(Ext.encode(Ext.pluck(this.measurementGrid.store.data.items,"data"))))}});return Ext.create("Ext.panel.Panel",{margin:"0 10 0 0",height:200,width:1150,cls:"border-grid",items:[{xtype:"container",layout:"hbox",items:[{xtype:"numberfield",id:this.id+"_cs_conc",fieldLabel:"How many unknow concentrations do you have?",labelWidth:300,width:500,margin:"5 0 0 10",minValue:1,maxValue:20,value:1}]},{xtype:"container",margin:"10 0 0 10",layout:"hbox",items:[a,{xtype:"numberfield",id:this.id+"_cs_seu",fieldLabel:"Exposure. Temp.",labelWidth:100,width:220,margin:"5 0 0 20",value:4,minValue:4,maxValue:60},{xtype:"numberfield",margin:"5 0 0 50",id:this.id+"_cs_volume",fieldLabel:"Vol. To Load (&#181l)",labelWidth:100,width:220,value:40,minValue:10,maxValue:300},{xtype:"numberfield",id:this.id+"_cs_transmission",fieldLabel:"Transmission (%)",labelWidth:100,width:220,margin:"5 0 0 50",value:100,minValue:0,maxValue:100}]},{xtype:"container",layout:"hbox",margin:"5 0 0 10",items:[b,{xtype:"numberfield",id:this.id+"_cs_waitTime",fieldLabel:"Wait Time",labelWidth:100,width:220,value:0,minValue:0,maxValue:100,margin:"5 0 0 20"},{xtype:"combo",id:this.id+"_cs_viscosity",store:["low","medium","high"],fieldLabel:"SC Viscosity",value:"low",margin:"5 0 0 50",labelWidth:100,width:220},{xtype:"checkbox",id:this.id+"_cs_flow",fieldLabel:"Flow",checked:!0,labelWidth:100,width:250,margin:"0 0 0 80"}]},{xtype:"container",layout:"hbox",margin:"20 0 0 0",items:[c]}]})},MeasurementCreatorStepWizardForm.prototype.getHeaderForm=function(){return this.panel=Ext.create("Ext.panel.Panel",{layout:"hbox",height:100,items:[{xtype:"textfield",name:"Name",id:this.id+"name",width:400,labelWidth:50,fieldLabel:"Name",margin:"20 20 20 20",value:""},{id:this.id+"comments",xtype:"textareafield",name:"comments",fieldLabel:"Comments",height:75,labelWidth:100,margin:"20 20 20 50",width:600}]}),this.panel},MeasurementCreatorStepWizardForm.prototype.getForm=function(){var a=this;return this.formPanel=Ext.create("Ext.tab.Panel",{padding:"0 0 0 0",plain:!0,margin:"20 5 20 10",height:290,items:[{tabConfig:{title:"Concentration Series"},items:this.getConcentrationMeasurementForm()},{tabConfig:{title:"Individual Measurement"},items:[this.getSingleMeasurementForm()]}]}),this.measurementGrid=new MeasurementGrid({height:250,maxHeight:250,minHeight:250,width:1150,tbar:!1,maxWidth:870,resizable:!1,margin:"0 10 10 10",isStatusColumnHidden:!0,isTimeColumnHidden:!0,removeBtnEnabled:!0,isPriorityColumnHidden:!0}),this.measurementGrid.onRemoved.attach(function(b,c){a.setData(JSON.parse(Ext.encode(Ext.pluck(a.measurementGrid.grid.getStore().data.items,"data"))))}),this.panel=Ext.create("Ext.panel.Panel",{plain:!0,frame:!1,border:0,items:[this.getHeaderForm(),this.formPanel,this.addButton,this.measurementGrid.getPanel([])]}),null!=this.data.measurementsSelected&&(this.measurementGrid.grid.getStore().loadData(this.data.measurementsSelected,!1),this.setData(JSON.parse(Ext.encode(Ext.pluck(this.measurementGrid.grid.getStore().data.items,"data"))))),this.panel},MeasurementCreatorStepWizardForm.prototype.getBuffers=function(a){for(var b={},c=null,d=0;d<a.length;d++)c=a[d],null==b[c.bufferId]&&(b[c.bufferId]={buffer:c.buffer_acronym,bufferId:c.bufferId,volumeToLoad:c.volumeToLoad,volume:0,concentration:0,transmission:c.transmission,flow:c.flow,viscosity:c.viscosity}),b[c.bufferId].volume=Number(b[c.bufferId].volume)+2*c.volumeToLoad;var e=[];for(var f in b)b.hasOwnProperty(f)&&(c=b[f],e.push({bufferId:c.bufferId,buffer:EXI.proposalManager.getBufferById(c.bufferId).acronym,concentration:c.concentration,volume:c.volume,volumeToLoad:c.volumeToLoad,transmission:c.transmission,flow:c.flow,viscosity:c.viscosity}));return e},MeasurementCreatorStepWizardForm.prototype.parseMeasurements=function(a){var b=[],c=null,d=null,e=this.getBuffers(a);for(d=0;d<e.length;d++)c=e[d],b.push({SEUtemperature:"",buffer:c.buffer,buffername:c.buffer,code:c.buffer,comments:"",concentration:0,enable:!0,flow:c.flow,recuperate:!1,title:"",transmission:c.transmission,macromolecule:c.buffer,type:"Buffer",typen:1,viscosity:c.viscosity,volume:c.volume,volumeToLoad:c.volumeToLoad,waittime:0,plate:null,row:null,well:null});for(d=0;d<a.length;d++){c=a[d];var f="Buffer",g="";null!=c.macromoleculeId&&(f="Sample",
g=EXI.proposalManager.getMacromoleculeById(c.macromoleculeId).acronym),b.push({SEUtemperature:c.exposureTemperature,buffer:c.buffer_acronym,buffername:c.buffer_acronym,code:g,comments:"",concentration:c.concentration,enable:!0,flow:c.flow,recuperate:!1,title:"",transmission:c.transmission,macromolecule:g,type:f,typen:1,viscosity:c.viscosity,volume:c.volumeToLoad,volumeToLoad:c.volumeToLoad,waittime:c.waitTime,plate:null,row:null,well:null})}var h=new SampleAutomaticPositionFactory(b);return h.setPosition()},MeasurementCreatorStepWizardForm.prototype.getNextForm=function(){return new FinalStepWizardForm(JSON.stringify(this.parseMeasurements(this.data.measurementsSelected)))},SampleAutomaticPositionFactory.prototype.getAvailablePlates=function(){for(var a=EXI.proposalManager.getPlateByFlavour(),b=[],c=[],d=0;d<a.length;d++)if(2==a[d].plateTypeId){for(var e=0;12>e;e++)b.push({plate:2,row:Math.floor(e/3)+1,well:Number(Number(e%3)+9)});for(var f=0,e=0;32>e;e++){var g={plate:2,row:Math.floor(e/8)+1,well:Number(e%8)+1-f};c.push(g)}}for(var d=0;d<a.length;d++)if(2!=a[d].plateTypeId){for(var h=0;h<a[d].rowCount;h++)for(var i=0;i<a[d].columnCount;i++)b.push({plate:d+1,row:h+1,well:i+1});for(var h=0;h<a[d].rowCount;h++)for(var i=0;i<a[d].columnCount;i++)c.push({plate:d+1,row:h+1,well:i+1})}return{buffer:b.reverse(),sample:c.reverse()}},SampleAutomaticPositionFactory.prototype._getKey=function(a,b,c){return a+":"+b+"-"+c},SampleAutomaticPositionFactory.prototype.setPosition=function(){for(var a=this.getAvailablePlates(),b={},c=0;c<this.samples.length;c++)if("Buffer"==this.samples[c].type){var d=this._getKey(this.samples[c].plate,this.samples[c].row,this.samples[c].well);this.samples[c].plate=a.buffer[a.buffer.length-1].plate,this.samples[c].row=a.buffer[a.buffer.length-1].row,this.samples[c].well=a.buffer[a.buffer.length-1].well,b[d]=!0,a.buffer.pop()}for(var e={},c=0;c<this.samples.length;c++)if("Sample"==this.samples[c].type){for(var d=this._getKey(a.sample[a.sample.length-1].plate,a.sample[a.sample.length-1].row,a.sample[a.sample.length-1].well);null!=b[d];)a.sample.pop(),d=this._getKey(a.sample[a.sample.length-1].plate,a.sample[a.sample.length-1].row,a.sample[a.sample.length-1].well);var f=this.samples[c].macromolecule+"_"+this.samples[c].buffer+"_"+this.samples[c].concentration;if(null!=e[f]){this.samples[c].plate=e[f].plate,this.samples[c].row=e[f].row,this.samples[c].well=e[f].well;continue}e[f]={plate:a.sample[a.sample.length-1].plate,row:a.sample[a.sample.length-1].row,well:a.sample[a.sample.length-1].well},this.samples[c].plate=a.sample[a.sample.length-1].plate,this.samples[c].row=a.sample[a.sample.length-1].row,this.samples[c].well=a.sample[a.sample.length-1].well,b[d]=!0,a.sample.pop()}return this.samples},MeasurementGrid.prototype.edit=function(a){var b=new MacromoleculeWindow;b.onSave.attach(function(a){}),b.draw(a)},MeasurementGrid.prototype.deselectAll=function(){this.grid.getSelectionModel().deselectAll()},MeasurementGrid.prototype.selectById=function(a){this.grid.getSelectionModel().deselectAll();for(var b=0;b<this.grid.getStore().data.items.length;b++){var c=this.grid.getStore().data.items[b].raw;c.macromoleculeId==a&&this.grid.getSelectionModel().select(b)}},MeasurementGrid.prototype.load=function(a){this.store.loadData(a,!1)},MeasurementGrid.prototype.loadExperiment=function(a){this.experimentList=new ExperimentList([a]);var b=this._prepareData(this.experimentList.getMeasurements(),this.experimentList);this.load(b)},MeasurementGrid.prototype._prepareData=function(a,b){for(var c=[],d=0;d<a.length;d++){var e=a[d],f=b.getSampleById(e.specimenId),g=EXI.proposalManager.getBufferById(f.bufferId);if(e.buffer_acronym=g.acronym,e.bufferId=g.bufferId,e.volume=f.volume,null!=f.macromolecule3VO&&(e.acronym=f.macromolecule3VO.acronym,e.macromoleculeId=f.macromolecule3VO.macromoleculeId),e.concentration=f.concentration,null!=e.run3VO){e.energy=e.run3VO.energy,e.expExposureTemperature=e.run3VO.exposureTemperature,e.storageTemperature=e.run3VO.storageTemperature,e.timePerFrame=e.run3VO.timePerFrame,e.radiationAbsolute=e.run3VO.radiationAbsolute,e.radiationRelative=e.run3VO.radiationRelative,e.status="DONE";try{null!=e.run3VO.timeStart&&""!=e.run3VO.timeStart&&(e.miliseconds=moment(e.run3VO.timeStart).format("X"))}catch(h){console.log(h)}}if(b.getDataCollectionByMeasurementId(e.measurementId).length>0)for(var i=b.getDataCollectionByMeasurementId(e.measurementId)[0].measurementtodatacollection3VOs,j=0;j<i.length;j++)if(1==i[j].dataCollectionOrder){var k=b.getSampleById(b.getMeasurementById(i[j].measurementId).specimenId);null!=k.sampleplateposition3VO&&(e.bufferSampleplateposition3VO=k.sampleplateposition3VO,e.bufferSampleplate=b.getSamplePlateById(k.sampleplateposition3VO.samplePlateId))}this.collapsed?null!=f.macromolecule3VO&&c.push(e):c.push(e)}return c},MeasurementGrid.prototype._getEditor=function(a){return null!=this.editor&&null!=this.editor[a]?this.editor[a]:null},MeasurementGrid.prototype.getColumns=function(){var a=this,b=[{text:"Order",dataIndex:"priority",flex:.3,hidden:a.isPriorityColumnHidden,sortable:!0,hidden:!0},{text:"Run Number",dataIndex:"code",flex:.5,hidden:!0,sortable:!0},{text:"Specimen",columns:[{text:"",dataIndex:"macromoleculeId",flex:1,hidden:!0,sortable:!0},{text:"Macromolecule",dataIndex:"acronym",flex:1,sortable:!0},{text:"Conc. ",dataIndex:"concentration",flex:1,sortable:!0},{text:"",dataIndex:"bufferId",flex:1,hidden:!0,sortable:!0},{text:"Buffer",dataIndex:"buffer_acronym",flex:1,renderer:function(a,b,c){return null!=c.data.bufferSampleplateposition3VO?EXI.proposalManager.getBufferById(c.data.bufferId).acronym+"<span style='font-style:oblique;'> Plate: ["+c.data.bufferSampleplate.slotPositionColumn+", "+BUI.getSamplePlateLetters()[c.data.bufferSampleplateposition3VO.rowNumber-1]+"-"+c.data.bufferSampleplateposition3VO.columnNumber+"]</span>":a},sortable:!0},{text:"Position",flex:1,hidden:!0}]},{text:"Parameters",columns:[{text:"Ex. Flow. time (s)",dataIndex:"extraFlowTime",flex:1,hidden:!0},{text:"Exp. Temp.",dataIndex:"exposureTemperature",flex:1,sortable:!0,editor:this._getEditor("exposureTemperature")},{text:"Vol. Load",dataIndex:"volumeToLoad",flex:.5,hidden:!1,editor:this._getEditor("volumeToLoad")},{text:"Volume in Well",dataIndex:"volume",hidden:!0,editor:this._getEditor("volume"),flex:1},{text:"Trans.",dataIndex:"transmission",flex:1,editor:this._getEditor("transmission")},{text:"Wait T.",dataIndex:"waitTime",editor:this._getEditor("waitTime"),flex:.5},{text:"Flow",dataIndex:"flow",editor:this._getEditor("flow"),flex:.3},{text:"Viscosity",dataIndex:"viscosity",tooltip:'The viscosity of a fluid is a measure of its resistance to gradual deformation by shear stress or tensile stress. For liquids, it corresponds to the informal notion of "thickness"',editor:this._getEditor("viscosity"),flex:.5}]},{text:"Status",dataIndex:"status",flex:1,hidden:a.isStatusColumnHidden,renderer:function(a,b,c){return null!=a?"<span style='font-weight: bold;'>"+a+"</span>":void 0}},{text:"Time",dataIndex:"time",flex:1,hidden:a.isTimeColumnHidden},{text:"Energy",dataIndex:"energy",flex:1,hidden:!0},{text:"Real Exp. Temp.(C)",flex:1,dataIndex:"expExposureTemperature",hidden:!0},{text:"Storage Temp.(C)",flex:1,dataIndex:"storageTemperature",hidden:!0},{text:"Time/Frame (s)",flex:1,dataIndex:"timePerFrame",hidden:!0},{text:"Radiation Relative",dataIndex:"radiationRelative",flex:1,hidden:!0},{text:"Radiation Absolute",dataIndex:"radiationAbsolute",flex:1,hidden:!0},{text:"Comments",dataIndex:"comments",flex:1,hidden:!0,editor:this._getEditor("comments")},{id:a.id+"buttonRemoveSample",text:"",hidden:!a.removeBtnEnabled,flex:1,renderer:function(b,c,d,e,f,g){return null!=d.data.macromoleculeId&&a.removeBtnEnabled?BUI.getRedButton("REMOVE"):void 0}}];return b},MeasurementGrid.prototype._getPlugins=function(){var a=this,b=[];return this.updateRowEnabled&&b.push(Ext.create("Ext.grid.plugin.RowEditing",{clicksToEdit:1,listeners:{validateedit:function(b,c){for(var d in a.editor)c.record.data[d]=c.newValues[d];c.record.data.comments=c.newValues.comments;var e=function(b,c){a.onMeasurementChanged.notify(c),a.grid.setLoading(!1)};a.grid.setLoading(),EXI.getDataAdapter({onSuccess:e}).saxs.measurement.saveMeasurement(c.record.data)}}})),b},MeasurementGrid.prototype.getPanel=function(){var a=this;this.store=Ext.create("Ext.data.Store",{fields:["macromoleculeId","name","acronym","comments"],data:[],sorters:this.sorter}),this.multiselect&&(this.selModel=Ext.create("Ext.selection.CheckboxModel",{multiSelect:this.multiselect,listeners:{selectionchange:function(b,c){for(var d=[],e=0;e<c.length;e++)d.push(c[e].raw);a.onSelected.notify(d)}}}));var b=(Ext.create("Ext.grid.plugin.RowEditing",{clicksToEdit:1,autoCancel:!0}),{});try{b=Ext.create("Ext.ux.StatusBar",{id:a.id+"basic-statusbar",defaultText:"Ready",text:"Ready",iconCls:"x-status-valid",items:[]})}catch(c){console.log("bbar error")}return this.grid=Ext.create("Ext.grid.Panel",{id:this.id,title:this.title,plugins:this._getPlugins(),margin:this.margin,store:this.store,height:this.height,maxHeight:this.maxHeight,columns:this.getColumns(),bbar:b,tbar:this._getMenu(),cls:"border-grid",viewConfig:{stripeRows:!0,getRowClass:function(a,b,c,d){return"DONE"==a.data.status?"green-row":void 0},listeners:{celldblclick:function(a,b,c,d,e,f,g,h){},cellclick:function(b,c,d,e,f,g,h,i){if(-1!=c.innerHTML.indexOf("REMOVE")&&(b.getStore().removeAt(g),null!=e.data.measurementId)){b.setLoading("ISPyB: Removing measurement");var j=function(c,d){b.setLoading(!1);var e=function(b,c){a.onRemoved.notify(c),a._showStatusBarReady("Ready")};EXI.getDataAdapter({onSuccess:e}).saxs.experiment.getExperimentById(a.experimentList.experiments[0].experimentId,"MEDIUM"),a._showStatusBarBusy("ISPyB: Removing Unused Specimens")};EXI.getDataAdapter({onSuccess:j}).saxs.measurement.removeMeasurement(e.data)}}}}}),this.grid},MeasurementGrid.prototype._showStatusBarReady=function(a){var b=Ext.getCmp(this.id+"basic-statusbar");b.setStatus({text:a,iconCls:"x-status-valid",clear:!1})},MeasurementGrid.prototype._showStatusBarBusy=function(a){var b=Ext.getCmp(this.id+"basic-statusbar");b.setStatus({text:a,iconCls:"x-status-busy",clear:!1})},MeasurementGrid.prototype._openAddMeasurementWindow=function(a,b){var c=this,d=new WizardWidget({windowMode:!0,width:1200});d.onFinished.attach(function(a,b){c.grid.setLoading(),d.window.close();var e=function(a,b){c.onExperimentChanged.notify(b),c.grid.setLoading(!1)};d.current.setLoading("ISPyB: Adding measurements"),EXI.getDataAdapter({onSuccess:e}).saxs.template.saveTemplate(b.name,b.comments,b.data,c.experimentList.experiments[0].experimentId)}),d.draw(null,new MeasurementCreatorStepWizardForm(EXI.proposalManager.getMacromolecules(),EXI.proposalManager.getBuffers(),{noNext:!0}))},MeasurementGrid.prototype._getMenu=function(){var a=this;if(this.tbar){var b=[];if(a.addBtnEnable&&b.push({icon:"../images/icon/add.png",text:"Add",handler:function(){a._openAddMeasurementWindow()}}),a.sortingBtnEnable){var c=Ext.create("Ext.button.Split",{text:"Sort by",icon:"../images/icon/sort.png",handler:function(){},menu:new Ext.menu.Menu({items:[{text:"First Created First Measured",handler:function(){a._sortBy("FIFO")}},"-",{text:"Default",handler:function(){a._sortBy("DEFAULT")}}]})});b.push(c)}a.collapseBtnEnable&&b.push({text:"Collapse buffers",enableToggle:!0,scope:this,toggleHandler:function(a,b){this.collapsed=b,this.grid.getStore().loadData(this._prepareData(this.measurements,this.experiments),!1)},pressed:this.collapsed});var d=Ext.create("Ext.toolbar.Toolbar",{cls:"exi-top-bar",height:45,items:b});return d}return null},MeasurementGrid.prototype._sortBy=function(a){var b=this,c=(new DataAdapter,function(a,c){b.onExperimentChanged.notify(c),b.grid.setLoading(!1)});b.grid.setLoading("Sorting"),EXI.getDataAdapter({onSuccess:c}).saxs.measurement.sortMeasurements(this.experimentList.experiments[0].experimentId,a)},MolarityForm.prototype._getNumericWithHelp=function(a,b,c,d){return Ext.create("Ext.container.Container",{margin:"10 0 0 10",items:[{xtype:a,fieldLabel:b,name:c,id:this.id+c,decimalPrecision:6},{xtype:"label",forId:"myFieldId",text:d,margin:"5 0 0 105",cls:"inline-help"}]})},MolarityForm.prototype._getItems=function(){return this.macromoleculeCombo=BIOSAXS_COMBOMANAGER.getComboMacromoleculeByMacromolecules(this.getMacromuleculesCandidates(this.macromolecule),{width:250,labelWidth:100,margin:10}),[{xtype:"container",flex:1,margin:"10 0 0 10",border:0,layout:"anchor",defaultType:"requiredtext",items:[this.macromoleculeCombo,this._getNumericWithHelp("textfield","Ratio","ratio","Number in assymmetric units")]}]},MolarityForm.prototype._persist=function(){var a=this,b=this.macromoleculeCombo.getValue(),c=Ext.getCmp(this.id+"ratio").getValue(),d="Not used yet",e=new BiosaxsDataAdapter;this.panel.setLoading("Saving"),e.onSuccess.attach(function(b,c){a.onSave.notify()}),e.saveStoichiometry(this.macromolecule.macromoleculeId,b,c,d)},MolarityForm.prototype._getButtons=function(){function a(){b.onClose.notify()}var b=this;return[{text:"Save",handler:function(){b._persist()}},{text:"Cancel",handler:function(){a()}}]},MolarityForm.prototype.getPanel=function(){return this.panel=Ext.create("Ext.form.Panel",{height:this.height,margin:2,border:1,defaultType:"requiredtext",items:this._getItems(),buttons:this._getButtons()}),this.panel},MolarityForm.prototype.getMacromuleculesCandidates=function(a){var b=[];if(BIOSAXS.proposal.macromolecules)for(var c=0;c<BIOSAXS.proposal.macromolecules.length;c++){var d=BIOSAXS.proposal.macromolecules[c];null!=this.macromolecule&&d.macromoleculeId!=this.macromolecule.macromoleculeId&&b.push(d)}return b},MolarityForm.prototype.refresh=function(a){this.macromolecule=a},MolarityForm.prototype.input=function(){return{}},MolarityForm.prototype.test=function(a){var b=new MolarityForm,c=b.getPanel();c.render(a)},MolarityGrid.prototype._getColumns=function(){return[{text:"Subunit",columns:[{text:"Acronym",width:100,hidden:!1,dataIndex:"acronym",sortable:!0},{text:"Name",width:125,hidden:!1,dataIndex:"name",sortable:!0},{text:"MM Est.",width:100,dataIndex:"molecularMass",sortable:!0,renderer:function(a,b,c){return BUI.formatValuesUnits(c.data.molecularMass,"Da",10,2)}}]},{text:"Ratio",width:100,dataIndex:"ratio",tooltip:"Number of times the subunit is present in the macromolecule",sortable:!0},{id:this.id+"MOLARITY_REMOVE",flex:.1,sortable:!1,renderer:function(a,b,c,d,e,f){return BUI.getRedButton("REMOVE")}}]},MolarityGrid.prototype._openMolarityWindow=function(){this.molarityWindow=Ext.create("Ext.window.Window",{title:"Molarity",height:220,width:500,modal:!0,items:[this.molarityForm.getPanel()]}).show()},MolarityGrid.prototype._getButtons=function(){var a=this;return[{text:"Add subunit",icon:"../images/add.png",handler:function(){a._openMolarityWindow()}}]},MolarityGrid.prototype.updateProposal=function(){var a=this;this.panel.setLoading(),BIOSAXS.proposal.onInitialized.attach(function(){if(null!=BIOSAXS.proposal)for(var b=BIOSAXS.proposal.macromolecules,c=0;c<b.length;c++)b[c].macromoleculeId==a.macromolecule.macromoleculeId&&(a.refresh(b[c]),a.panel.setLoading(!1))}),BIOSAXS.proposal.init()},MolarityGrid.prototype.getPanel=function(){var a=this;return this.molarityStore=Ext.create("Ext.data.Store",{fields:["acronym","ratio","comments","stoichiometryId","name","molecularMass"],sorters:{property:"ratio",direction:"DESC"}}),this.panel=Ext.create("Ext.grid.Panel",{store:this.molarityStore,height:this.height,padding:5,columns:this._getColumns(),listeners:{cellclick:function(b,c,d,e,f,g,h,i){if(b.getGridColumns()[d].getId()==a.id+"MOLARITY_REMOVE"){var j=new BiosaxsDataAdapter;j.onSuccess.attach(function(b){a.updateProposal()}),j.removeStoichiometry(e.data.stoichiometryId),a.panel.setLoading("Removing Structure")}}},tbar:this._getButtons()}),this.panel},MolarityGrid.prototype._prepareData=function(a){var b=[];if(null!=a.stoichiometry)for(var c=0;c<a.stoichiometry.length;c++){var d=BIOSAXS.proposal.getMacromoleculeById(a.stoichiometry[c].macromoleculeId);b.push({ratio:a.stoichiometry[c].ratio,acronym:d.acronym,comments:d.comments,molecularMass:d.molecularMass,stoichiometryId:a.stoichiometry[c].stoichiometryId,name:d.name})}return b},MolarityGrid.prototype.refresh=function(a){null!=a&&(this.molarityStore.loadData(this._prepareData(a)),this.molarityForm.refresh(a),this.macromolecule=a)},MolarityGrid.prototype.input=function(){return{proposal:DATADOC.getProposal_10(),dewars:DATADOC.getDewars_10()}},MolarityGrid.prototype.test=function(a){var b=new b({height:150});BIOSAXS.proposal=new Proposal(b.input().proposal);var c=b.getPanel(b.input().dewars);c.render(a)},DataSet.prototype.loadFromJSON=function(a){null!=a&&this.validate(a)&&(this.json=a)},DataSet.prototype.toJSON=function(a){return this.json},DataSet.prototype.validate=function(a){return!0};var DOM={};DOM.createNewElement=function(a,b,c){for(var d=document.createElement(a),e=0;e<c.length;e++)d.setAttribute(c[e][0],c[e][1]);return b.appendChild(d),d},DOM.createTextNode=function(a,b){var c=document.createTextNode(a);return b.appendChild(c),c},DOM.removeChilds=function(a){for(var b=document.getElementById(a);b.childNodes.length>0;)b.removeChild(b.childNodes[0])},DOM.select=function(a){return document.getElementById(a)},GraphCanvas.prototype.showLabels=function(a){this.args.labeled=a,this.removeLabels(),a&&this.renderLabels()},GraphCanvas.prototype.getSelectedVertices=function(){return this.args.selectedVertices},GraphCanvas.prototype.getSelectedEdges=function(){var a=[];for(var b in this.args.isEdgeSelected)a.push(b);return a},GraphCanvas.prototype.createSVGDom=function(a,b,c,d,e){var f=document.getElementById(a);return this._svg=SVG.createSVGCanvas(f,[["style","background-color:"+e+";"],["id",b],["dragx",0],["dragy",0],["height",this.getFormatter().getHeight()],["width",this.getFormatter().getWidth()]]),this._svg},GraphCanvas.prototype.isMultipleSelectionEnabled=function(){return this.args.multipleSelectionEnabled},GraphCanvas.prototype.setMultipleSelection=function(a){this.args.multipleSelectionEnabled=a,this.args.draggingCanvasEnabled=!a},GraphCanvas.prototype.setSelecting=function(a){this.selecting=a},GraphCanvas.prototype.setLinking=function(a){this.args.linkEnabled=a,this.selecting=!a,this.dragging=!a},GraphCanvas.prototype.setDraggingCanvas=function(a){this.args.draggingCanvasEnabled=a,this.args.multipleSelectionEnabled=!a},GraphCanvas.prototype.isDraggingCanvasEnabled=function(){return this.args.draggingCanvasEnabled},GraphCanvas.prototype.getScale=function(){return this.getFormatter().getZoomScale()},GraphCanvas.prototype.setScale=function(a){var b=document.getElementById(this.args.idGraph);b.setAttribute("transform",b.getAttribute("transform").replace("scale("+this.getScale()+")","scale("+a+")")),this.getFormatter().setZoomScale(a)},GraphCanvas.prototype.zoomIn=function(){this.setScale(this.getScale()+this.getFormatter().getZoomScaleStepFactor())},GraphCanvas.prototype.zoomOut=function(){this.setScale(this.getScale()-this.getFormatter().getZoomScaleStepFactor())},GraphCanvas.prototype.getSVGCoordenates=function(a){var b=this._svg.createSVGPoint();b.x=a.clientX,b.y=a.clientY;var c=this._svg.getScreenCTM(document.documentElement);return b=b.matrixTransform(c.inverse())},GraphCanvas.prototype.mouseClick=function(a){if(0==a.button){if(!this.args.interactive)return;this.isVertex(a.target)&&this.clickNode(this.getVertexIdFromSVGId(a.target.id)),this.dragging&&(this.dragging=!1)}},GraphCanvas.prototype.mouseMove=function(a){if(this.selecting){this.clearLabels();var b=this.getSVGCoordenates(a).x-this.selectorX,c=this.getSVGCoordenates(a).y-this.selectorY;b>0&&c>0&&this.displaySelection(this.selectorX,this.selectorY,b,c),b>0&&0>c&&this.displaySelection(this.selectorX,this.getSVGCoordenates(a).y,b,Math.abs(c)),0>b&&0>c&&this.displaySelection(this.getSVGCoordenates(a).x,this.getSVGCoordenates(a).y,Math.abs(b),Math.abs(c)),0>b&&c>0&&this.displaySelection(this.selectorX+b,this.selectorY,Math.abs(b),Math.abs(c));var d=(parseFloat(this.selectorSVGNode.getAttribute("x"))-DOM.select(this.id).getAttribute("dragx"))/this.getFormatter().getWidth(),e=(parseFloat(this.selectorSVGNode.getAttribute("y"))-DOM.select(this.id).getAttribute("dragy"))/this.getFormatter().getHeight(),f=d+parseFloat(this.selectorSVGNode.getAttribute("width")/this.getFormatter().getWidth()),g=e+parseFloat(this.selectorSVGNode.getAttribute("height")/this.getFormatter().getHeight());this.deselectNodes(this.getLayout());for(var h=this.getLayout().getVerticesByArea(d/this.getFormatter().getZoomScale(),e/this.getFormatter().getZoomScale(),f/this.getFormatter().getZoomScale(),g/this.getFormatter().getZoomScale()),i=0;i<h.length;i++)this.selectNode(h[i].getId()),this.renderLabel(h[i].getId())}var j=null;this.args.linking&&(j=this.getSVGCoordenates(a),null!=this.linkSVGNode&&(this.linkSVGNode.setAttribute("x2",j.x-2),this.linkSVGNode.setAttribute("y2",j.y-2))),this.dragging&&(j=this.getSVGCoordenates(a),j.x-=this.nMouseOffsetX,j.y-=this.nMouseOffsetY,this.desplazamientoX=this.getSVGCoordenates(a).x-this.dragStartX,this.desplazamientoY=this.getSVGCoordenates(a).y-this.dragStartY,null!=this.draggingElement&&(this.isNodeCanvas(this.draggingElement)?(j=this.getSVGCoordenates(a),j.x=this.desplazamientoX,j.y=this.desplazamientoY,this.draggingElement.setAttribute("dragx",j.x),this.draggingElement.setAttribute("dragy",j.y),this.draggingElement=document.getElementById(this.args.idGraph),this.draggingElement.setAttribute("transform","translate("+j.x+","+j.y+"), scale("+this.getScale()+")"),DOM.select(this.id).setAttribute("dragx",j.x),DOM.select(this.id).setAttribute("dragy",j.y),null!=this.NodeSVGbackgroundImage&&(this.NodeSVGbackgroundImage.setAttribute("dragx",j.x),this.NodeSVGbackgroundImage.setAttribute("dragy",j.y))):this.isVertex(this.draggingElement)?(this.selectNode(this.getVertexIdFromSVGId(this.draggingElement.id)),this.desplazamientoX=this.desplazamientoX/this.getFormatter().getZoomScale(),this.desplazamientoY=this.desplazamientoY/this.getFormatter().getZoomScale(),this.moveSelectedNodes(this.desplazamientoX,this.desplazamientoY),this.dragStartX=this.getSVGCoordenates(a).x,this.dragStartY=this.getSVGCoordenates(a).y):this.isNodeBackground(this.draggingElement)?(this.draggingElement.setAttribute("dragx",j.x),this.draggingElement.setAttribute("dragy",j.y),this.draggingElement=document.getElementById(this.args.idGraph),this.draggingElement.setAttribute("transform","translate("+j.x+","+j.y+"), scale("+this.getScale()+")")):this.draggingElement.setAttribute("transform","translate("+j.x+","+j.y+")")))},GraphCanvas.prototype.moveSelectedNodes=function(a,b){for(var c=0;c<this.getSelectedVertices().length;c++){var d=this.getSelectedVertices()[c],e=this.getSVGNodeId(d),f=parseFloat(DOM.select(e).getAttribute("dragx"))+parseFloat(a),g=parseFloat(DOM.select(e).getAttribute("dragy"))+parseFloat(b);this._movingNode(DOM.select(e),f,g)}},GraphCanvas.prototype.mouseDown=function(a){if(0==event.button){if(!this.args.interactive)return;var b=this.getSVGCoordenates(a);if((this.isNodeCanvas(a.target)||this.isNodeBackground(a.target))&&(this.deselectNodes(),this.deselectEdges(),this.onCanvasClicked.notify()),this.args.linkEnabled)return void(this.args.linking?(this.linkNodeTarget=this.getVertexIdFromSVGId(a.target.id),this.args.linking=!1,this.args.linkEnabled=!1,this.isVertex(a.target)&&this.getDataset().addEdge(this.linkNodeSource+"_"+this.linkNodeTarget,this.linkNodeSource,this.linkNodeTarget,{}),this.linkSVGNode.parentNode.removeChild(this.linkSVGNode)):(this.args.linking=!0,this.isVertex(a.target)&&(this.linkStartX=b.x,this.linkStartY=b.y,this.linkSVGNode=SVG.drawLine(b.x,b.y,b.x,b.y,this._svg,{stroke:"#FF0000"}),this.linkNodeSource=this.getVertexIdFromSVGId(a.target.id))));(this.isVertex(a.target)||this.isNodeCanvas(a.target)||this.isNodeBackground(a.target))&&this._startDragging(a),this.isEdge(a.target)&&this.selectEdge(this.getEdgeIdFromSVGId(a.target.getAttribute("id"))),this.args.multipleSelectionEnabled&&(this.dragging||(this.setSelecting(!0),this.selectorX=b.x,this.selectorY=b.y,this.displaySelection(b.x,b.y,1,1)))}1==event.button&&(this.setLinking(!1),this.setMultipleSelection(!1),this.selecting=!1,(this.isVertex(a.target)||this.isNodeCanvas(a.target)||this.isNodeBackground(a.target))&&this._startDragging(a))},GraphCanvas.prototype.mouseUp=function(a){if(this.args.interactive){if(this.dragging&&(this._stopDragging(a),this.isVertex(a.target))){var b=this.getVertexIdFromSVGId(a.target.id);this.getDataset().getVertexById(b).getEdges().length>=this.args.maxNumberEdgesMoving&&this.moveEdge(b)}if(this.selecting){this.setSelecting(!1);for(var c=(parseFloat(this.selectorSVGNode.getAttribute("x"))-DOM.select(this.id).getAttribute("dragx"))/this.getFormatter().getWidth(),d=(parseFloat(this.selectorSVGNode.getAttribute("y"))-DOM.select(this.id).getAttribute("dragy"))/this.getFormatter().getHeight(),e=c+parseFloat(this.selectorSVGNode.getAttribute("width")/this.formatter.getWidth()),f=d+parseFloat(this.selectorSVGNode.getAttribute("height")/this.formatter.getHeight()),g=this.getLayout().getVerticesByArea(c/this.getFormatter().getZoomScale,d/this.getFormatter().getZoomScale,e/this.getFormatter().getZoomScale,f/this.getFormatter().getZoomScale),h=0;h<g.length;h++)this.selectNode(g[h].getId());null!=this.selectorSVGNode&&this._svg.removeChild(this.selectorSVGNode),this.args.labeled&&(this.clearLabels(),this.renderLabels()),this.selectorSVGNode=null}}},GraphCanvas.prototype.displaySelection=function(a,b,c,d){null!=this.selectorSVGNode?(this.selectorSVGNode.setAttribute("x",a),this.selectorSVGNode.setAttribute("y",b),this.selectorSVGNode.setAttribute("width",c),this.selectorSVGNode.setAttribute("height",d)):this.selectorSVGNode=SVG.drawRectangle(a,b,c,d,this._svg,{fill:"red",stroke:"black",opacity:"0.2","stroke-opacity":"1"})},GraphCanvas.prototype._startDragging=function(a){if(this.isDraggingCanvasEnabled()||this.isNodeCanvas(a.target)&&(this.draggingElement=null),this.isVertex(a.target)||this.isNodeBackground(a.target)&&this.isDraggingCanvasEnabled()||this.isNodeCanvas(a.target)&&this.isDraggingCanvasEnabled()){this.clearLabels(),this.draggingElement=a.target,this.dragging=!0;var b=this.getSVGCoordenates(a);this.nMouseOffsetX=b.x-parseInt(a.target.getAttribute("dragx")),this.nMouseOffsetY=b.y-parseInt(a.target.getAttribute("dragy")),this.isVertex(a.target)?(this.dragStartX=parseInt(this.draggingElement.getAttribute("dragx"))*this.getFormatter().getZoomScale()+parseFloat(DOM.select(this.id).getAttribute("dragx")),this.dragStartY=parseInt(this.draggingElement.getAttribute("dragy"))*this.getFormatter().getZoomScale()+parseFloat(DOM.select(this.id).getAttribute("dragy"))):(this.dragStartX=b.x-parseInt(this.draggingElement.getAttribute("dragx")),this.dragStartY=b.y-parseInt(this.draggingElement.getAttribute("dragy")))}},GraphCanvas.prototype._stopDragging=function(a){this.nMouseOffsetX=0,this.nMouseOffsetX=0,this.dragging=!1,this.draggingElement=null,this.renderLabels(),this.setLinking(!1),this.setMultipleSelection(!0),this.selecting=!1},GraphCanvas.prototype.moveEdge=function(a){for(var b=this.getLayout().getNodeById(a).x*this.getFormatter().getWidth(),c=this.getLayout().getNodeById(a).y*this.getFormatter().getHeight(),d=0;d<this.getDataset().getVertexById(a).getEdgesOut().length;d++){var e=this.getDataset().getVertexById(a).getEdgesOut()[d].getId(),f=this.getSVGEdgeId(e),g=this.getFormatter().getEdgeById(e);g instanceof LineEdgeGraphFormatter&&(DOM.select(f+"_shadow").setAttribute("x2",b),DOM.select(f+"_shadow").setAttribute("y2",c),DOM.select(f).setAttribute("x2",b),DOM.select(f).setAttribute("y2",c)),(g instanceof DirectedLineEdgeGraphFormatter||g instanceof OdirectedLineEdgeGraphFormatter||g instanceof OdotDirectedLineEdgeGraphFormatter||g instanceof DotDirectedLineEdgeGraphFormatter||g instanceof CutDirectedLineEdgeGraphFormatter)&&(this.removeEdge(e),this.renderEdge(e))}for(var d=0;d<this.getDataset().getVertexById(a).getEdgesIn().length;d++){var e=this.getDataset().getVertexById(a).getEdgesIn()[d].getId(),f=this.getSVGEdgeId(e),g=this.getFormatter().getEdgeById(e);if(g instanceof LineEdgeGraphFormatter&&(DOM.select(f).setAttribute("x1",b),DOM.select(f).setAttribute("y1",c),DOM.select(f+"_shadow").setAttribute("x1",b),DOM.select(f+"_shadow").setAttribute("y1",c)),(g instanceof DirectedLineEdgeGraphFormatter||g instanceof OdirectedLineEdgeGraphFormatter||g instanceof OdotDirectedLineEdgeGraphFormatter||g instanceof DotDirectedLineEdgeGraphFormatter||g instanceof CutDirectedLineEdgeGraphFormatter)&&(this.removeEdge(e),this.renderEdge(e)),g instanceof BezierEdgeGraphFormatter){var h=this.getFormatter().getVertexById(a).getDefault().getSize()*this.getFormatter().getNodesMaxSize(),i=this.calculateCoordenatesBezier(h,b,c);DOM.select(f).setAttribute("d",i)}}},GraphCanvas.prototype.moveNode=function(a){var b=this.getLayout().getNodeById(a).x*this.getFormatter().getWidth(),c=this.getLayout().getNodeById(a).y*this.getFormatter().getHeight(),d=DOM.select(this.getSVGNodeId(a));d.setAttribute("dragx",b),d.setAttribute("dragy",c),d.setAttribute("transform","translate("+b+","+c+")"),this.getDataset().getVertexById(a).getEdges().length<this.args.maxNumberEdgesMoving&&this.moveEdge(a)},GraphCanvas.prototype._movingNode=function(a,b,c){var d=this.getVertexIdFromSVGId(a.getAttribute("id"));this.getLayout().getNodeById(d).setCoordinates(b/this.getFormatter().getWidth(),c/this.getFormatter().getHeight()),this.desplazamientoX=0,this.desplazamientoY=0,this.removeLabel(d),this.renderLabel(d)},GraphCanvas.prototype.init=function(){this._svg=this.createSVGDom(this.targetID,this.id,this.getFormatter().getWidth(),this.getFormatter().getHeight(),this.getFormatter().getBackgroundColor()),this.GraphGroup=SVG.drawGroup(this._svg,[["id",this.args.idGraph],["transform","translate(0,0), scale(1)"]]),this.GraphBackground=SVG.drawGroup(this.GraphGroup,[["id",this.args.idBackground]]),this.GraphEdgeGroup=SVG.drawGroup(this.GraphGroup,[["id",this.args.idEdgesGraph]]),this.GraphNodeGroup=SVG.drawGroup(this.GraphGroup,[["id",this.args.idNodesGraph]]),this.GraphLabelGroup=SVG.drawGroup(this.GraphGroup,[["id",this.args.idLabelGraph]]),null!=this.getFormatter().getBackgroundImage()&&""!=this.getFormatter().getBackgroundImage()&&this.setBackgroundImage(this.getFormatter().getBackgroundImage());var a=this;this._svg.addEventListener("click",function(b){a.mouseClick(b)},!1),this._svg.addEventListener("mousemove",function(b){a.mouseMove(b,a)},!1),this._svg.addEventListener("mousedown",function(b){a.mouseDown(b,a)},!1),this._svg.addEventListener("mouseup",function(b){a.mouseUp(b,a)},!1)},GraphCanvas.prototype.setBackgroundImage=function(){null!=this.NodeSVGbackgroundImage&&this.NodeSVGbackgroundImage.parentNode.removeChild(this.NodeSVGbackgroundImage),$("#"+this.targetID).svg(),$("#"+this.targetID).svg("get"),$("#"+this.targetID).svg("get")._svg=document.getElementById(this.id);var a=$("#"+this.targetID).svg("get");this.NodeSVGbackgroundImage=a.image(0,0,this.getFormatter().getWidth(),this.getFormatter().getHeight(),this.getFormatter().getBackgroundImage()),this.NodeSVGbackgroundImage.setAttribute("id",this.args.idBackgroundNode),this.NodeSVGbackgroundImage.setAttribute("x",0),this.NodeSVGbackgroundImage.setAttribute("y",0),this.NodeSVGbackgroundImage.setAttribute("dragx",0),this.NodeSVGbackgroundImage.setAttribute("dragy",0),null!=this.getFormatter().args.backgroundImageHeight&&this.NodeSVGbackgroundImage.setAttribute("height",this.getFormatter().args.backgroundImageHeight),null!=this.getFormatter().args.backgroundImageWidth&&this.NodeSVGbackgroundImage.setAttribute("width",this.getFormatter().args.backgroundImageWidth),null!=this.getFormatter().args.backgroundImageX&&this.NodeSVGbackgroundImage.setAttribute("x",this.getFormatter().args.backgroundImageX),null!=this.getFormatter().args.backgroundImageY&&this.NodeSVGbackgroundImage.setAttribute("y",this.getFormatter().args.backgroundImageY),
this.GraphBackground.appendChild(this.NodeSVGbackgroundImage),this.NodeSVGbackgroundImage.removeAttribute("href"),this.NodeSVGbackgroundImage.setAttribute("xlink:href",this.getFormatter().getBackgroundImage())},GraphCanvas.prototype.removeBackgroundImage=function(){null!=this.NodeSVGbackgroundImage&&this.NodeSVGbackgroundImage.parentNode.removeChild(this.NodeSVGbackgroundImage)},GraphCanvas.prototype._setBackgroundColor=function(a){var b=[["fill",a]];SVG.drawRectangle(0,0,this.getFormatter().getWidth(),this.getFormatter().getHeight(),this.GraphBackground,b)},GraphCanvas.prototype.toJSON=function(){var a={};return a.dataset={},a.formatter={},a.layout={},a.dataset=this.getDataset().toJSON(),a.formatter=this.getFormatter().toJSON(),a.layout=this.getLayout().toJSON(),a},GraphCanvas.prototype.toHTML=function(){var a=this._svg.parentElement.innerHTML,b=a.indexOf("<svg"),c=a.indexOf("</svg>")+6;return a.substr(b,c)},GraphCanvas.prototype.draw=function(a,b,c){this.setDataset(a),this.setFormatter(b),this.setLayout(c);var d=this;this.getFormatter().changed.attach(function(a,b){d.removeNode(b.getId()),d.renderNode(b.getId()),d.args.labeled&&(d.removeLabel(b.getId()),d.renderLabel(b.getId()))}),this.getFormatter().edgeChanged.attach(function(a,b){d.removeEdge(b.getId()),d.renderEdge(b.getId())}),this.getFormatter().resized.attach(function(a,b){d.resize(d.getFormatter().getWidth(),d.getFormatter().getHeight())}),this.getFormatter().backgroundImageChanged.attach(function(a,b){d.setBackgroundImage(d.getFormatter().getBackgroundImage())}),this.getFormatter().backgroundColorChanged.attach(function(a,b){d._setBackgroundColor(d.getFormatter().getBackgroundColor())}),this.getLayout().changed.attach(function(a,b){d.moveNode(b.getId()),d.moveEdge(b.getId()),d.args.labeled&&(d.removeLabel(b.getId()),d.renderLabel(b.getId()))}),this.getDataset().newVertex.attach(function(a,b){d.renderNode(b.getId()),d.args.labeled&&d.renderLabel(b.getId())}),this.getDataset().newEdge.attach(function(a,b){d.renderEdge(b.getId())}),this.getDataset().vertexDeleted.attach(function(a,b){d.removeNode(b.getId()),d.args.labeled&&d.removeLabel(b.getId())}),this.getDataset().edgeDeleted.attach(function(a,b){d.removeEdge(b.getId())}),this.getDataset().vertexNameChanged.attach(function(a,b){d.args.labeled&&(d.removeLabel(b.item.getId()),d.removeLabel(b.item.getId()),d.renderLabel(b.item.getId()))}),this.init(),this.render()},GraphCanvas.prototype.render=function(){for(var a in this.getDataset().getVertices())this.renderNode(a);this.renderLabels(),this.renderEdges()},GraphCanvas.prototype.renderLabels=function(){if(this.args.labeled)for(var a in this.getDataset().getVertices())this.renderLabel(a)},GraphCanvas.prototype.removeLabels=function(){for(var a in this.getDataset().getVertices())this.removeLabel(a)},GraphCanvas.prototype.isNodeCanvas=function(a){return a.id==this.args.idGraph||a.id==this.id},GraphCanvas.prototype.isNodeBackground=function(a){return a.id==this.args.idBackgroundNode},GraphCanvas.prototype.isVertex=function(a){return null!=a.getAttribute("id")&&-1!=a.getAttribute("id").indexOf("_v_")},GraphCanvas.prototype.isLabel=function(a){return null!=a.getAttribute("id")&&-1!=a.getAttribute("id").indexOf("_l_")},GraphCanvas.prototype.isEdge=function(a){return null!=a.getAttribute("id")&&-1!=a.getAttribute("id").indexOf("_e_")},GraphCanvas.prototype.resize=function(a,b){null!=this.NodeSVGbackgroundImage&&(this.NodeSVGbackgroundImage.setAttribute("width",a),this.NodeSVGbackgroundImage.setAttribute("height",b)),this._svg.setAttribute("width",a),this._svg.setAttribute("height",b),this.clearCanvas(),this.render()},GraphCanvas.prototype.clearCanvas=function(){DOM.removeChilds(this.GraphEdgeGroup.getAttribute("id")),DOM.removeChilds(this.GraphNodeGroup.getAttribute("id")),this.clearLabels()},GraphCanvas.prototype.clearLabels=function(){DOM.removeChilds(this.GraphLabelGroup.getAttribute("id"))},GraphCanvas.prototype.getSVGNodeId=function(a){return this.id+"_v_"+a},GraphCanvas.prototype.getSVGEdgeId=function(a){return this.id+"_e_"+a},GraphCanvas.prototype.getSVGArrowEdgeId=function(a){return this.id+"_arrow_"+a},GraphCanvas.prototype.getSVGLabelId=function(a){return this.id+"_l_"+a},GraphCanvas.prototype.blinkVertexById=function(a){$("#"+this.getSVGNodeId(a)).fadeIn().fadeOut().fadeIn().fadeOut().fadeIn().fadeOut()},GraphCanvas.prototype.getVertexIdFromSVGId=function(a){return a.replace(this.id,"").replace("_v_","")},GraphCanvas.prototype.getEdgeIdFromSVGId=function(a){return a.replace(this.id,"").replace("_e_","")},GraphCanvas.prototype.getVertexById=function(a){return document.getElementById(this.getSVGNodeId(a))},GraphCanvas.prototype.renderNodes=function(){for(var a in this.getDataset().getVertices())this.renderNode(a)},GraphCanvas.prototype.overNode=function(a){if(this.args.interactive&&null==this.args.isVertexSelected[a]){var b=this.getFormatter().getVertexById(a).getOver();b.args.cursor="pointer",this.changeVertexFormat(a,b)}},GraphCanvas.prototype.outNode=function(a){this.args.interactive&&null==this.args.isVertexSelected[a]&&this.changeVertexFormat(a,this.getFormatter().getVertexById(a).getDefault())},GraphCanvas.prototype.overLabel=function(a){this.overNode(a)},GraphCanvas.prototype.outLabel=function(a){this.outNode(a)},GraphCanvas.prototype.clickNode=function(a){this.args.interactive&&(null==this.args.isVertexSelected[a]?this.selectNode(a):this.deselectNode(a))},GraphCanvas.prototype.selectNode=function(a){for(var b=0;b<this.args.selectedVertices.length;b++){var c=this.getFormatter().getVertexById(a).getSelected();c.opacity=.2,this.changeVertexFormat(a,this.getFormatter().getVertexById(a).getSelected())}if(null==this.args.isVertexSelected[a]){var c=this.getFormatter().getVertexById(a).getSelected();c.opacity=1,this.changeVertexFormat(a,this.getFormatter().getVertexById(a).getSelected()),this.args.selectedVertices.push(a),this.args.isVertexSelected[a]=this.args.selectedVertices.length-1,this.onVertexSelect.notify(a)}},GraphCanvas.prototype.selectAllEdges=function(){this.deselectNodes(),this.deselectEdges();for(var a in this.getDataset().edges)this.selectEdge(a)},GraphCanvas.prototype.selectAllNodes=function(){this.deselectNodes(),this.deselectEdges();for(var a in this.getDataset().vertices)this.selectNode(a)},GraphCanvas.prototype.selectAll=function(){this.deselectNodes(),this.deselectEdges();for(var a in this.getDataset().vertices)this.selectNode(a);for(var b in this.getDataset().edges)this.selectEdge(b)},GraphCanvas.prototype.selectEdge=function(a){null==this.args.isEdgeSelected[a]&&(this.changeEdgeFormat(a,this.getFormatter().getEdgeById(a).getSelected()),this.args.isEdgeSelected[a]=!0,this.onEdgeSelect.notify(a))},GraphCanvas.prototype.selectEdges=function(a){for(var b=0;b<a.length;b++)this.selectEdge(a[b])},GraphCanvas.prototype.deselectNode=function(a){if(null!=this.args.isVertexSelected[a]){this.changeVertexFormat(a,this.getFormatter().getVertexById(a).getDefault()),this.args.selectedVertices.splice(this.args.isVertexSelected[a],1);var b=this.args.isVertexSelected[a];delete this.args.isVertexSelected[a];for(var c in this.args.isVertexSelected)this.args.isVertexSelected[c]>b&&(this.args.isVertexSelected[c]=this.args.isVertexSelected[c]-1)}},GraphCanvas.prototype.deselectNodes=function(){for(var a=JSON.parse(JSON.stringify(this.getSelectedVertices())),b=0;b<a.length;b++)this.deselectNode(a[b])},GraphCanvas.prototype.selectNodes=function(a){for(var b=0;b<a.length;b++)this.selectNode(a[b])},GraphCanvas.prototype.changeVertexFormat=function(a,b){var c=DOM.select(this.getSVGNodeId(a));if(null!=c){var d=b.toJSON();for(var e in d)c.setAttribute(e,d[e]);if(this.getFormatter().getVertexById(a)instanceof CircleVertexGraphFormatter){var f="translate("+c.getAttribute("dragx")+","+c.getAttribute("dragy")+"), scale("+b.getSize()+")";c.setAttribute("transform",f)}}},GraphCanvas.prototype.renderLabel=function(a){var b=(Math.ceil(this.getLayout().getNodeById(a).x*this.getFormatter().getWidth()),Math.ceil(this.getLayout().getNodeById(a).y*this.getFormatter().getHeight()),JSON.parse(JSON.stringify(this.getFormatter().getVertexById(a).getDefault().toJSON().title)));b.id=this.getSVGLabelId(this.getDataset().getVertexById(a).getId()),b.dx=-1*(this.getDataset().getVertexById(a).getName().length*b["font-size"])/4-4,b.dy=parseFloat(this.getFormatter().getVertexById(a).getDefault().getSize())+parseFloat(b["font-size"])+parseFloat(this.getFormatter().getVertexById(a).getDefault().getStrokeWidth())-4,b.dragx=Math.ceil(this.getLayout().getNodeById(a).x*this.getFormatter().getWidth());var c=parseFloat(this.getFormatter().getVertexById(a).getDefault().getSize())+Math.ceil(this.getLayout().getNodeById(a).y*this.getFormatter().getHeight());b.dragy=c,b.transform="translate("+b.dragx+","+b.dragy+")";var d=SVG.drawText(0,0,this.getDataset().getVertexById(a).getName(),this.GraphLabelGroup,b);this.svgLabels[a]=d;var e=this;null!=d&&(d.addEventListener("mouseover",function(){e.overLabel(a)},!1),d.addEventListener("mouseout",function(){e.outLabel(a)},!1))},GraphCanvas.prototype.removeLabel=function(a){null!=DOM.select(this.getSVGLabelId(a))&&DOM.select(this.getSVGLabelId(a)).parentNode.removeChild(DOM.select(this.getSVGLabelId(a)))},GraphCanvas.prototype.renderNode=function(a){var b=JSON.parse(JSON.stringify(this.getFormatter().getVertexById(a).getDefault().toJSON()));b.dragx=Math.ceil(this.getLayout().getNodeById(a).x*this.getFormatter().getWidth()),b.dragy=Math.ceil(this.getLayout().getNodeById(a).y*this.getFormatter().getHeight()),b.transform="translate("+b.dragx+","+b.dragy+")",b.id=this.getSVGNodeId(a),this.circleDefaultRadius=this.getFormatter().getVertexById(a).getDefault().getSize();var c;this.getFormatter().getVertexById(a)instanceof CircleVertexGraphFormatter&&(c=SVG.drawCircle(0,0,this.circleDefaultRadius,this.GraphNodeGroup,b)),this.getFormatter().getVertexById(a)instanceof SquareVertexGraphFormatter&&(c=SVG.drawRectangle(0-this.circleDefaultRadius,0-this.circleDefaultRadius,2*this.circleDefaultRadius,2*this.circleDefaultRadius,this.GraphNodeGroup,b)),this.getFormatter().getVertexById(a)instanceof EllipseVertexGraphFormatter&&(c=SVG.drawEllipse(0,0,1.5*this.circleDefaultRadius,this.circleDefaultRadius,this.GraphNodeGroup,b)),this.getFormatter().getVertexById(a)instanceof RectangleVertexGraphFormatter&&(c=SVG.drawRectangle(0-1.5*this.circleDefaultRadius,0-this.circleDefaultRadius,2*this.circleDefaultRadius*1.5,2*this.circleDefaultRadius,this.GraphNodeGroup,b)),this.getFormatter().getVertexById(a)instanceof RoundedVertexGraphFormatter&&(b.ry=2,b.rx=2,c=SVG.drawRectangle(0-1.5*this.circleDefaultRadius,0-this.circleDefaultRadius,2*this.circleDefaultRadius*1.5,2*this.circleDefaultRadius,this.GraphNodeGroup,b)),this.getFormatter().getVertexById(a)instanceof OctagonVertexGraphFormatter&&(b.ry=2,b.rx=2,c=SVG.drawRectangle(0-1.5*this.circleDefaultRadius,0-this.circleDefaultRadius,2*this.circleDefaultRadius*1.5,2*this.circleDefaultRadius,this.GraphNodeGroup,b)),c.internalId=a;var d=this;null!=c&&(c.addEventListener("mouseover",function(){d.onVertexOver.notify(a),d.overNode(a)},!1),c.addEventListener("mouseout",function(){d.onVertexOut.notify(a),d.outNode(a)},!1),c.addEventListener("mouseup",function(){d.onVertexUp.notify(a)},!1))},GraphCanvas.prototype.removeNode=function(a){DOM.select(this.getSVGNodeId(a)).parentNode.removeChild(DOM.select(this.getSVGNodeId(a))),this.args.labeled&&this.removeLabel(a)},GraphCanvas.prototype.removeSelected=function(){this.removeSelectedEdges(),this.removeSelectedNode()},GraphCanvas.prototype.removeSelectedNode=function(){var a=JSON.parse(JSON.stringify(this.getSelectedVertices()));this.deselectNodes();for(var b=a.sort(function(a,b){return a-b}),c=0;c<b.length;c++)null!=this.getDataset().getVertexById(b[c])&&this.getDataset().getVertexById(b[c]).remove()},GraphCanvas.prototype.removeEdge=function(a){null!=DOM.select(this.getSVGEdgeId(a))&&DOM.select(this.getSVGEdgeId(a)).parentNode.removeChild(DOM.select(this.getSVGEdgeId(a))),null!=DOM.select(this.getSVGEdgeId(a)+"_shadow")&&DOM.select(this.getSVGEdgeId(a)+"_shadow").parentNode.removeChild(DOM.select(this.getSVGEdgeId(a)+"_shadow")),null!=DOM.select(this.getSVGArrowEdgeId(a))&&DOM.select(this.getSVGArrowEdgeId(a)).parentNode.removeChild(DOM.select(this.getSVGArrowEdgeId(a)))},GraphCanvas.prototype.overEdge=function(a){if(this.args.interactive&&!this.dragging&&!this.selecting&&null==this.args.isEdgeSelected[a]){var b=this.getFormatter().getEdgeById(a).getOver();b.args.cursor="pointer",this.changeEdgeFormat(a,b)}},GraphCanvas.prototype.outEdge=function(a){this.args.interactive&&null==this.args.isEdgeSelected[a]&&this.changeEdgeFormat(a,this.getFormatter().getEdgeById(a).getDefault())},GraphCanvas.prototype.changeEdgeFormat=function(a,b){var c=DOM.select(this.getSVGEdgeId(a)+"_shadow");if(null!=c){var d=b.toJSON();for(var e in d)c.setAttribute(e,d[e])}},GraphCanvas.prototype.deselectEdge=function(a){if(null!=this.args.isEdgeSelected[a]){this.changeEdgeFormat(a,this.getFormatter().getEdgeById(a).getDefault());this.args.isEdgeSelected[a];delete this.args.isEdgeSelected[a]}},GraphCanvas.prototype.deselectEdges=function(){for(var a=JSON.parse(JSON.stringify(this.getSelectedEdges())),b=0;b<a.length;b++)this.deselectEdge(a[b])},GraphCanvas.prototype.removeSelectedEdges=function(){var a=JSON.parse(JSON.stringify(this.getSelectedEdges()));this.deselectEdges();for(var b=0;b<a.length;b++)null!=this.getDataset().getEdgeById(a[b])&&this.getDataset().getEdgeById(a[b]).remove()},GraphCanvas.prototype.renderEdge=function(a){var b=this.getFormatter().getEdgeById(a).getDefault().toJSON(),c=this.getDataset().getEdgeById(a),d=this.getVertexById(c.getNodeTarget().getId()),e=this.getVertexById(c.getNodeSource().getId());b.id=this.getSVGEdgeId(c.getId())+"_shadow";var f=null;if(this.getFormatter().getEdgeById(a)instanceof LineEdgeGraphFormatter){var g=e.getAttribute("dragx"),h=e.getAttribute("dragy"),i=d.getAttribute("dragx"),j=d.getAttribute("dragy");SVG.drawLine(g,h,i,j,this.GraphEdgeGroup,b);var k={};k.id=this.getSVGEdgeId(c.getId()),k["stroke-opacity"]=0,k["stroke-width"]=4,k.stroke="black",f=SVG.drawLine(e.getAttribute("dragx"),e.getAttribute("dragy"),d.getAttribute("dragx"),d.getAttribute("dragy"),this.GraphEdgeGroup,k)}if(this.getFormatter().getEdgeById(a)instanceof BezierEdgeGraphFormatter){var l=c.getNodeTarget().getId(),m=this.formatter.getVertexById(l).getDefault().getSize()*this.getFormatter().getNodesMaxSize();b.fill="none",b.id=this.getSVGEdgeId(a);var n=this.calculateCoordenatesBezier(m,e.getAttribute("dragx"),e.getAttribute("dragy"));f=SVG.drawPath(n,this.GraphEdgeGroup,b)}if(this.getFormatter().getEdgeById(a)instanceof DirectedLineEdgeGraphFormatter||this.getFormatter().getEdgeById(a)instanceof CutDirectedLineEdgeGraphFormatter||this.getFormatter().getEdgeById(a)instanceof DotDirectedLineEdgeGraphFormatter||this.getFormatter().getEdgeById(a)instanceof OdotDirectedLineEdgeGraphFormatter||this.getFormatter().getEdgeById(a)instanceof OdirectedLineEdgeGraphFormatter){var g=e.getAttribute("dragx"),h=e.getAttribute("dragy"),i=d.getAttribute("dragx"),j=d.getAttribute("dragy"),o=parseFloat(this.getFormatter().getVertexById(this.getDataset().getEdgeById(a).getNodeTarget().getId()).getDefault().getSize()*this.circleDefaultRadius),p=this._calculateEdgePointerPosition(g,h,i,j,o);i=p.x,j=p.y,SVG.drawLine(g,h,i,j,this.GraphEdgeGroup,b);var k={};k.id=this.getSVGEdgeId(c.getId()),k["stroke-opacity"]=0,k["stroke-width"]=4,k.stroke="black",f=SVG.drawLine(g,h,i,j,this.GraphEdgeGroup,k)}if(this.getFormatter().getEdgeById(a)instanceof DirectedLineEdgeGraphFormatter||this.getFormatter().getEdgeById(a)instanceof OdirectedLineEdgeGraphFormatter){var g=e.getAttribute("dragx"),h=e.getAttribute("dragy"),i=d.getAttribute("dragx"),j=d.getAttribute("dragy"),p=this._calculateEdgePointerPosition(g,h,i,j,o);i=p.x,j=p.y;var q=Geometry.toDegree(p.angle)+90;this.arrowDefaultSize=this.getFormatter().getEdgeById(a).getArrowSize();var r,n="-"+this.arrowDefaultSize+",0 0,-"+2*parseFloat(this.arrowDefaultSize)+" "+this.arrowDefaultSize+",0";r=this.getFormatter().getEdgeById(a)instanceof DirectedLineEdgeGraphFormatter?[["fill",this.getFormatter().getEdgeById(a).getDefault().getStroke()],["stroke",this.getFormatter().getEdgeById(a).getDefault().getStroke()],["id",this.getSVGArrowEdgeId(a)]]:[["fill","#FFFFFF"],["stroke",this.getFormatter().getEdgeById(a).getDefault().getStroke()],["id",this.getSVGArrowEdgeId(a)]];var s=SVG.drawPoligon(n,this.GraphEdgeGroup,r);s.setAttribute("transform"," translate("+i+", "+j+"), rotate("+q+")")}if(this.getFormatter().getEdgeById(a)instanceof CutDirectedLineEdgeGraphFormatter){var g=e.getAttribute("dragx"),h=e.getAttribute("dragy"),i=d.getAttribute("dragx"),j=d.getAttribute("dragy"),p=this._calculateEdgePointerPosition(g,h,i,j,o);i=p.x,j=p.y;var q=Geometry.toDegree(p.angle)+90,n="-4,0 4,0 4,-2 -4,-2",s=SVG.drawPoligon(n,this.GraphEdgeGroup,[["fill",this.getFormatter().getEdgeById(a).getDefault().getStroke()],["stroke",this.getFormatter().getEdgeById(a).getDefault().getStroke()],["id",this.getSVGArrowEdgeId(a)]]);s.setAttribute("transform"," translate("+i+", "+j+"), rotate("+q+")")}if(this.getFormatter().getEdgeById(a)instanceof DotDirectedLineEdgeGraphFormatter||this.getFormatter().getEdgeById(a)instanceof OdotDirectedLineEdgeGraphFormatter){var g=e.getAttribute("dragx"),h=e.getAttribute("dragy"),i=d.getAttribute("dragx"),j=d.getAttribute("dragy"),p=this._calculateEdgePointerPosition(g,h,i,j,o);i=p.x,j=p.y;var q=Geometry.toDegree(p.angle)+90,r=[];r=this.getFormatter().getEdgeById(a)instanceof OdotDirectedLineEdgeGraphFormatter?[["fill","#FFFFFF"],["stroke",this.getFormatter().getEdgeById(a).getDefault().getStroke()],["id",this.getSVGArrowEdgeId(a)]]:[["fill",this.getFormatter().getEdgeById(a).getDefault().getStroke()],["stroke",this.getFormatter().getEdgeById(a).getDefault().getStroke()],["id",this.getSVGArrowEdgeId(a)]];var s=SVG.drawCircle(0,0,4,this.GraphEdgeGroup,r);s.setAttribute("transform"," translate("+i+", "+j+"), rotate("+q+")")}var t=this;null!=f&&this.getDataset().getEdgesCount()<this.args.maxNumberEdgesFiringEvents&&(f.addEventListener("mouseover",function(){t.overEdge(a)},!1),f.addEventListener("mouseout",function(){t.outEdge(a)},!1))},GraphCanvas.prototype._calculateEdgePointerPosition=function(a,b,c,d,e){var f=Geometry.getAngleBetweenTwoPoints(a,b,c,d);if(0>c-a){var g=Geometry.getAdjacentSideOfRectangleRight(f,e);c=parseFloat(c)+parseFloat(g),arrowX=parseFloat(c)+parseFloat(g)+this.arrowDefaultSize/2}else{var g=Geometry.getAdjacentSideOfRectangleRight(f,e);c=parseFloat(c)-parseFloat(g),arrowX=parseFloat(c)-parseFloat(g)-this.arrowDefaultSize/2}if(d-b>0){var h=Geometry.getOppositeSideOfRectangleRight(f,e);d=parseFloat(d)-parseFloat(h),arrowY=parseFloat(d)-parseFloat(h)-this.arrowDefaultSize/2}else{var h=Geometry.getOppositeSideOfRectangleRight(f,e);d=parseFloat(d)+parseFloat(h),arrowY=parseFloat(d)+parseFloat(h)-this.arrowDefaultSize/2}return{x:arrowX,y:arrowY,angle:f}},GraphCanvas.prototype.calculateCoordenatesBezier=function(a,b,c){var d=b-a/2,e=c-a/2,f=parseFloat(b)+parseFloat(a/2),g=c-a/2,h=(f-d)/2+d,i=c-2*a,j="M"+d+","+e+" T"+h+","+i+" "+f+","+g;return j},GraphCanvas.prototype.renderEdges=function(){for(var a in this.getDataset().getEdges())this.renderEdge(this.getDataset().getEdgeById(a).getId())},GraphCanvas.prototype.getLastSelectedNode=function(){var a=null;if(this.getSelectedVertices().length>0){var b=this.getSelectedVertices()[this.getSelectedVertices().length-1];a=this.getDataset().getVertexById(b)}return a},GraphCanvas.prototype.setDataset=function(a){this.dataset=a},GraphCanvas.prototype.setFormatter=function(a){this.formatter=a},GraphCanvas.prototype.setLayout=function(a){this.layout=a},GraphCanvas.prototype.getDataset=function(){return this.dataset},GraphCanvas.prototype.getFormatter=function(){return this.formatter},GraphCanvas.prototype.getLayout=function(){return this.layout},GraphCanvas.prototype.addVertex=function(a,b){this.getDataset().addNode(a,b)},GraphCanvas.prototype.removeVertex=function(a){this.getDataset().getVertexById(a).remove()},GraphCanvas.prototype.addEdge=function(a,b,c,d){this.getDataset().addEdge(a,b,c,d)},GraphCanvas.prototype.getWidth=function(){return this.getFormatter().getWidth()},GraphCanvas.prototype.getHeight=function(){return this.getFormatter().getHeight()},GraphCanvas.prototype.getBackgroundImage=function(){return this.getFormatter().getBackgroundImage()},GraphCanvas.prototype.getBackgroundColor=function(){return this.getFormatter().getBackgroundColor()},GraphCanvas.prototype.setBackgroundColor=function(){this.getFormatter().setBackgroundColor(value)},GraphCanvas.prototype.setVertexSize=function(a,b){this.getFormatter().getVertexById(a).getDefault().setSize(b)},GraphCanvas.prototype.getVertexSize=function(a){return this.getFormatter().getVertexById(a).getDefault().getSize()},GraphCanvas.prototype.setVertexStroke=function(a,b){this.getFormatter().getVertexById(a).getDefault().setStroke(b)},GraphCanvas.prototype.getVertexStroke=function(a){return this.getFormatter().getVertexById(a).getDefault().getStroke()},GraphCanvas.prototype.setVertexStrokeOpacity=function(a,b){this.getFormatter().getVertexById(a).getDefault().setStrokeOpacity(b)},GraphCanvas.prototype.getVertexStrokeOpacity=function(a){return this.getFormatter().getVertexById(a).getDefault().getStrokeOpacity()},GraphCanvas.prototype.setVertexOpacity=function(a,b){this.getFormatter().getVertexById(a).getDefault().setOpacity(b)},GraphCanvas.prototype.getVertexOpacity=function(a){return this.getFormatter().getVertexById(a).getDefault().getOpacity()},GraphCanvas.prototype.setVertexFill=function(a,b){this.getFormatter().getVertexById(a).getDefault().setFill(b)},GraphCanvas.prototype.getVertexFill=function(a){return this.getFormatter().getVertexById(a).getDefault().getFill()},GraphCanvas.prototype.setEdgeSize=function(a,b){this.getFormatter().getEdgeById(a).getDefault().setSize(b)},GraphCanvas.prototype.getEdgeSize=function(a){return this.getFormatter().getEdgeById(a).getDefault().getSize()},GraphCanvas.prototype.setEdgeStroke=function(a,b){this.getFormatter().getEdgeById(a).getDefault().setStroke(b)},GraphCanvas.prototype.getEdgeStroke=function(a){return this.getFormatter().getEdgeById(a).getDefault().getStroke()},GraphCanvas.prototype.setEdgeStrokeOpacity=function(a,b){this.getFormatter().getEdgeById(a).getDefault().setStrokeOpacity(b)},GraphCanvas.prototype.getEdgeStrokeOpacity=function(a){return this.getFormatter().getEdgeById(a).getDefault().getStrokeOpacity()},GraphCanvas.prototype.setEdgeFill=function(a,b){this.getFormatter().getEdgeById(a).getDefault().setFill(b)},GraphCanvas.prototype.getEdgeFill=function(a){return this.getFormatter().getEdgeById(a).getDefault().getFill()},GraphCanvas.prototype.setCoordinates=function(a,b,c){return this.getLayout().getEdgeById(a).setCoordinates(b,c)},GraphDataset.prototype.loadFromJSON=DataSet.prototype.loadFromJSON,GraphDataset.prototype.toJSON=DataSet.prototype.toJSON,GraphDataset.prototype.validate=DataSet.prototype.validate,GraphDataset.prototype.getMaxClass=function(){var a=0;for(var b in this.vertices)this.vertices[b].getEdgesCount()>a&&(a=this.vertices[b].getEdgesCount());return a},GraphDataset.prototype.getMinClass=function(){var a=Math.min();for(var b in this.vertices)this.vertices[b].getEdgesCount()<a&&(a=this.vertices[b].getEdgesCount());return a},GraphDataset.prototype.getVertexByName=function(a){var b=new Array;for(var c in this.verticesIndex[a]){var d=this.getVertexById(this.verticesIndex[a][c]);return b.push(d),d}return 1>=b?this.getVertexById(this.verticesIndex[a]):b},GraphDataset.prototype.getVertexById=function(a){return this.vertices[a]},GraphDataset.prototype.toSIF=function(){var a=new SifFileDataAdapter;return a.toSIF(this)},GraphDataset.prototype.toSIFID=function(){var a=new SifFileDataAdapter;return a.toSIFID(this)},GraphDataset.prototype.toDOT=function(){var a=new DotFileDataAdapter;return a.toDOT(this)},GraphDataset.prototype.toDOTID=function(){var a=new DotFileDataAdapter;return a.toDOTID(this)},GraphDataset.prototype._addNode=function(a,b){return new Vertex(this._getVerticesCount()-1,a,b)},GraphDataset.prototype.addNode=function(a,b){this.json.vertices.push(a),this._addVerticesIndex(a,this._getVerticesCount()-1);var c=this._addNode(a,b);this.vertices[this._getVerticesCount()-1]=c,this._setNodeEvents(c),this.newVertex.notify(c)},GraphDataset.prototype._addVerticesIndex=function(a,b){null==this.verticesIndex[a]&&(this.verticesIndex[a]=new Array),this.verticesIndex[a].push(b)},GraphDataset.prototype.addEdge=function(a,b,c,d){this.json.edges.push(a);var e=this.getVertexById(b),f=this.getVertexById(c),g=this.getEdgesCount()-1;this.edges[g]=new Edge(g,a,e,f,d),this.json.relations.push({index:g,sourceIndex:b,targetIndex:c,args:d}),e.addEdge(this.edges[g]),f.addEdge(this.edges[g]),this._setEdgeEvents(this.edges[g]),this.newEdge.notify(this.edges[g])},GraphDataset.prototype.getVertices=function(){return this.vertices},GraphDataset.prototype.getEdges=function(){return this.edges},GraphDataset.prototype.getEdgeById=function(a){return this.edges[a]},GraphDataset.prototype._getVerticesCount=function(){return this.json.vertices.length},GraphDataset.prototype.getVerticesCount=function(){var a=0;for(var b in this.getVertices())a++;return a},GraphDataset.prototype.getEdgesCount=function(){return this.json.edges.length},GraphDataset.prototype.init=function(){this.edges=new Object,this.vertices=new Object},GraphDataset.prototype._setNodeEvents=function(a){var b=this;a.deleted.attach(function(a,c){b._removeNode(c)}),a.nameChanged.attach(function(a,c){for(var d=c.item,e=d.name,f=b.verticesIndex[c.previousName],g=0;g<f.length;g++)f[g]==d.id&&f.splice(g,1);0==f.length&&delete b.verticesIndex[c.previousName],b._addVerticesIndex(e,d.id),b.json.vertices[d.id]=e,b.vertexNameChanged.notify(c)})},GraphDataset.prototype._setEdgeEvents=function(a){var b=this;a.nameChanged.attach(function(a,c){b.edgeNameChanged.notify(c)}),a.deleted.attach(function(a,c){b._removeEdge(c)})},GraphDataset.prototype._connectVerticesByName=function(a,b){var c=this.getVertexByName(a),d=this.getVertexByName(b);null!=c&&null!=d?this.addEdge(c.getName()+"_"+d.getName(),c.getId(),d.getId(),{}):(null==c&&console.log("No encontrado: "+a),null==d&&console.log("No encontrado: "+b))},GraphDataset.prototype.loadFromJSON=function(a){var a=a;this.init(),this.json=new Object,this.json.vertices=new Array,this.json.edges=new Array,this.json.relations=new Array;for(var b=0;b<a.nodes.length;b++)if(null!=a.nodes[b]){var c=a.nodes[b];this.addNode(c)}else this.json.vertices.push(null);for(var b=0;b<a.edges.length;b++)if(null!=a.edges[b]){if(null!=a.relations[b]){var c=a.edges[b];this.addEdge(c,a.relations[b].sourceIndex,a.relations[b].targetIndex,a.relations[b].args)}}else this.json.edges.push(null),this.json.relations.push(null)},GraphDataset.prototype.prettyPrint=function(){for(var a in this.vertices){console.log(this.vertices[a].getName());for(var b=0;b<this.vertices[a].getEdgesIn().length;b++)console.log("          --> "+this.vertices[a].getEdgesIn()[b].getNodeTarget().getName())}},GraphDataset.prototype._removeEdge=function(a){this.json.edges[a.getId()]=null,this.json.relations[a.getId()]=null,delete this.edges[a.getId()],this.edgeDeleted.notify(a)},GraphDataset.prototype._removeNode=function(a){this.json.vertices[a.getId()]=null,delete this.vertices[a.getId()],this.vertexDeleted.notify(a)},GraphDataset.prototype.toJSON=function(){var a=new Object;new Array;return a.nodes=this.json.vertices,a.edges=this.json.edges,a.relations=this.json.relations,a},GraphDataset.prototype.clone=function(){var a=new GraphDataset;return a.loadFromJSON(this.toJSON()),a},GraphItem.prototype.getName=function(){return this.name},GraphItem.prototype.getId=function(){return this.id},GraphItem.prototype.setName=function(a){var b=this.getName();this.name=a,this.nameChanged.notify({item:this,previousName:b})},ItemGraphFormatter.prototype.getType=function(){return this.args.type},ItemGraphFormatter.prototype.toJSON=function(){var a=this.args;return a.defaultFormat=this.getDefault().toJSON(),a.over=this.getOver().toJSON(),a.selected=this.getSelected().toJSON(),a.dragging=this.getDragging().toJSON(),a.id=this.id,a},ItemGraphFormatter.prototype.loadFromJSON=function(a){this.args=a,this.defaultFormat=new ItemFormat(a.defaultFormat),this.over=new ItemFormat(a.over),this.selected=new ItemFormat(a.selected),this.dragging=new ItemFormat(a.dragging),this._setEvents()},ItemGraphFormatter.prototype._setEvents=function(){var a=this;this.defaultFormat.changed.attach(function(b,c){a.over.setSize(a.defaultFormat.getSize()),a.selected.setSize(a.defaultFormat.getSize()),a.dragging.setSize(a.defaultFormat.getSize()),a.stateChanged.notify(a)}),this.selected.changed.attach(function(b,c){a.stateChanged.notify(a)}),this.over.changed.attach(function(b,c){a.stateChanged.notify(a)}),this.dragging.changed.attach(function(b,c){a.stateChanged.notify(a)})},ItemGraphFormatter.prototype.getId=function(){return this.id},ItemGraphFormatter.prototype.getDefault=function(){return this.defaultFormat},ItemGraphFormatter.prototype.getSelected=function(){return this.selected},ItemGraphFormatter.prototype.getOver=function(){return this.over},ItemGraphFormatter.prototype.getDragging=function(){return this.dragging},ItemFormat.prototype._fixColor=function(a){var b=a;return-1!=a.indexOf("green")&&(b="#04B431"),-1!=a.indexOf("blue")&&(b="#045FB4"),-1!=a.indexOf("red")&&(b="#DF0101"),-1!=a.indexOf("black")&&(b="#000000"),-1!=a.indexOf("white")&&(b="#FFFFFF"),-1==a.indexOf("#")&&(b="#"+a),b},ItemFormat.prototype.toJSON=function(){return null!=this.args.strokeOpacity&&(this.args["stroke-opacity"]=this.args.strokeOpacity,delete this.args.strokeOpacity),null!=this.args.title.fontColor?this.args.title["font-color"]=this.args.title.fontColor:this.args.title["font-color"]=this.args.fontColor,null!=this.args.title.fontSize?this.args.title["font-size"]=this.args.title.fontSize:this.args.title["font-size"]=this.args.fontSize,this.args},ItemFormat.prototype.getAttribute=function(a){return this.args[a]},ItemFormat.prototype.setVisible=function(a){this.args.visible!=a&&(this.args.visible=a,this.changed.notify(this))},ItemFormat.prototype.getVisible=function(){return this.args.visible},ItemFormat.prototype.setHidden=function(a){this.args.hidden!=a&&(this.args.hidden=a,this.changed.notify(this))},ItemFormat.prototype.getHidden=function(){return this.args.hidden},ItemFormat.prototype.setStroke=function(a){this.args.stroke!=a&&(this.args.stroke=a,this.changed.notify(this))},ItemFormat.prototype.getStroke=function(){return this.args.stroke},ItemFormat.prototype.setStrokeOpacity=function(a){this.args.strokeOpacity!=a&&(this.args.strokeOpacity=a,this.changed.notify(this))},ItemFormat.prototype.getStrokeOpacity=function(){return this.args["stroke-opacity"]},ItemFormat.prototype.setStrokeWidth=function(a){this.args["stroke-width"]!=a&&(this.args["stroke-width"]=a,this.changed.notify(this))},ItemFormat.prototype.getFillOpacity=function(){return this.args["fill-opacity"]},ItemFormat.prototype.setfillOpacity=function(a){this.args["fill-opacity"]!=a&&(this.args["fill-opacity"]=a,this.changed.notify(this))},ItemFormat.prototype.getStrokeWidth=function(){return this.args["stroke-width"]},ItemFormat.prototype.setFill=function(a){this.args.fill!=a&&(this.args.fill=a,this.changed.notify(this))},ItemFormat.prototype.getFill=function(){return this.args.fill},ItemFormat.prototype.setSize=function(a){this.args.size!=a&&(this.args.size=a,this.changed.notify(this))},ItemFormat.prototype.getSize=function(){return this.args.size},ItemFormat.prototype.setOpacity=function(a){this.args.opacity!=a&&(this.args.opacity=a,this.changed.notify(this))},ItemFormat.prototype.getOpacity=function(){return this.args.opacity},ItemFormat.prototype.getArrowSize=function(){return this.args.arrowSize},ItemFormat.prototype.setArrowSize=function(a){
this.args.arrowSize!=a&&(this.args.arrowSize=a,this.changed.notify(this))},ItemFormat.prototype.getFontSize=function(){return this.args.title.fontSize},ItemFormat.prototype.setFontSize=function(a){this.args.title.fontSize!=a&&(this.args.title.fontSize=a,this.changed.notify(this))},LayoutDataset.prototype.loadFromJSON=function(a,b){var c=this;this.vertices=new Object,this.dataset=a;for(var d in b)this.vertices[d]=new NodeLayout(d,b[d].x,b[d].y),this.vertices[d].changed.attach(function(a,b){c.changed.notify(b)});this._attachDatasetEvents()},LayoutDataset.prototype.toJSON=function(){var a=new Object;for(var b in this.vertices)a[b]=new Object,a[b].x=this.vertices[b].x,a[b].y=this.vertices[b].y;return a.dataset=new Object,a.dataset=this.dataset.toJSON(),a},LayoutDataset.prototype.dataBind=function(a){this.dataset=a,this._attachDatasetEvents(),this._calculateLayout()},LayoutDataset.prototype._removeVertex=function(a){delete this.vertices[a]},LayoutDataset.prototype._attachDatasetEvents=function(){var a=this;this.dataset.vertexDeleted.attach(function(b,c){a._removeVertex(c.getId())}),this.dataset.newVertex.attach(function(b,c){a.vertices[c.getId()]=new NodeLayout(c.getId(),.5,.5),a.vertices[c.getId()].changed.attach(function(b,c){a.changed.notify(c)})})},LayoutDataset.prototype.getType=function(){return this.args.type},LayoutDataset.prototype._calculateLayoutVertices=function(a,b){if("CIRCLE"==a){for(var c=.4,d=.5,e=.5,f=new Array,g=0;b>g;g++)x=d+c*Math.sin(2*g*Math.PI/b),y=e+c*Math.cos(2*g*Math.PI/b),f.push({x:x,y:y});return f}},LayoutDataset.prototype._calculateLayout=function(){var a=this;if("RANDOM"==this.getType())for(var b in this.dataset.getVertices())null==this.vertices[b]&&(this.vertices[b]=new NodeLayout(b,0,0)),this.vertices[b].setCoordinates(Math.random(),Math.random()),this.vertices[b].changed.attach(function(b,c){a.changed.notify(c)});if("CIRCLE"==this.getType()){var c=this.dataset._getVerticesCount(),d=this._calculateLayoutVertices(this.getType(),c),e=0;for(var b in this.dataset.getVertices())null==this.vertices[b]&&(this.vertices[b]=new NodeLayout(b,0,0)),this.vertices[b].setCoordinates(d[e].x,d[e].y),e++,this.vertices[b].changed.attach(function(b,c){a.changed.notify(c)})}if("SQUARE"==this.getType()){for(var c=this.dataset._getVerticesCount(),f=.1,g=.9,h=.1,i=Math.sqrt(c),j=(g-f)/i,d=new Array,k=0;i>k;k++)for(var l=0;i>l;l++)x=k*j+f,y=l*j+h,d.push({x:x,y:y});var e=0;for(var b in this.dataset.getVertices())null==this.vertices[b]&&(this.vertices[b]=new NodeLayout(b,0,0)),this.vertices[b].setCoordinates(d[e].x,d[e].y),e++,this.vertices[b].changed.attach(function(b,c){a.changed.notify(c)})}},LayoutDataset.prototype.getNodeById=function(a){return this.vertices[a]},LayoutDataset.prototype.getVerticesByArea=function(a,b,c,d){var e=new Array;for(var f in this.dataset.getVertices())this.vertices[f].x>=a&&this.vertices[f].x<=c&&this.vertices[f].y>=b&&this.vertices[f].y<=d&&e.push(this.vertices[f]);return e},LayoutDataset.prototype.getLayout=function(a){if("CIRCLE"==a)return this.args.type="CIRCLE",void this._calculateLayout();if("SQUARE"==a)return this.args.type="SQUARE",void this._calculateLayout();if("RANDOM"==a)return this.args.type="RANDOM",void this._calculateLayout();var b=this.dataset.toDOTID(),c="http://bioinfo.cipf.es/utils/ws/rest/network/layout/"+a+".coords",d=this;$.ajax({async:!0,type:"POST",url:c,dataType:"text",data:{dot:b},cache:!1,success:function(a){var b=JSON.parse(a);for(var c in b)d.vertices[c].setCoordinates(b[c].x,b[c].y)}})},NodeLayout.prototype.getId=function(a){return this.id},NodeLayout.prototype.setCoordinates=function(a,b){this.x=a,this.y=b,this.changed.notify(this)},NetworkDataSetFormatter.prototype.loadFromJSON=function(a,b){this.args=new Object,this.vertices=new Object,this.args=b,this._setDataset(a);for(var c in b.vertices)this.addVertex(c,b.vertices[c]);for(var d in b.edges)this.addEdge(d,b.edges[d])},NetworkDataSetFormatter.prototype.toJSON=function(){var a=new Object;a=JSON.parse(JSON.stringify(this.args)),a.vertices=new Object,a.edges=new Object;for(var b in this.vertices)a.vertices[b]=this.getVertexById(b).toJSON();for(var c in this.edges)a.edges[c]=this.getEdgeById(c).toJSON();return a},NetworkDataSetFormatter.prototype._getNodeSize=function(a){if(this.isVerticesBalanced()){var b=this.maxClass-this.minClass;0==b&&(b=1);var c=this.dataset.getVertexById(a).getEdges().length;return c*this.args.nodesMaxSize/b+this.args.nodesMinSize}return this.getVertexById(a).getDefault().getSize()},NetworkDataSetFormatter.prototype._recalculateSize=function(){if(this.isVerticesBalanced()){this.maxClass=this.dataset.getMaxClass(),this.minClass=this.dataset.getMinClass();for(var a in this.vertices){var b=this._getNodeSize(a);this.vertices[a].getDefault().setSize(b),this.vertices[a].getSelected().setSize(b),this.vertices[a].getOver().setSize(b)}}},NetworkDataSetFormatter.prototype.addVertex=function(a,b){null==b?this.vertices[a]=new CircleVertexGraphFormatter(a,this.args.vertexFormatProperties.defaultFormat,this.args.vertexFormatProperties.selected,this.args.vertexFormatProperties.over,this.args.vertexFormatProperties.dragging):(null==b.type&&(this.vertices[a]=new CircleVertexGraphFormatter(a,this.args.vertexFormatProperties.defaultFormat,this.args.vertexFormatProperties.selected,this.args.vertexFormatProperties.over,this.args.vertexFormatProperties.dragging)),"SquareVertexGraphFormatter"!=b.type&&"SquareVertexNetworkFormatter"!=b.type||(this.vertices[a]=new SquareVertexGraphFormatter(a),this.vertices[a].loadFromJSON(b)),"CircleVertexGraphFormatter"!=b.type&&"CircleVertexNetworkFormatter"!=b.type||(this.vertices[a]=new CircleVertexGraphFormatter(a),this.vertices[a].loadFromJSON(b)),"EllipseVertexGraphFormatter"!=b.type&&"EllipseVertexNetworkFormatter"!=b.type||(this.vertices[a]=new EllipseVertexGraphFormatter(a),this.vertices[a].loadFromJSON(b)),"RectangleVertexGraphFormatter"!=b.type&&"RectangleVertexNetworkFormatter"!=b.type||(this.vertices[a]=new RectangleVertexGraphFormatter(a),this.vertices[a].loadFromJSON(b)),"RoundedVertexGraphFormatter"!=b.type&&"RoundedVertexNetworkFormatter"!=b.type||(this.vertices[a]=new RoundedVertexGraphFormatter(a),this.vertices[a].loadFromJSON(b)));var c=this;this.vertices[a].stateChanged.attach(function(a,b){c.changed.notify(b)});var d=this._getNodeSize(a);this.vertices[a].defaultFormat.args.size=d,this.vertices[a].selected.args.size=d,this.vertices[a].over.args.size=d},NetworkDataSetFormatter.prototype.addEdge=function(a,b){null==b?this.dataset.getEdgeById(a).getNodeSource().getId()==this.dataset.getEdgeById(a).getNodeTarget().getId()?this.edges[a]=new BezierEdgeGraphFormatter(a,this.args.defaultEdgeProperties.defaultFormat,this.args.defaultEdgeProperties.selected,this.args.defaultEdgeProperties.over,this.args.defaultEdgeProperties.dragging):this.edges[a]=new DirectedLineEdgeGraphFormatter(a,this.args.defaultEdgeProperties.defaultFormat,this.args.defaultEdgeProperties.selected,this.args.defaultEdgeProperties.over,this.args.defaultEdgeProperties.dragging):(null==b.type&&(this.edges[a]=new LineEdgeGraphFormatter(a,this.args.defaultEdgeProperties.defaultFormat,this.args.defaultEdgeProperties.selected,this.args.defaultEdgeProperties.over,this.args.defaultEdgeProperties.dragging)),"LineEdgeGraphFormatter"!=b.type&&"LineEdgeNetworkFormatter"!=b.type||(this.edges[a]=new LineEdgeGraphFormatter(a),this.edges[a].loadFromJSON(b)),"DirectedLineEdgeGraphFormatter"!=b.type&&"DirectedLineEdgeNetworkFormatter"!=b.type||(this.edges[a]=new DirectedLineEdgeGraphFormatter(a),this.edges[a].loadFromJSON(b)),"BezierEdgeGraphFormatter"!=b.type&&"BezierEdgeNetworkFormatter"!=b.type||(this.edges[a]=new BezierEdgeGraphFormatter(a),this.edges[a].loadFromJSON(b)),"CutDirectedLineEdgeGraphFormatter"!=b.type&&"CutDirectedLineEdgeNetworkFormatter"!=b.type||(this.edges[a]=new CutDirectedLineEdgeGraphFormatter(a),this.edges[a].loadFromJSON(b)),"DotDirectedLineEdgeGraphFormatter"!=b.type&&"DotDirectedLineEdgeNetworkFormatter"!=b.type||(this.edges[a]=new DotDirectedLineEdgeGraphFormatter(a),this.edges[a].loadFromJSON(b)),"OdotDirectedLineEdgeGraphFormatter"!=b.type&&"OdotDirectedLineEdgeNetworkFormatter"!=b.type||(this.edges[a]=new OdotDirectedLineEdgeGraphFormatter(a),this.edges[a].loadFromJSON(b)),"OdirectedLineEdgeGraphFormatter"!=b.type&&"OdirectedLineEdgeNetworkFormatter"!=b.type||(this.edges[a]=new OdirectedLineEdgeGraphFormatter(a),this.edges[a].loadFromJSON(b)));var c=this;this.edges[a].stateChanged.attach(function(a,b){c.edgeChanged.notify(b)}),this._recalculateSize()},NetworkDataSetFormatter.prototype._setDataset=function(a){this.dataset=a,this.maxClass=a.getMaxClass(),this.minClass=a.getMinClass(),this._attachDatasetEvents()},NetworkDataSetFormatter.prototype.changeEdgeType=function(a,b){"LineEdgeGraphFormatter"!=b&&"LineEdgeNetworkFormatter"!=b||(this.edges[a]=new LineEdgeGraphFormatter(a,this.args.defaultEdgeProperties.defaultFormat,this.args.defaultEdgeProperties.selected,this.args.defaultEdgeProperties.over,this.args.defaultEdgeProperties.dragging)),"DirectedLineEdgeGraphFormatter"!=b&&"DirectedLineEdgeNetworkFormatter"!=b||(this.edges[a]=new DirectedLineEdgeGraphFormatter(a,this.args.defaultEdgeProperties.defaultFormat,this.args.defaultEdgeProperties.selected,this.args.defaultEdgeProperties.over,this.args.defaultEdgeProperties.dragging)),"CutDirectedLineEdgeGraphFormatter"!=b&&"CutDirectedLineEdgeNetworkFormatter"!=b||(this.edges[a]=new CutDirectedLineEdgeGraphFormatter(a,this.args.defaultEdgeProperties.defaultFormat,this.args.defaultEdgeProperties.selected,this.args.defaultEdgeProperties.over,this.args.defaultEdgeProperties.dragging)),"DotDirectedLineEdgeGraphFormatter"!=b&&"DotDirectedLineEdgeNetworkFormatter"!=b||(this.edges[a]=new DotDirectedLineEdgeGraphFormatter(a,this.args.defaultEdgeProperties.defaultFormat,this.args.defaultEdgeProperties.selected,this.args.defaultEdgeProperties.over,this.args.defaultEdgeProperties.dragging)),"OdotDirectedLineEdgeGraphFormatter"!=b&&"OdotDirectedLineEdgeNetworkFormatter"!=b||(this.edges[a]=new OdotDirectedLineEdgeGraphFormatter(a,this.args.defaultEdgeProperties.defaultFormat,this.args.defaultEdgeProperties.selected,this.args.defaultEdgeProperties.over,this.args.defaultEdgeProperties.dragging)),"OdirectedLineEdgeGraphFormatter"!=b&&"OdirectedLineEdgeNetworkFormatter"!=b||(this.edges[a]=new OdirectedLineEdgeGraphFormatter(a,this.args.defaultEdgeProperties.defaultFormat,this.args.defaultEdgeProperties.selected,this.args.defaultEdgeProperties.over,this.args.defaultEdgeProperties.dragging));var c=this;this.edges[a].stateChanged.attach(function(a,b){c.edgeChanged.notify(b)}),c.edgeChanged.notify(this.edges[a])},NetworkDataSetFormatter.prototype.changeNodeType=function(a,b){var c=JSON.parse(JSON.stringify(this.vertices[a].getDefault())),c=(JSON.parse(JSON.stringify(this.vertices[a].getSelected())),JSON.parse(JSON.stringify(this.vertices[a].getDefault()))),c=JSON.parse(JSON.stringify(this.vertices[a].getDefault()));"SquareVertexGraphFormatter"!=b&&"SquareVertexNetworkFormatter"!=b||(this.vertices[a]=new SquareVertexGraphFormatter(a,c,this.args.vertexFormatProperties.selected,this.args.vertexFormatProperties.over,this.args.vertexFormatProperties.dragging)),"CircleVertexGraphFormatter"!=b&&"CircleVertexNetworkFormatter"!=b||(this.vertices[a]=new CircleVertexGraphFormatter(a,c,this.args.vertexFormatProperties.selected,this.args.vertexFormatProperties.over,this.args.vertexFormatProperties.dragging)),"EllipseVertexGraphFormatter"!=b&&"EllipseVertexNetworkFormatter"!=b||(this.vertices[a]=new EllipseVertexGraphFormatter(a,c,this.args.vertexFormatProperties.selected,this.args.vertexFormatProperties.over,this.args.vertexFormatProperties.dragging)),"RectangleVertexGraphFormatter"!=b&&"RectangleVertexNetworkFormatter"!=b||(this.vertices[a]=new RectangleVertexGraphFormatter(a,c,this.args.vertexFormatProperties.selected,this.args.vertexFormatProperties.over,this.args.vertexFormatProperties.dragging)),"RoundedVertexGraphFormatter"!=b&&"RoundedVertexNetworkFormatter"!=b||(this.vertices[a]=new RoundedVertexGraphFormatter(a,c,this.args.vertexFormatProperties.selected,this.args.vertexFormatProperties.over,this.args.vertexFormatProperties.dragging)),"OctagonVertexGraphFormatter"!=b&&"OctagonVertexNetworkhFormatter"!=b||(this.vertices[a]=new OctagonVertexGraphFormatter(a,c,this.args.vertexFormatProperties.selected,this.args.vertexFormatProperties.over,this.args.vertexFormatProperties.dragging));var d=this;this.vertices[a].stateChanged.attach(function(a,b){d.changed.notify(b)}),d.changed.notify(this.vertices[a])},NetworkDataSetFormatter.prototype.dataBind=function(a){this._setDataset(a);for(var b in this.dataset.getVertices())this.addVertex(b);for(var c in this.dataset.getEdges())this.addEdge(c)},NetworkDataSetFormatter.prototype._removeEdge=function(a){delete this.edges[a]},NetworkDataSetFormatter.prototype._removeVertex=function(a){delete this.vertices[a]},NetworkDataSetFormatter.prototype._attachDatasetEvents=function(a){var b=this;this.dataset.vertexDeleted.attach(function(a,c){b._removeVertex(c.getId())}),this.dataset.edgeDeleted.attach(function(a,c){b._removeEdge(c.getId())}),this.dataset.newVertex.attach(function(a,c){b.addVertex(c.getId())}),this.dataset.newEdge.attach(function(a,c){b.addEdge(c.getId())})},NetworkDataSetFormatter.prototype.getVertexById=function(a){return this.vertices[a]},NetworkDataSetFormatter.prototype.getEdgeById=function(a){return this.edges[a]},NetworkDataSetFormatter.prototype.makeLabelsBigger=function(){for(var a in this.vertices){var b=this.vertices[a].getDefault().getFontSize()+2;this.vertices[a].getDefault().setFontSize(b)}},NetworkDataSetFormatter.prototype.makeLabelsSmaller=function(){for(var a in this.vertices){var b=this.vertices[a].getDefault().getFontSize()-2;this.vertices[a].getDefault().setFontSize(b)}},NetworkDataSetFormatter.prototype.resize=function(a,b){this.args.width=a,this.args.height=b,this.resized.notify()},NetworkDataSetFormatter.prototype.getZoomScaleStepFactor=function(){return this.args.zoomScaleStepFactor},NetworkDataSetFormatter.prototype.setZoomScaleStepFactor=function(a){this.args.zoomScaleStepFactor=a},NetworkDataSetFormatter.prototype.getZoomScale=function(){return this.args.zoomScale},NetworkDataSetFormatter.prototype.setZoomScale=function(a){this.args.zoomScale=a},NetworkDataSetFormatter.prototype.getNodesMaxSize=function(){return this.args.nodesMaxSize},NetworkDataSetFormatter.prototype.getNodesMinSize=function(){return this.args.nodesMinSize},NetworkDataSetFormatter.prototype.isVerticesBalanced=function(){return this.args.balanceNodes},NetworkDataSetFormatter.prototype.getWidth=function(){return this.args.width},NetworkDataSetFormatter.prototype.getHeight=function(){return this.args.height},NetworkDataSetFormatter.prototype.getBackgroundImage=function(){return this.args.backgroundImage},NetworkDataSetFormatter.prototype.setBackgroundImage=function(a){this.args.backgroundImage=a,this.backgroundImageChanged.notify(this)},NetworkDataSetFormatter.prototype.getBackgroundImageWidth=function(){return this.args.backgroundImageWidth},NetworkDataSetFormatter.prototype.setBackgroundImageWidth=function(a){this.args.backgroundImageWidth=a,this.backgroundImageChanged.notify(this)},NetworkDataSetFormatter.prototype.getBackgroundImageHeight=function(){return this.args.backgroundImageHeight},NetworkDataSetFormatter.prototype.setBackgroundImageHeight=function(a){this.args.backgroundImageHeight=a,this.backgroundImageChanged.notify(this)},NetworkDataSetFormatter.prototype.getBackgroundImageX=function(){return this.args.backgroundImageX},NetworkDataSetFormatter.prototype.setBackgroundImageX=function(a){this.args.backgroundImageX=a,this.backgroundImageChanged.notify(this)},NetworkDataSetFormatter.prototype.getBackgroundImageY=function(){return this.args.backgroundImageX},NetworkDataSetFormatter.prototype.setBackgroundImageY=function(a){this.args.backgroundImageY=a,this.backgroundImageChanged.notify(this)},NetworkDataSetFormatter.prototype.getBackgroundColor=function(){return this.args.backgroundColor},NetworkDataSetFormatter.prototype.setBackgroundColor=function(a){this.args.backgroundColor=a,this.backgroundColorChanged.notify(this)},NetworkDataSetFormatter.prototype.getWidth=function(){return this.args.width},NetworkDataSetFormatter.prototype.setWidth=function(a){this.args.width=a},NetworkDataSetFormatter.prototype.getHeight=function(){return this.args.height},NetworkDataSetFormatter.prototype.setHeight=function(a){this.args.height=a},NetworkWidget.prototype.draw=function(a,b,c){this.graphCanvas=new GraphCanvas(this.id,document.getElementById(this.targetId),{labeled:this.label,multipleSelectionEnabled:!1,draggingCanvasEnabled:!1}),this.graphCanvas.draw(a,b,c);var d=this;this.graphCanvas.onVertexOver.attach(function(a,b){d.onVertexOver.notify(b)}),this.graphCanvas.onVertexOut.attach(function(a,b){d.onVertexOut.notify(b)})},NetworkWidget.prototype.selectVertexByName=function(a){var b=this.getDataset().getVertexByName(a);if(null!=b)for(var c in b)if(b.hasOwnProperty(c)){var d=b[c].getId();this.selectVertexById(d)}},NetworkWidget.prototype.selectVerticesByName=function(a){for(var b=0;b<a.length;b++)this.selectVertexByName(a[b])},NetworkWidget.prototype.selectVertexById=function(a){this.graphCanvas.selectNode(a),this.blinkVertexById(a)},NetworkWidget.prototype.selectVerticesById=function(a){for(var b=0;b<a.length;b++)this.selectVertexById(a[b])},NetworkWidget.prototype.selectNeighbourhood=function(){this.selectEdgesFromVertices(),this.selectAdjacent()},NetworkWidget.prototype.deselectNodes=function(){this.graphCanvas.deselectNodes()},NetworkWidget.prototype.selectAllNodes=function(){this.getGraphCanvas().selectAllNodes()},NetworkWidget.prototype.selectAll=function(){this.getGraphCanvas().selectAll()},NetworkWidget.prototype.selectAllEdges=function(){this.getGraphCanvas().selectAllEdges()},NetworkWidget.prototype.setScale=function(a){this.graphCanvas.setScale(a)},NetworkWidget.prototype.getScale=function(){return this.graphCanvas.getScale(value)},NetworkWidget.prototype.selectAdjacent=function(){for(var a=this.getGraphCanvas().getSelectedVertices(),b=[],c=0;c<a.length;c++)b=b.concat(this.getGraphCanvas().getDataset().getVertexById(a[c]).getEdges());var d=[];for(c=0;c<b.length;c++)d.push(b[c].getNodeSource().getId()),d.push(b[c].getNodeTarget().getId());this.selectVerticesById(d)},NetworkWidget.prototype.selectEdgesFromVertices=function(){for(var a=this.getGraphCanvas().getSelectedVertices(),b=[],c=0;c<a.length;c++)b=b.concat(this.getGraphCanvas().getDataset().getVertexById(a[c]).getEdges());var d=[];for(c=0;c<b.length;c++)d.push(b[c].getId());this.getGraphCanvas().selectEdges(d)},NetworkWidget.prototype.blinkVertexById=function(a){this.graphCanvas.blinkVertexById(a)},NetworkWidget.prototype.selectConnectedComponent=function(){var a=this.getConnectedComponent();this.selectVerticesById(a.nodes),this.graphCanvas.selectEdges(a.edges)},NetworkWidget.prototype.getConnectedComponent=function(){for(var a={},b={},c=[],d=[],e=this.getGraphCanvas().getSelectedVertices(),f=0;f<e.length;f++)this.visitNode(e[f],a,b,c,d);return{nodes:c,edges:d}},NetworkWidget.prototype.visitNode=function(a,b,c,d,e){b[a]=!0,d.push(a);for(var f=this.getDataset().getVertexById(a).getEdges(),g=0;g<f.length;g++){var h=f[g],i=h.getId();if(null==c[i]){c[i]=!0,e.push(i);var j=h.getNodeTarget().getId();null==b[j]&&this.visitNode(j,b,c,d,e);var k=h.getNodeSource().getId();null==b[k]&&this.visitNode(k,b,c,d,e)}}},NetworkWidget.prototype.collapse=function(){for(var a=this.getGraphCanvas().getSelectedVertices(),b=-(1/0),c=1/0,d=-(1/0),e=1/0,f=0;f<a.length;f++){var g=this.getGraphCanvas().getLayout().getNodeById(a[f]);b<g.x&&(b=g.x),c>g.x&&(c=g.x),d<g.y&&(d=g.y),e>g.y&&(e=g.y)}var h=b-c,i=d-e,j=(c-b)/4,k=a.length,l=[];for(f=0;f<a.length;f++)x=h+j*Math.sin(2*f*Math.PI/k),y=i+j*Math.cos(2*f*Math.PI/k),l.push({x:x,y:y});for(f=0;f<a.length;f++)this.getGraphCanvas().getLayout().getNodeById(a[f]).setCoordinates(l[f].x,l[f].y)},NetworkWidget.prototype.setVerticesFontSize=function(a){for(var b in this.getDataset().getVertices())this.getDataset().getVertices().hasOwnProperty(b)&&this.getFormatter().getVertexById(b).getDefault().setFontSize(a)},NetworkWidget.prototype.getFormatter=function(){return this.getGraphCanvas().getFormatter()},NetworkWidget.prototype.getLayout=function(){return this.getGraphCanvas().getLayout()},NetworkWidget.prototype.getDataset=function(){return this.getGraphCanvas().getDataset()},NetworkWidget.prototype.getGraphCanvas=function(){return this.graphCanvas};var SVG={svgns:"http://www.w3.org/2000/svg",xlinkns:"http://www.w3.org/1999/xlink",createSVGCanvas:function(a,b){b.push(["xmlns",SVG.svgns],["xmlns:xlink","http://www.w3.org/1999/xlink"]);var c=document.createElementNS("http://www.w3.org/2000/svg","svg");return this._setProperties(c,b),a.appendChild(c),c},createRectangle:function(a,b,c,d,e){var f=document.createElementNS(this.svgns,"rect");return f.setAttribute("x",a),f.setAttribute("y",b),f.setAttribute("width",c),f.setAttribute("height",d),SVG._setProperties(f,e),f},drawImage64:function(a,b,c,d,e,f,g){var h=SVG.createImage64(a,b,c,d,e,g);return f.appendChild(h),h},createImage64:function(a,b,c,d,e,f){var g=document.createElementNS(this.svgns,"image");return g.setAttribute("x",a),g.setAttribute("y",b),g.setAttribute("width",c),g.setAttribute("height",d),g.setAttribute("xlink:href",e),SVG._setProperties(g,f),g},createLine:function(a,b,c,d,e){var f=document.createElementNS(this.svgns,"line");return f.setAttribute("x1",a),f.setAttribute("y1",b),f.setAttribute("x2",c),f.setAttribute("y2",d),SVG._setProperties(f,e),f},createClip:function(a,b,c){var d=document.createElementNS(this.svgns,"clipPath");return d.setAttribute("id",a),d.appendChild(b),d},drawClip:function(a,b,c){var d=SVG.createClip(a,b);return c.appendChild(d),d},drawRectangle:function(a,b,c,d,e,f){try{var g=SVG.createRectangle(a,b,c,d,f);e.appendChild(g)}catch(h){console.log("-------------------- "),console.log("Error on drawRectangle "+h),console.log(f),console.log("-------------------- ")}return g},createEllipse:function(a,b,c,d,e){var f=document.createElementNS(this.svgns,"ellipse");return f.setAttribute("cx",a),f.setAttribute("cy",b),f.setAttribute("rx",c),f.setAttribute("ry",d),SVG._setProperties(f,e),f},drawEllipse:function(a,b,c,d,e,f){var g=SVG.createEllipse(a,b,c,d,f);return e.appendChild(g),g},drawImage:function(a,b,c,d){var e=document.createElementNS(this.svgns,"image");e.setAttribute("x",a),e.setAttribute("y",b),c.appendChild(e),SVG._setProperties(e,d)},drawLine:function(a,b,c,d,e,f){try{var g=SVG.createLine(a,b,c,d,f);e.appendChild(g)}catch(h){}return g},drawPath:function(a,b,c){var d=SVG.createPath(a,c);return b.appendChild(d),d},createPoligon:function(a,b){var c=document.createElementNS(this.svgns,"polygon");return c.setAttribute("points",a),SVG._setProperties(c,b),c},drawPoligon:function(a,b,c){var d=SVG.createPoligon(a,c);return b.appendChild(d),d},createPath:function(a,b){var c=document.createElementNS(this.svgns,"path");return c.setAttribute("d",a),SVG._setProperties(c,b),c},drawCircle:function(a,b,c,d,e){var f=document.createElementNS(this.svgns,"circle");return f.setAttribute("cx",a),f.setAttribute("cy",b),f.setAttribute("r",c),d.appendChild(f),e.cursor="pointer",this._setProperties(f,e),f},_setProperties:function(a,b){if(b instanceof Array)for(var c=0;c<b.length;c++)a.setAttribute(b[c][0],b[c][1]);else for(var d in b)a.setAttribute(d,b[d])},createText:function(a,b,c,d){var e=document.createElementNS(this.svgns,"text");e.setAttributeNS(null,"x",a),e.setAttributeNS(null,"y",b);var f=document.createTextNode(c);return e.appendChild(f),this._setProperties(e,d),e},drawText:function(a,b,c,d,e){var c=SVG.createText(a,b,c,e);return d.appendChild(c),c},drawGroup:function(a,b){var c=SVG.createGroup(b);return a.appendChild(c),c},createGroup:function(a){var b=document.createElementNS(this.svgns,"g");return this._setProperties(b,a),b}},CanvasToSVG={convert:function(a,b,c,d,e,f){for(var g=this._convert(a,b,c,d,e),h=0;h<f.length;h++)g.setAttribute(f[h][0],f[h][1])},_convert:function(a,b,c,d,e){var f="http://www.w3.org/2000/svg",g="http://www.w3.org/1999/xlink",h=a.toDataURL(),i=document.createElementNS(f,"image");return i.setAttribute("id",e),i.setAttributeNS(g,"xlink:href",h),i.setAttribute("x",c?c:0),i.setAttribute("y",d?d:0),i.setAttribute("width",a.width),i.setAttribute("height",a.height),i.imageData=h,b.appendChild(i),i},importSVG:function(a,b){svg_xml=a;var c=b.getContext("2d"),d=new Image;d.src="data:image/svg+xml;base64,"+btoa(svg_xml),c.drawImage(d,0,0)}};Vertex.prototype.getName=GraphItem.prototype.getName,Vertex.prototype.setName=GraphItem.prototype.setName,Vertex.prototype.getId=GraphItem.prototype.getId,Vertex.prototype.getEdges=function(){return this.edgesIn.concat(this.edgesOut)},Vertex.prototype.getEdgesCount=function(){return this.getEdges().length},Vertex.prototype.getEdgesIn=function(){return this.edgesIn},Vertex.prototype.getEdgesOut=function(){return this.edgesOut},Vertex.prototype.addEdge=function(a){a.getNodeSource().getId()==this.id?this.edgesIn.push(a):this.edgesOut.push(a)},Vertex.prototype.removeEdge=function(a){for(var b=0;b<this.getEdgesIn().length;b++){var c=this.edgesIn[b];c.getId()==a.getId()&&this.edgesIn.splice(b,1)}for(var b=0;b<this.getEdgesOut().length;b++){var c=this.edgesOut[b];c.getId()==a.getId()&&this.edgesOut.splice(b,1)}},Vertex.prototype.remove=function(){for(var a=this.getEdges(),b=0;b<a.length;b++){var c=a[b];c.remove()}this.deleted.notify(this)},VertexGraphFormatter.prototype.getDefault=ItemGraphFormatter.prototype.getDefault,VertexGraphFormatter.prototype.getSelected=ItemGraphFormatter.prototype.getSelected,VertexGraphFormatter.prototype.getOver=ItemGraphFormatter.prototype.getOver,VertexGraphFormatter.prototype.getDragging=ItemGraphFormatter.prototype.getDragging,VertexGraphFormatter.prototype.getId=ItemGraphFormatter.prototype.getId,VertexGraphFormatter.prototype.toJSON=ItemGraphFormatter.prototype.toJSON,VertexGraphFormatter.prototype.loadFromJSON=ItemGraphFormatter.prototype.loadFromJSON,VertexGraphFormatter.prototype._setEvents=ItemGraphFormatter.prototype._setEvents,CircleVertexGraphFormatter.prototype.getDefault=VertexGraphFormatter.prototype.getDefault,CircleVertexGraphFormatter.prototype.getSelected=VertexGraphFormatter.prototype.getSelected,CircleVertexGraphFormatter.prototype.getOver=VertexGraphFormatter.prototype.getOver,CircleVertexGraphFormatter.prototype.getDragging=VertexGraphFormatter.prototype.getDragging,CircleVertexGraphFormatter.prototype.getId=VertexGraphFormatter.prototype.getId,CircleVertexGraphFormatter.prototype.toJSON=VertexGraphFormatter.prototype.toJSON,CircleVertexGraphFormatter.prototype.loadFromJSON=VertexGraphFormatter.prototype.loadFromJSON,CircleVertexGraphFormatter.prototype._setEvents=VertexGraphFormatter.prototype._setEvents,SquareVertexGraphFormatter.prototype.getDefault=VertexGraphFormatter.prototype.getDefault,SquareVertexGraphFormatter.prototype.getSelected=VertexGraphFormatter.prototype.getSelected,SquareVertexGraphFormatter.prototype.getOver=VertexGraphFormatter.prototype.getOver,SquareVertexGraphFormatter.prototype.getDragging=VertexGraphFormatter.prototype.getDragging,SquareVertexGraphFormatter.prototype.getId=VertexGraphFormatter.prototype.getId,SquareVertexGraphFormatter.prototype.toJSON=VertexGraphFormatter.prototype.toJSON,SquareVertexGraphFormatter.prototype.loadFromJSON=VertexGraphFormatter.prototype.loadFromJSON,SquareVertexGraphFormatter.prototype._setEvents=VertexGraphFormatter.prototype._setEvents,EllipseVertexGraphFormatter.prototype.getDefault=VertexGraphFormatter.prototype.getDefault,EllipseVertexGraphFormatter.prototype.getSelected=VertexGraphFormatter.prototype.getSelected,EllipseVertexGraphFormatter.prototype.getOver=VertexGraphFormatter.prototype.getOver,EllipseVertexGraphFormatter.prototype.getDragging=VertexGraphFormatter.prototype.getDragging,EllipseVertexGraphFormatter.prototype.getId=VertexGraphFormatter.prototype.getId,EllipseVertexGraphFormatter.prototype.toJSON=VertexGraphFormatter.prototype.toJSON,EllipseVertexGraphFormatter.prototype.loadFromJSON=VertexGraphFormatter.prototype.loadFromJSON,EllipseVertexGraphFormatter.prototype._setEvents=VertexGraphFormatter.prototype._setEvents,RectangleVertexGraphFormatter.prototype.getDefault=ItemGraphFormatter.prototype.getDefault,RectangleVertexGraphFormatter.prototype.getSelected=ItemGraphFormatter.prototype.getSelected,RectangleVertexGraphFormatter.prototype.getOver=ItemGraphFormatter.prototype.getOver,RectangleVertexGraphFormatter.prototype.getDragging=ItemGraphFormatter.prototype.getDragging,RectangleVertexGraphFormatter.prototype.getId=ItemGraphFormatter.prototype.getId,RectangleVertexGraphFormatter.prototype.toJSON=ItemGraphFormatter.prototype.toJSON,RectangleVertexGraphFormatter.prototype.loadFromJSON=ItemGraphFormatter.prototype.loadFromJSON,RectangleVertexGraphFormatter.prototype._setEvents=ItemGraphFormatter.prototype._setEvents,RoundedVertexGraphFormatter.prototype.getDefault=ItemGraphFormatter.prototype.getDefault,RoundedVertexGraphFormatter.prototype.getSelected=ItemGraphFormatter.prototype.getSelected,RoundedVertexGraphFormatter.prototype.getOver=ItemGraphFormatter.prototype.getOver,RoundedVertexGraphFormatter.prototype.getDragging=ItemGraphFormatter.prototype.getDragging,RoundedVertexGraphFormatter.prototype.getId=ItemGraphFormatter.prototype.getId,RoundedVertexGraphFormatter.prototype.toJSON=ItemGraphFormatter.prototype.toJSON,RoundedVertexGraphFormatter.prototype.loadFromJSON=ItemGraphFormatter.prototype.loadFromJSON,RoundedVertexGraphFormatter.prototype._setEvents=ItemGraphFormatter.prototype._setEvents,OctagonVertexGraphFormatter.prototype.getDefault=ItemGraphFormatter.prototype.getDefault,OctagonVertexGraphFormatter.prototype.getSelected=ItemGraphFormatter.prototype.getSelected,OctagonVertexGraphFormatter.prototype.getOver=ItemGraphFormatter.prototype.getOver,OctagonVertexGraphFormatter.prototype.getDragging=ItemGraphFormatter.prototype.getDragging,OctagonVertexGraphFormatter.prototype.getId=ItemGraphFormatter.prototype.getId,OctagonVertexGraphFormatter.prototype.toJSON=ItemGraphFormatter.prototype.toJSON,OctagonVertexGraphFormatter.prototype.loadFromJSON=ItemGraphFormatter.prototype.loadFromJSON,OctagonVertexGraphFormatter.prototype._setEvents=ItemGraphFormatter.prototype._setEvents,PDBViewer.prototype.getTitle=function(){return"<div style='width:"+this.width+"px; height:20px; font-weight:bold;background-color: #E6E6E6;color:black'>"+this.title+"</div>"},PDBViewer.prototype.getTextAreaId=function(){return this.id+"_src"},PDBViewer.prototype.getCanvas=function(){var a="width:"+this.width+"px; height: "+this.height+"px;display: none;",b="<textarea id='"+this.getTextAreaId()+"'; style='"+a+"' ></textarea>",c="width: "+this.width+"px; height: "+this.height+"px; background-color: black;";return b+"<div id='"+this.id+"'; style='"+c+"' ></div>"},PDBViewer.prototype.getDownload=function(a,b){var c=BUI.getPdbURL()+"&type="+a+"&abInitioModelId="+b;return html="<a href="+c+' style="color:blue;font-weight:bold;"  height="80" width="80" >Download</a><br /><br />',"<div style='width:"+this.width+"px; height:20px; font-weight:bold;background-color: #336699;color:white'>"+html+"</div>"},PDBViewer.prototype.getBar=function(){return"<div style='width:"+this.width+"px; height:20px; font-weight:bold;background-color: #336699;color:white'></div>"},PDBViewer.prototype.refresh=function(a){var b=this;if(BUI.isWebGLEnabled()){this.models=a,b.panel.setLoading("Rendering");var c=function(a,c){null!=c.models&&null!=c.models[0]&&(document.getElementById(b.getTextAreaId()).innerHTML=c.models[0].XYZ,null==b.glMol?b.glMol=new GLmol(b.id):b.glMol.loadMolecule()),b.panel.setLoading(!1)};EXI.getDataAdapter({onSuccess:c}).saxs.model.getPDB(a,[])}else this.webGLNotAvailable()},PDBViewer.prototype.getOpacity=function(a){
return"Invisible"==a?"0":"Minimum"==a?"0.2":"Medium"==a?"0.5":"High"==a?"0.7":"1"},PDBViewer.prototype.getMenu=function(a){function b(b,d,e){if(d){var f=null;if("Opacity"==b.group)for(f=0;f<c.models.length;f++){var g=c.getOpacity(b.text);a.opacity=g}if("Radius"==b.group)for(f=0;f<c.models.length;f++){var h=c.getOpacity(b.text);a.radius=h}c.refresh(c.models)}}var c=this;return Ext.create("Ext.menu.Menu",{items:[{text:"Opacity",menu:{items:[{text:"Invisible",checked:!1,group:"Opacity",checkHandler:b},{text:"Minimum",checked:!1,group:"Opacity",checkHandler:b},{text:"Medium",checked:!1,group:"Opacity",checkHandler:b},{text:"High",checked:!1,group:"Opacity",checkHandler:b},{text:"Opaque",checked:!1,group:"Opacity",checkHandler:b}]}}]})},PDBViewer.prototype.getTbar=function(){for(var a=this,b=Ext.create("Ext.toolbar.Toolbar"),c=[],d=0;d<this.models.length;d++){b.add({text:this.models[d].title,menu:this.getMenu(this.models[d])});var e="#"+this.models[d].color.replace("0x","");c.push({html:"<table><tr><td width='15px'>"+BUI.getRectangleColorDIV(e,10,10)+"</td><td>"+this.models[d].title+"</td></table>"})}return b.add({xtype:"numberfield",labelWidth:50,width:120,fieldLabel:"Radius",value:3,maxValue:10,step:.2,minValue:.1,listeners:{change:function(b){for(var c=b.getValue(),d=0;d<a.models.length;d++)a.models[d].radius=c;a.refresh(a.models)}}}),b.add("->"),b.add(c),b},PDBViewer.prototype.getPanel=function(){return this.panel=Ext.create("Ext.panel.Panel",{margin:this.margin,border:0,layout:{type:"vbox"},width:this.width-4,height:this.height+30,items:[{html:this.getCanvas()}],listeners:{afterRender:function(){}}}),this.panel.setLoading("Rendering"),this.panel},PDBViewer.prototype.webGLNotAvailable=function(){document.getElementById(_this.id).innerHTML=BUI.getWarningHTML("Your browser doesn't support WebGL"),document.getElementById(_this.id).innerHTML=document.getElementById(_this.id).innerHTML+"<br />",document.getElementById(_this.id).innerHTML=document.getElementById(_this.id).innerHTML+BUI.getTipHTML("<a href='http://www.browserleaks.com/webgl#howto-enable-disable-webgl'>How to enable WebGL</a>"),document.getElementById(_this.id).innerHTML=document.getElementById(_this.id).innerHTML+"<br />",document.getElementById(_this.id).innerHTML=document.getElementById(_this.id).innerHTML+BUI.getTipHTML("<a href='http://caniuse.com/webgl'>Can I use WebGL?</a>")},PDBViewer.prototype.draw=function(a){this.models=a;var b=this;return this.panel=Ext.create("Ext.panel.Panel",{margin:2,layout:{type:"vbox"},tbar:this.getTbar(),width:this.width-4,height:this.height+30,items:[{html:this.getCanvas()}],listeners:{afterRender:function(){b.refresh(a)}}}),this.panel.setLoading("Rendering"),this.panel},SuperpositionPDBViewer.prototype.draw=PDBViewer.prototype.draw,SuperpositionPDBViewer.prototype.getBar=PDBViewer.prototype.getBar,SuperpositionPDBViewer.prototype.getCanvas=PDBViewer.prototype.getCanvas,SuperpositionPDBViewer.prototype.getDownload=PDBViewer.prototype.getDownload,SuperpositionPDBViewer.prototype.getMenu=PDBViewer.prototype.getMenu,SuperpositionPDBViewer.prototype.getOpacity=PDBViewer.prototype.getOpacity,SuperpositionPDBViewer.prototype.getPanel=PDBViewer.prototype.getPanel,SuperpositionPDBViewer.prototype.getTbar=PDBViewer.prototype.getTbar,SuperpositionPDBViewer.prototype.getTextAreaId=PDBViewer.prototype.getTextAreaId,SuperpositionPDBViewer.prototype.getTitle=PDBViewer.prototype.getTitle,SuperpositionPDBViewer.prototype.refresh=PDBViewer.prototype.refresh,SuperpositionPDBViewer.prototype.webGLNotAvailable=PDBViewer.prototype.webGLNotAvailable,SuperpositionPDBViewer.prototype.refresh=function(a){var b=this;if(BUI.isWebGLEnabled()){this.models=a;var c=new BiosaxsDataAdapter;b.panel.setLoading("Rendering"),c.onSuccess.attach(function(a,c){document.getElementById(b.getTextAreaId()).innerHTML=c.XYZ,null==b.glMol?b.glMol=new GLmol(b.id):b.glMol.loadMolecule(),b.panel.setLoading(!1)}),c.onError.attach(function(a,c){b.panel.setLoading("Not available")}),c.getAbinitioPDBContentBySuperpositionList(a)}else this.webGLNotAvailable()},AlignedSuperpositionPDBViewer.prototype.draw=PDBViewer.prototype.draw,AlignedSuperpositionPDBViewer.prototype.getBar=PDBViewer.prototype.getBar,AlignedSuperpositionPDBViewer.prototype.getCanvas=PDBViewer.prototype.getCanvas,AlignedSuperpositionPDBViewer.prototype.getDownload=PDBViewer.prototype.getDownload,AlignedSuperpositionPDBViewer.prototype.getMenu=PDBViewer.prototype.getMenu,AlignedSuperpositionPDBViewer.prototype.getOpacity=PDBViewer.prototype.getOpacity,AlignedSuperpositionPDBViewer.prototype.getPanel=PDBViewer.prototype.getPanel,AlignedSuperpositionPDBViewer.prototype.getTbar=PDBViewer.prototype.getTbar,AlignedSuperpositionPDBViewer.prototype.getTextAreaId=PDBViewer.prototype.getTextAreaId,AlignedSuperpositionPDBViewer.prototype.getTitle=PDBViewer.prototype.getTitle,AlignedSuperpositionPDBViewer.prototype.refresh=PDBViewer.prototype.refresh,AlignedSuperpositionPDBViewer.prototype.webGLNotAvailable=PDBViewer.prototype.webGLNotAvailable,AlignedSuperpositionPDBViewer.prototype.refresh=function(a){var b=this;if(BUI.isWebGLEnabled()){this.models=a,b.panel.setLoading("Rendering PDB");var c=new BiosaxsDataAdapter;c.onError.attach(function(a,b){console.log(a)}),c.onSuccess.attach(function(c,d){var e=d.superpositions[0][a[0]];document.getElementById(b.id).innerHTML="",b.glMol=new GLmol(b.id,!1,!1,e.apriori.data),b.glMol.addSuperpositionXYZ(e.aligned.XYZ,"0xFFFFFF",.3,1);var f=b.glMol.getView();b.glMol.setView(f),b.panel.setLoading(!1)}),null!=a&&0!=a.length&&c.getDataPDB([],a)}else this.webGLNotAvailable()},StructurePDBViewer.prototype.draw=PDBViewer.prototype.draw,StructurePDBViewer.prototype.getBar=PDBViewer.prototype.getBar,StructurePDBViewer.prototype.getCanvas=PDBViewer.prototype.getCanvas,StructurePDBViewer.prototype.getDownload=PDBViewer.prototype.getDownload,StructurePDBViewer.prototype.getMenu=PDBViewer.prototype.getMenu,StructurePDBViewer.prototype.getOpacity=PDBViewer.prototype.getOpacity,StructurePDBViewer.prototype.getPanel=PDBViewer.prototype.getPanel,StructurePDBViewer.prototype.getTbar=PDBViewer.prototype.getTbar,StructurePDBViewer.prototype.getTextAreaId=PDBViewer.prototype.getTextAreaId,StructurePDBViewer.prototype.getTitle=PDBViewer.prototype.getTitle,StructurePDBViewer.prototype.refresh=PDBViewer.prototype.refresh,StructurePDBViewer.prototype.webGLNotAvailable=PDBViewer.prototype.webGLNotAvailable,StructurePDBViewer.prototype.refresh=function(a){var b=this;if(BUI.isWebGLEnabled()){this.models=a,b.panel.setLoading("Rendering");var c=new BiosaxsDataAdapter;c.onSuccess.attach(function(a,c){document.getElementById(b.getTextAreaId()).innerHTML=c;new GLmol(b.id);b.panel.setLoading(!1)}),c.onError.attach(function(a,c){b.panel.setLoading("Not available")}),c.getDataPDB(models,[])}else this.webGLNotAvailable()},QueueGrid.prototype.getSorters=function(){return{}},QueueGrid.prototype.getSelected=function(){return this.selected},QueueGrid.prototype.getSelectedData=function(){for(var a=this.panel.getSelectionModel().selected.items,b=[],c=0;c<a.length;c++)b.push(a[c].data);return b},QueueGrid.prototype.getFields=function(){return["experimentId","subtractionId","macromoleculeAcronym","priorityLevelId","code","exposureTemperature","concentration"]},QueueGrid.prototype.getRunHTML=function(a){var b=a.data.dataCollectionId,c=document.createElement("table");if(null!=this.key[b]){this.key[b].sort(function(a,b){return b.measurementId-a.measurementId});for(i in this.key[b]){var d=this.key[b][i],e=document.createElement("tr"),f=document.createElement("td");null!=d.measurementCode?null==d.macromoleculeId?(f.setAttribute("style","padding-top:1px;width:130px;color:gray;"),f.appendChild(document.createTextNode("# "+d.measurementCode))):(f.setAttribute("style","padding-top:1px;width:130px;font-weight:bold;"),f.appendChild(document.createTextNode("# "+d.measurementCode))):f.appendChild(document.createTextNode(" - ")),e.appendChild(f),c.appendChild(e)}}return"<table>"+c.innerHTML+"</table>"},QueueGrid.prototype.getPercentage=function(a,b){var c=document.createElement("td"),d="green";return null==a&&(a="NA",d="orange"),null==b&&(b="NA",d="orange"),"NA"!=a&"NA"!=b&&(a/b>=.3&&(d="orange"),a/b>.7&&(d="#BCF5A9"),.3>a/b&&(d="red")),c.appendChild(document.createTextNode(a+" / "+b)),c.setAttribute("style","background-color:"+d+";"),c},QueueGrid.prototype.getFramesHTML=function(a){var b=a.data.dataCollectionId,c=document.createElement("table");if(null!=this.key[b]){this.key[b].sort(function(a,b){return b.measurementId-a.measurementId});for(i in this.key[b]){var d=this.key[b][i],e=document.createElement("tr"),f=document.createElement("td");null==d.macromoleculeId?(f.setAttribute("style","width:130px;color:gray;"),f.appendChild(document.createTextNode(d.bufferAcronym))):(f.setAttribute("style","width:130px;font-weight:bold;"),f.appendChild(document.createTextNode(d.macromoleculeAcronym))),e.appendChild(f),e.appendChild(this.getPercentage(d.framesMerge,d.framesCount));var f=document.createElement("td"),g=document.createElement("a");null==d.macromoleculeId?g.setAttribute("href",BUI.getZipURLByAverageId(d.mergeId,d.measurementCode)):g.setAttribute("href",BUI.getZipURLBySubtractionId(d.subtractionId,d.measurementCode)),e.appendChild(f),c.appendChild(e)}}return"<table>"+c.innerHTML+"</table>"},QueueGrid.prototype.getHTMLTable=function(a){for(var b="",c=0;c<a.length;c++)b=b+"<tr><td class='key_subgrid'>"+a[c].key+"</td><td class='value_subgrid'>"+a[c].value+"</td></tr>";return"<table>"+b+"</table>"},QueueGrid.prototype.getImage=function(a,b){if(null!=a.data.macromoleculeId&&null!=a.data.subtractionId){var c=EXI.getDataAdapter().saxs.subtraction.getImage(a.data.subtractionId,b);return"<img src="+c+'   height="70" width="70" >'}},QueueGrid.prototype.getColumns=function(){var a=this;return[{header:"dataCollectionId",name:"dataCollectionId",dataIndex:"dataCollectionId",flex:1,hidden:!0},{header:"Exp. Id",name:"experimentId",dataIndex:"experimentId",flex:1,hidden:!0},{header:"Exp. Name",name:"name",dataIndex:"name",flex:1,hidden:!0},{header:"MeasurementId",name:"measurementId",dataIndex:"measurementId",hidden:!0,flex:1,renderer:function(a,b,c){return c.raw.measurementId}},{header:"Date",name:"date",flex:1,dataIndex:"runCreationDate",hidden:!0},{header:"Run",flex:.2,name:"runNumber",dataIndex:"measurementCode",renderer:function(b,c,d){return a.getRunHTML(d)}},{header:"Frames (Average/Total)",dataIndex:"macromoleculeId",name:"macromoleculeAcronym",flex:1,hidden:!1,renderer:function(b,c,d){return a.getFramesHTML(d)}},{text:"Scattering",dataIndex:"subtractionId",width:110,name:"subtractionId",renderer:function(b,c,d){return a.getImage(d,"scattering")}},{header:"Macromolecule",name:"macromoleculeAcronym",dataIndex:"macromoleculeAcronym",flex:1,hidden:!0},{header:"Concentration",name:"concentration",flex:.5,dataIndex:"concentration",hidden:!1,renderer:function(a,b,c){return 0!=c.data.concentration?BUI.formatValuesUnits(c.data.concentration,"mg/ml",7,this.decimals):void 0}},{header:"Exp. Temp.",name:"bufferAcronym",dataIndex:"bufferAcronym",flex:.5,renderer:function(a,b,c){return BUI.formatValuesUnits(c.data.exposureTemperature,"C",10,this.decimals)}},{text:"Kratky.",dataIndex:"subtractionId",hidden:!0,flex:1,name:"subtractionId",renderer:function(b,c,d){return a.getImage(d,"kratky")}},{text:"P(r).",hidden:!0,flex:1,dataIndex:"subtractionId",type:"string",renderer:function(b,c,d){return a.getImage(d,"density")}},{text:"Guinier.",hidden:!0,flex:1,dataIndex:"subtractionId",type:"string",renderer:function(b,c,d){return a.getImage(d,"guinier")}},{text:"Guinier",name:"Guinier",flex:.8,dataIndex:"subtractionId",renderer:function(b,c,d){if(null!=d.data.macromoleculeId&&null!=d.data.subtractionId){var e=[];return null!=d.data.rg?e.push({key:"Rg",value:BUI.formatValuesUnits(d.data.rg,"nm",12,this.decimals)}):e.push({key:"Rg",value:"<span class='notavailablefield'>NA</span>"}),null!=d.data.rg?e.push({key:"Points",value:"<span>"+d.data.firstPointUsed+" - "+d.data.lastPointUsed+" ("+(d.data.lastPointUsed-d.data.firstPointUsed)+")</span>"}):e.push({key:"Points",value:"<span class='notavailablefield'>NA</span>"}),null!=d.data.I0?e.push({key:"I0",value:BUI.formatValuesErrorUnitsScientificFormat(d.data.I0,d.data.I0Stdev,"")}):e.push({key:"I0",value:"<span class='notavailablefield'>NA</span>"}),a.getHTMLTable(e)}}},{text:"Gnom",name:"Gnom",flex:.7,dataIndex:"subtractionId",renderer:function(b,c,d){if(null!=d.data.macromoleculeId&&null!=d.data.subtractionId){var e=[];return null!=d.data.rgGnom?e.push({key:"Rg",value:BUI.formatValuesUnits(d.data.rgGnom,"nm")}):e.push({key:"Rg",value:"<span class='notavailablefield'>NA</span>"}),null!=d.data.rgGnom?e.push({key:"Total",value:BUI.formatValuesUnits(d.data.total,"")}):e.push({key:"Total",value:"<span class='notavailablefield'>NA</span>"}),null!=d.data.dmax?e.push({key:"D<sub>max</sub>",value:BUI.formatValuesUnits(d.data.dmax,"")+"<span style='font-size:8px;color:gray;'> nm</span>"}):e.push({key:"D<sub>max</sub>",value:"<span class='notavailablefield'>NA</span>"}),a.getHTMLTable(e)}}},{text:"Porod",name:"Porod",flex:1,dataIndex:"subtractionId",renderer:function(b,c,d){if(null!=d.data.macromoleculeId&&null!=d.data.subtractionId){var e=[];return null!=d.data.volumePorod?e.push({key:"Volume",value:BUI.formatValuesUnits(d.data.volumePorod,"")+"<span style='font-size:8px;color:gray;'> nm<sub>3</sub></span>"}):e.push({key:"Volume",value:"<span class='notavailablefield'>NA</span>"}),null!=d.data.volumePorod?e.push({key:"MM Vol. est.",value:Number(d.data.volumePorod/2).toFixed(1)+" - "+Number(d.data.volumePorod/1.5).toFixed(1)+"<span style='font-size:8px;color:gray;'>kD</span>"}):e.push({key:"MM Vol. est.",value:"<span class='notavailablefield'>NA</span>"}),a.getHTMLTable(e)}}},{text:"Advanced",hidden:!1,id:this.id+"buttonAction",dataIndex:"subtrationId",flex:1,renderer:function(a,b,c){var d="<table><tr><td style='padding-bottom: 1px;'>"+BUI.getGreenButton("Data Reduction",{width:90,height:15})+"</td></tr>";return d=c.data.abinitioCount>0?d+"<tr><td style='padding-bottom: 1px;'>"+BUI.getGreenButton("Abinitio",{width:90,height:15})+"</td></tr>":d+"<tr><td style='padding-bottom: 1px;'>"+BUI.getBlueButton("Abinitio",{width:90,height:15})+"</td></tr>",d=c.data.fitCount>0?d+"<tr><td style='padding-bottom: 1px;'>"+BUI.getGreenButton("Fit",{width:90,height:15})+"</td></tr>":d+"<tr><td style='padding-bottom: 1px;'>"+BUI.getBlueButton("Fit",{width:90,height:15})+"</td></tr>",d=c.data.superposisitionCount>0?d+"<tr><td style='padding-bottom: 1px;'>"+BUI.getGreenButton("Superposition",{width:90,height:15})+"</td></tr>":d+"<tr><td style='padding-bottom: 1px;'>"+BUI.getBlueButton("Superposition",{width:90,height:15})+"</td></tr>",d=c.data.rigidbodyCount>0?d+"<tr><td style='padding-bottom: 1px;'>"+BUI.getGreenButton("Rigid Body",{width:90,height:15})+"</td></tr>":d+"<tr><td style='padding-bottom: 1px;'>"+BUI.getBlueButton("Rigid Body",{width:90,height:15})+"</td></tr>",d+"</table>"}}]},QueueGrid.prototype.load=function(a){null!=a?(this.key={},this.store.loadData(a,!0)):this.store.load()},QueueGrid.prototype.getPanel=function(){var a=this;Ext.ClassManager.isCreated("Queue")||Ext.define("Queue",{extend:"Ext.data.Model",fields:["name","date","volumePorod","runCreationDate","measurementCode","macromoleculeAcronym","bufferAcronym","I0","I0Stdev","acronym","averageFilePath","bufferAverageFilePath","bufferId","bufferOnedimensionalFiles","code","comments","composition","concentration","creationDate","creationTime","dataAcquisitionFilePath","dataCollectionId","discardedFrameNameList","dmax","experimentId","experimentType","exposureTemperature","extintionCoefficient","extraFlowTime","firstPointUsed","flow","frameListId","framesCount","framesMerge","gnomFilePath","gnomFilePathOutput","guinierFilePath","isagregated","kratkyFilePath","lastPointUsed",{name:"macromoleculeId",id:"macromoleculeId"},{name:"measurementId",type:"int"},"mergeId","molecularMass","name","pH","priorityLevelId","proposalId","quality","rg","rgGnom","rgGuinier","rgStdev","runId","safetyLevelId","sampleAverageFilePath","sampleOneDimensionalFiles","samplePlatePositionId","scatteringFilePath","sequence","sessionId","sourceFilePath","specimenId","status","stockSolutionId","substractedFilePath","subtractionId","total","transmission","viscosity","volume","volumeToLoad","waitTime","reference","refined","fitCount","superposisitionCount","rigidbodyCount","abinitioCount"]}),this.store=Ext.create("Ext.data.Store",{model:"Queue",data:[],filters:this.filters,listeners:{beforeload:function(){return a.key={},!0},load:function(a,b){}},proxy:{type:"memory",reader:{type:"json"}}});var b=Ext.create("Ext.selection.RowModel",{allowDeselect:!0,mode:this.selectionMode,listeners:{selectionchange:function(b,c){a.selected=a.getSelectedData(),a.onSelectionChange.notify(a.selected)},select:function(b,c){a.onSelect.notify(c.data)},deselect:function(b,c){a.onDeselect.notify(c.data)}}});return this.panel=Ext.create("Ext.grid.Panel",{title:this.title,border:!0,cls:"defaultGridPanel",maxHeight:this.maxHeight,overflow:"auto",margin:5,store:this.store,columns:this.getColumns(),allowDeselect:!0,selModel:b,collapsible:this.collapsible,collapsed:this.collapsed,viewConfig:{enableTextSelection:!0,preserveScrollOnRefresh:!0,stripeRows:!0,rowLines:!0,listeners:{cellclick:function(b,c,d,e,f,g,h,i){"Data Reduction"==h.target.defaultValue&&(location.hash="/saxs/datacollection/dataCollectionId/"+e.data.dataCollectionId+"/primaryviewer"),"Abinitio"==h.target.defaultValue&&a.onAbinitioButtonClicked(e.raw),"Fit"==h.target.defaultValue&&a.onFitButtonClicked(e.raw),"Superposition"==h.target.defaultValue&&a.onSuperpositionButtonClicked(e.raw),"Rigid Body"==h.target.defaultValue&&a.onRigidBodyButtonClicked(e.raw)}}}}),this.panel},QueueGrid.prototype.onDataReductionButtonClicked=function(a){var b=new DataAdapter,c=new DataReductionForm({});Ext.create("Ext.window.Window",{title:"Data Reduction",height:540,width:1e3,modal:!0,items:[c.getPanel()]}).show(),c.panel.setLoading(),b.onSuccess.attach(function(a,b){c.refresh(b),c.panel.setLoading(!1)}),b.getSubtractionsBySubtractionIdList([a.subtractionId])},RigidModelGrid.prototype.refresh=function(a){var b=[];if(null!=a&&a.length>0)for(var c in a){var d=a[c];if(null!=d.rigidBodyModeling3VOs)for(var e in d.rigidBodyModeling3VOs)b.push(d.rigidBodyModeling3VOs[e])}this.store.loadData(b)},RigidModelGrid.prototype.getPanel=function(){return this.store=Ext.create("Ext.data.Store",{fields:["symmetry","subtractionId","subUnitConfigFilePath","rigidBodyModelingId","rigidBodyModelFilePath","logFilePath","fitFilePath","curveConfigFilePath","crossCorrConfigFilePath","contactDescriptionFilePath"],data:[]}),this.store.sort([{property:"name",direction:"ASC"}]),this.panel=Ext.create("Ext.grid.Panel",{store:this.store,width:this.width,height:this.height,margin:10,deferredRender:!1,columns:[{text:"RBM",dataIndex:"rigidBodyModelFilePath",hidden:!1,flex:1,renderer:function(a){return BUI.getFileName(a)}},{text:"Sub Unit Conf.",dataIndex:"subUnitConfigFilePath",hidden:!0,flex:1,renderer:function(a){return BUI.getFileName(a)}},{text:"Log",dataIndex:"logFilePath",hidden:!0,flex:1,renderer:function(a){return BUI.getFileName(a)}},{text:"Fit",dataIndex:"fitFilePath",hidden:!1,flex:1,renderer:function(a){return BUI.getFileName(a)}},{text:"Curve Conf.",dataIndex:"curveConfigFilePath",hidden:!1,flex:1,renderer:function(a){return BUI.getFileName(a)}},{text:"Cross Corr.",dataIndex:"crossCorrConfigFilePath",hidden:!1,flex:1,renderer:function(a){return BUI.getFileName(a)}},{text:"Contact Desc.",dataIndex:"contactDescriptionFilePath",hidden:!0,flex:1,renderer:function(a){return BUI.getFileName(a)}}],viewConfig:{enableTextSelection:!0,preserveScrollOnRefresh:!0},listeners:{cellclick:function(a,b,c,d,e,f,g,h){},afterrender:function(){}}}),this.panel},RigidBodyModelingForm.prototype.openUploadManager=function(a){var b=this,c=new UploaderWidget(a);c.onUploaded.attach(function(a){b.panel.setLoading(),EXI.proposalManager.get(!0),b.load(EXI.proposalManager.getMacromoleculeById(b.macromolecule.macromoleculeId)),b.panel.setLoading(!1)}),c.show()},RigidBodyModelingForm.prototype._getItems=function(){var a=this;return[{xtype:"label",forId:"myFieldId",text:"Information for model fit, mixture analysis and rigid body modeling",margin:"15 0 20 10",cls:"inline-help"},this.rigidBodyGrid.getPanel(),{xtype:"label",forId:"myFieldId",text:"Distance restraints may be imposed on the model using contacts conditions file (OPTIONAL)",margin:"25 0 5 10",cls:"inline-help"},{xtype:"container",layout:"hbox",items:[{xtype:"container",border:!1,layout:"hbox",items:[{xtype:"label",forId:"myFieldId",text:"Contact Description File: (Optional)",width:150,margin:"10 0 0 10"},{id:this.id+"contactsDescriptionFilePath",xtype:"textfield",hideLabel:!0,margin:"10 0 0 0",width:400},{text:"Upload",xtype:"button",margin:"10 0 0 10",width:80,handler:function(){a.openUploadManager(EXI.getDataAdapter().saxs.macromolecule.getContactDescriptionUploadFileURL(a.macromolecule.macromoleculeId))}},{text:"Remove",id:a.id+"_remove",xtype:"button",margin:"10 0 0 10",width:80,handler:function(){a.panel.setLoading(!0);var b=function(){EXI.proposalManager.get(!0),a.load(EXI.proposalManager.getMacromoleculeById(a.macromolecule.macromoleculeId)),a.panel.setLoading(!1)};EXI.getDataAdapter({onSuccess:b}).saxs.macromolecule.removeContactDescriptionFile(a.macromolecule.macromoleculeId)}}]}]},{xtype:"panel",html:"<span class='inline-help' >Go to <a target='_blank' href='http://www.embl-hamburg.de/biosaxs/manuals/sasrefcvmx.html#input-format'>SASREF manual</a> for further information</span>",margin:"10 0 0 160",border:0}]},RigidBodyModelingForm.prototype._update=function(a,b,c){var d=this;BIOSAXS.proposal.onInitialized.attach(function(){null!=BIOSAXS.proposal&&(d.refresh(BIOSAXS.proposal.getMacromoleculeById(d.macromolecule.macromoleculeId)),d.panel.setLoading(!1))}),this.panel.setLoading(),BIOSAXS.proposal.init()},RigidBodyModelingForm.prototype.getPanel=function(){var a=this;return this.panel=Ext.create("Ext.form.Panel",{width:this.width,height:this.height,cls:"border-grid",defaultType:"textfield",items:this._getItems(),padding:20,listeners:{afterrender:function(){a._populate()}}}),this.panel},RigidBodyModelingForm.prototype._populate=function(){null!=this.macromolecule&&null!=Ext.getCmp(this.id+"contactsDescriptionFilePath")&&(null!=this.macromolecule.contactsDescriptionFilePath?(Ext.getCmp(this.id+"contactsDescriptionFilePath").setValue(this.macromolecule.contactsDescriptionFilePath),Ext.getCmp(this.id+"_remove").enable()):(Ext.getCmp(this.id+"_remove").disable(),Ext.getCmp(this.id+"contactsDescriptionFilePath").setValue("")))},RigidBodyModelingForm.prototype.load=function(a){this.macromolecule=a,this.rigidBodyGrid.load(a),this._populate()},RigidBodyModelingForm.prototype.input=function(){return{}},RigidBodyModelingForm.prototype.test=function(a){var b=new RigidBodyModelingForm,c=b.getPanel();c.render(a)},SamplePlateGroupWidget.prototype.drawPlate=function(a,b,c){var d=this,e=new SamplePlateWidget({width:this.width/3-5,height:this.heightPlates+10,nodeSize:this.nodeSize,fontSize:0,strokeWidth:1.5});this.isVerticalLayout()&&(e.width=this.width-15,e.height=this.heightPlates-10),e.draw(a,b,c),e.onVertexUp.attach(function(a,b){d.onClick.notify({samplePlate:b.samplePlate,row:b.row,column:b.column})}),this.samplePlateWidgets.push(e)},SamplePlateGroupWidget.prototype.drawPlates=function(a){if(a)for(var b=a.getPlateGroups(),c=0;c<b.length;c++)for(var d=b[c].plateGroupId,e=a.getPlatesByPlateGroupId(d),f=0;f<e.length;f++){var g=this.id+"_"+e[f].samplePlateId;null!=document.getElementById(g)&&this.drawPlate(a,e[f],g)}},SamplePlateGroupWidget.prototype.getDimensions=function(a){var b=0,c=0;if(null!=a)for(var d=0;d<a.length;d++){var e=a[d].slotPositionRow;null!=e&&(e=parseFloat(e),e>b&&(b=e));var f=a[d].slotPositionColumn;null!=f&&(f=parseFloat(f),f>c&&(c=f))}return{maxSlotPositionRow:parseFloat(b),maxSlotPositionColumn:parseFloat(c)}},SamplePlateGroupWidget.prototype.isVerticalLayout=function(){return!0},SamplePlateGroupWidget.prototype.getPlateBySlotPosition=function(a,b,c){if(null!=a)for(var d=0;d<a.length;d++)if(a[d].slotPositionRow==b&&a[d].slotPositionColumn==c)return a[d];return null},SamplePlateGroupWidget.prototype.getPlatesContainer=function(a){var b=[];null!=a&&(b=a.getPlateGroups());var c=document.createElement("div"),d=document.createElement("table");d.setAttribute("width",this.width-30+"px"),d.setAttribute("height",this.heightPlates+"px");for(var e=0;e<b.length;e++)for(var f=b[e].plateGroupId,g=a.getPlatesByPlateGroupId(f),h=this.getDimensions(g),i=1;i<=h.maxSlotPositionRow;i++)for(var j=1;j<=h.maxSlotPositionColumn;j++){var k=document.createElement("tr"),l=this.getPlateBySlotPosition(g,i,j),m=document.createElement("td");m.setAttribute("id",this.id+"_"+l.samplePlateId),m.setAttribute("style","background-color:#E6E6E6;border-width:1px;border-style:solid;");var n=document.createElement("div");n.setAttribute("class","menu-title");var o=document.createTextNode(l.platetype3VO.name);n.appendChild(o),m.appendChild(n),k.appendChild(m),d.appendChild(k)}return c.appendChild(d),c.innerHTML},SamplePlateGroupWidget.prototype.selectSpecimens=function(a){for(var b=0;b<this.samplePlateWidgets.length;b++)this.samplePlateWidgets[b].clearSelection();for(var b=0;b<a.length;b++)this.selectSpecimen(a[b])},SamplePlateGroupWidget.prototype.selectSpecimen=function(a){if(null!=a.sampleplateposition3VO)for(var b=0;b<this.samplePlateWidgets.length;b++)if(this.samplePlateWidgets[b].samplePlate.samplePlateId==a.sampleplateposition3VO.samplePlateId)return void this.samplePlateWidgets[b].selectSpecimen(a)},SamplePlateGroupWidget.prototype._refreshBbar=function(){null!=this.panel&&(this.panel.removeDocked(Ext.getCmp(this.id+"bbar")),this.panel.addDocked(this.getBbar()))},SamplePlateGroupWidget.prototype.refresh=function(a){this.experiment=a,this.samplePlateWidgets=[],null!=document.getElementById(this.id+"_container")&&(document.getElementById(this.id+"_container").innerHTML="",document.getElementById(this.id+"_container").innerHTML=this.getPlatesContainer(a),this.drawPlates(a)),this._refreshBbar()},SamplePlateGroupWidget.prototype._getAutoFillButton=function(){function a(){}function b(a){if("yes"==a){var b=e.samplePlateId,c=new BiosaxsDataAdapter;d.panel.setLoading("ISPyB: Saving Plate"),c.onSuccess.attach(function(a,b){d.onExperimentChanged.notify(b),d.panel.setLoading(!1)}),c.onError.attach(function(a){alert("error"),d.panel.setLoading(!1)}),c.autoFillPlate(b,d.experiment.experimentId)}}function c(a){e=a,Ext.MessageBox.confirm("Confirm",'Are you sure you want to fill "'+d.experiment.getSamplePlateById(e.samplePlateId).platetype3VO.name+'" plate?',b)}var d=this,e=null,f=[];if(f.push('<b class="menu-title">Select a plate:</b>'),this.experiment){var g=this.experiment.getSamplePlates();g.sort(function(a,b){return a.slotPositionColumn-b.slotPositionColumn});for(var h=0;h<g.length;h++)f.push({samplePlateId:g[h].samplePlateId,text:h+1+".- <b> "+g[h].platetype3VO.name+"</b>",handler:c})}return Ext.create("Ext.button.Split",{text:"Auto Fill",handler:a,tooltip:{text:"This will fill, if there is place, the specimens in the plate",title:"Auto Fill"},menu:{items:f}})},SamplePlateGroupWidget.prototype._getZoomButton=function(){function a(a){Ext.create("Ext.window.Window",{title:b.experiment.getSamplePlateById(a.samplePlateId).platetype3VO.name,height:600,width:900,layout:"fit",modal:!0,listeners:{afterrender:function(){var c=new SamplePlateWidget({width:880,height:560,nodeSize:4,fontSize:0,strokeWidth:1.5,showLabels:!0,backgroundColor:"#FFFFFF"});c.draw(b.experiment,b.experiment.getSamplePlateById(a.samplePlateId),"plateZoom")}},items:[{html:'<div id="plateZoom" style="background-color:red"></div>',padding:5}]}).show()}var b=this,c=[];if(this.experiment){var d=this.experiment.getSamplePlates();d.sort(function(a,b){return a.slotPositionColumn-b.slotPositionColumn}),c.push('<b class="menu-title">Select a plate:</b>');for(var e=0;e<d.length;e++)c.push({samplePlateId:d[e].samplePlateId,text:e+1+".- <b> "+d[e].platetype3VO.name+"</b>",handler:a})}return Ext.create("Ext.button.Split",{text:"Zoom In",tooltip:{text:"This will show a plate bigger",title:"Zoom In Action"},menu:{items:c}})},SamplePlateGroupWidget.prototype._getEmptyButton=function(){function a(){}function b(a){if("yes"==a){var b=e.samplePlateId,c=new BiosaxsDataAdapter;d.panel.setLoading("ISPyB: Saving Plate"),c.onSuccess.attach(function(a,b){d.onExperimentChanged.notify(b),d.panel.setLoading(!1)}),c.onError.attach(function(a){alert("error"),d.panel.setLoading(!1)}),c.emptyPlate(b,d.experiment.experimentId)}}function c(a){e=a,Ext.MessageBox.confirm("Confirm",'Are you sure you want to empty "'+d.experiment.getSamplePlateById(e.samplePlateId).platetype3VO.name+'" plate?',b)}var d=this,e=null,f=[];if(this.experiment){var g=this.experiment.getSamplePlates();g.sort(function(a,b){return a.slotPositionColumn-b.slotPositionColumn}),f.push('<b class="menu-title">Select a plate:</b>');for(var h=0;h<g.length;h++)f.push({samplePlateId:g[h].samplePlateId,text:h+1+".- <b> "+g[h].platetype3VO.name+"</b>",handler:c})}return Ext.create("Ext.button.Split",{text:"Empty",handler:a,tooltip:{text:"This will empty the specimen of a plate. It will NOT remove the specimen but will removed their position",title:"Empty Action"},menu:{items:f}})},SamplePlateGroupWidget.prototype._getPlateTypes=function(){function a(){}function b(a){if("yes"==a){var b=e.samplePlateId,c=e.plateTypeId,f=BIOSAXS.proposal.getPlateTypeById(c),g=d.experiment.getSamplePlateById(b);g.platetype3VO=f;var b=e.samplePlateId,h=new BiosaxsDataAdapter;d.panel.setLoading("ISPyB: Saving Plate"),h.onSuccess.attach(function(a,b){d.onExperimentChanged.notify(b),d.panel.setLoading(!1)}),h.onError.attach(function(a){alert("error"),d.panel.setLoading(!1)}),h.savePlates([g],d.experiment.experimentId)}}function c(a){e=a;var c=a.samplePlateId,f=a.plateTypeId;d.experiment.getSamplePlateById(c).platetype3VO.plateTypeId!=f&&Ext.MessageBox.confirm("Confirm",'Are you sure you want to change the type of "'+d.experiment.getSamplePlateById(e.samplePlateId).platetype3VO.name+'" plate?',b)}var d=this,e=null,f=[];f.push('<b class="menu-title">Select an EMPTY plate:</b>');var g=[];null!=this.experiment&&(g=this.experiment.getSamplePlates()),g.sort(function(a,b){return a.slotPositionColumn-b.slotPositionColumn});for(var h=ProposalManager.getPlateTypes(),i=0;i<g.length;i++){for(var j=g[i],k=[],l=0;l<h.length;l++)k.push({text:h[l].name,plateTypeId:h[l].plateTypeId,samplePlateId:j.samplePlateId,checked:j.platetype3VO.plateTypeId==h[l].plateTypeId,group:"theme"+j.samplePlateId,checkHandler:c});f.push({text:i+1+".- <b> "+j.platetype3VO.name+"</b>",disabled:d.experiment.getSpecimensBySamplePlateId(j.samplePlateId).length>0,menu:{items:k}})}return Ext.create("Ext.button.Split",{text:"Plate Types",handler:a,tooltip:{text:"This will change the type of a plate.",title:"Change plate type"},menu:{items:f}})},SamplePlateGroupWidget.prototype.getBbar=function(a){var b=this;return this.bbar?Ext.create("Ext.toolbar.Toolbar",{id:b.id+"bbar",dock:"bottom",items:[this._getPlateTypes(),"-",this._getAutoFillButton(),this._getEmptyButton(),"-",this._getZoomButton()]}):null},SamplePlateGroupWidget.prototype.getPanel=function(){var a=this,b=this.id+"_container";return this.panel=Ext.create("Ext.panel.Panel",{title:this.title,bbar:this.getBbar(),height:this.height,width:this.width,border:this.border,items:[{border:0,height:this.height,id:b,html:"<div id='"+b+"'></div>"}]}),this.panel.on("afterrender",function(){document.getElementById(b).innerHTML=a.getPlatesContainer(a.experiment),a.drawPlates(a.experiment),a._refreshBbar()}),this.panel},SamplePlateWidget.prototype.clear=function(a,b,c){null!=document.getElementById(this.targetId)&&(document.getElementById(this.targetId).innerHTML="");
},SamplePlateWidget.prototype.draw=function(a,b,c,d){var e=this;if(this.windowContainerId=d,Ext.isIE6||Ext.isIE7||Ext.isIE8)return void(document.getElementById(c).innerHTML=BUI.getWarningHTML(this.notSupportedMessage));this.onVertexUp=new Event(this),this.samplePlate=b,this.experiment=a,this.targetId=c;var f=this.samplePlate.platetype3VO.rowCount,g=this.samplePlate.platetype3VO.columnCount;this.network=new NetworkWidget({targetId:c});var h=new GraphDataset,i=new NetworkDataSetFormatter({defaultFormat:{type:"LineEdgeNetworkFormatter","fill-opacity":1,fill:this.wellColor,"stroke-width":this.strokeWidth,"stroke-opacity":1,stroke:"#000000",size:this.nodeSize,title:{fontSize:this.fontSize,fill:"#000000"}}},null,{labeled:!1,height:this.height,width:this.width,right:this.width,backgroundColor:this.backgroundColor,balanceNodes:!1,nodesMaxSize:12,nodesMinSize:2});i.dataBind(h);var j=new LayoutDataset;j.dataBind(h),this.network.draw(h,i,j);for(var k=1;f>=k;k++)for(var l=1;g>=l;l++)this.network.getDataset().addNode("",{row:k,column:l})," 4 x ( 8 + 3 ) Block"==this.samplePlate.platetype3VO.name&&(9>l?this.network.getFormatter().vertices[this.network.getDataset().getVerticesCount()-1].getDefault().setSize(.8*this.nodeSize):this.network.getFormatter().vertices[this.network.getDataset().getVerticesCount()-1].getDefault().setSize(1.4*this.nodeSize));this.network.graphCanvas.onVertexUp.attach(function(a,b){e.onVertexUp.notify({samplePlate:e.samplePlate,row:e.network.getDataset().getVertexById(b).args.row,column:e.network.getDataset().getVertexById(b).args.column})}),this.network.graphCanvas.onVertexOver.attach(function(a,b){}),this.relayout(this.network,f,g),this.fillSimulator(this.experiment.getSamples()),this.showBorderLabels&&this.drawBorders()},SamplePlateWidget.prototype.drawBorders=function(){var a={},b={},c=[],d=[],e=this.network.graphCanvas.getLayout().vertices;for(var f in e){var g=e[f].x;null==a[g]&&(a[g]=!0,c.push(g));var h=e[f].y;null==b[h]&&(b[h]=!0,d.push(h))}for(var i=BUI.getSamplePlateLetters(),j=1;j<=c.length;j++)SVG.drawText(c[j-1]*this.network.graphCanvas.getWidth()-5,this.network.graphCanvas.getHeight(),j,this.network.graphCanvas._svg,[["font-size",this.legendFontSize+"px"],["font-weight","bold"],["fill","black"]]);for(var j=1;j<=d.length;j++)SVG.drawText(5,d[j-1]*this.network.graphCanvas.getHeight()+5,i[j-1],this.network.graphCanvas._svg,[["font-size",this.legendFontSize+"px"],["font-weight","bold"],["fill","black"]])},SamplePlateWidget.prototype.addOkIcon=function(a,b,c,d){var e=this.network.graphCanvas._svg,c=c+"_marked";null==this.markedSpecimenId[c]&&(SVG.drawRectangle(a-10,b-10,22,22,e,[["id",c],["fill","gray"],["stroke-opacity","0.5"],["fill-opacity","0.2"],["stroke","black"]]),this.markedSpecimenId[c]=!0)},SamplePlateWidget.prototype.selectSpecimen=function(a){var b=this.getVertexByPosition(a.sampleplateposition3VO.rowNumber,a.sampleplateposition3VO.columnNumber),c=this.network.getLayout().vertices[b.id].x*this.width,d=this.network.getLayout().vertices[b.id].y*this.height,e=this.network.graphCanvas._svg;this.selectedSVGNodes.push(SVG.drawRectangle(c-9,d-9,20,20,e,[["fill","red"],["fill-opacity","0"],["stroke","blue"],["stroke-width","2"]]))},SamplePlateWidget.prototype.clearSelection=function(){for(var a=this.network.graphCanvas._svg,b=0;b<this.selectedSVGNodes.length;b++)a.removeChild(this.selectedSVGNodes[b]);this.selectedSVGNodes=[]},SamplePlateWidget.prototype.getVertexByPosition=function(a,b){var c=this.network.getDataset().getVertices();for(var d in c)if(c[d].args.row==a&&c[d].args.column==b)return c[d];return null},SamplePlateWidget.prototype.showLabel=function(a,b,c){if(null!=c){var d=this.getVertexByPosition(a,b);0!=this.fontSize&&(null!=c.macromolecule3VO?this.showFullName?d.setName(c.code):d.setName(c.macromolecule3VO.acronym):this.showFullName?d.setName(c.code):d.setName(c.macromolecule3VO.acronym))}},SamplePlateWidget.prototype.getNodeIdBySpecimenId=function(a){this.ids[a]},SamplePlateWidget.prototype.markSpecimenAsOk=function(a,b,c,d){if(null!=a.measurements)for(var e=0;e<a.measurements.length;e++)null!=a.measurements[e].merge3VOs&&a.measurements[e].merge3VOs.length>0&&this.addOkIcon(b*this.network.graphCanvas.getWidth(),c*this.network.graphCanvas.getHeight(),d,a)},SamplePlateWidget.prototype.getSpecimenBufferColorFromSampleSpecimenId=function(a){var b=this.experiment.getDataCollectionsBySpecimenId(a);if(b.length>0)for(var c=b[0],d=0;d<c.measurementtodatacollection3VOs.length;d++){var e=c.measurementtodatacollection3VOs[d];if(1==e.dataCollectionOrder){var f=this.experiment.getMeasurementById(e.measurementId);return null!=f?this.experiment.getSpecimenColorByBufferId(f.specimenId):"pink"}}return"orange"},SamplePlateWidget.prototype.fillWell=function(a,b,c){if(null!=c){var d=this.getVertexByPosition(a,b);if(null==d)return void console.log(a+", "+b+" not found");var e=this.network.getGraphCanvas().getSVGNodeId(d.id);this.showLabel(a,b,c),this.ids[c.specimenId]=d.id;var f=this.network.getLayout().vertices[d.id].x,g=this.network.getLayout().vertices[d.id].y;if(this.markSpecimenAsOk(c,f,g,e),null==c.macromolecule3VO){var h=this.experiment.getSpecimenColorByBufferId(c.specimenId);this.network.getFormatter().getVertexById(d.id).getDefault().setFill(h),this.network.getFormatter().getVertexById(d.id).getDefault().setStroke("blue"),this.network.getFormatter().getVertexById(d.id).getDefault().setStrokeWidth(2)}else this.network.getFormatter().getVertexById(d.id).getDefault().setFill(this.experiment.macromoleculeColors[c.macromolecule3VO.macromoleculeId]),this.network.getFormatter().getVertexById(d.id).getDefault().setStroke("black"),this.network.getFormatter().getVertexById(d.id).getDefault().setStrokeWidth(1);if(this.showLabels){if(f=this.network.getLayout().vertices[d.id].x,g=this.network.getLayout().vertices[d.id].y,null!=c.macromolecule3VO){var i=c.macromolecule3VO.acronym;i.length>10&&(i=i.slice(0,10)+"..."),SVG.drawText(f*this.network.graphCanvas.getWidth()-this.nodeSize-10,g*this.network.graphCanvas.getHeight()+3*this.nodeSize+20,i,this.network.graphCanvas._svg,[["font-size","xx-small"],["fill","black"]]),SVG.drawText(f*this.network.graphCanvas.getWidth()-this.nodeSize-10,g*this.network.graphCanvas.getHeight()+3*this.nodeSize+35,Number(c.concentration).toFixed(2)+" mg/ml",this.network.graphCanvas._svg,[["font-size","xx-small"],["fill","black"]])}var j=this.experiment.getBufferById(c.bufferId).acronym;j.length>10&&(j=j.slice(0,10)+"..."),SVG.drawText(f*this.network.graphCanvas.getWidth()-this.nodeSize-10,g*this.network.graphCanvas.getHeight()+3*this.nodeSize+5,this.experiment.getBufferById(c.bufferId).acronym,this.network.graphCanvas._svg,[["font-size","xx-small"],["fill","blue"]])}if(this.showTooltip)var e=this.network.getGraphCanvas().getSVGNodeId(d.id)}},SamplePlateWidget.prototype._getToolTipContent=function(a){var b="<table style='font-size:11px;'>";return b=b+"<TR><TD>Specimen </TD><TD style='color:black; font-weight:bold;'>"+a.code+"</TD></TR>",b+="<TR style='height:20px'><TD></TD><TD style='color:black; font-weight:bold;'></TD></TR>",b=b+"<TR><TD>Buffer: </TD><TD style='color:blue; font-weight:bold;'>"+this.experiment.getBufferById(a.bufferId).name+"</TD></TR>",null!=a.macromolecule3VO&&(b=b+"<TR><TD>Macromolecule: </TD><TD  style='color:green; font-weight:bold;'>"+a.macromolecule3VO.acronym+"</TD></TR>",b=b+"<TR><TD>Concentration: </TD><TD >"+a.concentration+"</TD></TR>"),b=b+"<TR><TD>Volume: </TD><TD>"+a.volume+"</TD></TR>",null!=a.viscosity&&(b=b+"<TR><TD>Viscosity: </TD><TD>"+a.viscosity+"</TD></TR>"),b+="</table>"},SamplePlateWidget.prototype.fillSimulator=function(a){for(var b=0;b<a.length;b++){var c=a[b];if(null!=c.sampleplateposition3VO&&c.sampleplateposition3VO.samplePlateId==this.samplePlate.samplePlateId){var d=c.sampleplateposition3VO;this.fillWell(d.rowNumber,d.columnNumber,c)}}},SamplePlateWidget.prototype.relayout=function(a,b,c){"REC"==this.samplePlate.platetype3VO.shape&&this.squareRelayout(a,b,c),"CIR"==this.samplePlate.platetype3VO.shape&&this.circleRelayout(a,b,c)},SamplePlateWidget.prototype.squareRelayout=function(a,b,c){for(var d=(a.getDataset()._getVerticesCount(),.07),e=.9,f=.075,g=.95,h=(e-d)/(b-1),i=(g-f)/(c-1),j=[],k=0;b>k;k++)for(var l=0;c>l;l++)y=k*h+d,x=l*i+f,j.push({x:x,y:y});var m=0;for(var n in a.getDataset().getVertices())null==a.getLayout().vertices[n]&&(this.vertices[n]=new NodeLayout(n,0,0)),a.getLayout().vertices[n].setCoordinates(j[m].x,j[m].y),m++,a.getLayout().vertices[n].changed.attach(function(a,b){_this.changed.notify(b)})},SamplePlateWidget.prototype.circleRelayout=function(a,b,c){a.getLayout().getLayout("CIRCLE")},SamplesGrid.prototype.load=function(a){try{this.crystal=a,this.loadSampleList()}catch(b){EXI.setError(b)}},SamplesGrid.prototype.loadSampleList=function(){function a(a,c){b.store.loadData(c),b.panel.setLoading(!1)}var b=this;this.panel.setLoading(),EXI.getDataAdapter({onSuccess:a}).mx.sample.getSampleInfoByCrystalId(this.crystal.crystalId)},SamplesGrid.prototype.getByCrystalId=function(a){for(var b=0;b<this.data.length;b++)if(this.data[b].crystalId==a.crystalId)return this.data[b]},SamplesGrid.prototype.getPanel=function(){return this.store2=Ext.create("Ext.data.Store",{model:"BLSampleModel",data:[]}),this.store=Ext.create("Ext.data.Store",{fields:["Protein","SpaceGroup","SampleName","Code","Shipment","Dewar","Container","Location","Cell"],emptyText:"No samples",data:[]}),this.panel=Ext.create("Ext.grid.Panel",{title:this.title,store:this.store,layout:"fit",icon:"../images/icon/sessions.png",cls:"border-grid",height:this.height,margin:this.margin,emptyText:"No samples",columns:[{text:"SampleName",dataIndex:"sampleName",width:100},{text:"Protein",dataIndex:"proteinAcronym",width:100},{text:"SpaceGroup",dataIndex:"crystalSpaceGroup",width:100},{text:"Code",dataIndex:"code",width:100},{text:"Location",dataIndex:"containerSampleChangerLocation",width:100},{text:"Shipment",dataIndex:"shipment",flex:.1,renderer:function(a,b,c){return c.data.containerVO.DewarVO.ShippingVO.name}},{text:"Dewar",dataIndex:"dewar",flex:.1,renderer:function(a,b,c){return c.data.containerVO.DewarVO.code}},{text:"Location in SC",dataIndex:"sampleChangerLocation",flex:.1,renderer:function(a,b,c){return c.data.containerVO.sampleChangerLocation}},{text:"Cell",dataIndex:"cell",flex:.1,renderer:function(a,b,c){var d=2;if(c.data.crystalVO){var e=c.data.CellA?Number(c.data.crystalVO.CellA).toFixed(d)+", ":"";return e+=c.data.crystalVO.CellB?Number(c.data.crystalVO.CellB).toFixed(d)+", ":"",e+=c.data.crystalVO.CellC?Number(c.data.crystalVO.CellC).toFixed(d)+"<br />":"",e+=c.data.crystalVO.CellAlpha?Number(c.data.crystalVO.CellAlpha).toFixed(d)+", ":"",e+=c.data.crystalVO.CellBeta?Number(c.data.crystalVO.CellBeta).toFixed(d)+", ":"",e+=c.data.crystalVO.CellGamma?Number(c.data.crystalVO.CellGamma).toFixed(d):""}return""}},{text:"Protein",dataIndex:"proteinAcronym",flex:.1,renderer:function(a,b,c){return c.data.crystalVO.proteinVO.acronym}}]}),this.panel},SpecimenGrid.prototype._prepareData=function(a){for(var b=[],c=a.getSamples(),d=0;d<c.length;d++){var e=c[d];null!=e.macromolecule3VO&&(e.macromolecule=e.macromolecule3VO.acronym,e.exposureTemperature=[],e.macromoleculeId=e.macromolecule3VO.macromoleculeId),null!=e.sampleplateposition3VO?null!=e.sampleplateposition3VO.samplePlateId&&(e.samplePlateId=e.sampleplateposition3VO.samplePlateId,e.rowNumber=e.sampleplateposition3VO.rowNumber,e.columnNumber=e.sampleplateposition3VO.columnNumber,null!=a.getSamplePlateById(e.sampleplateposition3VO.samplePlateId).plategroup3VO&&(e.plateGroupName=a.getSamplePlateById(e.sampleplateposition3VO.samplePlateId).plategroup3VO.name,e.samplePlateName=a.getSamplePlateById(e.sampleplateposition3VO.samplePlateId).name+"  ["+e.plateGroupName+"]",e.slotPositionColumn=a.getSamplePlateById(e.sampleplateposition3VO.samplePlateId).slotPositionColumn)):e.samplePlateName="Unallocated Specimens",e.groupIndex=e.bufferId+e.macromoleculeId;var f=EXI.proposalManager.getMacromoleculeById(e.macromoleculeId);e.acronym="Buffers",null!=f&&(e.acronym=EXI.proposalManager.getMacromoleculeById(e.macromoleculeId).acronym),e.buffer=a.getBufferById(e.bufferId),e.volumeToLoad=a.getVolumeToLoadBySampleId(e.sampleId),b.push(e)}return b},SpecimenGrid.prototype.deselectAll=function(){this.grid.getSelectionModel().deselectAll()},SpecimenGrid.prototype.selectById=function(a){this.grid.getSelectionModel().deselectAll();for(var b=0;b<this.grid.getStore().data.items.length;b++){var c=this.grid.getStore().data.items[b].data;c.specimenId==a&&this.grid.getSelectionModel().select(b)}},SpecimenGrid.prototype.getStore=function(){return this.store},SpecimenGrid.prototype.getPlugins=function(){var a=this,b=[];return this.updateRowEnabled&&b.push(Ext.create("Ext.grid.plugin.RowEditing",{clicksToEdit:1,listeners:{validateedit:function(b,c){var d=[];if(c.newValues.bufferId!=c.record.data.bufferId){var e=[];if(null==c.record.data.macromoleculeId)e=e.concat(a.experiment.getDataCollectionsBySpecimenId(c.record.data.specimenId));else for(var f=a.experiment.getDataCollectionsBySpecimenId(c.record.data.specimenId),g=0;g<f.length;g++){var h=f[g];if(null!=h)for(var i=0;i<h.measurementtodatacollection3VOs.length;i++){var j=h.measurementtodatacollection3VOs[i];1==j.dataCollectionOrder&&(e=e.concat(a.experiment.getDataCollectionsBySpecimenId(a.experiment.getMeasurementById(j.measurementId).specimenId)))}}var g=null;for(g=0;g<e.length;g++){var k=e[g],l=a.experiment.getSpecimenByDataCollectionId(k.dataCollectionId);d=d.concat(l)}for(g=0;g<d.length;g++){var m=d[g],n=a.experiment.getSpecimenById(m.specimenId);n.bufferId=c.newValues.bufferId,(new DataAdapter).saveSpecimen(n,a.experiment)}}if(c.record.data.concentration=c.newValues.concentration,c.record.data.volume=c.newValues.volume,null!=c.record.data.sampleplateposition3VO){var o=a.experiment.getSamplePlateBySlotPositionColumn(c.newValues.slotPositionColumn);null!=o&&(c.record.data.sampleplateposition3VO={columnNumber:c.newValues.columnNumber,rowNumber:c.newValues.rowNumber,samplePlateId:o.samplePlateId})}else if(null!=c.newValues.slotPositionColumn){var o=a.experiment.getSamplePlateBySlotPositionColumn(c.newValues.slotPositionColumn);null!=o&&(c.record.data.sampleplateposition3VO={columnNumber:c.newValues.columnNumber,rowNumber:c.newValues.rowNumber,samplePlateId:o.samplePlateId})}var p=c.record.data.macromoleculeId,q=function(b,c){null!=p&&(c.macromolecule3VO=EXI.proposalManager.getMacromoleculeById(p)),a.onSpecimenChanged.notify(c),a.grid.setLoading(!1)};a.grid.setLoading(),EXI.getDataAdapter({onSuccess:q}).saxs.specimen.saveSpecimen(c.record.data)}}})),b},SpecimenGrid.prototype._getRowCombo=function(){for(var a=[],b=1;8>=b;b++)a.push({rowNumber:b,name:BUI.getSamplePlateLetters()[b-1]});var c=Ext.create("Ext.data.Store",{fields:["rowNumber","name"],data:a});return Ext.create("Ext.form.ComboBox",{store:c,queryMode:"local",displayField:"name",valueField:"rowNumber"})},SpecimenGrid.prototype._getColumnCombo=function(){for(var a=[],b=1;12>=b;b++)a.push({columnNumber:b});var c=Ext.create("Ext.data.Store",{fields:["columnNumber"],data:a});return Ext.create("Ext.form.ComboBox",{store:c,queryMode:"local",displayField:"columnNumber",valueField:"columnNumber"})},SpecimenGrid.prototype._getSlotColumBombo=function(){if(this.experiment){for(var a=this.experiment.getSamplePlates().length,b=[],c=1;a>=c;c++)b.push({slotPositionColumn:c});var d=Ext.create("Ext.data.Store",{fields:["slotPositionColumn"],data:b});return Ext.create("Ext.form.ComboBox",{store:d,queryMode:"local",displayField:"slotPositionColumn",valueField:"slotPositionColumn"})}},SpecimenGrid.prototype.getPanelByExperiment=function(a){this.experiment=a;var b=this._prepareData(a);return this.getPanel(b)},SpecimenGrid.prototype.refresh=function(a){this.experiment=a;var b=this._prepareData(a);this.store.loadData(b)},SpecimenGrid.prototype.getPanel=function(){var a=this;this.store=Ext.create("Ext.data.Store",{fields:["buffer","bufferId","code","macromolecule","acronym","macromoleculeId","concentration","volume","samplePlateId","slotPositionColumn","rowNumber","columnNumber","groupIndex"],data:[],groupField:"acronym"}),this.store.sort([{property:"concentration",direction:"ASC"},{property:"buffer",direction:"ASC"}]);var b=Ext.create("Ext.selection.RowModel",{allowDeselect:!0,listeners:{select:function(b,c,d,e){a.onSelected.notify([c.data])}}}),c=[];return this.grouped&&c.push({ftype:"grouping",groupHeaderTpl:"{name}",hideGroupedHeader:!1,startCollapsed:!1,id:"myGroupedStore"}),this.grid=Ext.create("Ext.grid.Panel",{title:this.title,height:this.height,width:this.width,selModel:b,store:this.store,features:c,margin:this.margin,plugins:this.getPlugins(),cls:"border-grid",columns:[{text:"",dataIndex:"macromolecule",width:20,renderer:function(b,c,d){var e=null;return e=null!=d.data.macromolecule3VO?d.data.macromolecule3VO.macromoleculeId:d.data.macromoleculeId,null!=e?BUI.getRectangleColorDIV(a.experiment.macromoleculeColors[e],10,10):void 0}},{text:"Macromolecule",dataIndex:"macromolecule",width:100},{text:"",dataIndex:"buffer",width:20,renderer:function(b,c,d){var e="black";return null!=d.data.bufferId?(null!=a.experiment.getDataCollectionsBySpecimenId(d.data.specimenId)[0]&&(e=a.experiment.getSpecimenColorByBufferId(a.experiment.getMeasurementById(a.experiment.getDataCollectionsBySpecimenId(d.data.specimenId)[0].measurementtodatacollection3VOs[0].measurementId).specimenId)),BUI.getRectangleColorDIV(e,10,10)):void 0}},{text:"Buffer",dataIndex:"bufferId",width:140,editor:BIOSAXS_COMBOMANAGER.getComboBuffers(EXI.proposalManager.getBuffers(),{noLabel:!0,width:300}),renderer:function(a,b,c){return null!=c.data.bufferId?EXI.proposalManager.getBufferById(a).acronym:void 0}},{text:"Conc.",dataIndex:"concentration",width:100,editor:{allowBlank:!1},renderer:function(a,b,c){return isNaN(a)?(b.tdCls="yellow-cell",a):0!=a?BUI.formatValuesUnits(a,"mg/ml",{fontSize:16,decimals:3,unitsFontSize:this.unitsFontSize}):void 0}},{text:"Vol. Well",dataIndex:"volume",width:70,editor:{allowBlank:!0},renderer:function(a,b,c){return BUI.formatValuesUnits(c.data.volume,"&#181l",{fontSize:12,decimals:2,unitsFontSize:this.unitsFontSize})}},{text:"Position",hidden:!0,flex:1,renderer:function(b,c,d){return BUI.getSamplePositionHTML(d.data,a.experiment)}},{text:"samplePlateId",dataIndex:"samplePlateId",hidden:!0},{text:"Plate",hidden:this.isPositionColumnHidden,dataIndex:"slotPositionColumn",editor:a._getSlotColumBombo(),flex:1,renderer:function(a,b,c){return null!=a&""!=a?a:void(b.tdCls="yellow-cell")}},{text:"Row",hidden:this.isPositionColumnHidden,dataIndex:"rowNumber",editor:this._getRowCombo(),flex:1,renderer:function(a,b,c){return null!=a&&""!=a?BUI.getSamplePlateLetters()[a-1]:void(b.tdCls="yellow-cell")}},{text:"Well",hidden:this.isPositionColumnHidden,dataIndex:"columnNumber",editor:this._getColumnCombo(),flex:1,renderer:function(a,b,c){return null!=a&&""!=a?a:void(b.tdCls="yellow-cell")}},{id:a.id+"buttonEditSample",text:"Edit",width:80,sortable:!1,hidden:!a.editEnabled,renderer:function(b,c,d,e,f,g){return a.editEnabled?BUI.getGreenButton("EDIT"):void 0}},{id:a.id+"buttonRemoveSample",text:"",hidden:!a.removeBtnEnabled,width:100,sortable:!1,renderer:function(b,c,d,e,f,g){return a.removeBtnEnabled?BUI.getRedButton("REMOVE"):void 0}}],viewConfig:{preserveScrollOnRefresh:!0,stripeRows:!0,getRowClass:function(b){var c=a.experiment.getSampleByPosition(b.data.samplePlateId,b.data.rowNumber,b.data.columnNumber);return c.length>1?"red-row":void 0},listeners:{selectionchange:function(b,c){a.onClick.notify(record.data)},cellclick:function(b,c,d,e,f){b.getGridColumns()[d].getId()==a.id+"buttonEditSample",b.getGridColumns()[d].getId()==a.id+"buttonRemoveSample"&&(b.getStore().removeAt(rowIndex),a.onRemoved.notify())}}}}),this.grid},SpecimenGrid.prototype.input=function(){return{experiment:DATADOC.getExperiment_10(),proposal:DATADOC.getProposal_10()}},SpecimenGrid.prototype.test=function(a){var b=new SpecimenGrid({height:400,maxHeight:400,width:1e3});BIOSAXS.proposal=new Proposal(b.input().proposal);var c=new Experiment(b.input().experiment),d=b.getPanelByExperiment(c);d.render(a)},SpecimenWidget.prototype.getContainerLayoutConfiguration=function(a){this.samplePlateGroupWidget.getDimensions(a.getSamplePlates());return{layout:"hbox",samplePlateGroupWidth:1*this.width/3-10,samplePlateGroupHeight:this.height-10,specimenGridWidth:2*this.width/3,specimenGridHeight:this.height-10}},SpecimenWidget.prototype.refresh=function(a){this.experiment=a,this.panel.removeAll();var b=this.getContainerLayoutConfiguration(a);this.specimenGrid.width=b.specimenGridWidth,this.specimenGrid.height=b.specimenGridHeight,this.samplePlateGroupWidget.width=b.samplePlateGroupWidth,this.samplePlateGroupWidget.height=b.samplePlateGroupHeight,"hbox"==b.layout&&(this.specimenGrid.margin="0 0 0 5",this.specimenGrid.width=this.specimenGrid.width-5);var c=Ext.create("Ext.container.Container",{layout:b.layout,height:this.height,width:this.width,padding:"2px",items:[]});"vbox"==b.layout?(c.insert(this.specimenGrid.getPanel()),c.insert(this.samplePlateGroupWidget.getPanel())):(c.insert(this.samplePlateGroupWidget.getPanel()),c.insert(this.specimenGrid.getPanel())),this.panel.insert(c),this.specimenGrid.refresh(a),this.samplePlateGroupWidget.refresh(a)},SpecimenWidget.prototype.getPanel=function(){return this.panel=Ext.create("Ext.container.Container",{layout:"vbox",height:this.height,border:0,margin:5,width:this.width,items:[]}),this.panel},SpecimenWidget.prototype.input=function(){return{experiment:DATADOC.getExperiment_10(),proposal:DATADOC.getProposal_10()}},SpecimenWidget.prototype.test=function(a){var b=new SpecimenWidget({height:500,width:1e3});BIOSAXS.proposal=new Proposal(b.input().proposal);var c=new Experiment(b.input().experiment),d=b.getPanel();d.render(a),b.refresh(c)},StockSolutionForm.prototype._getButtons=function(){var a=this;return[{text:"Save",handler:function(){var b=function(b,c){a.panel.setLoading(!1),a.onSaved.notify()};return null==a.getStockSolution().bufferId?void BUI.showError("Buffer field is mandatory"):""==a.getStockSolution().name?void BUI.showError("Acronym field is mandatory"):""==a.getStockSolution().concentration?void BUI.showError("Concentration field is mandatory"):""==a.getStockSolution().volume?void BUI.showError("Volume field is mandatory"):(a.panel.setLoading("ISPyB: saving stock solution"),void EXI.getDataAdapter({onSuccess:b}).saxs.stockSolution.saveStockSolution(a.getStockSolution()))}}]},StockSolutionForm.prototype.getStockSolution=function(){return null==this.stockSolution?{concentration:Ext.getCmp(this.id+"stockSolution_concentration").getValue(),storageTemperature:this.storageLocationComboBox.getValue(),volume:Ext.getCmp(this.id+"stockSolution_volume").getValue(),comments:Ext.getCmp(this.id+"stockSolution_comments").getValue(),name:Ext.getCmp(this.id+"stockSolution_name").getValue(),bufferId:this.bufferCombo.getValue(),macromoleculeId:this.macromoleculeCombo.getValue(),proposalId:Ext.getCmp("proposalIdCombo").getValue()}:(this.stockSolution.concentration=Ext.getCmp(this.id+"stockSolution_concentration").getValue(),this.stockSolution.storageTemperature=this.storageLocationComboBox.getValue(),this.stockSolution.volume=Ext.getCmp(this.id+"stockSolution_volume").getValue(),this.stockSolution.comments=Ext.getCmp(this.id+"stockSolution_comments").getValue(),this.stockSolution.name=Ext.getCmp(this.id+"stockSolution_name").getValue(),this.stockSolution.proposalId=Ext.getCmp("proposalIdCombo").getValue(),this.stockSolution.bufferId=this.bufferCombo.getValue(),null!=this.macromoleculeCombo.getValue()?this.stockSolution.macromoleculeId=this.macromoleculeCombo.getValue():this.stockSolution.macromolecule3VO=null,this.stockSolution)},StockSolutionForm.prototype.load=function(a){this.stockSolution=a,null!=a&&(null!=a.macromoleculeId&&this.macromoleculeCombo.setValue(a.macromoleculeId),this.bufferCombo.setValue(a.bufferId),Ext.getCmp(this.id+"stockSolution_concentration").setValue(this.stockSolution.concentration),this.storageLocationComboBox.setValue(this.stockSolution.storageTemperature),Ext.getCmp(this.id+"stockSolution_volume").setValue(this.stockSolution.volume),Ext.getCmp(this.id+"stockSolution_name").setValue(this.stockSolution.name),Ext.getCmp(this.id+"stockSolution_comments").setValue(this.stockSolution.comments),null!=a&&null!=a.proposalId&&(Ext.getCmp("proposalIdCombo").setValue(a.proposalId),Ext.getCmp("proposalIdCombo").disable()))},StockSolutionForm.prototype.getBufferCombo=function(){return this.bufferCombo=BIOSAXS_COMBOMANAGER.getComboBuffers(EXI.proposalManager.getBuffers(),{labelWidth:150,margin:"0 0 10 0",width:400}),this.bufferCombo},StockSolutionForm.prototype.getMacromoleculeCombo=function(){return this.macromoleculeCombo=BIOSAXS_COMBOMANAGER.getComboMacromoleculeByMacromolecules(EXI.proposalManager.getMacromolecules(),{labelWidth:150,margin:"0 0 10 0",width:400}),this.macromoleculeCombo},StockSolutionForm.prototype.refresh=function(){},StockSolutionForm.prototype._getTopPanel=function(){return this.storageLocationComboBox=BIOSAXS_COMBOMANAGER.getComboStorageTemperature({labelWidth:150,width:400}),{xtype:"container",layout:"hbox",border:0,buttons:this._getButtons(),items:[{xtype:"container",layout:"hbox",items:[{xtype:"container",flex:1,border:!1,layout:"anchor",defaultType:"textfield",items:[BIOSAXS_COMBOMANAGER.getComboProposal({labelWidth:150,width:400}),this.getMacromoleculeCombo(),this.getBufferCombo(),{xtype:"requiredtextfield",id:this.id+"stockSolution_name",fieldLabel:"Acronym",labelWidth:150,width:400},{xtype:"requiredtextfield",id:this.id+"stockSolution_concentration",fieldLabel:"Conc. (mg/ml)",labelWidth:150,width:400},this.storageLocationComboBox,{xtype:"requiredtextfield",id:this.id+"stockSolution_volume",fieldLabel:"Volume (&#181l)",labelWidth:150,width:400}]}]}]}},StockSolutionForm.prototype.getPanel=function(){return this.panel=Ext.create("Ext.panel.Panel",{padding:0,buttons:this._getButtons(),cls:"border-grid",items:[{xtype:"container",padding:20,items:[this._getTopPanel(),{id:this.id+"stockSolution_comments",xtype:"textareafield",name:"comments",fieldLabel:"Comments",labelWidth:150,width:"100%",height:100}]}]}),this.panel},StockSolutionForm.prototype.input=function(){return{stock:{stockSolutionId:6,proposalId:3124,macromoleculeId:5933,bufferId:811,instructionSet3VO:null,boxId:305861,storageTemperature:"20",volume:"300",concentration:"1.2",comments:"Buffer EDTA with A",name:"A_EDTA_1.2",samples:[],buffer:"EDTA",macromolecule:"A"},proposal:(new MeasurementGrid).input().proposal}},StockSolutionForm.prototype.test=function(a){var b=new StockSolutionForm;BIOSAXS.proposal=new Proposal(b.input().proposal);var c=b.getPanel(new Shipment(b.input().stock));c.render(a)},StockSolutionGrid.prototype._getColumns=function(){var a=this,b=[{header:"Proposal",dataIndex:"proposal",name:"proposalId",flex:1,hidden:!1},{header:"Macromolecule",dataIndex:"macromolecule",id:a.id+"macromolecule",type:"string",renderer:function(a,b,c){return null!=a?'<span style="color:blue;">'+a+"</span>":void 0},hidden:!1,flex:1},{header:"Buffer",dataIndex:"buffer",name:"buffer",hidden:!1,renderer:function(a,b,c){return'<span style="color:green;">'+a+"</span>"},type:"string",flex:1},{header:"Acronym",dataIndex:"name",name:"name",flex:1,hidden:!0},{header:"Storage Temp. (C)",dataIndex:"storageTemperature",name:"storageTemperature",flex:1,hidden:!1},{header:"Volume (&#181l)",name:"volume",dataIndex:"volume",flex:1,hidden:!1},{header:"Concentration (mg/ml)",dataIndex:"concentration",name:"concentration",flex:1},{header:"Packed",dataIndex:"comments",id:a.id+"box",type:"string",width:50,hidden:!this.isPackedVisible,renderer:function(a,b,c){return null!=c.raw.boxId?"<div style='cursor: pointer;'><img height='15px' src='../images/plane.gif'></div>":void 0}},{header:"Comments",dataIndex:"comments",type:"string",flex:1}];return this.btnEditVisible&&b.push({xtype:"actioncolumn",width:40,text:"Edit",items:[{icon:"../images/icon/edit.png",tooltip:"Edit",handler:function(b,c,d){var e=b.getStore().getAt(c);a.edit(e.get("stockSolutionId"))}}]}),this.btnRemoveVisible&&b.push({id:a.id+"buttonRemove",width:85,sortable:!1,renderer:function(b,c,d,e,f,g){return a.btnRemoveVisible?BUI.getRedButton("REMOVE"):void 0}}),this.btnUnpackVisible&&b.push({xtype:"actioncolumn",width:40,text:"Unpack",items:[{icon:"../images/icon/ic_highlight_remove_black_24dp.png",tooltip:"Unpack",handler:function(b,c,d){var e=b.getStore().getAt(c).data;a.unpack(e)}}]}),b},StockSolutionGrid.prototype._getTopButtons=function(){var a=this,b=[];return this.btnAddVisible&&b.push(Ext.create("Ext.Action",{icon:"../images/icon/add.png",text:"Add",tooltip:"Will create a new stock solution",disabled:!1,alwaysEnabled:!0,handler:function(b,c){a.edit()}})),this.btnAddExisting&&b.push(Ext.create("Ext.Action",{icon:"images/icon/add.png",text:"Add Existing",tooltip:"Allows to select upacked stock solutions",disabled:!1,alwaysEnabled:!0,handler:function(b,c){var d=new StockSolutionGrid({btnAddVisible:!1,btnEditVisible:!1,btnRemoveVisible:!1,btnAddExisting:!1,isPackedVisible:!1,multiselect:!0}),e=Ext.create("Ext.window.Window",{title:"Select",height:800,width:900,layout:"fit",items:[d.getPanel()],buttons:[{text:"Pack",handler:function(){d.selectedStockSolutions.length>0&&a.onPack.notify(d.selectedStockSolutions[0]),e.close()}},{text:"Cancel",handler:function(){e.close()}}]}).show();d.load(EXI.proposalManager.getUnpackedStockSolutions())}})),b},StockSolutionGrid.prototype.load=function(a){for(var b=[],c=0;c<a.length;c++){var d=a[c];null!=EXI.proposalManager.getBufferById(d.bufferId)&&(d.buffer=EXI.proposalManager.getBufferById(d.bufferId).acronym),d.proposal=EXI.proposalManager.getProposalById(d.proposalId).code+EXI.proposalManager.getProposalById(d.proposalId).number,null!=EXI.proposalManager.getMacromoleculeById(d.macromoleculeId)&&(d.macromolecule=EXI.proposalManager.getMacromoleculeById(d.macromoleculeId).acronym),b.push(d)}this.store.loadData(b,!1)},StockSolutionGrid.prototype.getPanel=function(){return this._renderGrid()},StockSolutionGrid.prototype.edit=function(a){var b=this,c=new StockSolutionWindow;c.onSaved.attach(function(a,c){b.onSaved.notify(c)}),c.draw(EXI.proposalManager.getStockSolutionById(a))},StockSolutionGrid.prototype.unpack=function(a){this.onUnpack.notify(a)},StockSolutionGrid.prototype._renderGrid=function(){var a=this;this.store=Ext.create("Ext.data.Store",{fields:["proposalId","name","stockSolutionId","macromolecule","buffer","storageTemperature","volume","concentration","buffer","comments"],autoload:!0});var b=({ftype:"filters",local:!0,filters:this.filters},null);b=this.multiselect?Ext.create("Ext.selection.CheckboxModel",{mode:"SINGLE",listeners:{selectionchange:function(b,c){a.selectedStockSolutions=[];for(var d=0;d<c.length;d++)a.selectedStockSolutions.push(c[d].data)}}}):{mode:"SINGLE"},this.store.sort("stockSolutionId","desc"),this.grid=Ext.create("Ext.grid.Panel",{margin:10,cls:"defaultGridPanel",title:this.title,selModel:b,store:this.store,columns:this._getColumns(),viewConfig:{stripeRows:!0,listeners:{itemdblclick:function(b,c,d,e){a.edit(c.data.stockSolutionId)},cellclick:function(b,c,d,e,f,g,h,i){var j=null;b.getGridColumns()[d].getId()==a.id+"box"&&(window.location=BUI.getShippingURL(BIOSAXS.proposal.getShipmentByDewarId(e.raw.boxId).shippingId)),b.getGridColumns()[d].getId()==a.id+"buttonRemove"&&(a.grid.setLoading("ISPyB: Removing stock solution"),j=new BiosaxsDataAdapter,j.onSuccess.attach(function(b){a.onProposalChanged.notify(),a.grid.setLoading(!1)}),j.onError.attach(function(b){a.onProposalChanged.notify(),a.grid.setLoading(!1)}),j.removeStockSolution(e.data.stockSolutionId))}}}});var c=a._getTopButtons(),d=null;return this.grid.getSelectionModel().on({selectionchange:function(a,b){if(b.length)for(d=0;d<c.length;d++)c[d].enable&&c[d].enable();else for(d=0;d<c.length;d++)0==c[d].alwaysEnabled&&c[d].disable&&c[d].disable();
}}),this.grid},TemplateGrid.prototype.getTbar=function(){var a=[];return a.push(Ext.create("Ext.Action",{icon:"images/icon/add.png",text:"Add",disabled:!1,handler:function(a,b){var c=new WizardWidget({windowMode:!0,width:1200});c.onFinished.attach(function(a,b){var d=new DataAdapter;d.onSuccess.attach(function(a,b){c.window.close(),location.hash="/experiment/experimentId/"+b.experimentId+"/main"}),c.current.setLoading(),d.saveTemplate(b.name,"comments",b.data)});var d=new ProposalUpdater;d.onSuccess.attach(function(a,b){c.draw(this.targetId,new MeasurementCreatorStepWizardForm(ProposalManager.getMacromolecules(),ProposalManager.getBuffers()))}),d.get()}})),a},TemplateGrid.prototype.deselectAll=function(){this.grid.getSelectionModel().deselectAll()},TemplateGrid.prototype.selectById=function(a){this.grid.getSelectionModel().deselectAll();for(var b=0;b<this.grid.getStore().data.items.length;b++){var c=this.grid.getStore().data.items[b].raw;c.macromoleculeId==a&&this.grid.getSelectionModel().select(b)}},TemplateGrid.prototype.load=function(a){this.store.loadData(a,!1)},TemplateGrid.prototype.getColumns=function(){var a=this,b=[{text:"Name",dataIndex:"name",id:this.id+"name",flex:1,hidden:!1},{xtype:"actioncolumn",width:40,text:"Edit",items:[{icon:"images/icon/edit.png",tooltip:"Edit",handler:function(a,b,c){location.hash="/experiment/experimentId/"+a.getStore().getAt(b).get("experimentId")+"/main"}}]},{id:a.id+"REMOVE",width:100,sortable:!1,renderer:function(a,b,c,d,e,f){return BUI.getRedButton("REMOVE")}}];return this.btnRemoveVisible&&b.push({id:a.id+"buttonRemoveMacromolecule",width:85,sortable:!1,renderer:function(b,c,d,e,f,g){return a.btnRemoveVisible?BUI.getRedButton("REMOVE"):null}}),b},TemplateGrid.prototype._prepareData=function(a){return a},TemplateGrid.prototype.getPanel=function(){return this.store=Ext.create("Ext.data.Store",{fields:["name","comments"],data:[],sorters:[{property:"experimentId",direction:"desc"}]}),this.grid=Ext.create("Ext.grid.Panel",{id:this.id,title:"My Experiments",store:this.store,height:this.height,maxHeight:this.maxHeight,columns:this.getColumns(),width:this.width,viewConfig:{stripeRows:!0,listeners:{celldblclick:function(a,b,c,d,e,f,g,h){location.hash="/experiment/experimentId/"+d.data.experimentId+"/main"},cellclick:function(a,b,c,d,e,f,g,h){}}}}),this.grid.addDocked({xtype:"toolbar",height:50,items:this.getTbar()}),this.grid},TemplateGrid.prototype.input=function(){return{proposal:DATADOC.getProposal_10()}},TemplateGrid.prototype.test=function(a){var b=new b({width:800,height:350,collapsed:!1,tbar:!0});BIOSAXS.proposal=new Proposal(b.input().proposal);var c=b.getPanel(BIOSAXS.proposal.macromolecules);c.render(a)},VolumeGrid.prototype.load=function(a){this.experiment=a,this.store.loadData(this._prepareData(a))},VolumeGrid.prototype.getPanel=function(a,b){var c=this;this.store=Ext.create("Ext.data.Store",{fields:["name","volume","macromoleculeId","bufferId"]}),this.store.sort([{property:"name",direction:"ASC"}]);var d=Ext.create("Ext.grid.Panel",{title:"Sample Requirements and existing stock solutions",cls:"border-grid",height:400,maxHeight:400,width:900,store:this.store,margin:"10 0 50 10",viewConfig:{stripeRows:!0,listeners:{cellclick:function(a,b,d,e,f,g,h,i){if(a.getGridColumns()[d].getId()==c.id+"buttonCreate"){var j=new StockSolutionWindow;j.onSaved.attach(function(a){});var k="ST";null!=e.data.macromoleculeId&&(k=k+"_"+EXI.proposalManager.getMacromoleculeById(e.data.macromoleculeId).acronym),null!=e.data.bufferId&&(k=k+"_"+EXI.proposalManager.getBufferById(e.data.bufferId).acronym),j.draw({concentration:e.data.concentration,macromoleculeId:e.data.macromoleculeId,bufferId:e.data.bufferId,name:k,volume:e.data.volume})}if(a.getGridColumns()[d].getId()==c.id+"buttonStockSolutions"){var l=new StockSolutionGrid({btnAddVisible:!1,btnEditVisible:!1,btnRemoveVisible:!1,btnAddExisting:!1,isPackedVisible:!0,multiselect:!1}),m=Ext.create("Ext.window.Window",{title:"Stock solutions by specimen",height:400,width:800,layout:"fit",items:[l.getPanel()],buttons:[{text:"Close",handler:function(){m.close()}}]}).show();l.refresh(EXI.proposalManager.getStockSolutionsBySpecimen(e.data.macromoleculeId,e.data.bufferId))}}}},columns:[{text:"Specimen",dataIndex:"name",flex:.5},{text:"Estimated Volume",dataIndex:"volume",tooltip:"Estimation of the maximum volume needed for making this experiment",flex:.5,editor:{allowBlank:!0},renderer:function(a,b,c){return BUI.formatValuesUnits(c.data.volume,"&#181l",{fontSize:16,decimals:2,unitsFontSize:this.unitsFontSize})}},{text:"Stock Solution",flex:.5,tooltip:"Stock Solutions containing this specimen in this proposal",renderer:function(a,b,c,d,e,f){var g=c.data.macromoleculeId,h=c.data.bufferId,i=EXI.proposalManager.getStockSolutionsBySpecimen(g,h);return i.length>0?"<div><span style='font-size:18px'>"+i.length+"</span> x<img height='15px' src='images/icon/testtube.png'></div>":void 0}},{id:c.id+"buttonCreate",text:"",hidden:!0,tooltip:"Create a new stock solution for shipping",width:170,sortable:!1,renderer:function(a,b,c,d,e,f){return BUI.getGreenButton("CREATE STOCK SOLUTION",{width:160})}}]});return d},VolumeGrid.prototype._prepareData=function(a){for(var b={},c=0;c<a.getSamples().length;c++){var d=a.getSamples()[c],e="";null==d.macromoleculeId&&(e=a.getBufferById(d.bufferId).acronym,null==b[e]&&(b[e]={macromoleculeId:d.macromoleculeId,name:e,bufferId:d.bufferId,volume:0}),b[e].volume=Number(d.volume)+Number(b[e].volume)),null==d.macromolecule3VO&&null==d.macromoleculeId||(macromoleculeId=d.macromoleculeId,null==d.macromoleculeId&&(d.macromoleculeId=d.macromolecule3VO.macromoleculeId),e=EXI.proposalManager.getMacromoleculeById(d.macromoleculeId).acronym+" + "+a.getBufferById(d.bufferId).acronym,null==b[e]&&(b[e]={macromoleculeId:d.macromoleculeId,name:e,bufferId:d.bufferId,volume:0}),b[e].volume=Number(d.volume)+Number(b[e].volume))}var f=[];for(var g in b)f.push(b[g]);return f},VolumeGrid.prototype.refresh=function(a){this.experiment=a,this.macromoleculeGrid.getStore().loadData(this._prepareData(this.experiment),!1)},VolumeGrid.prototype.render=function(){return this.macromoleculeGrid=this.getPanel([],"Estimation of required Volume"),{xtype:"container",layout:"vbox",margin:"0, 0, 0, 5",items:[{xtype:"container",layout:"hbox",margin:"0, 0, 0, 0",items:[this.macromoleculeGrid]}]}},VolumeGrid.prototype.input=function(a){return{experiment:DATADOC.getExperiment_10()}},VolumeGrid.prototype.test=function(a){var b=new VolumeGrid;BIOSAXS.proposal=new Proposal((new MeasurementGrid).input().proposal);var c=b.getPanel(new Experiment((new VolumeGrid).input().experiment));Ext.create("Ext.panel.Panel",{height:500,width:1e3,renderTo:a,items:[c]})},WizardWidget.prototype.draw=function(a,b){this.targetId=a,this.forms.push(b),this.renderMasterContainer()},WizardWidget.prototype.getButtons=function(a,b,c){var d=this;return null!=d.forms[d.step].onWizardFinished?[{text:"Back",handler:function(){d.step=d.step-1,d.renderMasterContainer(),c(),d.forms[d.step].reload()}},"->",{text:"Finish",handler:function(){d.forms[d.step].onWizardFinished.attach(function(a,b){d.onFinished.notify(b)}),b()}}]:0==a?["->",{text:"Next",handler:function(){d.forms.push(d.forms[d.step].getNextForm()),d.step=d.step+1,d.renderMasterContainer(),b(d.forms[d.step-1].data)}}]:this.step>0&&null==this.forms[d.step].onWizardFinished?[{text:"Back",handler:function(){d.step=d.step-1,d.renderMasterContainer(),c(),d.forms[d.step].reload()}},"->",{text:"Next",handler:function(){null==d.forms[d.step].onWizardFinished?(d.forms.push(d.forms[d.step].getNextForm()),d.step=d.step+1,b(d.forms[d.step-1].data),d.renderMasterContainer()):(d.forms[d.step].onWizardFinished.attach(function(a,b){d.window.close(),d.onFinished.notify(b)}),d.step=d.step+1,b(d.forms[d.step-1].data))}}]:void 0},WizardWidget.prototype.getPanel=function(a){return this.forms.push(a),Ext.create("Ext.form.Panel",{width:this.width,height:800,items:[this.forms[this.step].getForm()],buttons:this.getButtons(this.step,this.forms[this.step].onNext,this.forms[this.step].onBack)})},WizardWidget.prototype.renderMasterContainer=function(){null!=this.current&&this.current.destroy(),null!=this.window&&this.window.destroy(),this.current=this.getPanel(),0==this.windowMode?this.current.render(this.targetId):(this.window=Ext.create("Ext.Window",{id:this.id,resizable:!0,constrain:!0,modal:!0,frame:!1,draggable:!0,autoscroll:!0,layout:{type:"vbox",align:"stretch"},items:this.current,width:this.width,title:"BIOSAXS Experiment Designer",listeners:{scope:this,minimize:function(){this.panel.hide()},destroy:function(){delete this.panel}}}),this.window.show())},TestController.prototype.loadNavigationPanel=ExiController.prototype.loadNavigationPanel,TestController.prototype.setPageBackground=function(){},TestController.prototype.notFound=function(){},TestController.prototype.init=function(){var a,b=this;Path.map("#/test/test1").to(function(){EXI.clearNavigationPanel(),EXI.hideNavigationPanel();var a=new TestListView;EXI.addNavigationPanel(a),EXI.setLoadingNavigationPanel("Loading my data"),a.load([{name:"Lisa",email:"lisa@simpsons.com",phone:"555-111-1224"},{name:"Bart",email:"bart@simpsons.com",phone:"555-222-1234"},{name:"Homer",email:"homer@simpsons.com",phone:"555-222-1244"},{name:"Marge",email:"marge@simpsons.com",phone:"555-222-1254"}]),EXI.setLoadingNavigationPanel(!1)}).enter(this.setPageBackground),Path.map("#/test/test2").to(function(){EXI.clearNavigationPanel(),EXI.clearMainPanel(),EXI.setLoadingNavigationPanel(!0),a=new TestListView,a.onSelect.attach(function(a,b){location.hash="/test/test3/"+b[0].BLSample_crystalId+"/main"}),EXI.addNavigationPanel(a),adapter=b.loadNavigationPanel(a),adapter.mx.sample.getSampleInfoByProposalId()}).enter(this.setPageBackground),Path.map("#/test/test3/:crystalId/main").to(function(){var a=new TestMainView(this.params.crystalId);EXI.addMainPanel(a),console.log(this.params.crystalId),a.load(this.params.crystalId)}).enter(this.setPageBackground),Path.map("#/test/test4").to(function(){EXI.clearNavigationPanel();var a=new PuckWidgetView;EXI.addMainPanel(a);var b=function(b,c){a.load(c)};EXI.getDataAdapter({onSuccess:b}).proposal.shipping.getContainerById(333486,333486,333486)}).enter(this.setPageBackground),Path.rescue(this.notFound)},SampleForm.prototype.load=function(a){this.sample=a,null!=a&&Ext.getCmp("sampleName"+this.id).setValue(a.sampleName)},SampleForm.prototype.getSamplePanel=function(){return this.samplePanel=Ext.create("Ext.panel.Panel",{layout:"vbox",margin:"10",items:[{padding:10,xtype:"container",layout:"hbox",border:!1,items:[{xtype:"displayfield",id:"sampleName"+this.id,fieldLabel:"Sample Name",name:"sampleName"}]}]}),this.samplePanel},SampleForm.prototype.getPanel=function(){return this.panel=Ext.create("Ext.panel.Panel",{layout:"vbox",title:"Sample Card",cls:"border-grid",items:[this.getSamplePanel()]}),this.panel},TestContainer.prototype.getPanel=function(){return this.container},TestContainer.prototype.add=function(a){this.container.add(a)},TestListView.prototype.getPanel=ListView.prototype.getPanel,TestListView.prototype.load=ListView.prototype.load,TestListView.prototype.getFields=ListView.prototype.getFields,TestListView.prototype.getColumns=ListView.prototype.getColumns,TestListView.prototype.getRow=function(a){var b="";return dust.render("test.template",a.data,function(a,c){b=c}),b},TestListView.prototype.getFilter=function(a){return[{property:"sampleName",value:a,anyMatch:!0}]},TestMainPanel.prototype.getPanel=ListView.prototype.getPanel,TestMainPanel.prototype.load=ListView.prototype.load,TestMainPanel.prototype.getFields=ListView.prototype.getFields,TestMainPanel.prototype.getColumns=ListView.prototype.getColumns,TestMainPanel.prototype.getRow=function(a){var b="";return dust.render("test.template.main",a.data,function(a,c){b=c}),b},TestMainPanel.prototype.getFilter=function(a){return[{property:"sampleName",value:a,anyMatch:!0}]},TestMainWidgetPanel.prototype.getPanel=ListView.prototype.getPanel,TestMainWidgetPanel.prototype.load=ListView.prototype.load,TestMainWidgetPanel.prototype.getFields=ListView.prototype.getFields,TestMainWidgetPanel.prototype.getColumns=ListView.prototype.getColumns,TestMainWidgetPanel.prototype.getRow=function(a){var b="1";return b},TestMainWidgetPanel.prototype.getFilter=function(a){return[{property:"sampleName",value:a,anyMatch:!0}]},PuckWidgetView.prototype.getPanel=function(){var a=this;return this.store=Ext.create("Ext.data.Store",{storeId:"samplePanelId",fields:["acronym","state","code","type","name","location","holder","looptype"],data:[]}),this.grid=Ext.create("Ext.grid.Panel",{margin:20,title:"Samples",store:Ext.data.StoreManager.lookup("samplePanelId"),columns:[{text:"Crystal protein acronym",dataIndex:"acronym"},{text:"State",dataIndex:"state"},{text:"Code",dataIndex:"code"},{text:"Container type",dataIndex:"type"},{text:"Name",dataIndex:"name"},{text:"Location",dataIndex:"location"},{text:"Holder",dataIndex:"holder"},{text:"Looptype",dataIndex:"looptype"}],height:200,width:700,listeners:{itemmouseenter:function(b,c,d){a.widget.focus(c.data.location,!0)},itemmouseleave:function(b,c,d){a.widget.focus(c.data.location,!1)}}}),this.panel=Ext.create("Ext.panel.Panel",{layout:"hbox",items:[this.grid,this.widget.getPanel()]}),this.panel},PuckWidgetView.prototype.load=function(a){var b=this;b.panel.setTitle("Test Widget");var c=[],d=["Filled","Collected","Results","Collected"];for(sample in a.sampleVOs)c.push({acronym:a.sampleVOs[sample].crystalVO.proteinVO.acronym,code:a.code,type:a.containerType,name:a.sampleVOs[sample].crystalVO.proteinVO.name,location:a.sampleVOs[sample].location,holder:a.sampleVOs[sample].holderLength,looptype:a.sampleVOs[sample].loopType,state:d[sample]});this.store.loadData(c),this.widget.load(c)},TestMainView.prototype.getPanel=MainView.prototype.getPanel,TestMainView.prototype.getContainer=function(){return Ext.create("Ext.container.Container",{layout:{type:"hbox"},margin:15,border:1,defaults:{labelWidth:80,flex:1},items:[this.testMainPanel.getPanel([])]})},TestMainView.prototype.load=function(a){this.panel.setTitle("Sample");var b=this,c=function(a,c){b.testMainPanel.load(c)};EXI.getDataAdapter({onSuccess:c}).mx.sample.getSamplesByCrystalId(b.crystalId)},function(a){function b(a,b){return a.w("<table class='listView'><tr><td>cardName:</td><td style='color:#207a7a;font-weight:bold;'>").f(b.getPath(!0,["cardName"]),b,"h").w("</td></tr><tr><td>Familiy Name:</td><td>").f(b.getPath(!0,["personVO","familyName"]),b,"h").w("</td></tr><tr><td>Name:</td><td>").f(b.getPath(!0,["personVO","givenName"]),b,"h").w("</td></tr><tr><td>Email:</td><td>").f(b.getPath(!0,["personVO","emailAddress"]),b,"h").w("</td></tr></table>")}return a.register("address.listview",b),b.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w('<div class="container"><table class="table" id="bootstrap-table-').f(b.get(["id"],!1),b,"h").w('"><tbody>').s(b.get(["values"],!1),b,{block:c},{}).w("</tbody></table></div>")}function c(a,b){return a.w('<tr class="clickable-row" id="row-').f(b.get(["$idx"],!1),b,"h").w("-").f(b.get(["id"],!1),b,"h").w('"><td>').f(b.getPath(!0,[]),b,"h").w("</td></tr>")}return a.register("bootstrap.grid.template",b),b.__dustBody=!0,c.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w('<div class="container" padding="20px"><div class="row"><div class="col-xs-6 col-md-6"><button type="button" class="btn btn-default btn-sm"><span class="glyphicon glyphicon-remove"></span> Remove</button></div><div class="col-xs-6 col-md-6"><button type="button" class="btn btn-default btn-sm"><span class="glyphicon glyphicon-edit"></span> Edit</button></div></div></div>')}return a.register("buttons.puck.parcel.shipping.template",b),b.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w("<table><tr><td class='summary_datacollection_parameter_name'>Code</td><td class='summary_datacollection_parameter'>").f(b.getPath(!0,["code"]),b,"h").w("</td></tr>	<tr><td class='summary_datacollection_parameter_name'>Status</td><td class='summary_datacollection_parameter'>").f(b.getPath(!0,["dewarStatus"]),b,"h").w("</td></tr>	<tr><td class='summary_datacollection_parameter_name'>Pucks</td><td class='summary_datacollection_parameter'>").f(b.getPath(!0,["containerVOs","length"]),b,"h").w("</td></tr>	<tr><td class='summary_datacollection_parameter_name'>BarCode</td><td class='summary_datacollection_parameter'>").f(b.getPath(!0,["barCode"]),b,"h").w("</td></tr>	</table>")}return a.register("dewarlistview",b),b.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w("<div id=").f(b.getPath(!0,["id"]),b,"h").w('><svg pointer-events="none" height="').h("math",b,{},{key:c,method:"multiply",operand:"2"},"h").w('" width="').h("math",b,{},{key:d,method:"multiply",operand:"2"},"h").w('"><circle cx="').f(b.get(["radius"],!1),b,"h").w('" cy="').f(b.get(["radius"],!1),b,"h").w('" r="').f(b.get(["radius"],!1),b,"h").w('" stroke="black" stroke-width="1" fill="#FFFFFF" pointer-events="none"/>').s(b.get(["lines"],!1),b,{block:e},{}).w("</svg></div>")}function c(a,b){return a.f(b.get(["radius"],!1),b,"h")}function d(a,b){return a.f(b.get(["radius"],!1),b,"h")}function e(a,b){return a.w('<line x1="').f(b.getPath(!0,["x1"]),b,"h").w('" y1="').f(b.getPath(!0,["y1"]),b,"h").w('" x2="').f(b.getPath(!0,["x2"]),b,"h").w('" y2="').f(b.getPath(!0,["y2"]),b,"h").w('" style="stroke:rgb(0,0,0);stroke-width:1" pointer-events="none"/>')}return a.register("flexhcd.template",b),b.__dustBody=!0,c.__dustBody=!0,d.__dustBody=!0,e.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w("<table class='table-sm table-condensed '><tbody>").s(b.get(["info"],!1),b,{block:c},{}).w("</tbody> </table>")}function c(a,b){return a.w("<tr><td  style='padding:0 15px 0 15px;'><b>").f(b.getPath(!0,["text"]),b,"h").w("</b></td><td  style='padding:0 15px 0 15px;'>").f(b.getPath(!0,["value"]),b,"h").w("</td></tr>")}return a.register("info.grid.template",b),b.__dustBody=!0,c.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w('<div class="container"><div class="row"><div class="col-sm-3"><div class="row"><div class="col-sm-6"><b>Code:</b></div><div class="col-sm-6">').f(b.getPath(!0,["code"]),b,"h").w('</div></div></div><div class="col-sm-3"><div class="row"><div class="col-sm-6"><b>Status:</b></div><div class="col-sm-6">').f(b.getPath(!0,["dewarStatus"]),b,"h").w('</div></div></div><div class="col-sm-3"><div class="row"><div class="col-sm-6"><b>Store Location:</b></div><div class="col-sm-6">').f(b.getPath(!0,["storageLocation"]),b,"h").w('</div></div></div><div class="col-sm-3"><div class="row"><div class="col-sm-6"><b>Comments:</b></div><div class="col-sm-6">').f(b.getPath(!0,["comments"]),b,"h").w("</div></div></div></div></div>")}return a.register("parcel.header.shipping.template",b),b.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w('<div id="').f(b.getPath(!0,["id"]),b,"h").w('-div"><svg id="').f(b.getPath(!0,["id"]),b,"h").w('-svg"  height="').h("math",b,{},{key:c,method:"multiply",operand:"2.2"},"h").w('" width="').h("math",b,{},{key:d,method:"multiply",operand:"2.2"},"h").w('"><defs><radialGradient id="errorGradient" cx="50%" cy="50%" r="50%" fx="50%" fy="50%"><stop offset="0%" style="stop-color:rgb(255,255,0); stop-opacity:1" /><stop offset="100%" style="stop-color:rgb(255,0,0); stop-opacity:1" /></radialGradient><radialGradient id="errorGradientSelected" cx="50%" cy="50%" r="50%" fx="50%" fy="50%"><stop offset="0%" style="stop-color:#66ff66; stop-opacity:1" /><stop offset="100%" style="stop-color:rgb(255,0,0); stop-opacity:1" /></radialGradient><clipPath id="unipuckShape"><circle cx="').f(b.get(["mainRadius"],!1),b,"h").w('" cy="').h("math",b,{},{key:e,method:"add",operand:f},"h").w('" r="').f(b.get(["shapeRadiusX"],!1),b,"h").w('" /><circle cx="').h("math",b,{},{key:g,method:"subtract",operand:h},"h").w('" cy="').h("math",b,{},{key:i,method:"subtract",operand:j},"h").w('" r="').f(b.get(["shapeRadiusY"],!1),b,"h").w('" stroke="black" stroke-width="1" /><circle cx="').h("math",b,{},{key:k,method:"add",operand:l},"h").w('" cy="').h("math",b,{},{key:m,method:"subtract",operand:n},"h").w('" r="').f(b.get(["shapeRadiusY"],!1),b,"h").w('" stroke="black" stroke-width="1" /></clipPath></defs><circle  id="').f(b.getPath(!0,["id"]),b,"h").w('" cx="').f(b.get(["mainRadius"],!1),b,"h").w('" cy="').f(b.get(["mainRadius"],!1),b,"h").w('" r="').f(b.get(["mainRadius"],!1),b,"h").w('" fill="#CCCCCC" class=\'puck\' />').x(b.get(["isUnipuck"],!1),b,{block:o},{}).w('<?isLoading}<text id="').f(b.getPath(!0,["id"]),b,"h").w('-loading-text" x="').f(b.get(["mainRadius"],!1),b,"h").w('" y="').f(b.get(["mainRadius"],!1),b,"h").w('" fill="white" font-size="').h("math",b,{},{key:q,method:"multiply",operand:"1.5"},"h").w('" text-anchor="middle" pointer-events="none"><tspan dx="0" dy="0">LOADING...</tspan></text></isLoading>').s(b.get(["cells"],!1),b,{block:r},{}).w("</svg></div>")}function c(a,b){return a.f(b.get(["mainRadius"],!1),b,"h")}function d(a,b){return a.f(b.get(["mainRadius"],!1),b,"h")}function e(a,b){return a.f(b.get(["mainRadius"],!1),b,"h")}function f(a,b){return a.f(b.get(["shapeRadiusY"],!1),b,"h")}function g(a,b){return a.f(b.get(["mainRadius"],!1),b,"h")}function h(a,b){return a.f(b.get(["shapeRadiusX"],!1),b,"h")}function i(a,b){return a.f(b.get(["mainRadius"],!1),b,"h")}function j(a,b){return a.f(b.get(["shapeRadiusY"],!1),b,"h")}function k(a,b){return a.f(b.get(["mainRadius"],!1),b,"h")}function l(a,b){return a.f(b.get(["shapeRadiusX"],!1),b,"h")}function m(a,b){return a.f(b.get(["mainRadius"],!1),b,"h")}function n(a,b){return a.f(b.get(["shapeRadiusY"],!1),b,"h")}function o(a,b){return a.w('<g><rect width="100%" height="100%" fill="#888888" stroke="black" stroke-width="1" clip-path="url(#unipuckShape)" pointer-events="none"/><circle cx="').f(b.get(["mainRadius"],!1),b,"h").w('" cy="').h("math",b,{},{key:p,method:"multiply",operand:"1.5"},"h").w('" r="').f(b.get(["shapeRadiusX"],!1),b,"h").w('" fill="#888888" pointer-events="none" /></g>')}function p(a,b){return a.f(b.get(["mainRadius"],!1),b,"h")}function q(a,b){return a.f(b.get(["shapeRadiusX"],!1),b,"h")}function r(a,b){return a.x(b.get(["enableClick"],!1),b,{block:s},{}).w('<circle id="').f(b.getPath(!0,["id"]),b,"h").w('" cx="').f(b.getPath(!0,["x"]),b,"h").w('" cy="').f(b.getPath(!0,["y"]),b,"h").w('" r="').f(b.getPath(!0,["radius"]),b,"h").w('" ').x(b.get(["enableClick"],!1),b,{block:u},{}).w(" ").nx(b.get(["enableMouseOver"],!1),b,{block:w},{}).w(' class="cell_empty"></circle><circle id="').f(b.getPath(!0,["id"]),b,"h").w('-inner" visibility="hidden" fill="none" stroke="yellow" stroke-width="2" cx="').f(b.getPath(!0,["x"]),b,"h").w('" cy="').f(b.getPath(!0,["y"]),b,"h").w('" r="').h("math",b,{},{key:x,method:"multiply",operand:"0.7"},"h").w('" pointer-events="none"></circle>').x(b.get(["enableClick"],!1),b,{block:y},{}).w("						").h("gt",b,{block:A},{key:b.get(["radius"],!1),value:10},"h")}function s(a,b){return a.x(b.getPath(!0,["dataCollectionIds"]),b,{block:t},{})}function t(a,b){return a.w('<a id="').f(b.getPath(!0,["id"]),b,"h").w('-anchor" onclick="window.open(\'#/mx/datacollection/datacollectionid/').f(b.getPath(!0,["dataCollectionIds"]),b,"h").w("/main','_blank');window.close();return false\" href='#/mx/datacollection/datacollectionid/").f(b.getPath(!0,["dataCollectionIds"]),b,"h").w('/main\' target="_blank" style="target-new: tab;">')}function u(a,b){return a.x(b.getPath(!0,["dataCollectionIds"]),b,{block:v},{})}function v(a,b){return a.w('style="cursor:pointer"')}function w(a,b){return a.w(' pointer-events="none" ')}function x(a,b){return a.f(b.getPath(!0,["radius"]),b,"h")}function y(a,b){return a.x(b.getPath(!0,["dataCollectionIds"]),b,{block:z},{})}function z(a,b){return a.w("</a>")}function A(a,b){return a.w('<text id="').f(b.getPath(!0,["id"]),b,"h").w('-label" x="').f(b.getPath(!0,["x"]),b,"h").w('" y="').f(b.getPath(!0,["y"]),b,"h").w('" fill="black" font-size="').h("math",b,{},{key:B,method:"multiply",operand:"1.1"},"h").w('" text-anchor="middle" pointer-events="none"><tspan dx="0" dy="').h("math",b,{},{key:C,method:"multiply",operand:"0.4"},"h").w('" pointer-events="none">').h("math",b,{},{key:D,method:"add",operand:"1"},"h").w('</tspan><tspan x="').f(b.getPath(!0,["x"]),b,"h").w('" dy="12"></tspan></text>')}function B(a,b){return a.f(b.get(["shapeRadiusX"],!1),b,"h")}function C(a,b){return a.f(b.get(["shapeRadiusX"],!1),b,"h")}function D(a,b){return a.f(b.get(["$idx"],!1),b,"h")}return a.register("puck.template",b),b.__dustBody=!0,c.__dustBody=!0,d.__dustBody=!0,e.__dustBody=!0,f.__dustBody=!0,g.__dustBody=!0,h.__dustBody=!0,i.__dustBody=!0,j.__dustBody=!0,k.__dustBody=!0,l.__dustBody=!0,m.__dustBody=!0,n.__dustBody=!0,o.__dustBody=!0,p.__dustBody=!0,q.__dustBody=!0,r.__dustBody=!0,s.__dustBody=!0,t.__dustBody=!0,u.__dustBody=!0,v.__dustBody=!0,w.__dustBody=!0,x.__dustBody=!0,y.__dustBody=!0,z.__dustBody=!0,A.__dustBody=!0,B.__dustBody=!0,C.__dustBody=!0,D.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w('<div class="panel panel-default"><div class="panel-heading"><h3 class="panel-title">  ').f(b.getPath(!0,["month"]),b,"h").w(" ").f(b.getPath(!0,["day"]),b,"h").w(" ").f(b.getPath(!0,["year"]),b,"h").w("</h3></div><div class=\"panel-body\"><p style='font-size:18px;'>").f(b.getPath(!0,["beamLineName"]),b,"h").w("</p><p>").f(b.getPath(!0,["nbShifts"]),b,"h").w(" shifts</p><div style='font-weight:italic;font-size:10px;width: 100%;  word-break: break-all;  white-space: normal;'>").f(b.getPath(!0,["comments"]),b,"h").w('</div><!-- List group --><ul class="list-group">').h("gt",b,{block:c},{key:b.get(["sampleCount"],!1),value:0},"h").h("gt",b,{block:d},{key:b.get(["testDataCollectionGroupCount"],!1),value:0},"h").h("gt",b,{block:e},{key:b.get(["dataCollectionGroupCount"],!1),value:0},"h").h("gt",b,{block:f},{key:b.get(["xrfSpectrumCount"],!1),value:0},"h").h("gt",b,{block:g},{key:b.get(["energyScanCount"],!1),value:0},"h").w("</ul><p style='font-size:10px;'>Local contact: ").f(b.getPath(!0,["beamLineOperator"]),b,"h").w("</p></div></div>")}function c(a,b){return a.w('<li class="list-group-item"><span style=\'background-color:#337ab7;\' class="badge badge-primary">').f(b.getPath(!0,["sampleCount"]),b,"h").w("</span>Samples</li>")}function d(a,b){return a.w('<li class="list-group-item"><span style=\'background-color:#337ab7;\' class="badge">').f(b.getPath(!0,["testDataCollectionGroupCount"]),b,"h").w("</span>Tests</li>")}function e(a,b){return a.w('<li class="list-group-item"><span style=\'background-color:#337ab7;\' class="badge">').f(b.getPath(!0,["dataCollectionGroupCount"]),b,"h").w("</span>Data Collections</li>")}function f(a,b){return a.w('<li class="list-group-item"><span style=\'background-color:#337ab7;\' class="badge">').f(b.getPath(!0,["xrfSpectrumCount"]),b,"h").w("</span>Spectra</li>")}function g(a,b){return a.w('<li class="list-group-item"><span style=\'background-color:#337ab7;\' class="badge">').f(b.getPath(!0,["energyScanCount"]),b,"h").w("</span>Energy Scans</li>")}return a.register("session.listview",b),b.__dustBody=!0,c.__dustBody=!0,d.__dustBody=!0,e.__dustBody=!0,f.__dustBody=!0,g.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w('<div class="panel panel-default"><div class="panel-heading"><h3 class="panel-title">').f(b.getPath(!0,["proposal"]),b,"h").w('</h3></div><div class="panel-body">').f(b.getPath(!0,["title"]),b,"h").w("<br />").f(b.getPath(!0,["sessionCount"]),b,"h").w(" sessions</div></div>")}return a.register("welcomemainviewproposalheader",b),b.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w("<table> <tr><td>Name:</td><td style='color:#207a7a;font-weight:bold;'>").f(b.getPath(!0,["Shipping_shippingName"]),b,"h").w("</td></tr><tr><td>Type:</td><td>").f(b.getPath(!0,["Shipping_shippingType"]),b,"h").w("</td></tr><tr><td>Status:</td><td>").f(b.getPath(!0,["Shipping_shippingStatus"]),b,"h").w("</td></tr></table>")}return a.register("shipping.listview",b),b.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w("<div id=").f(b.getPath(!0,["id"]),b,"h").w('><svg pointer-events="none" height="').h("math",b,{},{key:c,method:"multiply",operand:"2"},"h").w('" width="').h("math",b,{},{key:d,method:"multiply",operand:"2"},"h").w('"><circle cx="').f(b.get(["radius"],!1),b,"h").w('" cy="').f(b.get(["radius"],!1),b,"h").w('" r="').f(b.get(["radius"],!1),b,"h").w('" stroke="black" stroke-width="1" fill="#FFFFFF" pointer-events="none"/>').s(b.get(["lines"],!1),b,{block:e},{}).s(b.get(["text"],!1),b,{block:f},{}).w("</svg></div>")}function c(a,b){return a.f(b.get(["radius"],!1),b,"h")}function d(a,b){return a.f(b.get(["radius"],!1),b,"h")}function e(a,b){return a.w('<line x1="').f(b.getPath(!0,["x1"]),b,"h").w('" y1="').f(b.getPath(!0,["y1"]),b,"h").w('" x2="').f(b.getPath(!0,["x2"]),b,"h").w('" y2="').f(b.getPath(!0,["y2"]),b,"h").w('" style="stroke:rgb(0,0,0);stroke-width:1" pointer-events="none"/>')}function f(a,b){return a.w('<text x="').f(b.getPath(!0,["x"]),b,"h").w('" y="').f(b.getPath(!0,["y"]),b,"h").w('" ').x(b.get(["textSize"],!1),b,{block:g},{}).w(' text-anchor="middle" stroke="black" stroke-width="1" pointer-events="none"><tspan dx="0" dy="0">').f(b.getPath(!0,["text"]),b,"h").w("</tspan></text>")}function g(a,b){return a.w('font-size="').f(b.getPath(!0,["textSize"]),b,"h").w('"')}return a.register("structure.sampleChanger.template",b),b.__dustBody=!0,c.__dustBody=!0,d.__dustBody=!0,e.__dustBody=!0,f.__dustBody=!0,g.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w("<table class='listView'><tr><td>sampleName: </td><td style='color:#207a7a;font-weight:bold;'>").f(b.getPath(!0,["BLSample_name"]),b,"h").w("</td></tr><tr><td>Protein Acronym: </td><td>").f(b.getPath(!0,["Protein_acronym"]),b,"h").w("</td></tr><tr><td>Code: </td><td>").f(b.getPath(!0,["Container_code"]),b,"h").w("</td></tr><tr><td>sample Location: </td><td>").f(b.getPath(!0,["BLSample_location"]),b,"h").w("</td></tr><tr><td>Crystal ID: </td><td>").f(b.getPath(!0,["BLSample_crystalId"]),b,"h").w("</td></tr></table>")}return a.register("test.template",b),b.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w("<table class='listView'><tr><td>Name: </td><td style='color:#207a7a;font-weight:bold;'>").f(b.getPath(!0,["name"]),b,"h").w("</td></tr><tr><td>Comments: </td><td>").f(b.getPath(!0,["comments"]),b,"h").w("</td></tr></table>")}return a.register("test.template.main",b),b.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w("<table class='listView'><tr><td>Number: </td><td>").f(b.get(["number"],!1),b,"h").w("</td></tr></table>")}return a.register("test.template.number",b),b.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w("<table> <tr><td>Program:</td><td style='color:#207a7a;font-weight:bold;'>").f(b.getPath(!0,["v_datacollection_processingPrograms"]),b,"h").w("</td></tr><tr><td>Space group:</td><td>").f(b.getPath(!0,["v_datacollection_summary_phasing_autoproc_space_group"]),b,"h").w("</td></tr>	</table>")}return a.register("autoprocintegration.listview",b),b.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w('<div class="container-fluid"><div class="panel with-nav-tabs panel-default"><div class="panel-heading clearfix"><div class="pull-left">                                <h1 class="panel-title" style=\'color:#337ab7;\'><kbd> ').f(b.getPath(!0,["v_datacollection_processingPrograms"]),b,"h").w("</kbd><kbd style='background-color:#337ab7;'>").f(b.getPath(!0,["v_datacollection_summary_phasing_autoproc_space_group"]),b,"h").w(" </kbd>").h("eq",b,{block:c},{key:b.get(["v_datacollection_summary_phasing_anomalous"],!1),value:"true",type:"boolean"},"h").w('</h1></div><div class="pull-right"><ul class="nav nav-tabs"><li class="active"><a data-toggle="tab" href="#autoproc_').f(b.get(["AutoProcIntegration_autoProcIntegrationId"],!1),b,"h").w('">Statistics</a></li><li ><a data-toggle="tab" href="#tab_files_').f(b.getPath(!0,["v_datacollection_summary_phasing_autoProcProgramId"]),b,"h").w('">Files</a></li><li ><a data-toggle="tab" href="#plots').f(b.getPath(!0,["v_datacollection_summary_phasing_autoProcProgramId"]),b,"h").w('">Plots</a></li></ul></div></div><br /><div class="tab-content"><div id="autoproc_').f(b.get(["AutoProcIntegration_autoProcIntegrationId"],!1),b,"h").w('" class="tab-pane fade in active"><div class="container-fluid"><div class="row"><div class="col-xs-6 col-md-2">                   ').p("unitcell.autoprocintegrationgrid.template",b,b,{}).w('                             </div><div class="col-xs-6 col-md-7">').p("statistics.autoprocintegrationgrid.template",b,b,{}).w('                         </div><div class="col-xs-6 col-md-1">').p("phasing.autoprocintegrationgrid.template",b,b,{}).w('                         </div></div></div></div><div id="tab_files_').f(b.getPath(!0,["v_datacollection_summary_phasing_autoProcProgramId"]),b,"h").w('" class="tab-pane fade"><div class="container-fluid"><div id="fl_').f(b.getPath(!0,["v_datacollection_summary_phasing_autoProcProgramId"]),b,"h").w('" class="row"></div></div></div><div id="plots').f(b.getPath(!0,["v_datacollection_summary_phasing_autoProcProgramId"]),b,"h").w('" class="tab-pane fade">').p("plots.autoprocintegrationgrid.template",b,b,{}).w("  </div>                  </div></div></div>");
}function c(a,b){return a.w("                                          <kbd style='background-color:orange;'>ANOMALOUS</kbd> ")}return a.register("autoprocintegrationgrid.template",b),b.__dustBody=!0,c.__dustBody=!0,b}(dust),function(a){function b(a,b){return a}return a.register("autoprocintegrationgrid_tool",b),b.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w('<div class="container-fluid containerWithScroll"><div class="row"><div class="col-xs-12 col-md-2"><table style=\'width: 100px;font-size:10px\' class=\'table\'><tbody><tr><th class=\'innershell\' >InnerShell</th><th class=\'overallshell\' >Overall</th><th class=\'outershell\' >OuterShell</th></tr></tbody></table><table class="table table-striped table-hover"><thead><tr><th  ><a href="#"  data-toggle="tooltip" title="Rank is done based on the space group and lower rMerge">Rank</a></th><th  >Pipeline</th><th  >SpaceGroup</th><th  >Anom</th><th  >A</th><th > B</th><th > C</th><th  >&#x3B1;</th><th >&beta;</th><th >&gamma;</th><th >Resolution</th><th >Multiplicity</th><th >Completeness</th><th >I/Sigma</th><th >Rmeas</th> <th >Rmerge</th><th >Rpim</th><th >cc(1/2)</th><th >Download</th></tr></thead>').s(b.getPath(!0,[]),b,{block:c},{}).w("</table></div></div></div>")}function c(a,b){return a.h("lt",b,{"else":d,block:e},{key:b.getPath(!1,["innerShell","rMerge"]),value:10},"h").w("<td  >#").f(b.getPath(!0,["rank"]),b,"h").w('</td><td  ><a target="_blank" href=\'#/autoprocintegration/datacollection/').f(b.getPath(!0,["AutoProcIntegration_dataCollectionId"]),b,"h").w("/main'>").f(b.getPath(!0,["v_datacollection_processingPrograms"]),b,"h").w("</a></td><td  >").f(b.getPath(!0,["v_datacollection_summary_phasing_autoproc_space_group"]),b,"h").w("</td><td  >").h("eq",b,{"else":f,block:g},{key:b.get(["v_datacollection_summary_phasing_anomalous"],!1),type:"boolean",value:"true"},"h").w("</td><td  >").h("decimal",b,{block:h},{key:"v_datacollection_summary_phasing_cell_a",decimals:1},"h").w("</td><td >").h("decimal",b,{block:i},{key:"v_datacollection_summary_phasing_cell_b",decimals:1},"h").w("</td><td >").h("decimal",b,{block:j},{key:"v_datacollection_summary_phasing_cell_c",decimals:1},"h").w("</td><td  >").h("decimal",b,{block:k},{key:"v_datacollection_summary_phasing_cell_alpha",decimals:1},"h").w("</td><td >").h("decimal",b,{block:l},{key:"v_datacollection_summary_phasing_cell_beta",decimals:1},"h").w("</td><td >").h("decimal",b,{block:m},{key:"v_datacollection_summary_phasing_cell_gamma",decimals:1},"h").w("</td><td ><span class='innershell'>").f(b.getPath(!0,["innerShell","resolutionLimitLow"]),b,"h").w("-").f(b.getPath(!0,["innerShell","resolutionLimitHigh"]),b,"h").w(" </span><span class='overallshell'>").f(b.getPath(!0,["overall","resolutionLimitLow"]),b,"h").w("-").f(b.getPath(!0,["overall","resolutionLimitHigh"]),b,"h").w(" </span> <span class='outershell'>").f(b.getPath(!0,["outerShell","resolutionLimitLow"]),b,"h").w("-").f(b.getPath(!0,["outerShell","resolutionLimitHigh"]),b,"h").w("</span></td><td >               <span class='innershell'>").f(b.getPath(!0,["innerShell","multiplicity"]),b,"h").w(" </span><span class='overallshell'>").f(b.getPath(!0,["overall","multiplicity"]),b,"h").w("</span> <span class='outershell'>").f(b.getPath(!0,["outerShell","multiplicity"]),b,"h").w("</span></td><td ><span class='innershell'>").f(b.getPath(!0,["innerShell","completeness"]),b,"h").w(" </span><span class='overallshell'>").f(b.getPath(!0,["overall","completeness"]),b,"h").w("</span> <span class='outershell'>").f(b.getPath(!0,["outerShell","completeness"]),b,"h").w("</span></td><td ><span class='innershell'>").f(b.getPath(!0,["innerShell","meanIOverSigI"]),b,"h").w(" </span><span class='overallshell'>").f(b.getPath(!0,["overall","meanIOverSigI"]),b,"h").w("</span> <span class='outershell'>").f(b.getPath(!0,["outerShell","meanIOverSigI"]),b,"h").w("</span></td><td ><span class='innershell'>").f(b.getPath(!0,["innerShell","rMeasAllIPlusIMinus"]),b,"h").w(" </span><span class='overallshell'>").f(b.getPath(!0,["overall","rMeasAllIPlusIMinus"]),b,"h").w("</span> <span class='outershell'>").f(b.getPath(!0,["outerShell","rMeasAllIPlusIMinus"]),b,"h").w("</span></td><td >").h("lt",b,{"else":n,block:o},{key:b.getPath(!1,["innerShell","rMerge"]),value:10},"h").w("<span class='overallshell'>").f(b.getPath(!0,["overall","rMerge"]),b,"h").w("</span> <span class='outershell'>").f(b.getPath(!0,["outerShell","rMerge"]),b,"h").w("</span></td><td ><span class='innershell'>").f(b.getPath(!0,["innerShell","rPimWithinIPlusIMinus"]),b,"h").w(" </span><span class='overallshell'>").f(b.getPath(!0,["overall","rPimWithinIPlusIMinus"]),b,"h").w("</span> <span class='outershell'>").f(b.getPath(!0,["outerShell","rPimWithinIPlusIMinus"]),b,"h").w("</span></td><td ><span class='innershell'>").f(b.getPath(!0,["innerShell","ccHalf"]),b,"h").w(" </span><span class='overallshell'>").f(b.getPath(!0,["overall","ccHalf"]),b,"h").w("</span> <span class='outershell'>").f(b.getPath(!0,["outerShell","ccHalf"]),b,"h").w("</span></td><td ><a href='").f(b.getPath(!0,["downloadFilesUrl"]),b,"h").w("' ><span style='font-size: 1.5em;' class=\"glyphicon glyphicon-download \" ></span></a></td></tr>")}function d(a,b){return a.w("<tr style='background-color:#ffddcc;'>")}function e(a,b){return a.w("<tr style='background-color:#e6ffe6;'>")}function f(a,b){return a}function g(a,b){return a.w("<span style='color:green;' class=\"glyphicon glyphicon-ok\"></span>")}function h(a,b){return a}function i(a,b){return a}function j(a,b){return a}function k(a,b){return a}function l(a,b){return a}function m(a,b){return a}function n(a,b){return a.w("<span class='innershell' style='font-weight:700;color:red;'>").f(b.getPath(!0,["innerShell","rMerge"]),b,"h").w(" </span>")}function o(a,b){return a.w("<span class='innershell'>").f(b.getPath(!0,["innerShell","rMerge"]),b,"h").w(" </span>")}return a.register("collapsed.autoprocintegrationgrid.template",b),b.__dustBody=!0,c.__dustBody=!0,d.__dustBody=!0,e.__dustBody=!0,f.__dustBody=!0,g.__dustBody=!0,h.__dustBody=!0,i.__dustBody=!0,j.__dustBody=!0,k.__dustBody=!0,l.__dustBody=!0,m.__dustBody=!0,n.__dustBody=!0,o.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w(' <div class="container-fluid" class=\'containerWithScroll\' ><div class="row"><div class="col-xs-12 col-md-2" >        <table class="table"  ><thead><tr><th>Name</th><th>Type</th><th>Path</th></tr></thead>').s(b.getPath(!0,[]),b,{block:c},{}).w("    </table></div></div></div>")}function c(a,b){return a.w("<tbody><tr><td><a href='").f(b.getPath(!0,["url"]),b,"h").w("'>").f(b.getPath(!0,["fileName"]),b,"h").w("</a></td> <td>").f(b.getPath(!0,["fileType"]),b,"h").w("</td> <td>").f(b.getPath(!0,["filePath"]),b,"h").w("</td></tr></tbody>")}return a.register("files.autoprocintegrationgrid.template",b),b.__dustBody=!0,c.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w("<table class='table-sm table table-striped'>").s(b.getPath(!0,["phasing","0"]),b,{block:c},{}).w("<tbody>               ").s(b.getPath(!0,["phasing"]),b,{block:d},{}).w("</tbody></table>")}function c(a,b){return a.w('	<thead>   <tr><th>Phasing</th><th><abbr title="Prepare Step">PR</abbr></th><th><abbr title="Substructure Determination Step">SU</abbr></th><th><abbr title="Phasing Step">PH</abbr></th><th><abbr title="Model Building Step">MO</abbr></th></tr></thead>')}function d(a,b){return a.w("		<tr><td><a href='#/phasing/autoprocintegrationId/").f(b.getPath(!0,["autoProcIntegrationId"]),b,"h").w("/main'>").f(b.getPath(!0,["spaceGroup"]),b,"h").w("</a></td><td>").h("eq",b,{"else":e,block:f},{key:b.get(["prepare"],!1),type:"boolean",value:"true"},"h").w("</td><td>").h("eq",b,{"else":g,block:h},{key:b.get(["sub"],!1),type:"boolean",value:"true"},"h").w("</td><td>").h("eq",b,{"else":i,block:j},{key:b.get(["phasing"],!1),type:"boolean",value:"true"},"h").w("</td><td>").h("eq",b,{"else":k,block:l},{key:b.get(["model"],!1),type:"boolean",value:"true"},"h").w("</td></tr>")}function e(a,b){return a.w("<span style='color:red;' class=\"glyphicon glyphicon-remove\"></span>")}function f(a,b){return a.w("<span style='color:green;' class=\"glyphicon glyphicon-ok\"></span>")}function g(a,b){return a.w("<span style='color:red;' class=\"glyphicon glyphicon-remove\"></span>")}function h(a,b){return a.w("<span style='color:green;' class=\"glyphicon glyphicon-ok\"></span>")}function i(a,b){return a.w("<span style='color:red;' class=\"glyphicon glyphicon-remove\"></span>")}function j(a,b){return a.w("<span style='color:green;' class=\"glyphicon glyphicon-ok\"></span>")}function k(a,b){return a.w("<span style='color:red;' class=\"glyphicon glyphicon-remove\"></span>")}function l(a,b){return a.w("<span style='color:green;' class=\"glyphicon glyphicon-ok\"></span>")}return a.register("phasing.autoprocintegrationgrid.template",b),b.__dustBody=!0,c.__dustBody=!0,d.__dustBody=!0,e.__dustBody=!0,f.__dustBody=!0,g.__dustBody=!0,h.__dustBody=!0,i.__dustBody=!0,j.__dustBody=!0,k.__dustBody=!0,l.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w(' <div class="container-fluid"><div class="row"><div id=\'rFactor_').f(b.getPath(!0,["v_datacollection_summary_phasing_autoProcProgramId"]),b,"h").w('\' class="col-xs-12 col-md-4">                   1   ').f(b.getPath(!0,["v_datacollection_summary_phasing_autoProcProgramId"]),b,"h").w("                        </div><div id='completeness_").f(b.getPath(!0,["v_datacollection_summary_phasing_autoProcProgramId"]),b,"h").w("' class=\"col-xs-12 col-md-4\">                    2                        </div><div id='sigmaI_").f(b.getPath(!0,["v_datacollection_summary_phasing_autoProcProgramId"]),b,"h").w('\' class="col-xs-12 col-md-4">3                    </div></div><div class="row"><div id=\'cc2_').f(b.getPath(!0,["v_datacollection_summary_phasing_autoProcProgramId"]),b,"h").w("' class=\"col-xs-12 col-md-4\">                   4                           </div><div id='sigmaAnno_").f(b.getPath(!0,["v_datacollection_summary_phasing_autoProcProgramId"]),b,"h").w("' class=\"col-xs-12 col-md-4\">                    5                       </div><div id='anno_").f(b.getPath(!0,["v_datacollection_summary_phasing_autoProcProgramId"]),b,"h").w('\' class="col-xs-12 col-md-4">6                    </div></div></div>')}return a.register("plots.autoprocintegrationgrid.template",b),b.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w("<table class='table-sm table table-striped'><thead><tr><th style='padding:0 15px 0 15px;'>Data Range</th><th style='padding:0 15px 0 15px;'>Resolution</th><th style='padding:0 15px 0 15px;'>Multiplicity</th><th style='padding:0 15px 0 15px;'>Completeness</th><th  style='padding:0 15px 0 15px;'>I/Sigmal</th><th style='padding:0 15px 0 15px;'>Rmeas</th><th style='padding:0 15px 0 15px;'>Rmerge</th><th style='padding:0 15px 0 15px;'>Rpim</th><th style='padding:0 15px 0 15px;'>cc(1/2)</th></tr></thead><tbody>").s(b.getPath(!0,["statistics"]),b,{block:c},{}).w("<tbody></table>")}function c(a,b){return a.w("<tr><td>").f(b.getPath(!0,["type"]),b,"h").w("</td><td >").h("decimal",b,{block:d},{key:"resolutionLimitLow",decimals:1},"h").w(" - ").h("decimal",b,{block:e},{key:"resolutionLimitHigh",decimals:1},"h").w("</td><td >").h("decimal",b,{block:f},{key:"multiplicity",decimals:1},"h").w("</td><td > ").h("gt",b,{block:g},{key:b.get(["completeness"],!1),value:20},"h").h("lte",b,{block:l},{key:b.get(["completeness"],!1),value:20},"h").w("</td><td > ").h("decimal",b,{block:n},{key:"meanIOverSigI",decimals:1},"h").w("</td><td > ").h("decimal",b,{block:o},{key:"rMeasAllIPlusIMinus",decimals:1},"h").w("</td><td > ").h("decimal",b,{block:p},{key:"rMerge",decimals:1},"h").w("</td><td > ").h("decimal",b,{block:q},{key:"rPimWithinIPlusIMinus",decimals:1},"h").w("</td><td > ").h("decimal",b,{block:r},{key:"ccHalf",decimals:1},"h").w("</td></tr>	")}function d(a,b){return a}function e(a,b){return a}function f(a,b){return a}function g(a,b){return a.h("gt",b,{"else":h,block:j},{key:b.get(["completeness"],!1),value:60},"h")}function h(a,b){return a.w('<div  style="background-repeat: repeat-x;border:1px solid #f0ad4e;color:#fff;background-color:#f0ad4e;width:').f(b.getPath(!0,["completeness"]),b,"h").w('%">                        ').h("decimal",b,{block:i},{key:"completeness",decimals:0},"h").w("%</div>")}function i(a,b){return a}function j(a,b){return a.w('<div  style="background-repeat: repeat-x;border:1px solid gray;color:#fff;background-image:linear-gradient(to bottom,#337ab7 0,#286090 100%);width:').f(b.getPath(!0,["completeness"]),b,"h").w('%">').h("decimal",b,{block:k},{key:"completeness",decimals:0},"h").w("%</div>")}function k(a,b){return a}function l(a,b){return a.w('<div  style="background-repeat: repeat-x;border:1px solid #d9534f;color:#fff;background-color:#d9534f;width:').f(b.getPath(!0,["completeness"]),b,"h").w('%">').h("decimal",b,{block:m},{key:"completeness",decimals:0},"h").w("%</div>")}function m(a,b){return a}function n(a,b){return a}function o(a,b){return a}function p(a,b){return a}function q(a,b){return a}function r(a,b){return a}return a.register("statistics.autoprocintegrationgrid.template",b),b.__dustBody=!0,c.__dustBody=!0,d.__dustBody=!0,e.__dustBody=!0,f.__dustBody=!0,g.__dustBody=!0,h.__dustBody=!0,i.__dustBody=!0,j.__dustBody=!0,k.__dustBody=!0,l.__dustBody=!0,m.__dustBody=!0,n.__dustBody=!0,o.__dustBody=!0,p.__dustBody=!0,q.__dustBody=!0,r.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w("<table class='table table-striped'><thead>   <tr><th  style='padding:0 15px 0 15px;'>cell A</th><th style='padding:0 15px 0 15px;'>cell B</th><th style='padding:0 15px 0 15px;'>cell C</th></tr></thead><tbody><tr><td  style='padding:0 15px 0 15px;'>").h("decimal",b,{block:c},{key:"v_datacollection_summary_phasing_cell_a",decimals:1},"h").w("</td><td style='padding:0 15px 0 15px;'>").h("decimal",b,{block:d},{key:"v_datacollection_summary_phasing_cell_b",decimals:1},"h").w("</td><td style='padding:0 15px 0 15px;'>").h("decimal",b,{block:e},{key:"v_datacollection_summary_phasing_cell_c",decimals:1},"h").w("</td></tr></tbody></table><table class='table table-striped'><thead>   <tr><th  style='padding:0 15px 0 15px;'>Alpha</th><th style='padding:0 15px 0 15px;'>Beta</th><th style='padding:0 15px 0 15px;'>Gamma</th></tr></thead><tbody><tr><td  style='padding:0 15px 0 15px;'>").h("decimal",b,{block:f},{key:"v_datacollection_summary_phasing_cell_alpha",decimals:1},"h").w("</td><td style='padding:0 15px 0 15px;'>").h("decimal",b,{block:g},{key:"v_datacollection_summary_phasing_cell_beta",decimals:1},"h").w("</td><td style='padding:0 15px 0 15px;'>").h("decimal",b,{block:h},{key:"v_datacollection_summary_phasing_cell_gamma",decimals:1},"h").w("</td></tr></tbody></table>")}function c(a,b){return a}function d(a,b){return a}function e(a,b){return a}function f(a,b){return a}function g(a,b){return a}function h(a,b){return a}return a.register("unitcell.autoprocintegrationgrid.template",b),b.__dustBody=!0,c.__dustBody=!0,d.__dustBody=!0,e.__dustBody=!0,f.__dustBody=!0,g.__dustBody=!0,h.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w("<table> <tr><td>Acronym:</td><td style='color:#207a7a;font-weight:bold;'>").f(b.getPath(!0,["proteinVO","acronym"]),b,"h").w("</td></tr><tr><td>Name:</td><td>").f(b.getPath(!0,["proteinVO","name"]),b,"h").w("</td></tr><tr><td>Experiment:</td><td>").f(b.getPath(!0,["diffractionPlanVO","experimentKind"]),b,"h").w("</td></tr><tr><td>Space Group:</td><td>").f(b.getPath(!0,["spaceGroup"]),b,"h").w("</td></tr></table>")}return a.register("crystal.listview",b),b.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.s(b.getPath(!0,["onlineresults","0"]),b,{block:c},{})}function c(a,b){return a.w("       ").p("completeness.autoproc.mxdatacollectiongrid.template",b,b,{}).w("<br />                    ").p("unitcell.autoproc.mxdatacollectiongrid.template",b,b,{}).w("         ")}return a.register("autoproc.mxdatacollectiongrid.template",b),b.__dustBody=!0,c.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w("<table class=\"table\">                    <tr><td>Number of passes</td><td  class='column_parameter_value'> ").f(b.getPath(!0,["DataCollection_numberOfPasses"]),b,"h").w("</td></tr><tr><td>Detector Distance</td><td  class='column_parameter_value'>").f(b.getPath(!0,["DataCollection_detectorDistance"]),b,"h").w(" mm</td></tr><tr><td>X Beam</td><td  class='column_parameter_value'>").f(b.getPath(!0,["DataCollection_xBeam"]),b,"h").w("</td></tr><tr><td>Y Beam</td><td  class='column_parameter_value'>").f(b.getPath(!0,["DataCollection_yBeam"]),b,"h").w("</td></tr><tr><td>Kappa Start</td><td  class='column_parameter_value'>").f(b.getPath(!0,["DataCollection_kappaStart"]),b,"h").w("</td></tr><tr><td>Phi Start</td><td  class='column_parameter_value'>").f(b.getPath(!0,["DataCollection_phiStart"]),b,"h").w("</td></tr></table>       ")}return a.register("beamline.mxdatacollectiongrid.template",b),b.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w('<div class="container-fluid"><div class="row"><div class="col-xs-6 col-md-1">#').f(b.getPath(!0,["DataCollection_dataCollectionNumber"]),b,"h").w(" ").f(b.getPath(!0,["DataCollectionGroup_experimentType"]),b,"h").w(" <br />").f(b.getPath(!0,["DataCollectionGroup_startTime"]),b,"h").w("</div><div class=\"col-xs-6 col-md-2\"><table class='table-sm table-condensed '><thead><tr><th  colspan=2 style='padding:0 15px 0 15px;'> </th></tr></thead><tbody><tr><td  style='padding:0 15px 0 15px;'>Protein</td><td  style='padding:0 15px 0 15px;' class='column_parameter_value'>").f(b.getPath(!0,["Protein_acronym"]),b,"h").w("</td></tr><tr><td  style='padding:0 15px 0 15px;'>Prefix</td><td  style='padding:0 15px 0 15px;'><a href='#/mx/datacollection/datacollectionid/").f(b.getPath(!0,["DataCollection_dataCollectionId"]),b,"h").w("/main'>").f(b.getPath(!0,["DataCollection_imagePrefix"]),b,"h").w("</a></td></tr><tr><td  style='padding:0 15px 0 15px;'>Images</td><td  style='padding:0 15px 0 15px;' class='column_parameter_value'>").f(b.getPath(!0,["totalNumberOfImages"]),b,"h").w("</td></tr></tbody></table></div><div class=\"col-xs-6 col-md-2\"><table class='table-sm table-condensed'><thead><tr><th  colspan=2 style='padding:0 15px 0 15px;'></th></tr></thead><tbody><tr><td  style='padding:0 15px 0 15px;'>Type</td><td  style='padding:0 15px 0 15px;' class='column_parameter_value'>").f(b.getPath(!0,["DataCollectionGroup_experimentType"]),b,"h").w("</td></tr><tr><td  style='padding:0 15px 0 15px;'>Res. (corner)</td><td  style='padding:0 15px 0 15px;' class='column_parameter_value'>").f(b.getPath(!0,["DataCollection_resolution"]),b,"h").w(" &#8491; (").f(b.getPath(!0,["DataCollection_resolutionAtCorner"]),b,"h").w(" &#8491;)</td></tr><tr><td  style='padding:0 15px 0 15px;'>Wavelenth</td><td  style='padding:0 15px 0 15px;' class='column_parameter_value'>").f(b.getPath(!0,["DataCollection_wavelength"]),b,"h").w(' &#8491;</td></tr></tbody></table></div><div class="col-xs-6 col-md-2">').s(b.getPath(!0,["onlineresults","0"]),b,{block:c},{}).w('                           </div><div class="col-xs-12 col-md-2">').s(b.getPath(!0,["onlineresults","0"]),b,{block:d},{}).w("                           </div><div class=\"col-sm-2 col-md-1 \" style='margin: 0 10px 10px 0;'>").s(b.getPath(!0,["autoprocessing"]),b,{block:e},{}).w("</div><div class=\"col-sm-2 col-md-1 \" style='margin: 0 10px 10px 0;'>").s(b.getPath(!0,["screening"]),b,{block:k},{}).w("</div></div></div>")}function c(a,b){return a.w("       ").p("sm.completeness.autoproc.mxdatacollectiongrid.template",b,b,{})}function d(a,b){return a.w("       ").p("unitcell.autoproc.mxdatacollectiongrid.template",b,b,{}).w("       ")}function e(a,b){return a.h("gt",b,{block:f},{key:b.getPath(!1,["items","length"]),value:0},"h")}function f(a,b){return a.w("  ").s(b.getPath(!0,[]),b,{block:g},{}).w(" ")}function g(a,b){return a.w("<table class='table-sm table-condensed'>").s(b.getPath(!0,["items"]),b,{block:h},{}).w("</table>")}function h(a,b){return a.w("<tr>").h("eq",b,{block:i},{key:b.get(["status"],!1),value:"Success"},"h").h("ne",b,{block:j},{key:b.get(["status"],!1),value:"Success"},"h").w("</tr>")}function i(a,b){return a.w("<td> <span style='color:green;' class=\"glyphicon glyphicon-ok\"></span></td><td>").f(b.getPath(!0,["name"]),b,"h").w(" </td>")}function j(a,b){return a.w(" <td> <span style='color:red;' class=\"glyphicon glyphicon-remove\"></span></td><td>").f(b.getPath(!0,["name"]),b,"h").w(" </td>")}function k(a,b){return a.h("gt",b,{block:l},{key:b.getPath(!1,["items","length"]),value:0},"h")}function l(a,b){return a.w("  ").s(b.getPath(!0,[]),b,{block:m},{}).w(" ")}function m(a,b){return a.w("<table class='table-sm table-condensed'>").s(b.getPath(!0,["items"]),b,{block:n},{}).w("</table>")}function n(a,b){return a.w("<tr>").h("eq",b,{block:o},{key:b.get(["status"],!1),value:"Success"},"h").h("ne",b,{block:p},{key:b.get(["status"],!1),value:"Success"},"h").w("</tr>")}function o(a,b){return a.w("<td> <span style='color:green;' class=\"glyphicon glyphicon-ok\"></span></td><td>").f(b.getPath(!0,["name"]),b,"h").w(" </td>")}function p(a,b){return a.w(" <td> <span style='color:red;' class=\"glyphicon glyphicon-remove\"></span></td><td>").f(b.getPath(!0,["name"]),b,"h").w(" </td>")}return a.register("collapsed.mxdatacollectiongrid.template",b),b.__dustBody=!0,c.__dustBody=!0,d.__dustBody=!0,e.__dustBody=!0,f.__dustBody=!0,g.__dustBody=!0,h.__dustBody=!0,i.__dustBody=!0,j.__dustBody=!0,k.__dustBody=!0,l.__dustBody=!0,m.__dustBody=!0,n.__dustBody=!0,o.__dustBody=!0,p.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w("<table class='table-sm'><thead><tr><th>").f(b.getPath(!0,["spaceGroup"]),b,"h").w('</th><th style=\'padding:0 15px 0 15px;\'>Completeness</th><th style=\'padding:0 15px 0 15px;\'>Res.</th><th>Rmerge</th></tr><tr><td valign="top">Inner</td><td><div class="progress"><div class="progress-bar progress-bar"  role="progressbar" aria-valuenow="').f(b.getPath(!0,["innerShell","completeness"]),b,"h").w('" aria-valuemin="0" aria-valuemax="100" style="width:').f(b.getPath(!0,["innerShell","completeness"]),b,"h").w('%">').f(b.getPath(!0,["innerShell","completeness"]),b,"h").w("%</div></div></td><td valign=\"top\" style='padding:0 15px 0 15px;'>").f(b.getPath(!0,["innerShell","resolutionsLimitHigh"]),b,"h").w('</td><td valign="top">').f(b.getPath(!0,["innerShell","rMerge"]),b,"h").w('</td></tr><tr><td valign="top">Outer</td><td><div class="progress"><div class="progress-bar progress-bar"   role="progressbar" aria-valuenow="').f(b.getPath(!0,["outerShell","completeness"]),b,"h").w('" aria-valuemin="0" aria-valuemax="100" style="width:').f(b.getPath(!0,["outerShell","completeness"]),b,"h").w('%">').f(b.getPath(!0,["outerShell","completeness"]),b,"h").w("%</div></div></td><td valign=\"top\" style='padding:0 15px 0 15px;'>").f(b.getPath(!0,["outerShell","resolutionsLimitHigh"]),b,"h").w('</td><td valign="top">').f(b.getPath(!0,["outerShell","rMerge"]),b,"h").w('</td></tr><tr><td valign="top">Overall</td><td><div class="progress"><div class="progress-bar progress-bar"   role="progressbar" aria-valuenow="').f(b.getPath(!0,["overall","completeness"]),b,"h").w('" aria-valuemin="0" aria-valuemax="100" style="width:').f(b.getPath(!0,["overall","completeness"]),b,"h").w('%">').f(b.getPath(!0,["overall","completeness"]),b,"h").w("%</div></div></td><td valign=\"top\"  style='padding:0 15px 0 15px;'>").f(b.getPath(!0,["overall","resolutionsLimitHigh"]),b,"h").w('</td><td valign="top">').f(b.getPath(!0,["overall","rMerge"]),b,"h").w("</td></tr></thead></table>")}return a.register("completeness.autoproc.mxdatacollectiongrid.template",b),b.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w(' <div class="container-fluid containerWithScroll" ><div class="row"><div class="col-xs-12 col-md-2">        <table class="table table-striped table-hover"><thead><tr><th>Run</th><th>Prefix</th><th>#Images</th><th>ExposureTime</th><th>Res. (corner)</th><th>Wavelenth</th><th>Transmission</th><th>Directory</th><th>Time</th><th>Run status</th><th>Phasing</th></tr></thead>').s(b.getPath(!0,[]),b,{block:c},{}).w("    </table></div></div></div>")}function c(a,b){return a.h("eq",b,{"else":d,block:e},{key:b.get(["runStatus"],!1),value:"failed"},"h").w("    <td>#").f(b.getPath(!0,["dataCollectionNumber"]),b,"h").w("</td><td>").f(b.getPath(!0,["imagePrefix"]),b,"h").w("</td><td ><span class=\"badge\" style='background-color:#337ab7;'>").f(b.getPath(!0,["numberOfImages"]),b,"h").w("</span></td><td >").f(b.getPath(!0,["exposureTime"]),b,"h").w(" s</td><td >").h("decimal",b,{block:f},{key:"resolution",decimals:1},"h").w(" &#8491; (").h("decimal",b,{block:g},{key:"resolutionAtCorner",decimals:1},"h").w(" &#8491;)</td><td > ").h("decimal",b,{block:h},{key:"wavelength",decimals:1},"h").w(" &#8491;</td><td>").f(b.getPath(!0,["transmission"]),b,"h").w("%</td><td>").f(b.getPath(!0,["imageDirectory"]),b,"h").w("</td><td>").f(b.getPath(!0,["startTime"]),b,"h").w("</td><td>").f(b.getPath(!0,["runStatus"]),b,"h").w("</td><td>").h("gt",b,{block:i},{key:b.get(["hasPhasing"],!1),value:0},"h").w("</td></tr>")}function d(a,b){return a.w("<tr>")}function e(a,b){return a.w('<tr class="danger">')}function f(a,b){return a}function g(a,b){return a}function h(a,b){return a}function i(a,b){return a.w("<div class='summary_datacollection_success'></div>")}return a.register("datacollections.mxdatacollectiongrid.template",b),b.__dustBody=!0,c.__dustBody=!0,d.__dustBody=!0,e.__dustBody=!0,f.__dustBody=!0,g.__dustBody=!0,h.__dustBody=!0,i.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w("<table class=\"table\">                    <tr><td>Detector Type</td><td  class='column_parameter_value'> ").f(b.getPath(!0,["detectorType"]),b,"h").w("</td></tr><tr><td>Detector Model</td><td  class='column_parameter_value'>").f(b.getPath(!0,["detectorModel"]),b,"h").w("</td></tr><tr><td>Manufacturer</td><td  class='column_parameter_value'>").f(b.getPath(!0,["detectorManufacturer"]),b,"h").w("</td></tr><tr><td>Hor. Pixel Size</td><td  class='column_parameter_value'>").f(b.getPath(!0,["detectorPixelSizeHorizontal"]),b,"h").w("</td></tr><tr><td>Ver. Pixel Size</td><td  class='column_parameter_value'>").f(b.getPath(!0,["detectorPixelSizeVertical"]),b,"h").w("</td></tr><tr><td>Mode</td><td  class='column_parameter_value'>").f(b.getPath(!0,["detectorMode"]),b,"h").w("</td></tr></table>       ")}return a.register("detector.mxdatacollectiongrid.template",b),b.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w(' <div class="col-xs-6 col-md-2"><table class="table"> <tr><td>Kind</td><td class=\'column_parameter_value\'>').f(b.getPath(!0,["experimentKind"]),b,"h").w("</td></tr> <tr><td>Positions</td><td class='column_parameter_value'>").f(b.getPath(!0,["numberOfPositions"]),b,"h").w("</td></tr><tr><td>Observed Res.</td><td class='column_parameter_value'> ").f(b.getPath(!0,["observedResolution"]),b,"h").w(" &#8491;</td></tr><tr><td>Min. Resolution </td><td class='column_parameter_value'>").f(b.getPath(!0,["minimalResolution"]),b,"h").w(" &#8491;</td></tr><tr><td>Max. Resolution</td><td class='column_parameter_value'>").f(b.getPath(!0,["maximalResolution"]),b,"h").w(" &#8491;</td></tr><tr><td>Screening Resolution</td><td class='column_parameter_value'>").f(b.getPath(!0,["screeningResolution"]),b,"h").w(" &#8491;</td></tr></table>       </div>")}return a.register("diffraction.mxdatacollectiongrid.template",b),b.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w("<table class=\"table\"><tr><td  >Workflow</td><td class='column_parameter_value'>").h("eq",b,{block:c},{key:b.get(["Workflow_status"],!1),value:"Success"},"h").h("eq",b,{block:d},{key:b.get(["Workflow_status"],!1),value:"Failure"},"h").f(b.getPath(!0,["Workflow_workflowType"]),b,"h").w("</td></tr><tr><td>Protein</td><td class='column_parameter_value'>").f(b.getPath(!0,["Protein_acronym"]),b,"h").w("</td></tr><tr><td>Sample</td><td class='column_parameter_value'>").f(b.getPath(!0,["BLSample_name"]),b,"h").w("</td></tr><tr><td>Prefix</td><td class='column_parameter_value'>").f(b.getPath(!0,["DataCollection_imagePrefix"]),b,"h").w("</td></tr><tr><td>Images</td><td class='column_parameter_value'>").f(b.getPath(!0,["totalNumberOfImages"]),b,"h").w("</td></tr><tr><td>Transmission</td><td class='column_parameter_value'>").f(b.getPath(!0,["transmission"]),b,"h").w("</td></tr><tr><td>Flux start</td><td class='column_parameter_value'>").f(b.getPath(!0,["DataCollection_flux"]),b,"h").w(" ph/sec</td></tr></table>")}function c(a,b){return a.w("<div class='summary_datacollection_success'></div>")}function d(a,b){return a.w("<div class='summary_datacollection_failed'></div>")}return a.register("first.general.mxdatacollectiongrid.template",b),b.__dustBody=!0,c.__dustBody=!0,d.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w(' <div class="col-xs-6 col-md-2">').p("first.general.mxdatacollectiongrid.template",b,b,{}).w('                             </div><div class="col-xs-6 col-md-2">').p("second.general.mxdatacollectiongrid.template",b,b,{}).w("                             </div> ")}return a.register("general.mxdatacollectiongrid.template",b),b.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w("<table><tr><td class='summary_datacollection_parameter_name'>Data Coll Group</td><td class='summary_datacollection_parameter'>").f(b.getPath(!0,["DataCollection_dataCollectionGroupId"]),b,"h").w("</td>        </tr><tr><td class='summary_datacollection_parameter_name'>Data Collection</td><td class='summary_datacollection_parameter'>").f(b.getPath(!0,["DataCollection_dataCollectionId"]),b,"h").w("</td>        </tr><tr><td class='summary_datacollection_parameter_name'>Sample</td><td class='summary_datacollection_parameter'>").f(b.getPath(!0,["BLSample_blSampleId"]),b,"h").w("</td>        </tr><tr><td class='summary_datacollection_parameter_name'>Crystal</td><td class='summary_datacollection_parameter'>").f(b.getPath(!0,["BLSample_crystalId"]),b,"h").w("</td>        </tr><tr><td class='summary_datacollection_parameter_name'>Session</td><td class='summary_datacollection_parameter'>").f(b.getPath(!0,["BLSession_sessionId"]),b,"h").w("</td>        </tr><tr><td class='summary_datacollection_parameter_name'>Protein</td><td class='summary_datacollection_parameter'>").f(b.getPath(!0,["Protein_proteinId"]),b,"h").w("</td>                </tr><tr><td class='summary_datacollection_parameter_name'>Auto Proc Int.</td><td class='summary_datacollection_parameter'>").f(b.getPath(!0,["autoProcIntegrationId"]),b,"h").w("</td>                </tr>   <tr><td class='summary_datacollection_parameter_name'>Workflow Steps</td><td class='summary_datacollection_parameter'>").f(b.getPath(!0,["WorkflowStep_workflowStepId"]),b,"h").w("</td>                </tr> <tr><td class='summary_datacollection_parameter_name'>Shipping</td><td class='summary_datacollection_parameter'>").f(b.getPath(!0,["shippingId"]),b,"h").w("</td>                </tr>    </table> ")}return a.register("ids.mxdatacollectiongrid.template",b),b.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w('<div class="container-fluid"><div class="panel with-nav-tabs panel-default"><div class="panel-heading clearfix"><div class="pull-left"><span style=\'font-size:12px;color:blue;\' ><kbd style=\'background-color:#CCCCCC;color:blue;\'>Run #').f(b.getPath(!0,["DataCollection_dataCollectionNumber"]),b,"h").w(" ").f(b.getPath(!0,["DataCollectionGroup_experimentType"]),b,"h").w("</kbd> <span style='color:blue;'>").f(b.getPath(!0,["DataCollectionGroup_startTime"]),b,"h").w("</span>                                   </span><p>").f(b.getPath(!0,["DataCollection_imageDirectory"]),b,"h").w('</p>      </div><div class="pull-right"><ul class="nav nav-tabs" id="myTabs"><li class="active"><a data-toggle="tab" href="#datacollection_').f(b.getPath(!0,["DataCollection_dataCollectionId"]),b,"h").w('"> Summary</a></li><li><a data-toggle="tab" href="#experimentparameters_').f(b.getPath(!0,["DataCollection_dataCollectionId"]),b,"h").w('">Beamline Parameters</a></li>               <li><a data-toggle="tab" href="#dc_').f(b.getPath(!0,["DataCollectionGroup_dataCollectionGroupId"]),b,"h").w('">Data Collections <span class="badge" style=\'background-color:#337ab7;\'>').f(b.getPath(!0,["totalNumberOfDataCollections"]),b,"h").w('</span></a></li><li><a data-toggle="tab" href="#sa_').f(b.getPath(!0,["DataCollection_dataCollectionId"]),b,"h").w('">Sample</a></li>').h("gt",b,{
"else":c,block:d},{key:b.get(["resultsCount"],!1),value:"0"},"h").h("gt",b,{"else":e,block:f},{key:b.getPath(!1,["workflows","length"]),value:"0"},"h").h("gt",b,{"else":g,block:h},{key:b.get(["hasPhasing"],!1),value:"0"},"h").w('</ul></div></div><br /><div class="tab-content"><div id="datacollection_').f(b.getPath(!0,["DataCollection_dataCollectionId"]),b,"h").w('" class="tab-pane fade in active"><div class="container-fluid"><div class="row">').p("general.mxdatacollectiongrid.template",b,b,{}).w('<div class="col-xs-12 col-md-2">  ').h("eq",b,{block:i},{key:b.get(["isScreeningVisible"],!1),type:"boolean",value:"true"},"h").w("  ").p("autoproc.mxdatacollectiongrid.template",b,b,{}).w('       </div><div class="col-xs-12 col-md-2"><a href="').f(b.getPath(!0,["url"]),b,"h").w("\" data-lightbox='").f(b.getPath(!0,["url"]),b,"h").w("' data-title=\"#").f(b.getPath(!0,["runNumber"]),b,"h").w(" ").f(b.getPath(!0,["folder"]),b,"h").w('"> <img alt="Image not found" class="img-responsive lazy"  data-src="').f(b.getPath(!0,["urlThumbnail"]),b,"h").w('" /></a>                           </div><div class="col-xs-12 col-md-2"><a href="').f(b.getPath(!0,["xtal1"]),b,"h").w('"  data-lightbox="').f(b.getPath(!0,["DataCollection_dataCollectionId"]),b,"h").w('" data-title="').f(b.getPath(!0,["Protein_acronym"]),b,"h").w(" : ").f(b.getPath(!0,["Protein_name"]),b,"h").w('"><img id="xtal1_').f(b.getPath(!0,["DataCollection_dataCollectionId"]),b,"h").w('" alt="Image not found" class="img-responsive smalllazy" data-src="').f(b.getPath(!0,["xtal1"]),b,"h").w('" data-zoom-image="').f(b.getPath(!0,["xtal1"]),b,"h").w('"/></a>                           </div><div class="col-xs-6 col-md-2"><a href="').f(b.getPath(!0,["indicator"]),b,"h").w("\" data-lightbox='").f(b.getPath(!0,["indicator"]),b,"h").w("' data-title=\"#").f(b.getPath(!0,["runNumber"]),b,"h").w(" ").f(b.getPath(!0,["folder"]),b,"h").w('"> <img  alt="Image not found" class="img-responsive lazy"  data-src="').f(b.getPath(!0,["indicator"]),b,"h").w('"/></a> </div></div><div class="container-fluid"><div class="col-xs-12 col-md-12">').f(b.getPath(!0,["DataCollectionGroup_comments"]),b,"h").x(b.get(["SpaceGroupModelResolvedByPhasing"],!1),b,{block:q},{}).w('</div></div></div></div><div id="experimentparameters_').f(b.getPath(!0,["DataCollection_dataCollectionId"]),b,"h").w('" class="tab-pane fade"><div class="container-fluid"><div class="row">').p("general.mxdatacollectiongrid.template",b,b,{}).w('<div class="col-xs-6 col-md-2">').p("beamline.mxdatacollectiongrid.template",b,b,{}).w('                             </div><div class="col-xs-6 col-md-2">').p("detector.mxdatacollectiongrid.template",b,b,{}).w('                             </div></div></div></div><div id="sa_').f(b.getPath(!0,["DataCollection_dataCollectionId"]),b,"h").w('" class="tab-pane fade"><div class="container-fluid"><div class="row"><div class="col-xs-6 col-md-2">').p("sample.mxdatacollectiongrid.template",b,b,{}).w('                             </div><div class="col-xs-12 col-md-2"><a href="').f(b.getPath(!0,["xtal1"]),b,"h").w('"  data-lightbox="').f(b.getPath(!0,["DataCollection_dataCollectionId"]),b,"h").w('" data-title="').f(b.getPath(!0,["Protein_acronym"]),b,"h").w(" : ").f(b.getPath(!0,["Protein_name"]),b,"h").w('"><img id="xtal1_samples_').f(b.getPath(!0,["DataCollection_dataCollectionId"]),b,"h").w('" alt="Image not found" class="img-responsive smalllazy" data-src="').f(b.getPath(!0,["xtal1"]),b,"h").w('"/></a>                           </div><div class="col-xs-12 col-md-2"><a href="').f(b.getPath(!0,["xtal2"]),b,"h").w('"  data-lightbox="').f(b.getPath(!0,["DataCollection_dataCollectionId"]),b,"h").w('" data-title="').f(b.getPath(!0,["Protein_acronym"]),b,"h").w(" : ").f(b.getPath(!0,["Protein_name"]),b,"h").w('"><img id="xtal2_samples_').f(b.getPath(!0,["DataCollection_dataCollectionId"]),b,"h").w('" alt="Image not found" class="img-responsive smalllazy" data-src="').f(b.getPath(!0,["xtal2"]),b,"h").w('"/></a>                           </div><div class="col-xs-12 col-md-2"><a href="').f(b.getPath(!0,["xtal3"]),b,"h").w('"  data-lightbox="').f(b.getPath(!0,["DataCollection_dataCollectionId"]),b,"h").w('" data-title="').f(b.getPath(!0,["Protein_acronym"]),b,"h").w(" : ").f(b.getPath(!0,["Protein_name"]),b,"h").w('"><img id="xtal3_samples_').f(b.getPath(!0,["DataCollection_dataCollectionId"]),b,"h").w('" alt="Image not found" class="img-responsive smalllazy" data-src="').f(b.getPath(!0,["xtal3"]),b,"h").w('"/></a>                           </div><div class="col-xs-12 col-md-2"><a href="').f(b.getPath(!0,["xtal4"]),b,"h").w('"  data-lightbox="').f(b.getPath(!0,["DataCollection_dataCollectionId"]),b,"h").w('" data-title="').f(b.getPath(!0,["Protein_acronym"]),b,"h").w(" : ").f(b.getPath(!0,["Protein_name"]),b,"h").w('"><img id="xtal4_samples_').f(b.getPath(!0,["DataCollection_dataCollectionId"]),b,"h").w('" alt="Image not found" class="img-responsive smalllazy" data-src="').f(b.getPath(!0,["xtal4"]),b,"h").w('"/></a>                           </div><div class="col-xs-12 col-md-2"><div id=\'sample_puck_layout_').f(b.getPath(!0,["DataCollection_dataCollectionId"]),b,"h").w('\'></div>                          </div></div><div class="container-fluid" ><div class="puck-selected-panel"><div id="puck_selected_info_').f(b.getPath(!0,["DataCollection_dataCollectionId"]),b,"h").w('" class="col-xs-12 col-md-12"></div></div></div></div></div><div id="dc_').f(b.getPath(!0,["DataCollectionGroup_dataCollectionGroupId"]),b,"h").w('" class="tab-pane fade"><div class="container-fluid"><div class="row"><div class="col-xs-12 col-md-12" id="__dc_').f(b.getPath(!0,["DataCollection_dataCollectionId"]),b,"h").w("\"><img style='display:block;margin-left: auto;margin-right: auto;height:150px;width:150px;'src='../images/loading-animation.gif' />                                           </div></div></div></div>").h("gt",b,{block:r},{key:b.get(["resultsCount"],!1),value:"0"},"h").w(" ").h("gt",b,{block:s},{key:b.getPath(!1,["workflows","length"]),value:"0"},"h").w(" ").h("gt",b,{block:t},{key:b.get(["hasPhasing"],!1),value:0},"h").w(" </div></div></div>")}function c(a,b){return a.w('<li class="disabled"><a data-toggle="tab"> Results</a></li>')}function d(a,b){return a.w('<li><a data-toggle="tab" href="#re_').f(b.getPath(!0,["DataCollection_dataCollectionId"]),b,"h").w('">Results  <span class="badge" style=\'background-color:#337ab7;\'>').f(b.getPath(!0,["resultsCount"]),b,"h").w("</span></a></li>")}function e(a,b){return a.w('<li class="disabled"><a data-toggle="tab">Workflow</a></li>')}function f(a,b){return a.w('<li><a data-toggle="tab" href="#wf_').f(b.getPath(!0,["DataCollection_dataCollectionId"]),b,"h").w('">Workflow  <span class="badge" style=\'background-color:#337ab7;\'>').f(b.getPath(!0,["workflows","length"]),b,"h").w("</span></a></li>")}function g(a,b){return a}function h(a,b){return a.w('<li><a data-toggle="tab" href="#ph_').f(b.getPath(!0,["DataCollection_dataCollectionGroupId"]),b,"h").w('">Phasing  <span class="badge" style=\'background-color:#337ab7;\'>').f(b.getPath(!0,["hasPhasing"]),b,"h").w("</span></a></li>")}function i(a,b){return a.h("ne",b,{block:j},{key:b.get(["ScreeningOutput_indexingSuccess"],!1),value:b.get(["null"],!1)},"h")}function j(a,b){return a.w("<table class=\"table\"><tr><td ><kbd style='background-color:#CCCCCC;color:blue;'>Indexed</kbd></td> <td>").h("eq",b,{"else":k,block:l},{key:b.get(["ScreeningOutput_indexingSuccess"],!1),type:"boolean",value:"true"},"h").w("</td></tr><tr><td>Mosaicity</td> <td class='column_parameter_value'>").f(b.getPath(!0,["ScreeningOutput_mosaicity"]),b,"h").w("</td></tr>  ").h("ne",b,{block:m},{key:b.get(["ScreeningOutput_strategySuccess"],!1),value:b.get(["null"],!1)},"h").w("                                                                                                                                                                                                           </table> ").h("eq",b,{block:p},{key:b.get(["ScreeningOutput_strategySuccess"],!1),type:"boolean",value:"true"},"h").w("                             ")}function k(a,b){return a.w("<div class='summary_datacollection_failed'></div>")}function l(a,b){return a.w("<div class='summary_datacollection_success'></div>")}function m(a,b){return a.w("                    <tr><td><kbd style='background-color:#CCCCCC;color:blue;'>Strategy</kbd></td> ").h("eq",b,{"else":n,block:o},{key:b.get(["ScreeningOutput_strategySuccess"],!1),type:"boolean",value:"true"},"h").w("</tr>")}function n(a,b){return a.w("<td><div class='summary_datacollection_failed'></div></td>")}function o(a,b){return a.w("<td> <div class='summary_datacollection_success'></div></td><tr><td>Rank. Res.</td> <td class='column_parameter_value'>").f(b.getPath(!0,["ScreeningOutput_rankingResolution"]),b,"h").w("</td></tr>                                                               <tr><td>Space Group</td> <td class='column_parameter_value'>").f(b.getPath(!0,["ScreeningOutputLattice_spaceGroup"]),b,"h").w("</td></tr>     ")}function p(a,b){return a.p("unitcell.screening.mxdatacollectiongrid.template",b,b,{}).w("  ")}function q(a,b){return a.w('<div class="alert alert-success">Automatic SAD appears to have worked with the space group ').f(b.getPath(!0,["SpaceGroupModelResolvedByPhasing"]),b,"h").w(" </div>")}function r(a,b){return a.w('<div id="re_').f(b.getPath(!0,["DataCollection_dataCollectionId"]),b,"h").w('" class="tab-pane fade"><div class="container-fluid"><div class="row"><div class="col-xs-12 col-md-12" id="__re_').f(b.getPath(!0,["DataCollection_dataCollectionId"]),b,"h").w("\"><img style='display:block;margin-left: auto;margin-right: auto;height:150px;width:150px;'src='../images/loading-animation.gif' />                                           </div></div></div></div>")}function s(a,b){return a.w('<div id="wf_').f(b.getPath(!0,["DataCollection_dataCollectionId"]),b,"h").w('" class="tab-pane fade"><div class="container-fluid"><div class="row"><div class="col-xs-12 col-md-12" id="__wf_').f(b.getPath(!0,["DataCollection_dataCollectionId"]),b,"h").w("\"><img style='display:block;margin-left: auto;margin-right: auto;height:150px;width:150px;'src='../images/loading-animation.gif' />                                           </div></div></div></div>")}function t(a,b){return a.w('<div id="ph_').f(b.getPath(!0,["DataCollection_dataCollectionGroupId"]),b,"h").w('" class="tab-pane fade"><div class="container-fluid"><div class="row"><div class="col-xs-12 col-md-12" id="__wf_').f(b.getPath(!0,["DataCollection_dataCollectionGroupId"]),b,"h").w("\"><img style='display:block;margin-left: auto;margin-right: auto;height:150px;width:150px;'src='../images/loading-animation.gif' />                                           </div></div></div></div>  ")}return a.register("mxdatacollectiongrid.template",b),b.__dustBody=!0,c.__dustBody=!0,d.__dustBody=!0,e.__dustBody=!0,f.__dustBody=!0,g.__dustBody=!0,h.__dustBody=!0,i.__dustBody=!0,j.__dustBody=!0,k.__dustBody=!0,l.__dustBody=!0,m.__dustBody=!0,n.__dustBody=!0,o.__dustBody=!0,p.__dustBody=!0,q.__dustBody=!0,r.__dustBody=!0,s.__dustBody=!0,t.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w('<br /><div class="container-fluid"><div class="row">     <div class="col-sm-2 col-md-4 " style=\'margin: 0 10px 10px 0;\'>    </div>        ').s(b.getPath(!0,["autoprocessing"]),b,{block:c},{}).s(b.getPath(!0,["screening"]),b,{block:l},{}).w('<div class="col-sm-2 col-md-1 " style=\'margin: 0 10px 10px 0;\'>                                <div class="dropup">').h("eq",b,{block:v},{key:b.getPath(!1,["workflows","length"]),value:0},"h").h("gt",b,{block:w},{key:b.getPath(!1,["workflows","length"]),value:0},"h").w("</div>                            </div><div class=\"col-sm-2 col-md-2 \" style='margin: 0 10px 10px 0;'> ").h("gt",b,{block:G},{key:b.get(["phasingStepLength"],!1),value:0},"h").w("</div></div>   </div>                                                                                                                             ")}function c(a,b){return a.w('<div class="col-sm-2 col-md-1 " style=\'margin: 0 10px 10px 0;\'>                                  <div class="dropup">').h("eq",b,{block:d},{key:b.getPath(!1,["items","length"]),value:0},"h").w("                        ").h("gt",b,{block:e},{key:b.getPath(!1,["items","length"]),value:0},"h").w("</div></div>")}function d(a,b){return a.w('<button class="btn btn-xs btn-warning dropdown-toggle" type="button" data-toggle="dropdown"><span class="glyphicon glyphicon-cog"></span>  Processing <span class="badge">').h("size",b,{},{key:b.get(["items"],!1)},"h").w('</span><span class="caret"></span></button>')}function e(a,b){return a.w('  <button class="btn btn-xs btn-success dropdown-toggle" type="button" data-toggle="dropdown"><span class="glyphicon glyphicon-cog"></span>  Processing <span class="badge">').h("size",b,{},{key:b.get(["items"],!1)},"h").w('</span><span class="caret"></span></button>  <ul class="dropdown-menu">').s(b.getPath(!0,[]),b,{block:f},{}).w(" ").s(b.getPath(!0,[]),b,{block:j},{}).w("  </ul>")}function f(a,b){return a.s(b.getPath(!0,["items"]),b,{block:g},{})}function g(a,b){return a.w("<li> ").h("eq",b,{block:h},{key:b.get(["status"],!1),value:"Success"},"h").h("ne",b,{block:i},{key:b.get(["status"],!1),value:"Success"},"h").w("</li> ")}function h(a,b){return a.w("  <div class='summary_datacollection_success'></div>").f(b.getPath(!0,["name"]),b,"h").w(" ")}function i(a,b){return a.w("  <div class='summary_datacollection_failed'></div>").f(b.getPath(!0,["name"]),b,"h").w(" ")}function j(a,b){return a.s(b.getPath(!0,["items","0"]),b,{block:k},{})}function k(a,b){return a.w('<li class="divider"></li><li >                                                                                                  <div class="btn-group btn-group-xs" style=\'margin:0 0 0 30px;\'>                                                                <a href="#/autoprocintegration/datacollection/').f(b.getPath(!0,["dataCollectionId"]),b,"h").w('/main" class="btn btn-default" role="button"> <span class="glyphicon glyphicon-eye-open"></span> Open</a><a href="#/autoprocintegration/datacollection/').f(b.getPath(!0,["dataCollectionId"]),b,"h").w('/files" style=\'margin:0 0 0 10px;\' class="btn btn-default" role="button"> <span class="glyphicon glyphicon-file">Files</span></a></div></li>  ')}function l(a,b){return a.w('<div class="col-sm-2 col-md-1 " style=\'margin: 0 10px 10px 0;\'>                                  <div class="dropup">').h("eq",b,{block:m},{key:b.getPath(!1,["items","length"]),value:0},"h").w("                        ").h("gt",b,{block:n},{key:b.getPath(!1,["items","length"]),value:0},"h").w("</div></div>")}function m(a,b){return a.w('<button class="btn btn-xs btn-warning dropdown-toggle" type="button" data-toggle="dropdown"><span class="glyphicon glyphicon-screenshot"></span> Characterization <span class="badge">').h("size",b,{},{key:b.get(["items"],!1)},"h").w('</span><span class="caret"></span></button>')}function n(a,b){return a.w("  ").h("eq",b,{block:o},{key:b.get(["status"],!1),value:"Success"},"h").w(" ").h("ne",b,{block:p},{key:b.get(["status"],!1),value:"Success"},"h").w('  <ul class="dropdown-menu">').s(b.getPath(!0,[]),b,{block:q},{}).w("    </ul>")}function o(a,b){return a.w('<button class="btn btn-xs btn-success dropdown-toggle" type="button" data-toggle="dropdown"><span class="glyphicon glyphicon-screenshot"></span> Characterization <span class="badge">').h("size",b,{},{key:b.get(["items"],!1)},"h").w('</span><span class="caret"></span></button>')}function p(a,b){return a.w('<button class="btn btn-xs btn-danger dropdown-toggle" type="button" data-toggle="dropdown"><span class="glyphicon glyphicon-screenshot"></span> Characterization <span class="badge">').h("size",b,{},{key:b.get(["items"],!1)},"h").w('</span><span class="caret"></span></button>')}function q(a,b){return a.s(b.getPath(!0,["items"]),b,{block:r},{}).w("                                                ")}function r(a,b){return a.w("<li> ").h("eq",b,{block:s},{key:b.get(["status"],!1),value:"Success"},"h").h("ne",b,{block:t},{key:b.get(["status"],!1),value:"Success"},"h").w("<table class=\"table\"  style='margin:0 0 20 0px;'>").s(b.getPath(!0,["items"]),b,{block:u},{}).w("</table>                                                                                                                 </li> ")}function s(a,b){return a.w("  <div class='summary_datacollection_success'></div>").f(b.getPath(!0,["name"]),b,"h").w(" ")}function t(a,b){return a.w("  <div class='summary_datacollection_failed'></div>").f(b.getPath(!0,["name"]),b,"h").w(" ")}function u(a,b){return a.w("<tr><td>").f(b.getPath(!0,["name"]),b,"h").w("</td><td>").f(b.getPath(!0,["value"]),b,"h").w("</td></tr>    ")}function v(a,b){return a.w('<button class="btn btn-xs btn-warning dropdown-toggle" type="button" data-toggle="dropdown"><span class="glyphicon glyphicon-sort-by-attributes"></span>Workflow <span class="badge">').h("size",b,{},{key:b.get(["workflows"],!1)},"h").w('</span><span class="caret"></span></button>')}function w(a,b){return a.w('<button class="btn btn-xs btn-success dropdown-toggle" type="button" data-toggle="dropdown"><span class="glyphicon glyphicon-sort-by-attributes"></span>Workflow <span class="badge">').h("size",b,{},{key:b.get(["workflows"],!1)},"h").w('</span><span class="caret"></span></button><ul class="dropdown-menu">').s(b.getPath(!0,["workflows"]),b,{block:x},{}).w(" ").s(b.getPath(!0,["workflows","0"]),b,{block:F},{}).w("  </ul>")}function x(a,b){return a.w(" ").s(b.getPath(!0,[]),b,{block:y},{}).w("  ")}function y(a,b){return a.h("eq",b,{block:z},{key:b.get(["status"],!1),value:"Success"},"h").w("                                                                                                                                                                                                                                                            ").h("ne",b,{block:C},{key:b.get(["status"],!1),value:"Success"},"h")}function z(a,b){return a.w("<li> ").h("eq",b,{block:A},{key:b.get(["status"],!1),value:"Success"},"h").h("ne",b,{block:B},{key:b.get(["status"],!1),value:"Success"},"h").w("</li>                                                                                       ")}function A(a,b){return a.w(" <img  src='").f(b.getPath(!0,["img"]),b,"h").w("' style='width:30px;height:30px;'/><div class='summary_datacollection_success'></div>").f(b.getPath(!0,["name"]),b,"h")}function B(a,b){return a.w(" <img src='").f(b.getPath(!0,["img"]),b,"h").w("' style='width:30px;height:30px;'/><div class='summary_datacollection_failed'></div>").f(b.getPath(!0,["name"]),b,"h")}function C(a,b){return a.w("<li>").h("eq",b,{block:D},{key:b.get(["status"],!1),value:"Success"},"h").h("ne",b,{block:E},{key:b.get(["status"],!1),value:"Success"},"h").w("</li>                                                                                       ")}function D(a,b){return a.w("<img  src='").f(b.getPath(!0,["img"]),b,"h").w("' style='width:30px;height:30px;'/><div class='summary_datacollection_success'></div> ").f(b.getPath(!0,["name"]),b,"h").w(" ")}function E(a,b){return a.w("<div class='summary_datacollection_failed'></div ").f(b.getPath(!0,["name"]),b,"h").w(" ")}function F(a,b){return a.w('<li class="divider"></li><li ><div class="btn-group btn-group-xs" style=\'margin:0 0 0 30px;\'><a href="#/mx/workflow/step/').f(b.getPath(!0,["workflowStepIds"]),b,"h").w('/main" class="btn btn-default" role="button"> <span class="glyphicon glyphicon-eye-open"></span>Open</a></div></li>  ')}function G(a,b){return a}return a.register("online.mxdatacollectiongrid.template",b),b.__dustBody=!0,c.__dustBody=!0,d.__dustBody=!0,e.__dustBody=!0,f.__dustBody=!0,g.__dustBody=!0,h.__dustBody=!0,i.__dustBody=!0,j.__dustBody=!0,k.__dustBody=!0,l.__dustBody=!0,m.__dustBody=!0,n.__dustBody=!0,o.__dustBody=!0,p.__dustBody=!0,q.__dustBody=!0,r.__dustBody=!0,s.__dustBody=!0,t.__dustBody=!0,u.__dustBody=!0,v.__dustBody=!0,w.__dustBody=!0,x.__dustBody=!0,y.__dustBody=!0,z.__dustBody=!0,A.__dustBody=!0,B.__dustBody=!0,C.__dustBody=!0,D.__dustBody=!0,E.__dustBody=!0,F.__dustBody=!0,G.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w("<div class=\"container-fluid containerWithScroll\"><div class=\"col-xs-6 col-md-6\"> <table class='table-sm table'>   <thead>   <tr> <th>Phasing</th><th><abbr title=\"Prepare Step\">PREPARE</abbr></th><th><abbr title=\"Substructure Determination Step\">SUBSTRUCTURE</abbr></th><th><abbr title=\"Phasing Step\">PHASING</abbr></th><th><abbr title=\"Model Building Step\">MODEL</abbr></th><th>Download</th><th style='color:gray'>Program</th><th style='color:gray'>Method</th><th style='color:gray'>Resolution</th><th style='color:gray'>Solvent</th><th style='color:gray'>Chain Count</th><th style='color:gray'>Residues Count</th><th style='color:gray'>Average Fragment Length</th><th style='color:gray'>CC of partial model</th><th style='color:gray'>CSV</th><th style='color:gray'>UglyMol</th></tr></thead>    <tbody>               ").s(b.getPath(!0,[]),b,{block:c},{}).w("</tbody></table></div></div>  </div>")}function c(a,b){return a.w("		              <tr>                              <td><a href='#/phasing/autoprocintegrationId/").f(b.getPath(!0,["autoProcIntegrationId"]),b,"h").w("/main'>").f(b.getPath(!0,["spaceGroup"]),b,"h").w("</a></td><td>").h("eq",b,{"else":d,block:e},{key:b.get(["prepare"],!1),type:"boolean",value:"true"},"h").w("</td><td>").h("eq",b,{"else":f,block:g},{key:b.get(["sub"],!1),type:"boolean",value:"true"},"h").w("</td>  <td> ").h("eq",b,{"else":h,block:i},{key:b.get(["phasing"],!1),type:"boolean",value:"true"},"h").w("</td><td> ").h("eq",b,{"else":j,block:k},{key:b.get(["model"],!1),type:"boolean",value:"true"},"h").w("</td><td ><a href='").f(b.getPath(!0,["downloadFilesUrl"]),b,"h").w("' ><span style='font-size: 1.5em;' class=\"glyphicon glyphicon-download \" ></span></a>                       </td> <td>").s(b.get(["metrics"],!1),b,{block:l},{}).w(" </td><td>").s(b.get(["metrics"],!1),b,{block:m},{}).w(" </td><td>").s(b.get(["metrics"],!1),b,{block:n},{}).w(" </td><td>").s(b.get(["metrics"],!1),b,{block:o},{}).w(" </td><td>").s(b.get(["metrics"],!1),b,{block:p},{}).w(" </td><td>").s(b.get(["metrics"],!1),b,{block:q},{}).w(" </td><td>").s(b.get(["metrics"],!1),b,{block:r},{}).w(" </td><td>").s(b.get(["metrics"],!1),b,{block:t},{}).w("</td><td><a href='").f(b.getPath(!0,["downloadCSV"]),b,"h").w("' ><span style='font-size: 1.5em;' class=\"glyphicon glyphicon-download \" ></span></a> </td><td>").s(b.get(["metrics"],!1),b,{block:v},{}).w(" </td></tr>")}function d(a,b){return a.w("<span style='color:red;' class=\"glyphicon glyphicon-remove\"></span>")}function e(a,b){return a.w("<span style='color:green;' class=\"glyphicon glyphicon-ok\"></span>")}function f(a,b){return a.w("<span style='color:red;' class=\"glyphicon glyphicon-remove\"></span>")}function g(a,b){return a.w("<span style='color:green;' class=\"glyphicon glyphicon-ok\"></span>")}function h(a,b){return a.w("<span style='color:red;' class=\"glyphicon glyphicon-remove\"></span>")}function i(a,b){return a.w("<span style='color:green;' class=\"glyphicon glyphicon-ok\"></span>")}function j(a,b){return a.w("<span style='color:red;' class=\"glyphicon glyphicon-remove\"></span>")}function k(a,b){return a.w("                           <span style='color:green;' class=\"glyphicon glyphicon-ok\"></span>                          ")}function l(a,b){return a.f(b.getPath(!0,["PhasingProgramRun_phasingPrograms"]),b,"h").w("<br />")}function m(a,b){return a.f(b.getPath(!0,["PhasingStep_method"]),b,"h").w("<br />")}function n(a,b){return a.f(b.getPath(!0,["PhasingStep_highRes"]),b,"h").w(" - ").f(b.getPath(!0,["PhasingStep_lowRes"]),b,"h").w("<br />")}function o(a,b){return a.f(b.getPath(!0,["PhasingStep_solventContent"]),b,"h").w("<br />")}function p(a,b){return a.f(b.getPath(!0,["Chain_Count"]),b,"h").w("<br />")}function q(a,b){return a.f(b.getPath(!0,["Residues_Count"]),b,"h").w("<br />")}function r(a,b){return a.h("decimal",b,{block:s},{key:"Average_Fragment_Length",decimals:2},"h").w(" <br /> ")}function s(a,b){return a}function t(a,b){return a.h("decimal",b,{block:u},{key:"CC_of_partial_model",decimals:2},"h").w(" <br /> ")}function u(a,b){return a}function v(a,b){return a.x(b.get(["uglymol"],!1),b,{"else":w,block:x},{}).w("<br />")}function w(a,b){return a}function x(a,b){return a.w('<a><a target="_blank" href=\'').f(b.getPath(!0,["uglymol"]),b,"h").w("' ><span style='font-size: 1em;' class=\"glyphicon glyphicon-eye-open\"  ></span></a> ")}return a.register("phasing.mxdatacollectiongrid.template",b),b.__dustBody=!0,c.__dustBody=!0,d.__dustBody=!0,e.__dustBody=!0,f.__dustBody=!0,g.__dustBody=!0,h.__dustBody=!0,i.__dustBody=!0,j.__dustBody=!0,k.__dustBody=!0,l.__dustBody=!0,m.__dustBody=!0,n.__dustBody=!0,o.__dustBody=!0,p.__dustBody=!0,q.__dustBody=!0,r.__dustBody=!0,s.__dustBody=!0,t.__dustBody=!0,u.__dustBody=!0,v.__dustBody=!0,w.__dustBody=!0,x.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w("<table class='table-sm table-condensed '><thead><tr><th  colspan=2 style='padding:0 15px 0 15px;'> </th></tr></thead><tbody><tr><td  style='padding:0 15px 0 15px;'>Container</td><td  style='padding:0 15px 0 15px;' class='column_parameter_value'>").f(b.get(["container_code"],!1),b,"h").w("</td></tr></tbody> </table>")}return a.register("plates.info.mxdatacollectiongrid.template",b),b.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w('<div class="container-fluid"><div class="row">').x(b.get(["containerIds"],!1),b,{"else":c,block:d},{}).w("</div></div>")}function c(a,b){return a.w("<p><b>There were no containers found</b></p>")}function d(a,b){return a.s(b.get(["containerIds"],!1),b,{block:e},{})}function e(a,b){return a.w('<div class="col-xs-3 col-md-').h("math",b,{},{key:"12",method:"divide",operand:f,style:"padding:3cm"},"h").w('"><div id="puck-panel-').f(b.getPath(!0,[]),b,"h").w('" style="padding-top:30px;">There were no containers found</div><div id="puck-panel-').f(b.getPath(!0,[]),b,"h").w('-info" ></div></div>')}function f(a,b){return a.f(b.get(["$len"],!1),b,"h")}return a.register("plates.mxdatacollectiongrid.template",b),b.__dustBody=!0,c.__dustBody=!0,d.__dustBody=!0,e.__dustBody=!0,f.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w("<div id='hoveringTooltipDiv' pointer-events='none' class='cell_info_tooltip'><b>Sample:</b> ").f(b.get(["sample_name"],!1),b,"h").w("<br/><b>Protein acronym:</b> ").f(b.get(["protein_acronym"],!1),b,"h").w("</div>")}return a.register("plates.tooltip.mxdatacollectiongrid.template",b),b.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w("<table class=\"table\"><tr><td>Protein</td><td  class='column_parameter_value'>").f(b.getPath(!0,["Protein_acronym"]),b,"h").w("</td></tr> <tr><td>Sample</td><td  class='column_parameter_value'>").f(b.getPath(!0,["BLSample_name"]),b,"h").w("</td></tr> <tr><td> Location </td><td  class='column_parameter_value'> ").f(b.getPath(!0,["BLSample_location"]),b,"h").w(" </td></tr> <tr><td> status</td><td  class='column_parameter_value'> ").f(b.getPath(!0,["BLSample_blSampleStatus"]),b,"h").w("</td></tr>                   <tr><td>Container</td><td  class='column_parameter_value'> ").f(b.getPath(!0,["Container_containerId"]),b,"h").w(" -- ").f(b.getPath(!0,["Container_containerType"]),b,"h").w(" - ").f(b.getPath(!0,["Container_capacity"]),b,"h").w("  </td></tr><tr><td>sampleChangerLocation</td><td  class='column_parameter_value'>").f(b.getPath(!0,["Container_sampleChangerLocation"]),b,"h").w("</td></tr><tr><td>Barcode</td><td  class='column_parameter_value'>").f(b.getPath(!0,["barCode"]),b,"h").w("</td></tr><tr><td>beamlineLocation</td><td  class='column_parameter_value'>").f(b.getPath(!0,["Container_beamlineLocation"]),b,"h").w("</td></tr></table>       ")}return a.register("sample.mxdatacollectiongrid.template",b),b.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w("<table class=\"table\">                    <tr><td>Type</td><td  class='column_parameter_value'> ").f(b.getPath(!0,["DataCollectionGroup_experimentType"]),b,"h").w("</td></tr><tr><td>Res. (corner)</td><td  class='column_parameter_value'>").f(b.getPath(!0,["DataCollection_resolution"]),b,"h").w(" &#8491; (").f(b.getPath(!0,["DataCollection_resolutionAtCorner"]),b,"h").w(" &#8491;)</td></tr><tr><td>Wavelength</td><td  class='column_parameter_value'>").f(b.getPath(!0,["DataCollection_wavelength"]),b,"h").w(" &#8491;</td></tr><tr><td>").f(b.getPath(!0,["DataCollection_rotationAxis"]),b,"h").w(" range</td><td  class='column_parameter_value'>").f(b.getPath(!0,["DataCollection_axisRange"]),b,"h").w(" &deg;</td></tr><tr><td>").f(b.getPath(!0,["DataCollection_rotationAxis"]),b,"h").w(" start (total)</td><td  class='column_parameter_value'>").f(b.getPath(!0,["DataCollection_axisEnd"]),b,"h").w("&deg; (").f(b.getPath(!0,["DataCollection_axisTotal"]),b,"h").w("&deg;)</td></tr><tr><td>Exposure Time</td><td  class='column_parameter_value'>").f(b.getPath(!0,["DataCollection_exposureTime"]),b,"h").w(" s</td></tr><tr><td>Flux end</td><td  class='column_parameter_value'>").f(b.getPath(!0,["DataCollection_flux_end"]),b,"h").w(" ph/sec</td></tr></table>")}return a.register("second.general.mxdatacollectiongrid.template",b),b.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w("<table class='table-sm table table-striped'><thead>   <tr><th  style='padding:0 15px 0 15px;'>").f(b.getPath(!0,["spaceGroup"]),b,"h").w("</th><th style='padding:0 15px 0 15px;'>Completeness</th><th style='padding:0 15px 0 15px;'>Res.</th><th style='padding:0 15px 0 15px;'>Rmerge</th>                    </tr></thead><tbody><tr><td  style='padding:0 15px 0 15px;'>Inner</td><td  style='padding:0 15px 0 15px;'>").h("gt",b,{block:c},{key:b.getPath(!1,["innerShell","completeness"]),value:20},"h").h("lte",b,{block:f},{key:b.getPath(!1,["innerShell","completeness"]),value:20},"h").w("</td><td style='padding:0 15px 0 15px;'>").f(b.getPath(!0,["innerShell","resolutionsLimitHigh"]),b,"h").w("</td><td style='padding:0 15px 0 15px;'>").f(b.getPath(!0,["innerShell","rMerge"]),b,"h").w("</td></tr><tr><td  style='padding:0 15px 0 15px;'>Outer</td><td  style='padding:0 15px 0 15px;'>").h("gt",b,{block:g},{key:b.getPath(!1,["outerShell","completeness"]),value:20},"h").h("lte",b,{block:j},{key:b.getPath(!1,["outerShell","completeness"]),value:20},"h").w("</td><td style='padding:0 15px 0 15px;'>").f(b.getPath(!0,["outerShell","resolutionsLimitHigh"]),b,"h").w("</td><td style='padding:0 15px 0 15px;'>").f(b.getPath(!0,["outerShell","rMerge"]),b,"h").w("</td></tr><tr><td  style='padding:0 15px 0 15px;'>Overall</td><td  style='padding:0 15px 0 15px;'>").h("gt",b,{block:k},{key:b.getPath(!1,["overall","completeness"]),value:20},"h").h("lte",b,{block:n},{key:b.getPath(!1,["overall","completeness"]),value:20},"h").w("</td><td style='padding:0 15px 0 15px;'>").f(b.getPath(!0,["overall","resolutionsLimitHigh"]),b,"h").w("</td><td style='padding:0 15px 0 15px;'>").f(b.getPath(!0,["overall","rMerge"]),b,"h").w("</td></tr></tbody></table>")}function c(a,b){return a.h("gt",b,{"else":d,block:e},{key:b.getPath(!1,["innerShell","completeness"]),value:70},"h")}function d(a,b){return a.w('<div  style="background-repeat: repeat-x;border:1px solid #f0ad4e;color:#fff;background-color:#f0ad4e;width:').f(b.getPath(!0,["innerShell","completeness"]),b,"h").w('%">').f(b.getPath(!0,["innerShell","completeness"]),b,"h").w("%</div>")}function e(a,b){return a.w('<div  style="background-repeat: repeat-x;border:1px solid gray;color:#fff;background-image:linear-gradient(to bottom,#337ab7 0,#286090 100%);width:').f(b.getPath(!0,["innerShell","completeness"]),b,"h").w('%">').f(b.getPath(!0,["innerShell","completeness"]),b,"h").w("%</div>")}function f(a,b){return a.w('<div  style="background-repeat: repeat-x;border:1px solid #d9534f;color:#fff;background-color:#d9534f;width:').f(b.getPath(!0,["innerShell","completeness"]),b,"h").w('%">').f(b.getPath(!0,["innerShell","completeness"]),b,"h").w("%</div>");
}function g(a,b){return a.h("gt",b,{"else":h,block:i},{key:b.getPath(!1,["outerShell","completeness"]),value:70},"h")}function h(a,b){return a.w('<div  style="background-repeat: repeat-x;border:1px solid #f0ad4e;color:#fff;background-color:#f0ad4e;width:').f(b.getPath(!0,["outerShell","completeness"]),b,"h").w('%">').f(b.getPath(!0,["outerShell","completeness"]),b,"h").w("%</div>")}function i(a,b){return a.w('<div  style="background-repeat: repeat-x;border:1px solid gray;color:#fff;background-image:linear-gradient(to bottom,#337ab7 0,#286090 100%);width:').f(b.getPath(!0,["outerShell","completeness"]),b,"h").w('%">').f(b.getPath(!0,["outerShell","completeness"]),b,"h").w("%</div>")}function j(a,b){return a.w('<div  style="background-repeat: repeat-x;border:1px solid #d9534f;color:#fff;background-color:#d9534f;width:').f(b.getPath(!0,["outerShell","completeness"]),b,"h").w('%">').f(b.getPath(!0,["outerShell","completeness"]),b,"h").w("%</div>")}function k(a,b){return a.h("gt",b,{"else":l,block:m},{key:b.getPath(!1,["overall","completeness"]),value:70},"h")}function l(a,b){return a.w('<div  style="background-repeat: repeat-x;border:1px solid #f0ad4e;color:#fff;background-color:#f0ad4e;width:').f(b.getPath(!0,["overall","completeness"]),b,"h").w('%">').f(b.getPath(!0,["overall","completeness"]),b,"h").w("%</div>")}function m(a,b){return a.w('<div  style="background-repeat: repeat-x;border:1px solid gray;color:#fff;background-image:linear-gradient(to bottom,#337ab7 0,#286090 100%);width:').f(b.getPath(!0,["overall","completeness"]),b,"h").w('%">').f(b.getPath(!0,["outerShell","completeness"]),b,"h").w("%</div>")}function n(a,b){return a.w('<div  style="background-repeat: repeat-x;border:1px solid #d9534f;color:#fff;background-color:#d9534f;width:').f(b.getPath(!0,["overall","completeness"]),b,"h").w('%">').f(b.getPath(!0,["overall","completeness"]),b,"h").w("%</div>")}return a.register("sm.completeness.autoproc.mxdatacollectiongrid.template",b),b.__dustBody=!0,c.__dustBody=!0,d.__dustBody=!0,e.__dustBody=!0,f.__dustBody=!0,g.__dustBody=!0,h.__dustBody=!0,i.__dustBody=!0,j.__dustBody=!0,k.__dustBody=!0,l.__dustBody=!0,m.__dustBody=!0,n.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w("   <table class='table-sm table table-striped'><thead>   <tr><th  style='padding:0 15px 0 15px;'>cell A</th><th style='padding:0 15px 0 15px;'>cell B</th><th style='padding:0 15px 0 15px;'>cell C</th></tr></thead><tbody><tr><td  style='padding:0 15px 0 15px;'>").f(b.getPath(!0,["overall","cell_a"]),b,"h").w("</td><td style='padding:0 15px 0 15px;'>").f(b.getPath(!0,["overall","cell_b"]),b,"h").w("</td><td style='padding:0 15px 0 15px;'>").f(b.getPath(!0,["overall","cell_c"]),b,"h").w("</td></tr><tr><th  style='padding:0 15px 0 15px;'>Alpha</th><th style='padding:0 15px 0 15px;'>Beta</th><th style='padding:0 15px 0 15px;'>Gamma</th></tr><tr><td  style='padding:0 15px 0 15px;'>").f(b.getPath(!0,["overall","cell_alpha"]),b,"h").w("</td><td style='padding:0 15px 0 15px;'>").f(b.getPath(!0,["overall","cell_beta"]),b,"h").w("</td><td style='padding:0 15px 0 15px;'>").f(b.getPath(!0,["overall","cell_gamma"]),b,"h").w("</td></tr></tbody></table>")}return a.register("unitcell.autoproc.mxdatacollectiongrid.template",b),b.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w("   <table class='table-sm table table-striped'><thead>   <tr><th  style='padding:0 15px 0 15px;'>cell A</th><th style='padding:0 15px 0 15px;'>cell B</th><th style='padding:0 15px 0 15px;'>cell C</th></tr></thead><tbody><tr><td  style='padding:0 15px 0 15px;'>").f(b.getPath(!0,["ScreeningOutputLattice_unitCell_a"]),b,"h").w("</td><td style='padding:0 15px 0 15px;'>").f(b.getPath(!0,["ScreeningOutputLattice_unitCell_b"]),b,"h").w("</td><td style='padding:0 15px 0 15px;'>").f(b.getPath(!0,["ScreeningOutputLattice_unitCell_c"]),b,"h").w("</td></tr><tr><th  style='padding:0 15px 0 15px;'>Alpha</th><th style='padding:0 15px 0 15px;'>Beta</th><th style='padding:0 15px 0 15px;'>Gamma</th></tr><tr><td  style='padding:0 15px 0 15px;'>").f(b.getPath(!0,["ScreeningOutputLattice_unitCell_alpha"]),b,"h").w("</td><td style='padding:0 15px 0 15px;'>").f(b.getPath(!0,["ScreeningOutputLattice_unitCell_beta"]),b,"h").w("</td><td style='padding:0 15px 0 15px;'>").f(b.getPath(!0,["ScreeningOutputLattice_unitCell_gamma"]),b,"h").w("</td></tr></tbody></table>")}return a.register("unitcell.screening.mxdatacollectiongrid.template",b),b.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w('<div class="container-fluid containerWithScroll"><div class="row"><div class="col-xs-12 col-md-2"><table class="table table-striped table-hover"><thead><tr>').s(b.getPath(!0,[]),b,{block:c},{}).w("</tr></thead><tr>").s(b.getPath(!0,[]),b,{block:d},{}).w("</tr></tr><tr>").s(b.getPath(!0,[]),b,{block:e},{}).w("</tr></table></div></div></div>")}function c(a,b){return a.w('<th> <a href="#/mx/workflow/step/').f(b.getPath(!0,["workflowStepIds"]),b,"h").w('/main" >').f(b.getPath(!0,["name"]),b,"h").w("</a></th>                 ")}function d(a,b){return a.w('<td  ><a href="#/mx/workflow/step/').f(b.getPath(!0,["workflowStepIds"]),b,"h").w("/main\" ><img style='height:150px;width:150px;' src='").f(b.getPath(!0,["img"]),b,"h").w("' /></a></td>")}function e(a,b){return a.w("<td  >").f(b.getPath(!0,["status"]),b,"h").w("</td>")}return a.register("workflows.mxdatacollectiongrid.template",b),b.__dustBody=!0,c.__dustBody=!0,d.__dustBody=!0,e.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w('<div class="container-fluid"><div class="panel with-nav-tabs panel-default"><div class="panel-heading clearfix"><div class="pull-left"><h1 class="panel-title" style=\'color:#337ab7;\'><span style=\'font-size:12px;\'>   ').f(b.getPath(!0,["startTime"]),b,"h").w('</span></h1></div><div class="pull-right"><ul class="nav nav-tabs"><li class="active"><a data-toggle="tab" href="#datacollection_').f(b.get(["DataCollection_dataCollectionId"],!1),b,"h").w('">Summary </a></li></ul></div></div><br /><div class="tab-content"><div id="datacollection_').f(b.get(["DataCollection_dataCollectionId"],!1),b,"h").w('" class="tab-pane fade in active"><div class="container-fluid"><div class="row"><div class="col-xs-1 col-md-1"><div class="well" style=\'font-size:30px;\'>').f(b.getPath(!0,["element"]),b,"h").w('</div></div><div class="col-xs-3 col-md-3"><table class="table table-condensed"><tr><td>Start Time</td><td class=\'column_parameter_value\'>').f(b.getPath(!0,["startTime"]),b,"h").w("</td></tr><tr><td>Protein</td><td class='column_parameter_value'>").f(b.getPath(!0,["acronym"]),b,"h").w("</td></tr><tr><td>Sample</td><td class='column_parameter_value'>").f(b.getPath(!0,["name"]),b,"h").w("</td></tr><tr><td>Fluorescence Detector</td><td class='column_parameter_value'>").f(b.getPath(!0,["fluorescenceDetector"]),b,"h").w("</td></tr><tr><td style='width:150px;'>Energy Scan Range</td><td class='column_parameter_value'>").f(b.getPath(!0,["startEnergy"]),b,"h").w(" kev - ").f(b.getPath(!0,["endEnergy"]),b,"h").w(" kev</td></tr><tr><td>Edge Energy (theoretical)</td><td class='column_parameter_value'>").f(b.getPath(!0,["edgeEnergy"]),b,"h").w(" kev</td></tr><tr><td>Flux @100%</td><td class='column_parameter_value'>").f(b.getPath(!0,["flux"]),b,"h").w(" ph/sec</td></tr><tr><td>Transmission</td><td class='column_parameter_value'>").f(b.getPath(!0,["transmissionFactor"]),b,"h").w(" %</td></tr><tr><td style='width:150px;'>Beam Size Hor</td><td class='column_parameter_value'>").f(b.getPath(!0,["beamSizeHorizontal"]),b,"h").w(" micrometer</td></tr><tr><td>Beam Size Vert</td><td class='column_parameter_value'>").f(b.getPath(!0,["beamSizeVertical"]),b,"h").w(" micrometer</td></tr><tr><td>Exposure Time</td><td class='column_parameter_value'>").f(b.getPath(!0,["exposureTime"]),b,"h").w(" sec</td></tr><tr><td>Filename</td><td class='column_parameter_value'>").f(b.getPath(!0,["filename"]),b,"h").w('</td></tr></table></div><div class="col-xs-3 col-md-3"><table class="table table-condensed"><tr><td >Peak Energy</td><td class=\'column_parameter_value\'>').f(b.getPath(!0,["peakEnergy"]),b,"h").w(" kev</td></tr><tr><td >Pk f'</td><td class='column_parameter_value'>").f(b.getPath(!0,["peakFPrime"]),b,"h").w(" e</td></tr><tr><td >Pk f''</td><td class='column_parameter_value'>").f(b.getPath(!0,["peakFDoublePrime"]),b,"h").w(" e</td></tr><tr><td >Inflection Energy</td><td class='column_parameter_value'>").f(b.getPath(!0,["inflectionEnergy"]),b,"h").w(" kev</td></tr><tr><td >Ip f'</td><td class='column_parameter_value'>").f(b.getPath(!0,["inflectionFPrime"]),b,"h").w(" e </td></tr><tr><td >Ip f''</td><td class='column_parameter_value'>").f(b.getPath(!0,["inflectionFDoublePrime"]),b,"h").w(' e </td></tr></table></div><div class="col-xs-3 col-md-3"><a href=\'').f(b.getPath(!0,["choochURL"]),b,"h").w("' data-lightbox='").f(b.getPath(!0,["choochURL"]),b,"h").w('\' data-title="Chooch"><img class="lazy"  data-src=\'').f(b.getPath(!0,["choochURL"]),b,"h").w("' src='").f(b.getPath(!0,["choochURL"]),b,"h").w("' /> </a></div></div></div></div></div></div></div>")}return a.register("energyscangrid.template",b),b.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w('<div id="container"><div style=\'float:left;\' id="left"><img class="titleImage" src="../images/logo_EXI.jpg" /><span class="title">ExiMX<span class="subtitle">Extended ISPyB for MX<sub style="font-size:10px;color:orange">BETA</sub></span></span></div><div id="center"></div><div style=\'float:right;width:120px;\' id="logos"><img class="logoImage" src="../images/logo_EMBL.png" /><img class="logoImage" src="../images/logo_ESRF.png" /></div><div style=\'float:right;width:120px;\' id="right"><div style=\'color:white;font-size:10px; \'>Version: ').f(b.getPath(!0,["version"]),b,"h").w("</div><div style='color:white;font-size:10px; '>Released: ").f(b.getPath(!0,["release_date"]),b,"h").w("</div><div style='color:white;font-size:10px;'>").f(b.getPath(!0,["database"]),b,"h").w("</div></div></div>")}return a.register("mxheader",b),b.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w('<div id="Viewer" style="position: absolute; left:0px; top:0px;"></div><div class="centeredControls" id="loadControls"><form action="javascript:requestFromServer();" id="pdbIdFetch"><div class="controlItem" id="pdbFetch">Load PDB ID: <input type="text" id="pdbIdInput" style="width:50px;" /><input type="submit" style="display:none" /></div></form></div><div class="controlButton" id="loadControlsButton"><div class="controlMargin" id="loadControlsBtnMargin"><div class="controlItem" id="loadControlsShow">Load structure...</div></div></div>')}return a.register("electron.density.viewer.template",b),b.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w("<div><table  style='border:1px solid #FAFAFA;'>").s(b.getPath(!0,[]),b,{block:c},{}).w("       </table></div>")}function c(a,b){return a.w("	<tr><td class='summary_datacollection_parameter_name'>Space Group</td><td class='summary_datacollection_parameter'>").f(b.getPath(!0,["spaceGroupShortName"]),b,"h").w(" (").f(b.getPath(!0,["spaceGroup"]),b,"h").w(")</td></tr> <tr><td class='summary_datacollection_parameter_name'>Type</td><td class='summary_datacollection_parameter'>").f(b.getPath(!0,["phasingStepType"]),b,"h").w("</td></tr> <tr><td class='summary_datacollection_parameter_name'>Program</td><td class='summary_datacollection_parameter'>").f(b.getPath(!0,["phasingPrograms"]),b,"h").w("</td></tr>     <tr><td class='summary_datacollection_parameter_name'>Resolution</td><td class='summary_datacollection_parameter'>").f(b.getPath(!0,["lowRes"]),b,"h").w(" - ").f(b.getPath(!0,["highRes"]),b,"h").w("</td></tr>  <tr>  <td class='summary_datacollection_parameter_name'>StartTime</td><td class='summary_datacollection_parameter'>").f(b.getPath(!0,["phasingStartTime"]),b,"h").w("</td></tr>  <tr>  <td class='summary_datacollection_parameter_name'>Protein</td><td class='summary_datacollection_parameter'>").f(b.getPath(!0,["acronym"]),b,"h").w("</td></tr>                         ")}return a.register("phasinggrid.prepare",b),b.__dustBody=!0,c.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w("<div><table>").s(b.getPath(!0,["0"]),b,{block:c},{}).w("  ").s(b.getPath(!0,[]),b,{block:d},{}).w("       </table></div>")}function c(a,b){return a.w("<tr><th class=\"datacollection_parameter_name\" style='width:70px;'>Resolution</th><th class=\"datacollection_parameter_name\" style='width:70px;'>Method</th><th class=\"datacollection_parameter_name\" style='width:70px;'>Enantiomorph</th><th  class=\"datacollection_parameter_name\"style='width:70px;'>SpaceGroup</th><th class=\"datacollection_parameter_name\" style='width:70px;'>Solvent</th><th class=\"datacollection_parameter_name\" style='width:120px;'>Statistics</th>            </tr>  ")}function d(a,b){return a.w("	    <tr  class='selectable_row'><td>").f(b.getPath(!0,["lowRes"]),b,"h").w(" - ").f(b.getPath(!0,["highRes"]),b,"h").w("</td><td>").f(b.getPath(!0,["method"]),b,"h").w("</td><td>").f(b.getPath(!0,["enantiomorph"]),b,"h").w("</td><td>").f(b.getPath(!0,["spaceGroup"]),b,"h").w(" (").f(b.getPath(!0,["spaceGroupShortName"]),b,"h").w(")</td><td>").f(b.getPath(!0,["solventContent"]),b,"h").w("</td><td><table>").s(b.getPath(!0,["statistics"]),b,{block:e},{}).w("</table>  </td></tr>  ")}function e(a,b){return a.w("<tr><td>").f(b.getPath(!0,["name"]),b,"h").w("</td><td>").f(b.getPath(!0,["value"]),b,"h").w("</td><tr>")}return a.register("phasinggrid.stats",b),b.__dustBody=!0,c.__dustBody=!0,d.__dustBody=!0,e.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w("<div><table>").s(b.getPath(!0,["0"]),b,{block:c},{}).w(" ").s(b.getPath(!0,[]),b,{block:d},{}).w("       </table></div>")}function c(a,b){return a.w("<tr><th class=\"datacollection_parameter_name\" style='width:70px;'>Type</th><th class=\"datacollection_parameter_name\" style='width:70px;'>Program</th><th class=\"datacollection_parameter_name\" style='width:70px;'>Resolution</th><th  class=\"datacollection_parameter_name\"style='width:70px;'>Method</th></tr>  ")}function d(a,b){return a.w("	<tr class='selectable_row'><td class='summary_datacollection_parameter'>").f(b.getPath(!0,["phasingStepType"]),b,"h").w("</td>        <td class='summary_datacollection_parameter'>").f(b.getPath(!0,["phasingPrograms"]),b,"h").w("</td><td class='summary_datacollection_parameter'>").f(b.getPath(!0,["lowRes"]),b,"h").w(" - ").f(b.getPath(!0,["highRes"]),b,"h").w("</td><td class='summary_datacollection_parameter'>").f(b.getPath(!0,["method"]),b,"h").w("</td></tr> ")}return a.register("phasinggrid.substructure",b),b.__dustBody=!0,c.__dustBody=!0,d.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.s(b.get(["prepare"],!1),b,{block:c},{}).w("<br />").s(b.get(["prepare"],!1),b,{block:d},{}).w("<br />").s(b.get(["substructure"],!1),b,{block:h},{}).w("<br />").s(b.get(["phasing"],!1),b,{block:n},{}).w("<br />").s(b.get(["models"],!1),b,{block:v},{}).w("<br /><br />")}function c(a,b){return a.w("<span style='font-size:12px;'>").f(b.getPath(!0,["spaceGroup"]),b,"h").w(" (").f(b.getPath(!0,["spaceGroupShortName"]),b,"h").w(")</span>  ")}function d(a,b){return a.h("eq",b,{block:e},{key:b.get(["status"],!1),value:"Success"},"h").h("eq",b,{block:f},{key:b.get(["status"],!1),value:"Failure"},"h").h("eq",b,{block:g},{key:b.get(["status"],!1),value:"Not found"},"h").f(b.getPath(!0,["type"]),b,"h")}function e(a,b){return a.w("<div class='summary_datacollection_success'></div>")}function f(a,b){return a.w("<div class='summary_datacollection_failed'></div>")}function g(a,b){return a.w("<div class='summary_datacollection_noFound'></div>")}function h(a,b){return a.h("eq",b,{block:i},{key:b.get(["status"],!1),value:"Success"},"h").h("eq",b,{block:j},{key:b.get(["status"],!1),value:"Failure"},"h").h("eq",b,{block:k},{key:b.get(["status"],!1),value:"Not found"},"h").h("gt",b,{block:l},{key:b.get(["runs"],!1),value:0},"h").h("eq",b,{block:m},{key:b.get(["runs"],!1),value:0},"h")}function i(a,b){return a.w("<div class='summary_datacollection_success'></div>")}function j(a,b){return a.w("<div class='summary_datacollection_failed'></div>")}function k(a,b){return a.w("<div class='summary_datacollection_noFound'></div>")}function l(a,b){return a.w(" ").f(b.getPath(!0,["type"]),b,"h").w("  <span style='color:gray;font-size:10px'>(").f(b.getPath(!0,["runs"]),b,"h").w(" runs)</span> ")}function m(a,b){return a.w(" <span style='color:gray;font-size:10px'> ").f(b.getPath(!0,["type"]),b,"h").w(" (").f(b.getPath(!0,["runs"]),b,"h").w(" runs)</span> ")}function n(a,b){return a.h("eq",b,{block:o},{key:b.get(["status"],!1),value:"Success"},"h").h("eq",b,{block:p},{key:b.get(["status"],!1),value:"Failure"},"h").h("eq",b,{block:q},{key:b.get(["status"],!1),value:"Not found"},"h").h("gt",b,{block:r},{key:b.get(["runs"],!1),value:0},"h").h("eq",b,{block:s},{key:b.get(["runs"],!1),value:0},"h").h("gt",b,{block:t},{key:b.get(["runs"],!1),value:0},"h")}function o(a,b){return a.w("<div class='summary_datacollection_success'></div>")}function p(a,b){return a.w("<div class='summary_datacollection_failed'></div>")}function q(a,b){return a.w("<div class='summary_datacollection_noFound'></div>")}function r(a,b){return a.w(" ").f(b.getPath(!0,["type"]),b,"h").w("  <span style='color:gray;font-size:10px'>(").f(b.getPath(!0,["runs"]),b,"h").w(" runs)</span> ")}function s(a,b){return a.w(" <span style='color:gray;font-size:10px'> ").f(b.getPath(!0,["type"]),b,"h").w(" (").f(b.getPath(!0,["runs"]),b,"h").w(" runs)</span> ")}function t(a,b){return a.w("   ").s(b.get(["stats"],!1),b,{block:u},{})}function u(a,b){return a.w("<table style='margin-left:30px;'><tr><td> ").f(b.getPath(!0,["successCondition"]),b,"h").w(" runs with successful stats</td></tr><tr><td> ").f(b.getPath(!0,["withStatistics"]),b,"h").w(" runs with statistics</td></tr><tr><td> ").f(b.getPath(!0,["withoutStatistics"]),b,"h").w(" runs with no statistics</td></tr></table>")}function v(a,b){return a.h("eq",b,{block:w},{key:b.get(["status"],!1),value:"Success"},"h").h("eq",b,{block:x},{key:b.get(["status"],!1),value:"Failure"},"h").h("eq",b,{block:y},{key:b.get(["status"],!1),value:"Not found"},"h").h("gt",b,{block:z},{key:b.get(["runs"],!1),value:0},"h").h("eq",b,{block:A},{key:b.get(["runs"],!1),value:0},"h")}function w(a,b){return a.w("<div class='summary_datacollection_success'></div>")}function x(a,b){return a.w("<div class='summary_datacollection_failed'></div>")}function y(a,b){return a.w("<div class='summary_datacollection_noFound'></div>")}function z(a,b){return a.w(" ").f(b.getPath(!0,["type"]),b,"h").w("  <span style='color:gray;font-size:10px'>(").f(b.getPath(!0,["runs"]),b,"h").w(" runs)</span> ")}function A(a,b){return a.w(" <span style='color:gray;font-size:10px'> ").f(b.getPath(!0,["type"]),b,"h").w(" (").f(b.getPath(!0,["runs"]),b,"h").w(" runs)</span> ")}return a.register("phasinglistview",b),b.__dustBody=!0,c.__dustBody=!0,d.__dustBody=!0,e.__dustBody=!0,f.__dustBody=!0,g.__dustBody=!0,h.__dustBody=!0,i.__dustBody=!0,j.__dustBody=!0,k.__dustBody=!0,l.__dustBody=!0,m.__dustBody=!0,n.__dustBody=!0,o.__dustBody=!0,p.__dustBody=!0,q.__dustBody=!0,r.__dustBody=!0,s.__dustBody=!0,t.__dustBody=!0,u.__dustBody=!0,v.__dustBody=!0,w.__dustBody=!0,x.__dustBody=!0,y.__dustBody=!0,z.__dustBody=!0,A.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w('<div class="container"><div class="row"><div class="col-xs-6 col-md-6"><div id="previous-button-div" class="previous-button-div"><button id="previous-button" class="btn btn-lg btn-success" type="button"><i class="icon-next"></i> Previous</button></div> </div><div class="col-xs-6 col-md-6"><div id="next-button-div" class="next-button-div"><button id="next-button" class="btn btn-lg btn-success"type="button"><i class="icon-next"></i> Next</button></div></div></div></div>')}return a.register("buttons.prepare.template",b),b.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w('<div class="container-fluid">').s(b.get(["pucks"],!1),b,{block:c},{}).w("</div>")}function c(a,b){return a.w("<div class=\"row\"><div class=\"col-xs-6 col-md-6\"><table class='table-sm table-condensed '><tbody><tr><td  style='padding:0 15px 0 15px;'>Container Code:</td><td  style='padding:0 15px 0 15px;' class='column_parameter_value'>").f(b.getPath(!0,["containerCode"]),b,"h").w("</td></tr><tr><td  style='padding:0 15px 0 15px;'>Container Id:</td><td  style='padding:0 15px 0 15px;' class='column_parameter_value'>").f(b.getPath(!0,["containerId"]),b,"h").w("</td></tr><tr><td  style='padding:0 15px 0 15px;'>Sample Changer Location:</td><td  style='padding:0 15px 0 15px;' class='column_parameter_value'>").f(b.getPath(!0,["sampleChangerLocation"]),b,"h").w("</td></tr></tbody></table></div><div class=\"col-xs-6 col-md-6\"><table class='table-sm table-condensed '><thead><tr><th  colspan=2 style='padding:0 15px 0 15px;'> </th></tr></thead><tbody>").s(b.getPath(!0,["cells"]),b,{block:d},{}).w("</tbody></table></div></div><hr>")}function d(a,b){return a.h("ne",b,{block:e},{key:f,value:"EMPTY"},"h")}function e(a,b){return a.w("<tr><td  style='padding:0 15px 0 15px;'>Location:</td><td  style='padding:0 15px 0 15px;' class='column_parameter_value'>").f(b.getPath(!0,["location"]),b,"h").w("</td></tr><tr><td  style='padding:0 15px 0 15px;'>Sample name:</td><td  style='padding:0 15px 0 15px;' class='column_parameter_value'>").f(b.getPath(!0,["sample_name"]),b,"h").w("</td></tr>")}function f(a,b){return a.f(b.getPath(!0,["state"]),b,"h")}return a.register("confirm.table.prepare.template",b),b.__dustBody=!0,c.__dustBody=!0,d.__dustBody=!0,e.__dustBody=!0,f.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w('<div class="steps-container"><div class="container"><div class="row"><div class="stepwizard"><div class="stepwizard-row"><div class="stepwizard-step"><a id="step-1" class="btn btn-default btn-circle step-btn" >1</a><p>Select Shipment</p></div><div class="stepwizard-step"><a id="step-2" class="btn btn-default btn-circle step-btn" >2</a><p>Select Sample Changer</p></div><div class="stepwizard-step"><a id="step-3" class="btn btn-default btn-circle step-btn" >3</a><p>Load Sample Changer</p></div></div></div></div></div></div>')}return a.register("toolbar.prepare.template",b),b.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w("Code : ").f(b.getPath(!0,["Container_code"]),b,"h").w("<br />Type: ").f(b.getPath(!0,["Container_containerType"]),b,"h").w("<br />Status : ").f(b.getPath(!0,["Dewar_dewarStatus"]),b,"h").w("<br />Beamline : ").f(b.getPath(!0,["Container_beamlineLocation"]),b,"h").w("<br />Date: ").f(b.getPath(!0,["Shipping_bltimeStamp"]),b,"h")}return a.register("puck.listview",b),b.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w('<div class="container-fluid"><div class="row"><div style=\'font-size:10px;text-align:center;\' class="col-sm-2 col-md-1 " style=\'margin: 0 10px 0px 0;\'><a href=\'#/mx/datacollection/session/').f(b.getPath(!0,["sessionId"]),b,"h").w('/main\' title=\'click to go\' type="button" class="btn btn-link">').f(b.getPath(!0,["month"]),b,"h").w(" ").f(b.getPath(!0,["day"]),b,"h").w(" ").f(b.getPath(!0,["year"]),b,"h").w("</a><br />").f(b.getPath(!0,["beamLineName"]),b,"h").w("<br />").f(b.getPath(!0,["beamLineOperator"]),b,"h").w("</div><div style='font-size:14px;text-align:center;' class=\"col-sm-2 col-md-1\" ><a href='#/mx/datacollection/session/").f(b.getPath(!0,["sessionId"]),b,"h").w("/main'   title=\"").f(b.getPath(!0,["Proposal_title"]),b,"h").w('" class="btn btn-link">').f(b.getPath(!0,["Proposal_proposalCode"]),b,"h").f(b.getPath(!0,["Proposal_ProposalNumber"]),b,"h").w("</a><br />").f(b.getPath(!0,["nbShifts"]),b,"h").w(' shifts     </div><div class="col-sm-1"  style=\'margin: 10px 10px 0px 0;\'><!-- List group --><ul class="list-group">').h("gt",b,{block:c},{key:b.get(["sampleCount"],!1),value:0},"h").w('</ul></div><div class="col-sm-1"  style=\'margin: 10px 10px 0px 0;\'><!-- List group --><ul class="list-group">').h("gt",b,{block:d},{key:b.get(["testDataCollectionGroupCount"],!1),value:0},"h").w('</ul></div><div class="col-sm-1"  style=\'margin: 10px 10px 0px 0;\'><!-- List group --><ul class="list-group">').h("gt",b,{block:e},{key:b.get(["dataCollectionGroupCount"],!1),value:0},"h").w('</ul></div><div class="col-sm-1"  style=\'margin: 10px 10px 0px 0;\'><!-- List group --><ul class="list-group">').h("gt",b,{block:f},{key:b.get(["xrfSpectrumCount"],!1),value:0},"h").w('</ul></div><div class="col-sm-1"  style=\'margin: 10px 10px 0px 0;\'><!-- List group --><ul class="list-group">        ').h("gt",b,{block:g},{key:b.get(["energyScanCount"],!1),value:0},"h").w("        </ul></div><div class=\"col-sm-3\"  style='margin: 10px 10px 0px 0;'>").f(b.getPath(!0,["comments"]),b,"h").w("</div></div></div>")}function c(a,b){return a.w('<li class="list-group-item"><span style=\'background-color:#337ab7;\' class="badge badge-primary">').f(b.getPath(!0,["sampleCount"]),b,"h").w("</span>Samples</li>")}function d(a,b){return a.w('<li class="list-group-item"><span style=\'background-color:#337ab7;\' class="badge">').f(b.getPath(!0,["testDataCollectionGroupCount"]),b,"h").w("</span>Tests</li>")}function e(a,b){return a.w('<li class="list-group-item"><span style=\'background-color:#337ab7;\' class="badge">').f(b.getPath(!0,["dataCollectionGroupCount"]),b,"h").w("</span>Collect.</li>")}function f(a,b){return a.w('<li class="list-group-item"><span style=\'background-color:#337ab7;\' class="badge">').f(b.getPath(!0,["xrfSpectrumCount"]),b,"h").w("</span>XRF</li>")}function g(a,b){return a.w('<li class="list-group-item"><span style=\'background-color:#337ab7;\' class="badge">').f(b.getPath(!0,["energyScanCount"]),b,"h").w("</span>En. Scans</li>")}return a.register("session.grid",b),b.__dustBody=!0,c.__dustBody=!0,d.__dustBody=!0,e.__dustBody=!0,f.__dustBody=!0,g.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w("<table><tr><td  class='summary_datacollection_parameter_name'>Space Group</td><td class='summary_datacollection_parameter'>").f(b.getPath(!0,["spaceGroupShortName"]),b,"h").w(" (").f(b.getPath(!0,["spaceGroup"]),b,"h").w(")</td></tr><tr><td  class='summary_datacollection_parameter_name'>Type</td><td class='summary_datacollection_parameter'>").f(b.getPath(!0,["phasingStepType"]),b,"h").w(" (").f(b.getPath(!0,["phasingPrograms"]),b,"h").w(")</td></tr><tr><td  class='summary_datacollection_parameter_name'>Method</td><td class='summary_datacollection_parameter'>").f(b.getPath(!0,["method"]),b,"h").w("</td></tr><tr><td  class='summary_datacollection_parameter_name'>Resolution</td><td class='summary_datacollection_parameter'>").f(b.getPath(!0,["lowRes"]),b,"h").w(" - ").f(b.getPath(!0,["highRes"]),b,"h").w("</td></tr><tr><td  class='summary_datacollection_parameter_name'>Protein</td><td class='summary_datacollection_parameter'>").f(b.getPath(!0,["acronym"]),b,"h").w("</td></tr><tr><td  class='summary_datacollection_parameter_name'>Start Time</td><td class='summary_datacollection_parameter'>").f(b.getPath(!0,["phasingStartTime"]),b,"h").w("</td></tr><tr><td  class='summary_datacollection_parameter_name'>End Time</td><td class='summary_datacollection_parameter'>").f(b.getPath(!0,["phasingEndTime"]),b,"h").w("</td></tr></table>")}return a.register("summaryphasinggrid.first.step",b),b.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.h("eq",b,{block:c},{key:b.get(["type"],!1),value:"images"},"h").h("eq",b,{block:e},{key:b.get(["type"],!1),value:"image"},"h").h("eq",b,{block:f},{key:b.get(["type"],!1),value:"logFile"},"h").h("eq",b,{block:g},{key:b.get(["type"],!1),value:"title"},"h").h("eq",b,{block:h},{key:b.get(["type"],!1),value:"info"},"h").h("eq",b,{block:i},{key:b.get(["type"],!1),value:"table"},"h").w("  ")}function c(a,b){return a.w('<table align="center"><tr>').s(b.get(["items"],!1),b,{block:d},{}).w("</tr>	</table>	")}function d(a,b){return a.w('<td><a href="data:image/png;base64,').f(b.getPath(!0,["value"]),b,"h").w("\" data-lightbox='a' data-title=\"").f(b.getPath(!0,["title"]),b,"h").w('"><img height="').f(b.getPath(!0,["ysize"]),b,"h").w('" width="').f(b.getPath(!0,["xsize"]),b,"h").w('" src="data:image/png;base64,').f(b.getPath(!0,["value"]),b,"h").w("\" /></a><br /><span class='summary_datacollection_parameter'>").f(b.getPath(!0,["title"]),b,"h").w("</span></td></div>	")}function e(a,b){return a.w('<div align="center"><img height="200" width="200" src="data:image/png;base64,').f(b.getPath(!0,["value"]),b,"h").w("\" /><br /><span class='summary_datacollection_parameter'>").f(b.getPath(!0,["title"]),b,"h").w("</span></div>			")}function f(a,b){return a.w("<div  style='border:1px solid gray;background-color:#FAFAFA;margin:10px;'><span  style='color: #157fcc;font-size: 17px;   font-weight: 300;'>").f(b.getPath(!0,["title"]),b,"h").w('</span><textarea style=\'margin:10px;\' rows="10" cols="150">').f(b.getPath(!0,["logText"]),b,"h").w(" </textarea></div>			")}function g(a,b){return a.w("<div><h1 >").f(b.getPath(!0,["value"]),b,"h").w("</h1></div>			")}function h(a,b){return a.w('<span style="display: inline; padding: .2em .6em .3em .6em;border-radius: .25em;color: #5bc0de; background-color: white;">').f(b.getPath(!0,["value"]),b,"h").w("</span>			")}function i(a,b){return a.w("<table style='border:1px solid gray;'><tr>").s(b.get(["columns"],!1),b,{block:j},{}).w("</tr>	").s(b.get(["data"],!1),b,{block:k},{}).w("</table>                                   		")}function j(a,b){return a.w("<th style='border: 1px solid black;'>").f(b.getPath(!0,[]),b,"h").w("</th>")}function k(a,b){return a.w("<tr>").s(b.getPath(!0,[]),b,{block:l},{}).w("</tr> ")}function l(a,b){return a.w("<td style='border: 1px solid black;'>").f(b.getPath(!0,[]),b,"h").w("</td>")}return a.register("workflowmainview.template",b),b.__dustBody=!0,c.__dustBody=!0,d.__dustBody=!0,e.__dustBody=!0,f.__dustBody=!0,g.__dustBody=!0,h.__dustBody=!0,i.__dustBody=!0,j.__dustBody=!0,k.__dustBody=!0,l.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.s(b.getPath(!0,[]),b,{block:c},{}).w("	")}function c(a,b){return a.w("<table><tr><td style='text-align:center;'>").h("eq",b,{block:d},{key:b.get(["status"],!1),value:"Success"},"h").h("eq",b,{block:e},{key:b.get(["status"],!1),value:"Failure"},"h").w("<span>").f(b.getPath(!0,["workflowStepType"]),b,"h").w('</span></td></tr><tr><td><img src="').f(b.getPath(!0,["imageURL"]),b,"h").w("\" style='border:1px solid #3892d3;' alt=\"").f(b.getPath(!0,["workflowStepType"]),b,"h").w('" height="100" width="100"></td></tr></table>')}function d(a,b){return a.w("<div class='summary_datacollection_success'></div>")}function e(a,b){return a.w("<div class='summary_datacollection_failed'></div>")}return a.register("workflowstepmain_steps",b),b.__dustBody=!0,c.__dustBody=!0,d.__dustBody=!0,e.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w('<div class="container-fluid"><div class="panel with-nav-tabs panel-default"><div class="panel-heading clearfix"><div class="pull-left"><h1 class="panel-title" style=\'color:#337ab7;\'><span style=\'font-size:12px;\'>   ').f(b.getPath(!0,["startTime"]),b,"h").w('</span></h1></div><div class="pull-right"><ul class="nav nav-tabs"><li class="active"><a data-toggle="tab" href="#datacollection_').f(b.get(["DataCollection_dataCollectionId"],!1),b,"h").w('">Summary </a></li></ul></div></div><br /><div class="tab-content"><div id="datacollection_').f(b.get(["DataCollection_dataCollectionId"],!1),b,"h").w('" class="tab-pane fade in active"><div class="container-fluid"><div class="row"><div class="col-xs-6 col-md-6"><table class="table table-condensed"><tr>      <td >Start Time</td><td class=\'column_parameter_value\'>').f(b.getPath(!0,["startTime"]),b,"h").w("</td>        </tr><tr><td >Filename</td><td class='column_parameter_value'>").f(b.getPath(!0,["filename"]),b,"h").w("</td></tr><tr><td >Fluorescence Detector</td><td class='column_parameter_value'>To be added to DB</td></tr><tr><td >Energy</td><td class='column_parameter_value'> ").f(b.getPath(!0,["energy"]),b,"h").w(" kev</td></tr><tr><td >Flux @100%</td><td class='column_parameter_value'>").f(b.getPath(!0,["flux"]),b,"h").w(" ph/s</td>    </tr><tr>      <td >Transmission</td><td class='column_parameter_value'>").f(b.getPath(!0,["beamTransmission"]),b,"h").w("%</td></tr><tr>       <td style='width:150px;' >Beam Size Hor</td><td class='column_parameter_value'>").f(b.getPath(!0,["beamSizeHorizontal"]),b,"h").w(" micrometer</td></tr><tr>                            <td >Beam Size Vert</td><td class='column_parameter_value'>").f(b.getPath(!0,["beamSizeVertical"]),b,"h").w(" micrometer</td></tr><tr>                                <td >Exposure Time</td><td class='column_parameter_value'>").f(b.getPath(!0,["exposureTime"]),b,"h").w(" s</td>                                    </tr><tr>                                <td >Directory</td><td class='column_parameter_value'>").f(b.getPath(!0,["workingDirectory"]),b,"h").w('</td>                                    </tr></table></div><div class="col-xs-2 col-md-2"><div id=\'').f(b.getPath(!0,["containerId"]),b,"h").w("'></div><br /><a href='#/mx/xfe/").f(b.getPath(!0,["xfeFluorescenceSpectrumId"]),b,"h").w('/main\' type="button" class="btn btn-default">Open</a></div>        </div></div></div></div></div>');
}return a.register("xfescangrid.template",b),b.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w("<h2>").f(b.getPath(!0,["code"]),b,"h").w("</h2>").s(b.getPath(!0,[]),b,{block:c},{})}function c(a,b){return a.w("<br />Storage conditions: ").f(b.getPath(!0,["storageLocation"]),b,"h").w("<br />").f(b.getPath(!0,["comments"]),b,"h")}return a.register("parcelformsummary",b),b.__dustBody=!0,c.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w('<div class="container-fluid"><div class="row text-center"><div class="col-sm-1 border-columns">Run<div>&nbsp;</div></div> <div class="col-sm-1 border-columns">Frames <span style=\'font-size:10px;\'>(Average/Total)</span><div>&nbsp;</div></div> <div class="col-sm-1 border-columns">Exp. Temp.<div>&nbsp;</div></div><div class="col-sm-2 border-columns">Guinier<div class="row text-center"><div class="col-sm-4 border-right-columns">Rg</div><div class="col-sm-4 border-right-columns">Points</div><div class="col-sm-4">I0</div></div></div> <div class="col-sm-2 border-columns">Gnom<div class="row text-center"><div class="col-sm-4 border-right-columns">Rg</div><div class="col-sm-4 border-right-columns">Total</div><div class="col-sm-4">D<sub>max</sub></div></div></div> <div class="col-sm-1 border-columns">Porod<div class="row text-center"><div class="col-sm-6 border-right-columns">Volume</div><div class="col-sm-6" style=\'font-size:7px;\'>MM Vol. est.</div></div></div><div class="col-sm-1 border-columns">Scattering<div>&nbsp;</div></div> <div class="col-sm-1 border-columns">Kratky.<div>&nbsp;</div></div> <div class="col-sm-1 border-columns">Density<div>&nbsp;</div></div> <div class="col-sm-1 border-columns">Guinier.<div>&nbsp;</div></div></div></div>')}return a.register("queue.grid.header.template",b),b.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w('<div class="container-fluid"><div class="row"><div class="col-sm-1"><table class="table table-queue-grid-borderless"><tbody>').s(b.get(["codes"],!1),b,{block:c},{}).w('</tbody></table></div> <div class="col-sm-1"><div class="container-fluid"><div class="row"><div class="col-sm-10"><table class="table table-queue-grid-borderless"><tbody>').s(b.get(["macromoleculeInfo"],!1),b,{block:d},{}).w('</tbody></table></div><div class="col-sm-2"><table class="table table-queue-grid-borderless"><tbody>').s(b.get(["averages"],!1),b,{block:g},{}).w('</tbody></table></div></div></div></div> <div class="col-sm-1"><div class="container-fluid">').f(b.get(["expTemp"],!1),b,"h").w('</div></div><div class="col-sm-2"><div class="row text-center"><div class="col-sm-4"><span ').h("eq",b,{"else":h,block:i},{key:b.get(["rg"],!1),value:"NA"},"h").w('</div><div class="col-sm-4"><span ').h("eq",b,{"else":j,block:k},{key:b.get(["points"],!1),value:"NA"},"h").w('</span></div><div class="col-sm-4"><span ').h("eq",b,{"else":l,block:m},{key:b.get(["I0"],!1),value:"NA"},"h").w('</div></div></div> <div class="col-sm-2"><div class="row text-center"><div class="col-sm-4"><span ').h("eq",b,{"else":n,block:o},{key:b.get(["rgGnom"],!1),value:"NA"},"h").w('</div><div class="col-sm-4"><span ').h("eq",b,{"else":p,block:q},{key:b.get(["total"],!1),value:"NA"},"h").w('</span></div><div class="col-sm-4"><span ').h("eq",b,{"else":r,block:s},{key:b.get(["dmax"],!1),value:"NA"},"h").w('</div></div></div> <div class="col-sm-1"><div class="row text-center"><div class="col-sm-6"><span ').h("eq",b,{"else":t,block:u},{key:b.get(["volumePorod"],!1),value:"NA"},"h").w('</div><div class="col-sm-6"><span ').h("eq",b,{"else":v,block:w},{key:b.get(["volumePorod"],!1),value:"NA"},"h").w('</div></div></div><div class="col-sm-1"><div><a href="').f(b.get(["scattering"],!1),b,"h").w('"><img alt="Image not found" class="img-responsive border-img" src="').f(b.get(["scattering"],!1),b,"h").w('" height="').f(b.get(["imgWidth"],!1),b,"h").w('" width="').f(b.get(["imgWidth"],!1),b,"h").w('" /></a>                           </div></div> <div class="col-sm-1"><div><a href="').f(b.get(["kratky"],!1),b,"h").w('"><img alt="Image not found" class="img-responsive border-img" src="').f(b.get(["kratky"],!1),b,"h").w('" height="').f(b.get(["imgWidth"],!1),b,"h").w('" width="').f(b.get(["imgWidth"],!1),b,"h").w('" /></a>                           </div></div> <div class="col-sm-1"><div><a href="').f(b.get(["density"],!1),b,"h").w('"><img alt="Image not found" class="img-responsive border-img" src="').f(b.get(["density"],!1),b,"h").w('" height="').f(b.get(["imgWidth"],!1),b,"h").w('" width="').f(b.get(["imgWidth"],!1),b,"h").w('" /></a>                           </div></div> <div class="col-sm-1"><div><a href="').f(b.get(["guinier"],!1),b,"h").w('"><img alt="Image not found" class="img-responsive border-img" src="').f(b.get(["guinier"],!1),b,"h").w('" height="').f(b.get(["imgWidth"],!1),b,"h").w('" width="').f(b.get(["imgWidth"],!1),b,"h").w('" /></a>                           </div></div> </div></div>')}function c(a,b){return a.w("<tr><td># ").f(b.getPath(!0,[]),b,"h").w("</td></tr>")}function d(a,b){return a.w("<tr><td>").h("eq",b,{"else":e,block:f},{key:b.get(["acronym"],!1),value:""},"h").w("</td></tr>")}function e(a,b){return a.w("<b>").f(b.getPath(!0,["acronym"]),b,"h").w("</b> ").f(b.getPath(!0,["concentration"]),b,"h")}function f(a,b){return a.w("&nbsp;")}function g(a,b){return a.w('<tr><td style="background-color:').f(b.getPath(!0,["color"]),b,"h").w(';">').f(b.getPath(!0,["text"]),b,"h").w("</td></tr>")}function h(a,b){return a.w(">").f(b.get(["rg"],!1),b,"h").w("</span><span style='font-size:10px;color:gray'>  nm</span>")}function i(a,b){return a.w("class='notavailablefield'>NA</span>")}function j(a,b){return a.w(">").f(b.get(["points"],!1),b,"h")}function k(a,b){return a.w("class='notavailablefield'>NA")}function l(a,b){return a.w(">").f(b.get(["I0"],!1),b,"h").w("</span><span style='font-size:10px'> &#177; ").f(b.get(["I0Stdev"],!1),b,"h").w("</span>")}function m(a,b){return a.w("class='notavailablefield'>NA</span>")}function n(a,b){return a.w(">").f(b.get(["rgGnom"],!1),b,"h").w("</span><span style='font-size:10px;color:gray'>  nm</span>")}function o(a,b){return a.w("class='notavailablefield'>NA</span>")}function p(a,b){return a.w(">").f(b.get(["total"],!1),b,"h")}function q(a,b){return a.w("class='notavailablefield'>NA")}function r(a,b){return a.w(">").f(b.get(["dmax"],!1),b,"h").w("</span><span style='font-size:10px;color:gray'>  nm</span>")}function s(a,b){return a.w("class='notavailablefield'>NA</span>")}function t(a,b){return a.w(">").f(b.get(["volumePorod"],!1),b,"h").w("</span><span style='font-size:8px;color:gray;'> nm<sub>3</sub></span>")}function u(a,b){return a.w("class='notavailablefield'>NA</span>")}function v(a,b){return a.w(">").f(b.get(["mmvolest"],!1),b,"h").w("</span><span style='font-size:8px;color:gray;'>kD</span>")}function w(a,b){return a.w("class='notavailablefield'>NA</span>")}return a.register("queue.grid.template",b),b.__dustBody=!0,c.__dustBody=!0,d.__dustBody=!0,e.__dustBody=!0,f.__dustBody=!0,g.__dustBody=!0,h.__dustBody=!0,i.__dustBody=!0,j.__dustBody=!0,k.__dustBody=!0,l.__dustBody=!0,m.__dustBody=!0,n.__dustBody=!0,o.__dustBody=!0,p.__dustBody=!0,q.__dustBody=!0,r.__dustBody=!0,s.__dustBody=!0,t.__dustBody=!0,u.__dustBody=!0,v.__dustBody=!0,w.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w('<div id="container"><div style=\'float:left;\' id="left"><img class="titleImage" src="../images/logo_EXI.jpg" /><span class="title">ExiSAXS<span class="subtitle">Extended ISPyB forSAXS<sub style="font-size:10px;color:orange">BETA</sub></span></span></div><div id="center"></div><div style=\'float:right;width:120px;\' id="logos"><img class="logoImage" src="../images/logo_EMBL.png" /><img class="logoImage" src="../images/logo_ESRF.png" /></div><div style=\'float:right;width:120px;\' id="right"><div style=\'color:white;font-size:10px; \'>Version: ').f(b.getPath(!0,["version"]),b,"h").w("</div><div style='color:white;font-size:10px; '>Released: ").f(b.getPath(!0,["release_date"]),b,"h").w("</div><div style='color:white;font-size:10px;'>").f(b.getPath(!0,["database"]),b,"h").w("</div></div></div>")}return a.register("saxsheader",b),b.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w(" <kbd style='background-color:#AC58FA;font-size:12px;'>").f(b.getPath(!0,["experimentType"]),b,"h").w("</kbd><br />").f(b.getPath(!0,["creationDate"]),b,"h").w("<br />").f(b.getPath(!0,["name"]),b,"h").w('<br /><table style=\'margin-left:10px;\'>           <tr><td  style="height:10px;">Subtractions</td><td style=\'padding-left:10px;\'><div class="meter-wrap"><div class="meter-value" style="background-color: #99CC00 ; width: ').f(b.getPath(!0,["subtracted"]),b,"h").w('%;"><div class="meter-text">').f(b.getPath(!0,["dataCollectionDoneCount"]),b,"h").w(" of ").f(b.getPath(!0,["dataCollectionCount"]),b,"h").w("</div></div></div></td></tr></table>")}return a.register("hplc.sessionsaxslistview.template",b),b.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.h("eq",b,{block:c},{key:b.get(["experimentType"],!1),value:"STATIC"},"h").w("    ").h("eq",b,{block:d},{key:b.get(["experimentType"],!1),value:"SAMPLE CHANGER"},"h").w("   ").h("eq",b,{block:e},{key:b.get(["experimentType"],!1),value:"CALIBRATION"},"h").w("  ").h("eq",b,{block:f},{key:b.get(["experimentType"],!1),value:"HPLC"},"h").w("   ")}function c(a,b){return a.p("static.sessionsaxslistview.template",b,b,{})}function d(a,b){return a.p("static.sessionsaxslistview.template",b,b,{})}function e(a,b){return a.p("static.sessionsaxslistview.template",b,b,{})}function f(a,b){return a.p("hplc.sessionsaxslistview.template",b,b,{})}return a.register("sessionsaxslistview.template",b),b.__dustBody=!0,c.__dustBody=!0,d.__dustBody=!0,e.__dustBody=!0,f.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w(" ").h("eq",b,{"else":c,block:d},{key:b.get(["experimentType"],!1),value:"STATIC"},"h").w(" <br />").f(b.getPath(!0,["creationDate"]),b,"h").w("<br />").f(b.getPath(!0,["name"]),b,"h").w('<br /><table style=\'margin-left:10px;\'><tr><td  style="height:10px;">Samples</td><td style=\'padding-left:10px;\'><div class="meter-wrap"><div class="meter-value" style="background-color: #99CC00 ; width: ').f(b.getPath(!0,["measured"]),b,"h").w('%;"><div class="meter-text">').f(b.getPath(!0,["measurementDoneCount"]),b,"h").w(" of ").f(b.getPath(!0,["measurementCount"]),b,"h").w('</div></div></div></td></tr><tr><td  style="height:10px;">Averages</td><td style=\'padding-left:10px;\'><div class="meter-wrap"><div class="meter-value" style="background-color: #99CC00 ; width: ').f(b.getPath(!0,["averaged"]),b,"h").w('%;"><div class="meter-text">').f(b.getPath(!0,["measurementAveragedCount"]),b,"h").w(" of ").f(b.getPath(!0,["measurementCount"]),b,"h").w('</div></div></div></td></tr><tr><td  style="height:10px;">Subtractions</td><td style=\'padding-left:10px;\'><div class="meter-wrap"><div class="meter-value" style="background-color: #99CC00 ; width: ').f(b.getPath(!0,["subtracted"]),b,"h").w('%;"><div class="meter-text">').f(b.getPath(!0,["dataCollectionDoneCount"]),b,"h").w(" of ").f(b.getPath(!0,["dataCollectionCount"]),b,"h").w("</div></div></div></td></tr></table>")}function c(a,b){return a.w("<kbd style='background-color:#2E9AFE;font-size:12px;'>").f(b.getPath(!0,["experimentType"]),b,"h").w("</kbd>")}function d(a,b){return a.w("       <kbd style='background-color:#088A08;font-size:12px;'>SAMPLE CHANGER</kbd>")}return a.register("static.sessionsaxslistview.template",b),b.__dustBody=!0,c.__dustBody=!0,d.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w("<table> <tr><td>Macromolecule:</td><td style='color:#207a7a;font-weight:bold;'>").f(b.getPath(!0,["macromoleculeAcronym"]),b,"h").w(" ").f(b.getPath(!0,["record","data","concentration"]),b,"h").w(" mg/ml</td></tr><tr><td>Buffer:</td><td>").f(b.getPath(!0,["bufferAcronym"]),b,"h").w("</td></tr><tr><td>Storage Temperature:</td><td>").f(b.getPath(!0,["storageTemperature"]),b,"h").w("</td></tr></table>")}return a.register("stocksolution.listview",b),b.__dustBody=!0,b}(dust),function(a){function b(a,b){return a.w("<table>").s(b.getPath(!0,[]),b,{block:c},{}).w("</table>")}function c(a,b){return a.w("<tr><td>").f(b.getPath(!0,["count"]),b,"h").w("</td><td>").f(b.getPath(!0,["step"]),b,"h").w("</td></tr>")}return a.register("test",b),b.__dustBody=!0,c.__dustBody=!0,b}(dust);